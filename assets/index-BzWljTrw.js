var vC=Object.defineProperty;var bC=(c,a,d)=>a in c?vC(c,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[a]=d;var Ii=(c,a,d)=>(bC(c,typeof a!="symbol"?a+"":a,d),d);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))m(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const E of T.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&m(E)}).observe(document,{childList:!0,subtree:!0});function d(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerPolicy&&(T.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?T.credentials="include":x.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function m(x){if(x.ep)return;x.ep=!0;const T=d(x);fetch(x.href,T)}})();/**
* @vue/shared v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function X0(c,a){const d=new Set(c.split(","));return m=>d.has(m)}const Dn={},mh=[],Vs=()=>{},wC=()=>!1,q_=c=>c.charCodeAt(0)===111&&c.charCodeAt(1)===110&&(c.charCodeAt(2)>122||c.charCodeAt(2)<97),Y0=c=>c.startsWith("onUpdate:"),pr=Object.assign,K0=(c,a)=>{const d=c.indexOf(a);d>-1&&c.splice(d,1)},TC=Object.prototype.hasOwnProperty,on=(c,a)=>TC.call(c,a),bi=Array.isArray,_h=c=>W_(c)==="[object Map]",qT=c=>W_(c)==="[object Set]",ji=c=>typeof c=="function",mr=c=>typeof c=="string",Nc=c=>typeof c=="symbol",Bn=c=>c!==null&&typeof c=="object",WT=c=>(Bn(c)||ji(c))&&ji(c.then)&&ji(c.catch),HT=Object.prototype.toString,W_=c=>HT.call(c),MC=c=>W_(c).slice(8,-1),ZT=c=>W_(c)==="[object Object]",J0=c=>mr(c)&&c!=="NaN"&&c[0]!=="-"&&""+parseInt(c,10)===c,gf=X0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),H_=c=>{const a=Object.create(null);return d=>a[d]||(a[d]=c(d))},SC=/-(\w)/g,Oc=H_(c=>c.replace(SC,(a,d)=>d?d.toUpperCase():"")),EC=/\B([A-Z])/g,Vc=H_(c=>c.replace(EC,"-$1").toLowerCase()),QT=H_(c=>c.charAt(0).toUpperCase()+c.slice(1)),n0=H_(c=>c?`on${QT(c)}`:""),Lo=(c,a)=>!Object.is(c,a),x_=(c,a)=>{for(let d=0;d<c.length;d++)c[d](a)},XT=(c,a,d,m=!1)=>{Object.defineProperty(c,a,{configurable:!0,enumerable:!1,writable:m,value:d})},S0=c=>{const a=parseFloat(c);return isNaN(a)?c:a};let Y1;const YT=()=>Y1||(Y1=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ex(c){if(bi(c)){const a={};for(let d=0;d<c.length;d++){const m=c[d],x=mr(m)?PC(m):ex(m);if(x)for(const T in x)a[T]=x[T]}return a}else if(mr(c)||Bn(c))return c}const AC=/;(?![^(]*\))/g,IC=/:([^]+)/,CC=/\/\*[^]*?\*\//g;function PC(c){const a={};return c.replace(CC,"").split(AC).forEach(d=>{if(d){const m=d.split(IC);m.length>1&&(a[m[0].trim()]=m[1].trim())}}),a}function tx(c){let a="";if(mr(c))a=c;else if(bi(c))for(let d=0;d<c.length;d++){const m=tx(c[d]);m&&(a+=m+" ")}else if(Bn(c))for(const d in c)c[d]&&(a+=d+" ");return a.trim()}const DC="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",RC=X0(DC);function KT(c){return!!c||c===""}const gh=c=>mr(c)?c:c==null?"":bi(c)||Bn(c)&&(c.toString===HT||!ji(c.toString))?JSON.stringify(c,JT,2):String(c),JT=(c,a)=>a&&a.__v_isRef?JT(c,a.value):_h(a)?{[`Map(${a.size})`]:[...a.entries()].reduce((d,[m,x],T)=>(d[r0(m,T)+" =>"]=x,d),{})}:qT(a)?{[`Set(${a.size})`]:[...a.values()].map(d=>r0(d))}:Nc(a)?r0(a):Bn(a)&&!bi(a)&&!ZT(a)?String(a):a,r0=(c,a="")=>{var d;return Nc(c)?`Symbol(${(d=c.description)!=null?d:a})`:c};/**
* @vue/reactivity v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let so;class zC{constructor(a=!1){this.detached=a,this._active=!0,this.effects=[],this.cleanups=[],this.parent=so,!a&&so&&(this.index=(so.scopes||(so.scopes=[])).push(this)-1)}get active(){return this._active}run(a){if(this._active){const d=so;try{return so=this,a()}finally{so=d}}}on(){so=this}off(){so=this.parent}stop(a){if(this._active){let d,m;for(d=0,m=this.effects.length;d<m;d++)this.effects[d].stop();for(d=0,m=this.cleanups.length;d<m;d++)this.cleanups[d]();if(this.scopes)for(d=0,m=this.scopes.length;d<m;d++)this.scopes[d].stop(!0);if(!this.detached&&this.parent&&!a){const x=this.parent.scopes.pop();x&&x!==this&&(this.parent.scopes[this.index]=x,x.index=this.index)}this.parent=void 0,this._active=!1}}}function LC(c,a=so){a&&a.active&&a.effects.push(c)}function kC(){return so}let Dc;class ix{constructor(a,d,m,x){this.fn=a,this.trigger=d,this.scheduler=m,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,LC(this,x)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,gl();for(let a=0;a<this._depsLength;a++){const d=this.deps[a];if(d.computed&&(OC(d.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),yl()}return this._dirtyLevel>=4}set dirty(a){this._dirtyLevel=a?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let a=hl,d=Dc;try{return hl=!0,Dc=this,this._runnings++,K1(this),this.fn()}finally{J1(this),this._runnings--,Dc=d,hl=a}}stop(){this.active&&(K1(this),J1(this),this.onStop&&this.onStop(),this.active=!1)}}function OC(c){return c.value}function K1(c){c._trackId++,c._depsLength=0}function J1(c){if(c.deps.length>c._depsLength){for(let a=c._depsLength;a<c.deps.length;a++)eM(c.deps[a],c);c.deps.length=c._depsLength}}function eM(c,a){const d=c.get(a);d!==void 0&&a._trackId!==d&&(c.delete(a),c.size===0&&c.cleanup())}let hl=!0,E0=0;const tM=[];function gl(){tM.push(hl),hl=!1}function yl(){const c=tM.pop();hl=c===void 0?!0:c}function nx(){E0++}function rx(){for(E0--;!E0&&A0.length;)A0.shift()()}function iM(c,a,d){if(a.get(c)!==c._trackId){a.set(c,c._trackId);const m=c.deps[c._depsLength];m!==a?(m&&eM(m,c),c.deps[c._depsLength++]=a):c._depsLength++}}const A0=[];function nM(c,a,d){nx();for(const m of c.keys()){let x;m._dirtyLevel<a&&(x??(x=c.get(m)===m._trackId))&&(m._shouldSchedule||(m._shouldSchedule=m._dirtyLevel===0),m._dirtyLevel=a),m._shouldSchedule&&(x??(x=c.get(m)===m._trackId))&&(m.trigger(),(!m._runnings||m.allowRecurse)&&m._dirtyLevel!==2&&(m._shouldSchedule=!1,m.scheduler&&A0.push(m.scheduler)))}rx()}const rM=(c,a)=>{const d=new Map;return d.cleanup=c,d.computed=a,d},I0=new WeakMap,Rc=Symbol(""),C0=Symbol("");function as(c,a,d){if(hl&&Dc){let m=I0.get(c);m||I0.set(c,m=new Map);let x=m.get(d);x||m.set(d,x=rM(()=>m.delete(d))),iM(Dc,x)}}function ha(c,a,d,m,x,T){const E=I0.get(c);if(!E)return;let P=[];if(a==="clear")P=[...E.values()];else if(d==="length"&&bi(c)){const r=Number(m);E.forEach((B,W)=>{(W==="length"||!Nc(W)&&W>=r)&&P.push(B)})}else switch(d!==void 0&&P.push(E.get(d)),a){case"add":bi(c)?J0(d)&&P.push(E.get("length")):(P.push(E.get(Rc)),_h(c)&&P.push(E.get(C0)));break;case"delete":bi(c)||(P.push(E.get(Rc)),_h(c)&&P.push(E.get(C0)));break;case"set":_h(c)&&P.push(E.get(Rc));break}nx();for(const r of P)r&&nM(r,4);rx()}const FC=X0("__proto__,__v_isRef,__isVue"),sM=new Set(Object.getOwnPropertyNames(Symbol).filter(c=>c!=="arguments"&&c!=="caller").map(c=>Symbol[c]).filter(Nc)),ew=BC();function BC(){const c={};return["includes","indexOf","lastIndexOf"].forEach(a=>{c[a]=function(...d){const m=ln(this);for(let T=0,E=this.length;T<E;T++)as(m,"get",T+"");const x=m[a](...d);return x===-1||x===!1?m[a](...d.map(ln)):x}}),["push","pop","shift","unshift","splice"].forEach(a=>{c[a]=function(...d){gl(),nx();const m=ln(this)[a].apply(this,d);return rx(),yl(),m}}),c}function NC(c){Nc(c)||(c=String(c));const a=ln(this);return as(a,"has",c),a.hasOwnProperty(c)}class oM{constructor(a=!1,d=!1){this._isReadonly=a,this._isShallow=d}get(a,d,m){const x=this._isReadonly,T=this._isShallow;if(d==="__v_isReactive")return!x;if(d==="__v_isReadonly")return x;if(d==="__v_isShallow")return T;if(d==="__v_raw")return m===(x?T?KC:uM:T?cM:lM).get(a)||Object.getPrototypeOf(a)===Object.getPrototypeOf(m)?a:void 0;const E=bi(a);if(!x){if(E&&on(ew,d))return Reflect.get(ew,d,m);if(d==="hasOwnProperty")return NC}const P=Reflect.get(a,d,m);return(Nc(d)?sM.has(d):FC(d))||(x||as(a,"get",d),T)?P:ls(P)?E&&J0(d)?P:P.value:Bn(P)?x?hM(P):Q_(P):P}}class aM extends oM{constructor(a=!1){super(!1,a)}set(a,d,m,x){let T=a[d];if(!this._isShallow){const r=Af(T);if(!P_(m)&&!Af(m)&&(T=ln(T),m=ln(m)),!bi(a)&&ls(T)&&!ls(m))return r?!1:(T.value=m,!0)}const E=bi(a)&&J0(d)?Number(d)<a.length:on(a,d),P=Reflect.set(a,d,m,x);return a===ln(x)&&(E?Lo(m,T)&&ha(a,"set",d,m):ha(a,"add",d,m)),P}deleteProperty(a,d){const m=on(a,d);a[d];const x=Reflect.deleteProperty(a,d);return x&&m&&ha(a,"delete",d,void 0),x}has(a,d){const m=Reflect.has(a,d);return(!Nc(d)||!sM.has(d))&&as(a,"has",d),m}ownKeys(a){return as(a,"iterate",bi(a)?"length":Rc),Reflect.ownKeys(a)}}class VC extends oM{constructor(a=!1){super(!0,a)}set(a,d){return!0}deleteProperty(a,d){return!0}}const jC=new aM,UC=new VC,GC=new aM(!0);const sx=c=>c,Z_=c=>Reflect.getPrototypeOf(c);function Ym(c,a,d=!1,m=!1){c=c.__v_raw;const x=ln(c),T=ln(a);d||(Lo(a,T)&&as(x,"get",a),as(x,"get",T));const{has:E}=Z_(x),P=m?sx:d?lx:If;if(E.call(x,a))return P(c.get(a));if(E.call(x,T))return P(c.get(T));c!==x&&c.get(a)}function Km(c,a=!1){const d=this.__v_raw,m=ln(d),x=ln(c);return a||(Lo(c,x)&&as(m,"has",c),as(m,"has",x)),c===x?d.has(c):d.has(c)||d.has(x)}function Jm(c,a=!1){return c=c.__v_raw,!a&&as(ln(c),"iterate",Rc),Reflect.get(c,"size",c)}function tw(c){c=ln(c);const a=ln(this);return Z_(a).has.call(a,c)||(a.add(c),ha(a,"add",c,c)),this}function iw(c,a){a=ln(a);const d=ln(this),{has:m,get:x}=Z_(d);let T=m.call(d,c);T||(c=ln(c),T=m.call(d,c));const E=x.call(d,c);return d.set(c,a),T?Lo(a,E)&&ha(d,"set",c,a):ha(d,"add",c,a),this}function nw(c){const a=ln(this),{has:d,get:m}=Z_(a);let x=d.call(a,c);x||(c=ln(c),x=d.call(a,c)),m&&m.call(a,c);const T=a.delete(c);return x&&ha(a,"delete",c,void 0),T}function rw(){const c=ln(this),a=c.size!==0,d=c.clear();return a&&ha(c,"clear",void 0,void 0),d}function e_(c,a){return function(m,x){const T=this,E=T.__v_raw,P=ln(E),r=a?sx:c?lx:If;return!c&&as(P,"iterate",Rc),E.forEach((B,W)=>m.call(x,r(B),r(W),T))}}function t_(c,a,d){return function(...m){const x=this.__v_raw,T=ln(x),E=_h(T),P=c==="entries"||c===Symbol.iterator&&E,r=c==="keys"&&E,B=x[c](...m),W=d?sx:a?lx:If;return!a&&as(T,"iterate",r?C0:Rc),{next(){const{value:Z,done:ae}=B.next();return ae?{value:Z,done:ae}:{value:P?[W(Z[0]),W(Z[1])]:W(Z),done:ae}},[Symbol.iterator](){return this}}}}function il(c){return function(...a){return c==="delete"?!1:c==="clear"?void 0:this}}function $C(){const c={get(T){return Ym(this,T)},get size(){return Jm(this)},has:Km,add:tw,set:iw,delete:nw,clear:rw,forEach:e_(!1,!1)},a={get(T){return Ym(this,T,!1,!0)},get size(){return Jm(this)},has:Km,add:tw,set:iw,delete:nw,clear:rw,forEach:e_(!1,!0)},d={get(T){return Ym(this,T,!0)},get size(){return Jm(this,!0)},has(T){return Km.call(this,T,!0)},add:il("add"),set:il("set"),delete:il("delete"),clear:il("clear"),forEach:e_(!0,!1)},m={get(T){return Ym(this,T,!0,!0)},get size(){return Jm(this,!0)},has(T){return Km.call(this,T,!0)},add:il("add"),set:il("set"),delete:il("delete"),clear:il("clear"),forEach:e_(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(T=>{c[T]=t_(T,!1,!1),d[T]=t_(T,!0,!1),a[T]=t_(T,!1,!0),m[T]=t_(T,!0,!0)}),[c,d,a,m]}const[qC,WC,HC,ZC]=$C();function ox(c,a){const d=a?c?ZC:HC:c?WC:qC;return(m,x,T)=>x==="__v_isReactive"?!c:x==="__v_isReadonly"?c:x==="__v_raw"?m:Reflect.get(on(d,x)&&x in m?d:m,x,T)}const QC={get:ox(!1,!1)},XC={get:ox(!1,!0)},YC={get:ox(!0,!1)};const lM=new WeakMap,cM=new WeakMap,uM=new WeakMap,KC=new WeakMap;function JC(c){switch(c){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function eP(c){return c.__v_skip||!Object.isExtensible(c)?0:JC(MC(c))}function Q_(c){return Af(c)?c:ax(c,!1,jC,QC,lM)}function tP(c){return ax(c,!1,GC,XC,cM)}function hM(c){return ax(c,!0,UC,YC,uM)}function ax(c,a,d,m,x){if(!Bn(c)||c.__v_raw&&!(a&&c.__v_isReactive))return c;const T=x.get(c);if(T)return T;const E=eP(c);if(E===0)return c;const P=new Proxy(c,E===2?m:d);return x.set(c,P),P}function yf(c){return Af(c)?yf(c.__v_raw):!!(c&&c.__v_isReactive)}function Af(c){return!!(c&&c.__v_isReadonly)}function P_(c){return!!(c&&c.__v_isShallow)}function X_(c){return c?!!c.__v_raw:!1}function ln(c){const a=c&&c.__v_raw;return a?ln(a):c}function iP(c){return Object.isExtensible(c)&&XT(c,"__v_skip",!0),c}const If=c=>Bn(c)?Q_(c):c,lx=c=>Bn(c)?hM(c):c;class dM{constructor(a,d,m,x){this.getter=a,this._setter=d,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new ix(()=>a(this._value),()=>xf(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!x,this.__v_isReadonly=m}get value(){const a=ln(this);return(!a._cacheable||a.effect.dirty)&&Lo(a._value,a._value=a.effect.run())&&xf(a,4),cx(a),a.effect._dirtyLevel>=2&&xf(a,2),a._value}set value(a){this._setter(a)}get _dirty(){return this.effect.dirty}set _dirty(a){this.effect.dirty=a}}function nP(c,a,d=!1){let m,x;const T=ji(c);return T?(m=c,x=Vs):(m=c.get,x=c.set),new dM(m,x,T||!x,d)}function cx(c){var a;hl&&Dc&&(c=ln(c),iM(Dc,(a=c.dep)!=null?a:c.dep=rM(()=>c.dep=void 0,c instanceof dM?c:void 0)))}function xf(c,a=4,d){c=ln(c);const m=c.dep;m&&nM(m,a)}function ls(c){return!!(c&&c.__v_isRef===!0)}function uf(c){return pM(c,!1)}function fM(c){return pM(c,!0)}function pM(c,a){return ls(c)?c:new rP(c,a)}class rP{constructor(a,d){this.__v_isShallow=d,this.dep=void 0,this.__v_isRef=!0,this._rawValue=d?a:ln(a),this._value=d?a:If(a)}get value(){return cx(this),this._value}set value(a){const d=this.__v_isShallow||P_(a)||Af(a);a=d?a:ln(a),Lo(a,this._rawValue)&&(this._rawValue=a,this._value=d?a:If(a),xf(this,4))}}function Do(c){return ls(c)?c.value:c}const sP={get:(c,a,d)=>Do(Reflect.get(c,a,d)),set:(c,a,d,m)=>{const x=c[a];return ls(x)&&!ls(d)?(x.value=d,!0):Reflect.set(c,a,d,m)}};function mM(c){return yf(c)?c:new Proxy(c,sP)}class oP{constructor(a){this.dep=void 0,this.__v_isRef=!0;const{get:d,set:m}=a(()=>cx(this),()=>xf(this));this._get=d,this._set=m}get value(){return this._get()}set value(a){this._set(a)}}function aP(c){return new oP(c)}/**
* @vue/runtime-core v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function dl(c,a,d,m){try{return m?c(...m):c()}catch(x){Y_(x,a,d)}}function co(c,a,d,m){if(ji(c)){const x=dl(c,a,d,m);return x&&WT(x)&&x.catch(T=>{Y_(T,a,d)}),x}if(bi(c)){const x=[];for(let T=0;T<c.length;T++)x.push(co(c[T],a,d,m));return x}}function Y_(c,a,d,m=!0){const x=a?a.vnode:null;if(a){let T=a.parent;const E=a.proxy,P=`https://vuejs.org/error-reference/#runtime-${d}`;for(;T;){const B=T.ec;if(B){for(let W=0;W<B.length;W++)if(B[W](c,E,P)===!1)return}T=T.parent}const r=a.appContext.config.errorHandler;if(r){gl(),dl(r,null,10,[c,E,P]),yl();return}}lP(c,d,x,m)}function lP(c,a,d,m=!0){console.error(c)}let Cf=!1,P0=!1;const Fr=[];let Ro=0;const yh=[];let rl=null,Cc=0;const _M=Promise.resolve();let ux=null;function gM(c){const a=ux||_M;return c?a.then(this?c.bind(this):c):a}function cP(c){let a=Ro+1,d=Fr.length;for(;a<d;){const m=a+d>>>1,x=Fr[m],T=Pf(x);T<c||T===c&&x.pre?a=m+1:d=m}return a}function hx(c){(!Fr.length||!Fr.includes(c,Cf&&c.allowRecurse?Ro+1:Ro))&&(c.id==null?Fr.push(c):Fr.splice(cP(c.id),0,c),yM())}function yM(){!Cf&&!P0&&(P0=!0,ux=_M.then(vM))}function uP(c){const a=Fr.indexOf(c);a>Ro&&Fr.splice(a,1)}function hP(c){bi(c)?yh.push(...c):(!rl||!rl.includes(c,c.allowRecurse?Cc+1:Cc))&&yh.push(c),yM()}function sw(c,a,d=Cf?Ro+1:0){for(;d<Fr.length;d++){const m=Fr[d];if(m&&m.pre){if(c&&m.id!==c.uid)continue;Fr.splice(d,1),d--,m()}}}function xM(c){if(yh.length){const a=[...new Set(yh)].sort((d,m)=>Pf(d)-Pf(m));if(yh.length=0,rl){rl.push(...a);return}for(rl=a,Cc=0;Cc<rl.length;Cc++)rl[Cc]();rl=null,Cc=0}}const Pf=c=>c.id==null?1/0:c.id,dP=(c,a)=>{const d=Pf(c)-Pf(a);if(d===0){if(c.pre&&!a.pre)return-1;if(a.pre&&!c.pre)return 1}return d};function vM(c){P0=!1,Cf=!0,Fr.sort(dP);try{for(Ro=0;Ro<Fr.length;Ro++){const a=Fr[Ro];a&&a.active!==!1&&dl(a,null,14)}}finally{Ro=0,Fr.length=0,xM(),Cf=!1,ux=null,(Fr.length||yh.length)&&vM()}}function fP(c,a,...d){if(c.isUnmounted)return;const m=c.vnode.props||Dn;let x=d;const T=a.startsWith("update:"),E=T&&a.slice(7);if(E&&E in m){const W=`${E==="modelValue"?"model":E}Modifiers`,{number:Z,trim:ae}=m[W]||Dn;ae&&(x=d.map(fe=>mr(fe)?fe.trim():fe)),Z&&(x=d.map(S0))}let P,r=m[P=n0(a)]||m[P=n0(Oc(a))];!r&&T&&(r=m[P=n0(Vc(a))]),r&&co(r,c,6,x);const B=m[P+"Once"];if(B){if(!c.emitted)c.emitted={};else if(c.emitted[P])return;c.emitted[P]=!0,co(B,c,6,x)}}function bM(c,a,d=!1){const m=a.emitsCache,x=m.get(c);if(x!==void 0)return x;const T=c.emits;let E={},P=!1;if(!ji(c)){const r=B=>{const W=bM(B,a,!0);W&&(P=!0,pr(E,W))};!d&&a.mixins.length&&a.mixins.forEach(r),c.extends&&r(c.extends),c.mixins&&c.mixins.forEach(r)}return!T&&!P?(Bn(c)&&m.set(c,null),null):(bi(T)?T.forEach(r=>E[r]=null):pr(E,T),Bn(c)&&m.set(c,E),E)}function K_(c,a){return!c||!q_(a)?!1:(a=a.slice(2).replace(/Once$/,""),on(c,a[0].toLowerCase()+a.slice(1))||on(c,Vc(a))||on(c,a))}let ss=null,wM=null;function D_(c){const a=ss;return ss=c,wM=c&&c.type.__scopeId||null,a}function pP(c,a=ss,d){if(!a||c._n)return c;const m=(...x)=>{m._d&&pw(-1);const T=D_(a);let E;try{E=c(...x)}finally{D_(T),m._d&&pw(1)}return E};return m._n=!0,m._c=!0,m._d=!0,m}function s0(c){const{type:a,vnode:d,proxy:m,withProxy:x,propsOptions:[T],slots:E,attrs:P,emit:r,render:B,renderCache:W,props:Z,data:ae,setupState:fe,ctx:Le,inheritAttrs:De}=c,Ve=D_(c);let Ye,lt;try{if(d.shapeFlag&4){const gt=x||m,yt=gt;Ye=Po(B.call(yt,gt,W,Z,fe,ae,Le)),lt=P}else{const gt=a;Ye=Po(gt.length>1?gt(Z,{attrs:P,slots:E,emit:r}):gt(Z,null)),lt=a.props?P:mP(P)}}catch(gt){wf.length=0,Y_(gt,c,1),Ye=Qn(Fc)}let dt=Ye;if(lt&&De!==!1){const gt=Object.keys(lt),{shapeFlag:yt}=dt;gt.length&&yt&7&&(T&&gt.some(Y0)&&(lt=_P(lt,T)),dt=vh(dt,lt,!1,!0))}return d.dirs&&(dt=vh(dt,null,!1,!0),dt.dirs=dt.dirs?dt.dirs.concat(d.dirs):d.dirs),d.transition&&(dt.transition=d.transition),Ye=dt,D_(Ve),Ye}const mP=c=>{let a;for(const d in c)(d==="class"||d==="style"||q_(d))&&((a||(a={}))[d]=c[d]);return a},_P=(c,a)=>{const d={};for(const m in c)(!Y0(m)||!(m.slice(9)in a))&&(d[m]=c[m]);return d};function gP(c,a,d){const{props:m,children:x,component:T}=c,{props:E,children:P,patchFlag:r}=a,B=T.emitsOptions;if(a.dirs||a.transition)return!0;if(d&&r>=0){if(r&1024)return!0;if(r&16)return m?ow(m,E,B):!!E;if(r&8){const W=a.dynamicProps;for(let Z=0;Z<W.length;Z++){const ae=W[Z];if(E[ae]!==m[ae]&&!K_(B,ae))return!0}}}else return(x||P)&&(!P||!P.$stable)?!0:m===E?!1:m?E?ow(m,E,B):!0:!!E;return!1}function ow(c,a,d){const m=Object.keys(a);if(m.length!==Object.keys(c).length)return!0;for(let x=0;x<m.length;x++){const T=m[x];if(a[T]!==c[T]&&!K_(d,T))return!0}return!1}function yP({vnode:c,parent:a},d){for(;a;){const m=a.subTree;if(m.suspense&&m.suspense.activeBranch===c&&(m.el=c.el),m===c)(c=a.vnode).el=d,a=a.parent;else break}}const xP=Symbol.for("v-ndc"),vP=c=>c.__isSuspense;function bP(c,a){a&&a.pendingBranch?bi(c)?a.effects.push(...c):a.effects.push(c):hP(c)}const wP=Symbol.for("v-scx"),TP=()=>b_(wP);function MP(c,a){return dx(c,null,{flush:"sync"})}const i_={};function zc(c,a,d){return dx(c,a,d)}function dx(c,a,{immediate:d,deep:m,flush:x,once:T,onTrack:E,onTrigger:P}=Dn){if(a&&T){const Ut=a;a=(...Yt)=>{Ut(...Yt),yt()}}const r=Br,B=Ut=>m===!0?Ut:Pc(Ut,m===!1?1:void 0);let W,Z=!1,ae=!1;if(ls(c)?(W=()=>c.value,Z=P_(c)):yf(c)?(W=()=>B(c),Z=!0):bi(c)?(ae=!0,Z=c.some(Ut=>yf(Ut)||P_(Ut)),W=()=>c.map(Ut=>{if(ls(Ut))return Ut.value;if(yf(Ut))return B(Ut);if(ji(Ut))return dl(Ut,r,2)})):ji(c)?a?W=()=>dl(c,r,2):W=()=>(fe&&fe(),co(c,r,3,[Le])):W=Vs,a&&m){const Ut=W;W=()=>Pc(Ut())}let fe,Le=Ut=>{fe=dt.onStop=()=>{dl(Ut,r,4),fe=dt.onStop=void 0}},De;if(tg)if(Le=Vs,a?d&&co(a,r,3,[W(),ae?[]:void 0,Le]):W(),x==="sync"){const Ut=TP();De=Ut.__watcherHandles||(Ut.__watcherHandles=[])}else return Vs;let Ve=ae?new Array(c.length).fill(i_):i_;const Ye=()=>{if(!(!dt.active||!dt.dirty))if(a){const Ut=dt.run();(m||Z||(ae?Ut.some((Yt,wi)=>Lo(Yt,Ve[wi])):Lo(Ut,Ve)))&&(fe&&fe(),co(a,r,3,[Ut,Ve===i_?void 0:ae&&Ve[0]===i_?[]:Ve,Le]),Ve=Ut)}else dt.run()};Ye.allowRecurse=!!a;let lt;x==="sync"?lt=Ye:x==="post"?lt=()=>ns(Ye,r&&r.suspense):(Ye.pre=!0,r&&(Ye.id=r.uid),lt=()=>hx(Ye));const dt=new ix(W,Vs,lt),gt=kC(),yt=()=>{dt.stop(),gt&&K0(gt.effects,dt)};return a?d?Ye():Ve=dt.run():x==="post"?ns(dt.run.bind(dt),r&&r.suspense):dt.run(),De&&De.push(yt),yt}function SP(c,a,d){const m=this.proxy,x=mr(c)?c.includes(".")?TM(m,c):()=>m[c]:c.bind(m,m);let T;ji(a)?T=a:(T=a.handler,d=a);const E=Bf(this),P=dx(x,T.bind(m),d);return E(),P}function TM(c,a){const d=a.split(".");return()=>{let m=c;for(let x=0;x<d.length&&m;x++)m=m[d[x]];return m}}function Pc(c,a=1/0,d){if(a<=0||!Bn(c)||c.__v_skip||(d=d||new Set,d.has(c)))return c;if(d.add(c),a--,ls(c))Pc(c.value,a,d);else if(bi(c))for(let m=0;m<c.length;m++)Pc(c[m],a,d);else if(qT(c)||_h(c))c.forEach(m=>{Pc(m,a,d)});else if(ZT(c))for(const m in c)Pc(c[m],a,d);return c}function EP(c,a){if(ss===null)return c;const d=ig(ss)||ss.proxy,m=c.dirs||(c.dirs=[]);for(let x=0;x<a.length;x++){let[T,E,P,r=Dn]=a[x];T&&(ji(T)&&(T={mounted:T,updated:T}),T.deep&&Pc(E),m.push({dir:T,instance:d,value:E,oldValue:void 0,arg:P,modifiers:r}))}return c}function wc(c,a,d,m){const x=c.dirs,T=a&&a.dirs;for(let E=0;E<x.length;E++){const P=x[E];T&&(P.oldValue=T[E].value);let r=P.dir[m];r&&(gl(),co(r,d,8,[c.el,P,c,a]),yl())}}/*! #__NO_SIDE_EFFECTS__ */function MM(c,a){return ji(c)?pr({name:c.name},a,{setup:c}):c}const v_=c=>!!c.type.__asyncLoader,SM=c=>c.type.__isKeepAlive;function AP(c,a){EM(c,"a",a)}function IP(c,a){EM(c,"da",a)}function EM(c,a,d=Br){const m=c.__wdc||(c.__wdc=()=>{let x=d;for(;x;){if(x.isDeactivated)return;x=x.parent}return c()});if(J_(a,m,d),d){let x=d.parent;for(;x&&x.parent;)SM(x.parent.vnode)&&CP(m,a,d,x),x=x.parent}}function CP(c,a,d,m){const x=J_(a,c,m,!0);fx(()=>{K0(m[a],x)},d)}function J_(c,a,d=Br,m=!1){if(d){const x=d[c]||(d[c]=[]),T=a.__weh||(a.__weh=(...E)=>{if(d.isUnmounted)return;gl();const P=Bf(d),r=co(a,d,c,E);return P(),yl(),r});return m?x.unshift(T):x.push(T),T}}const da=c=>(a,d=Br)=>(!tg||c==="sp")&&J_(c,(...m)=>a(...m),d),PP=da("bm"),AM=da("m"),DP=da("bu"),RP=da("u"),zP=da("bum"),fx=da("um"),LP=da("sp"),kP=da("rtg"),OP=da("rtc");function FP(c,a=Br){J_("ec",c,a)}function BP(c,a,d,m){let x;const T=d;if(bi(c)||mr(c)){x=new Array(c.length);for(let E=0,P=c.length;E<P;E++)x[E]=a(c[E],E,void 0,T)}else if(typeof c=="number"){x=new Array(c);for(let E=0;E<c;E++)x[E]=a(E+1,E,void 0,T)}else if(Bn(c))if(c[Symbol.iterator])x=Array.from(c,(E,P)=>a(E,P,void 0,T));else{const E=Object.keys(c);x=new Array(E.length);for(let P=0,r=E.length;P<r;P++){const B=E[P];x[P]=a(c[B],B,P,T)}}else x=[];return x}const D0=c=>c?GM(c)?ig(c)||c.proxy:D0(c.parent):null,vf=pr(Object.create(null),{$:c=>c,$el:c=>c.vnode.el,$data:c=>c.data,$props:c=>c.props,$attrs:c=>c.attrs,$slots:c=>c.slots,$refs:c=>c.refs,$parent:c=>D0(c.parent),$root:c=>D0(c.root),$emit:c=>c.emit,$options:c=>px(c),$forceUpdate:c=>c.f||(c.f=()=>{c.effect.dirty=!0,hx(c.update)}),$nextTick:c=>c.n||(c.n=gM.bind(c.proxy)),$watch:c=>SP.bind(c)}),o0=(c,a)=>c!==Dn&&!c.__isScriptSetup&&on(c,a),NP={get({_:c},a){if(a==="__v_skip")return!0;const{ctx:d,setupState:m,data:x,props:T,accessCache:E,type:P,appContext:r}=c;let B;if(a[0]!=="$"){const fe=E[a];if(fe!==void 0)switch(fe){case 1:return m[a];case 2:return x[a];case 4:return d[a];case 3:return T[a]}else{if(o0(m,a))return E[a]=1,m[a];if(x!==Dn&&on(x,a))return E[a]=2,x[a];if((B=c.propsOptions[0])&&on(B,a))return E[a]=3,T[a];if(d!==Dn&&on(d,a))return E[a]=4,d[a];R0&&(E[a]=0)}}const W=vf[a];let Z,ae;if(W)return a==="$attrs"&&as(c.attrs,"get",""),W(c);if((Z=P.__cssModules)&&(Z=Z[a]))return Z;if(d!==Dn&&on(d,a))return E[a]=4,d[a];if(ae=r.config.globalProperties,on(ae,a))return ae[a]},set({_:c},a,d){const{data:m,setupState:x,ctx:T}=c;return o0(x,a)?(x[a]=d,!0):m!==Dn&&on(m,a)?(m[a]=d,!0):on(c.props,a)||a[0]==="$"&&a.slice(1)in c?!1:(T[a]=d,!0)},has({_:{data:c,setupState:a,accessCache:d,ctx:m,appContext:x,propsOptions:T}},E){let P;return!!d[E]||c!==Dn&&on(c,E)||o0(a,E)||(P=T[0])&&on(P,E)||on(m,E)||on(vf,E)||on(x.config.globalProperties,E)},defineProperty(c,a,d){return d.get!=null?c._.accessCache[a]=0:on(d,"value")&&this.set(c,a,d.value,null),Reflect.defineProperty(c,a,d)}};function R_(c){return bi(c)?c.reduce((a,d)=>(a[d]=null,a),{}):c}function VP(c,a){return!c||!a?c||a:bi(c)&&bi(a)?c.concat(a):pr({},R_(c),R_(a))}let R0=!0;function jP(c){const a=px(c),d=c.proxy,m=c.ctx;R0=!1,a.beforeCreate&&aw(a.beforeCreate,c,"bc");const{data:x,computed:T,methods:E,watch:P,provide:r,inject:B,created:W,beforeMount:Z,mounted:ae,beforeUpdate:fe,updated:Le,activated:De,deactivated:Ve,beforeDestroy:Ye,beforeUnmount:lt,destroyed:dt,unmounted:gt,render:yt,renderTracked:Ut,renderTriggered:Yt,errorCaptured:wi,serverPrefetch:Gi,expose:Qt,inheritAttrs:tn,components:Ui,directives:Un,filters:er}=a;if(B&&UP(B,m,null),E)for(const Ci in E){const Ti=E[Ci];ji(Ti)&&(m[Ci]=Ti.bind(d))}if(x){const Ci=x.call(d,d);Bn(Ci)&&(c.data=Q_(Ci))}if(R0=!0,T)for(const Ci in T){const Ti=T[Ci],Tn=ji(Ti)?Ti.bind(d,d):ji(Ti.get)?Ti.get.bind(d,d):Vs,tr=!ji(Ti)&&ji(Ti.set)?Ti.set.bind(d):Vs,Gn=yD({get:Tn,set:tr});Object.defineProperty(m,Ci,{enumerable:!0,configurable:!0,get:()=>Gn.value,set:Kt=>Gn.value=Kt})}if(P)for(const Ci in P)IM(P[Ci],m,d,Ci);if(r){const Ci=ji(r)?r.call(d):r;Reflect.ownKeys(Ci).forEach(Ti=>{ZP(Ti,Ci[Ti])})}W&&aw(W,c,"c");function qt(Ci,Ti){bi(Ti)?Ti.forEach(Tn=>Ci(Tn.bind(d))):Ti&&Ci(Ti.bind(d))}if(qt(PP,Z),qt(AM,ae),qt(DP,fe),qt(RP,Le),qt(AP,De),qt(IP,Ve),qt(FP,wi),qt(OP,Ut),qt(kP,Yt),qt(zP,lt),qt(fx,gt),qt(LP,Gi),bi(Qt))if(Qt.length){const Ci=c.exposed||(c.exposed={});Qt.forEach(Ti=>{Object.defineProperty(Ci,Ti,{get:()=>d[Ti],set:Tn=>d[Ti]=Tn})})}else c.exposed||(c.exposed={});yt&&c.render===Vs&&(c.render=yt),tn!=null&&(c.inheritAttrs=tn),Ui&&(c.components=Ui),Un&&(c.directives=Un)}function UP(c,a,d=Vs){bi(c)&&(c=z0(c));for(const m in c){const x=c[m];let T;Bn(x)?"default"in x?T=b_(x.from||m,x.default,!0):T=b_(x.from||m):T=b_(x),ls(T)?Object.defineProperty(a,m,{enumerable:!0,configurable:!0,get:()=>T.value,set:E=>T.value=E}):a[m]=T}}function aw(c,a,d){co(bi(c)?c.map(m=>m.bind(a.proxy)):c.bind(a.proxy),a,d)}function IM(c,a,d,m){const x=m.includes(".")?TM(d,m):()=>d[m];if(mr(c)){const T=a[c];ji(T)&&zc(x,T)}else if(ji(c))zc(x,c.bind(d));else if(Bn(c))if(bi(c))c.forEach(T=>IM(T,a,d,m));else{const T=ji(c.handler)?c.handler.bind(d):a[c.handler];ji(T)&&zc(x,T,c)}}function px(c){const a=c.type,{mixins:d,extends:m}=a,{mixins:x,optionsCache:T,config:{optionMergeStrategies:E}}=c.appContext,P=T.get(a);let r;return P?r=P:!x.length&&!d&&!m?r=a:(r={},x.length&&x.forEach(B=>z_(r,B,E,!0)),z_(r,a,E)),Bn(a)&&T.set(a,r),r}function z_(c,a,d,m=!1){const{mixins:x,extends:T}=a;T&&z_(c,T,d,!0),x&&x.forEach(E=>z_(c,E,d,!0));for(const E in a)if(!(m&&E==="expose")){const P=GP[E]||d&&d[E];c[E]=P?P(c[E],a[E]):a[E]}return c}const GP={data:lw,props:cw,emits:cw,methods:hf,computed:hf,beforeCreate:qr,created:qr,beforeMount:qr,mounted:qr,beforeUpdate:qr,updated:qr,beforeDestroy:qr,beforeUnmount:qr,destroyed:qr,unmounted:qr,activated:qr,deactivated:qr,errorCaptured:qr,serverPrefetch:qr,components:hf,directives:hf,watch:qP,provide:lw,inject:$P};function lw(c,a){return a?c?function(){return pr(ji(c)?c.call(this,this):c,ji(a)?a.call(this,this):a)}:a:c}function $P(c,a){return hf(z0(c),z0(a))}function z0(c){if(bi(c)){const a={};for(let d=0;d<c.length;d++)a[c[d]]=c[d];return a}return c}function qr(c,a){return c?[...new Set([].concat(c,a))]:a}function hf(c,a){return c?pr(Object.create(null),c,a):a}function cw(c,a){return c?bi(c)&&bi(a)?[...new Set([...c,...a])]:pr(Object.create(null),R_(c),R_(a??{})):a}function qP(c,a){if(!c)return a;if(!a)return c;const d=pr(Object.create(null),c);for(const m in a)d[m]=qr(c[m],a[m]);return d}function CM(){return{app:null,config:{isNativeTag:wC,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let WP=0;function HP(c,a){return function(m,x=null){ji(m)||(m=pr({},m)),x!=null&&!Bn(x)&&(x=null);const T=CM(),E=new WeakSet;let P=!1;const r=T.app={_uid:WP++,_component:m,_props:x,_container:null,_context:T,_instance:null,version:qM,get config(){return T.config},set config(B){},use(B,...W){return E.has(B)||(B&&ji(B.install)?(E.add(B),B.install(r,...W)):ji(B)&&(E.add(B),B(r,...W))),r},mixin(B){return T.mixins.includes(B)||T.mixins.push(B),r},component(B,W){return W?(T.components[B]=W,r):T.components[B]},directive(B,W){return W?(T.directives[B]=W,r):T.directives[B]},mount(B,W,Z){if(!P){const ae=Qn(m,x);return ae.appContext=T,Z===!0?Z="svg":Z===!1&&(Z=void 0),W&&a?a(ae,B):c(ae,B,Z),P=!0,r._container=B,B.__vue_app__=r,ig(ae.component)||ae.component.proxy}},unmount(){P&&(c(null,r._container),delete r._container.__vue_app__)},provide(B,W){return T.provides[B]=W,r},runWithContext(B){const W=bf;bf=r;try{return B()}finally{bf=W}}};return r}}let bf=null;function ZP(c,a){if(Br){let d=Br.provides;const m=Br.parent&&Br.parent.provides;m===d&&(d=Br.provides=Object.create(m)),d[c]=a}}function b_(c,a,d=!1){const m=Br||ss;if(m||bf){const x=m?m.parent==null?m.vnode.appContext&&m.vnode.appContext.provides:m.parent.provides:bf._context.provides;if(x&&c in x)return x[c];if(arguments.length>1)return d&&ji(a)?a.call(m&&m.proxy):a}}const PM={},DM=()=>Object.create(PM),RM=c=>Object.getPrototypeOf(c)===PM;function QP(c,a,d,m=!1){const x={},T=DM();c.propsDefaults=Object.create(null),zM(c,a,x,T);for(const E in c.propsOptions[0])E in x||(x[E]=void 0);d?c.props=m?x:tP(x):c.type.props?c.props=x:c.props=T,c.attrs=T}function XP(c,a,d,m){const{props:x,attrs:T,vnode:{patchFlag:E}}=c,P=ln(x),[r]=c.propsOptions;let B=!1;if((m||E>0)&&!(E&16)){if(E&8){const W=c.vnode.dynamicProps;for(let Z=0;Z<W.length;Z++){let ae=W[Z];if(K_(c.emitsOptions,ae))continue;const fe=a[ae];if(r)if(on(T,ae))fe!==T[ae]&&(T[ae]=fe,B=!0);else{const Le=Oc(ae);x[Le]=L0(r,P,Le,fe,c,!1)}else fe!==T[ae]&&(T[ae]=fe,B=!0)}}}else{zM(c,a,x,T)&&(B=!0);let W;for(const Z in P)(!a||!on(a,Z)&&((W=Vc(Z))===Z||!on(a,W)))&&(r?d&&(d[Z]!==void 0||d[W]!==void 0)&&(x[Z]=L0(r,P,Z,void 0,c,!0)):delete x[Z]);if(T!==P)for(const Z in T)(!a||!on(a,Z))&&(delete T[Z],B=!0)}B&&ha(c.attrs,"set","")}function zM(c,a,d,m){const[x,T]=c.propsOptions;let E=!1,P;if(a)for(let r in a){if(gf(r))continue;const B=a[r];let W;x&&on(x,W=Oc(r))?!T||!T.includes(W)?d[W]=B:(P||(P={}))[W]=B:K_(c.emitsOptions,r)||(!(r in m)||B!==m[r])&&(m[r]=B,E=!0)}if(T){const r=ln(d),B=P||Dn;for(let W=0;W<T.length;W++){const Z=T[W];d[Z]=L0(x,r,Z,B[Z],c,!on(B,Z))}}return E}function L0(c,a,d,m,x,T){const E=c[d];if(E!=null){const P=on(E,"default");if(P&&m===void 0){const r=E.default;if(E.type!==Function&&!E.skipFactory&&ji(r)){const{propsDefaults:B}=x;if(d in B)m=B[d];else{const W=Bf(x);m=B[d]=r.call(null,a),W()}}else m=r}E[0]&&(T&&!P?m=!1:E[1]&&(m===""||m===Vc(d))&&(m=!0))}return m}function LM(c,a,d=!1){const m=a.propsCache,x=m.get(c);if(x)return x;const T=c.props,E={},P=[];let r=!1;if(!ji(c)){const W=Z=>{r=!0;const[ae,fe]=LM(Z,a,!0);pr(E,ae),fe&&P.push(...fe)};!d&&a.mixins.length&&a.mixins.forEach(W),c.extends&&W(c.extends),c.mixins&&c.mixins.forEach(W)}if(!T&&!r)return Bn(c)&&m.set(c,mh),mh;if(bi(T))for(let W=0;W<T.length;W++){const Z=Oc(T[W]);uw(Z)&&(E[Z]=Dn)}else if(T)for(const W in T){const Z=Oc(W);if(uw(Z)){const ae=T[W],fe=E[Z]=bi(ae)||ji(ae)?{type:ae}:pr({},ae);if(fe){const Le=fw(Boolean,fe.type),De=fw(String,fe.type);fe[0]=Le>-1,fe[1]=De<0||Le<De,(Le>-1||on(fe,"default"))&&P.push(Z)}}}const B=[E,P];return Bn(c)&&m.set(c,B),B}function uw(c){return c[0]!=="$"&&!gf(c)}function hw(c){return c===null?"null":typeof c=="function"?c.name||"":typeof c=="object"&&c.constructor&&c.constructor.name||""}function dw(c,a){return hw(c)===hw(a)}function fw(c,a){return bi(a)?a.findIndex(d=>dw(d,c)):ji(a)&&dw(a,c)?0:-1}const kM=c=>c[0]==="_"||c==="$stable",mx=c=>bi(c)?c.map(Po):[Po(c)],YP=(c,a,d)=>{if(a._n)return a;const m=pP((...x)=>mx(a(...x)),d);return m._c=!1,m},OM=(c,a,d)=>{const m=c._ctx;for(const x in c){if(kM(x))continue;const T=c[x];if(ji(T))a[x]=YP(x,T,m);else if(T!=null){const E=mx(T);a[x]=()=>E}}},FM=(c,a)=>{const d=mx(a);c.slots.default=()=>d},KP=(c,a)=>{const d=c.slots=DM();if(c.vnode.shapeFlag&32){const m=a._;m?(pr(d,a),XT(d,"_",m,!0)):OM(a,d)}else a&&FM(c,a)},JP=(c,a,d)=>{const{vnode:m,slots:x}=c;let T=!0,E=Dn;if(m.shapeFlag&32){const P=a._;P?d&&P===1?T=!1:(pr(x,a),!d&&P===1&&delete x._):(T=!a.$stable,OM(a,x)),E=a}else a&&(FM(c,a),E={default:1});if(T)for(const P in x)!kM(P)&&E[P]==null&&delete x[P]};function k0(c,a,d,m,x=!1){if(bi(c)){c.forEach((ae,fe)=>k0(ae,a&&(bi(a)?a[fe]:a),d,m,x));return}if(v_(m)&&!x)return;const T=m.shapeFlag&4?ig(m.component)||m.component.proxy:m.el,E=x?null:T,{i:P,r}=c,B=a&&a.r,W=P.refs===Dn?P.refs={}:P.refs,Z=P.setupState;if(B!=null&&B!==r&&(mr(B)?(W[B]=null,on(Z,B)&&(Z[B]=null)):ls(B)&&(B.value=null)),ji(r))dl(r,P,12,[E,W]);else{const ae=mr(r),fe=ls(r);if(ae||fe){const Le=()=>{if(c.f){const De=ae?on(Z,r)?Z[r]:W[r]:r.value;x?bi(De)&&K0(De,T):bi(De)?De.includes(T)||De.push(T):ae?(W[r]=[T],on(Z,r)&&(Z[r]=W[r])):(r.value=[T],c.k&&(W[c.k]=r.value))}else ae?(W[r]=E,on(Z,r)&&(Z[r]=E)):fe&&(r.value=E,c.k&&(W[c.k]=E))};E?(Le.id=-1,ns(Le,d)):Le()}}}const ns=bP;function eD(c){return tD(c)}function tD(c,a){const d=YT();d.__VUE__=!0;const{insert:m,remove:x,patchProp:T,createElement:E,createText:P,createComment:r,setText:B,setElementText:W,parentNode:Z,nextSibling:ae,setScopeId:fe=Vs,insertStaticContent:Le}=c,De=(xe,Ee,it,ht=null,nt=null,Dt=null,Je=void 0,qe=null,Lt=!!Ee.dynamicChildren)=>{if(xe===Ee)return;xe&&!rf(xe,Ee)&&(ht=ar(xe),Kt(xe,nt,Dt,!0),xe=null),Ee.patchFlag===-2&&(Lt=!1,Ee.dynamicChildren=null);const{type:ft,ref:Me,shapeFlag:Q}=Ee;switch(ft){case eg:Ve(xe,Ee,it,ht);break;case Fc:Ye(xe,Ee,it,ht);break;case l0:xe==null&&lt(Ee,it,ht,Je);break;case Ms:Ui(xe,Ee,it,ht,nt,Dt,Je,qe,Lt);break;default:Q&1?yt(xe,Ee,it,ht,nt,Dt,Je,qe,Lt):Q&6?Un(xe,Ee,it,ht,nt,Dt,Je,qe,Lt):(Q&64||Q&128)&&ft.process(xe,Ee,it,ht,nt,Dt,Je,qe,Lt,Wi)}Me!=null&&nt&&k0(Me,xe&&xe.ref,Dt,Ee||xe,!Ee)},Ve=(xe,Ee,it,ht)=>{if(xe==null)m(Ee.el=P(Ee.children),it,ht);else{const nt=Ee.el=xe.el;Ee.children!==xe.children&&B(nt,Ee.children)}},Ye=(xe,Ee,it,ht)=>{xe==null?m(Ee.el=r(Ee.children||""),it,ht):Ee.el=xe.el},lt=(xe,Ee,it,ht)=>{[xe.el,xe.anchor]=Le(xe.children,Ee,it,ht,xe.el,xe.anchor)},dt=({el:xe,anchor:Ee},it,ht)=>{let nt;for(;xe&&xe!==Ee;)nt=ae(xe),m(xe,it,ht),xe=nt;m(Ee,it,ht)},gt=({el:xe,anchor:Ee})=>{let it;for(;xe&&xe!==Ee;)it=ae(xe),x(xe),xe=it;x(Ee)},yt=(xe,Ee,it,ht,nt,Dt,Je,qe,Lt)=>{Ee.type==="svg"?Je="svg":Ee.type==="math"&&(Je="mathml"),xe==null?Ut(Ee,it,ht,nt,Dt,Je,qe,Lt):Gi(xe,Ee,nt,Dt,Je,qe,Lt)},Ut=(xe,Ee,it,ht,nt,Dt,Je,qe)=>{let Lt,ft;const{props:Me,shapeFlag:Q,transition:te,dirs:de}=xe;if(Lt=xe.el=E(xe.type,Dt,Me&&Me.is,Me),Q&8?W(Lt,xe.children):Q&16&&wi(xe.children,Lt,null,ht,nt,a0(xe,Dt),Je,qe),de&&wc(xe,null,ht,"created"),Yt(Lt,xe,xe.scopeId,Je,ht),Me){for(const ke in Me)ke!=="value"&&!gf(ke)&&T(Lt,ke,null,Me[ke],Dt,xe.children,ht,nt,Mn);"value"in Me&&T(Lt,"value",null,Me.value,Dt),(ft=Me.onVnodeBeforeMount)&&Eo(ft,ht,xe)}de&&wc(xe,null,ht,"beforeMount");const Ce=iD(nt,te);Ce&&te.beforeEnter(Lt),m(Lt,Ee,it),((ft=Me&&Me.onVnodeMounted)||Ce||de)&&ns(()=>{ft&&Eo(ft,ht,xe),Ce&&te.enter(Lt),de&&wc(xe,null,ht,"mounted")},nt)},Yt=(xe,Ee,it,ht,nt)=>{if(it&&fe(xe,it),ht)for(let Dt=0;Dt<ht.length;Dt++)fe(xe,ht[Dt]);if(nt){let Dt=nt.subTree;if(Ee===Dt){const Je=nt.vnode;Yt(xe,Je,Je.scopeId,Je.slotScopeIds,nt.parent)}}},wi=(xe,Ee,it,ht,nt,Dt,Je,qe,Lt=0)=>{for(let ft=Lt;ft<xe.length;ft++){const Me=xe[ft]=qe?sl(xe[ft]):Po(xe[ft]);De(null,Me,Ee,it,ht,nt,Dt,Je,qe)}},Gi=(xe,Ee,it,ht,nt,Dt,Je)=>{const qe=Ee.el=xe.el;let{patchFlag:Lt,dynamicChildren:ft,dirs:Me}=Ee;Lt|=xe.patchFlag&16;const Q=xe.props||Dn,te=Ee.props||Dn;let de;if(it&&Tc(it,!1),(de=te.onVnodeBeforeUpdate)&&Eo(de,it,Ee,xe),Me&&wc(Ee,xe,it,"beforeUpdate"),it&&Tc(it,!0),ft?Qt(xe.dynamicChildren,ft,qe,it,ht,a0(Ee,nt),Dt):Je||Ti(xe,Ee,qe,null,it,ht,a0(Ee,nt),Dt,!1),Lt>0){if(Lt&16)tn(qe,Ee,Q,te,it,ht,nt);else if(Lt&2&&Q.class!==te.class&&T(qe,"class",null,te.class,nt),Lt&4&&T(qe,"style",Q.style,te.style,nt),Lt&8){const Ce=Ee.dynamicProps;for(let ke=0;ke<Ce.length;ke++){const He=Ce[ke],xt=Q[He],Be=te[He];(Be!==xt||He==="value")&&T(qe,He,xt,Be,nt,xe.children,it,ht,Mn)}}Lt&1&&xe.children!==Ee.children&&W(qe,Ee.children)}else!Je&&ft==null&&tn(qe,Ee,Q,te,it,ht,nt);((de=te.onVnodeUpdated)||Me)&&ns(()=>{de&&Eo(de,it,Ee,xe),Me&&wc(Ee,xe,it,"updated")},ht)},Qt=(xe,Ee,it,ht,nt,Dt,Je)=>{for(let qe=0;qe<Ee.length;qe++){const Lt=xe[qe],ft=Ee[qe],Me=Lt.el&&(Lt.type===Ms||!rf(Lt,ft)||Lt.shapeFlag&70)?Z(Lt.el):it;De(Lt,ft,Me,null,ht,nt,Dt,Je,!0)}},tn=(xe,Ee,it,ht,nt,Dt,Je)=>{if(it!==ht){if(it!==Dn)for(const qe in it)!gf(qe)&&!(qe in ht)&&T(xe,qe,it[qe],null,Je,Ee.children,nt,Dt,Mn);for(const qe in ht){if(gf(qe))continue;const Lt=ht[qe],ft=it[qe];Lt!==ft&&qe!=="value"&&T(xe,qe,ft,Lt,Je,Ee.children,nt,Dt,Mn)}"value"in ht&&T(xe,"value",it.value,ht.value,Je)}},Ui=(xe,Ee,it,ht,nt,Dt,Je,qe,Lt)=>{const ft=Ee.el=xe?xe.el:P(""),Me=Ee.anchor=xe?xe.anchor:P("");let{patchFlag:Q,dynamicChildren:te,slotScopeIds:de}=Ee;de&&(qe=qe?qe.concat(de):de),xe==null?(m(ft,it,ht),m(Me,it,ht),wi(Ee.children||[],it,Me,nt,Dt,Je,qe,Lt)):Q>0&&Q&64&&te&&xe.dynamicChildren?(Qt(xe.dynamicChildren,te,it,nt,Dt,Je,qe),(Ee.key!=null||nt&&Ee===nt.subTree)&&BM(xe,Ee,!0)):Ti(xe,Ee,it,Me,nt,Dt,Je,qe,Lt)},Un=(xe,Ee,it,ht,nt,Dt,Je,qe,Lt)=>{Ee.slotScopeIds=qe,xe==null?Ee.shapeFlag&512?nt.ctx.activate(Ee,it,ht,Je,Lt):er(Ee,it,ht,nt,Dt,Je,Lt):Ri(xe,Ee,Lt)},er=(xe,Ee,it,ht,nt,Dt,Je)=>{const qe=xe.component=hD(xe,ht,nt);if(SM(xe)&&(qe.ctx.renderer=Wi),fD(qe),qe.asyncDep){if(nt&&nt.registerDep(qe,qt),!xe.el){const Lt=qe.subTree=Qn(Fc);Ye(null,Lt,Ee,it)}}else qt(qe,xe,Ee,it,nt,Dt,Je)},Ri=(xe,Ee,it)=>{const ht=Ee.component=xe.component;if(gP(xe,Ee,it))if(ht.asyncDep&&!ht.asyncResolved){Ci(ht,Ee,it);return}else ht.next=Ee,uP(ht.update),ht.effect.dirty=!0,ht.update();else Ee.el=xe.el,ht.vnode=Ee},qt=(xe,Ee,it,ht,nt,Dt,Je)=>{const qe=()=>{if(xe.isMounted){let{next:Me,bu:Q,u:te,parent:de,vnode:Ce}=xe;{const bt=NM(xe);if(bt){Me&&(Me.el=Ce.el,Ci(xe,Me,Je)),bt.asyncDep.then(()=>{xe.isUnmounted||qe()});return}}let ke=Me,He;Tc(xe,!1),Me?(Me.el=Ce.el,Ci(xe,Me,Je)):Me=Ce,Q&&x_(Q),(He=Me.props&&Me.props.onVnodeBeforeUpdate)&&Eo(He,de,Me,Ce),Tc(xe,!0);const xt=s0(xe),Be=xe.subTree;xe.subTree=xt,De(Be,xt,Z(Be.el),ar(Be),xe,nt,Dt),Me.el=xt.el,ke===null&&yP(xe,xt.el),te&&ns(te,nt),(He=Me.props&&Me.props.onVnodeUpdated)&&ns(()=>Eo(He,de,Me,Ce),nt)}else{let Me;const{el:Q,props:te}=Ee,{bm:de,m:Ce,parent:ke}=xe,He=v_(Ee);if(Tc(xe,!1),de&&x_(de),!He&&(Me=te&&te.onVnodeBeforeMount)&&Eo(Me,ke,Ee),Tc(xe,!0),Q&&js){const xt=()=>{xe.subTree=s0(xe),js(Q,xe.subTree,xe,nt,null)};He?Ee.type.__asyncLoader().then(()=>!xe.isUnmounted&&xt()):xt()}else{const xt=xe.subTree=s0(xe);De(null,xt,it,ht,xe,nt,Dt),Ee.el=xt.el}if(Ce&&ns(Ce,nt),!He&&(Me=te&&te.onVnodeMounted)){const xt=Ee;ns(()=>Eo(Me,ke,xt),nt)}(Ee.shapeFlag&256||ke&&v_(ke.vnode)&&ke.vnode.shapeFlag&256)&&xe.a&&ns(xe.a,nt),xe.isMounted=!0,Ee=it=ht=null}},Lt=xe.effect=new ix(qe,Vs,()=>hx(ft),xe.scope),ft=xe.update=()=>{Lt.dirty&&Lt.run()};ft.id=xe.uid,Tc(xe,!0),ft()},Ci=(xe,Ee,it)=>{Ee.component=xe;const ht=xe.vnode.props;xe.vnode=Ee,xe.next=null,XP(xe,Ee.props,ht,it),JP(xe,Ee.children,it),gl(),sw(xe),yl()},Ti=(xe,Ee,it,ht,nt,Dt,Je,qe,Lt=!1)=>{const ft=xe&&xe.children,Me=xe?xe.shapeFlag:0,Q=Ee.children,{patchFlag:te,shapeFlag:de}=Ee;if(te>0){if(te&128){tr(ft,Q,it,ht,nt,Dt,Je,qe,Lt);return}else if(te&256){Tn(ft,Q,it,ht,nt,Dt,Je,qe,Lt);return}}de&8?(Me&16&&Mn(ft,nt,Dt),Q!==ft&&W(it,Q)):Me&16?de&16?tr(ft,Q,it,ht,nt,Dt,Je,qe,Lt):Mn(ft,nt,Dt,!0):(Me&8&&W(it,""),de&16&&wi(Q,it,ht,nt,Dt,Je,qe,Lt))},Tn=(xe,Ee,it,ht,nt,Dt,Je,qe,Lt)=>{xe=xe||mh,Ee=Ee||mh;const ft=xe.length,Me=Ee.length,Q=Math.min(ft,Me);let te;for(te=0;te<Q;te++){const de=Ee[te]=Lt?sl(Ee[te]):Po(Ee[te]);De(xe[te],de,it,null,nt,Dt,Je,qe,Lt)}ft>Me?Mn(xe,nt,Dt,!0,!1,Q):wi(Ee,it,ht,nt,Dt,Je,qe,Lt,Q)},tr=(xe,Ee,it,ht,nt,Dt,Je,qe,Lt)=>{let ft=0;const Me=Ee.length;let Q=xe.length-1,te=Me-1;for(;ft<=Q&&ft<=te;){const de=xe[ft],Ce=Ee[ft]=Lt?sl(Ee[ft]):Po(Ee[ft]);if(rf(de,Ce))De(de,Ce,it,null,nt,Dt,Je,qe,Lt);else break;ft++}for(;ft<=Q&&ft<=te;){const de=xe[Q],Ce=Ee[te]=Lt?sl(Ee[te]):Po(Ee[te]);if(rf(de,Ce))De(de,Ce,it,null,nt,Dt,Je,qe,Lt);else break;Q--,te--}if(ft>Q){if(ft<=te){const de=te+1,Ce=de<Me?Ee[de].el:ht;for(;ft<=te;)De(null,Ee[ft]=Lt?sl(Ee[ft]):Po(Ee[ft]),it,Ce,nt,Dt,Je,qe,Lt),ft++}}else if(ft>te)for(;ft<=Q;)Kt(xe[ft],nt,Dt,!0),ft++;else{const de=ft,Ce=ft,ke=new Map;for(ft=Ce;ft<=te;ft++){const fi=Ee[ft]=Lt?sl(Ee[ft]):Po(Ee[ft]);fi.key!=null&&ke.set(fi.key,ft)}let He,xt=0;const Be=te-Ce+1;let bt=!1,Et=0;const Rt=new Array(Be);for(ft=0;ft<Be;ft++)Rt[ft]=0;for(ft=de;ft<=Q;ft++){const fi=xe[ft];if(xt>=Be){Kt(fi,nt,Dt,!0);continue}let li;if(fi.key!=null)li=ke.get(fi.key);else for(He=Ce;He<=te;He++)if(Rt[He-Ce]===0&&rf(fi,Ee[He])){li=He;break}li===void 0?Kt(fi,nt,Dt,!0):(Rt[li-Ce]=ft+1,li>=Et?Et=li:bt=!0,De(fi,Ee[li],it,null,nt,Dt,Je,qe,Lt),xt++)}const _t=bt?nD(Rt):mh;for(He=_t.length-1,ft=Be-1;ft>=0;ft--){const fi=Ce+ft,li=Ee[fi],Bi=fi+1<Me?Ee[fi+1].el:ht;Rt[ft]===0?De(null,li,it,Bi,nt,Dt,Je,qe,Lt):bt&&(He<0||ft!==_t[He]?Gn(li,it,Bi,2):He--)}}},Gn=(xe,Ee,it,ht,nt=null)=>{const{el:Dt,type:Je,transition:qe,children:Lt,shapeFlag:ft}=xe;if(ft&6){Gn(xe.component.subTree,Ee,it,ht);return}if(ft&128){xe.suspense.move(Ee,it,ht);return}if(ft&64){Je.move(xe,Ee,it,Wi);return}if(Je===Ms){m(Dt,Ee,it);for(let Q=0;Q<Lt.length;Q++)Gn(Lt[Q],Ee,it,ht);m(xe.anchor,Ee,it);return}if(Je===l0){dt(xe,Ee,it);return}if(ht!==2&&ft&1&&qe)if(ht===0)qe.beforeEnter(Dt),m(Dt,Ee,it),ns(()=>qe.enter(Dt),nt);else{const{leave:Q,delayLeave:te,afterLeave:de}=qe,Ce=()=>m(Dt,Ee,it),ke=()=>{Q(Dt,()=>{Ce(),de&&de()})};te?te(Dt,Ce,ke):ke()}else m(Dt,Ee,it)},Kt=(xe,Ee,it,ht=!1,nt=!1)=>{const{type:Dt,props:Je,ref:qe,children:Lt,dynamicChildren:ft,shapeFlag:Me,patchFlag:Q,dirs:te}=xe;if(qe!=null&&k0(qe,null,it,xe,!0),Me&256){Ee.ctx.deactivate(xe);return}const de=Me&1&&te,Ce=!v_(xe);let ke;if(Ce&&(ke=Je&&Je.onVnodeBeforeUnmount)&&Eo(ke,Ee,xe),Me&6)Cr(xe.component,it,ht);else{if(Me&128){xe.suspense.unmount(it,ht);return}de&&wc(xe,null,Ee,"beforeUnmount"),Me&64?xe.type.remove(xe,Ee,it,nt,Wi,ht):ft&&(Dt!==Ms||Q>0&&Q&64)?Mn(ft,Ee,it,!1,!0):(Dt===Ms&&Q&384||!nt&&Me&16)&&Mn(Lt,Ee,it),ht&&wr(xe)}(Ce&&(ke=Je&&Je.onVnodeUnmounted)||de)&&ns(()=>{ke&&Eo(ke,Ee,xe),de&&wc(xe,null,Ee,"unmounted")},it)},wr=xe=>{const{type:Ee,el:it,anchor:ht,transition:nt}=xe;if(Ee===Ms){vn(it,ht);return}if(Ee===l0){gt(xe);return}const Dt=()=>{x(it),nt&&!nt.persisted&&nt.afterLeave&&nt.afterLeave()};if(xe.shapeFlag&1&&nt&&!nt.persisted){const{leave:Je,delayLeave:qe}=nt,Lt=()=>Je(it,Dt);qe?qe(xe.el,Dt,Lt):Lt()}else Dt()},vn=(xe,Ee)=>{let it;for(;xe!==Ee;)it=ae(xe),x(xe),xe=it;x(Ee)},Cr=(xe,Ee,it)=>{const{bum:ht,scope:nt,update:Dt,subTree:Je,um:qe}=xe;ht&&x_(ht),nt.stop(),Dt&&(Dt.active=!1,Kt(Je,xe,Ee,it)),qe&&ns(qe,Ee),ns(()=>{xe.isUnmounted=!0},Ee),Ee&&Ee.pendingBranch&&!Ee.isUnmounted&&xe.asyncDep&&!xe.asyncResolved&&xe.suspenseId===Ee.pendingId&&(Ee.deps--,Ee.deps===0&&Ee.resolve())},Mn=(xe,Ee,it,ht=!1,nt=!1,Dt=0)=>{for(let Je=Dt;Je<xe.length;Je++)Kt(xe[Je],Ee,it,ht,nt)},ar=xe=>xe.shapeFlag&6?ar(xe.component.subTree):xe.shapeFlag&128?xe.suspense.next():ae(xe.anchor||xe.el);let Nt=!1;const Es=(xe,Ee,it)=>{xe==null?Ee._vnode&&Kt(Ee._vnode,null,null,!0):De(Ee._vnode||null,xe,Ee,null,null,null,it),Nt||(Nt=!0,sw(),xM(),Nt=!1),Ee._vnode=xe},Wi={p:De,um:Kt,m:Gn,r:wr,mt:er,mc:wi,pc:Ti,pbc:Qt,n:ar,o:c};let uo,js;return{render:Es,hydrate:uo,createApp:HP(Es,uo)}}function a0({type:c,props:a},d){return d==="svg"&&c==="foreignObject"||d==="mathml"&&c==="annotation-xml"&&a&&a.encoding&&a.encoding.includes("html")?void 0:d}function Tc({effect:c,update:a},d){c.allowRecurse=a.allowRecurse=d}function iD(c,a){return(!c||c&&!c.pendingBranch)&&a&&!a.persisted}function BM(c,a,d=!1){const m=c.children,x=a.children;if(bi(m)&&bi(x))for(let T=0;T<m.length;T++){const E=m[T];let P=x[T];P.shapeFlag&1&&!P.dynamicChildren&&((P.patchFlag<=0||P.patchFlag===32)&&(P=x[T]=sl(x[T]),P.el=E.el),d||BM(E,P)),P.type===eg&&(P.el=E.el)}}function nD(c){const a=c.slice(),d=[0];let m,x,T,E,P;const r=c.length;for(m=0;m<r;m++){const B=c[m];if(B!==0){if(x=d[d.length-1],c[x]<B){a[m]=x,d.push(m);continue}for(T=0,E=d.length-1;T<E;)P=T+E>>1,c[d[P]]<B?T=P+1:E=P;B<c[d[T]]&&(T>0&&(a[m]=d[T-1]),d[T]=m)}}for(T=d.length,E=d[T-1];T-- >0;)d[T]=E,E=a[E];return d}function NM(c){const a=c.subTree.component;if(a)return a.asyncDep&&!a.asyncResolved?a:NM(a)}const rD=c=>c.__isTeleport,Ms=Symbol.for("v-fgt"),eg=Symbol.for("v-txt"),Fc=Symbol.for("v-cmt"),l0=Symbol.for("v-stc"),wf=[];let oo=null;function Ns(c=!1){wf.push(oo=c?null:[])}function sD(){wf.pop(),oo=wf[wf.length-1]||null}let Df=1;function pw(c){Df+=c}function VM(c){return c.dynamicChildren=Df>0?oo||mh:null,sD(),Df>0&&oo&&oo.push(c),c}function zo(c,a,d,m,x,T){return VM(Wr(c,a,d,m,x,T,!0))}function jM(c,a,d,m,x){return VM(Qn(c,a,d,m,x,!0))}function O0(c){return c?c.__v_isVNode===!0:!1}function rf(c,a){return c.type===a.type&&c.key===a.key}const UM=({key:c})=>c??null,w_=({ref:c,ref_key:a,ref_for:d})=>(typeof c=="number"&&(c=""+c),c!=null?mr(c)||ls(c)||ji(c)?{i:ss,r:c,k:a,f:!!d}:c:null);function Wr(c,a=null,d=null,m=0,x=null,T=c===Ms?0:1,E=!1,P=!1){const r={__v_isVNode:!0,__v_skip:!0,type:c,props:a,key:a&&UM(a),ref:a&&w_(a),scopeId:wM,slotScopeIds:null,children:d,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:T,patchFlag:m,dynamicProps:x,dynamicChildren:null,appContext:null,ctx:ss};return P?(_x(r,d),T&128&&c.normalize(r)):d&&(r.shapeFlag|=mr(d)?8:16),Df>0&&!E&&oo&&(r.patchFlag>0||T&6)&&r.patchFlag!==32&&oo.push(r),r}const Qn=oD;function oD(c,a=null,d=null,m=0,x=null,T=!1){if((!c||c===xP)&&(c=Fc),O0(c)){const P=vh(c,a,!0);return d&&_x(P,d),Df>0&&!T&&oo&&(P.shapeFlag&6?oo[oo.indexOf(c)]=P:oo.push(P)),P.patchFlag|=-2,P}if(gD(c)&&(c=c.__vccOpts),a){a=aD(a);let{class:P,style:r}=a;P&&!mr(P)&&(a.class=tx(P)),Bn(r)&&(X_(r)&&!bi(r)&&(r=pr({},r)),a.style=ex(r))}const E=mr(c)?1:vP(c)?128:rD(c)?64:Bn(c)?4:ji(c)?2:0;return Wr(c,a,d,m,x,E,T,!0)}function aD(c){return c?X_(c)||RM(c)?pr({},c):c:null}function vh(c,a,d=!1,m=!1){const{props:x,ref:T,patchFlag:E,children:P,transition:r}=c,B=a?lD(x||{},a):x,W={__v_isVNode:!0,__v_skip:!0,type:c.type,props:B,key:B&&UM(B),ref:a&&a.ref?d&&T?bi(T)?T.concat(w_(a)):[T,w_(a)]:w_(a):T,scopeId:c.scopeId,slotScopeIds:c.slotScopeIds,children:P,target:c.target,targetAnchor:c.targetAnchor,staticCount:c.staticCount,shapeFlag:c.shapeFlag,patchFlag:a&&c.type!==Ms?E===-1?16:E|16:E,dynamicProps:c.dynamicProps,dynamicChildren:c.dynamicChildren,appContext:c.appContext,dirs:c.dirs,transition:r,component:c.component,suspense:c.suspense,ssContent:c.ssContent&&vh(c.ssContent),ssFallback:c.ssFallback&&vh(c.ssFallback),el:c.el,anchor:c.anchor,ctx:c.ctx,ce:c.ce};return r&&m&&(W.transition=r.clone(W)),W}function df(c=" ",a=0){return Qn(eg,null,c,a)}function c0(c="",a=!1){return a?(Ns(),jM(Fc,null,c)):Qn(Fc,null,c)}function Po(c){return c==null||typeof c=="boolean"?Qn(Fc):bi(c)?Qn(Ms,null,c.slice()):typeof c=="object"?sl(c):Qn(eg,null,String(c))}function sl(c){return c.el===null&&c.patchFlag!==-1||c.memo?c:vh(c)}function _x(c,a){let d=0;const{shapeFlag:m}=c;if(a==null)a=null;else if(bi(a))d=16;else if(typeof a=="object")if(m&65){const x=a.default;x&&(x._c&&(x._d=!1),_x(c,x()),x._c&&(x._d=!0));return}else{d=32;const x=a._;!x&&!RM(a)?a._ctx=ss:x===3&&ss&&(ss.slots._===1?a._=1:(a._=2,c.patchFlag|=1024))}else ji(a)?(a={default:a,_ctx:ss},d=32):(a=String(a),m&64?(d=16,a=[df(a)]):d=8);c.children=a,c.shapeFlag|=d}function lD(...c){const a={};for(let d=0;d<c.length;d++){const m=c[d];for(const x in m)if(x==="class")a.class!==m.class&&(a.class=tx([a.class,m.class]));else if(x==="style")a.style=ex([a.style,m.style]);else if(q_(x)){const T=a[x],E=m[x];E&&T!==E&&!(bi(T)&&T.includes(E))&&(a[x]=T?[].concat(T,E):E)}else x!==""&&(a[x]=m[x])}return a}function Eo(c,a,d,m=null){co(c,a,7,[d,m])}const cD=CM();let uD=0;function hD(c,a,d){const m=c.type,x=(a?a.appContext:c.appContext)||cD,T={uid:uD++,vnode:c,type:m,parent:a,appContext:x,root:null,next:null,subTree:null,effect:null,update:null,scope:new zC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:a?a.provides:Object.create(x.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:LM(m,x),emitsOptions:bM(m,x),emit:null,emitted:null,propsDefaults:Dn,inheritAttrs:m.inheritAttrs,ctx:Dn,data:Dn,props:Dn,attrs:Dn,slots:Dn,refs:Dn,setupState:Dn,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:d,suspenseId:d?d.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return T.ctx={_:T},T.root=a?a.root:T,T.emit=fP.bind(null,T),c.ce&&c.ce(T),T}let Br=null;const dD=()=>Br||ss;let L_,F0;{const c=YT(),a=(d,m)=>{let x;return(x=c[d])||(x=c[d]=[]),x.push(m),T=>{x.length>1?x.forEach(E=>E(T)):x[0](T)}};L_=a("__VUE_INSTANCE_SETTERS__",d=>Br=d),F0=a("__VUE_SSR_SETTERS__",d=>tg=d)}const Bf=c=>{const a=Br;return L_(c),c.scope.on(),()=>{c.scope.off(),L_(a)}},mw=()=>{Br&&Br.scope.off(),L_(null)};function GM(c){return c.vnode.shapeFlag&4}let tg=!1;function fD(c,a=!1){a&&F0(a);const{props:d,children:m}=c.vnode,x=GM(c);QP(c,d,x,a),KP(c,m);const T=x?pD(c,a):void 0;return a&&F0(!1),T}function pD(c,a){const d=c.type;c.accessCache=Object.create(null),c.proxy=new Proxy(c.ctx,NP);const{setup:m}=d;if(m){const x=c.setupContext=m.length>1?_D(c):null,T=Bf(c);gl();const E=dl(m,c,0,[c.props,x]);if(yl(),T(),WT(E)){if(E.then(mw,mw),a)return E.then(P=>{_w(c,P,a)}).catch(P=>{Y_(P,c,0)});c.asyncDep=E}else _w(c,E,a)}else $M(c,a)}function _w(c,a,d){ji(a)?c.type.__ssrInlineRender?c.ssrRender=a:c.render=a:Bn(a)&&(c.setupState=mM(a)),$M(c,d)}let gw;function $M(c,a,d){const m=c.type;if(!c.render){if(!a&&gw&&!m.render){const x=m.template||px(c).template;if(x){const{isCustomElement:T,compilerOptions:E}=c.appContext.config,{delimiters:P,compilerOptions:r}=m,B=pr(pr({isCustomElement:T,delimiters:P},E),r);m.render=gw(x,B)}}c.render=m.render||Vs}{const x=Bf(c);gl();try{jP(c)}finally{yl(),x()}}}const mD={get(c,a){return as(c,"get",""),c[a]}};function _D(c){const a=d=>{c.exposed=d||{}};return{attrs:new Proxy(c.attrs,mD),slots:c.slots,emit:c.emit,expose:a}}function ig(c){if(c.exposed)return c.exposeProxy||(c.exposeProxy=new Proxy(mM(iP(c.exposed)),{get(a,d){if(d in a)return a[d];if(d in vf)return vf[d](c)},has(a,d){return d in a||d in vf}}))}function gD(c){return ji(c)&&"__vccOpts"in c}const yD=(c,a)=>nP(c,a,tg);function xD(c,a,d=Dn){const m=dD(),x=Oc(a),T=Vc(a),E=aP((r,B)=>{let W;return MP(()=>{const Z=c[a];Lo(W,Z)&&(W=Z,B())}),{get(){return r(),d.get?d.get(W):W},set(Z){const ae=m.vnode.props;!(ae&&(a in ae||x in ae||T in ae)&&(`onUpdate:${a}`in ae||`onUpdate:${x}`in ae||`onUpdate:${T}`in ae))&&Lo(Z,W)&&(W=Z,B()),m.emit(`update:${a}`,d.set?d.set(Z):Z)}}}),P="modelModifiers";return E[Symbol.iterator]=()=>{let r=0;return{next(){return r<2?{value:r++?c[P]||{}:E,done:!1}:{done:!0}}}},E}function B0(c,a,d){const m=arguments.length;return m===2?Bn(a)&&!bi(a)?O0(a)?Qn(c,null,[a]):Qn(c,a):Qn(c,null,a):(m>3?d=Array.prototype.slice.call(arguments,2):m===3&&O0(d)&&(d=[d]),Qn(c,a,d))}const qM="3.4.27";/**
* @vue/runtime-dom v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const vD="http://www.w3.org/2000/svg",bD="http://www.w3.org/1998/Math/MathML",ol=typeof document<"u"?document:null,yw=ol&&ol.createElement("template"),wD={insert:(c,a,d)=>{a.insertBefore(c,d||null)},remove:c=>{const a=c.parentNode;a&&a.removeChild(c)},createElement:(c,a,d,m)=>{const x=a==="svg"?ol.createElementNS(vD,c):a==="mathml"?ol.createElementNS(bD,c):ol.createElement(c,d?{is:d}:void 0);return c==="select"&&m&&m.multiple!=null&&x.setAttribute("multiple",m.multiple),x},createText:c=>ol.createTextNode(c),createComment:c=>ol.createComment(c),setText:(c,a)=>{c.nodeValue=a},setElementText:(c,a)=>{c.textContent=a},parentNode:c=>c.parentNode,nextSibling:c=>c.nextSibling,querySelector:c=>ol.querySelector(c),setScopeId(c,a){c.setAttribute(a,"")},insertStaticContent(c,a,d,m,x,T){const E=d?d.previousSibling:a.lastChild;if(x&&(x===T||x.nextSibling))for(;a.insertBefore(x.cloneNode(!0),d),!(x===T||!(x=x.nextSibling)););else{yw.innerHTML=m==="svg"?`<svg>${c}</svg>`:m==="mathml"?`<math>${c}</math>`:c;const P=yw.content;if(m==="svg"||m==="mathml"){const r=P.firstChild;for(;r.firstChild;)P.appendChild(r.firstChild);P.removeChild(r)}a.insertBefore(P,d)}return[E?E.nextSibling:a.firstChild,d?d.previousSibling:a.lastChild]}},TD=Symbol("_vtc");function MD(c,a,d){const m=c[TD];m&&(a=(a?[a,...m]:[...m]).join(" ")),a==null?c.removeAttribute("class"):d?c.setAttribute("class",a):c.className=a}const xw=Symbol("_vod"),SD=Symbol("_vsh"),ED=Symbol(""),AD=/(^|;)\s*display\s*:/;function ID(c,a,d){const m=c.style,x=mr(d);let T=!1;if(d&&!x){if(a)if(mr(a))for(const E of a.split(";")){const P=E.slice(0,E.indexOf(":")).trim();d[P]==null&&T_(m,P,"")}else for(const E in a)d[E]==null&&T_(m,E,"");for(const E in d)E==="display"&&(T=!0),T_(m,E,d[E])}else if(x){if(a!==d){const E=m[ED];E&&(d+=";"+E),m.cssText=d,T=AD.test(d)}}else a&&c.removeAttribute("style");xw in c&&(c[xw]=T?m.display:"",c[SD]&&(m.display="none"))}const vw=/\s*!important$/;function T_(c,a,d){if(bi(d))d.forEach(m=>T_(c,a,m));else if(d==null&&(d=""),a.startsWith("--"))c.setProperty(a,d);else{const m=CD(c,a);vw.test(d)?c.setProperty(Vc(m),d.replace(vw,""),"important"):c[m]=d}}const bw=["Webkit","Moz","ms"],u0={};function CD(c,a){const d=u0[a];if(d)return d;let m=Oc(a);if(m!=="filter"&&m in c)return u0[a]=m;m=QT(m);for(let x=0;x<bw.length;x++){const T=bw[x]+m;if(T in c)return u0[a]=T}return a}const ww="http://www.w3.org/1999/xlink";function PD(c,a,d,m,x){if(m&&a.startsWith("xlink:"))d==null?c.removeAttributeNS(ww,a.slice(6,a.length)):c.setAttributeNS(ww,a,d);else{const T=RC(a);d==null||T&&!KT(d)?c.removeAttribute(a):c.setAttribute(a,T?"":d)}}function DD(c,a,d,m,x,T,E){if(a==="innerHTML"||a==="textContent"){m&&E(m,x,T),c[a]=d??"";return}const P=c.tagName;if(a==="value"&&P!=="PROGRESS"&&!P.includes("-")){const B=P==="OPTION"?c.getAttribute("value")||"":c.value,W=d??"";(B!==W||!("_value"in c))&&(c.value=W),d==null&&c.removeAttribute(a),c._value=d;return}let r=!1;if(d===""||d==null){const B=typeof c[a];B==="boolean"?d=KT(d):d==null&&B==="string"?(d="",r=!0):B==="number"&&(d=0,r=!0)}try{c[a]=d}catch{}r&&c.removeAttribute(a)}function fh(c,a,d,m){c.addEventListener(a,d,m)}function RD(c,a,d,m){c.removeEventListener(a,d,m)}const Tw=Symbol("_vei");function zD(c,a,d,m,x=null){const T=c[Tw]||(c[Tw]={}),E=T[a];if(m&&E)E.value=m;else{const[P,r]=LD(a);if(m){const B=T[a]=FD(m,x);fh(c,P,B,r)}else E&&(RD(c,P,E,r),T[a]=void 0)}}const Mw=/(?:Once|Passive|Capture)$/;function LD(c){let a;if(Mw.test(c)){a={};let m;for(;m=c.match(Mw);)c=c.slice(0,c.length-m[0].length),a[m[0].toLowerCase()]=!0}return[c[2]===":"?c.slice(3):Vc(c.slice(2)),a]}let h0=0;const kD=Promise.resolve(),OD=()=>h0||(kD.then(()=>h0=0),h0=Date.now());function FD(c,a){const d=m=>{if(!m._vts)m._vts=Date.now();else if(m._vts<=d.attached)return;co(BD(m,d.value),a,5,[m])};return d.value=c,d.attached=OD(),d}function BD(c,a){if(bi(a)){const d=c.stopImmediatePropagation;return c.stopImmediatePropagation=()=>{d.call(c),c._stopped=!0},a.map(m=>x=>!x._stopped&&m&&m(x))}else return a}const Sw=c=>c.charCodeAt(0)===111&&c.charCodeAt(1)===110&&c.charCodeAt(2)>96&&c.charCodeAt(2)<123,ND=(c,a,d,m,x,T,E,P,r)=>{const B=x==="svg";a==="class"?MD(c,m,B):a==="style"?ID(c,d,m):q_(a)?Y0(a)||zD(c,a,d,m,E):(a[0]==="."?(a=a.slice(1),!0):a[0]==="^"?(a=a.slice(1),!1):VD(c,a,m,B))?DD(c,a,m,T,E,P,r):(a==="true-value"?c._trueValue=m:a==="false-value"&&(c._falseValue=m),PD(c,a,m,B))};function VD(c,a,d,m){if(m)return!!(a==="innerHTML"||a==="textContent"||a in c&&Sw(a)&&ji(d));if(a==="spellcheck"||a==="draggable"||a==="translate"||a==="form"||a==="list"&&c.tagName==="INPUT"||a==="type"&&c.tagName==="TEXTAREA")return!1;if(a==="width"||a==="height"){const x=c.tagName;if(x==="IMG"||x==="VIDEO"||x==="CANVAS"||x==="SOURCE")return!1}return Sw(a)&&mr(d)?!1:a in c}const Ew=c=>{const a=c.props["onUpdate:modelValue"]||!1;return bi(a)?d=>x_(a,d):a};function jD(c){c.target.composing=!0}function Aw(c){const a=c.target;a.composing&&(a.composing=!1,a.dispatchEvent(new Event("input")))}const d0=Symbol("_assign"),UD={created(c,{modifiers:{lazy:a,trim:d,number:m}},x){c[d0]=Ew(x);const T=m||x.props&&x.props.type==="number";fh(c,a?"change":"input",E=>{if(E.target.composing)return;let P=c.value;d&&(P=P.trim()),T&&(P=S0(P)),c[d0](P)}),d&&fh(c,"change",()=>{c.value=c.value.trim()}),a||(fh(c,"compositionstart",jD),fh(c,"compositionend",Aw),fh(c,"change",Aw))},mounted(c,{value:a}){c.value=a??""},beforeUpdate(c,{value:a,modifiers:{lazy:d,trim:m,number:x}},T){if(c[d0]=Ew(T),c.composing)return;const E=(x||c.type==="number")&&!/^0\d/.test(c.value)?S0(c.value):c.value,P=a??"";E!==P&&(document.activeElement===c&&c.type!=="range"&&(d||m&&c.value.trim()===P)||(c.value=P))}},GD=pr({patchProp:ND},wD);let Iw;function $D(){return Iw||(Iw=eD(GD))}const qD=(...c)=>{const a=$D().createApp(...c),{mount:d}=a;return a.mount=m=>{const x=HD(m);if(!x)return;const T=a._component;!ji(T)&&!T.render&&!T.template&&(T.template=x.innerHTML),x.innerHTML="";const E=d(x,!1,WD(x));return x instanceof Element&&(x.removeAttribute("v-cloak"),x.setAttribute("data-v-app","")),E},a};function WD(c){if(c instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&c instanceof MathMLElement)return"mathml"}function HD(c){return mr(c)?document.querySelector(c):c}var ZD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function QD(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var WM={exports:{}};(function(c,a){var d={};(function(m,x){c.exports=x()})(ZD,function(){var m,x,T;function E(r,B){if(!m)m=B;else if(!x)x=B;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+m+")(sharedChunk); ("+x+")(sharedChunk); self.onerror = null;",Z={};m(Z),T=B(Z),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(T.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}E(["exports"],function(r){var B="3.4.0";let W;const Z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(W==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{W=d.API_URL_REGEX!=null?new RegExp(d.API_URL_REGEX):t}catch{W=t}}return W},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Z.API_URL)return null;try{const t=new URL(Z.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function ae(t){return Z.API_URL_REGEX.test(t)}function fe(t){return t.indexOf("mapbox:")===0}function Le(t){return Z.API_CDN_URL_REGEX.test(t)}function De(t){return Z.API_SPRITE_REGEX.test(t)}function Ve(t){return Z.API_STYLE_REGEX.test(t)&&!De(t)}const Ye={create:"create",load:"load",fullLoad:"fullLoad"};function lt(t){const e=t.name.split("?")[0];return Le(e)&&e.includes("mapbox-gl.js")?"javascript":Le(e)&&e.includes("mapbox-gl.css")?"css":function(i){return Z.API_FONTS_REGEX.test(i)}(e)?"fontRange":De(e)?"sprite":Ve(e)?"style":function(i){return Z.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function dt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gt={},yt={};Object.defineProperty(yt,"__esModule",{value:!0}),yt.setMatrixArrayType=function(t){yt.ARRAY_TYPE=Yt=t},yt.toRadian=function(t){return t*Gi},yt.equals=function(t,e){return Math.abs(t-e)<=Ut*Math.max(1,Math.abs(t),Math.abs(e))},yt.RANDOM=yt.ARRAY_TYPE=yt.EPSILON=void 0;var Ut=1e-6;yt.EPSILON=Ut;var Yt=typeof Float32Array<"u"?Float32Array:Array;yt.ARRAY_TYPE=Yt;var wi=Math.random;yt.RANDOM=wi;var Gi=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Qt={};function tn(t){return tn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(t)}Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=function(){var t=new Ui.ARRAY_TYPE(4);return Ui.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Qt.clone=function(t){var e=new Ui.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Qt.fromValues=function(t,e,i,s){var l=new Ui.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=i,l[3]=s,l},Qt.set=function(t,e,i,s,l){return t[0]=e,t[1]=i,t[2]=s,t[3]=l,t},Qt.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Qt.invert=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=i*u-l*s;return p?(t[0]=u*(p=1/p),t[1]=-s*p,t[2]=-l*p,t[3]=i*p,t):null},Qt.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Qt.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Qt.multiply=er,Qt.rotate=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=Math.sin(i),v=Math.cos(i);return t[0]=s*v+u*g,t[1]=l*v+p*g,t[2]=s*-g+u*v,t[3]=l*-g+p*v,t},Qt.scale=function(t,e,i){var s=e[1],l=e[2],u=e[3],p=i[0],g=i[1];return t[0]=e[0]*p,t[1]=s*p,t[2]=l*g,t[3]=u*g,t},Qt.fromRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=-i,t[3]=s,t},Qt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Qt.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Qt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Qt.LDU=function(t,e,i,s){return t[2]=s[2]/s[0],i[0]=s[0],i[1]=s[1],i[3]=s[3]-t[2]*i[1],[t,e,i]},Qt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Qt.subtract=Ri,Qt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Qt.equals=function(t,e){var i=t[0],s=t[1],l=t[2],u=t[3],p=e[0],g=e[1],v=e[2],w=e[3];return Math.abs(i-p)<=Ui.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-g)<=Ui.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-v)<=Ui.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-w)<=Ui.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))},Qt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Qt.multiplyScalarAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t},Qt.sub=Qt.mul=void 0;var Ui=function(t,e){if(t&&t.__esModule)return t;if(t===null||tn(t)!=="object"&&typeof t!="function")return{default:t};var i=Un(void 0);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}(yt);function Un(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Un=function(s){return s?i:e})(t)}function er(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=i[0],v=i[1],w=i[2],S=i[3];return t[0]=s*g+u*v,t[1]=l*g+p*v,t[2]=s*w+u*S,t[3]=l*w+p*S,t}function Ri(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Qt.mul=er,Qt.sub=Ri;var qt={};function Ci(t){return Ci=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ci(t)}Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=function(){var t=new Ti.ARRAY_TYPE(6);return Ti.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},qt.clone=function(t){var e=new Ti.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},qt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},qt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},qt.fromValues=function(t,e,i,s,l,u){var p=new Ti.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=i,p[3]=s,p[4]=l,p[5]=u,p},qt.set=function(t,e,i,s,l,u,p){return t[0]=e,t[1]=i,t[2]=s,t[3]=l,t[4]=u,t[5]=p,t},qt.invert=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=i*u-s*l;return v?(t[0]=u*(v=1/v),t[1]=-s*v,t[2]=-l*v,t[3]=i*v,t[4]=(l*g-u*p)*v,t[5]=(s*p-i*g)*v,t):null},qt.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},qt.multiply=tr,qt.rotate=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=Math.sin(i),S=Math.cos(i);return t[0]=s*S+u*w,t[1]=l*S+p*w,t[2]=s*-w+u*S,t[3]=l*-w+p*S,t[4]=g,t[5]=v,t},qt.scale=function(t,e,i){var s=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=i[0],w=i[1];return t[0]=e[0]*v,t[1]=s*v,t[2]=l*w,t[3]=u*w,t[4]=p,t[5]=g,t},qt.translate=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=i[0],S=i[1];return t[0]=s,t[1]=l,t[2]=u,t[3]=p,t[4]=s*w+u*S+g,t[5]=l*w+p*S+v,t},qt.fromRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=-i,t[3]=s,t[4]=0,t[5]=0,t},qt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},qt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},qt.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},qt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},qt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},qt.subtract=Gn,qt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},qt.multiplyScalarAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t[4]=e[4]+i[4]*s,t[5]=e[5]+i[5]*s,t},qt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},qt.equals=function(t,e){var i=t[0],s=t[1],l=t[2],u=t[3],p=t[4],g=t[5],v=e[0],w=e[1],S=e[2],A=e[3],C=e[4],R=e[5];return Math.abs(i-v)<=Ti.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(s-w)<=Ti.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-S)<=Ti.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(u-A)<=Ti.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(p-C)<=Ti.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-R)<=Ti.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))},qt.sub=qt.mul=void 0;var Ti=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ci(t)!=="object"&&typeof t!="function")return{default:t};var i=Tn(void 0);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}(yt);function Tn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Tn=function(s){return s?i:e})(t)}function tr(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=i[0],S=i[1],A=i[2],C=i[3],R=i[4],L=i[5];return t[0]=s*w+u*S,t[1]=l*w+p*S,t[2]=s*A+u*C,t[3]=l*A+p*C,t[4]=s*R+u*L+g,t[5]=l*R+p*L+v,t}function Gn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}qt.mul=tr,qt.sub=Gn;var Kt={};function wr(t){return wr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wr(t)}Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.create=function(){var t=new vn.ARRAY_TYPE(9);return vn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Kt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Kt.clone=function(t){var e=new vn.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Kt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Kt.fromValues=function(t,e,i,s,l,u,p,g,v){var w=new vn.ARRAY_TYPE(9);return w[0]=t,w[1]=e,w[2]=i,w[3]=s,w[4]=l,w[5]=u,w[6]=p,w[7]=g,w[8]=v,w},Kt.set=function(t,e,i,s,l,u,p,g,v,w){return t[0]=e,t[1]=i,t[2]=s,t[3]=l,t[4]=u,t[5]=p,t[6]=g,t[7]=v,t[8]=w,t},Kt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Kt.transpose=function(t,e){if(t===e){var i=e[1],s=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=s,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Kt.invert=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],w=e[7],S=e[8],A=S*p-g*w,C=-S*u+g*v,R=w*u-p*v,L=i*A+s*C+l*R;return L?(t[0]=A*(L=1/L),t[1]=(-S*s+l*w)*L,t[2]=(g*s-l*p)*L,t[3]=C*L,t[4]=(S*i-l*v)*L,t[5]=(-g*i+l*u)*L,t[6]=R*L,t[7]=(-w*i+s*v)*L,t[8]=(p*i-s*u)*L,t):null},Kt.adjoint=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],w=e[7],S=e[8];return t[0]=p*S-g*w,t[1]=l*w-s*S,t[2]=s*g-l*p,t[3]=g*v-u*S,t[4]=i*S-l*v,t[5]=l*u-i*g,t[6]=u*w-p*v,t[7]=s*v-i*w,t[8]=i*p-s*u,t},Kt.determinant=function(t){var e=t[3],i=t[4],s=t[5],l=t[6],u=t[7],p=t[8];return t[0]*(p*i-s*u)+t[1]*(-p*e+s*l)+t[2]*(u*e-i*l)},Kt.multiply=Mn,Kt.translate=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=e[8],C=i[0],R=i[1];return t[0]=s,t[1]=l,t[2]=u,t[3]=p,t[4]=g,t[5]=v,t[6]=C*s+R*p+w,t[7]=C*l+R*g+S,t[8]=C*u+R*v+A,t},Kt.rotate=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=e[8],C=Math.sin(i),R=Math.cos(i);return t[0]=R*s+C*p,t[1]=R*l+C*g,t[2]=R*u+C*v,t[3]=R*p-C*s,t[4]=R*g-C*l,t[5]=R*v-C*u,t[6]=w,t[7]=S,t[8]=A,t},Kt.scale=function(t,e,i){var s=i[0],l=i[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=l*e[3],t[4]=l*e[4],t[5]=l*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Kt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Kt.fromRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=0,t[3]=-i,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Kt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Kt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Kt.fromQuat=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=i+i,g=s+s,v=l+l,w=i*p,S=s*p,A=s*g,C=l*p,R=l*g,L=l*v,O=u*p,V=u*g,j=u*v;return t[0]=1-A-L,t[3]=S-j,t[6]=C+V,t[1]=S+j,t[4]=1-w-L,t[7]=R-O,t[2]=C-V,t[5]=R+O,t[8]=1-w-A,t},Kt.normalFromMat4=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],w=e[7],S=e[8],A=e[9],C=e[10],R=e[11],L=e[12],O=e[13],V=e[14],j=e[15],X=i*g-s*p,ee=i*v-l*p,K=i*w-u*p,le=s*v-l*g,ie=s*w-u*g,ue=l*w-u*v,pe=S*O-A*L,ve=S*V-C*L,Re=S*j-R*L,we=A*V-C*O,Fe=A*j-R*O,Oe=C*j-R*V,ze=X*Oe-ee*Fe+K*we+le*Re-ie*ve+ue*pe;return ze?(t[0]=(g*Oe-v*Fe+w*we)*(ze=1/ze),t[1]=(v*Re-p*Oe-w*ve)*ze,t[2]=(p*Fe-g*Re+w*pe)*ze,t[3]=(l*Fe-s*Oe-u*we)*ze,t[4]=(i*Oe-l*Re+u*ve)*ze,t[5]=(s*Re-i*Fe-u*pe)*ze,t[6]=(O*ue-V*ie+j*le)*ze,t[7]=(V*K-L*ue-j*ee)*ze,t[8]=(L*ie-O*K+j*X)*ze,t):null},Kt.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Kt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Kt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Kt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},Kt.subtract=ar,Kt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},Kt.multiplyScalarAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t[4]=e[4]+i[4]*s,t[5]=e[5]+i[5]*s,t[6]=e[6]+i[6]*s,t[7]=e[7]+i[7]*s,t[8]=e[8]+i[8]*s,t},Kt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Kt.equals=function(t,e){var i=t[0],s=t[1],l=t[2],u=t[3],p=t[4],g=t[5],v=t[6],w=t[7],S=t[8],A=e[0],C=e[1],R=e[2],L=e[3],O=e[4],V=e[5],j=e[6],X=e[7],ee=e[8];return Math.abs(i-A)<=vn.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(s-C)<=vn.EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(l-R)<=vn.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(u-L)<=vn.EPSILON*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(p-O)<=vn.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(g-V)<=vn.EPSILON*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(v-j)<=vn.EPSILON*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(w-X)<=vn.EPSILON*Math.max(1,Math.abs(w),Math.abs(X))&&Math.abs(S-ee)<=vn.EPSILON*Math.max(1,Math.abs(S),Math.abs(ee))},Kt.sub=Kt.mul=void 0;var vn=function(t,e){if(t&&t.__esModule)return t;if(t===null||wr(t)!=="object"&&typeof t!="function")return{default:t};var i=Cr(void 0);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}(yt);function Cr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Cr=function(s){return s?i:e})(t)}function Mn(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=e[8],C=i[0],R=i[1],L=i[2],O=i[3],V=i[4],j=i[5],X=i[6],ee=i[7],K=i[8];return t[0]=C*s+R*p+L*w,t[1]=C*l+R*g+L*S,t[2]=C*u+R*v+L*A,t[3]=O*s+V*p+j*w,t[4]=O*l+V*g+j*S,t[5]=O*u+V*v+j*A,t[6]=X*s+ee*p+K*w,t[7]=X*l+ee*g+K*S,t[8]=X*u+ee*v+K*A,t}function ar(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}Kt.mul=Mn,Kt.sub=ar;var Nt={};function Es(t){return Es=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Es(t)}Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.create=function(){var t=new Wi.ARRAY_TYPE(16);return Wi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Nt.clone=function(t){var e=new Wi.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Nt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Nt.fromValues=function(t,e,i,s,l,u,p,g,v,w,S,A,C,R,L,O){var V=new Wi.ARRAY_TYPE(16);return V[0]=t,V[1]=e,V[2]=i,V[3]=s,V[4]=l,V[5]=u,V[6]=p,V[7]=g,V[8]=v,V[9]=w,V[10]=S,V[11]=A,V[12]=C,V[13]=R,V[14]=L,V[15]=O,V},Nt.set=function(t,e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V){return t[0]=e,t[1]=i,t[2]=s,t[3]=l,t[4]=u,t[5]=p,t[6]=g,t[7]=v,t[8]=w,t[9]=S,t[10]=A,t[11]=C,t[12]=R,t[13]=L,t[14]=O,t[15]=V,t},Nt.identity=js,Nt.transpose=function(t,e){if(t===e){var i=e[1],s=e[2],l=e[3],u=e[6],p=e[7],g=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=u,t[11]=e[14],t[12]=l,t[13]=p,t[14]=g}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Nt.invert=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],w=e[7],S=e[8],A=e[9],C=e[10],R=e[11],L=e[12],O=e[13],V=e[14],j=e[15],X=i*g-s*p,ee=i*v-l*p,K=i*w-u*p,le=s*v-l*g,ie=s*w-u*g,ue=l*w-u*v,pe=S*O-A*L,ve=S*V-C*L,Re=S*j-R*L,we=A*V-C*O,Fe=A*j-R*O,Oe=C*j-R*V,ze=X*Oe-ee*Fe+K*we+le*Re-ie*ve+ue*pe;return ze?(t[0]=(g*Oe-v*Fe+w*we)*(ze=1/ze),t[1]=(l*Fe-s*Oe-u*we)*ze,t[2]=(O*ue-V*ie+j*le)*ze,t[3]=(C*ie-A*ue-R*le)*ze,t[4]=(v*Re-p*Oe-w*ve)*ze,t[5]=(i*Oe-l*Re+u*ve)*ze,t[6]=(V*K-L*ue-j*ee)*ze,t[7]=(S*ue-C*K+R*ee)*ze,t[8]=(p*Fe-g*Re+w*pe)*ze,t[9]=(s*Re-i*Fe-u*pe)*ze,t[10]=(L*ie-O*K+j*X)*ze,t[11]=(A*K-S*ie-R*X)*ze,t[12]=(g*ve-p*we-v*pe)*ze,t[13]=(i*we-s*ve+l*pe)*ze,t[14]=(O*ee-L*le-V*X)*ze,t[15]=(S*le-A*ee+C*X)*ze,t):null},Nt.adjoint=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],w=e[7],S=e[8],A=e[9],C=e[10],R=e[11],L=e[12],O=e[13],V=e[14],j=e[15];return t[0]=g*(C*j-R*V)-A*(v*j-w*V)+O*(v*R-w*C),t[1]=-(s*(C*j-R*V)-A*(l*j-u*V)+O*(l*R-u*C)),t[2]=s*(v*j-w*V)-g*(l*j-u*V)+O*(l*w-u*v),t[3]=-(s*(v*R-w*C)-g*(l*R-u*C)+A*(l*w-u*v)),t[4]=-(p*(C*j-R*V)-S*(v*j-w*V)+L*(v*R-w*C)),t[5]=i*(C*j-R*V)-S*(l*j-u*V)+L*(l*R-u*C),t[6]=-(i*(v*j-w*V)-p*(l*j-u*V)+L*(l*w-u*v)),t[7]=i*(v*R-w*C)-p*(l*R-u*C)+S*(l*w-u*v),t[8]=p*(A*j-R*O)-S*(g*j-w*O)+L*(g*R-w*A),t[9]=-(i*(A*j-R*O)-S*(s*j-u*O)+L*(s*R-u*A)),t[10]=i*(g*j-w*O)-p*(s*j-u*O)+L*(s*w-u*g),t[11]=-(i*(g*R-w*A)-p*(s*R-u*A)+S*(s*w-u*g)),t[12]=-(p*(A*V-C*O)-S*(g*V-v*O)+L*(g*C-v*A)),t[13]=i*(A*V-C*O)-S*(s*V-l*O)+L*(s*C-l*A),t[14]=-(i*(g*V-v*O)-p*(s*V-l*O)+L*(s*v-l*g)),t[15]=i*(g*C-v*A)-p*(s*C-l*A)+S*(s*v-l*g),t},Nt.determinant=function(t){var e=t[0],i=t[1],s=t[2],l=t[3],u=t[4],p=t[5],g=t[6],v=t[7],w=t[8],S=t[9],A=t[10],C=t[11],R=t[12],L=t[13],O=t[14],V=t[15];return(e*p-i*u)*(A*V-C*O)-(e*g-s*u)*(S*V-C*L)+(e*v-l*u)*(S*O-A*L)+(i*g-s*p)*(w*V-C*R)-(i*v-l*p)*(w*O-A*R)+(s*v-l*g)*(w*L-S*R)},Nt.multiply=xe,Nt.translate=function(t,e,i){var s,l,u,p,g,v,w,S,A,C,R,L,O=i[0],V=i[1],j=i[2];return e===t?(t[12]=e[0]*O+e[4]*V+e[8]*j+e[12],t[13]=e[1]*O+e[5]*V+e[9]*j+e[13],t[14]=e[2]*O+e[6]*V+e[10]*j+e[14],t[15]=e[3]*O+e[7]*V+e[11]*j+e[15]):(l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=e[8],C=e[9],R=e[10],L=e[11],t[0]=s=e[0],t[1]=l,t[2]=u,t[3]=p,t[4]=g,t[5]=v,t[6]=w,t[7]=S,t[8]=A,t[9]=C,t[10]=R,t[11]=L,t[12]=s*O+g*V+A*j+e[12],t[13]=l*O+v*V+C*j+e[13],t[14]=u*O+w*V+R*j+e[14],t[15]=p*O+S*V+L*j+e[15]),t},Nt.scale=function(t,e,i){var s=i[0],l=i[1],u=i[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Nt.rotate=function(t,e,i,s){var l,u,p,g,v,w,S,A,C,R,L,O,V,j,X,ee,K,le,ie,ue,pe,ve,Re,we,Fe=s[0],Oe=s[1],ze=s[2],We=Math.hypot(Fe,Oe,ze);return We<Wi.EPSILON?null:(Fe*=We=1/We,Oe*=We,ze*=We,l=Math.sin(i),u=Math.cos(i),v=e[1],w=e[2],S=e[3],C=e[5],R=e[6],L=e[7],V=e[9],j=e[10],X=e[11],ee=Fe*Fe*(p=1-u)+u,ie=Fe*Oe*p-ze*l,ue=Oe*Oe*p+u,pe=ze*Oe*p+Fe*l,ve=Fe*ze*p+Oe*l,Re=Oe*ze*p-Fe*l,we=ze*ze*p+u,t[0]=(g=e[0])*ee+(A=e[4])*(K=Oe*Fe*p+ze*l)+(O=e[8])*(le=ze*Fe*p-Oe*l),t[1]=v*ee+C*K+V*le,t[2]=w*ee+R*K+j*le,t[3]=S*ee+L*K+X*le,t[4]=g*ie+A*ue+O*pe,t[5]=v*ie+C*ue+V*pe,t[6]=w*ie+R*ue+j*pe,t[7]=S*ie+L*ue+X*pe,t[8]=g*ve+A*Re+O*we,t[9]=v*ve+C*Re+V*we,t[10]=w*ve+R*Re+j*we,t[11]=S*ve+L*Re+X*we,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Nt.rotateX=function(t,e,i){var s=Math.sin(i),l=Math.cos(i),u=e[4],p=e[5],g=e[6],v=e[7],w=e[8],S=e[9],A=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*l+w*s,t[5]=p*l+S*s,t[6]=g*l+A*s,t[7]=v*l+C*s,t[8]=w*l-u*s,t[9]=S*l-p*s,t[10]=A*l-g*s,t[11]=C*l-v*s,t},Nt.rotateY=function(t,e,i){var s=Math.sin(i),l=Math.cos(i),u=e[0],p=e[1],g=e[2],v=e[3],w=e[8],S=e[9],A=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l-w*s,t[1]=p*l-S*s,t[2]=g*l-A*s,t[3]=v*l-C*s,t[8]=u*s+w*l,t[9]=p*s+S*l,t[10]=g*s+A*l,t[11]=v*s+C*l,t},Nt.rotateZ=function(t,e,i){var s=Math.sin(i),l=Math.cos(i),u=e[0],p=e[1],g=e[2],v=e[3],w=e[4],S=e[5],A=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l+w*s,t[1]=p*l+S*s,t[2]=g*l+A*s,t[3]=v*l+C*s,t[4]=w*l-u*s,t[5]=S*l-p*s,t[6]=A*l-g*s,t[7]=C*l-v*s,t},Nt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Nt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Nt.fromRotation=function(t,e,i){var s,l,u,p=i[0],g=i[1],v=i[2],w=Math.hypot(p,g,v);return w<Wi.EPSILON?null:(p*=w=1/w,g*=w,v*=w,s=Math.sin(e),l=Math.cos(e),t[0]=p*p*(u=1-l)+l,t[1]=g*p*u+v*s,t[2]=v*p*u-g*s,t[3]=0,t[4]=p*g*u-v*s,t[5]=g*g*u+l,t[6]=v*g*u+p*s,t[7]=0,t[8]=p*v*u+g*s,t[9]=g*v*u-p*s,t[10]=v*v*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Nt.fromXRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Nt.fromYRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Nt.fromZRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Nt.fromRotationTranslation=Ee,Nt.fromQuat2=function(t,e){var i=new Wi.ARRAY_TYPE(3),s=-e[0],l=-e[1],u=-e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=s*s+l*l+u*u+p*p;return A>0?(i[0]=2*(g*p+S*s+v*u-w*l)/A,i[1]=2*(v*p+S*l+w*s-g*u)/A,i[2]=2*(w*p+S*u+g*l-v*s)/A):(i[0]=2*(g*p+S*s+v*u-w*l),i[1]=2*(v*p+S*l+w*s-g*u),i[2]=2*(w*p+S*u+g*l-v*s)),Ee(t,e,i),t},Nt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Nt.getScaling=it,Nt.getRotation=function(t,e){var i=new Wi.ARRAY_TYPE(3);it(i,e);var s=1/i[0],l=1/i[1],u=1/i[2],p=e[0]*s,g=e[1]*l,v=e[2]*u,w=e[4]*s,S=e[5]*l,A=e[6]*u,C=e[8]*s,R=e[9]*l,L=e[10]*u,O=p+S+L,V=0;return O>0?(V=2*Math.sqrt(O+1),t[3]=.25*V,t[0]=(A-R)/V,t[1]=(C-v)/V,t[2]=(g-w)/V):p>S&&p>L?(V=2*Math.sqrt(1+p-S-L),t[3]=(A-R)/V,t[0]=.25*V,t[1]=(g+w)/V,t[2]=(C+v)/V):S>L?(V=2*Math.sqrt(1+S-p-L),t[3]=(C-v)/V,t[0]=(g+w)/V,t[1]=.25*V,t[2]=(A+R)/V):(V=2*Math.sqrt(1+L-p-S),t[3]=(g-w)/V,t[0]=(C+v)/V,t[1]=(A+R)/V,t[2]=.25*V),t},Nt.fromRotationTranslationScale=function(t,e,i,s){var l=e[0],u=e[1],p=e[2],g=e[3],v=l+l,w=u+u,S=p+p,A=l*v,C=l*w,R=l*S,L=u*w,O=u*S,V=p*S,j=g*v,X=g*w,ee=g*S,K=s[0],le=s[1],ie=s[2];return t[0]=(1-(L+V))*K,t[1]=(C+ee)*K,t[2]=(R-X)*K,t[3]=0,t[4]=(C-ee)*le,t[5]=(1-(A+V))*le,t[6]=(O+j)*le,t[7]=0,t[8]=(R+X)*ie,t[9]=(O-j)*ie,t[10]=(1-(A+L))*ie,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Nt.fromRotationTranslationScaleOrigin=function(t,e,i,s,l){var u=e[0],p=e[1],g=e[2],v=e[3],w=u+u,S=p+p,A=g+g,C=u*w,R=u*S,L=u*A,O=p*S,V=p*A,j=g*A,X=v*w,ee=v*S,K=v*A,le=s[0],ie=s[1],ue=s[2],pe=l[0],ve=l[1],Re=l[2],we=(1-(O+j))*le,Fe=(R+K)*le,Oe=(L-ee)*le,ze=(R-K)*ie,We=(1-(C+j))*ie,$e=(V+X)*ie,Xe=(L+ee)*ue,Qe=(V-X)*ue,Ne=(1-(C+O))*ue;return t[0]=we,t[1]=Fe,t[2]=Oe,t[3]=0,t[4]=ze,t[5]=We,t[6]=$e,t[7]=0,t[8]=Xe,t[9]=Qe,t[10]=Ne,t[11]=0,t[12]=i[0]+pe-(we*pe+ze*ve+Xe*Re),t[13]=i[1]+ve-(Fe*pe+We*ve+Qe*Re),t[14]=i[2]+Re-(Oe*pe+$e*ve+Ne*Re),t[15]=1,t},Nt.fromQuat=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=i+i,g=s+s,v=l+l,w=i*p,S=s*p,A=s*g,C=l*p,R=l*g,L=l*v,O=u*p,V=u*g,j=u*v;return t[0]=1-A-L,t[1]=S+j,t[2]=C-V,t[3]=0,t[4]=S-j,t[5]=1-w-L,t[6]=R+O,t[7]=0,t[8]=C+V,t[9]=R-O,t[10]=1-w-A,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Nt.frustum=function(t,e,i,s,l,u,p){var g=1/(i-e),v=1/(l-s),w=1/(u-p);return t[0]=2*u*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*v,t[6]=0,t[7]=0,t[8]=(i+e)*g,t[9]=(l+s)*v,t[10]=(p+u)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*u*2*w,t[15]=0,t},Nt.perspectiveNO=ht,Nt.perspectiveZO=function(t,e,i,s,l){var u,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=l*(u=1/(s-l)),t[14]=l*s*u):(t[10]=-1,t[14]=-s),t},Nt.perspectiveFromFieldOfView=function(t,e,i,s){var l=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),g=Math.tan(e.rightDegrees*Math.PI/180),v=2/(p+g),w=2/(l+u);return t[0]=v,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=-(p-g)*v*.5,t[9]=(l-u)*w*.5,t[10]=s/(i-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*i/(i-s),t[15]=0,t},Nt.orthoNO=nt,Nt.orthoZO=function(t,e,i,s,l,u,p){var g=1/(e-i),v=1/(s-l),w=1/(u-p);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=w,t[11]=0,t[12]=(e+i)*g,t[13]=(l+s)*v,t[14]=u*w,t[15]=1,t},Nt.lookAt=function(t,e,i,s){var l,u,p,g,v,w,S,A,C,R,L=e[0],O=e[1],V=e[2],j=s[0],X=s[1],ee=s[2],K=i[0],le=i[1],ie=i[2];return Math.abs(L-K)<Wi.EPSILON&&Math.abs(O-le)<Wi.EPSILON&&Math.abs(V-ie)<Wi.EPSILON?js(t):(S=L-K,A=O-le,C=V-ie,l=X*(C*=R=1/Math.hypot(S,A,C))-ee*(A*=R),u=ee*(S*=R)-j*C,p=j*A-X*S,(R=Math.hypot(l,u,p))?(l*=R=1/R,u*=R,p*=R):(l=0,u=0,p=0),g=A*p-C*u,v=C*l-S*p,w=S*u-A*l,(R=Math.hypot(g,v,w))?(g*=R=1/R,v*=R,w*=R):(g=0,v=0,w=0),t[0]=l,t[1]=g,t[2]=S,t[3]=0,t[4]=u,t[5]=v,t[6]=A,t[7]=0,t[8]=p,t[9]=w,t[10]=C,t[11]=0,t[12]=-(l*L+u*O+p*V),t[13]=-(g*L+v*O+w*V),t[14]=-(S*L+A*O+C*V),t[15]=1,t)},Nt.targetTo=function(t,e,i,s){var l=e[0],u=e[1],p=e[2],g=s[0],v=s[1],w=s[2],S=l-i[0],A=u-i[1],C=p-i[2],R=S*S+A*A+C*C;R>0&&(S*=R=1/Math.sqrt(R),A*=R,C*=R);var L=v*C-w*A,O=w*S-g*C,V=g*A-v*S;return(R=L*L+O*O+V*V)>0&&(L*=R=1/Math.sqrt(R),O*=R,V*=R),t[0]=L,t[1]=O,t[2]=V,t[3]=0,t[4]=A*V-C*O,t[5]=C*L-S*V,t[6]=S*O-A*L,t[7]=0,t[8]=S,t[9]=A,t[10]=C,t[11]=0,t[12]=l,t[13]=u,t[14]=p,t[15]=1,t},Nt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Nt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Nt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},Nt.subtract=Dt,Nt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},Nt.multiplyScalarAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t[4]=e[4]+i[4]*s,t[5]=e[5]+i[5]*s,t[6]=e[6]+i[6]*s,t[7]=e[7]+i[7]*s,t[8]=e[8]+i[8]*s,t[9]=e[9]+i[9]*s,t[10]=e[10]+i[10]*s,t[11]=e[11]+i[11]*s,t[12]=e[12]+i[12]*s,t[13]=e[13]+i[13]*s,t[14]=e[14]+i[14]*s,t[15]=e[15]+i[15]*s,t},Nt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Nt.equals=function(t,e){var i=t[0],s=t[1],l=t[2],u=t[3],p=t[4],g=t[5],v=t[6],w=t[7],S=t[8],A=t[9],C=t[10],R=t[11],L=t[12],O=t[13],V=t[14],j=t[15],X=e[0],ee=e[1],K=e[2],le=e[3],ie=e[4],ue=e[5],pe=e[6],ve=e[7],Re=e[8],we=e[9],Fe=e[10],Oe=e[11],ze=e[12],We=e[13],$e=e[14],Xe=e[15];return Math.abs(i-X)<=Wi.EPSILON*Math.max(1,Math.abs(i),Math.abs(X))&&Math.abs(s-ee)<=Wi.EPSILON*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(l-K)<=Wi.EPSILON*Math.max(1,Math.abs(l),Math.abs(K))&&Math.abs(u-le)<=Wi.EPSILON*Math.max(1,Math.abs(u),Math.abs(le))&&Math.abs(p-ie)<=Wi.EPSILON*Math.max(1,Math.abs(p),Math.abs(ie))&&Math.abs(g-ue)<=Wi.EPSILON*Math.max(1,Math.abs(g),Math.abs(ue))&&Math.abs(v-pe)<=Wi.EPSILON*Math.max(1,Math.abs(v),Math.abs(pe))&&Math.abs(w-ve)<=Wi.EPSILON*Math.max(1,Math.abs(w),Math.abs(ve))&&Math.abs(S-Re)<=Wi.EPSILON*Math.max(1,Math.abs(S),Math.abs(Re))&&Math.abs(A-we)<=Wi.EPSILON*Math.max(1,Math.abs(A),Math.abs(we))&&Math.abs(C-Fe)<=Wi.EPSILON*Math.max(1,Math.abs(C),Math.abs(Fe))&&Math.abs(R-Oe)<=Wi.EPSILON*Math.max(1,Math.abs(R),Math.abs(Oe))&&Math.abs(L-ze)<=Wi.EPSILON*Math.max(1,Math.abs(L),Math.abs(ze))&&Math.abs(O-We)<=Wi.EPSILON*Math.max(1,Math.abs(O),Math.abs(We))&&Math.abs(V-$e)<=Wi.EPSILON*Math.max(1,Math.abs(V),Math.abs($e))&&Math.abs(j-Xe)<=Wi.EPSILON*Math.max(1,Math.abs(j),Math.abs(Xe))},Nt.sub=Nt.mul=Nt.ortho=Nt.perspective=void 0;var Wi=function(t,e){if(t&&t.__esModule)return t;if(t===null||Es(t)!=="object"&&typeof t!="function")return{default:t};var i=uo(void 0);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}(yt);function uo(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(uo=function(s){return s?i:e})(t)}function js(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xe(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=e[8],C=e[9],R=e[10],L=e[11],O=e[12],V=e[13],j=e[14],X=e[15],ee=i[0],K=i[1],le=i[2],ie=i[3];return t[0]=ee*s+K*g+le*A+ie*O,t[1]=ee*l+K*v+le*C+ie*V,t[2]=ee*u+K*w+le*R+ie*j,t[3]=ee*p+K*S+le*L+ie*X,t[4]=(ee=i[4])*s+(K=i[5])*g+(le=i[6])*A+(ie=i[7])*O,t[5]=ee*l+K*v+le*C+ie*V,t[6]=ee*u+K*w+le*R+ie*j,t[7]=ee*p+K*S+le*L+ie*X,t[8]=(ee=i[8])*s+(K=i[9])*g+(le=i[10])*A+(ie=i[11])*O,t[9]=ee*l+K*v+le*C+ie*V,t[10]=ee*u+K*w+le*R+ie*j,t[11]=ee*p+K*S+le*L+ie*X,t[12]=(ee=i[12])*s+(K=i[13])*g+(le=i[14])*A+(ie=i[15])*O,t[13]=ee*l+K*v+le*C+ie*V,t[14]=ee*u+K*w+le*R+ie*j,t[15]=ee*p+K*S+le*L+ie*X,t}function Ee(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=s+s,v=l+l,w=u+u,S=s*g,A=s*v,C=s*w,R=l*v,L=l*w,O=u*w,V=p*g,j=p*v,X=p*w;return t[0]=1-(R+O),t[1]=A+X,t[2]=C-j,t[3]=0,t[4]=A-X,t[5]=1-(S+O),t[6]=L+V,t[7]=0,t[8]=C+j,t[9]=L-V,t[10]=1-(S+R),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function it(t,e){var i=e[4],s=e[5],l=e[6],u=e[8],p=e[9],g=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,s,l),t[2]=Math.hypot(u,p,g),t}function ht(t,e,i,s,l){var u,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+s)*(u=1/(s-l)),t[14]=2*l*s*u):(t[10]=-1,t[14]=-2*s),t}function nt(t,e,i,s,l,u,p){var g=1/(e-i),v=1/(s-l),w=1/(u-p);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+i)*g,t[13]=(l+s)*v,t[14]=(p+u)*w,t[15]=1,t}function Dt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Nt.perspective=ht,Nt.ortho=nt,Nt.mul=xe,Nt.sub=Dt;var Je={},qe={};function Lt(t){return Lt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lt(t)}Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=Q,qe.clone=function(t){var e=new ft.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},qe.length=te,qe.fromValues=function(t,e,i){var s=new ft.ARRAY_TYPE(3);return s[0]=t,s[1]=e,s[2]=i,s},qe.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},qe.set=function(t,e,i,s){return t[0]=e,t[1]=i,t[2]=s,t},qe.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},qe.subtract=de,qe.multiply=Ce,qe.divide=ke,qe.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},qe.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},qe.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},qe.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},qe.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},qe.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},qe.scaleAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t},qe.distance=He,qe.squaredDistance=xt,qe.squaredLength=Be,qe.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},qe.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},qe.normalize=function(t,e){var i=e[0],s=e[1],l=e[2],u=i*i+s*s+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},qe.dot=bt,qe.cross=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=i[0],g=i[1],v=i[2];return t[0]=l*v-u*g,t[1]=u*p-s*v,t[2]=s*g-l*p,t},qe.lerp=function(t,e,i,s){var l=e[0],u=e[1],p=e[2];return t[0]=l+s*(i[0]-l),t[1]=u+s*(i[1]-u),t[2]=p+s*(i[2]-p),t},qe.hermite=function(t,e,i,s,l,u){var p=u*u,g=p*(2*u-3)+1,v=p*(u-2)+u,w=p*(u-1),S=p*(3-2*u);return t[0]=e[0]*g+i[0]*v+s[0]*w+l[0]*S,t[1]=e[1]*g+i[1]*v+s[1]*w+l[1]*S,t[2]=e[2]*g+i[2]*v+s[2]*w+l[2]*S,t},qe.bezier=function(t,e,i,s,l,u){var p=1-u,g=p*p,v=u*u,w=g*p,S=3*u*g,A=3*v*p,C=v*u;return t[0]=e[0]*w+i[0]*S+s[0]*A+l[0]*C,t[1]=e[1]*w+i[1]*S+s[1]*A+l[1]*C,t[2]=e[2]*w+i[2]*S+s[2]*A+l[2]*C,t},qe.random=function(t,e){e=e||1;var i=2*ft.RANDOM()*Math.PI,s=2*ft.RANDOM()-1,l=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*l,t[1]=Math.sin(i)*l,t[2]=s*e,t},qe.transformMat4=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=i[3]*s+i[7]*l+i[11]*u+i[15];return t[0]=(i[0]*s+i[4]*l+i[8]*u+i[12])/(p=p||1),t[1]=(i[1]*s+i[5]*l+i[9]*u+i[13])/p,t[2]=(i[2]*s+i[6]*l+i[10]*u+i[14])/p,t},qe.transformMat3=function(t,e,i){var s=e[0],l=e[1],u=e[2];return t[0]=s*i[0]+l*i[3]+u*i[6],t[1]=s*i[1]+l*i[4]+u*i[7],t[2]=s*i[2]+l*i[5]+u*i[8],t},qe.transformQuat=function(t,e,i){var s=i[0],l=i[1],u=i[2],p=e[0],g=e[1],v=e[2],w=l*v-u*g,S=u*p-s*v,A=s*g-l*p,C=l*A-u*S,R=u*w-s*A,L=s*S-l*w,O=2*i[3];return S*=O,A*=O,R*=2,L*=2,t[0]=p+(w*=O)+(C*=2),t[1]=g+S+R,t[2]=v+A+L,t},qe.rotateX=function(t,e,i,s){var l=[],u=[];return l[0]=e[0]-i[0],l[1]=e[1]-i[1],l[2]=e[2]-i[2],u[0]=l[0],u[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),u[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t},qe.rotateY=function(t,e,i,s){var l=[],u=[];return l[0]=e[0]-i[0],l[1]=e[1]-i[1],l[2]=e[2]-i[2],u[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),u[1]=l[1],u[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t},qe.rotateZ=function(t,e,i,s){var l=[],u=[];return l[0]=e[0]-i[0],l[1]=e[1]-i[1],l[2]=e[2]-i[2],u[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),u[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),u[2]=l[2],t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t},qe.angle=function(t,e){var i=t[0],s=t[1],l=t[2],u=e[0],p=e[1],g=e[2],v=Math.sqrt(i*i+s*s+l*l)*Math.sqrt(u*u+p*p+g*g),w=v&&bt(t,e)/v;return Math.acos(Math.min(Math.max(w,-1),1))},qe.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},qe.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},qe.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},qe.equals=function(t,e){var i=t[0],s=t[1],l=t[2],u=e[0],p=e[1],g=e[2];return Math.abs(i-u)<=ft.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-p)<=ft.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-g)<=ft.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))},qe.forEach=qe.sqrLen=qe.len=qe.sqrDist=qe.dist=qe.div=qe.mul=qe.sub=void 0;var ft=function(t,e){if(t&&t.__esModule)return t;if(t===null||Lt(t)!=="object"&&typeof t!="function")return{default:t};var i=Me(void 0);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}(yt);function Me(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Me=function(s){return s?i:e})(t)}function Q(){var t=new ft.ARRAY_TYPE(3);return ft.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function te(t){return Math.hypot(t[0],t[1],t[2])}function de(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ce(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function ke(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function He(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function xt(t,e){var i=e[0]-t[0],s=e[1]-t[1],l=e[2]-t[2];return i*i+s*s+l*l}function Be(t){var e=t[0],i=t[1],s=t[2];return e*e+i*i+s*s}function bt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}qe.sub=de,qe.mul=Ce,qe.div=ke,qe.dist=He,qe.sqrDist=xt,qe.len=te,qe.sqrLen=Be;var Et,Rt=(Et=Q(),function(t,e,i,s,l,u){var p,g;for(e||(e=3),i||(i=0),g=s?Math.min(s*e+i,t.length):t.length,p=i;p<g;p+=e)Et[0]=t[p],Et[1]=t[p+1],Et[2]=t[p+2],l(Et,Et,u),t[p]=Et[0],t[p+1]=Et[1],t[p+2]=Et[2];return t});qe.forEach=Rt;var _t={};function fi(t){return fi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fi(t)}Object.defineProperty(_t,"__esModule",{value:!0}),_t.create=Oi,_t.clone=function(t){var e=new li.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},_t.fromValues=function(t,e,i,s){var l=new li.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=i,l[3]=s,l},_t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},_t.set=function(t,e,i,s,l){return t[0]=e,t[1]=i,t[2]=s,t[3]=l,t},_t.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},_t.subtract=Fi,_t.multiply=Zi,_t.divide=fn,_t.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},_t.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},_t.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},_t.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},_t.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},_t.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},_t.scaleAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t},_t.distance=Xn,_t.squaredDistance=sn,_t.length=Tr,_t.squaredLength=_r,_t.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},_t.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},_t.normalize=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=i*i+s*s+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=i*p,t[1]=s*p,t[2]=l*p,t[3]=u*p,t},_t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},_t.cross=function(t,e,i,s){var l=i[0]*s[1]-i[1]*s[0],u=i[0]*s[2]-i[2]*s[0],p=i[0]*s[3]-i[3]*s[0],g=i[1]*s[2]-i[2]*s[1],v=i[1]*s[3]-i[3]*s[1],w=i[2]*s[3]-i[3]*s[2],S=e[0],A=e[1],C=e[2],R=e[3];return t[0]=A*w-C*v+R*g,t[1]=-S*w+C*p-R*u,t[2]=S*v-A*p+R*l,t[3]=-S*g+A*u-C*l,t},_t.lerp=function(t,e,i,s){var l=e[0],u=e[1],p=e[2],g=e[3];return t[0]=l+s*(i[0]-l),t[1]=u+s*(i[1]-u),t[2]=p+s*(i[2]-p),t[3]=g+s*(i[3]-g),t},_t.random=function(t,e){var i,s,l,u,p,g;e=e||1;do p=(i=2*li.RANDOM()-1)*i+(s=2*li.RANDOM()-1)*s;while(p>=1);do g=(l=2*li.RANDOM()-1)*l+(u=2*li.RANDOM()-1)*u;while(g>=1);var v=Math.sqrt((1-p)/g);return t[0]=e*i,t[1]=e*s,t[2]=e*l*v,t[3]=e*u*v,t},_t.transformMat4=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3];return t[0]=i[0]*s+i[4]*l+i[8]*u+i[12]*p,t[1]=i[1]*s+i[5]*l+i[9]*u+i[13]*p,t[2]=i[2]*s+i[6]*l+i[10]*u+i[14]*p,t[3]=i[3]*s+i[7]*l+i[11]*u+i[15]*p,t},_t.transformQuat=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=i[0],g=i[1],v=i[2],w=i[3],S=w*s+g*u-v*l,A=w*l+v*s-p*u,C=w*u+p*l-g*s,R=-p*s-g*l-v*u;return t[0]=S*w+R*-p+A*-v-C*-g,t[1]=A*w+R*-g+C*-p-S*-v,t[2]=C*w+R*-v+S*-g-A*-p,t[3]=e[3],t},_t.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},_t.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},_t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},_t.equals=function(t,e){var i=t[0],s=t[1],l=t[2],u=t[3],p=e[0],g=e[1],v=e[2],w=e[3];return Math.abs(i-p)<=li.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-g)<=li.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-v)<=li.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-w)<=li.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))},_t.forEach=_t.sqrLen=_t.len=_t.sqrDist=_t.dist=_t.div=_t.mul=_t.sub=void 0;var li=function(t,e){if(t&&t.__esModule)return t;if(t===null||fi(t)!=="object"&&typeof t!="function")return{default:t};var i=Bi(void 0);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}(yt);function Bi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Bi=function(s){return s?i:e})(t)}function Oi(){var t=new li.ARRAY_TYPE(4);return li.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Fi(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Zi(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function fn(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Xn(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function sn(t,e){var i=e[0]-t[0],s=e[1]-t[1],l=e[2]-t[2],u=e[3]-t[3];return i*i+s*s+l*l+u*u}function Tr(t){return Math.hypot(t[0],t[1],t[2],t[3])}function _r(t){var e=t[0],i=t[1],s=t[2],l=t[3];return e*e+i*i+s*s+l*l}_t.sub=Fi,_t.mul=Zi,_t.div=fn,_t.dist=Xn,_t.sqrDist=sn,_t.len=Tr,_t.sqrLen=_r;var cs=function(){var t=Oi();return function(e,i,s,l,u,p){var g,v;for(i||(i=4),s||(s=0),v=l?Math.min(l*i+s,e.length):e.length,g=s;g<v;g+=i)t[0]=e[g],t[1]=e[g+1],t[2]=e[g+2],t[3]=e[g+3],u(t,t,p),e[g]=t[0],e[g+1]=t[1],e[g+2]=t[2],e[g+3]=t[3];return e}}();function zn(t){return zn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zn(t)}_t.forEach=cs,Object.defineProperty(Je,"__esModule",{value:!0}),Je.create=pt,Je.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Je.setAxisAngle=mt,Je.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),s=Math.sin(i/2);return s>mn.EPSILON?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=1,t[1]=0,t[2]=0),i},Je.getAngle=function(t,e){var i=Qi(t,e);return Math.acos(2*i*i-1)},Je.multiply=ot,Je.rotateX=function(t,e,i){i*=.5;var s=e[0],l=e[1],u=e[2],p=e[3],g=Math.sin(i),v=Math.cos(i);return t[0]=s*v+p*g,t[1]=l*v+u*g,t[2]=u*v-l*g,t[3]=p*v-s*g,t},Je.rotateY=function(t,e,i){i*=.5;var s=e[0],l=e[1],u=e[2],p=e[3],g=Math.sin(i),v=Math.cos(i);return t[0]=s*v-u*g,t[1]=l*v+p*g,t[2]=u*v+s*g,t[3]=p*v-l*g,t},Je.rotateZ=function(t,e,i){i*=.5;var s=e[0],l=e[1],u=e[2],p=e[3],g=Math.sin(i),v=Math.cos(i);return t[0]=s*v+l*g,t[1]=l*v-s*g,t[2]=u*v+p*g,t[3]=p*v-u*g,t},Je.calculateW=function(t,e){var i=e[0],s=e[1],l=e[2];return t[0]=i,t[1]=s,t[2]=l,t[3]=Math.sqrt(Math.abs(1-i*i-s*s-l*l)),t},Je.exp=wt,Je.ln=at,Je.pow=function(t,e,i){return at(t,e),kt(t,t,i),wt(t,t),t},Je.slerp=Ht,Je.random=function(t){var e=mn.RANDOM(),i=mn.RANDOM(),s=mn.RANDOM(),l=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=l*Math.sin(2*Math.PI*i),t[1]=l*Math.cos(2*Math.PI*i),t[2]=u*Math.sin(2*Math.PI*s),t[3]=u*Math.cos(2*Math.PI*s),t},Je.invert=function(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=i*i+s*s+l*l+u*u,g=p?1/p:0;return t[0]=-i*g,t[1]=-s*g,t[2]=-l*g,t[3]=u*g,t},Je.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Je.fromMat3=yi,Je.fromEuler=function(t,e,i,s){var l=.5*Math.PI/180;e*=l,i*=l,s*=l;var u=Math.sin(e),p=Math.cos(e),g=Math.sin(i),v=Math.cos(i),w=Math.sin(s),S=Math.cos(s);return t[0]=u*v*S-p*g*w,t[1]=p*g*S+u*v*w,t[2]=p*v*w-u*g*S,t[3]=p*v*S+u*g*w,t},Je.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Je.setAxes=Je.sqlerp=Je.rotationTo=Je.equals=Je.exactEquals=Je.normalize=Je.sqrLen=Je.squaredLength=Je.len=Je.length=Je.lerp=Je.dot=Je.scale=Je.mul=Je.add=Je.set=Je.copy=Je.fromValues=Je.clone=void 0;var mn=rt(yt),Ue=rt(Kt),Ge=rt(qe),Ke=rt(_t);function st(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(st=function(s){return s?i:e})(t)}function rt(t,e){if(t&&t.__esModule)return t;if(t===null||zn(t)!=="object"&&typeof t!="function")return{default:t};var i=st(e);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}function pt(){var t=new mn.ARRAY_TYPE(4);return mn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function mt(t,e,i){i*=.5;var s=Math.sin(i);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(i),t}function ot(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=i[0],v=i[1],w=i[2],S=i[3];return t[0]=s*S+p*g+l*w-u*v,t[1]=l*S+p*v+u*g-s*w,t[2]=u*S+p*w+s*v-l*g,t[3]=p*S-s*g-l*v-u*w,t}function wt(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=Math.sqrt(i*i+s*s+l*l),g=Math.exp(u),v=p>0?g*Math.sin(p)/p:0;return t[0]=i*v,t[1]=s*v,t[2]=l*v,t[3]=g*Math.cos(p),t}function at(t,e){var i=e[0],s=e[1],l=e[2],u=e[3],p=Math.sqrt(i*i+s*s+l*l),g=p>0?Math.atan2(p,u)/p:0;return t[0]=i*g,t[1]=s*g,t[2]=l*g,t[3]=.5*Math.log(i*i+s*s+l*l+u*u),t}function Ht(t,e,i,s){var l,u,p,g,v,w=e[0],S=e[1],A=e[2],C=e[3],R=i[0],L=i[1],O=i[2],V=i[3];return(u=w*R+S*L+A*O+C*V)<0&&(u=-u,R=-R,L=-L,O=-O,V=-V),1-u>mn.EPSILON?(l=Math.acos(u),p=Math.sin(l),g=Math.sin((1-s)*l)/p,v=Math.sin(s*l)/p):(g=1-s,v=s),t[0]=g*w+v*R,t[1]=g*S+v*L,t[2]=g*A+v*O,t[3]=g*C+v*V,t}function yi(t,e){var i,s=e[0]+e[4]+e[8];if(s>0)i=Math.sqrt(s+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var l=0;e[4]>e[0]&&(l=1),e[8]>e[3*l+l]&&(l=2);var u=(l+1)%3,p=(l+2)%3;i=Math.sqrt(e[3*l+l]-e[3*u+u]-e[3*p+p]+1),t[l]=.5*i,t[3]=(e[3*u+p]-e[3*p+u])*(i=.5/i),t[u]=(e[3*u+l]+e[3*l+u])*i,t[p]=(e[3*p+l]+e[3*l+p])*i}return t}Je.clone=Ke.clone,Je.fromValues=Ke.fromValues,Je.copy=Ke.copy,Je.set=Ke.set,Je.add=Ke.add,Je.mul=ot;var kt=Ke.scale;Je.scale=kt;var Qi=Ke.dot;Je.dot=Qi,Je.lerp=Ke.lerp;var _n=Ke.length;Je.length=_n,Je.len=_n;var Ji=Ke.squaredLength;Je.squaredLength=Ji,Je.sqrLen=Ji;var An=Ke.normalize;Je.normalize=An,Je.exactEquals=Ke.exactEquals,Je.equals=Ke.equals;var bn,Ei,Nr,us=(bn=Ge.create(),Ei=Ge.fromValues(1,0,0),Nr=Ge.fromValues(0,1,0),function(t,e,i){var s=Ge.dot(e,i);return s<-.999999?(Ge.cross(bn,Ei,e),Ge.len(bn)<1e-6&&Ge.cross(bn,Nr,e),Ge.normalize(bn,bn),mt(t,bn,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ge.cross(bn,e,i),t[0]=bn[0],t[1]=bn[1],t[2]=bn[2],t[3]=1+s,An(t,t))});Je.rotationTo=us;var ir,ko,xl=(ir=pt(),ko=pt(),function(t,e,i,s,l,u){return Ht(ir,e,l,u),Ht(ko,i,s,u),Ht(t,ir,ko,2*u*(1-u)),t});Je.sqlerp=xl;var Mr,ag=(Mr=Ue.create(),function(t,e,i,s){return Mr[0]=i[0],Mr[3]=i[1],Mr[6]=i[2],Mr[1]=s[0],Mr[4]=s[1],Mr[7]=s[2],Mr[2]=-e[0],Mr[5]=-e[1],Mr[8]=-e[2],An(t,yi(t,Mr))});Je.setAxes=ag;var pi={};function wh(t){return wh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wh(t)}Object.defineProperty(pi,"__esModule",{value:!0}),pi.create=function(){var t=new Sr.ARRAY_TYPE(8);return Sr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},pi.clone=function(t){var e=new Sr.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},pi.fromValues=function(t,e,i,s,l,u,p,g){var v=new Sr.ARRAY_TYPE(8);return v[0]=t,v[1]=e,v[2]=i,v[3]=s,v[4]=l,v[5]=u,v[6]=p,v[7]=g,v},pi.fromRotationTranslationValues=function(t,e,i,s,l,u,p){var g=new Sr.ARRAY_TYPE(8);g[0]=t,g[1]=e,g[2]=i,g[3]=s;var v=.5*l,w=.5*u,S=.5*p;return g[4]=v*s+w*i-S*e,g[5]=w*s+S*t-v*i,g[6]=S*s+v*e-w*t,g[7]=-v*t-w*e-S*i,g},pi.fromRotationTranslation=qf,pi.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},pi.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},pi.fromMat4=function(t,e){var i=Us.create();Gf.getRotation(i,e);var s=new Sr.ARRAY_TYPE(3);return Gf.getTranslation(s,e),qf(t,i,s),t},pi.copy=Wf,pi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},pi.set=function(t,e,i,s,l,u,p,g,v){return t[0]=e,t[1]=i,t[2]=s,t[3]=l,t[4]=u,t[5]=p,t[6]=g,t[7]=v,t},pi.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},pi.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},pi.getTranslation=function(t,e){var i=e[4],s=e[5],l=e[6],u=e[7],p=-e[0],g=-e[1],v=-e[2],w=e[3];return t[0]=2*(i*w+u*p+s*v-l*g),t[1]=2*(s*w+u*g+l*p-i*v),t[2]=2*(l*w+u*v+i*g-s*p),t},pi.translate=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=.5*i[0],v=.5*i[1],w=.5*i[2],S=e[4],A=e[5],C=e[6],R=e[7];return t[0]=s,t[1]=l,t[2]=u,t[3]=p,t[4]=p*g+l*w-u*v+S,t[5]=p*v+u*g-s*w+A,t[6]=p*w+s*v-l*g+C,t[7]=-s*g-l*v-u*w+R,t},pi.rotateX=function(t,e,i){var s=-e[0],l=-e[1],u=-e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=g*p+S*s+v*u-w*l,C=v*p+S*l+w*s-g*u,R=w*p+S*u+g*l-v*s,L=S*p-g*s-v*l-w*u;return Us.rotateX(t,e,i),t[4]=A*(p=t[3])+L*(s=t[0])+C*(u=t[2])-R*(l=t[1]),t[5]=C*p+L*l+R*s-A*u,t[6]=R*p+L*u+A*l-C*s,t[7]=L*p-A*s-C*l-R*u,t},pi.rotateY=function(t,e,i){var s=-e[0],l=-e[1],u=-e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=g*p+S*s+v*u-w*l,C=v*p+S*l+w*s-g*u,R=w*p+S*u+g*l-v*s,L=S*p-g*s-v*l-w*u;return Us.rotateY(t,e,i),t[4]=A*(p=t[3])+L*(s=t[0])+C*(u=t[2])-R*(l=t[1]),t[5]=C*p+L*l+R*s-A*u,t[6]=R*p+L*u+A*l-C*s,t[7]=L*p-A*s-C*l-R*u,t},pi.rotateZ=function(t,e,i){var s=-e[0],l=-e[1],u=-e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],A=g*p+S*s+v*u-w*l,C=v*p+S*l+w*s-g*u,R=w*p+S*u+g*l-v*s,L=S*p-g*s-v*l-w*u;return Us.rotateZ(t,e,i),t[4]=A*(p=t[3])+L*(s=t[0])+C*(u=t[2])-R*(l=t[1]),t[5]=C*p+L*l+R*s-A*u,t[6]=R*p+L*u+A*l-C*s,t[7]=L*p-A*s-C*l-R*u,t},pi.rotateByQuatAppend=function(t,e,i){var s=i[0],l=i[1],u=i[2],p=i[3],g=e[0],v=e[1],w=e[2],S=e[3];return t[0]=g*p+S*s+v*u-w*l,t[1]=v*p+S*l+w*s-g*u,t[2]=w*p+S*u+g*l-v*s,t[3]=S*p-g*s-v*l-w*u,t[4]=(g=e[4])*p+(S=e[7])*s+(v=e[5])*u-(w=e[6])*l,t[5]=v*p+S*l+w*s-g*u,t[6]=w*p+S*u+g*l-v*s,t[7]=S*p-g*s-v*l-w*u,t},pi.rotateByQuatPrepend=function(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=i[0],v=i[1],w=i[2],S=i[3];return t[0]=s*S+p*g+l*w-u*v,t[1]=l*S+p*v+u*g-s*w,t[2]=u*S+p*w+s*v-l*g,t[3]=p*S-s*g-l*v-u*w,t[4]=s*(S=i[7])+p*(g=i[4])+l*(w=i[6])-u*(v=i[5]),t[5]=l*S+p*v+u*g-s*w,t[6]=u*S+p*w+s*v-l*g,t[7]=p*S-s*g-l*v-u*w,t},pi.rotateAroundAxis=function(t,e,i,s){if(Math.abs(s)<Sr.EPSILON)return Wf(t,e);var l=Math.hypot(i[0],i[1],i[2]);s*=.5;var u=Math.sin(s),p=u*i[0]/l,g=u*i[1]/l,v=u*i[2]/l,w=Math.cos(s),S=e[0],A=e[1],C=e[2],R=e[3];t[0]=S*w+R*p+A*v-C*g,t[1]=A*w+R*g+C*p-S*v,t[2]=C*w+R*v+S*g-A*p,t[3]=R*w-S*p-A*g-C*v;var L=e[4],O=e[5],V=e[6],j=e[7];return t[4]=L*w+j*p+O*v-V*g,t[5]=O*w+j*g+V*p-L*v,t[6]=V*w+j*v+L*g-O*p,t[7]=j*w-L*p-O*g-V*v,t},pi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},pi.multiply=Hf,pi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},pi.lerp=function(t,e,i,s){var l=1-s;return Zf(e,i)<0&&(s=-s),t[0]=e[0]*l+i[0]*s,t[1]=e[1]*l+i[1]*s,t[2]=e[2]*l+i[2]*s,t[3]=e[3]*l+i[3]*s,t[4]=e[4]*l+i[4]*s,t[5]=e[5]*l+i[5]*s,t[6]=e[6]*l+i[6]*s,t[7]=e[7]*l+i[7]*s,t},pi.invert=function(t,e){var i=Gc(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},pi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},pi.normalize=function(t,e){var i=Gc(e);if(i>0){i=Math.sqrt(i);var s=e[0]/i,l=e[1]/i,u=e[2]/i,p=e[3]/i,g=e[4],v=e[5],w=e[6],S=e[7],A=s*g+l*v+u*w+p*S;t[0]=s,t[1]=l,t[2]=u,t[3]=p,t[4]=(g-s*A)/i,t[5]=(v-l*A)/i,t[6]=(w-u*A)/i,t[7]=(S-p*A)/i}return t},pi.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},pi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},pi.equals=function(t,e){var i=t[0],s=t[1],l=t[2],u=t[3],p=t[4],g=t[5],v=t[6],w=t[7],S=e[0],A=e[1],C=e[2],R=e[3],L=e[4],O=e[5],V=e[6],j=e[7];return Math.abs(i-S)<=Sr.EPSILON*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(s-A)<=Sr.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(l-C)<=Sr.EPSILON*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(u-R)<=Sr.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(p-L)<=Sr.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(g-O)<=Sr.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(v-V)<=Sr.EPSILON*Math.max(1,Math.abs(v),Math.abs(V))&&Math.abs(w-j)<=Sr.EPSILON*Math.max(1,Math.abs(w),Math.abs(j))},pi.sqrLen=pi.squaredLength=pi.len=pi.length=pi.dot=pi.mul=pi.setReal=pi.getReal=void 0;var Sr=Th(yt),Us=Th(Je),Gf=Th(Nt);function $f(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return($f=function(s){return s?i:e})(t)}function Th(t,e){if(t&&t.__esModule)return t;if(t===null||wh(t)!=="object"&&typeof t!="function")return{default:t};var i=$f(e);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}function qf(t,e,i){var s=.5*i[0],l=.5*i[1],u=.5*i[2],p=e[0],g=e[1],v=e[2],w=e[3];return t[0]=p,t[1]=g,t[2]=v,t[3]=w,t[4]=s*w+l*v-u*g,t[5]=l*w+u*p-s*v,t[6]=u*w+s*g-l*p,t[7]=-s*p-l*g-u*v,t}function Wf(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Hf(t,e,i){var s=e[0],l=e[1],u=e[2],p=e[3],g=i[4],v=i[5],w=i[6],S=i[7],A=e[4],C=e[5],R=e[6],L=e[7],O=i[0],V=i[1],j=i[2],X=i[3];return t[0]=s*X+p*O+l*j-u*V,t[1]=l*X+p*V+u*O-s*j,t[2]=u*X+p*j+s*V-l*O,t[3]=p*X-s*O-l*V-u*j,t[4]=s*S+p*g+l*w-u*v+A*X+L*O+C*j-R*V,t[5]=l*S+p*v+u*g-s*w+C*X+L*V+R*O-A*j,t[6]=u*S+p*w+s*v-l*g+R*X+L*j+A*V-C*O,t[7]=p*S-s*g-l*v-u*w+L*X-A*O-C*V-R*j,t}pi.getReal=Us.copy,pi.setReal=Us.copy,pi.mul=Hf;var Zf=Us.dot;pi.dot=Zf;var Qf=Us.length;pi.length=Qf,pi.len=Qf;var Gc=Us.squaredLength;pi.squaredLength=Gc,pi.sqrLen=Gc;var ni={};function Mh(t){return Mh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mh(t)}Object.defineProperty(ni,"__esModule",{value:!0}),ni.create=Yf,ni.clone=function(t){var e=new Oo.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},ni.fromValues=function(t,e){var i=new Oo.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},ni.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},ni.set=function(t,e,i){return t[0]=e,t[1]=i,t},ni.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},ni.subtract=Kf,ni.multiply=Jf,ni.divide=ep,ni.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},ni.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},ni.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},ni.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},ni.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},ni.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},ni.scaleAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t},ni.distance=tp,ni.squaredDistance=ip,ni.length=np,ni.squaredLength=$c,ni.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},ni.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},ni.normalize=function(t,e){var i=e[0],s=e[1],l=i*i+s*s;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t},ni.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},ni.cross=function(t,e,i){var s=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=s,t},ni.lerp=function(t,e,i,s){var l=e[0],u=e[1];return t[0]=l+s*(i[0]-l),t[1]=u+s*(i[1]-u),t},ni.random=function(t,e){e=e||1;var i=2*Oo.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},ni.transformMat2=function(t,e,i){var s=e[0],l=e[1];return t[0]=i[0]*s+i[2]*l,t[1]=i[1]*s+i[3]*l,t},ni.transformMat2d=function(t,e,i){var s=e[0],l=e[1];return t[0]=i[0]*s+i[2]*l+i[4],t[1]=i[1]*s+i[3]*l+i[5],t},ni.transformMat3=function(t,e,i){var s=e[0],l=e[1];return t[0]=i[0]*s+i[3]*l+i[6],t[1]=i[1]*s+i[4]*l+i[7],t},ni.transformMat4=function(t,e,i){var s=e[0],l=e[1];return t[0]=i[0]*s+i[4]*l+i[12],t[1]=i[1]*s+i[5]*l+i[13],t},ni.rotate=function(t,e,i,s){var l=e[0]-i[0],u=e[1]-i[1],p=Math.sin(s),g=Math.cos(s);return t[0]=l*g-u*p+i[0],t[1]=l*p+u*g+i[1],t},ni.angle=function(t,e){var i=t[0],s=t[1],l=e[0],u=e[1],p=Math.sqrt(i*i+s*s)*Math.sqrt(l*l+u*u);return Math.acos(Math.min(Math.max(p&&(i*l+s*u)/p,-1),1))},ni.zero=function(t){return t[0]=0,t[1]=0,t},ni.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},ni.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ni.equals=function(t,e){var i=t[0],s=t[1],l=e[0],u=e[1];return Math.abs(i-l)<=Oo.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-u)<=Oo.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))},ni.forEach=ni.sqrLen=ni.sqrDist=ni.dist=ni.div=ni.mul=ni.sub=ni.len=void 0;var Oo=function(t,e){if(t&&t.__esModule)return t;if(t===null||Mh(t)!=="object"&&typeof t!="function")return{default:t};var i=Xf(void 0);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}(yt);function Xf(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Xf=function(s){return s?i:e})(t)}function Yf(){var t=new Oo.ARRAY_TYPE(2);return Oo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Kf(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Jf(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function ep(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function tp(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function ip(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s}function np(t){return Math.hypot(t[0],t[1])}function $c(t){var e=t[0],i=t[1];return e*e+i*i}ni.len=np,ni.sub=Kf,ni.mul=Jf,ni.div=ep,ni.dist=tp,ni.sqrDist=ip,ni.sqrLen=$c;var lg=function(){var t=Yf();return function(e,i,s,l,u,p){var g,v;for(i||(i=2),s||(s=0),v=l?Math.min(l*i+s,e.length):e.length,g=s;g<v;g+=i)t[0]=e[g],t[1]=e[g+1],u(t,t,p),e[g]=t[0],e[g+1]=t[1];return e}}();function qc(t){return qc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qc(t)}ni.forEach=lg,Object.defineProperty(gt,"__esModule",{value:!0}),r.aa=gt.vec4=r.Q=gt.vec3=gt.vec2=gt.quat2=r.bl=gt.quat=r.a9=gt.mat4=r.ct=gt.mat3=gt.mat2d=r.b7=gt.mat2=gt.glMatrix=void 0;var cg=As(yt);gt.glMatrix=cg;var ug=As(Qt);r.b7=gt.mat2=ug;var hg=As(qt);gt.mat2d=hg;var Vt=As(Kt);r.ct=gt.mat3=Vt;var Sh=As(Nt);r.a9=gt.mat4=Sh;var Xt=As(Je);r.bl=gt.quat=Xt;var Wc=As(pi);gt.quat2=Wc;var ci=As(ni);gt.vec2=ci;var Eh=As(qe);r.Q=gt.vec3=Eh;var Ah=As(_t);function Wt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Wt=function(s){return s?i:e})(t)}function As(t,e){if(t&&t.__esModule)return t;if(t===null||qc(t)!=="object"&&typeof t!="function")return{default:t};var i=Wt(e);if(i&&i.has(t))return i.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(s,u,p):s[u]=t[u]}return s.default=t,i&&i.set(t,s),s}r.aa=gt.vec4=Ah;var dg=Fo;function Fo(t,e,i,s){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=s}Fo.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,s=0;s<8;s++){var l=this.sampleCurveX(i)-t;if(Math.abs(l)<e)return i;var u=this.sampleCurveDerivativeX(i);if(Math.abs(u)<1e-6)break;i-=l/u}var p=0,g=1;for(i=t,s=0;s<20&&(l=this.sampleCurveX(i),!(Math.abs(l-t)<e));s++)t>l?p=i:g=i,i=.5*(g-p)+p;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var rp=dt(dg),Hc=hs;function hs(t,e){this.x=t,this.y=e}hs.prototype={clone:function(){return new hs(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(t,e){var i=Math.cos(t),s=Math.sin(t),l=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},hs.convert=function(t){return t instanceof hs?t:Array.isArray(t)?new hs(t[0],t[1]):t};var ct=dt(Hc);const Ih=Math.PI/180,Ch=180/Math.PI;function Mi(t){return t*Ih}function Er(t){return t*Ch}const sp=[[0,0],[1,0],[1,1],[0,1]];function Zc(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function op(t,e,i,s){const l=new rp(t,e,i,s);return function(u){return l.solve(u)}}const ds=op(.25,.1,.25,1);function mi(t,e,i){return Math.min(i,Math.max(e,t))}function vl(t,e,i){return(i=mi((i-t)/(e-t),0,1))*i*(3-2*i)}function Gs(t,e,i){const s=i-e,l=((t-e)%s+s)%s+e;return l===e?i:l}function Ph(t,e,i){if(!t.length)return i(null,[]);let s=t.length;const l=new Array(t.length);let u=null;t.forEach((p,g)=>{e(p,(v,w)=>{v&&(u=v),l[g]=w,--s==0&&i(u,l)})})}function Qr(t,...e){for(const i of e)for(const s in i)t[s]=i[s];return t}let ap=1;function zi(){return ap++}function Qc(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Dh(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function lp(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Rh(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Bo(t,e){return t.indexOf(e,t.length-e.length)!==-1}function fa(t,e,i){const s={};for(const l in t)s[l]=e.call(this,t[l],l,t);return s}function bl(t,e,i){const s={};for(const l in t)e.call(this,t[l],l,t)&&(s[l]=t[l]);return s}function $s(t){return Array.isArray(t)?t.map($s):typeof t=="object"&&t?fa(t,$s):t}const zh={};function gn(t){zh[t]||(typeof console<"u"&&console.warn(t),zh[t]=!0)}function ho(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function wl(t){let e=0;for(let i,s,l=0,u=t.length,p=u-1;l<u;p=l++)i=t[l],s=t[p],e+=(s.x-i.x)*(i.y+s.y);return e}function Tl([t,e,i]){const s=Mi(e+90),l=Mi(i);return{x:t*Math.cos(s)*Math.sin(l),y:t*Math.sin(s)*Math.sin(l),z:t*Math.cos(l),azimuthal:e,polar:i}}function qs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Vr(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,l,u)=>{const p=l||u;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Xc,Yc,Kc,Ml,fo,pa,Jc=null;function Lh(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function No(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Vo(t,e,i,s){for(;e<i;){const l=e+i>>1;t[l]<s?e=l+1:i=l}return e}function kh(t,e,i,s){for(;e<i;){const l=e+i>>1;t[l]<=s?e=l+1:i=l}return e}function fs(t){return t>0?1/(1.001-t):1+t}function cp(t){return t>0?1-1/(1.001-t):-t}function eu(){return Xc==null&&(Xc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Xc}const Is={now:()=>Ml!==void 0?Ml:performance.now(),setNow(t){Ml=t},restoreNow(){Ml=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:s}=t;fo||(fo=document.createElement("canvas"));const l=fo.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(i>fo.width||s>fo.height)&&(fo.width=i,fo.height=s),l.clearRect(-e,-e,i+2*e,s+2*e),l.drawImage(t,0,0,i,s),l.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:t=>(Yc||(Yc=document.createElement("a")),Yc.href=t,Yc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Kc==null&&(Kc=window.matchMedia("(prefers-reduced-motion: reduce)")),Kc.matches)},hasCanvasFingerprintNoise(){if(pa!==void 0)return pa;if(!eu())return pa=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let l=0;l<t.width;++l)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(l,0,1,1);const s=e.getImageData(0,0,t.width,t.height);i=0;for(let l=0;l<s.data.length;++l)if(l%4!=3&&i++!==s.data[l])return pa=!0,!0;return pa=!1,!1}};function tu(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(t.slice(i));for(const l in e)s.set(l,e[l]);return`${t.slice(0,i)}?${s.toString()}`}function iu(t,e={persistentParams:[]}){const i=t.indexOf("?");if(i<0)return t;const s=new URLSearchParams,l=new URLSearchParams(t.slice(i));for(const p of e.persistentParams){const g=l.get(p);g&&s.set(p,g)}const u=s.toString();return`${t.slice(0,i)}${u.length>0?`?${u}`:""}`}const ma="mapbox-tiles";let nu=500,up=50,Ws,ru;function Oh(){try{return caches}catch{}}function _a(){const t=Oh();t&&!Ws&&(Ws=t.open(ma))}let Fh=1/0;const jo={supported:!1,testSupport:function(t){!Bh&&ga&&(hp?fp(t):Sl=t)}};let Sl,ga,Bh=!1,hp=!1;const dp=typeof self<"u"?self:{};function fp(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ga),t.isContextLost())return;jo.supported=!0}catch{}t.deleteTexture(e),Bh=!0}dp.document&&(ga=dp.document.createElement("img"),ga.onload=function(){Sl&&fp(Sl),Sl=null,hp=!0},ga.onerror=function(){Bh=!0,Sl=null},ga.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const su={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(su);class ou extends Error{constructor(e,i,s){i===401&&ae(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ya=qs()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,El=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(ya())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,l){const u=new AbortController,p=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:ya(),referrerPolicy:s.referrerPolicy,signal:u.signal});let g=!1,v=!1;const w=(S=p.url).indexOf("sku=")>0&&ae(S);var S;s.type==="json"&&p.headers.set("Accept","application/json");const A=(R,L,O)=>{if(v)return;if(R&&R.message!=="SecurityError"&&gn(R.toString()),L&&O)return C(L);const V=Date.now();fetch(p).then(j=>{if(j.ok){const X=w?j.clone():null;return C(j,X,V)}return l(new ou(j.statusText,j.status,s.url))}).catch(j=>{j.name!=="AbortError"&&l(new Error(`${j.message} ${s.url}`))})},C=(R,L,O)=>{(s.type==="arrayBuffer"?R.arrayBuffer():s.type==="json"?R.json():R.text()).then(V=>{v||(L&&O&&function(j,X,ee){if(_a(),!Ws)return;const K=Vr(X.headers.get("Cache-Control")||"");if(K["no-store"])return;const le={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((pe,ve)=>le.headers.set(ve,pe)),K["max-age"]&&le.headers.set("Expires",new Date(ee+1e3*K["max-age"]).toUTCString());const ie=le.headers.get("Expires");if(!ie||new Date(ie).getTime()-ee<42e4)return;let ue=iu(j.url,{persistentParams:["language","worldview"]});if(X.status===206){const pe=j.headers.get("Range");if(!pe)return;le.status=200,ue=tu(ue,{range:pe})}(function(pe,ve){if(ru===void 0)try{new Response(new ReadableStream),ru=!0}catch{ru=!1}ru?ve(pe.body):pe.blob().then(ve)})(X,pe=>{const ve=new Response(pe,le);_a(),Ws&&Ws.then(Re=>Re.put(ue,ve)).catch(Re=>gn(Re.message))})}(p,L,O),g=!0,l(null,V,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(V=>{v||l(new Error(V.message))})};return w?function(R,L){if(_a(),!Ws)return L(null);Ws.then(O=>{let V=iu(R.url,{persistentParams:["language","worldview"]});const j=R.headers.get("Range");j&&(V=tu(V,{range:j})),O.match(V).then(X=>{const ee=function(K){if(!K)return!1;const le=new Date(K.headers.get("Expires")||0),ie=Vr(K.headers.get("Cache-Control")||"");return le>Date.now()&&!ie["no-cache"]}(X);O.delete(V),ee&&O.put(V,X.clone()),L(null,X,ee)}).catch(L)}).catch(L)}(p,A):A(null,null),{cancel:()=>{v=!0,g||u.abort()}}}(t,e);if(qs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(s,l){const u=new XMLHttpRequest;u.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in s.headers)u.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=s.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(s.type==="json")try{p=JSON.parse(u.response)}catch(g){return l(g)}l(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new ou(u.statusText,u.status,s.url))},u.send(s.body),{cancel:()=>u.abort()}}(t,e)},Al=function(t,e){return El(Qr(t,{type:"arrayBuffer"}),e)};function Nh(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const pp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let au,Il;au=[],Il=0;const Vh=function(t,e){if(jo.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Il>=Z.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return au.push(u),u}Il++;let i=!1;const s=()=>{if(!i)for(i=!0,Il--;au.length&&Il<Z.MAX_PARALLEL_IMAGE_REQUESTS;){const u=au.shift(),{requestParameters:p,callback:g,cancelled:v}=u;v||(u.cancel=Vh(p,g).cancel)}},l=Al(t,(u,p,g,v)=>{s(),u?e(u):p&&(self.createImageBitmap?function(w,S){const A=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(A).then(C=>{S(null,C)}).catch(C=>{S(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,S)=>e(w,S,g,v)):function(w,S){const A=new Image;A.onload=()=>{S(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=pp})},A.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(w)],{type:"image/png"});A.src=w.byteLength?URL.createObjectURL(C):pp}(p,(w,S)=>e(w,S,g,v)))});return{cancel:()=>{l.cancel(),s()}}},Cl="01",lu="NO_ACCESS_TOKEN",jh=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ps(t){const e=t.match(jh);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function xa(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Pl="mapbox.eventData";function Uh(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class va{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Uh(Z.ACCESS_TOKEN);let s="";return s=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(+("0x"+u)))):Z.ACCESS_TOKEN||"",e?`${Pl}.${e}:${s}`:`${Pl}:${s}`}fetchEventData(){const e=Lh("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const l=localStorage.getItem(i);l&&(this.eventData=JSON.parse(l));const u=localStorage.getItem(s);u&&(this.anonId=u)}catch{gn("Unable to read from LocalStorage")}}saveEventData(){const e=Lh("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid"),l=this.anonId;if(e&&l)try{localStorage.setItem(s,l),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{gn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,l){if(!Z.EVENTS_URL)return;const u=ps(Z.EVENTS_URL);u.params.push(`access_token=${l||Z.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},g=i?Qr(p,i):p,v={url:xa(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=function(w,S){return El(Qr(w,{method:"POST"}),S)}(v,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(l)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const cu=new class extends va{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Z.EVENTS_URL&&Z.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>fe(i)||ae(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Uh(Z.ACCESS_TOKEN),i=e?e.u:Z.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;lp(this.anonId)||(this.anonId=Qc(),s=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(l),g=(l-this.eventData.lastSuccess)/864e5;s=s||g>=1||g<-1||u.getDate()!==p.getDate()}else s=!0;s?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:Cl,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=i)},t):this.processRequests()}},Pr=cu.postTurnstileEvent.bind(cu),po=new class extends va{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,s){this.skuToken=e,this.errorCb=s,Z.EVENTS_URL&&(i||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(lu)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),lp(this.anonId)||(this.anonId=Qc()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:Cl,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Dr=po.postMapLoadEvent.bind(po),mp=new class extends va{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=Qc(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){const{map:i,style:s,importedStyles:l}=e;if(!Z.EVENTS_URL||!t&&!Z.ACCESS_TOKEN)return;const u=this.getMapInstanceId(i),p={mapInstanceId:u,eventId:this.getEventId(u),style:s};l.length&&(p.importedStyles=l),this.queueRequest({timestamp:Date.now(),payload:p},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,payload:i}=this.queue.shift();this.postEvent(e,i,()=>{},t)}},fg=mp.postStyleLoadEvent.bind(mp),_p=new class extends va{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Z.EVENTS_URL&&(t||Z.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),s=function(l){const u=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),g=function(R){const L={};if(R){for(const O in R)if(O!=="other")for(const V of R[O]){const j=`${O}ResolveRangeMin`,X=`${O}ResolveRangeMax`,ee=`${O}RequestCount`,K=`${O}RequestCachedCount`;L[j]=Math.min(L[j]||1/0,V.startTime),L[X]=Math.max(L[X]||-1/0,V.responseEnd);const le=ie=>{L[ie]===void 0&&(L[ie]=0),++L[ie]};V.transferSize!==void 0&&V.transferSize===0&&le(K),le(ee)}}return L}(function(R,L){const O={};if(R)for(const V of R){const j=L(V);O[j]===void 0&&(O[j]=[]),O[j].push(V)}return O}(u,lt)),v=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,S=w?w.effectiveType:void 0,A={counters:[],metadata:[],attributes:[]},C=(R,L,O)=>{O!=null&&R.push({name:L,value:O.toString()})};for(const R in g)C(A.counters,R,g[R]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(C(A.counters,"interactionRangeMin",l.interactionRange[0]),C(A.counters,"interactionRangeMax",l.interactionRange[1])),p)for(const R of Object.keys(Ye)){const L=Ye[R],O=p.find(V=>V.name===L);O&&C(A.counters,L,O.startTime)}return C(A.counters,"visibilityHidden",l.visibilityHidden),C(A.attributes,"style",function(R){if(R)for(const L of R){const O=L.name.split("?")[0];if(Ve(O)){const V=O.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(u)),C(A.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),C(A.attributes,"fogEnabled",l.fogEnabled?"true":"false"),C(A.attributes,"projection",l.projection),C(A.attributes,"zoom",l.zoom),C(A.metadata,"devicePixelRatio",v),C(A.metadata,"connectionEffectiveType",S),C(A.metadata,"navigatorUserAgent",navigator.userAgent),C(A.metadata,"screenWidth",window.screen.width),C(A.metadata,"screenHeight",window.screen.height),C(A.metadata,"windowWidth",window.innerWidth),C(A.metadata,"windowHeight",window.innerHeight),C(A.metadata,"mapWidth",l.width/v),C(A.metadata,"mapHeight",l.height/v),C(A.metadata,"webglRenderer",l.renderer),C(A.metadata,"webglVendor",l.vendor),C(A.metadata,"sdkVersion",B),C(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const l of s.metadata);for(const l of s.counters);for(const l of s.attributes);this.postEvent(e,s,()=>{},t)}},uu=_p.postPerformanceEvent.bind(_p),hu=new class extends va{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,s){if(!Z.API_URL||!Z.SESSION_PATH)return;const l=ps(Z.API_URL+Z.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${s||Z.ACCESS_TOKEN||""}`);const u={url:xa(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,g){return El(Qr(p,{method:"GET"}),g)}(u,p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,i,s){this.skuToken=e,this.errorCb=s,Z.SESSION_PATH&&Z.API_URL&&(i||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(lu)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Gh=hu.getSessionAPI.bind(hu),du=new Set;var Cs={exports:{}},gp={exports:{}};gp.exports=function(t,e){var i,s,l,u,p,g,v,w;for(s=t.length-(i=3&t.length),l=e,p=3432918353,g=461845907,w=0;w<s;)v=255&t.charCodeAt(w)|(255&t.charCodeAt(++w))<<8|(255&t.charCodeAt(++w))<<16|(255&t.charCodeAt(++w))<<24,++w,l=27492+(65535&(u=5*(65535&(l=(l^=v=(65535&(v=(v=(65535&v)*p+(((v>>>16)*p&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(v=0,i){case 3:v^=(255&t.charCodeAt(w+2))<<16;case 2:v^=(255&t.charCodeAt(w+1))<<8;case 1:l^=v=(65535&(v=(v=(65535&(v^=255&t.charCodeAt(w)))*p+(((v>>>16)*p&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295}return l^=t.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var pg=gp.exports,$h={exports:{}};$h.exports=function(t,e){for(var i,s=t.length,l=e^s,u=0;s>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24))+((1540483477*(i>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),s-=4,++u;switch(s){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&t.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var qh=pg,ms=$h.exports;Cs.exports=qh,Cs.exports.murmur3=qh,Cs.exports.murmur2=ms;var Dl=dt(Cs.exports);function Wh(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function fu(t,e,i){if(i&&i[t]){const s=i[t].indexOf(e);s!==-1&&i[t].splice(s,1)}}class mo{constructor(e,i={}){Qr(this,i),this.type=e}}class pu extends mo{constructor(e,i={}){super("error",Qr({error:e},i))}}class Uo{on(e,i){return this._listeners=this._listeners||{},Wh(e,i,this._listeners),this}off(e,i){return fu(e,i,this._listeners),fu(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Wh(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){typeof e=="string"&&(e=new mo(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const g of l)g.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const g of u)fu(s,g,this._oneTimeListeners),g.call(this,e);const p=this._eventedParent;p&&(Qr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof pu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}r.z=void 0;var Hh={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rl(t){return(t=Math.round(t))<0?0:t>255?255:t}function mu(t){return Rl(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function zl(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function _u(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{r.z={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Hh)return Hh[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=i.indexOf("("),l=i.indexOf(")");if(s!==-1&&l+1===i.length){var u=i.substr(0,s),p=i.substr(s+1,l-(s+1)).split(","),g=1;switch(u){case"rgba":if(p.length!==4)return null;g=zl(p.pop());case"rgb":return p.length!==3?null:[mu(p[0]),mu(p[1]),mu(p[2]),g];case"hsla":if(p.length!==4)return null;g=zl(p.pop());case"hsl":if(p.length!==3)return null;var v=(parseFloat(p[0])%360+360)%360/360,w=zl(p[1]),S=zl(p[2]),A=S<=.5?S*(w+1):S+w-S*w,C=2*S-A;return[Rl(255*_u(C,A,v+1/3)),Rl(255*_u(C,A,v)),Rl(255*_u(C,A,v-1/3)),g];default:return null}}return null}}catch{}class Ni{constructor(e,i,s,l=1){this.r=e,this.g=i,this.b=s,this.a=l}static parse(e){if(!e)return;if(e instanceof Ni)return e;if(typeof e!="string")return;const i=r.z(e);return i?new Ni(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${l})`}toArray(){const{r:e,g:i,b:s,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*i/l,255*s/l,l]}toArray01(){const{r:e,g:i,b:s,a:l}=this;return l===0?[0,0,0,0]:[e/l,i/l,s/l,l]}toArray01Scaled(e){const{r:i,g:s,b:l,a:u}=this;return u===0?[0,0,0]:[i/u*e,s/u*e,l/u*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:l}=this;return[e,i,s,l]}toArray01Linear(){const{r:e,g:i,b:s,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(i/l,2.2),Math.pow(s/l,2.2),l]}}function ai(t,e,i){return t*(1-i)+e*i}function Ll(t,e,i){return t.map((s,l)=>ai(s,e[l],i))}Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1),Ni.blue=new Ni(0,0,1,1);var kl=Object.freeze({__proto__:null,array:Ll,color:function(t,e,i){return new Ni(ai(t.r,e.r,i),ai(t.g,e.g,i),ai(t.b,e.b,i),ai(t.a,e.a,i))},number:ai});function gu(t,...e){for(const i of e)for(const s in i)t[s]=i[s];return t}class _s extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class _o{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,l]of i)this.bindings[s]=l}concat(e){return new _o(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ui={kind:"null"},Mt={kind:"number"},Li={kind:"string"},ki={kind:"boolean"},jr={kind:"color"},ba={kind:"object"},Si={kind:"value"},Ol={kind:"collator"},wa={kind:"formatted"},Ta={kind:"resolvedImage"};function Yn(t,e){return{kind:"array",itemType:t,N:e}}function Sn(t){if(t.kind==="array"){const e=Sn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const yp=[ui,Mt,Li,ki,jr,wa,ba,Yn(Si),Ta];function Fl(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Fl(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of yp)if(!Fl(i,e))return null}}return`Expected ${Sn(t)} but found ${Sn(e)} instead.`}function Bl(t,e){return e.some(i=>i.kind===t.kind)}function Go(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class Zh{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yu{constructor(e,i,s,l,u){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=l,this.textColor=u}}class lr{constructor(e){this.sections=e}static fromString(e){return new lr([new yu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof lr?e:lr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class Ur{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Ur({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function xp(t,e,i,s){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[t,e,i,s]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ma(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ni||t instanceof Zh||t instanceof lr||t instanceof Ur)return!0;if(Array.isArray(t)){for(const e of t)if(!Ma(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ma(t[e]))return!1;return!0}return!1}function Ln(t){if(t===null)return ui;if(typeof t=="string")return Li;if(typeof t=="boolean")return ki;if(typeof t=="number")return Mt;if(t instanceof Ni)return jr;if(t instanceof Zh)return Ol;if(t instanceof lr)return wa;if(t instanceof Ur)return Ta;if(Array.isArray(t)){const e=t.length;let i;for(const s of t){const l=Ln(s);if(i){if(i===l)continue;i=Si;break}i=l}return Yn(i||Si,e)}return ba}function Xr(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Ni||t instanceof lr||t instanceof Ur?t.toString():JSON.stringify(t)}class Ps{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ma(e[1]))return i.error("invalid value");const s=e[1];let l=Ln(s);const u=i.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Ps(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ni?["rgba"].concat(this.value.toArray()):this.value instanceof lr?this.value.serialize():this.value}}class $n{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const xu={string:Li,number:Mt,boolean:ki,object:ba};class gs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,l=1;const u=e[0];if(u==="array"){let g,v;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in xu)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=xu[w],l++}else g=Si;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}s=Yn(g,v)}else s=xu[u];const p=[];for(;l<e.length;l++){const g=i.parse(e[l],l,Si);if(!g)return null;p.push(g)}return new gs(s,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!Fl(this.type,Ln(s)))return s;if(i===this.args.length-1)throw new $n(`Expected value to be of type ${Sn(this.type)}, but found ${Sn(Ln(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&i.push(l)}}return i.concat(this.args.map(s=>s.serialize()))}}class Nl{constructor(e){this.type=wa,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const l=[];let u=!1;for(let p=1;p<=e.length-1;++p){const g=e[p];if(u&&typeof g=="object"&&!Array.isArray(g)){u=!1;let v=null;if(g["font-scale"]&&(v=i.parse(g["font-scale"],1,Mt),!v))return null;let w=null;if(g["text-font"]&&(w=i.parse(g["text-font"],1,Yn(Li)),!w))return null;let S=null;if(g["text-color"]&&(S=i.parse(g["text-color"],1,jr),!S))return null;const A=l[l.length-1];A.scale=v,A.font=w,A.textColor=S}else{const v=i.parse(e[p],1,Si);if(!v)return null;const w=v.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new Nl(l)}evaluate(e){return new lr(this.sections.map(i=>{const s=i.content.evaluate(e);return Ln(s)===Ta?new yu("",s,null,null,null):new yu(Xr(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class Sa{constructor(e,i){this.type=Ta,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const s=i.parse(e[1],1,Li);if(!s)return i.error("No image name provided.");if(e.length===2)return new Sa(s);const l=i.parse(e[2],1,Li);return l?new Sa(s,l):i.error("Secondary image variant is not a string.")}evaluate(e){const i=Ur.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function go(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const mg={"to-boolean":ki,"to-color":jr,"to-number":Mt,"to-string":Li};class Hs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],l=[];let u=ui;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);u=Yn(i.expectedType.itemType,p)}else{if(!(p>0&&Ma(e[1][0])))return null;u=Yn(Ln(e[1][0]),p)}for(let g=0;g<p;g++){const v=e[1][g];let w;if(go(v)==="array")w=i.parse(v,void 0,u.itemType);else{const S=go(v);if(S!==u.itemType.kind)return i.error(`Expected ${u.itemType.kind} but found ${S}.`);w=i.registry.literal.parse(["literal",v===void 0?null:v],i)}if(!w)return null;l.push(w)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");u=mg[s];for(let p=1;p<e.length;p++){const g=i.parse(e[p],p,Si);if(!g)return null;l.push(g)}}return new Hs(u,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const l of this.args){if(i=l.evaluate(e),s=null,i instanceof Ni)return i;if(typeof i=="string"){const u=e.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:xp(i[0],i[1],i[2],i[3]),!s))return new Ni(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new $n(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new $n(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?lr.fromString(Xr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ur.fromString(Xr(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Xr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Nl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Sa(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const _g=["Unknown","Point","LineString","Polygon"];class Qh{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_g[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(l*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Ni.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Rr{constructor(e,i,s,l,u){this.name=e,this.type=i,this._evaluate=s,this.args=l,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const i=Rr.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],l=Rr.definitions[s];if(!l)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=[];let v=null,w=-1;for(const[S,A]of p){if(Array.isArray(S)&&S.length!==e.length-1)continue;g.push(S),w++,v=new Iu(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const C=[];let R=!1;for(let L=1;L<e.length;L++){const O=e[L],V=Array.isArray(S)?S[L-1]:S.type,j=v.parse(O,1+C.length,V);if(!j){R=!0;break}C.push(j)}if(!R)if(Array.isArray(S)&&S.length!==C.length)v.error(`Expected ${S.length} arguments, but found ${C.length} instead.`);else{for(let L=0;L<C.length;L++){const O=Array.isArray(S)?S[L]:S.type,V=C[L];v.concat(L+1).checkSubtype(O,V.type)}if(v.errors.length===0)return new Rr(s,u,A,C,w)}}if(g.length===1)i.errors.push(...v.errors);else{const S=(g.length?g:p.map(([C])=>C)).map(gg).join(" | "),A=[];for(let C=1;C<e.length;C++){const R=i.parse(e[C],1+A.length);if(!R)return null;A.push(Sn(R.type))}i.error(`Expected arguments of type ${S}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){Rr.definitions=i;for(const s in i)e[s]=Rr}}function gg(t){return Array.isArray(t)?`(${t.map(Sn).join(", ")})`:`(${Sn(t.type)}...)`}class Vl{constructor(e,i,s){this.type=Ol,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const l=i.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ki);if(!l)return null;const u=i.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ki);if(!u)return null;let p=null;return s.locale&&(p=i.parse(s.locale,1,Li),!p)?null:new Vl(l,u,p)}evaluate(e){return new Zh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Xh={exports:{}};Xh.exports=function(){function t(s,l,u,p,g){for(;p>u;){if(p-u>600){var v=p-u+1,w=l-u+1,S=Math.log(v),A=.5*Math.exp(2*S/3),C=.5*Math.sqrt(S*A*(v-A)/v)*(w-v/2<0?-1:1);t(s,l,Math.max(u,Math.floor(l-w*A/v+C)),Math.min(p,Math.floor(l+(v-w)*A/v+C)),g)}var R=s[l],L=u,O=p;for(e(s,u,l),g(s[p],R)>0&&e(s,u,p);L<O;){for(e(s,L,O),L++,O--;g(s[L],R)<0;)L++;for(;g(s[O],R)>0;)O--}g(s[u],R)===0?e(s,u,O):e(s,++O,p),O<=l&&(u=O+1),l<=O&&(p=O-1)}}function e(s,l,u){var p=s[l];s[l]=s[u],s[u]=p}function i(s,l){return s<l?-1:s>l?1:0}return function(s,l,u,p,g){t(s,l,u||0,p||s.length-1,g||i)}}();var vp=dt(Xh.exports);function yg(t){let e=0;for(let i,s,l=0,u=t.length,p=u-1;l<u;p=l++)i=t[l],s=t[p],e+=(s.x-i.x)*(i.y+s.y);return e}function jl(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ul(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function xg(t,e,i){const s=t[0]-e[0],l=t[1]-e[1],u=t[0]-i[0],p=t[1]-i[1];return s*p-u*l==0&&s*u<=0&&l*p<=0}function $o(t,e,i=!1){let s=!1;for(let g=0,v=e.length;g<v;g++){const w=e[g];for(let S=0,A=w.length,C=A-1;S<A;C=S++){const R=w[C],L=w[S];if(xg(t,R,L))return i;(u=R)[1]>(l=t)[1]!=(p=L)[1]>l[1]&&l[0]<(p[0]-u[0])*(l[1]-u[1])/(p[1]-u[1])+u[0]&&(s=!s)}}var l,u,p;return s}function Yh(t,e,i,s){const l=s[0]-i[0],u=s[1]-i[1],p=(t[0]-i[0])*u-l*(t[1]-i[1]),g=(e[0]-i[0])*u-l*(e[1]-i[1]);return p>0&&g<0||p<0&&g>0}function Ea(t,e,i,s){return(l=[s[0]-i[0],s[1]-i[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-l[1]*u[0]!=0&&!(!Yh(t,e,i,s)||!Yh(i,s,t,e));var l,u}const yo=8192;function vg(t,e){const i=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(i*l*yo),Math.round(s*l*yo)]}function bg(t,e){for(let i=0;i<e.length;i++)if($o(t,e[i]))return!0;return!1}function Kh(t,e,i){for(const s of i)for(let l=0,u=s.length,p=u-1;l<u;p=l++)if(Ea(t,e,s[p],s[l]))return!0;return!1}function vu(t,e){for(let i=0;i<t.length;++i)if(!$o(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Kh(t[i],t[i+1],e))return!1;return!0}function bp(t,e){for(let i=0;i<e.length;i++)if(vu(t,e[i]))return!0;return!1}function Jh(t,e,i){const s=[];for(let l=0;l<t.length;l++){const u=[];for(let p=0;p<t[l].length;p++){const g=vg(t[l][p],i);jl(e,g),u.push(g)}s.push(u)}return s}function Gl(t,e,i){const s=[];for(let l=0;l<t.length;l++){const u=Jh(t[l],e,i);s.push(u)}return s}function ed(t,e,i,s){if(t[0]<i[0]||t[0]>i[2]){const l=.5*s;let u=t[0]-i[0]>l?-s:i[0]-t[0]>l?s:0;u===0&&(u=t[0]-i[2]>l?-s:i[2]-t[0]>l?s:0),t[0]+=u}jl(e,t)}function $l(t,e,i,s){const l=Math.pow(2,s.z)*yo,u=[s.x*yo,s.y*yo],p=[];if(!t)return p;for(const g of t)for(const v of g){const w=[v.x+u[0],v.y+u[1]];ed(w,e,i,l),p.push(w)}return p}function td(t,e,i,s){const l=Math.pow(2,s.z)*yo,u=[s.x*yo,s.y*yo],p=[];if(!t)return p;for(const v of t){const w=[];for(const S of v){const A=[S.x+u[0],S.y+u[1]];jl(e,A),w.push(A)}p.push(w)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of p)for(const w of v)ed(w,e,i,l)}var g;return p}class qo{constructor(e,i){this.type=ki,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ma(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const u=s.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new qo(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new qo(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new qo(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(s.type==="Polygon"){const g=Jh(s.coordinates,u,p),v=$l(i.geometry(),l,u,p);if(!Ul(l,u))return!1;for(const w of v)if(!$o(w,g))return!1}if(s.type==="MultiPolygon"){const g=Gl(s.coordinates,u,p),v=$l(i.geometry(),l,u,p);if(!Ul(l,u))return!1;for(const w of v)if(!bg(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(s.type==="Polygon"){const g=Jh(s.coordinates,u,p),v=td(i.geometry(),l,u,p);if(!Ul(l,u))return!1;for(const w of v)if(!vu(w,g))return!1}if(s.type==="MultiPolygon"){const g=Gl(s.coordinates,u,p),v=td(i.geometry(),l,u,p);if(!Ul(l,u))return!1;for(const w of v)if(!bp(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var wp={exports:{}};(function(t,e){t.exports=function(){var i={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},s=1/298.257223563,l=s*(2-s),u=Math.PI/180,p=function(A,C){if(A===void 0)throw new Error("No latitude given.");if(C&&!i[C])throw new Error("Unknown unit "+C+". Use one of: "+Object.keys(i).join(", "));var R=6378.137*u*(C?i[C]:1),L=Math.cos(A*u),O=1/(1-l*(1-L*L)),V=Math.sqrt(O);this.kx=R*V*L,this.ky=R*V*O*(1-l)},g={units:{configurable:!0}};function v(A,C){return A[0]===C[0]&&A[1]===C[1]}function w(A,C,R){var L=S(C[0]-A[0]);return[A[0]+L*R,A[1]+(C[1]-A[1])*R]}function S(A){for(;A<-180;)A+=360;for(;A>180;)A-=360;return A}return p.fromTile=function(A,C,R){var L=Math.PI*(1-2*(A+.5)/Math.pow(2,C)),O=Math.atan(.5*(Math.exp(L)-Math.exp(-L)))/u;return new p(O,R)},g.units.get=function(){return i},p.prototype.distance=function(A,C){var R=S(A[0]-C[0])*this.kx,L=(A[1]-C[1])*this.ky;return Math.sqrt(R*R+L*L)},p.prototype.bearing=function(A,C){var R=S(C[0]-A[0])*this.kx;return Math.atan2(R,(C[1]-A[1])*this.ky)/u},p.prototype.destination=function(A,C,R){var L=R*u;return this.offset(A,Math.sin(L)*C,Math.cos(L)*C)},p.prototype.offset=function(A,C,R){return[A[0]+C/this.kx,A[1]+R/this.ky]},p.prototype.lineDistance=function(A){for(var C=0,R=0;R<A.length-1;R++)C+=this.distance(A[R],A[R+1]);return C},p.prototype.area=function(A){for(var C=0,R=0;R<A.length;R++)for(var L=A[R],O=0,V=L.length,j=V-1;O<V;j=O++)C+=S(L[O][0]-L[j][0])*(L[O][1]+L[j][1])*(R?-1:1);return Math.abs(C)/2*this.kx*this.ky},p.prototype.along=function(A,C){var R=0;if(C<=0)return A[0];for(var L=0;L<A.length-1;L++){var O=A[L],V=A[L+1],j=this.distance(O,V);if((R+=j)>C)return w(O,V,(C-(R-j))/j)}return A[A.length-1]},p.prototype.pointToSegmentDistance=function(A,C,R){var L=C[0],O=C[1],V=S(R[0]-L)*this.kx,j=(R[1]-O)*this.ky,X=0;return V===0&&j===0||((X=(S(A[0]-L)*this.kx*V+(A[1]-O)*this.ky*j)/(V*V+j*j))>1?(L=R[0],O=R[1]):X>0&&(L+=V/this.kx*X,O+=j/this.ky*X)),V=S(A[0]-L)*this.kx,j=(A[1]-O)*this.ky,Math.sqrt(V*V+j*j)},p.prototype.pointOnLine=function(A,C){for(var R,L,O,V,j=1/0,X=0;X<A.length-1;X++){var ee=A[X][0],K=A[X][1],le=S(A[X+1][0]-ee)*this.kx,ie=(A[X+1][1]-K)*this.ky,ue=0;le===0&&ie===0||((ue=(S(C[0]-ee)*this.kx*le+(C[1]-K)*this.ky*ie)/(le*le+ie*ie))>1?(ee=A[X+1][0],K=A[X+1][1]):ue>0&&(ee+=le/this.kx*ue,K+=ie/this.ky*ue));var pe=(le=S(C[0]-ee)*this.kx)*le+(ie=(C[1]-K)*this.ky)*ie;pe<j&&(j=pe,R=ee,L=K,O=X,V=ue)}return{point:[R,L],index:O,t:Math.max(0,Math.min(1,V))}},p.prototype.lineSlice=function(A,C,R){var L=this.pointOnLine(R,A),O=this.pointOnLine(R,C);if(L.index>O.index||L.index===O.index&&L.t>O.t){var V=L;L=O,O=V}var j=[L.point],X=L.index+1,ee=O.index;!v(R[X],j[0])&&X<=ee&&j.push(R[X]);for(var K=X+1;K<=ee;K++)j.push(R[K]);return v(R[ee],O.point)||j.push(O.point),j},p.prototype.lineSliceAlong=function(A,C,R){for(var L=0,O=[],V=0;V<R.length-1;V++){var j=R[V],X=R[V+1],ee=this.distance(j,X);if((L+=ee)>A&&O.length===0&&O.push(w(j,X,(A-(L-ee))/ee)),L>=C)return O.push(w(j,X,(C-(L-ee))/ee)),O;L>A&&O.push(X)}return O},p.prototype.bufferPoint=function(A,C){var R=C/this.ky,L=C/this.kx;return[A[0]-L,A[1]-R,A[0]+L,A[1]+R]},p.prototype.bufferBBox=function(A,C){var R=C/this.ky,L=C/this.kx;return[A[0]-L,A[1]-R,A[2]+L,A[3]+R]},p.prototype.insideBBox=function(A,C){return S(A[0]-C[0])>=0&&S(A[0]-C[2])<=0&&A[1]>=C[1]&&A[1]<=C[3]},Object.defineProperties(p,g),p}()})(wp);var ql=dt(wp.exports),bu={exports:{}};(function(t,e){t.exports=function(){var i=function(l,u){if(l===void 0&&(l=[]),u===void 0&&(u=s),this.data=l,this.length=this.data.length,this.compare=u,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function s(l,u){return l<u?-1:l>u?1:0}return i.prototype.push=function(l){this.data.push(l),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var l=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),l}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(l){for(var u=this.data,p=this.compare,g=u[l];l>0;){var v=l-1>>1,w=u[v];if(p(g,w)>=0)break;u[l]=w,l=v}u[l]=g},i.prototype._down=function(l){for(var u=this.data,p=this.compare,g=this.length>>1,v=u[l];l<g;){var w=1+(l<<1),S=u[w],A=w+1;if(A<this.length&&p(u[A],S)<0&&(w=A,S=u[A]),p(S,v)>=0)break;u[l]=S,l=w}u[l]=v},i}()})(bu);var wu=dt(bu.exports),ut=8192;function Wo(t,e){return e.dist-t.dist}const id=100,nd=50;function Tp(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function Tu(t){return t[1]-t[0]+1}function Zs(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Mu(t,e){if(t[0]>t[1])return[null,null];const i=Tu(t);if(e){if(i===2)return[t,null];const s=Math.floor(i/2);return[[t[0],t[0]+s],[t[0]+s,t[1]]]}{if(i===1)return[t,null];const s=Math.floor(i/2)-1;return[[t[0],t[0]+s],[t[0]+s+1,t[1]]]}}function Qs(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!Zs(e,t.length))return i;for(let s=e[0];s<=e[1];++s)jl(i,t[s]);return i}function Su(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let s=0;s<t[i].length;++s)jl(e,t[i][s]);return e}function Aa(t,e,i){if(Tp(t)||Tp(e))return NaN;let s=0,l=0;return t[2]<e[0]&&(s=e[0]-t[2]),t[0]>e[2]&&(s=t[0]-e[2]),t[1]>e[3]&&(l=t[1]-e[3]),t[3]<e[1]&&(l=e[1]-t[3]),i.distance([0,0],[s,l])}function wg(t){return 360*t-180}function Tg(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function rd(t,e){const i=Math.pow(2,e.z),s=(t.y/ut+e.y)/i;return[wg((t.x/ut+e.x)/i),Tg(s)]}function Mg(t,e){const i=[];for(let s=0;s<t.length;++s)i.push(rd(t[s],e));return i}function Mp(t,e,i){const s=i.pointOnLine(e,t).point;return i.distance(t,s)}function Sp(t,e,i,s,l){const u=i.slice(s[0],s[1]+1);let p=1/0;for(let g=e[0];g<=e[1];++g)if((p=Math.min(p,Mp(t[g],u,l)))===0)return 0;return p}function sd(t,e,i,s,l){const u=Math.min(l.pointToSegmentDistance(t,i,s),l.pointToSegmentDistance(e,i,s)),p=Math.min(l.pointToSegmentDistance(i,t,e),l.pointToSegmentDistance(s,t,e));return Math.min(u,p)}function Ia(t,e,i,s,l){if(!Zs(e,t.length)||!Zs(s,i.length))return NaN;let u=1/0;for(let p=e[0];p<e[1];++p)for(let g=s[0];g<s[1];++g){if(Ea(t[p],t[p+1],i[g],i[g+1]))return 0;u=Math.min(u,sd(t[p],t[p+1],i[g],i[g+1],l))}return u}function Ep(t,e,i,s,l){if(!Zs(e,t.length)||!Zs(s,i.length))return NaN;let u=1/0;for(let p=e[0];p<=e[1];++p)for(let g=s[0];g<=s[1];++g)if((u=Math.min(u,l.distance(t[p],i[g])))===0)return u;return u}function Ap(t,e,i){if($o(t,e,!0))return 0;let s=1/0;for(const l of e){const u=l.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[u-1]&&(s=Math.min(s,i.pointToSegmentDistance(t,l[u-1],l[0])))===0||(s=Math.min(s,Mp(t,l,i)))===0)return s}return s}function Eu(t,e,i,s){if(!Zs(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if($o(t[u],i,!0))return 0;let l=1/0;for(let u=e[0];u<e[1];++u)for(const p of i)for(let g=0,v=p.length,w=v-1;g<v;w=g++){if(Ea(t[u],t[u+1],p[w],p[g]))return 0;l=Math.min(l,sd(t[u],t[u+1],p[w],p[g],s))}return l}function Ip(t,e){for(const i of t)for(let s=0;s<=i.length-1;++s)if($o(i[s],e,!0))return!0;return!1}function Sg(t,e,i,s=1/0){const l=Su(t),u=Su(e);if(s!==1/0&&Aa(l,u,i)>=s)return s;if(Ul(l,u)){if(Ip(t,e))return 0}else if(Ip(e,t))return 0;let p=s;for(const g of t)for(let v=0,w=g.length,S=w-1;v<w;S=v++)for(const A of e)for(let C=0,R=A.length,L=R-1;C<R;L=C++){if(Ea(g[S],g[v],A[L],A[C]))return 0;p=Math.min(p,sd(g[S],g[v],A[L],A[C],i))}return p}function ys(t,e,i,s,l,u,p){if(u===null||p===null)return;const g=Aa(Qs(s,u),Qs(l,p),i);g<e&&t.push({dist:g,range1:u,range2:p})}function Cp(t,e,i,s,l=1/0){let u=Math.min(s.distance(t[0],i[0][0]),l);if(u===0)return u;const p=new wu([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Wo),g=e?nd:id,v=Su(i);for(;p.length;){const w=p.pop();if(w.dist>=u)continue;const S=w.range1;if(Tu(S)<=g){if(!Zs(S,t.length))return NaN;if(e){const A=Eu(t,S,i,s);if((u=Math.min(u,A))===0)return u}else for(let A=S[0];A<=S[1];++A){const C=Ap(t[A],i,s);if((u=Math.min(u,C))===0)return u}}else{const A=Mu(S,e);if(A[0]!==null){const C=Aa(Qs(t,A[0]),v,s);C<u&&p.push({dist:C,range1:A[0],range2:[0,0]})}if(A[1]!==null){const C=Aa(Qs(t,A[1]),v,s);C<u&&p.push({dist:C,range1:A[1],range2:[0,0]})}}}return u}function Ho(t,e,i,s,l,u=1/0){let p=Math.min(u,l.distance(t[0],i[0]));if(p===0)return p;const g=new wu([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Wo),v=e?nd:id,w=s?nd:id;for(;g.length;){const S=g.pop();if(S.dist>=p)continue;const A=S.range1,C=S.range2;if(Tu(A)<=v&&Tu(C)<=w){if(!Zs(A,t.length)||!Zs(C,i.length))return NaN;if(e&&s?p=Math.min(p,Ia(t,A,i,C,l)):e||s?e&&!s?p=Math.min(p,Sp(i,C,t,A,l)):!e&&s&&(p=Math.min(p,Sp(t,A,i,C,l))):p=Math.min(p,Ep(t,A,i,C,l)),p===0)return p}else{const R=Mu(A,e),L=Mu(C,s);ys(g,p,l,t,i,R[0],L[0]),ys(g,p,l,t,i,R[0],L[1]),ys(g,p,l,t,i,R[1],L[0]),ys(g,p,l,t,i,R[1],L[1])}}return p}function od(t,e,i,s,l=1/0){let u=l;const p=Qs(t,[0,t.length-1]);for(const g of i)if(!(u!==1/0&&Aa(p,Qs(g,[0,g.length-1]),s)>=u)&&(u=Math.min(u,Ho(t,e,g,!0,s,u)),u===0))return u;return u}function Au(t,e,i,s,l=1/0){let u=l;const p=Qs(t,[0,t.length-1]);for(const g of i){if(u!==1/0&&Aa(p,Su(g),s)>=u)continue;const v=Cp(t,e,g,s,u);if(isNaN(v))return v;if((u=Math.min(u,v))===0)return u}return u}function ad(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Zo{constructor(e,i){this.type=Mt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ma(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let l=0;l<s.features.length;++l)if(ad(s.features[l].geometry.type))return new Zo(s,s.features[l].geometry)}else if(s.type==="Feature"){if(ad(s.geometry.type))return new Zo(s,s.geometry)}else if(ad(s.type))return new Zo(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return function(l,u,p){const g=[];for(const w of l)for(const S of w)g.push(rd(S,u));const v=new ql(g[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Ho(g,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v):p.type==="MultiLineString"?od(g,!1,p.coordinates,v):p.type==="Polygon"||p.type==="MultiPolygon"?Au(g,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,v):null}(i,s,this.geometries);if(e.geometryType()==="LineString")return function(l,u,p){const g=[];for(const w of l){const S=[];for(const A of w)S.push(rd(A,u));g.push(S)}const v=new ql(g[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return od(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",g,v);if(p.type==="MultiLineString"){let w=1/0;for(let S=0;S<p.coordinates.length;S++){const A=od(p.coordinates[S],!0,g,v,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}if(p.type==="Polygon"||p.type==="MultiPolygon"){let w=1/0;for(let S=0;S<g.length;S++){const A=Au(g[S],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,v,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return null}(i,s,this.geometries);if(e.geometryType()==="Polygon")return function(l,u,p){const g=[];for(const w of function(S,A){const C=S.length;if(C<=1)return[S];const R=[];let L,O;for(let V=0;V<C;V++){const j=yg(S[V]);j!==0&&(S[V].area=Math.abs(j),O===void 0&&(O=j<0),O===j<0?(L&&R.push(L),L=[S[V]]):L.push(S[V]))}return L&&R.push(L),R}(l)){const S=[];for(let A=0;A<w.length;++A)S.push(Mg(w[A],u));g.push(S)}const v=new ql(g[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Au(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",g,v);if(p.type==="MultiLineString"){let w=1/0;for(let S=0;S<p.coordinates.length;S++){const A=Au(p.coordinates[S],!0,g,v,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return p.type==="Polygon"||p.type==="MultiPolygon"?function(w,S,A){let C=1/0;for(const R of w)for(const L of S){const O=Sg(R,L,A,C);if(isNaN(O))return O;if((C=Math.min(C,O))===0)return C}return C}(p.type==="Polygon"?[p.coordinates]:p.coordinates,g,v):null}(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ld(t,e){switch(t){case"string":return Xr(e);case"number":return+e;case"boolean":return!!e;case"color":return Ni.parse(e);case"formatted":return lr.fromString(Xr(e));case"resolvedImage":return Ur.fromString(Xr(e))}return e}function cd(t,e,i,s){return s!==void 0&&(t=s*Math.round(t/s)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class xo{constructor(e,i,s){this.type=e,this.key=i,this.scope=s}static parse(e,i){let s=i.expectedType;if(s==null&&(s=Si),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const l=i.parse(e[1],1);if(!(l instanceof Ps))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const u=i.parse(e[2],2);return u instanceof Ps?new xo(s,Xr(l.value),Xr(u.value)):i.error("Scope of 'config' expression must be a string literal.")}return new xo(s,Xr(l.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(i);if(!s)return null;const{type:l,value:u,values:p,minValue:g,maxValue:v,stepValue:w}=s,S=s.default.evaluate(e);let A=S;if(u){const C=e.scope;e.scope=(C||"").split("").slice(1).join(""),A=u.evaluate(e),e.scope=C}return l&&(A=ld(l,A)),A===void 0||g===void 0&&v===void 0&&w===void 0||(typeof A=="number"?A=cd(A,g,v,w):Array.isArray(A)&&(A=A.map(C=>typeof C=="number"?cd(C,g,v,w):C))),u!==void 0&&A!==void 0&&p&&!p.includes(A)&&(A=S,l&&(A=ld(l,A))),(l&&l!==this.type||A!==void 0&&Ln(A)!==this.type)&&(A=ld(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function vo(t){if(t instanceof Rr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof qo||t instanceof Zo)return!1;let e=!0;return t.eachChild(i=>{e&&!vo(i)&&(e=!1)}),e}function Wl(t){if(t instanceof Rr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!Wl(i)&&(e=!1)}),e}function Hl(t){if(t instanceof xo)return!1;let e=!0;return t.eachChild(i=>{e&&!Hl(i)&&(e=!1)}),e}function Zl(t,e){if(t instanceof Rr&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(s=>{i&&!Zl(s,e)&&(i=!1)}),i}class Gr{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new Gr(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Iu{constructor(e,i=[],s,l=new _o,u=[],p,g){this.registry=e,this.path=i,this.key=i.map(v=>`[${v}]`).join(""),this.scope=l,this.errors=u,this.expectedType=s,this._scope=p,this.options=g}parse(e,i,s,l,u={}){return i||s?this.concat(i,s,l)._parse(e,u):this._parse(e,u)}_parse(e,i){function s(l,u,p){return p==="assert"?new gs(u,[l]):p==="coerce"?new Hs(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let u=l.parse(e,this);if(!u)return null;if(this.expectedType){const p=this.expectedType,g=u.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||g.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(p,g))return null}else u=s(u,p,i.typeAnnotation||"coerce");else u=s(u,p,i.typeAnnotation||"assert")}if(!(u instanceof Ps)&&u.type.kind!=="resolvedImage"&&Cu(u)){const p=new Qh(this._scope,this.options);try{u=new Ps(u.type,u.evaluate(p))}catch(g){return this.error(g.message),null}}return u}return Hs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const l=typeof e=="number"?this.path.concat(e):this.path,u=s?this.scope.concat(s):this.scope;return new Iu(this.registry,l,i||null,u,this.errors,this._scope,this.options)}error(e,...i){const s=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new _s(s,e))}checkSubtype(e,i){const s=Fl(e,i);return s&&this.error(s),s}}function Cu(t){if(t instanceof Gr)return Cu(t.boundExpression);if(t instanceof Rr&&t.name==="error"||t instanceof Vl||t instanceof qo||t instanceof Zo||t instanceof xo)return!1;const e=t instanceof Hs||t instanceof gs;let i=!0;return t.eachChild(s=>{i=e?i&&Cu(s):i&&s instanceof Ps}),!!i&&vo(t)&&Zl(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Pu(t,e){const i=t.length-1;let s,l,u=0,p=i,g=0;for(;u<=p;)if(g=Math.floor((u+p)/2),s=t[g],l=t[g+1],s<=e){if(g===i||e<l)return g;u=g+1}else{if(!(s>e))throw new $n("Input is not a number.");p=g-1}return 0}class Ql{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[l,u]of s)this.labels.push(l),this.outputs.push(u)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Mt);if(!s)return null;const l=[];let u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let p=1;p<e.length;p+=2){const g=p===1?-1/0:e[p],v=e[p+1],w=p,S=p+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const A=i.parse(v,S,u);if(!A)return null;u=u||A.type,l.push([g,A])}return new Ql(u,s,l)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return s[0].evaluate(e);const u=i.length;return l>=i[u-1]?s[u-1].evaluate(e):s[Pu(i,l)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Pp=.95047,Dp=1.08883,Du=4/29,Qo=6/29,Rp=3*Qo*Qo,zp=Qo*Qo*Qo,Eg=Math.PI/180,Lp=180/Math.PI;function Ca(t){return t>zp?Math.pow(t,1/3):t/Rp+Du}function ud(t){return t>Qo?t*t*t:Rp*(t-Du)}function hd(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function dd(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function kp(t){const e=dd(t.r),i=dd(t.g),s=dd(t.b),l=Ca((.4124564*e+.3575761*i+.1804375*s)/Pp),u=Ca((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-Ca((.0193339*e+.119192*i+.9503041*s)/Dp)),alpha:t.a}}function Op(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*ud(e),i=Pp*ud(i),s=Dp*ud(s),new Ni(hd(3.2404542*i-1.5371385*e-.4985314*s),hd(-.969266*i+1.8760108*e+.041556*s),hd(.0556434*i-.2040259*e+1.0572252*s),t.alpha)}function Ru(t,e,i){const s=e-t;return t+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const bo={forward:kp,reverse:Op,interpolate:function(t,e,i){return{l:ai(t.l,e.l,i),a:ai(t.a,e.a,i),b:ai(t.b,e.b,i),alpha:ai(t.alpha,e.alpha,i)}}},cr={forward:function(t){const{l:e,a:i,b:s}=kp(t),l=Math.atan2(s,i)*Lp;return{h:l<0?l+360:l,c:Math.sqrt(i*i+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Eg,i=t.c;return Op({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Ru(t.h,e.h,i),c:ai(t.c,e.c,i),l:ai(t.l,e.l,i),alpha:ai(t.alpha,e.alpha,i)}}};var Xl=Object.freeze({__proto__:null,hcl:cr,lab:bo});class $r{constructor(e,i,s,l,u){this.type=e,this.operator=i,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[p,g]of u)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,i,s,l){let u=0;if(e.name==="exponential")u=fd(i,e.base,s,l);else if(e.name==="linear")u=fd(i,1,s,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new rp(p[0],p[1],p[2],p[3]).solve(fd(i,1,s,l))}return u}static parse(e,i){let[s,l,u,...p]=e;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(S=>typeof S!="number"||S<0||S>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,Mt),!u)return null;const g=[];let v=null;s==="interpolate-hcl"||s==="interpolate-lab"?v=jr:i.expectedType&&i.expectedType.kind!=="value"&&(v=i.expectedType);for(let w=0;w<p.length;w+=2){const S=p[w],A=p[w+1],C=w+3,R=w+4;if(typeof S!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(g.length&&g[g.length-1][0]>=S)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const L=i.parse(A,R,v);if(!L)return null;v=v||L.type,g.push([S,L])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new $r(v,s,l,u,g):i.error(`Type ${Sn(v)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return s[0].evaluate(e);const u=i.length;if(l>=i[u-1])return s[u-1].evaluate(e);const p=Pu(i,l),g=$r.interpolationFactor(this.interpolation,l,i[p],i[p+1]),v=s[p].evaluate(e),w=s[p+1].evaluate(e);return this.operator==="interpolate"?kl[this.type.kind.toLowerCase()](v,w,g):this.operator==="interpolate-hcl"?cr.reverse(cr.interpolate(cr.forward(v),cr.forward(w),g)):bo.reverse(bo.interpolate(bo.forward(v),bo.forward(w),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function fd(t,e,i,s){const l=s-i,u=t-i;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}class zu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const l=i.expectedType;l&&l.kind!=="value"&&(s=l);const u=[];for(const g of e.slice(1)){const v=i.parse(g,1+u.length,s,void 0,{typeAnnotation:"omit"});if(!v)return null;s=s||v.type,u.push(v)}const p=l&&u.some(g=>Fl(l,g.type));return new zu(p?Si:s,u)}evaluate(e){let i,s=null,l=0;for(const u of this.args){if(l++,s=u.evaluate(e),s&&s instanceof Ur&&!s.available&&(i||(i=s),s=null,l===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Lu{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);const g=i.parse(e[u+1],u+1);if(!g)return null;s.push([p,g])}const l=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return l?new Lu(s,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class Yl{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Mt),l=i.parse(e[2],2,Yn(i.expectedType||Si));return s&&l?new Yl(l.type.itemType,s,l):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new $n(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new $n(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new $n(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class pd{constructor(e,i){this.type=ki,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Si),l=i.parse(e[2],2,Si);return s&&l?Bl(s.type,[ki,Li,Mt,ui,Si])?new pd(s,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Go(i,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(Ln(i))} instead.`);if(!Go(s,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${Sn(Ln(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Pa{constructor(e,i,s){this.type=Mt,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Si),l=i.parse(e[2],2,Si);if(!s||!l)return null;if(!Bl(s.type,[ki,Li,Mt,ui,Si]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(s.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,Mt);return u?new Pa(s,l,u):null}return new Pa(s,l)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Go(i,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(Ln(i))} instead.`);if(!Go(s,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${Sn(Ln(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(i,l)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class md{constructor(e,i,s,l,u,p){this.inputType=e,this.type=i,this.input=s,this.cases=l,this.outputs=u,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const u={},p=[];for(let w=2;w<e.length-1;w+=2){let S=e[w];const A=e[w+1];Array.isArray(S)||(S=[S]);const C=i.concat(w);if(S.length===0)return C.error("Expected at least one branch label.");for(const L of S){if(typeof L!="number"&&typeof L!="string")return C.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return C.error("Numeric branch labels must be integer values.");if(s){if(C.checkSubtype(s,Ln(L)))return null}else s=Ln(L);if(u[String(L)]!==void 0)return C.error("Branch labels must be unique.");u[String(L)]=p.length}const R=i.parse(A,w,l);if(!R)return null;l=l||R.type,p.push(R)}const g=i.parse(e[1],1,Si);if(!g)return null;const v=i.parse(e[e.length-1],e.length-1,l);return v?g.type.kind!=="value"&&i.concat(1).checkSubtype(s,g.type)?null:new md(s,l,g,u,p,v):null}evaluate(e){const i=this.input.evaluate(e);return(Ln(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],l={};for(const p of i){const g=l[this.cases[p]];g===void 0?(l[this.cases[p]]=s.length,s.push([this.cases[p],[p]])):s[g][1].push(p)}const u=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,g]of s)e.push(g.length===1?u(g[0]):g.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class _d{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const g=i.parse(e[p],p,ki);if(!g)return null;const v=i.parse(e[p+1],p+1,s);if(!v)return null;l.push([g,v]),s=s||v.type}const u=i.parse(e[e.length-1],e.length-1,s);return u?new _d(s,l,u):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Da{constructor(e,i,s,l){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Si),l=i.parse(e[2],2,Mt);if(!s||!l)return null;if(!Bl(s.type,[Yn(Si),Li,Si]))return i.error(`Expected first argument to be of type array or string, but found ${Sn(s.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,Mt);return u?new Da(s.type,s,l,u):null}return new Da(s.type,s,l)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Go(i,["string","array"]))throw new $n(`Expected first argument to be of type array or string, but found ${Sn(Ln(i))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return i.slice(s,l)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Fp(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function gd(t,e,i,s){return s.compare(e,i)===0}function Xo(t,e,i){const s=t!=="=="&&t!=="!=";return class HM{constructor(u,p,g){this.type=ki,this.lhs=u,this.rhs=p,this.collator=g,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const g=u[0];let v=p.parse(u[1],1,Si);if(!v)return null;if(!Fp(g,v.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${Sn(v.type)}'.`);let w=p.parse(u[2],2,Si);if(!w)return null;if(!Fp(g,w.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${Sn(w.type)}'.`);if(v.type.kind!==w.type.kind&&v.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Sn(v.type)}' and '${Sn(w.type)}'.`);s&&(v.type.kind==="value"&&w.type.kind!=="value"?v=new gs(w.type,[v]):v.type.kind!=="value"&&w.type.kind==="value"&&(w=new gs(v.type,[w])));let S=null;if(u.length===4){if(v.type.kind!=="string"&&w.type.kind!=="string"&&v.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(S=p.parse(u[3],3,Ol),!S)return null}return new HM(v,w,S)}evaluate(u){const p=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(s&&this.hasUntypedArgument){const v=Ln(p),w=Ln(g);if(v.kind!==w.kind||v.kind!=="string"&&v.kind!=="number")throw new $n(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${v.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const v=Ln(p),w=Ln(g);if(v.kind!=="string"||w.kind!=="string")return e(u,p,g)}return this.collator?i(u,p,g,this.collator.evaluate(u)):e(u,p,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[t];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const Ag=Xo("==",function(t,e,i){return e===i},gd),yd=Xo("!=",function(t,e,i){return e!==i},function(t,e,i,s){return!gd(0,e,i,s)}),ku=Xo("<",function(t,e,i){return e<i},function(t,e,i,s){return s.compare(e,i)<0}),Bp=Xo(">",function(t,e,i){return e>i},function(t,e,i,s){return s.compare(e,i)>0}),Ig=Xo("<=",function(t,e,i){return e<=i},function(t,e,i,s){return s.compare(e,i)<=0}),Np=Xo(">=",function(t,e,i){return e>=i},function(t,e,i,s){return s.compare(e,i)>=0});class xd{constructor(e,i,s,l,u,p){this.type=Li,this.number=e,this.locale=i,this.currency=s,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Mt);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=i.parse(l.locale,1,Li),!u))return null;let p=null;if(l.currency&&(p=i.parse(l.currency,1,Li),!p))return null;let g=null;if(l.unit&&(g=i.parse(l.unit,1,Li),!g))return null;let v=null;if(l["min-fraction-digits"]&&(v=i.parse(l["min-fraction-digits"],1,Mt),!v))return null;let w=null;return l["max-fraction-digits"]&&(w=i.parse(l["max-fraction-digits"],1,Mt),!w)?null:new xd(s,u,p,g,v,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Kl{constructor(e){this.type=Mt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Sn(s.type)} instead.`):new Kl(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new $n(`Expected value to be of type string or array, but found ${Sn(Ln(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Vp(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ra={"==":Ag,"!=":yd,">":Bp,"<":ku,">=":Np,"<=":Ig,array:gs,at:Yl,boolean:gs,case:_d,coalesce:zu,collator:Vl,format:Nl,image:Sa,in:pd,"index-of":Pa,interpolate:$r,"interpolate-hcl":$r,"interpolate-lab":$r,length:Kl,let:Lu,literal:Ps,match:md,number:gs,"number-format":xd,object:gs,slice:Da,step:Ql,string:gs,"to-boolean":Hs,"to-color":Hs,"to-number":Hs,"to-string":Hs,var:Gr,within:qo,distance:Zo,config:xo};function jp(t,[e,i,s,l]){e=e.evaluate(t),i=i.evaluate(t),s=s.evaluate(t);const u=l?l.evaluate(t):1,p=xp(e,i,s,u);if(p)throw new $n(p);return new Ni(e/255*u,i/255*u,s/255*u,u)}function Up(t,[e,i,s,l]){e=e.evaluate(t),i=i.evaluate(t),s=s.evaluate(t);const u=l?l.evaluate(t):1,p=function(w,S,A,C){return typeof w=="number"&&w>=0&&w<=360?typeof S=="number"&&S>=0&&S<=100&&typeof A=="number"&&A>=0&&A<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[w,S,A,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[w,S,A,C]:[w,S,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[w,S,A,C]:[w,S,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,s,u);if(p)throw new $n(p);const g=`hsla(${e}, ${i}%, ${s}%, ${u})`,v=Ni.parse(g);if(!v)throw new $n(`Failed to parse HSLA color: ${g}`);return v}function vd(t,e){return t in e}function bd(t,e){const i=e[t];return i===void 0?null:i}function Yo(t){return{type:t}}function Gp(t){return{result:"success",value:t}}function Ko(t){return{result:"error",value:t}}function $p(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Ou(t){return t["property-type"]==="data-driven"}function qp(t){return $p(t.expression,"measure-light")}function Wp(t){return $p(t.expression,"zoom")}function za(t){return!!t.expression&&t.expression.interpolated}function wd(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Cg(t){return t}function Jl(t,e){const i=e.type==="color",s=t.stops&&typeof t.stops[0][0]=="object",l=s||!(s||t.property!==void 0),u=t.type||(za(e)?"exponential":"interval");if(i&&((t=gu({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Ni.parse(w[1])])),t.default=Ni.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Xl[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,g,v;if(u==="exponential")p=Td;else if(u==="interval")p=Pg;else if(u==="categorical"){p=Hp,g=Object.create(null);for(const w of t.stops)g[w[0]]=w[1];v=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=Zp}if(s){const w={},S=[];for(let R=0;R<t.stops.length;R++){const L=t.stops[R],O=L[0].zoom;w[O]===void 0&&(w[O]={zoom:O,type:t.type,property:t.property,default:t.default,stops:[]},S.push(O)),w[O].stops.push([L[0].value,L[1]])}const A=[];for(const R of S)A.push([w[R].zoom,Jl(w[R],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:$r.interpolationFactor.bind(void 0,C),zoomStops:A.map(R=>R[0]),evaluate:({zoom:R},L)=>Td({stops:A,base:t.base},e,R).evaluate(R,L)}}if(l){const w=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:$r.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(S=>S[0]),evaluate:({zoom:S})=>p(t,e,S,g,v)}}return{kind:"source",evaluate(w,S){const A=S&&S.properties?S.properties[t.property]:void 0;return A===void 0?ec(t.default,e.default):p(t,e,A,g,v)}}}function ec(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function Hp(t,e,i,s,l){return ec(typeof i===l?s[i]:void 0,t.default,e.default)}function Pg(t,e,i){if(go(i)!=="number")return ec(t.default,e.default);const s=t.stops.length;if(s===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];const l=Pu(t.stops.map(u=>u[0]),i);return t.stops[l][1]}function Td(t,e,i){const s=t.base!==void 0?t.base:1;if(go(i)!=="number")return ec(t.default,e.default);const l=t.stops.length;if(l===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[l-1][0])return t.stops[l-1][1];const u=Pu(t.stops.map(S=>S[0]),i),p=function(S,A,C,R){const L=R-C,O=S-C;return L===0?0:A===1?O/L:(Math.pow(A,O)-1)/(Math.pow(A,L)-1)}(i,s,t.stops[u][0],t.stops[u+1][0]),g=t.stops[u][1],v=t.stops[u+1][1];let w=kl[e.type]||Cg;if(t.colorSpace&&t.colorSpace!=="rgb"){const S=Xl[t.colorSpace];w=(A,C)=>S.reverse(S.interpolate(S.forward(A),S.forward(C),p))}return typeof g.evaluate=="function"?{evaluate(...S){const A=g.evaluate.apply(void 0,S),C=v.evaluate.apply(void 0,S);if(A!==void 0&&C!==void 0)return w(A,C,p)}}:w(g,v,p)}function Zp(t,e,i){return e.type==="color"?i=Ni.parse(i):e.type==="formatted"?i=lr.fromString(i.toString()):e.type==="resolvedImage"?i=Ur.fromString(i.toString()):go(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ec(i,t.default,e.default)}Rr.register(Ra,{error:[{kind:"error"},[Li],(t,[e])=>{throw new $n(e.evaluate(t))}],typeof:[Li,[Si],(t,[e])=>Sn(Ln(e.evaluate(t)))],"to-rgba":[Yn(Mt,4),[jr],(t,[e])=>e.evaluate(t).toArray()],rgb:[jr,[Mt,Mt,Mt],jp],rgba:[jr,[Mt,Mt,Mt,Mt],jp],hsl:[jr,[Mt,Mt,Mt],Up],hsla:[jr,[Mt,Mt,Mt,Mt],Up],has:{type:ki,overloads:[[[Li],(t,[e])=>vd(e.evaluate(t),t.properties())],[[Li,ba],(t,[e,i])=>vd(e.evaluate(t),i.evaluate(t))]]},get:{type:Si,overloads:[[[Li],(t,[e])=>bd(e.evaluate(t),t.properties())],[[Li,ba],(t,[e,i])=>bd(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Si,[Li],(t,[e])=>bd(e.evaluate(t),t.featureState||{})],properties:[ba,[],t=>t.properties()],"geometry-type":[Li,[],t=>t.geometryType()],id:[Si,[],t=>t.id()],zoom:[Mt,[],t=>t.globals.zoom],pitch:[Mt,[],t=>t.globals.pitch||0],"distance-from-center":[Mt,[],t=>t.distanceFromCenter()],"measure-light":[Mt,[Li],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Mt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Mt,[],t=>t.globals.lineProgress||0],"raster-value":[Mt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[Mt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[Mt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Si,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Mt,Yo(Mt),(t,e)=>{let i=0;for(const s of e)i+=s.evaluate(t);return i}],"*":[Mt,Yo(Mt),(t,e)=>{let i=1;for(const s of e)i*=s.evaluate(t);return i}],"-":{type:Mt,overloads:[[[Mt,Mt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Mt],(t,[e])=>-e.evaluate(t)]]},"/":[Mt,[Mt,Mt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Mt,[Mt,Mt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Mt,[Mt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Mt,[Mt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Mt,[Mt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Mt,[Mt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Mt,[Mt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Mt,[Mt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Mt,[Mt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Mt,Yo(Mt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Mt,Yo(Mt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Mt,[Mt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Mt,[Mt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Mt,[Mt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Mt,[Mt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ki,[Li,Si],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ki,[Si],(t,[e])=>t.id()===e.value],"filter-type-==":[ki,[Li],(t,[e])=>t.geometryType()===e.value],"filter-<":[ki,[Li,Si],(t,[e,i])=>{const s=t.properties()[e.value],l=i.value;return typeof s==typeof l&&s<l}],"filter-id-<":[ki,[Si],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[ki,[Li,Si],(t,[e,i])=>{const s=t.properties()[e.value],l=i.value;return typeof s==typeof l&&s>l}],"filter-id->":[ki,[Si],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[ki,[Li,Si],(t,[e,i])=>{const s=t.properties()[e.value],l=i.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[ki,[Si],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[ki,[Li,Si],(t,[e,i])=>{const s=t.properties()[e.value],l=i.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[ki,[Si],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[ki,[Si],(t,[e])=>e.value in t.properties()],"filter-has-id":[ki,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[ki,[Yn(Li)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ki,[Yn(Si)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ki,[Li,Yn(Si)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ki,[Li,Yn(Si)],(t,[e,i])=>function(s,l,u,p){for(;u<=p;){const g=u+p>>1;if(l[g]===s)return!0;l[g]>s?p=g-1:u=g+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ki,overloads:[[[ki,ki],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Yo(ki),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ki,overloads:[[[ki,ki],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Yo(ki),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ki,[ki],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ki,[Li],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Li,[Li],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Li,[Li],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Li,Yo(Si),(t,e)=>e.map(i=>Xr(i.evaluate(t))).join("")],"resolved-locale":[Li,[Ol],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Mt,[Mt,Mt,Si],(t,e)=>{const[i,s,l]=e.map(p=>p.evaluate(t));if(i>s||i===s)return i;let u;if(typeof l=="string")u=function(p){let g=0;if(p.length===0)return g;for(let v=0;v<p.length;v++)g=(g<<5)-g+p.charCodeAt(v),g|=0;return g}(l);else{if(typeof l!="number")throw new $n(`Invalid seed input: ${l}`);u=l}return i+Vp(u)()*(s-i)}]});class Fu{constructor(e,i,s,l){this.expression=e,this._warningHistory={},this._evaluator=new Qh(s,l),this._defaultValue=i?function(u){return u.type==="color"&&(wd(u.default)||Array.isArray(u.default))?new Ni(0,0,0,0):u.type==="color"?Ni.parse(u.default)||null:u.default===void 0?null:u.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,s,l,u,p,g,v){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,l,u,p,g,v){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new $n(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Bu(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ra}function La(t,e,i,s){const l=new Iu(Ra,[],e?function(p){const g={color:jr,string:Li,number:Mt,enum:Li,boolean:ki,formatted:wa,resolvedImage:Ta};return p.type==="array"?Yn(g[p.value]||Si,p.length):g[p.type]}(e):void 0,void 0,void 0,i,s),u=l.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Gp(new Fu(u,e,i,s)):Ko(l.errors)}class tc{constructor(e,i,s){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isStateDependent=e!=="constant"&&!Wl(i.expression),this.isConfigDependent=!Hl(i.expression)}evaluateWithoutErrorHandling(e,i,s,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,l,u,p)}evaluate(e,i,s,l,u,p){return this._styleExpression.evaluate(e,i,s,l,u,p)}}class ic{constructor(e,i,s,l,u){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Wl(i.expression),this.isLightConstant=u,this.isConfigDependent=!Hl(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,i,s,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,l,u,p)}evaluate(e,i,s,l,u,p){return this._styleExpression.evaluate(e,i,s,l,u,p)}interpolationFactor(e,i,s){return this.interpolationType?$r.interpolationFactor(this.interpolationType,e,i,s):0}}function Qp(t,e,i,s){if((t=La(t,e,i,s)).result==="error")return t;const l=t.value.expression,u=vo(l);if(!u&&!Ou(e))return Ko([new _s("","data expressions not supported")]);const p=Zl(l,["zoom","pitch","distance-from-center"]);if(!p&&!Wp(e))return Ko([new _s("","zoom expressions not supported")]);const g=Zl(l,["measure-light"]);if(!g&&!qp(e))return Ko([new _s("","measure-light expression not supported")]);const v=e.expression&&e.expression.relaxZoomRestriction,w=Nu(l);return w||p||v?w instanceof _s?Ko([w]):w instanceof $r&&!za(e)?Ko([new _s("",'"interpolate" expressions cannot be used with this property')]):Gp(w?new ic(u?"camera":"composite",t.value,w.labels,w instanceof $r?w.interpolation:void 0,g):new tc(u?"constant":"source",t.value,g)):Ko([new _s("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class nc{constructor(e,i){this._parameters=e,this._specification=i,gu(this,Jl(this._parameters,this._specification))}static deserialize(e){return new nc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Nu(t){let e=null;if(t instanceof Lu)e=Nu(t.result);else if(t instanceof zu){for(const i of t.args)if(e=Nu(i),e)break}else(t instanceof Ql||t instanceof $r)&&t.input instanceof Rr&&t.input.name==="zoom"&&(e=t);return e instanceof _s||t.eachChild(i=>{const s=Nu(i);s instanceof _s?e=s:e&&s&&e!==s&&(e=new _s("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Xp=Ds,wo=3;function Ds(t,e,i){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(i=l[2]);for(var u=0;u<this.d*this.d;u++){var p=l[wo+u],g=l[wo+u+1];s.push(p===g?null:l.subarray(p,g))}var v=l[wo+s.length+1];this.keys=l.subarray(l[wo+s.length],v),this.bboxes=l.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var S=i/e*t;this.min=-S,this.max=t+S}Ds.prototype.insert=function(t,e,i,s,l){this._forEachCell(e,i,s,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(l)},Ds.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ds.prototype._insertCell=function(t,e,i,s,l,u){this.cells[l].push(u)},Ds.prototype.query=function(t,e,i,s,l){var u=this.min,p=this.max;if(t<=u&&e<=u&&p<=i&&p<=s&&!l)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,i,s,this._queryCell,g,{},l),g},Ds.prototype._queryCell=function(t,e,i,s,l,u,p,g){var v=this.cells[l];if(v!==null)for(var w=this.keys,S=this.bboxes,A=0;A<v.length;A++){var C=v[A];if(p[C]===void 0){var R=4*C;(g?g(S[R+0],S[R+1],S[R+2],S[R+3]):t<=S[R+2]&&e<=S[R+3]&&i>=S[R+0]&&s>=S[R+1])?(p[C]=!0,u.push(w[C])):p[C]=!1}}},Ds.prototype._forEachCell=function(t,e,i,s,l,u,p,g){for(var v=this._convertToCellCoord(t),w=this._convertToCellCoord(e),S=this._convertToCellCoord(i),A=this._convertToCellCoord(s),C=v;C<=S;C++)for(var R=w;R<=A;R++){var L=this.d*R+C;if((!g||g(this._convertFromCellCoord(C),this._convertFromCellCoord(R),this._convertFromCellCoord(C+1),this._convertFromCellCoord(R+1)))&&l.call(this,t,e,i,s,L,u,p,g))return}},Ds.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ds.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ds.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=wo+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var l=new Int32Array(e+i+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,p=0;p<t.length;p++){var g=t[p];l[wo+p]=u,l.set(g,u),u+=g.length}return l[wo+t.length]=u,l.set(this.keys,u),l[wo+t.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};var ka=dt(Xp);const Vu={};function St(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Vu[e]={klass:t,omit:i.omit||[]}}St(Object,"Object"),ka.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},ka.deserialize=function(t){return new ka(t.buffer)},Object.defineProperty(ka,"name",{value:"Grid"}),St(ka,"Grid"),St(Ni,"Color"),St(Error,"Error"),St(lr,"Formatted"),St(yu,"FormattedSection"),St(ou,"AJAXError"),St(Ur,"ResolvedImage"),St(nc,"StylePropertyFunction"),St(Fu,"StyleExpression",{omit:["_evaluator"]}),St(ic,"ZoomDependentExpression"),St(tc,"ZoomConstantExpression"),St(Rr,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ra)Vu[Ra[t]._classRegistryKey]||St(Ra[t],`Expression${t}`);function Yp(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Kp(t){return self.ImageBitmap&&t instanceof ImageBitmap}function rc(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Yp(t)||Kp(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const s of t)i.push(rc(s,e));return i}if(t instanceof Map){const i={$name:"Map"};for(const[s,l]of t.entries())i[s]=rc(l);return i}if(typeof t=="object"){const i=t.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const l=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const u in t)t.hasOwnProperty(u)&&(Vu[s].omit.indexOf(u)>=0||(l[u]=rc(t[u],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof t)}function h(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Yp(t)||Kp(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(h);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const l=new Map;for(const u of Object.keys(t))u!=="$name"&&l.set(u,h(t[u]));return l}const{klass:i}=Vu[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const s=Object.create(i.prototype);for(const l of Object.keys(t))l!=="$name"&&(s[l]=h(t[l]));return s}throw new Error("can't deserialize object of type "+typeof t)}const n={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function o(t){for(const e of t)if(y(e.charCodeAt(0)))return!0;return!1}function f(t){for(const e of t)if(!_(e.charCodeAt(0)))return!1;return!0}function _(t){return!(n.Arabic(t)||n["Arabic Supplement"](t)||n["Arabic Extended-A"](t)||n["Arabic Presentation Forms-A"](t)||n["Arabic Presentation Forms-B"](t))}function y(t){return!(t!==746&&t!==747&&(t<4352||!(n["Bopomofo Extended"](t)||n.Bopomofo(t)||n["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||n["CJK Compatibility Ideographs"](t)||n["CJK Compatibility"](t)||n["CJK Radicals Supplement"](t)||n["CJK Strokes"](t)||!(!n["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||n["CJK Unified Ideographs Extension A"](t)||n["CJK Unified Ideographs"](t)||n["Enclosed CJK Letters and Months"](t)||n["Hangul Compatibility Jamo"](t)||n["Hangul Jamo Extended-A"](t)||n["Hangul Jamo Extended-B"](t)||n["Hangul Jamo"](t)||n["Hangul Syllables"](t)||n.Hiragana(t)||n["Ideographic Description Characters"](t)||n.Kanbun(t)||n["Kangxi Radicals"](t)||n["Katakana Phonetic Extensions"](t)||n.Katakana(t)&&t!==12540||!(!n["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!n["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||n["Unified Canadian Aboriginal Syllabics"](t)||n["Unified Canadian Aboriginal Syllabics Extended"](t)||n["Vertical Forms"](t)||n["Yijing Hexagram Symbols"](t)||n["Yi Syllables"](t)||n["Yi Radicals"](t))))}function b(t){return!(y(t)||function(e){return!!(n["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||n["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||n["Letterlike Symbols"](e)||n["Number Forms"](e)||n["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||n["Control Pictures"](e)&&e!==9251||n["Optical Character Recognition"](e)||n["Enclosed Alphanumerics"](e)||n["Geometric Shapes"](e)||n["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||n["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||n["CJK Symbols and Punctuation"](e)||n.Katakana(e)||n["Private Use Area"](e)||n["CJK Compatibility Forms"](e)||n["Small Form Variants"](e)||n["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function M(t){return t>=1424&&t<=2303||n["Arabic Presentation Forms-A"](t)||n["Arabic Presentation Forms-B"](t)}function I(t,e){return!(!e&&M(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||n.Khmer(t))}function D(t){for(const e of t)if(M(e.charCodeAt(0)))return!0;return!1}const z="deferred",k="loading",F="loaded";let N=null,G="unavailable",U=null;const $=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(G="error"),N&&N(t)};function q(){Y.fire(new mo("pluginStateChange",{pluginStatus:G,pluginURL:U}))}const Y=new Uo,re=function(){return G},ne=function(){if(G!==z||!U)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");G=k,q(),U&&Al({url:U},t=>{t?$(t):(G=F,q())})},oe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>G===F||oe.applyArabicShaping!=null,isLoading:()=>G===k,setState(t){G=t.pluginStatus,U=t.pluginURL},isParsed:()=>oe.applyArabicShaping!=null&&oe.processBidirectionalText!=null&&oe.processStyledBidirectionalText!=null,getPluginURL:()=>U};class H{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,s){for(const l of i)if(!I(l.charCodeAt(0),s))return!1;return!0}(e,oe.isLoaded())}}class J{constructor(e,i,s,l){this.property=e,this.value=i,this.expression=function(u,p,g,v){if(wd(u))return new nc(u,p);if(Bu(u)||Array.isArray(u)&&u.length>0){const w=Qp(u,p,g,v);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));return w.value}{let w=u;return typeof u=="string"&&p.type==="color"&&(w=Ni.parse(u)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(i===void 0?e.specification.default:i,e.specification,s,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class he{constructor(e,i,s){this.property=e,this.value=new J(e,void 0,i,s)}transitioned(e,i){return new ge(this.property,this.value,i,Qr({},e.transition,this.transition),e.now)}untransitioned(){return new ge(this.property,this.value,null,{},0)}}class ce{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this.isConfigDependent=!1}getValue(e){return $s(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new he(this._values[e].property,this._scope,this._options)),this._values[e].value=new J(this._values[e].property,i===null?void 0:$s(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const l in e){const u=e[l];if(Bo(l,"-transition")){const p=l.slice(0,-11);s[p]&&this.setTransition(p,u)}else s[l]&&this.setValue(l,u)}}getTransition(e){return $s(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new he(this._values[e].property)),this._values[e].transition=$s(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const l=this.getTransition(i);l!==void 0&&(e[`${i}-transition`]=l)}return e}transitioned(e,i){const s=new Ae(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,i._values[l]);return s}untransitioned(){const e=new Ae(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ge{constructor(e,i,s,l,u){const p=l.delay||0,g=l.duration||0;u=u||0,this.property=e,this.value=i,this.begin=u+p,this.end=this.begin+g,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const l=e.now||0,u=this.value.possiblyEvaluate(e,i,s),p=this.prior;if(p){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return p.possiblyEvaluate(e,i,s);{const g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,s),u,Zc(g))}}return u}}class Ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const l=new Pe(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,i,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class _e{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this.isConfigDependent=!1}getValue(e){return $s(this._values[e].value)}setValue(e,i){this._values[e]=new J(this._values[e].property,i===null?void 0:$s(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const l=new Pe(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,i,s);return l}}class Te{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,l){return this.property.evaluate(this.value,this.parameters,e,i,s,l)}}class Pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class me{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const l=kl[this.specification.type];return l?l(e,i,s):e}}class be{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,l){return new Te(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,l)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Te(this,{kind:"constant",value:void 0},e.parameters);const l=kl[this.specification.type];return l?new Te(this,{kind:"constant",value:l(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,l,u,p){return e.kind==="constant"?e.value:e.evaluate(i,s,l,u,p)}}class Ze{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,l){return!!e.expression.evaluate(i,null,{},s,l)}interpolate(){return!1}}class ye{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new H(0,{});for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const u=this.defaultPropertyValues[s]=new J(l,void 0),p=this.defaultTransitionablePropertyValues[s]=new he(l);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate(i)}}}function Se(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ie(t){if(Array.isArray(t))return t.map(Ie);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Ie(t[i]);return e}return Se(t)}St(be,"DataDrivenProperty"),St(me,"DataConstantProperty"),St(Ze,"ColorRampProperty");var se=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function je(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!je(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function vt(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};je(t)||(t=xi(t));const i=t;let s=!0;try{s=function(w){if(!Pt(w))return w;let S=Ie(w);return Ot(S),S=At(S),S}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const l=se[`filter_${e}`],u=La(s,l);let p=null;if(u.result==="error")throw new Error(u.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,S,A)=>u.value.evaluate(w,S,{},A);let g=null,v=null;if(s!==i){const w=La(i,l);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));g=(S,A,C,R,L)=>w.value.evaluate(S,A,{},C,void 0,void 0,R,L),v=!vo(w.value.expression)}return{filter:p,dynamicFilter:g||void 0,needGeometry:Zt(s),needFeature:!!v}}function At(t){if(!Array.isArray(t))return t;const e=function(i){if(Bt.has(i[0])){for(let s=1;s<i.length;s++)if(Pt(i[s]))return!0}return i}(t);return e===!0?e:e.map(i=>At(i))}function Ot(t){let e=!1;const i=[];if(t[0]==="case"){for(let s=1;s<t.length-1;s+=2)e=e||Pt(t[s]),i.push(t[s+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Pt(t[1]);for(let s=2;s<t.length-1;s+=2)i.push(t[s+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Pt(t[1]);for(let s=1;s<t.length-1;s+=2)i.push(t[s+1])}e&&(t.length=0,t.push("any",...i));for(let s=1;s<t.length;s++)Ot(t[s])}function Pt(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Pt(t[i]))return!0;return!1}const Bt=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function _i(t,e){return t<e?-1:t>e?1:0}function Zt(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Zt(t[e]))return!0;return!1}function xi(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?gi(t[1],t[2],"=="):e==="!="?kn(gi(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?gi(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(xi))):e==="all"?["all"].concat(t.slice(1).map(xi)):e==="none"?["all"].concat(t.slice(1).map(xi).map(kn)):e==="in"?cn(t[1],t.slice(2)):e==="!in"?kn(cn(t[1],t.slice(2))):e==="has"?Vi(t[1]):e!=="!has"||kn(Vi(t[1]));var i}function gi(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function cn(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(_i)]]:["filter-in-small",t,["literal",e]]}}function Vi(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function kn(t){return["!",t]}const In="";function Xi(t,e){return e?`${t}${In}${e}`:t}const $i="-transition",ri=new Set(["fill","line","background","hillshade","raster"]);class oi extends Uo{constructor(e,i,s,l){if(super(),this.id=e.id,this.fqid=Xi(this.id,s),this.type=e.type,this.scope=s,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new _e(i.layout,this.scope,l),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new ce(i.paint,this.scope,l);for(const u in e.paint)this.setPaintProperty(u,e.paint[u]);for(const u in e.layout)this.setLayoutProperty(u,e.layout[u]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pe(i.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return ri.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Bo(e,$i)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const s=this._transitionablePaint,l=s._properties.properties;if(Bo(e,$i)){const A=e.slice(0,-11);return l[A]&&s.setTransition(A,i||void 0),!1}if(!l[e])return!1;const u=s._values[e],p=u.value.isDataDriven(),g=u.value;s.setValue(e,i),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const v=s._values[e].value,w=v.isDataDriven(),S=Bo(e,"pattern")||e==="line-dasharray";return w||p||S||this._handleOverridablePaintPropertyUpdate(e,g,v)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return bl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Te&&Ou(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vt(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,s,l,u,p,g,v,w){}queryIntersectsMatchingFeature(e,i,s,l){}}const nn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Yi{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class hi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ei(t,e=1){let i=0,s=0;return{members:t.map(l=>{const u=nn[l.type].BYTES_PER_ELEMENT,p=i=Ar(i,Math.max(e,u)),g=l.components||1;return s=Math.max(s,u),i+=u*g,{name:l.name,type:l.type,components:g,offset:p}}),size:Ar(i,Math.max(s,e)),alignment:e}}function Ar(t,e){return Math.ceil(t/e)*e}class ur extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const l=2*e;return this.int16[l+0]=i,this.int16[l+1]=s,e}}ur.prototype.bytesPerElement=4,St(ur,"StructArrayLayout2i4");class qn extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s)}emplace(e,i,s,l){const u=3*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.int16[u+2]=l,e}}qn.prototype.bytesPerElement=6,St(qn,"StructArrayLayout3i6");class hr extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,l)}emplace(e,i,s,l,u){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=l,this.int16[p+3]=u,e}}hr.prototype.bytesPerElement=8,St(hr,"StructArrayLayout4i8");class Ir extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,l,u)}emplace(e,i,s,l,u,p){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=p,e}}Ir.prototype.bytesPerElement=10,St(Ir,"StructArrayLayout5i10");class gr extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,l,u,p,g)}emplace(e,i,s,l,u,p,g,v){const w=6*e,S=12*e,A=3*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.uint8[S+4]=l,this.uint8[S+5]=u,this.uint8[S+6]=p,this.uint8[S+7]=g,this.float32[A+2]=v,e}}gr.prototype.bytesPerElement=12,St(gr,"StructArrayLayout2i4ub1f12");class Wn extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,l)}emplace(e,i,s,l,u){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=l,this.float32[p+3]=u,e}}Wn.prototype.bytesPerElement=16,St(Wn,"StructArrayLayout4f16");class nr extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const l=2*e;return this.float32[l+0]=i,this.float32[l+1]=s,e}}nr.prototype.bytesPerElement=8,St(nr,"StructArrayLayout2f8");class rr extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,l,u)}emplace(e,i,s,l,u,p){const g=6*e,v=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=s,this.uint16[g+2]=l,this.uint16[g+3]=u,this.float32[v+2]=p,e}}rr.prototype.bytesPerElement=12,St(rr,"StructArrayLayout4ui1f12");class Rs extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,l)}emplace(e,i,s,l,u){const p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=l,this.uint16[p+3]=u,e}}Rs.prototype.bytesPerElement=8,St(Rs,"StructArrayLayout4ui8");class xs extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,l,u,p)}emplace(e,i,s,l,u,p,g){const v=6*e;return this.int16[v+0]=i,this.int16[v+1]=s,this.int16[v+2]=l,this.int16[v+3]=u,this.int16[v+4]=p,this.int16[v+5]=g,e}}xs.prototype.bytesPerElement=12,St(xs,"StructArrayLayout6i12");class zs extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g,v,w,S,A,C){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,s,l,u,p,g,v,w,S,A,C)}emplace(e,i,s,l,u,p,g,v,w,S,A,C,R){const L=12*e;return this.int16[L+0]=i,this.int16[L+1]=s,this.int16[L+2]=l,this.int16[L+3]=u,this.uint16[L+4]=p,this.uint16[L+5]=g,this.uint16[L+6]=v,this.uint16[L+7]=w,this.int16[L+8]=S,this.int16[L+9]=A,this.int16[L+10]=C,this.int16[L+11]=R,e}}zs.prototype.bytesPerElement=24,St(zs,"StructArrayLayout4i4ui4i24");class Ls extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,l,u,p)}emplace(e,i,s,l,u,p,g){const v=10*e,w=5*e;return this.int16[v+0]=i,this.int16[v+1]=s,this.int16[v+2]=l,this.float32[w+2]=u,this.float32[w+3]=p,this.float32[w+4]=g,e}}Ls.prototype.bytesPerElement=20,St(Ls,"StructArrayLayout3i3f20");class To extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}To.prototype.bytesPerElement=4,St(To,"StructArrayLayout1ul4");class Yr extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const l=2*e;return this.uint16[l+0]=i,this.uint16[l+1]=s,e}}Yr.prototype.bytesPerElement=4,St(Yr,"StructArrayLayout2ui4");class sc extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g,v,w,S,A,C,R){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,s,l,u,p,g,v,w,S,A,C,R)}emplace(e,i,s,l,u,p,g,v,w,S,A,C,R,L){const O=20*e,V=10*e;return this.int16[O+0]=i,this.int16[O+1]=s,this.int16[O+2]=l,this.int16[O+3]=u,this.int16[O+4]=p,this.float32[V+3]=g,this.float32[V+4]=v,this.float32[V+5]=w,this.float32[V+6]=S,this.int16[O+14]=A,this.uint32[V+8]=C,this.uint16[O+18]=R,this.uint16[O+19]=L,e}}sc.prototype.bytesPerElement=40,St(sc,"StructArrayLayout5i4f1i1ul2ui40");class Oa extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,l,u,p,g)}emplace(e,i,s,l,u,p,g,v){const w=8*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=l,this.int16[w+4]=u,this.int16[w+5]=p,this.int16[w+6]=g,this.int16[w+7]=v,e}}Oa.prototype.bytesPerElement=16,St(Oa,"StructArrayLayout3i2i2i16");class oc extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,l,u)}emplace(e,i,s,l,u,p){const g=4*e,v=8*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=l,this.int16[v+6]=u,this.int16[v+7]=p,e}}oc.prototype.bytesPerElement=16,St(oc,"StructArrayLayout2f1f2i16");class Xs extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,l)}emplace(e,i,s,l,u){const p=12*e,g=3*e;return this.uint8[p+0]=i,this.uint8[p+1]=s,this.float32[g+1]=l,this.float32[g+2]=u,e}}Xs.prototype.bytesPerElement=12,St(Xs,"StructArrayLayout2ub2f12");class Hn extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s)}emplace(e,i,s,l){const u=3*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,this.uint16[u+2]=l,e}}Hn.prototype.bytesPerElement=6,St(Hn,"StructArrayLayout3ui6");class ac extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V,j,X,ee,K,le){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V,j,X,ee,K,le)}emplace(e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V,j,X,ee,K,le,ie){const ue=30*e,pe=15*e,ve=60*e;return this.int16[ue+0]=i,this.int16[ue+1]=s,this.int16[ue+2]=l,this.float32[pe+2]=u,this.float32[pe+3]=p,this.uint16[ue+8]=g,this.uint16[ue+9]=v,this.uint32[pe+5]=w,this.uint32[pe+6]=S,this.uint32[pe+7]=A,this.uint16[ue+16]=C,this.uint16[ue+17]=R,this.uint16[ue+18]=L,this.float32[pe+10]=O,this.float32[pe+11]=V,this.uint8[ve+48]=j,this.uint8[ve+49]=X,this.uint8[ve+50]=ee,this.uint32[pe+13]=K,this.int16[ue+28]=le,this.uint8[ve+58]=ie,e}}ac.prototype.bytesPerElement=60,St(ac,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Dg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V,j,X,ee,K,le,ie,ue,pe,ve,Re,we,Fe,Oe,ze,We,$e){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V,j,X,ee,K,le,ie,ue,pe,ve,Re,we,Fe,Oe,ze,We,$e)}emplace(e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V,j,X,ee,K,le,ie,ue,pe,ve,Re,we,Fe,Oe,ze,We,$e,Xe){const Qe=20*e,Ne=40*e,It=80*e;return this.float32[Qe+0]=i,this.float32[Qe+1]=s,this.int16[Ne+4]=l,this.int16[Ne+5]=u,this.int16[Ne+6]=p,this.int16[Ne+7]=g,this.int16[Ne+8]=v,this.int16[Ne+9]=w,this.int16[Ne+10]=S,this.int16[Ne+11]=A,this.int16[Ne+12]=C,this.uint16[Ne+13]=R,this.uint16[Ne+14]=L,this.uint16[Ne+15]=O,this.uint16[Ne+16]=V,this.uint16[Ne+17]=j,this.uint16[Ne+18]=X,this.uint16[Ne+19]=ee,this.uint16[Ne+20]=K,this.uint16[Ne+21]=le,this.uint16[Ne+22]=ie,this.uint16[Ne+23]=ue,this.uint16[Ne+24]=pe,this.uint16[Ne+25]=ve,this.uint16[Ne+26]=Re,this.uint16[Ne+27]=we,this.uint32[Qe+14]=Fe,this.float32[Qe+15]=Oe,this.float32[Qe+16]=ze,this.float32[Qe+17]=We,this.float32[Qe+18]=$e,this.uint8[It+76]=Xe,e}}Dg.prototype.bytesPerElement=80,St(Dg,"StructArrayLayout2f9i15ui1ul4f1ub80");class Md extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Md.prototype.bytesPerElement=4,St(Md,"StructArrayLayout1f4");class lc extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,l,u)}emplace(e,i,s,l,u,p){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=l,this.float32[g+3]=u,this.float32[g+4]=p,e}}lc.prototype.bytesPerElement=20,St(lc,"StructArrayLayout5f20");class Rg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,l,u,p,g)}emplace(e,i,s,l,u,p,g,v){const w=7*e;return this.float32[w+0]=i,this.float32[w+1]=s,this.float32[w+2]=l,this.float32[w+3]=u,this.float32[w+4]=p,this.float32[w+5]=g,this.float32[w+6]=v,e}}Rg.prototype.bytesPerElement=28,St(Rg,"StructArrayLayout7f28");class zg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,l)}emplace(e,i,s,l,u){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=s,this.uint16[p+3]=l,this.uint16[p+4]=u,e}}zg.prototype.bytesPerElement=12,St(zg,"StructArrayLayout1ul3ui12");class Lg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Lg.prototype.bytesPerElement=2,St(Lg,"StructArrayLayout1ui2");class cc extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s)}emplace(e,i,s,l){const u=3*e;return this.float32[u+0]=i,this.float32[u+1]=s,this.float32[u+2]=l,e}}cc.prototype.bytesPerElement=12,St(cc,"StructArrayLayout3f12");class kg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V)}emplace(e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V,j){const X=16*e;return this.float32[X+0]=i,this.float32[X+1]=s,this.float32[X+2]=l,this.float32[X+3]=u,this.float32[X+4]=p,this.float32[X+5]=g,this.float32[X+6]=v,this.float32[X+7]=w,this.float32[X+8]=S,this.float32[X+9]=A,this.float32[X+10]=C,this.float32[X+11]=R,this.float32[X+12]=L,this.float32[X+13]=O,this.float32[X+14]=V,this.float32[X+15]=j,e}}kg.prototype.bytesPerElement=64,St(kg,"StructArrayLayout16f64");class Jp extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,l,u,p,g)}emplace(e,i,s,l,u,p,g,v){const w=10*e,S=5*e;return this.uint16[w+0]=i,this.uint16[w+1]=s,this.uint16[w+2]=l,this.uint16[w+3]=u,this.float32[S+2]=p,this.float32[S+3]=g,this.float32[S+4]=v,e}}Jp.prototype.bytesPerElement=20,St(Jp,"StructArrayLayout4ui3f20");class Og extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Og.prototype.bytesPerElement=2,St(Og,"StructArrayLayout1i2");class Fg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Fg.prototype.bytesPerElement=1,St(Fg,"StructArrayLayout1ub1");class Cx extends Yi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Cx.prototype.size=40;class Px extends sc{get(e){return new Cx(this,e)}}St(Px,"CollisionBoxArray");class Dx extends Yi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Dx.prototype.size=60;class Rx extends ac{get(e){return new Dx(this,e)}}St(Rx,"PlacedSymbolArray");class zx extends Yi{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}zx.prototype.size=80;class Lx extends Dg{get(e){return new zx(this,e)}}St(Lx,"SymbolInstanceArray");class kx extends Md{getoffsetX(e){return this.float32[1*e+0]}}St(kx,"GlyphOffsetArray");class Ox extends ur{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}St(Ox,"SymbolLineVertexArray");class Fx extends Yi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Fx.prototype.size=12;class Bx extends zg{get(e){return new Fx(this,e)}}St(Bx,"FeatureIndexArray");class Nx extends Yr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}St(Nx,"FillExtrusionCentroidArray");const NS=ei([{name:"a_pos",components:2,type:"Int16"}],4),VS=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Cn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,l){let u=this.segments[this.segments.length-1];return e>Cn.MAX_VERTEX_ARRAY_LENGTH&&gn(`Max vertices per segment is ${Cn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Cn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}prepareSegment(e,i,s,l){return this._prepareSegment(e,i.length,s.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,l){return new Cn([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function Vx(t,e){return 256*(t=mi(Math.floor(t),0,255))+mi(Math.floor(e),0,255)}Cn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,St(Cn,"SegmentVector");const jS=ei([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),US=ei([{name:"a_dash",components:4,type:"Uint16"}]);class Sd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,l){this.ids.push(jx(e)),this.positions.push(i,s,l)}eachPosition(e,i){const s=jx(e);let l=0,u=this.ids.length-1;for(;l<u;){const p=l+u>>1;this.ids[p]>=s?u=p:l=p+1}for(;this.ids[l]===s;)i(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,i){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Bg(s,l,0,s.length-1),i&&(i.add(s.buffer),i.add(l.buffer)),{ids:s,positions:l}}static deserialize(e){const i=new Sd;let s;i.ids=e.ids,i.positions=e.positions;for(const l of i.ids)l!==s&&i.uniqueIds.push(l),s=l;return i.indexed=!0,i}}function jx(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Dl(String(t))}function Bg(t,e,i,s){for(;i<s;){const l=t[i+s>>1];let u=i-1,p=s+1;for(;;){do u++;while(t[u]<l);do p--;while(t[p]>l);if(u>=p)break;em(t,u,p),em(e,3*u,3*p),em(e,3*u+1,3*p+1),em(e,3*u+2,3*p+2)}p-i<s-p?(Bg(t,e,i,p),i=p+1):(Bg(t,e,p+1,s),s=p)}}function em(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}St(Sd,"FeaturePositionMap");class Jo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class tm extends Jo{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class zr extends Jo{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Fa extends Jo{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Ng extends Jo{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Ux extends Jo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Gx extends Jo{constructor(e){super(e),this.current=Ni.transparent}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const GS=new Float32Array(16);class Ed extends Jo{constructor(e){super(e),this.current=GS}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let l=1;l<16;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const $S=new Float32Array(9),qS=new Float32Array(4);class Vg extends Jo{constructor(e){super(e),this.current=qS}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let l=0;l<4;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function jg(t){return[Vx(255*t.r,255*t.g),Vx(255*t.b,255*t.a)]}class Ad{constructor(e,i,s){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=s}setUniform(e,i,s,l,u){i.set(e,u,l.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new Gx(e):new zr(e)}}class ju{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,l,u){const p=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;p&&i.set(e,u,p)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Ux(e):new zr(e)}}class ea{constructor(e,i,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(u=>({name:`a_${u}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,i,s,l,u,p,g){const v=this.paintVertexArray.length,w=this.expression.evaluate(new H(0,{brightness:p}),i,{},u,l,g);this.paintVertexArray.resize(e),this._setPaintValue(v,e,w)}updatePaintArray(e,i,s,l,u,p,g){const v=this.expression.evaluate({zoom:0,brightness:g},s,l,void 0,u);this._setPaintValue(e,i,v)}_setPaintValue(e,i,s){if(this.type==="color"){const l=jg(s);for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ys{constructor(e,i,s,l,u,p){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,s,l,u,p,g){const v=this.expression.evaluate(new H(this.zoom,{brightness:p}),i,{},u,l,g),w=this.expression.evaluate(new H(this.zoom+1,{brightness:p}),i,{},u,l,g),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,v,w)}updatePaintArray(e,i,s,l,u,p,g){const v=this.expression.evaluate({zoom:this.zoom,brightness:g},s,l,void 0,u),w=this.expression.evaluate({zoom:this.zoom+1,brightness:g},s,l,void 0,u);this._setPaintValue(e,i,v,w)}_setPaintValue(e,i,s,l){if(this.type==="color"){const u=jg(s),p=jg(l);for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,u[0],u[1],p[0],p[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,l,u){const p=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,g=mi(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);i.set(e,u,g)}getBinding(e,i){return new zr(e)}}class Ba{constructor(e,i,s,l,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(s==="array"?US:jS).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new l}populatePaintArray(e,i,s){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,l,u,p,g){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],p)}_setPaintValues(e,i,s,l){if(!l||!s)return;const u=l[s];if(!u)return;const{tl:p,br:g,pixelRatio:v}=u;for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,p[0],p[1],g[0],g[1],v)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uc{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){const p=e.paint.get(u);if(!s(u)||!(p instanceof Te&&Ou(p.property.specification)))continue;const g=HS(u,e.type),v=p.value,w=p.property.specification.type,S=!!p.property.useIntegerZoom,A=u==="line-dasharray"||u.endsWith("pattern"),C=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||C)if(v.kind==="source"||C||A){const R=$x(u,w,"source");this.binders[u]=A?new Ba(v,g,w,R,e.id):new ea(v,g,w,R),l.push(`/a_${u}`)}else{const R=$x(u,w,"composite");this.binders[u]=new Ys(v,g,w,S,i,R),l.push(`/z_${u}`)}else this.binders[u]=A?new ju(v.value,g):new Ad(v.value,g,w),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof ea||i instanceof Ys?i.maxValue:0}populatePaintArrays(e,i,s,l,u,p,g){for(const v in this.binders){const w=this.binders[v];(w instanceof ea||w instanceof Ys||w instanceof Ba)&&w.populatePaintArray(e,i,s,l,u,p,g)}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof ju&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,l,u,p,g,v){let w=!1;const S=Object.keys(e),A=S.length!==0,C=A?S:i.uniqueIds;for(const R in this.binders){const L=this.binders[R];if((L instanceof ea||L instanceof Ys||L instanceof Ba)&&(L.expression.isStateDependent===!0||L.expression.isLightConstant===!1)){const O=u.paint.get(R);L.expression=O.value;for(const V of C){const j=e[V.toString()];i.eachPosition(V,(X,ee,K)=>{const le=l.feature(X);L.updatePaintArray(ee,K,le,j,p,g,v)})}if(!A)for(const V of s.uniqueIds){const j=e[V.toString()];s.eachPosition(V,(X,ee,K)=>{const le=l.feature(X);L.updatePaintArray(ee,K,le,j,p,g,v)})}w=!0}}return w}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Ad||s instanceof ju)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof ea||s instanceof Ys||s instanceof Ba)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Ad||s instanceof ju||s instanceof Ys)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Ad||l instanceof ju||l instanceof Ys)for(const u of l.uniformNames)i.push({name:u,property:s,binding:l.getBinding(e,u)})}return i}setUniforms(e,i,s,l,u){for(const{name:p,property:g,binding:v}of s)this.binders[g].setUniform(e,v,u,l.get(g),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof ea||i instanceof Ys||i instanceof Ba)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof ea||s instanceof Ys||s instanceof Ba)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof ea||i instanceof Ys||i instanceof Ba)&&i.destroy()}}}class Na{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new uc(l,i,s);this.needsUpload=!1,this._featureMap=new Sd,this._featureMapWithoutIds=new Sd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,l,u,p,g,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,l,u,p,g,v);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,l,u,p){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,g,l,u,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const WS={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function HS(t,e){return WS[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const ZS={"line-pattern":{source:rr,composite:rr},"fill-pattern":{source:rr,composite:rr},"fill-extrusion-pattern":{source:rr,composite:rr},"line-dasharray":{source:Rs,composite:Rs}},QS={color:{source:nr,composite:Wn},number:{source:Md,composite:nr}};function $x(t,e,i){const s=ZS[t];return s&&s[i]||QS[e][i]}St(Ad,"ConstantBinder"),St(ju,"PatternConstantBinder"),St(ea,"SourceExpressionBinder"),St(Ba,"PatternCompositeBinder"),St(Ys,"CompositeExpressionBinder"),St(uc,"ProgramConfiguration",{omit:["_buffers"]}),St(Na,"ProgramConfigurationSet");const Lr=ut/Math.PI/2,Ug=5,qx=6,XS=16383,Uu=64,Gg=[Uu,32,16],ks=-Lr,Os=Lr;function Gu(t,e,i,s=Lr){return i=Mi(i),[t*Math.sin(i)*s,-e*s,t*Math.cos(i)*s]}function hc(t,e,i){return Gu(Math.cos(Mi(t)),Math.sin(Mi(t)),e,i)}const $u=63710088e-1,$g=2*Math.PI*$u;class Ai{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ai(Gs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,l=e.lat*i,u=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*i);return $u*Math.acos(Math.min(u,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Va({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return hc(this.lat,this.lng,Lr+e*Lr/$u)}static convert(e){if(e instanceof Ai)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ai(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ai(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Va{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof Ai?new Ai(e.lng,e.lat):Ai.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ai?new Ai(e.lng,e.lat):Ai.convert(e),this}extend(e){const i=this._sw,s=this._ne;let l,u;if(e instanceof Ai)l=e,u=e;else{if(!(e instanceof Va))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Va.convert(e)):this.extend(Ai.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Ai.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return i||s?(i.lng=Math.min(l.lng,i.lng),i.lat=Math.min(l.lat,i.lat),s.lng=Math.max(u.lng,s.lng),s.lat=Math.max(u.lat,s.lat)):(this._sw=new Ai(l.lng,l.lat),this._ne=new Ai(u.lng,u.lat)),this}getCenter(){return new Ai((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ai(this.getWest(),this.getNorth())}getSouthEast(){return new Ai(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Ai.convert(e);let l=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&l}static convert(e){return!e||e instanceof Va?e:new Va(e)}}var Wx={};(function(t,e){(function(i){function s(u,p,g){var v=l(256*u,256*(p=Math.pow(2,g)-p-1),g),w=l(256*(u+1),256*(p+1),g);return v[0]+","+v[1]+","+w[0]+","+w[1]}function l(u,p,g){var v=2*Math.PI*6378137/256/Math.pow(2,g);return[u*v-2*Math.PI*6378137/2,p*v-2*Math.PI*6378137/2]}i.getURL=function(u,p,g,v,w,S){return S=S||{},u+"?"+["bbox="+s(g,v,w),"format="+(S.format||"image/png"),"service="+(S.service||"WMS"),"version="+(S.version||"1.1.1"),"request="+(S.request||"GetMap"),"srs="+(S.srs||"EPSG:3857"),"width="+(S.width||256),"height="+(S.height||256),"layers="+p].join("&")},i.getTileBBox=s,i.getMercCoords=l,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,Wx);var YS=Wx;class dc{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Id(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=YS.getTileBBox(this.x,this.y,this.z),l=function(u,p,g){let v,w="";for(let S=u;S>0;S--)v=1<<S-1,w+=(p&v?1:0)+(g&v?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hx{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Id(e,i.z,i.z,i.x,i.y)}}class yr{constructor(e,i,s,l,u){this.overscaledZ=e,this.wrap=i,this.canonical=new dc(s,+l,+u),this.key=i===0&&e===s?this.canonical.key:Id(i,e,s,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new yr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Id(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Id(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new yr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new yr(i,this.wrap,i,s,l),new yr(i,this.wrap,i,s+1,l),new yr(i,this.wrap,i,s,l+1),new yr(i,this.wrap,i,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new yr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new yr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Id(t,e,i,s,l){const u=1<<Math.min(i,22);let p=u*(l%u)+s%u;return t&&i<22&&(p+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}const KS=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new yr(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new yr(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new yr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new yr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];St(dc,"CanonicalTileID"),St(yr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const JS=0,eE=25.5;function qg(t){return $g*Math.cos(t*Math.PI/180)}function ja(t){return(180+t)/360}function ta(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function kr(t,e){return t/qg(e)}function Kr(t){return 360*t-180}function dr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Zx(t,e){return t*qg(dr(e))}const Pn=85.051129;function Qx(t){return Math.cos(Mi(mi(t,-Pn,Pn)))}function fc(t,e){const i=mi(e,JS,eE),s=Math.pow(2,i);return Qx(t)*$g/(512*s)}function Xx(t){return 1/Math.cos(t*Math.PI/180)}function im(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/ut)/(1<<t.z)*2));return 80150034*i/(i*i+1)/ut/(1<<t.z)}class xr{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Ai.convert(e);return new xr(ja(s.lng),ta(s.lat),kr(i,s.lat))}toLngLat(){return new Ai(Kr(this.x),dr(this.y))}toAltitude(){return Zx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$g*Xx(dr(this.y))}}function Wg(t,e,i,s,l,u,p,g,v){const w=(e+s)/2,S=(i+l)/2,A=new ct(w,S);g(A),function(C,R,L,O,V,j){const X=L-V,ee=O-j;return Math.abs((O-R)*X-(L-C)*ee)/Math.hypot(X,ee)}(A.x,A.y,u.x,u.y,p.x,p.y)>=v?(Wg(t,e,i,w,S,u,A,g,v),Wg(t,w,S,s,l,A,p,g,v)):t.push(p)}function Yx(t,e,i){let s=t[0],l=s.x,u=s.y;e(s);const p=[s];for(let g=1;g<t.length;g++){const v=t[g],{x:w,y:S}=v;e(v),Wg(p,l,u,w,S,s,v,e,i),l=w,u=S,s=v}return p}function Hg(t,e,i,s){if(s(e,i)){const l=e.add(i)._mult(.5);Hg(t,e,l,s),Hg(t,l,i,s)}else t.push(i)}function tE(t,e){let i=t[0];const s=[i];for(let l=1;l<t.length;l++){const u=t[l];Hg(s,i,u,e),i=u}return s}const Zg=Math.pow(2,14)-1,Kx=-Zg-1;function iE(t,e){const i=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=mi(i,Kx,Zg),t.y=mi(s,Kx,Zg),(i<t.x||i>t.x+1||s<t.y||s>t.y+1)&&gn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function ia(t,e,i){const s=t.loadGeometry(),l=t.extent,u=ut/l;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:g,x:v,y:w,projection:S}=i,A=C=>{const R=Kr((e.x+C.x/l)/p),L=dr((e.y+C.y/l)/p),O=S.project(R,L);C.x=(O.x*g-v)*l,C.y=(O.y*g-w)*l};for(let C=0;C<s.length;C++)if(t.type!==1)s[C]=Yx(s[C],A,1);else{const R=[];for(const L of s[C])L.x<0||L.x>=l||L.y<0||L.y>=l||(A(L),R.push(L));s[C]=R}}for(const p of s)for(const g of p)iE(g,u);return s}function Ua(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ia(t):[]}}function nm(t,e,i,s,l){t.emplaceBack(2*e+(s+1)/2,2*i+(l+1)/2)}function rm(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Qg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ur,this.indexArray=new Hn,this.segments=new Cn,this.programConfigurations=new Na(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,l){const u=this.layers[0],p=[];let g=null;u.type==="circle"&&(g=u.layout.get("circle-sort-key"));for(const{feature:w,id:S,index:A,sourceLayerIndex:C}of e){const R=this.layers[0]._featureFilter.needGeometry,L=Ua(w,R);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),L,s))continue;const O=g?g.evaluate(L,{},s):void 0,V={id:S,properties:w.properties,type:w.type,sourceLayerIndex:C,index:A,geometry:R?L.geometry:ia(w,s,l),patterns:{},sortKey:O};p.push(V)}g&&p.sort((w,S)=>w.sortKey-S.sortKey);let v=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new xs,v=l.projection);for(const w of p){const{geometry:S,index:A,sourceLayerIndex:C}=w,R=e[A].feature;this.addFeature(w,S,A,i.availableImages,s,v,i.brightness),i.featureIndex.insert(R,S,A,C,this.index)}}update(e,i,s,l,u){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,s,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,VS.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,l,u,p,g){for(const v of i)for(const w of v){const S=w.x,A=w.y;if(S<0||S>=ut||A<0||A>=ut)continue;if(p){const L=p.projectTilePoint(S,A,u),O=p.upVector(u,S,A),V=this.globeExtVertexArray;rm(V,L,O),rm(V,L,O),rm(V,L,O),rm(V,L,O)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=C.vertexLength;nm(this.layoutVertexArray,S,A,-1,-1),nm(this.layoutVertexArray,S,A,1,-1),nm(this.layoutVertexArray,S,A,1,1),nm(this.layoutVertexArray,S,A,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l,u,g)}}function Xg(t,e){for(let i=0;i<t.length;i++)if(pc(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(pc(t,e[i]))return!0;return!!Yg(t,e)}function nE(t,e,i){return!!pc(t,e)||!!Kg(e,t,i)}function Jx(t,e){if(t.length===1)return tv(e,t[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let l=0;l<s.length;l++)if(pc(t,s[l]))return!0}for(let i=0;i<t.length;i++)if(tv(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Yg(t,e[i]))return!0;return!1}function rE(t,e,i){if(t.length>1){if(Yg(t,e))return!0;for(let s=0;s<e.length;s++)if(Kg(e[s],t,i))return!0}for(let s=0;s<t.length;s++)if(Kg(t[s],e,i))return!0;return!1}function Yg(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const s=t[i],l=t[i+1];for(let u=0;u<e.length-1;u++)if(sE(s,l,e[u],e[u+1]))return!0}return!1}function sE(t,e,i,s){return ho(t,i,s)!==ho(e,i,s)&&ho(t,e,i)!==ho(t,e,s)}function Kg(t,e,i){const s=i*i;if(e.length===1)return t.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(ev(t,e[l-1],e[l])<s)return!0;return!1}function ev(t,e,i){const s=e.distSqr(i);if(s===0)return t.distSqr(e);const l=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/s;return t.distSqr(l<0?e:l>1?i:i.sub(e)._mult(l)._add(e))}function tv(t,e){let i,s,l,u=!1;for(let p=0;p<t.length;p++){i=t[p];for(let g=0,v=i.length-1;g<i.length;v=g++)s=i[g],l=i[v],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(u=!u)}return u}function pc(t,e){let i=!1;for(let s=0,l=t.length-1;s<t.length;l=s++){const u=t[s],p=t[l];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(i=!i)}return i}function iv(t,e,i,s,l){for(const p of t)if(e<=p.x&&i<=p.y&&s>=p.x&&l>=p.y)return!0;const u=[new ct(e,i),new ct(e,l),new ct(s,l),new ct(s,i)];if(t.length>2){for(const p of u)if(pc(t,p))return!0}for(let p=0;p<t.length-1;p++)if(oE(t[p],t[p+1],u))return!0;return!1}function oE(t,e,i){const s=i[0],l=i[2];if(t.x<s.x&&e.x<s.x||t.x>l.x&&e.x>l.x||t.y<s.y&&e.y<s.y||t.y>l.y&&e.y>l.y)return!1;const u=ho(t,e,i[0]);return u!==ho(t,e,i[1])||u!==ho(t,e,i[2])||u!==ho(t,e,i[3])}function qu(t,e,i,s,l,u){let p=e.y-t.y,g=t.x-e.x;if(u=u||0){const v=p*p+g*g;if(v===0)return!0;const w=Math.sqrt(v);p/=w,g/=w}return!((i.x-t.x)*p+(i.y-t.y)*g-u<0||(s.x-t.x)*p+(s.y-t.y)*g-u<0||(l.x-t.x)*p+(l.y-t.y)*g-u<0)}function Jg(t,e,i,s,l,u,p){return!(qu(t,e,s,l,u,p)||qu(e,i,s,l,u,p)||qu(i,t,s,l,u,p)||qu(s,l,t,e,i,p)||qu(l,u,t,e,i,p)||qu(u,s,t,e,i,p))}function Wu(t,e,i){const s=e.paint.get(t).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(t)}function sm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function nv(t,e,i,s,l){if(!e[0]&&!e[1])return t;const u=ct.convert(e)._mult(l);i==="viewport"&&u._rotate(-s);const p=[];for(let g=0;g<t.length;g++)p.push(t[g].sub(u));return p}function rv(t,e,i,s){const l=ct.convert(t)._mult(s);return e==="viewport"&&l._rotate(-i),l}St(Qg,"CircleBucket",{omit:["layers"]});const aE=new ye({"circle-sort-key":new be(se.layout_circle["circle-sort-key"]),visibility:new me(se.layout_circle.visibility)});var lE={paint:new ye({"circle-radius":new be(se.paint_circle["circle-radius"]),"circle-color":new be(se.paint_circle["circle-color"]),"circle-blur":new be(se.paint_circle["circle-blur"]),"circle-opacity":new be(se.paint_circle["circle-opacity"]),"circle-translate":new me(se.paint_circle["circle-translate"]),"circle-translate-anchor":new me(se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new me(se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new me(se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new be(se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new be(se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new be(se.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new me(se.paint_circle["circle-emissive-strength"])}),layout:aE};class ey{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const l=r.Q.dot(i,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/l;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,s[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,i,s){if(r.Q.equals(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[l,u,p]=this.dir,g=this.pos[0]-e[0],v=this.pos[1]-e[1],w=this.pos[2]-e[2],S=l*l+u*u+p*p,A=2*(g*l+v*u+w*p),C=A*A-4*S*(g*g+v*v+w*w-i*i);if(C<0){const R=Math.max(-A/2,0),L=g+l*R,O=v+u*R,V=w+p*R,j=Math.hypot(L,O,V);return s[0]=L*i/j,s[1]=O*i/j,s[2]=V*i/j,!1}{const R=(-A-Math.sqrt(C))/(2*S);if(R<0){const L=Math.hypot(g,v,w);return s[0]=g*i/L,s[1]=v*i/L,s[2]=w*i/L,!1}return s[0]=g+l*R,s[1]=v+u*R,s[2]=w+p*R,!0}}}class ty{constructor(e,i,s,l,u){this.TL=e,this.TR=i,this.BR=s,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,i,s){const l=[-1,1,1],u=[1,1,1],p=[1,-1,1],g=[-1,-1,1],v=r.Q.transformMat4(l,l,e),w=r.Q.transformMat4(u,u,e),S=r.Q.transformMat4(p,p,e),A=r.Q.transformMat4(g,g,e);return new ty(v,w,S,A,i/s)}}function Cd(t,e,i){let s=1/0,l=-1/0;const u=[];for(const p of t){r.Q.sub(u,p,e);const g=r.Q.dot(u,i);s=Math.min(s,g),l=Math.max(l,g)}return[s,l]}function sv(t,e){let i=!0;for(let s=0;s<t.planes.length;s++){const l=t.planes[s];let u=0;for(let p=0;p<e.length;p++)u+=r.Q.dot(l,e[p])+l[3]>=0;if(u===0)return 0;u!==e.length&&(i=!1)}return i?2:1}function ov(t,e){for(const i of t.projections){const s=Cd(e,t.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function av(t,e){let i=0;const s=[0,0,0,0];for(let l=0;l<t.length;l++)s[0]=t[l][0],s[1]=t[l][1],s[2]=t[l][2],s[3]=1,r.aa.dot(s,e)>=0&&i++;return i}class iy{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=un.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.Q.sub([],this.points[2],this.points[3]),r.Q.sub([],this.points[0],this.points[3]),r.Q.sub([],this.points[4],this.points[0]),r.Q.sub([],this.points[5],this.points[1]),r.Q.sub([],this.points[6],this.points[2]),r.Q.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const l=[0,-s[2],s[1]],u=[s[2],0,-s[0]];this.projections.push({axis:l,projection:Cd(this.points,this.points[0],l)}),this.projections.push({axis:u,projection:Cd(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,i,s,l){const u=Math.pow(2,s),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const S=r.aa.transformMat4([],w,e),A=1/S[3]/i*u;return r.aa.mul(S,S,[A,A,l?1/S[3]:A,A])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const S=r.Q.sub([],p[w[0]],p[w[1]]),A=r.Q.sub([],p[w[2]],p[w[1]]),C=r.Q.normalize([],r.Q.cross([],S,A)),R=-r.Q.dot(C,p[w[1]]);return C.concat(R)}),v=[];for(let w=0;w<p.length;w++)v.push([p[w][0],p[w][1],p[w][2]]);return new iy(v,g)}intersectsPrecise(e,i,s){for(let l=0;l<i.length;l++)if(!av(e,i[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!av(e,this.planes[l]))return 0;for(const l of s)for(const u of this.frustumEdges){const p=r.Q.cross([],l,u),g=r.Q.length(p);if(g===0)continue;r.Q.scale(p,p,1/g);const v=Cd(this.points,this.points[0],p),w=Cd(e,this.points[0],p);if(v[0]>w[1]||w[0]>v[1])return 0}return 1}}class un{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const l of e)r.Q.min(i,i,l),r.Q.max(s,s,l);return new un(i,s)}static fromTileIdAndHeight(e,i,s){const l=1<<e.canonical.z,u=e.canonical.x,p=e.canonical.y;return new un([u/l,p/l,i],[(u+1)/l,(p+1)/l,s])}static applyTransform(e,i){const s=e.getCorners();for(let l=0;l<s.length;++l)r.Q.transformMat4(s[l],s[l],i);return un.fromPoints(s)}static projectAabbCorners(e,i){const s=e.getCorners();for(let l=0;l<s.length;++l)r.Q.transformMat4(s[l],s[l],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=r.Q.scale([],r.Q.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=r.Q.clone(this.min),l=r.Q.clone(this.max);for(let u=0;u<i.length;u++)s[u]=i[u]?this.min[u]:this.center[u],l[u]=i[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new un(s,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?sv(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?sv(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?ov(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?ov(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}St(un,"Aabb");const cE=ei([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:om}=cE,uE=ei([{name:"a_pos_3",components:3,type:"Int16"}]);var lv=ei([{name:"a_pos",type:"Int16",components:2}]);function am(t){return t*Lr/$u}const hE=[new un([ks,ks,ks],[Os,Os,Os]),new un([ks,ks,ks],[0,0,Os]),new un([0,ks,ks],[Os,0,Os]),new un([ks,0,ks],[0,Os,Os]),new un([0,0,ks],[Os,Os,Os])];function cv(t,e,i,s=!0){const l=r.Q.scale([],t._camera.position,t.worldSize),u=[e,i,1,1];r.aa.transformMat4(u,u,t.pixelMatrixInverse),r.aa.scale(u,u,1/u[3]);const p=r.Q.sub([],u,l),g=r.Q.normalize([],p),v=t.globeMatrix,w=[v[12],v[13],v[14]],S=r.Q.sub([],w,l),A=r.Q.length(S),C=r.Q.normalize([],S),R=t.worldSize/(2*Math.PI),L=r.Q.dot(C,g),O=Math.asin(R/A);if(O<Math.acos(L)){if(!s)return null;const we=[],Fe=[];r.Q.scale(we,g,A/L),r.Q.normalize(Fe,r.Q.sub(Fe,we,S)),r.Q.normalize(g,r.Q.add(g,S,r.Q.scale(g,Fe,Math.tan(O)*A)))}const V=[];new ey(l,g).closestPointOnSphere(w,R,V);const j=r.Q.normalize([],No(v,0)),X=r.Q.normalize([],No(v,1)),ee=r.Q.normalize([],No(v,2)),K=r.Q.dot(j,V),le=r.Q.dot(X,V),ie=r.Q.dot(ee,V),ue=Er(Math.asin(-le/R));let pe=Er(Math.atan2(K,ie));pe=t.center.lng+function(we,Fe){const Oe=(Fe-we+180)%360-180;return Oe<-180?Oe+360:Oe}(t.center.lng,pe);const ve=ja(pe),Re=mi(ta(ue),0,1);return new xr(ve,Re)}class dE{constructor(e,i,s){this.a=r.Q.sub([],e,s),this.b=r.Q.sub([],i,s),this.center=s;const l=r.Q.normalize([],this.a),u=r.Q.normalize([],this.b);this.angle=Math.acos(r.Q.dot(l,u))}}function ny(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(s,l,u,p){const g=Math.sin(u);return s*(Math.sin((1-p)*u)/g)+l*(Math.sin(p*u)/g)}(t.a[e],t.b[e],t.angle,mi(i,0,1))+t.center[e]}function Mo(t){if(t.z<=1)return hE[t.z+2*t.y+t.x];const e=ry(lm(t));return un.fromPoints(e)}function na(t,e,i){return r.Q.scale(t,t,1-i),r.Q.scaleAndAdd(t,t,e,i)}function uv(t,e,i){for(const s of t)r.Q.transformMat4(s,s,e),r.Q.scale(s,s,i)}function hv(t,e,i,s){const l=e/t.worldSize,u=t.globeMatrix;if(i.z<=1){const ve=Mo(i).getCorners();return uv(ve,u,l),un.fromPoints(ve)}const p=lm(i,s),g=ry(p,Lr+am(t._tileCoverLift));uv(g,u,l);const v=Number.MAX_VALUE,w=[-v,-v,-v],S=[v,v,v];if(p.contains(t.center)){for(const we of g)r.Q.min(S,S,we),r.Q.max(w,w,we);w[2]=0;const ve=t.point,Re=[ve.x*l,ve.y*l,0];return r.Q.min(S,S,Re),r.Q.max(w,w,Re),new un(S,w)}if(t._tileCoverLift>0){for(const ve of g)r.Q.min(S,S,ve),r.Q.max(w,w,ve);return new un(S,w)}const A=[u[12]*l,u[13]*l,u[14]*l],C=p.getCenter(),R=mi(t.center.lat,-Pn,Pn),L=mi(C.lat,-Pn,Pn),O=ja(t.center.lng),V=ta(R);let j=O-ja(C.lng);const X=V-ta(L);j>.5?j-=1:j<-.5&&(j+=1);let ee=0;if(Math.abs(j)>Math.abs(X))ee=j>=0?1:3;else{ee=X>=0?0:2;const ve=[u[4]*l,u[5]*l,u[6]*l],Re=-Math.sin(Mi(X>=0?p.getSouth():p.getNorth()))*Lr;r.Q.scaleAndAdd(A,A,ve,Re)}const K=g[ee],le=g[(ee+1)%4],ie=new dE(K,le,A),ue=[ny(ie,0)||K[0],ny(ie,1)||K[1],ny(ie,2)||K[2]],pe=Ga(t.zoom);if(pe>0){const ve=function({x:we,y:Fe,z:Oe},ze,We,$e,Xe){const Qe=1/(1<<Oe);let Ne=we*Qe,It=Ne+Qe,Tt=Fe*Qe,et=Tt+Qe,jt=0;const zt=(Ne+It)/2-$e;return zt>.5?jt=-1:zt<-.5&&(jt=1),Ne=((Ne+jt)*ze-($e*=ze))*We+$e,It=((It+jt)*ze-$e)*We+$e,Tt=(Tt*ze-(Xe*=ze))*We+Xe,et=(et*ze-Xe)*We+Xe,[[Ne,et,0],[It,et,0],[It,Tt,0],[Ne,Tt,0]]}(i,e,t._pixelsPerMercatorPixel,O,V);for(let we=0;we<g.length;we++)na(g[we],ve[we],pe);const Re=r.Q.add([],ve[ee],ve[(ee+1)%4]);r.Q.scale(Re,Re,.5),na(ue,Re,pe)}for(const ve of g)r.Q.min(S,S,ve),r.Q.max(w,w,ve);return S[2]=Math.min(K[2],le[2]),r.Q.min(S,S,ue),r.Q.max(w,w,ue),new un(S,w)}function lm({x:t,y:e,z:i},s=!1){const l=1/(1<<i),u=new Ai(Kr(t*l),e===(1<<i)-1&&s?-90:dr((e+1)*l)),p=new Ai(Kr((t+1)*l),e===0&&s?90:dr(e*l));return new Va(u,p)}function ry(t,e=Lr){const i=Mi(t.getNorth()),s=Mi(t.getSouth()),l=Math.cos(i),u=Math.cos(s),p=Math.sin(i),g=Math.sin(s),v=t.getWest(),w=t.getEast();return[Gu(u,g,v,e),Gu(u,g,w,e),Gu(l,p,w,e),Gu(l,p,v,e)]}function Pd(t,e,i,s){const l=1<<i.z,u=(t/ut+i.x)/l;return hc(dr((e/ut+i.y)/l),Kr(u),s)}function cm({min:t,max:e}){return XS/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const dv=new Float64Array(16);function um(t){const e=cm(t),i=r.a9.fromScaling(dv,[e,e,e]);return r.a9.translate(i,i,r.Q.negate([],t.min))}function sy(t){const e=r.a9.fromTranslation(dv,t.min),i=1/cm(t);return r.a9.scale(e,e,[i,i,i])}function oy(t){const e=ut/(2*Math.PI);return t/(2*Math.PI)/e}function fv(t,e){return ut/(512*Math.pow(2,t))*cm(Mo(e))}function pv(t,e,i,s,l){const u=oy(i),p=[t,e,-i/(2*Math.PI)],g=r.a9.identity(new Float64Array(16));return r.a9.translate(g,g,p),r.a9.scale(g,g,[u,u,u]),r.a9.rotateX(g,g,Mi(-l)),r.a9.rotateY(g,g,Mi(-s)),g}function Ga(t){return vl(Ug,qx,t)}function mv(t,e){const i=hc(e.lat,e.lng),s=function(u){const p=hc(u._center.lat,u._center.lng),g=r.Q.fromValues(0,1,0);let v=r.Q.cross([],g,p);const w=r.a9.fromRotation([],-u.angle,p);v=r.Q.transformMat4(v,v,w),r.a9.fromRotation(w,-u._pitch,v);const S=r.Q.normalize([],p);return r.Q.scale(S,S,am(u.cameraToCenterDistance/u.pixelsPerMeter)),r.Q.transformMat4(S,S,w),r.Q.add([],p,S)}(t),l=r.Q.subtract([],s,i);return r.Q.angle(l,i)}function ay(t,e){return mv(t,e)>Math.PI/2*1.01}const _v=Mi(85),fE=Math.cos(_v),pE=Math.sin(_v),mE=r.a9.create(),gv=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function yv(t,e,i,s,l,u,p,g,v){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(v*=t.pixelToTileUnitsFactor);const w=t.tileID.canonical,S=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const A of e)for(const C of A){const R=C.add(g),L=l&&i.elevation?i.elevation.exaggeration()*l.getElevationAt(R.x,R.y,!0):0,O=i.projection.projectTilePoint(R.x,R.y,w);if(L>0){const ee=i.projection.upVector(w,R.x,R.y);O.x+=ee[0]*S*L,O.y+=ee[1]*S*L,O.z+=ee[2]*S*L}const V=u?R:_E(O.x,O.y,O.z,s),j=u?t.tilespaceRays.map(ee=>yE(ee,L)):t.queryGeometry.screenGeometry,X=r.aa.transformMat4([],[O.x,O.y,O.z,1],s);if(!p&&u?v*=X[3]/i.cameraToCenterDistance:p&&!u&&(v*=i.cameraToCenterDistance/X[3]),u){const ee=dr((C.y/ut+w.y)/(1<<w.z));v/=i.projection.pixelsPerMeter(ee,1)/kr(1,ee)}if(nE(j,V,v))return!0}return!1}function _E(t,e,i,s){const l=r.aa.transformMat4([],[t,e,i,1],s);return new ct(l[0]/l[3],l[1]/l[3])}const xv=r.Q.fromValues(0,0,0),gE=r.Q.fromValues(0,0,1);function yE(t,e){const i=r.Q.create();return xv[2]=e,t.intersectsPlane(xv,gE,i),new ct(i[0],i[1])}class vv extends Qg{}function bv(t,{width:e,height:i},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*i*s)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*i*s);return t.width=e,t.height=i,t.data=l,t}function wv(t,e,i){const{width:s,height:l}=e;s===t.width&&l===t.height||(ly(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,l)},i),t.width=s,t.height=l,t.data=e.data)}function ly(t,e,i,s,l,u,p){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||i.x>t.width-l.width||i.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const g=t.data,v=e.data,w=u===4&&p;for(let S=0;S<l.height;S++){const A=((i.y+S)*t.width+i.x)*u,C=((s.y+S)*e.width+s.x)*u;if(w)for(let R=0;R<l.width;R++){const L=A+R*u+3,O=C+R*u;v[O+0]=255,v[O+1]=255,v[O+2]=255,v[O+3]=g[L]}else for(let R=0;R<l.width*u;R++)v[C+R]=g[A+R]}return e}St(vv,"HeatmapBucket",{omit:["layers"]});class $a{constructor(e,i){bv(this,e,1,i)}resize(e){wv(this,new $a(e),1)}clone(){return new $a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,l,u){ly(e,i,s,l,u,1)}}class vs{constructor(e,i){bv(this,e,4,i)}resize(e){wv(this,new vs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,l,u,p){ly(e,i,s,l,u,4,p)}}class Tv{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}St($a,"AlphaImage"),St(vs,"RGBAImage");const xE=new ye({visibility:new me(se.layout_heatmap.visibility)});var vE={paint:new ye({"heatmap-radius":new be(se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new be(se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new me(se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ze(se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new me(se.paint_heatmap["heatmap-opacity"])}),layout:xE};function Dd(t){const e={},i=t.resolution||256,s=t.clips?t.clips.length:1,l=t.image||new vs({width:i,height:s}),u=(p,g,v)=>{e[t.evaluationKey]=v;const w=t.expression.evaluate(e);w&&(l.data[p+g+0]=Math.floor(255*w.r/w.a),l.data[p+g+1]=Math.floor(255*w.g/w.a),l.data[p+g+2]=Math.floor(255*w.b/w.a),l.data[p+g+3]=Math.floor(255*w.a))};if(t.clips)for(let p=0,g=0;p<s;++p,g+=4*i)for(let v=0,w=0;v<i;v++,w+=4){const S=v/(i-1),{start:A,end:C}=t.clips[p];u(g,w,A*(1-S)+C*S)}else for(let p=0,g=0;p<i;p++,g+=4)u(0,g,p/(i-1));return l}const bE=new ye({visibility:new me(se.layout_hillshade.visibility)});var wE={paint:new ye({"hillshade-illumination-direction":new me(se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new me(se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new me(se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new me(se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new me(se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new me(se.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new me(se.paint_hillshade["hillshade-emissive-strength"])}),layout:bE};const TE=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:ME}=TE;var cy={exports:{}};function hm(t,e,i){i=i||2;var s,l,u,p,g,v,w,S=e&&e.length,A=S?e[0]*i:t.length,C=Mv(t,0,A,i,!0),R=[];if(!C||C.next===C.prev)return R;if(S&&(C=function(O,V,j,X){var ee,K,le,ie=[];for(ee=0,K=V.length;ee<K;ee++)(le=Mv(O,V[ee]*X,ee<K-1?V[ee+1]*X:O.length,X,!1))===le.next&&(le.steiner=!0),ie.push(RE(le));for(ie.sort(CE),ee=0;ee<ie.length;ee++)j=PE(ie[ee],j);return j}(t,e,C,i)),t.length>80*i){s=u=t[0],l=p=t[1];for(var L=i;L<A;L+=i)(g=t[L])<s&&(s=g),(v=t[L+1])<l&&(l=v),g>u&&(u=g),v>p&&(p=v);w=(w=Math.max(u-s,p-l))!==0?32767/w:0}return Rd(C,R,i,s,l,w,0),R}function Mv(t,e,i,s,l){var u,p;if(l===dy(t,e,i,s)>0)for(u=e;u<i;u+=s)p=Av(u,t[u],t[u+1],p);else for(u=i-s;u>=e;u-=s)p=Av(u,t[u],t[u+1],p);return p&&dm(p,p.next)&&(Ld(p),p=p.next),p}function mc(t,e){if(!t)return t;e||(e=t);var i,s=t;do if(i=!1,s.steiner||!dm(s,s.next)&&Nn(s.prev,s,s.next)!==0)s=s.next;else{if(Ld(s),(s=e=s.prev)===s.next)break;i=!0}while(i||s!==e);return e}function Rd(t,e,i,s,l,u,p){if(t){!p&&u&&function(S,A,C,R){var L=S;do L.z===0&&(L.z=uy(L.x,L.y,A,C,R)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==S);L.prevZ.nextZ=null,L.prevZ=null,function(O){var V,j,X,ee,K,le,ie,ue,pe=1;do{for(j=O,O=null,K=null,le=0;j;){for(le++,X=j,ie=0,V=0;V<pe&&(ie++,X=X.nextZ);V++);for(ue=pe;ie>0||ue>0&&X;)ie!==0&&(ue===0||!X||j.z<=X.z)?(ee=j,j=j.nextZ,ie--):(ee=X,X=X.nextZ,ue--),K?K.nextZ=ee:O=ee,ee.prevZ=K,K=ee;j=X}K.nextZ=null,pe*=2}while(le>1)}(L)}(t,s,l,u);for(var g,v,w=t;t.prev!==t.next;)if(g=t.prev,v=t.next,u?EE(t,s,l,u):SE(t))e.push(g.i/i|0),e.push(t.i/i|0),e.push(v.i/i|0),Ld(t),t=v.next,w=v.next;else if((t=v)===w){p?p===1?Rd(t=AE(mc(t),e,i),e,i,s,l,u,2):p===2&&IE(t,e,i,s,l,u):Rd(mc(t),e,i,s,l,u,1);break}}}function SE(t){var e=t.prev,i=t,s=t.next;if(Nn(e,i,s)>=0)return!1;for(var l=e.x,u=i.x,p=s.x,g=e.y,v=i.y,w=s.y,S=l<u?l<p?l:p:u<p?u:p,A=g<v?g<w?g:w:v<w?v:w,C=l>u?l>p?l:p:u>p?u:p,R=g>v?g>w?g:w:v>w?v:w,L=s.next;L!==e;){if(L.x>=S&&L.x<=C&&L.y>=A&&L.y<=R&&Hu(l,g,u,v,p,w,L.x,L.y)&&Nn(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function EE(t,e,i,s){var l=t.prev,u=t,p=t.next;if(Nn(l,u,p)>=0)return!1;for(var g=l.x,v=u.x,w=p.x,S=l.y,A=u.y,C=p.y,R=g<v?g<w?g:w:v<w?v:w,L=S<A?S<C?S:C:A<C?A:C,O=g>v?g>w?g:w:v>w?v:w,V=S>A?S>C?S:C:A>C?A:C,j=uy(R,L,e,i,s),X=uy(O,V,e,i,s),ee=t.prevZ,K=t.nextZ;ee&&ee.z>=j&&K&&K.z<=X;){if(ee.x>=R&&ee.x<=O&&ee.y>=L&&ee.y<=V&&ee!==l&&ee!==p&&Hu(g,S,v,A,w,C,ee.x,ee.y)&&Nn(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,K.x>=R&&K.x<=O&&K.y>=L&&K.y<=V&&K!==l&&K!==p&&Hu(g,S,v,A,w,C,K.x,K.y)&&Nn(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;ee&&ee.z>=j;){if(ee.x>=R&&ee.x<=O&&ee.y>=L&&ee.y<=V&&ee!==l&&ee!==p&&Hu(g,S,v,A,w,C,ee.x,ee.y)&&Nn(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;K&&K.z<=X;){if(K.x>=R&&K.x<=O&&K.y>=L&&K.y<=V&&K!==l&&K!==p&&Hu(g,S,v,A,w,C,K.x,K.y)&&Nn(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function AE(t,e,i){var s=t;do{var l=s.prev,u=s.next.next;!dm(l,u)&&Sv(l,s,s.next,u)&&zd(l,u)&&zd(u,l)&&(e.push(l.i/i|0),e.push(s.i/i|0),e.push(u.i/i|0),Ld(s),Ld(s.next),s=t=u),s=s.next}while(s!==t);return mc(s)}function IE(t,e,i,s,l,u){var p=t;do{for(var g=p.next.next;g!==p.prev;){if(p.i!==g.i&&zE(p,g)){var v=Ev(p,g);return p=mc(p,p.next),v=mc(v,v.next),Rd(p,e,i,s,l,u,0),void Rd(v,e,i,s,l,u,0)}g=g.next}p=p.next}while(p!==t)}function CE(t,e){return t.x-e.x}function PE(t,e){var i=function(l,u){var p,g=u,v=l.x,w=l.y,S=-1/0;do{if(w<=g.y&&w>=g.next.y&&g.next.y!==g.y){var A=g.x+(w-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(A<=v&&A>S&&(S=A,p=g.x<g.next.x?g:g.next,A===v))return p}g=g.next}while(g!==u);if(!p)return null;var C,R=p,L=p.x,O=p.y,V=1/0;g=p;do v>=g.x&&g.x>=L&&v!==g.x&&Hu(w<O?v:S,w,L,O,w<O?S:v,w,g.x,g.y)&&(C=Math.abs(w-g.y)/(v-g.x),zd(g,l)&&(C<V||C===V&&(g.x>p.x||g.x===p.x&&DE(p,g)))&&(p=g,V=C)),g=g.next;while(g!==R);return p}(t,e);if(!i)return e;var s=Ev(i,t);return mc(s,s.next),mc(i,i.next)}function DE(t,e){return Nn(t.prev,t,e.prev)<0&&Nn(e.next,t,t.next)<0}function uy(t,e,i,s,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function RE(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Hu(t,e,i,s,l,u,p,g){return(l-p)*(e-g)>=(t-p)*(u-g)&&(t-p)*(s-g)>=(i-p)*(e-g)&&(i-p)*(u-g)>=(l-p)*(s-g)}function zE(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,s){var l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==s.i&&l.next.i!==s.i&&Sv(l,l.next,i,s))return!0;l=l.next}while(l!==i);return!1}(t,e)&&(zd(t,e)&&zd(e,t)&&function(i,s){var l=i,u=!1,p=(i.x+s.x)/2,g=(i.y+s.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&p<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==i);return u}(t,e)&&(Nn(t.prev,t,e.prev)||Nn(t,e.prev,e))||dm(t,e)&&Nn(t.prev,t,t.next)>0&&Nn(e.prev,e,e.next)>0)}function Nn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function dm(t,e){return t.x===e.x&&t.y===e.y}function Sv(t,e,i,s){var l=pm(Nn(t,e,i)),u=pm(Nn(t,e,s)),p=pm(Nn(i,s,t)),g=pm(Nn(i,s,e));return l!==u&&p!==g||!(l!==0||!fm(t,i,e))||!(u!==0||!fm(t,s,e))||!(p!==0||!fm(i,t,s))||!(g!==0||!fm(i,e,s))}function fm(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function pm(t){return t>0?1:t<0?-1:0}function zd(t,e){return Nn(t.prev,t,t.next)<0?Nn(t,e,t.next)>=0&&Nn(t,t.prev,e)>=0:Nn(t,e,t.prev)<0||Nn(t,t.next,e)<0}function Ev(t,e){var i=new hy(t.i,t.x,t.y),s=new hy(e.i,e.x,e.y),l=t.next,u=e.prev;return t.next=e,e.prev=t,i.next=l,l.prev=i,s.next=i,i.prev=s,u.next=s,s.prev=u,s}function Av(t,e,i,s){var l=new hy(t,e,i);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Ld(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function hy(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dy(t,e,i,s){for(var l=0,u=e,p=i-s;u<i;u+=s)l+=(t[p]-t[u])*(t[u+1]+t[p+1]),p=u;return l}cy.exports=hm,cy.exports.default=hm,hm.deviation=function(t,e,i,s){var l=e&&e.length,u=Math.abs(dy(t,0,l?e[0]*i:t.length,i));if(l)for(var p=0,g=e.length;p<g;p++)u-=Math.abs(dy(t,e[p]*i,p<g-1?e[p+1]*i:t.length,i));var v=0;for(p=0;p<s.length;p+=3){var w=s[p]*i,S=s[p+1]*i,A=s[p+2]*i;v+=Math.abs((t[w]-t[A])*(t[S+1]-t[w+1])-(t[w]-t[S])*(t[A+1]-t[w+1]))}return u===0&&v===0?0:Math.abs((v-u)/u)},hm.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,l=0;l<t.length;l++){for(var u=0;u<t[l].length;u++)for(var p=0;p<e;p++)i.vertices.push(t[l][u][p]);l>0&&i.holes.push(s+=t[l-1].length)}return i};var mm=dt(cy.exports);function fy(t,e){const i=t.length;if(i<=1)return[t];const s=[];let l,u;for(let p=0;p<i;p++){const g=wl(t[p]);g!==0&&(t[p].area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(l&&s.push(l),l=[t[p]]):l.push(t[p]))}if(l&&s.push(l),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(vp(s[p],e,1,s[p].length-1,LE),s[p]=s[p].slice(0,e));return s}function LE(t,e){return e.area-t.area}function py(t,e,i){const s=i.patternDependencies;let l=!1;for(const u of e){const p=u.paint.get(`${t}-pattern`);p.isConstant()||(l=!0);const g=p.constantOr(null);g&&(l=!0,s[g]=!0)}return l}function my(t,e,i,s,l){const u=l.patternDependencies;for(const p of e){const g=p.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:s},i,{},l.availableImages);v=v&&v.name?v.name:v,u[v]=!0,i.patterns[p.id]=v}}return i}class _y{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ur,this.indexArray=new Hn,this.indexArray2=new Yr,this.programConfigurations=new Na(e.layers,e.zoom),this.segments=new Cn,this.segments2=new Cn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,s,l){this.hasPattern=py("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:g,id:v,index:w,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,C=Ua(g,A);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),C,s))continue;const R=u?u.evaluate(C,{},s,i.availableImages):void 0,L={id:v,properties:g.properties,type:g.type,sourceLayerIndex:S,index:w,geometry:A?C.geometry:ia(g,s,l),patterns:{},sortKey:R};p.push(L)}u&&p.sort((g,v)=>g.sortKey-v.sortKey);for(const g of p){const{geometry:v,index:w,sourceLayerIndex:S}=g;if(this.hasPattern){const A=my("fill",this.layers,g,this.zoom,i);this.patternFeatures.push(A)}else this.addFeature(g,v,w,s,{},i.availableImages,i.brightness);i.featureIndex.insert(e[w].feature,v,w,S,this.index)}}update(e,i,s,l,u){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,s,l,u)}addFeatures(e,i,s,l,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ME),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,l,u,p=[],g){for(const v of fy(i,500)){let w=0;for(const O of v)w+=O.length;const S=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=S.vertexLength,C=[],R=[];for(const O of v){if(O.length===0)continue;O!==v[0]&&R.push(C.length/2);const V=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),j=V.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(j+O.length-1,j),C.push(O[0].x),C.push(O[0].y);for(let X=1;X<O.length;X++)this.layoutVertexArray.emplaceBack(O[X].x,O[X].y),this.indexArray2.emplaceBack(j+X-1,j+X),C.push(O[X].x),C.push(O[X].y);V.vertexLength+=O.length,V.primitiveLength+=O.length}const L=mm(C,R);for(let O=0;O<L.length;O+=3)this.indexArray.emplaceBack(A+L[O],A+L[O+1],A+L[O+2]);S.vertexLength+=w,S.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,p,l,g)}}St(_y,"FillBucket",{omit:["layers","patternFeatures"]});const kE=new ye({"fill-sort-key":new be(se.layout_fill["fill-sort-key"]),visibility:new me(se.layout_fill.visibility)});var OE={paint:new ye({"fill-antialias":new me(se.paint_fill["fill-antialias"]),"fill-opacity":new be(se.paint_fill["fill-opacity"]),"fill-color":new be(se.paint_fill["fill-color"]),"fill-outline-color":new be(se.paint_fill["fill-outline-color"]),"fill-translate":new me(se.paint_fill["fill-translate"]),"fill-translate-anchor":new me(se.paint_fill["fill-translate-anchor"]),"fill-pattern":new be(se.paint_fill["fill-pattern"]),"fill-emissive-strength":new me(se.paint_fill["fill-emissive-strength"])}),layout:kE};const FE=ei([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),BE=ei([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),NE=ei([{name:"a_centroid_pos",components:2,type:"Uint16"}]),VE=ei([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),jE=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:UE}=FE;var _m={},GE=Hc,Iv=Zu;function Zu(t,e,i,s,l){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=l,t.readFields($E,this,e)}function $E(t,e,i){t==1?e.id=i.readVarint():t==2?function(s,l){for(var u=s.readVarint()+s.pos;s.pos<u;){var p=l._keys[s.readVarint()],g=l._values[s.readVarint()];l.properties[p]=g}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function qE(t){for(var e,i,s=0,l=0,u=t.length,p=u-1;l<u;p=l++)s+=((i=t[p]).x-(e=t[l]).x)*(e.y+i.y);return s}Zu.types=["Unknown","Point","LineString","Polygon"],Zu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,s=1,l=0,u=0,p=0,g=[];t.pos<i;){if(l<=0){var v=t.readVarint();s=7&v,l=v>>3}if(l--,s===1||s===2)u+=t.readSVarint(),p+=t.readSVarint(),s===1&&(e&&g.push(e),e=[]),e.push(new GE(u,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&g.push(e),g},Zu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,s=0,l=0,u=0,p=1/0,g=-1/0,v=1/0,w=-1/0;t.pos<e;){if(s<=0){var S=t.readVarint();i=7&S,s=S>>3}if(s--,i===1||i===2)(l+=t.readSVarint())<p&&(p=l),l>g&&(g=l),(u+=t.readSVarint())<v&&(v=u),u>w&&(w=u);else if(i!==7)throw new Error("unknown command "+i)}return[p,v,g,w]},Zu.prototype.toGeoJSON=function(t,e,i){var s,l,u=this.extent*Math.pow(2,i),p=this.extent*t,g=this.extent*e,v=this.loadGeometry(),w=Zu.types[this.type];function S(R){for(var L=0;L<R.length;L++){var O=R[L];R[L]=[360*(O.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+g)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(s=0;s<v.length;s++)A[s]=v[s][0];S(v=A);break;case 2:for(s=0;s<v.length;s++)S(v[s]);break;case 3:for(v=function(R){var L=R.length;if(L<=1)return[R];for(var O,V,j=[],X=0;X<L;X++){var ee=qE(R[X]);ee!==0&&(V===void 0&&(V=ee<0),V===ee<0?(O&&j.push(O),O=[R[X]]):O.push(R[X]))}return O&&j.push(O),j}(v),s=0;s<v.length;s++)for(l=0;l<v[s].length;l++)S(v[s][l])}v.length===1?v=v[0]:w="Multi"+w;var C={type:"Feature",geometry:{type:w,coordinates:v},properties:this.properties};return"id"in this&&(C.id=this.id),C};var WE=Iv,Cv=Pv;function Pv(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(HE,this,e),this.length=this._features.length}function HE(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(s){for(var l=null,u=s.readVarint()+s.pos;s.pos<u;){var p=s.readVarint()>>3;l=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return l}(i))}Pv.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new WE(this._pbf,e,this.extent,this._keys,this._values)};var ZE=Cv;function QE(t,e,i){if(t===3){var s=new ZE(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}var gy=_m.VectorTile=function(t,e){this.layers=t.readFields(QE,{},e)},gm=_m.VectorTileFeature=Iv;function ym(t,e,i,s){const l=[],u=s===0?(p,g,v,w,S,A)=>{p.push(new ct(A,v+(A-g)/(w-g)*(S-v)))}:(p,g,v,w,S,A)=>{p.push(new ct(g+(A-v)/(S-v)*(w-g),A))};for(const p of t){const g=[];for(const v of p){if(v.length<=2)continue;const w=[];for(let C=0;C<v.length-1;C++){const R=v[C].x,L=v[C].y,O=v[C+1].x,V=v[C+1].y,j=s===0?R:L,X=s===0?O:V;j<e?X>e&&u(w,R,L,O,V,e):j>i?X<i&&u(w,R,L,O,V,i):w.push(v[C]),X<e&&j>=e&&u(w,R,L,O,V,e),X>i&&j<=i&&u(w,R,L,O,V,i)}let S=v[v.length-1];const A=s===0?S.x:S.y;A>=e&&A<=i&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),g.push(w))}g.length&&l.push(g)}return l}function xm(t,e){return t.x-e.x||t.y-e.y}function Dv(t,e){return xm(t.min,e.min)===0&&xm(t.max,e.max)===0}function Rv(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function zv(t,e,i){const s=1/ut,l=1/(1<<i.canonical.z),u=(e.x*s+i.canonical.x)*l+i.wrap,p=(e.y*s+i.canonical.y)*l;return{min:new ct((t.x*s+i.canonical.x)*l+i.wrap,(t.y*s+i.canonical.y)*l),max:new ct(u,p)}}function XE(t,e,i){const s=1<<i.canonical.z,l=((e.x-i.wrap)*s-i.canonical.x)*ut,u=(e.y*s-i.canonical.y)*ut;return{min:new ct(((t.x-i.wrap)*s-i.canonical.x)*ut,(t.y*s-i.canonical.y)*ut),max:new ct(l,u)}}function Lv(t,e,i,s,l,u,p){const g=t.indices,v=t.vertices,w=[];for(let S=s;S<s+l;S+=3){const A=e[i[S+0]+u],C=e[i[S+1]+u],R=e[i[S+2]+u],L=Math.min(A.x,C.x,R.x),O=Math.max(A.x,C.x,R.x),V=Math.min(A.y,C.y,R.y),j=Math.max(A.y,C.y,R.y);w.length=0,t.grid.query(new ct(L,V),new ct(O,j),w);for(let X=0;X<w.length;X++){const ee=w[X];if(Jg(v[g[3*ee+0]],v[g[3*ee+1]],v[g[3*ee+2]],A,C,R,p))return!0}}return!1}function kv(t,e,i,s){if(!t||!i)return!1;let l=t.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<t.vertices.length)return kv(i,s,t,e);const u=e.canonical,p=s.canonical,g=Math.pow(2,p.z-u.z);l=t.vertices.map(v=>new ct((v.x+u.x*ut)*g-p.x*ut,(v.y+u.y*ut)*g-p.y*ut))}return Lv(i,l,t.indices,0,t.indices.length,0,0)}_m.VectorTileLayer=Cv;class Ov{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Fv(t,e,i,s){let l=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(s[p])<1e-15){if(i[p]<t[p]||i[p]>e[p])return null}else{const g=1/s[p];let v=(t[p]-i[p])*g,w=(e[p]-i[p])*g;if(v>w){const S=v;v=w,w=S}if(v>l&&(l=v),w<u&&(u=w),l>u)return null}return l}function Bv(t,e,i,s,l,u,p,g,v,w,S){const A=s-t,C=l-e,R=u-i,L=p-t,O=g-e,V=v-i,j=S[1]*V-S[2]*O,X=S[2]*L-S[0]*V,ee=S[0]*O-S[1]*L,K=A*j+C*X+R*ee;if(Math.abs(K)<1e-15)return null;const le=1/K,ie=w[0]-t,ue=w[1]-e,pe=w[2]-i,ve=(ie*j+ue*X+pe*ee)*le;if(ve<0||ve>1)return null;const Re=ue*R-pe*C,we=pe*A-ie*R,Fe=ie*C-ue*A,Oe=(S[0]*Re+S[1]*we+S[2]*Fe)*le;return Oe<0||ve+Oe>1?null:(L*Re+O*we+V*Fe)*le}function Nv(t,e,i){return(t-e)/(i-e)}function Vv(t,e,i,s,l,u,p,g,v){const w=1<<i,S=u-s,A=p-l,C=(t+1)/w*S+s,R=(e+0)/w*A+l,L=(e+1)/w*A+l;g[0]=(t+0)/w*S+s,g[1]=R,v[0]=C,v[1]=L}class jv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(u){const p=Math.ceil(Math.log2(u.dim/8)),g=[];let v=Math.ceil(Math.pow(2,p));const w=1/v,S=(R,L,O,V,j)=>{const X=V?1:0,ee=(R+1)*O-X,K=L*O,le=(L+1)*O-X;j[0]=R*O,j[1]=K,j[2]=ee,j[3]=le};let A=new Ov(v);const C=[];for(let R=0;R<v*v;R++){S(R%v,Math.floor(R/v),w,!1,C);const L=qa(C[0],C[1],u),O=qa(C[2],C[1],u),V=qa(C[2],C[3],u),j=qa(C[0],C[3],u);A.minimums.push(Math.min(L,O,V,j)),A.maximums.push(Math.max(L,O,V,j)),A.leaves.push(1)}for(g.push(A),v/=2;v>=1;v/=2){const R=g[g.length-1];A=new Ov(v);for(let L=0;L<v*v;L++){S(L%v,Math.floor(L/v),2,!0,C);const O=R.getElevation(C[0],C[1]),V=R.getElevation(C[2],C[1]),j=R.getElevation(C[2],C[3]),X=R.getElevation(C[0],C[3]),ee=R.isLeaf(C[0],C[1]),K=R.isLeaf(C[2],C[1]),le=R.isLeaf(C[2],C[3]),ie=R.isLeaf(C[0],C[3]),ue=Math.min(O.min,V.min,j.min,X.min),pe=Math.max(O.max,V.max,j.max,X.max),ve=ee&&K&&le&&ie;A.maximums.push(pe),A.minimums.push(ue),A.leaves.push(pe-ue<=5&&ve?1:0)}g.push(A)}return g}(this.dem),s=i.length-1,l=i[s];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,l,u,p,g=1){return Fv([e,i,-100],[s,l,this.maximums[0]*g],u,p)}raycast(e,i,s,l,u,p,g=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,i,s,l,u,p,g);if(v==null)return null;const w=[],S=[],A=[],C=[],R=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:L,t:O,nodex:V,nodey:j,depth:X}=R.pop();if(this.leaves[L]){Vv(V,j,X,e,i,s,l,A,C);const K=1<<X,le=(V+0)/K,ie=(V+1)/K,ue=(j+0)/K,pe=(j+1)/K,ve=qa(le,ue,this.dem)*g,Re=qa(ie,ue,this.dem)*g,we=qa(ie,pe,this.dem)*g,Fe=qa(le,pe,this.dem)*g,Oe=Bv(A[0],A[1],ve,C[0],A[1],Re,C[0],C[1],we,u,p),ze=Bv(C[0],C[1],we,A[0],C[1],Fe,A[0],A[1],ve,u,p),We=Math.min(Oe!==null?Oe:Number.MAX_VALUE,ze!==null?ze:Number.MAX_VALUE);if(We!==Number.MAX_VALUE)return We;{const $e=r.Q.scaleAndAdd([],u,p,O);if(Uv(ve,Re,Fe,we,Nv($e[0],A[0],C[0]),Nv($e[1],A[1],C[1]))>=$e[2])return O}continue}let ee=0;for(let K=0;K<this._siblingOffset.length;K++){Vv((V<<1)+this._siblingOffset[K][0],(j<<1)+this._siblingOffset[K][1],X+1,e,i,s,l,A,C),A[2]=-100,C[2]=this.maximums[this.childOffsets[L]+K]*g;const le=Fv(A,C,u,p);if(le!=null){const ie=le;w[K]=ie;let ue=!1;for(let pe=0;pe<ee&&!ue;pe++)ie>=w[S[pe]]&&(S.splice(pe,0,K),ue=!0);ue||(S[ee]=K),ee++}}for(let K=0;K<ee;K++){const le=S[K];R.push({idx:this.childOffsets[L]+le,t:w[le],nodex:(V<<1)+this._siblingOffset[le][0],nodey:(j<<1)+this._siblingOffset[le][1],depth:X+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,l,u){if(e[l].isLeaf(i,s)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=l-1,g=e[p];let v=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){const A=2*i+this._siblingOffset[S][0],C=2*s+this._siblingOffset[S][1],R=g.getElevation(A,C),L=g.isLeaf(A,C),O=this._addNode(R.min,R.max,L);L&&(v|=1<<S),w||(w=O)}for(let S=0;S<this._siblingOffset.length;S++)v&1<<S||this._construct(e,2*i+this._siblingOffset[S][0],2*s+this._siblingOffset[S][1],p,w+S)}}function Uv(t,e,i,s,l,u){return ai(ai(t,i,u),ai(e,s,u),l)}function qa(t,e,i){const s=i.dim,l=mi(t*s-.5,0,s-1),u=mi(e*s-.5,0,s-1),p=Math.floor(l),g=Math.floor(u),v=Math.min(p+1,s-1),w=Math.min(g+1,s-1);return Uv(i.get(p,g),i.get(v,g),i.get(p,w),i.get(v,w),l-p,u-g)}const YE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function KE(t,e,i){return(256*t*256+256*e+i)/10-1e4}function JE(t,e,i){return 256*t+e+i/256-32768}class vm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,l=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return gn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const u=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let v=0;v<u;v++)p[this._idx(-1,v)]=p[this._idx(0,v)],p[this._idx(u,v)]=p[this._idx(u-1,v)],p[this._idx(v,-1)]=p[this._idx(v,0)],p[this._idx(v,u)]=p[this._idx(v,u-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(u,-1)]=p[this._idx(u-1,0)],p[this._idx(-1,u)]=p[this._idx(0,u-1)],p[this._idx(u,u)]=p[this._idx(u-1,u-1)]}const g=s==="terrarium"?JE:KE;for(let v=0;v<p.length;++v){const w=4*v;this.floatView[v]=g(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Is.now()}_buildQuadTree(){this._tree=new jv(this)}get(e,i,s=!1){s&&(e=mi(e,-1,this.dim),i=mi(i,-1,this.dim));const l=this._idx(e,i);return this.floatView[l]}set(e,i,s){const l=this._idx(e,i),u=this.floatView[l];return this.floatView[l]=s,s-u}static getUnpackVector(e){return YE[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],l=vm.getUnpackVector(i);let u=Math.floor((e+l[3])/l[2]);return s[2]=u%256,u=Math.floor(u/256),s[1]=u%256,u=Math.floor(u/256),s[0]=u,s}getPixels(){return new Tv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,u=i*this.dim+this.dim,p=s*this.dim,g=s*this.dim+this.dim;switch(i){case-1:l=u-1;break;case 1:u=l+1}switch(s){case-1:p=g-1;break;case 1:g=p+1}const v=-i*this.dim,w=-s*this.dim;for(let S=p;S<g;S++)for(let A=l;A<u;A++){const C=4*this._idx(A,S),R=4*this._idx(A+v,S+w);this.pixels[C+0]=e.pixels[R+0],this.pixels[C+1]=e.pixels[R+1],this.pixels[C+2]=e.pixels[R+2],this.pixels[C+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}St(vm,"DEMData"),St(jv,"DemMinMaxQuadTree",{omit:["dem"]});class Qu{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const l=s||e.findDEMTileFor(i);if(!l||!l.dem)return;const u=l.dem,p=l.tileID,g=1<<i.canonical.z-p.canonical.z;return new Qu(l,u.dim/ut/g,[(i.canonical.x/g-p.canonical.x)*u.dim,(i.canonical.y/g-p.canonical.y)*u.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(s);return new ct(l,u)}getElevationAt(e,i,s,l){const u=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],g=Math.floor(u),v=Math.floor(p),w=this._dem;return l=!!l,s?ai(ai(w.get(g,v,l),w.get(g,v+1,l),p-v),ai(w.get(g+1,v,l),w.get(g+1,v+1,l),p-v),u-g):w.get(g,v,l)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*kr(1,e)*this._dem.stride}}const eA=gm.types,tA=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],iA=["fill-extrusion-flood-light-ground-radius"],nA=Math.pow(2,13),rA=Math.pow(2,15)-1,Gv=new ct(0,1),Wa=2147483648;function kd(t,e,i,s,l,u,p,g){t.emplaceBack((e<<1)+p,(i<<1)+u,(Math.floor(s*nA)<<1)+l,Math.round(g))}function bm(t,e,i,s,l,u){t.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+l,u)}function Od(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class $v{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class qv{constructor(){this.centroidXY=new ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class Wv{constructor(){this.acc=new ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let l=!!this.borders;i.x<e.min.x?(e.min.x=i.x,l=!0):i.x>e.max.x&&(e.max.x=i.x,l=!0),i.y<e.min.y?(e.min.y=i.y,l=!0):i.y>e.max.y&&(e.max.y=i.y,l=!0),((i.x===0||i.x===ut)&&i.x===s.x)!=((i.y===0||i.y===ut)&&i.y===s.y)&&this.processBorderOverlap(i,s),l&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,ai(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>ut!=e.x>ut&&this.addBorderIntersection(1,ai(i.y,e.y,(ut-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ai(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>ut!=e.y>ut&&this.addBorderIntersection(3,ai(i.x,e.x,(ut-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new ct(0,0):new ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Hv(t,e){const i=t.add(e)._unit(),s=mi(t.x*i.x+t.y*i.y,-1,1);var l,u,p;return l=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(l)))/4*rA*((u=t).x*(p=e).y-u.y*p.x<0?-1:1)}const sA=[t=>t.x<0,t=>t.x>ut,t=>t.y<0,t=>t.y>ut];function oA(t,e,i,s){const l=[4];if(s===0)return l;i._mult(s);const u=t.sub(i),p=e.sub(i),g=[t,e,u,p];for(let v=0;v<4;v++)for(const w of g)if(sA[v](w)){l.push(v);break}return l}class Zv{constructor(e){this.vertexArray=new Ir,this.indexArray=new Hn,this.programConfigurations=new Na(e.layers,e.zoom,i=>iA.includes(i)),this._segments=new Cn,this.hiddenByLandmarkVertexArray=new Fg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Cn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,l=!1){const u=e.length;if(u>2){let p=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let v;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const w=e[0],S=e[1];v=Hv(w.sub(e[u-1])._perp()._unit(),S.sub(w)._perp()._unit())}for(let w=0;w<u;w++){const S=w===u-1?0:w+1,A=e[w],C=e[S],R=e[S===u-1?0:S+1],L=C.sub(A)._perp()._unit(),O=Hv(L,R.sub(C)._perp()._unit()),V=v,j=O;if(yy(A,C,i)||l&&Yv(A,i)&&Yv(C,i)){v=O;continue}const X=g.vertexLength;bm(this.vertexArray,A,C,1,1,V),bm(this.vertexArray,A,C,1,0,V),bm(this.vertexArray,A,C,0,1,j),bm(this.vertexArray,A,C,0,0,j),g.vertexLength+=4;const ee=oA(A,C,L,s);for(const K of ee)this._segmentToGroundQuads[p].push({id:X,region:K}),this._segmentToRegionTriCounts[p][K]+=2,g.primitiveLength+=2;v=O}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((l,u)=>l.region-u.region);for(let s=0;s<i;s++){const l=this._segmentToGroundQuads[s],u=e[s],p=this._segmentToRegionTriCounts[s];p.reduce((v,w)=>v+w,0);let g=0;for(let v=0;v<=4;v++){const w=p[v];if(w!==0){let S=this.regionSegments[v];S||(S=this.regionSegments[v]=new Cn);const A={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+g,vertexLength:u.vertexLength,primitiveLength:w};S.get().push(A)}g+=w}for(let v=0;v<l.length;v++){const w=l[v].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,l,u,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,l,u,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,BE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,l,u,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,l,u,p)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&Wa?1:0;for(let l=e.groundVertexArrayOffset;l<i;++l)this.hiddenByLandmarkVertexArray.emplace(l,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,VE.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class wm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Hn,this.footprintVertices=new ur,this.footprintSegments=[],this.layoutVertexArray=new hr,this.centroidVertexArray=new Nx,this.indexArray=new Hn,this.programConfigurations=new Na(e.layers,e.zoom,i=>tA.includes(i)),this.segments=new Cn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Zv(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,s,l){this.features=[],this.hasPattern=py("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=im(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:p,index:g,sourceLayerIndex:v}of e){const w=this.layers[0]._featureFilter.needGeometry,S=Ua(u,w);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),S,s))continue;const A={id:p,sourceLayerIndex:v,index:g,geometry:w?S.geometry:ia(u,s,l),properties:u.properties,type:u.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(my("fill-extrusion",this.layers,A,this.zoom,i)):this.addFeature(A,A.geometry,g,s,{},i.availableImages,l,i.brightness),i.featureIndex.insert(u,A.geometry,g,v,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,l,u,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,i,s,l,u,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,l,u){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const g=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,g,s,l,u),this.groundEffect.update(e,i,g,s,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,jE.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,NE.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,l,u,p,g,v){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,S=[new ct(0,0),new ct(ut,ut)],A=g.projection,C=A.name==="globe",R=eA[e.type]==="Polygon",L=new Wv;L.centroidDataIndex=this.centroidData.length;const O=new qv,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);O.height=j,O.vertexArrayOffset=this.layoutVertexArray.length,O.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new xs);const X=fy(i,500);for(let pe=X.length-1;pe>=0;pe--){const ve=X[pe];(ve.length===0||(ee=ve[0]).every(Re=>Re.x<=0)||ee.every(Re=>Re.x>=ut)||ee.every(Re=>Re.y<=0)||ee.every(Re=>Re.y>=ut))&&X.splice(pe,1)}var ee;let K;if(C)K=tb(X,S,l);else{K=[];for(const pe of X)K.push({polygon:pe,bounds:S})}const le=R?this.edgeRadius:0,ie=le>0&&this.zoom<17,ue=(pe,ve)=>{if(pe.length===0)return!1;const Re=pe[pe.length-1];return ve.x===Re.x&&ve.y===Re.y};for(const{polygon:pe,bounds:ve}of K){let Re=0,we=0;for(const We of pe)R&&!We[0].equals(We[We.length-1])&&We.push(We[0]),we+=R?We.length-1:We.length;const Fe=this.segments.prepareSegment((R?5:4)*we,this.layoutVertexArray,this.indexArray);O.footprintSegIdx<0&&(O.footprintSegIdx=this.footprintSegments.length),O.polygonSegIdx<0&&(O.polygonSegIdx=this.polygonSegments.length);const Oe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ze=new $v;if(ze.vertexOffset=this.footprintVertices.length,ze.indexOffset=3*this.footprintIndices.length,ze.ringIndices=[],R){const We=[],$e=[];Re=Fe.vertexLength;for(let Qe=0;Qe<pe.length;Qe++){const Ne=pe[Qe];Ne.length&&Qe!==0&&$e.push(We.length/2);const It=[];let Tt,et;Tt=Ne[1].sub(Ne[0])._perp()._unit(),ze.ringIndices.push(Ne.length-1);for(let jt=1;jt<Ne.length;jt++){const zt=Ne[jt],Ct=Ne[jt===Ne.length-1?1:jt+1],tt=zt.clone();if(le){et=Ct.sub(zt)._perp()._unit();const Ft=Tt.add(et)._unit(),ti=le*Math.min(4,1/(Tt.x*Ft.x+Tt.y*Ft.y));tt.x+=ti*Ft.x,tt.y+=ti*Ft.y,tt.x=Math.round(tt.x),tt.y=Math.round(tt.y),Tt=et}!V||le!==0&&!ie||ue(It,tt)||It.push(tt),kd(this.layoutVertexArray,tt.x,tt.y,0,0,1,1,0),Fe.vertexLength++,this.footprintVertices.emplaceBack(zt.x,zt.y),We.push(zt.x,zt.y),C&&Od(this.layoutVertexExtArray,A.projectTilePoint(tt.x,tt.y,l),A.upVector(l,tt.x,tt.y))}V&&(le===0||ie)&&(It.length!==0&&ue(It,It[0])&&It.pop(),this.groundEffect.addData(It,ve,w))}const Xe=mm(We,$e);for(let Qe=0;Qe<Xe.length;Qe+=3)this.footprintIndices.emplaceBack(ze.vertexOffset+Xe[Qe+0],ze.vertexOffset+Xe[Qe+1],ze.vertexOffset+Xe[Qe+2]),this.indexArray.emplaceBack(Re+Xe[Qe],Re+Xe[Qe+2],Re+Xe[Qe+1]),Fe.primitiveLength++;ze.indexCount+=Xe.length,ze.vertexCount+=this.footprintVertices.length-ze.vertexOffset}for(let We=0;We<pe.length;We++){const $e=pe[We];L.startRing(O,$e[0]);let Xe=$e.length>4&&Kv($e[$e.length-2],$e[0],$e[1]),Qe=le?aA($e[$e.length-2],$e[0],$e[1],le):0;const Ne=[];let It,Tt,et;Tt=$e[1].sub($e[0])._perp()._unit();let jt=!0;for(let zt=1,Ct=0;zt<$e.length;zt++){let tt=$e[zt-1],Ft=$e[zt];const ti=$e[zt===$e.length-1?1:zt+1];if(L.appendEdge(O,Ft,tt),yy(Ft,tt,ve)){le&&(Tt=ti.sub(Ft)._perp()._unit(),jt=!jt);continue}const $t=Ft.sub(tt)._perp(),si=$t.x/(Math.abs($t.x)+Math.abs($t.y)),ii=$t.y>0?1:0,di=tt.dist(Ft);if(Ct+di>32768&&(Ct=0),le){et=ti.sub(Ft)._perp()._unit();let Pi=Xv(tt,Ft,ti,Qv(Tt,et),le);isNaN(Pi)&&(Pi=0);const vi=Ft.sub(tt)._unit();tt=tt.add(vi.mult(Qe))._round(),Ft=Ft.add(vi.mult(-Pi))._round(),Qe=Pi,Tt=et,V&&this.zoom>=17&&(ue(Ne,tt)||Ne.push(tt),ue(Ne,Ft)||Ne.push(Ft))}const Gt=Fe.vertexLength,Hi=$e.length>4&&Kv(tt,Ft,ti);let qi=Jv(Ct,Xe,jt);if(kd(this.layoutVertexArray,tt.x,tt.y,si,ii,0,0,qi),kd(this.layoutVertexArray,tt.x,tt.y,si,ii,0,1,qi),Ct+=di,qi=Jv(Ct,Hi,!jt),Xe=Hi,kd(this.layoutVertexArray,Ft.x,Ft.y,si,ii,0,0,qi),kd(this.layoutVertexArray,Ft.x,Ft.y,si,ii,0,1,qi),Fe.vertexLength+=4,this.indexArray.emplaceBack(Gt+0,Gt+1,Gt+2),this.indexArray.emplaceBack(Gt+1,Gt+3,Gt+2),Fe.primitiveLength+=2,le){const Pi=Re+(zt===1?$e.length-2:zt-2),vi=zt===1?Re:Pi+1;if(this.indexArray.emplaceBack(Gt+1,Pi,Gt+3),this.indexArray.emplaceBack(Pi,vi,Gt+3),Fe.primitiveLength+=2,It===void 0&&(It=Gt),!yy(ti,$e[zt],ve)){const Di=zt===$e.length-1?It:Fe.vertexLength;this.indexArray.emplaceBack(Gt+2,Gt+3,Di),this.indexArray.emplaceBack(Gt+3,Di+1,Di),this.indexArray.emplaceBack(Gt+3,vi,Di+1),Fe.primitiveLength+=3}jt=!jt}if(C){const Pi=this.layoutVertexExtArray,vi=A.projectTilePoint(tt.x,tt.y,l),Di=A.projectTilePoint(Ft.x,Ft.y,l),rn=A.upVector(l,tt.x,tt.y),Ki=A.upVector(l,Ft.x,Ft.y);Od(Pi,vi,rn),Od(Pi,vi,rn),Od(Pi,Di,Ki),Od(Pi,Di,Ki)}}R&&(Re+=$e.length-1),V&&le&&this.zoom>=17&&(Ne.length!==0&&ue(Ne,Ne[0])&&Ne.pop(),this.groundEffect.addData(Ne,ve,w,le>0))}this.footprintSegments.push(ze),Oe.triangleCount=this.indexArray.length-Oe.triangleArrayOffset,this.polygonSegments.push(Oe),++O.footprintSegLen,++O.polygonSegLen}if(O.vertexCount=this.layoutVertexArray.length-O.vertexArrayOffset,O.groundVertexCount=this.groundEffect.vertexArray.length-O.groundVertexArrayOffset,O.vertexCount!==0){if(O.centroidXY=L.borders?Gv:this.encodeCentroid(L,O),this.centroidData.push(O),L.borders){this.featuresOnBorder.push(L);const pe=this.featuresOnBorder.length-1;for(let ve=0;ve<L.borders.length;ve++)L.borders[ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ve].push(pe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,p,l,v),this.groundEffect.addPaintPropertiesData(e,s,u,p,l,v),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const v=this.centroidData[g],w=+(v.min.y+v.max.y>ut),S=2*w+(+(v.min.x+v.max.x>ut)^w);for(let A=0;A<v.polygonSegLen;A++){const C=v.polygonSegIdx+A;e.push({centroidIdx:g,subtile:S,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const i=new Hn;e.sort((g,v)=>g.triangleSegmentIdx===v.triangleSegmentIdx?g.subtile-v.subtile:g.triangleSegmentIdx-v.triangleSegmentIdx);let s=0,l=0,u=0;for(const g of e){if(g.triangleSegmentIdx!==s)break;u++}const p=e.length;for(;l!==e.length;){s=e[l].triangleSegmentIdx;let g=0,v=l,w=l;for(let S=v;S<u&&e[S].subtile===g;S++)w++;for(;v!==u;){const S=e[v];g=S.subtile;const A=this.centroidData[S.centroidIdx].min.clone(),C=this.centroidData[S.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=v;L<w;L++){const O=e[L],V=this.polygonSegments[O.polygonSegmentIdx],j=this.centroidData[O.centroidIdx].min,X=this.centroidData[O.centroidIdx].max,ee=this.indexArray.uint16;for(let K=V.triangleArrayOffset;K<V.triangleArrayOffset+V.triangleCount;K++)i.emplaceBack(ee[3*K],ee[3*K+1],ee[3*K+2]);R.primitiveLength+=V.triangleCount,A.x=Math.min(A.x,j.x),A.y=Math.min(A.y,j.y),C.x=Math.max(C.x,X.x),C.y=Math.max(C.y,X.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:A,max:C}),v=w;for(let L=v;L<u&&e[L].subtile===e[v].subtile;L++)w++}l=u;for(let S=l;S<p&&e[S].triangleSegmentIdx===e[l].triangleSegmentIdx;S++)u++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){let l=0,u=0;const p=1<<e.canonical.z;if(i){const O=i.getMinMaxForTile(e);O&&(l=O.min,u=O.max)}u+=this.maxHeight;const g=e.toUnwrapped();let v;const w=[g.canonical.x/p+g.wrap,g.canonical.y/p],S=[(g.canonical.x+1)/p+g.wrap,(g.canonical.y+1)/p],A=new Cn,C=(O,V,j)=>[O[0]*(1-j[0])+V[0]*j[0],O[1]*(1-j[1])+V[1]*j[1]],R=[],L=[];for(const O of this.triangleSubSegments){R[0]=O.min.x/ut,R[1]=O.min.y/ut,L[0]=O.max.x/ut,L[1]=O.max.y/ut;const V=C(w,S,R),j=C(w,S,L);if(new un([V[0],V[1],l],[j[0],j[1],u]).intersectsPrecise(s)===0){v&&(A.segments.push(v),v=void 0);continue}const X=O.segment;v&&v.vertexOffset!==X.vertexOffset&&(A.segments.push(v),v=void 0),v?(v.vertexLength+=X.vertexLength,v.primitiveLength+=X.primitiveLength):v={vertexOffset:X.vertexOffset,primitiveLength:X.primitiveLength,vertexLength:X.vertexLength,primitiveOffset:X.primitiveOffset,sortKey:void 0,vaos:{}}}return v&&A.segments.push(v),A}encodeCentroid(e,i){const s=e.centroid(),l=i.span(),u=Math.min(7,Math.round(l.x*this.tileToMeter/10)),p=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new ct(mi(s.x,1,ut-1)<<3|u,mi(s.y,1,ut-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new ct(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const l=i[0][0]!==s?0:1;return new ct(6|(i[0][0]!==s?0:65528),(i[l][0]+i[l][1])/2<<3|6)}{const l=i[2][0]!==s?2:3;return new ct((i[l][0]+i[l][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Wa,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,l=e.flags&Wa?Gv:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==l.y||u!==l.x){for(let p=i;p<s;++p)this.centroidVertexArray.emplace(p,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(u,p){if(u.length!==p.length)return!1;for(let g=0;g<u.length;g++)if(u[g].sourceId!==p[g].sourceId||!Dv(u[g],p[g]))return!1;return!0}(this.activeReplacements,s))return;if(this.activeReplacements=s,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const u of this.centroidData)u.flags&=2147483647;const l=[];for(const u of this.activeReplacements){const p=Math.pow(2,u.footprintTileId.canonical.z-e.canonical.z);for(const g of this.centroidData)if(!(g.flags&Wa||u.min.x>g.max.x||g.min.x>u.max.x||u.min.y>g.max.y||g.min.y>u.max.y))for(let v=0;v<g.footprintSegLen;v++){const w=this.footprintSegments[g.footprintSegIdx+v];if(l.length=0,lA(this.footprintVertices,w.vertexOffset,w.vertexCount,u.footprintTileId.canonical,e.canonical,l),Lv(u.footprint,l,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-p)){g.flags|=Wa;break}}}for(const u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let l=!1;for(let u=0;u<s.footprintSegLen;u++){const p=this.footprintSegments[s.footprintSegIdx+u];let g=0;for(const v of p.ringIndices){for(let w=g,S=v+g-1;w<v+g;S=w++){const A=this.footprintVertices.int16[2*(w+p.vertexOffset)+0],C=this.footprintVertices.int16[2*(w+p.vertexOffset)+1],R=this.footprintVertices.int16[2*(S+p.vertexOffset)+1];C>i!=R>i&&e<(this.footprintVertices.int16[2*(S+p.vertexOffset)+0]-A)*(i-C)/(R-C)+A&&(l=!l)}g=v}}return l}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,l=!0;const u=4*(e+ut)*ut+(i+ut);if(this.partLookup.hasOwnProperty(u)){const p=this.partLookup[u];return p?{height:p.height,hidden:!!(p.flags&Wa)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||this.footprintContainsPoint(e,i,p)&&p&&p.height>s&&(s=p.height,this.partLookup[u]=p,l=!!(p.flags&Wa));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:l};this.partLookup[u]=void 0}}function Qv(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function aA(t,e,i,s){const l=e.sub(t)._perp()._unit(),u=i.sub(e)._perp()._unit();return Xv(t,e,i,Qv(l,u),s)}function Xv(t,e,i,s,l){const u=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(i)/3,l*u/s)}function yy(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function Yv(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function Kv(t,e,i){if(t.x<0||t.x>=ut||e.x<0||e.x>=ut||i.x<0||i.x>=ut)return!1;const s=i.sub(e),l=s.perp(),u=t.sub(e);return(s.x*u.x+s.y*u.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function Jv(t,e,i){const s=e?2|t:-3&t;return i?1|s:-2&s}function eb(){const t=Math.PI/32,e=Math.tan(t),i=$u;return i*Math.sqrt(1+2*e*e)-i}function tb(t,e,i){const s=1<<i.z,l=Kr(i.x/s),u=Kr((i.x+1)/s),p=dr(i.y/s),g=dr((i.y+1)/s);return function(v,w,S,A,C=0,R){const L=[];if(!v.length||!S||!A)return L;const O=(ie,ue)=>{for(const pe of ie)L.push({polygon:pe,bounds:ue})},V=Math.ceil(Math.log2(S)),j=Math.ceil(Math.log2(A)),X=V-j,ee=[];for(let ie=0;ie<Math.abs(X);ie++)ee.push(X>0?0:1);for(let ie=0;ie<Math.min(V,j);ie++)ee.push(0),ee.push(1);let K=v;if(K=ym(K,w[0].y-C,w[1].y+C,1),K=ym(K,w[0].x-C,w[1].x+C,0),!K.length)return L;const le=[];for(ee.length?le.push({polygons:K,bounds:w,depth:0}):O(K,w);le.length;){const ie=le.pop(),ue=ie.depth,pe=ee[ue],ve=ie.bounds[0],Re=ie.bounds[1],we=pe===0?ve.x:ve.y,Fe=pe===0?Re.x:Re.y,Oe=R?R(pe,we,Fe):.5*(we+Fe),ze=ym(ie.polygons,we-C,Oe+C,pe),We=ym(ie.polygons,Oe-C,Fe+C,pe);if(ze.length){const $e=[ve,new ct(pe===0?Oe:Re.x,pe===1?Oe:Re.y)];ee.length>ue+1?le.push({polygons:ze,bounds:$e,depth:ue+1}):O(ze,$e)}if(We.length){const $e=[new ct(pe===0?Oe:ve.x,pe===1?Oe:ve.y),Re];ee.length>ue+1?le.push({polygons:We,bounds:$e,depth:ue+1}):O(We,$e)}}return L}(t,e,Math.ceil((u-l)/11.25),Math.ceil((p-g)/11.25),1,(v,w,S)=>{if(v===0)return .5*(w+S);{const A=dr((i.y+w/ut)/s);return(ta(.5*(dr((i.y+S/ut)/s)+A))*s-i.y)*ut}})}function lA(t,e,i,s,l,u){const p=Math.pow(2,s.z-l.z);for(let g=0;g<i;g++){let v=t.int16[2*(g+e)+0],w=t.int16[2*(g+e)+1];v=(v+l.x*ut)*p-s.x*ut,w=(w+l.y*ut)*p-s.y*ut,u.push(new ct(v,w))}}St(wm,"FillExtrusionBucket",{omit:["layers","features"]}),St(qv,"PartData"),St($v,"FootprintSegment"),St(Wv,"BorderCentroidData"),St(Zv,"GroundEffect");const cA=new ye({visibility:new me(se["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new me(se["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var uA={paint:new ye({"fill-extrusion-opacity":new me(se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new be(se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new me(se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new me(se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new be(se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new be(se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new be(se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new me(se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new me(se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new me(se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new me(se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new me(se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new me(se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new me(se["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new me(se["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new be(se["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new be(se["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new me(se["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new me(se["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new me(se["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new me(se["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new me(se["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:cA};class Xu extends ct{constructor(e,i,s){super(e,i),this.z=s}}function Fd(t,e){return t.x*e.x+t.y*e.y}function ib(t,e){if(t.length===1){let i=0;const s=e[i++];let l;for(;!l||s.equals(l);)if(l=e[i++],!l)return 1/0;for(;i<e.length;i++){const u=e[i],p=t[0],g=l.sub(s),v=u.sub(s),w=p.sub(s),S=Fd(g,g),A=Fd(g,v),C=Fd(v,v),R=Fd(w,g),L=Fd(w,v),O=S*C-A*A,V=(C*R-A*L)/O,j=(S*L-A*R)/O,X=s.z*(1-V-j)+l.z*V+u.z*j;if(isFinite(X))return X}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function nb(t,e,i,s,l,u,p,g){const v=p*l.getElevationAt(t,e,!0,!0),w=u[0]!==0,S=w?u[1]===0?p*(u[0]/7-450):p*function(A,C,R){const L=Math.floor(C[0]/8),O=Math.floor(C[1]/8),V=10*(C[0]-8*L),j=10*(C[1]-8*O),X=A.getElevationAt(L,O,!0,!0),ee=A.getMeterToDEM(R),K=Math.floor(.5*(V*ee-1)),le=Math.floor(.5*(j*ee-1)),ie=A.tileCoordToPixel(L,O),ue=2*K+1,pe=2*le+1,ve=function(We,$e,Xe,Qe,Ne){return[We.getElevationAtPixel($e,Xe,!0),We.getElevationAtPixel($e+Ne,Xe,!0),We.getElevationAtPixel($e,Xe+Ne,!0),We.getElevationAtPixel($e+Qe,Xe+Ne,!0)]}(A,ie.x-K,ie.y-le,ue,pe),Re=Math.abs(ve[0]-ve[1]),we=Math.abs(ve[2]-ve[3]),Fe=Math.abs(ve[0]-ve[2])+Math.abs(ve[1]-ve[3]),Oe=Math.min(.25,.5*ee*(Re+we)/ue),ze=Math.min(.25,.5*ee*Fe/pe);return X+Math.max(Oe*V,ze*j)}(l,u,g):v;return{base:v+(i===0)?-1:i,top:w?Math.max(S+s,v+i+2):v+s}}const hA=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:dA}=hA,fA=ei([{name:"a_packed",components:4,type:"Float32"}]),{members:pA}=fA,mA=ei([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:_A}=mA;class rb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new $a({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=Dh(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const l=[];let u=e.length%2==1?-e[e.length-1]*s:0,p=e[0]*s,g=!0;l.push({left:u,right:p,isDash:g,zeroLength:e[0]===0});let v=e[0];for(let w=1;w<e.length;w++){g=!g;const S=e[w];u=v*s,v+=S,p=v*s,l.push({left:u,right:p,isDash:g,zeroLength:S===0})}return l}addRoundDash(e,i,s){const l=i/2;for(let u=-s;u<=s;u++){const p=this.width*(this.nextRow+s+u);let g=0,v=e[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++g]);const S=Math.abs(w-v.left),A=Math.abs(w-v.right),C=Math.min(S,A);let R;const L=u/s*(l+1);if(v.isDash){const O=l-Math.abs(L);R=Math.sqrt(C*C+O*O)}else R=l-Math.sqrt(C*C+L*L);this.image.data[p+w]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let v=e.length-1;v>=0;--v){const w=e[v],S=e[v+1];w.zeroLength?e.splice(v,1):S&&S.isDash===w.isDash&&(S.left=w.left,e.splice(v,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,g=e[p];for(let v=0;v<this.width;v++){v/g.right>1&&(g=e[++p]);const w=Math.abs(v-g.left),S=Math.abs(v-g.right),A=Math.min(w,S);this.image.data[u+v]=Math.max(0,Math.min(255,(g.isDash?A:-A)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const l=i==="round",u=l?7:0,p=2*u+1;if(this.nextRow+p>this.height)return gn("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let S=0;S<e.length;S++)e[S]<0&&(gn("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),g+=e[S];if(g!==0){const S=this.width/g,A=this.getDashRanges(e,this.width,S);l?this.addRoundDash(A,S,u):this.addRegularDash(A,i==="square"?.5*S:0)}const v=this.nextRow+u;this.nextRow+=p;const w={tl:[v,u],br:[g,0]};return this.positions[s]=w,w}}St(rb,"LineAtlas");const gA=gm.types,yA=Math.cos(Math.PI/180*37.5),xA=Math.cos(Math.PI/180*5);class xy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new gr,this.layoutVertexArray2=new Wn,this.patternVertexArray=new nr,this.indexArray=new Hn,this.programConfigurations=new Na(e.layers,e.zoom),this.segments=new Cn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,l){this.hasPattern=py("line",this.layers,i);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:S,id:A,index:C,sourceLayerIndex:R}of e){const L=this.layers[0]._featureFilter.needGeometry,O=Ua(S,L);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),O,s))continue;const V=u?u.evaluate(O,{},s):void 0,j={id:A,properties:S.properties,type:S.type,sourceLayerIndex:R,index:C,geometry:L?O.geometry:ia(S,s,l),patterns:{},sortKey:V};p.push(j)}u&&p.sort((S,A)=>S.sortKey-A.sortKey);const{lineAtlas:g,featureIndex:v}=i,w=this.addConstantDashes(g);for(const S of p){const{geometry:A,index:C,sourceLayerIndex:R}=S;if(w&&this.addFeatureDashes(S,g),this.hasPattern){const L=my("line",this.layers,S,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(S,A,C,s,g.positions,i.availableImages,i.brightness);v.insert(e[C].feature,A,C,R,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const l=s.paint.get("line-dasharray").value,u=s.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")i=!0;else{const p=u.value,g=l.value;if(!g)continue;e.addDash(g,p)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let g,v;if(u.kind==="constant"){if(g=u.value,!g)continue}else g=u.evaluate({zoom:s},e);v=p.kind==="constant"?p.value:p.evaluate({zoom:s},e),i.addDash(g,v),e.patterns[l.id]=i.getKey(g,v)}}update(e,i,s,l,u){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,s,l,u)}addFeatures(e,i,s,l,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,pA)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,_A)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,l,u,p,g){const v=this.layers[0].layout,w=v.get("line-join").evaluate(e,{}),S=v.get("line-cap").evaluate(e,{}),A=v.get("line-miter-limit"),C=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of i)this.addLine(R,e,w,S,A,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,p,l,g)}addLine(e,i,s,l,u,p){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;const g=s==="none";if(this.patternJoinNone=this.hasPattern&&g,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<e.length-1;X++)this.totalDistance+=e[X].dist(e[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=gA[i.type]==="Polygon";let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let S=0;for(;S<w-1&&e[S].equals(e[S+1]);)S++;if(w<(v?3:2))return;s==="bevel"&&(u=1.05);const A=this.overscaling<=16?15*ut/(512*this.overscaling):0,C=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let R,L,O,V,j;this.e1=this.e2=-1,v&&(R=e[w-2],j=e[S].sub(R)._unit()._perp());for(let X=S;X<w;X++){if(O=X===w-1?v?e[S+1]:void 0:e[X+1],O&&e[X].equals(O))continue;j&&(V=j),R&&(L=R),R=e[X],j=O?O.sub(R)._unit()._perp():V,V=V||j;const ee=L&&O;let K=ee?s:v||g?"butt":l;const le=V.x*j.x+V.y*j.y;if(g){const Fe=function(Oe){if(Oe.patternJoinNone){const ze=Oe.segmentPoints.length/2,We=Oe.lineSoFar-Oe.segmentStart;for(let $e=0;$e<ze;++$e){const Xe=Oe.segmentPoints[2*$e+1],Qe=Math.round(Oe.segmentPoints[2*$e])+.5+.25*Xe;Oe.patternVertexArray.emplaceBack(Qe,We),Oe.patternVertexArray.emplaceBack(Qe,We)}Oe.segmentPoints=[],Oe.segmentStart=Oe.lineSoFar}Oe.e1=Oe.e2=-1};if(ee&&le<xA){this.updateDistance(L,R),this.addCurrentVertex(R,V,1,1,C),Fe(this),this.addCurrentVertex(R,j,-1,-1,C);continue}if(L){if(!O){this.updateDistance(L,R),this.addCurrentVertex(R,V,1,1,C),Fe(this);continue}K="miter"}}let ie=V.add(j);ie.x===0&&ie.y===0||ie._unit();const ue=ie.x*j.x+ie.y*j.y,pe=ue!==0?1/ue:1/0,ve=2*Math.sqrt(2-2*ue),Re=ue<yA&&L&&O,we=V.x*j.y-V.y*j.x>0;if(Re&&X>S){const Fe=R.dist(L);if(Fe>2*A){const Oe=R.sub(R.sub(L)._mult(A/Fe)._round());this.updateDistance(L,Oe),this.addCurrentVertex(Oe,V,0,0,C),L=Oe}}if(ee&&K==="round"&&(pe<p?K="miter":pe<=2&&(K="fakeround")),K==="miter"&&pe>u&&(K="bevel"),K==="bevel"&&(pe>2&&(K="flipbevel"),pe<u&&(K="miter")),L&&this.updateDistance(L,R),K==="miter")ie._mult(pe),this.addCurrentVertex(R,ie,0,0,C);else if(K==="flipbevel"){if(pe>100)ie=j.mult(-1);else{const Fe=pe*V.add(j).mag()/V.sub(j).mag();ie._perp()._mult(Fe*(we?-1:1))}this.addCurrentVertex(R,ie,0,0,C),this.addCurrentVertex(R,ie.mult(-1),0,0,C)}else if(K==="bevel"||K==="fakeround"){const Fe=-Math.sqrt(pe*pe-1),Oe=we?Fe:0,ze=we?0:Fe;if(L&&this.addCurrentVertex(R,V,Oe,ze,C),K==="fakeround"){const We=Math.round(180*ve/Math.PI/20);for(let $e=1;$e<We;$e++){let Xe=$e/We;if(Xe!==.5){const Ne=Xe-.5;Xe+=Xe*Ne*(Xe-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*Ne*Ne+(.848013+le*(.215638*le-1.06021)))}const Qe=j.sub(V)._mult(Xe)._add(V)._unit()._mult(we?-1:1);this.addHalfVertex(R,Qe.x,Qe.y,!1,we,0,C)}}O&&this.addCurrentVertex(R,j,-Oe,-ze,C)}else K==="butt"?this.addCurrentVertex(R,ie,0,0,C):K==="square"?(L||this.addCurrentVertex(R,ie,-1,-1,C),this.addCurrentVertex(R,ie,0,0,C),L&&this.addCurrentVertex(R,ie,1,1,C)):K==="round"&&(L&&(this.addCurrentVertex(R,V,0,0,C),this.addCurrentVertex(R,V,1,1,C,!0)),O&&(this.addCurrentVertex(R,j,-1,-1,C,!0),this.addCurrentVertex(R,j,0,0,C)));if(Re&&X<w-1){const Fe=R.dist(O);if(Fe>2*A){const Oe=R.add(O.sub(R)._mult(A/Fe)._round());this.updateDistance(R,Oe),this.addCurrentVertex(Oe,j,0,0,C),R=Oe}}}}addCurrentVertex(e,i,s,l,u,p=!1){const g=i.y*l-i.x,v=-i.y-i.x*l;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,p,!1,s,u),this.addHalfVertex(e,g,v,p,!0,-l,u),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,s)}addHalfVertex({x:e,y:i},s,l,u,p,g,v){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(i<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),v.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}St(xy,"LineBucket",{omit:["layers","patternFeatures"]});const vA=new ye({"line-cap":new be(se.layout_line["line-cap"]),"line-join":new be(se.layout_line["line-join"]),"line-miter-limit":new me(se.layout_line["line-miter-limit"]),"line-round-limit":new me(se.layout_line["line-round-limit"]),"line-sort-key":new be(se.layout_line["line-sort-key"]),visibility:new me(se.layout_line.visibility)});var sb={paint:new ye({"line-opacity":new be(se.paint_line["line-opacity"]),"line-color":new be(se.paint_line["line-color"]),"line-translate":new me(se.paint_line["line-translate"]),"line-translate-anchor":new me(se.paint_line["line-translate-anchor"]),"line-width":new be(se.paint_line["line-width"]),"line-gap-width":new be(se.paint_line["line-gap-width"]),"line-offset":new be(se.paint_line["line-offset"]),"line-blur":new be(se.paint_line["line-blur"]),"line-dasharray":new be(se.paint_line["line-dasharray"]),"line-pattern":new be(se.paint_line["line-pattern"]),"line-gradient":new Ze(se.paint_line["line-gradient"]),"line-trim-offset":new me(se.paint_line["line-trim-offset"]),"line-emissive-strength":new me(se.paint_line["line-emissive-strength"]),"line-border-width":new be(se.paint_line["line-border-width"]),"line-border-color":new be(se.paint_line["line-border-color"])}),layout:vA};function ob(t,e,i){return e*(ut/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function ab(t,e){return 1/ob(t,1,e.tileZoom)}function lb(t,e,i,s){return t.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const cb=t=>{const e=[];ub(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=t.layout.get("line-join").constantOr("miter")==="none",l=!!t.paint.get("line-pattern").constantOr(1);return s&&l&&e.push("LINE_JOIN_NONE"),e};function ub(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const hb=new class extends be{possiblyEvaluate(t,e){return e=new H(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,s){return e=Qr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,s)}}(sb.paint.properties["line-width"].specification);function db(t,e){return e>0?e+2*t:t}hb.useIntegerZoom=!0;const bA=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),wA=ei([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),TA=ei([{name:"a_projected_pos",components:4,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const MA=ei([{name:"a_z_offset",components:1,type:"Float32"}],4),SA=ei([{name:"a_texb",components:2,type:"Uint16"}]),EA=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),AA=ei([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fb=ei([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),IA=ei([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ei([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fr=24;const Ks=128;function vy(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new H(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=i;let u=0;for(;u<s.length&&s[u]<=t;)u++;u=Math.max(0,u-1);let p=u;for(;p<s.length&&s[p]<t+1;)p++;p=Math.min(s.length-1,p);const g=s[u],v=s[p];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:g,maxZoom:v,minSize:i.evaluate(new H(g)),maxSize:i.evaluate(new H(v)),interpolationType:l}}}function Tm(t,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:l}){return t.kind==="source"?s/Ks:t.kind==="composite"?ai(s/Ks,l/Ks,i):e}function Yu(t,e){let i=0,s=0;if(t.kind==="constant")s=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:p}=t,g=l?mi($r.interpolationFactor(l,e,u,p),0,1):0;t.kind==="camera"?s=ai(t.minSize,t.maxSize,g):i=g}return{uSizeT:i,uSize:s}}var CA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ks,evaluateSizeForFeature:Tm,evaluateSizeForZoom:Yu,getSizeData:vy});function PA(t,e,i){return t.sections.forEach(s=>{s.text=function(l,u,p){const g=u.layout.get("text-transform").evaluate(p,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),oe.applyArabicShaping&&(l=oe.applyArabicShaping(l)),l}(s.text,e,i)}),t}const Bd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function DA(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function RA(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var zA={read:function(t,e,i,s,l){var u,p,g=8*l-s-1,v=(1<<g)-1,w=v>>1,S=-7,A=i?l-1:0,C=i?-1:1,R=t[e+A];for(A+=C,u=R&(1<<-S)-1,R>>=-S,S+=g;S>0;u=256*u+t[e+A],A+=C,S-=8);for(p=u&(1<<-S)-1,u>>=-S,S+=s;S>0;p=256*p+t[e+A],A+=C,S-=8);if(u===0)u=1-w;else{if(u===v)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,s),u-=w}return(R?-1:1)*p*Math.pow(2,u-s)},write:function(t,e,i,s,l,u){var p,g,v,w=8*u-l-1,S=(1<<w)-1,A=S>>1,C=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=s?0:u-1,L=s?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,p=S):(p=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-p))<1&&(p--,v*=2),(e+=p+A>=1?C/v:C*Math.pow(2,1-A))*v>=2&&(p++,v/=2),p+A>=S?(g=0,p=S):p+A>=1?(g=(e*v-1)*Math.pow(2,l),p+=A):(g=e*Math.pow(2,A-1)*Math.pow(2,l),p=0));l>=8;t[i+R]=255&g,R+=L,g/=256,l-=8);for(p=p<<l|g,w+=l;w>0;t[i+R]=255&p,R+=L,p/=256,w-=8);t[i+R-L]|=128*O}},pb=hn,Mm=zA;function hn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}hn.Varint=0,hn.Fixed64=1,hn.Bytes=2,hn.Fixed32=5;var by=4294967296,mb=1/by,_b=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ra(t){return t.type===hn.Bytes?t.readVarint()+t.pos:t.pos+1}function Ku(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function gb(t,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var l=i.pos-1;l>=t;l--)i.buf[l+s]=i.buf[l]}function LA(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function kA(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function OA(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function FA(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function BA(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function NA(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function VA(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function jA(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function UA(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Sm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Ju(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function yb(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}hn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),l=s>>3,u=this.pos;this.type=7&s,t(l,e,this),this.pos===u&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Sm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=yb(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Sm(this.buf,this.pos)+Sm(this.buf,this.pos+4)*by;return this.pos+=8,t},readSFixed64:function(){var t=Sm(this.buf,this.pos)+yb(this.buf,this.pos+4)*by;return this.pos+=8,t},readFloat:function(){var t=Mm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Mm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(l,u,p){var g,v,w=p.buf;if(g=(112&(v=w[p.pos++]))>>4,v<128||(g|=(127&(v=w[p.pos++]))<<3,v<128)||(g|=(127&(v=w[p.pos++]))<<10,v<128)||(g|=(127&(v=w[p.pos++]))<<17,v<128)||(g|=(127&(v=w[p.pos++]))<<24,v<128)||(g|=(1&(v=w[p.pos++]))<<31,v<128))return Ku(l,g,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&_b?function(i,s,l){return _b.decode(i.subarray(s,l))}(this.buf,e,t):function(i,s,l){for(var u="",p=s;p<l;){var g,v,w,S=i[p],A=null,C=S>239?4:S>223?3:S>191?2:1;if(p+C>l)break;C===1?S<128&&(A=S):C===2?(192&(g=i[p+1]))==128&&(A=(31&S)<<6|63&g)<=127&&(A=null):C===3?(v=i[p+2],(192&(g=i[p+1]))==128&&(192&v)==128&&((A=(15&S)<<12|(63&g)<<6|63&v)<=2047||A>=55296&&A<=57343)&&(A=null)):C===4&&(v=i[p+2],w=i[p+3],(192&(g=i[p+1]))==128&&(192&v)==128&&(192&w)==128&&((A=(15&S)<<18|(63&g)<<12|(63&v)<<6|63&w)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,C=1):A>65535&&(A-=65536,u+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),u+=String.fromCharCode(A),p+=C}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==hn.Bytes)return t.push(this.readVarint(e));var i=ra(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==hn.Bytes)return t.push(this.readSVarint());var e=ra(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==hn.Bytes)return t.push(this.readBoolean());var e=ra(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==hn.Bytes)return t.push(this.readFloat());var e=ra(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==hn.Bytes)return t.push(this.readDouble());var e=ra(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==hn.Bytes)return t.push(this.readFixed32());var e=ra(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==hn.Bytes)return t.push(this.readSFixed32());var e=ra(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==hn.Bytes)return t.push(this.readFixed64());var e=ra(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==hn.Bytes)return t.push(this.readSFixed64());var e=ra(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===hn.Varint)for(;this.buf[this.pos++]>127;);else if(e===hn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===hn.Fixed32)this.pos+=4;else{if(e!==hn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ju(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ju(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ju(this.buf,-1&t,this.pos),Ju(this.buf,Math.floor(t*mb),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ju(this.buf,-1&t,this.pos),Ju(this.buf,Math.floor(t*mb),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(u,p,g){g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,g.buf[g.pos]=127&(u>>>=7)}(s,0,i),function(u,p){var g=(7&u)<<4;p.buf[p.pos++]|=g|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(l,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,l,u){for(var p,g,v=0;v<l.length;v++){if((p=l.charCodeAt(v))>55295&&p<57344){if(!g){p>56319||v+1===l.length?(s[u++]=239,s[u++]=191,s[u++]=189):g=p;continue}if(p<56320){s[u++]=239,s[u++]=191,s[u++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(s[u++]=239,s[u++]=191,s[u++]=189,g=null);p<128?s[u++]=p:(p<2048?s[u++]=p>>6|192:(p<65536?s[u++]=p>>12|224:(s[u++]=p>>18|240,s[u++]=p>>12&63|128),s[u++]=p>>6&63|128),s[u++]=63&p|128)}return u}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&gb(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Mm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Mm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var s=this.pos-i;s>=128&&gb(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,i){this.writeTag(t,hn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,LA,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,kA,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,BA,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,OA,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,FA,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,NA,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,VA,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,jA,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,UA,e)},writeBytesField:function(t,e){this.writeTag(t,hn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,hn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,hn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,hn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,hn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,hn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,hn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,hn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,hn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,hn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var eh=dt(pb);const wy=3;function GA(t,e,i){e.glyphs=[],t===1&&i.readMessage($A,e)}function $A(t,e,i){if(t===3){const{id:s,bitmap:l,width:u,height:p,left:g,top:v,advance:w}=i.readMessage(qA,{});e.glyphs.push({id:s,bitmap:new $a({width:u+2*wy,height:p+2*wy},l),metrics:{width:u,height:p,left:g,top:v,advance:w}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function qA(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const xb=wy,bs={horizontal:1,vertical:2,horizontalOnly:3};class Nd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new Nd;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Nd;return i.imageName=e,i}}class th{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new th;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?s.addImageSection(u):s.addTextSection(u,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,s){let l="";for(let u=0;u<i.length;u++){const p=i.charCodeAt(u+1)||null,g=i.charCodeAt(u-1)||null;l+=!s&&(p&&b(p)&&!Bd[i[u+1]]||g&&b(g)&&!Bd[i[u-1]])||!Bd[i[u]]?i[u]:Bd[i[u]]}return l}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Em[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Em[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new th;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Nd.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void gn("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(Nd.forImage(i)),this.sectionIndex.push(this.sections.length-1)):gn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ty(t,e,i,s,l,u,p,g,v,w,S,A,C,R,L){const O=th.fromFeature(t,l);A===bs.vertical&&O.verticalizePunctuation(C);let V=[];const j=function(ie,ue,pe,ve,Re,we){if(!ie)return[];const Fe=[],Oe=function(Xe,Qe,Ne,It,Tt,et){let jt=0;for(let zt=0;zt<Xe.length();zt++){const Ct=Xe.getSection(zt);jt+=vb(Xe.getCodePoint(zt),Ct,It,Tt,Qe,et)}return jt/Math.max(1,Math.ceil(jt/Ne))}(ie,ue,pe,ve,Re,we),ze=ie.text.indexOf("​")>=0;let We=0;for(let Xe=0;Xe<ie.length();Xe++){const Qe=ie.getSection(Xe),Ne=ie.getCodePoint(Xe);if(Em[Ne]||(We+=vb(Ne,Qe,ve,Re,ue,we)),Xe<ie.length()-1){const It=!(($e=Ne)<11904||!(n["Bopomofo Extended"]($e)||n.Bopomofo($e)||n["CJK Compatibility Forms"]($e)||n["CJK Compatibility Ideographs"]($e)||n["CJK Compatibility"]($e)||n["CJK Radicals Supplement"]($e)||n["CJK Strokes"]($e)||n["CJK Symbols and Punctuation"]($e)||n["CJK Unified Ideographs Extension A"]($e)||n["CJK Unified Ideographs"]($e)||n["Enclosed CJK Letters and Months"]($e)||n["Halfwidth and Fullwidth Forms"]($e)||n.Hiragana($e)||n["Ideographic Description Characters"]($e)||n["Kangxi Radicals"]($e)||n["Katakana Phonetic Extensions"]($e)||n.Katakana($e)||n["Vertical Forms"]($e)||n["Yi Radicals"]($e)||n["Yi Syllables"]($e)));(WA[Ne]||It||Qe.imageName)&&Fe.push(wb(Xe+1,We,Oe,Fe,HA(Ne,ie.getCodePoint(Xe+1),It&&ze),!1))}}var $e;return Tb(wb(ie.length(),We,Oe,Fe,0,!0))}(O,w,u,e,s,R),{processBidirectionalText:X,processStyledBidirectionalText:ee}=oe;if(X&&O.sections.length===1){const ie=X(O.toString(),j);for(const ue of ie){const pe=new th;pe.text=ue,pe.sections=O.sections;for(let ve=0;ve<ue.length;ve++)pe.sectionIndex.push(0);V.push(pe)}}else if(ee){const ie=ee(O.text,O.sectionIndex,j);for(const ue of ie){const pe=new th;pe.text=ue[0],pe.sectionIndex=ue[1],pe.sections=O.sections,V.push(pe)}}else V=function(ie,ue){const pe=[],ve=ie.text;let Re=0;for(const we of ue)pe.push(ie.substring(Re,we)),Re=we;return Re<ve.length&&pe.push(ie.substring(Re,ve.length)),pe}(O,j);const K=[],le={positionedLines:K,text:O.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ie,ue,pe,ve,Re,we,Fe,Oe,ze,We,$e,Xe){let Qe=0,Ne=0,It=0;const Tt=Oe==="right"?1:Oe==="left"?0:.5;let et=!1;for(const ti of Re){const $t=ti.getSections();for(const si of $t){if(si.imageName)continue;const ii=ue[si.fontStack];if(ii&&(et=ii.ascender!==void 0&&ii.descender!==void 0,!et))break}if(!et)break}let jt=0;for(const ti of Re){ti.trim();const $t=ti.getMaxScale(),si=($t-1)*fr,ii={positionedGlyphs:[],lineOffset:0};ie.positionedLines[jt]=ii;const di=ii.positionedGlyphs;let Gt=0;if(!ti.length()){Ne+=we,++jt;continue}let Hi=0,qi=0;for(let vi=0;vi<ti.length();vi++){const Di=ti.getSection(vi),rn=ti.getSectionIndex(vi),Ki=ti.getCodePoint(vi);let yn=Di.scale,pn=null,vr=null,En=null,dn=fr,On=0;const sr=!(ze===bs.horizontal||!$e&&!y(Ki)||$e&&(Em[Ki]||(zt=Ki,n.Arabic(zt)||n["Arabic Supplement"](zt)||n["Arabic Extended-A"](zt)||n["Arabic Presentation Forms-A"](zt)||n["Arabic Presentation Forms-B"](zt))));if(Di.imageName){const or=ve[Di.imageName];if(!or)continue;En=Di.imageName,ie.iconsInText=ie.iconsInText||!0,vr=or.paddedRect;const en=or.displaySize;yn=yn*fr/Xe,pn={width:en[0],height:en[1],left:0,top:-xb,advance:sr?en[1]:en[0],localGlyph:!1},On=et?-pn.height*yn:$t*fr-17-en[1]*yn,dn=pn.advance;const Or=(sr?en[0]:en[1])*yn-fr*$t;Or>0&&Or>Gt&&(Gt=Or)}else{const or=pe[Di.fontStack];if(!or)continue;or[Ki]&&(vr=or[Ki]);const en=ue[Di.fontStack];if(!en)continue;const Or=en.glyphs[Ki];if(!Or)continue;if(pn=Or.metrics,dn=Ki!==8203?fr:0,et){const oa=en.ascender!==void 0?Math.abs(en.ascender):0,Fs=en.descender!==void 0?Math.abs(en.descender):0,ro=(oa+Fs)*yn;Hi<ro&&(Hi=ro,qi=(oa-Fs)/2*yn),On=-oa*yn}else On=($t-yn)*fr-17}sr?(ie.verticalizable=!0,di.push({glyph:Ki,imageName:En,x:Qe,y:Ne+On,vertical:sr,scale:yn,localGlyph:pn.localGlyph,fontStack:Di.fontStack,sectionIndex:rn,metrics:pn,rect:vr}),Qe+=dn*yn+We):(di.push({glyph:Ki,imageName:En,x:Qe,y:Ne+On,vertical:sr,scale:yn,localGlyph:pn.localGlyph,fontStack:Di.fontStack,sectionIndex:rn,metrics:pn,rect:vr}),Qe+=pn.advance*yn+We)}di.length!==0&&(It=Math.max(Qe-We,It),et?Mb(di,Tt,Gt,qi,we*$t/2):Mb(di,Tt,Gt,0,we/2)),Qe=0;const Pi=we*$t+Gt;ii.lineOffset=Math.max(Gt,si),Ne+=Pi,++jt}var zt;const Ct=Ne,{horizontalAlign:tt,verticalAlign:Ft}=My(Fe);(function(ti,$t,si,ii,di,Gt){const Hi=($t-si)*di,qi=-Gt*ii;for(const Pi of ti)for(const vi of Pi.positionedGlyphs)vi.x+=Hi,vi.y+=qi})(ie.positionedLines,Tt,tt,Ft,It,Ct),ie.top+=-Ft*Ct,ie.bottom=ie.top+Ct,ie.left+=-tt*It,ie.right=ie.left+It,ie.hasBaseline=et}(le,e,i,s,V,p,g,v,A,w,C,L),!function(ie){for(const ue of ie)if(ue.positionedGlyphs.length!==0)return!1;return!0}(K)&&le}const Em={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},WA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vb(t,e,i,s,l,u){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*fr/u+l:0}{const p=i[e.fontStack],g=p&&p.glyphs[t];return g?g.metrics.advance*e.scale+l:0}}function bb(t,e,i,s){const l=Math.pow(t-e,2);return s?t<e?l/2:2*l:l+Math.abs(i)*i}function HA(t,e,i){let s=0;return t===10&&(s-=1e4),i&&(s+=150),t!==40&&t!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function wb(t,e,i,s,l,u){let p=null,g=bb(e,i,l,u);for(const v of s){const w=bb(e-v.x,i,l,u)+v.badness;w<=g&&(p=v,g=w)}return{index:t,x:e,priorBreak:p,badness:g}}function Tb(t){return t?Tb(t.priorBreak).concat(t.index):[]}function My(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Mb(t,e,i,s,l){if(!(e||i||s||l))return;const u=t.length-1,p=t[u],g=(p.x+p.metrics.advance*p.scale)*e;for(let v=0;v<=u;v++)t[v].x-=g,t[v].y+=i+s+l}function ZA(t,e,i,s){const{horizontalAlign:l,verticalAlign:u}=My(s),p=i[0]-t.displaySize[0]*l,g=i[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:g,bottom:g+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function Sb(t,e,i,s,l,u){const p=t.imagePrimary;let g;if(p.content){const V=p.content,j=p.pixelRatio||1;g=[V[0]/j,V[1]/j,p.displaySize[0]-V[2]/j,p.displaySize[1]-V[3]/j]}const v=e.left*u,w=e.right*u;let S,A,C,R;i==="width"||i==="both"?(R=l[0]+v-s[3],A=l[0]+w+s[1]):(R=l[0]+(v+w-p.displaySize[0])/2,A=R+p.displaySize[0]);const L=e.top*u,O=e.bottom*u;return i==="height"||i==="both"?(S=l[1]+L-s[0],C=l[1]+O+s[2]):(S=l[1]+(L+O-p.displaySize[1])/2,C=S+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:S,right:A,bottom:C,left:R,collisionPadding:g}}class sa extends ct{constructor(e,i,s,l,u){super(e,i),this.angle=l,this.z=s,u!==void 0&&(this.segment=u)}clone(){return new sa(this.x,this.y,this.z,this.angle,this.segment)}}function Eb(t,e,i,s,l){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,g=0;for(;g>-i/2;){if(p--,p<0)return!1;g-=t[p].dist(u),u=t[p]}g+=t[p].dist(t[p+1]),p++;const v=[];let w=0;for(;g<i/2;){const S=t[p],A=t[p+1];if(!A)return!1;let C=t[p-1].angleTo(S)-S.angleTo(A);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:C}),w+=C;g-v[0].distance>s;)w-=v.shift().angleDelta;if(w>l)return!1;p++,g+=S.dist(A)}return!0}function Ab(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Ib(t,e,i){return t?.6*e*i:0}function Cb(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function QA(t,e,i,s,l,u){const p=Ib(i,l,u),g=Cb(i,s)*u;let v=0;const w=Ab(t)/2;for(let S=0;S<t.length-1;S++){const A=t[S],C=t[S+1],R=A.dist(C);if(v+R>w){const L=(w-v)/R,O=ai(A.x,C.x,L),V=ai(A.y,C.y,L),j=new sa(O,V,0,C.angleTo(A),S);return!p||Eb(t,j,g,p,e)?j:void 0}v+=R}}function XA(t,e,i,s,l,u,p,g,v){const w=Ib(s,u,p),S=Cb(s,l),A=S*p,C=t[0].x===0||t[0].x===v||t[0].y===0||t[0].y===v;return e-A<e/4&&(e=A+e/4),Pb(t,C?e/2*g%e:(S/2+2*u)*p*g%e,e,w,i,A,C,!1,v)}function Pb(t,e,i,s,l,u,p,g,v){const w=u/2,S=Ab(t);let A=0,C=e-i,R=[];for(let L=0;L<t.length-1;L++){const O=t[L],V=t[L+1],j=O.dist(V),X=V.angleTo(O);for(;C+i<A+j;){C+=i;const ee=(C-A)/j,K=ai(O.x,V.x,ee),le=ai(O.y,V.y,ee);if(K>=0&&K<v&&le>=0&&le<v&&C-w>=0&&C+w<=S){const ie=new sa(K,le,0,X,L);s&&!Eb(t,ie,u,s,l)||R.push(ie)}}A+=j}return g||R.length||p||(R=Pb(t,A/2,i,s,l,u,p,!0,v)),R}function Db(t,e,i,s,l){const u=[];for(let p=0;p<t.length;p++){const g=t[p];let v;for(let w=0;w<g.length-1;w++){let S=g[w],A=g[w+1];S.x<e&&A.x<e||(S.x<e?S=new ct(e,S.y+(e-S.x)/(A.x-S.x)*(A.y-S.y))._round():A.x<e&&(A=new ct(e,S.y+(e-S.x)/(A.x-S.x)*(A.y-S.y))._round()),S.y<i&&A.y<i||(S.y<i?S=new ct(S.x+(i-S.y)/(A.y-S.y)*(A.x-S.x),i)._round():A.y<i&&(A=new ct(S.x+(i-S.y)/(A.y-S.y)*(A.x-S.x),i)._round()),S.x>=s&&A.x>=s||(S.x>=s?S=new ct(s,S.y+(s-S.x)/(A.x-S.x)*(A.y-S.y))._round():A.x>=s&&(A=new ct(s,S.y+(s-S.x)/(A.x-S.x)*(A.y-S.y))._round()),S.y>=l&&A.y>=l||(S.y>=l?S=new ct(S.x+(l-S.y)/(A.y-S.y)*(A.x-S.x),l)._round():A.y>=l&&(A=new ct(S.x+(l-S.y)/(A.y-S.y)*(A.x-S.x),l)._round()),v&&S.equals(v[v.length-1])||(v=[S],u.push(v)),v.push(A)))))}}return u}function Rb(t){let e=0,i=0;for(const p of t)e+=p.w*p.h,i=Math.max(i,p.w);t.sort((p,g)=>g.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let l=0,u=0;for(const p of t)for(let g=s.length-1;g>=0;g--){const v=s[g];if(!(p.w>v.w||p.h>v.h)){if(p.x=v.x,p.y=v.y,u=Math.max(u,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===v.w&&p.h===v.h){const w=s.pop();g<s.length&&(s[g]=w)}else p.h===v.h?(v.x+=p.w,v.w-=p.w):p.w===v.w?(v.y+=p.h,v.h-=p.h):(s.push({x:v.x+p.w,y:v.y,w:v.w-p.w,h:p.h}),v.y+=p.h,v.h-=p.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}St(sa,"Anchor");const Jr=1;class Sy{constructor(e,{pixelRatio:i,version:s,stretchX:l,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=l,this.stretchY=u,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+Jr,this.paddedRect.y+Jr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Jr,this.paddedRect.y+this.paddedRect.h-Jr]}get displaySize(){return[(this.paddedRect.w-2*Jr)/this.pixelRatio,(this.paddedRect.h-2*Jr)/this.pixelRatio]}}class zb{constructor(e,i){const s={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,s,u),this.addImages(i,l,u);const{w:p,h:g}=Rb(u),v=new vs({width:p||1,height:g||1});for(const w in e){const S=e[w],A=s[w].paddedRect;vs.copy(S.data,v,{x:0,y:0},{x:A.x+Jr,y:A.y+Jr},S.data,S.sdf)}for(const w in i){const S=i[w],A=l[w].paddedRect,C=A.x+Jr,R=A.y+Jr,L=S.data.width,O=S.data.height;vs.copy(S.data,v,{x:0,y:0},{x:C,y:R},S.data),vs.copy(S.data,v,{x:0,y:O-1},{x:C,y:R-1},{width:L,height:1}),vs.copy(S.data,v,{x:0,y:0},{x:C,y:R+O},{width:L,height:1}),vs.copy(S.data,v,{x:L-1,y:0},{x:C-1,y:R},{width:1,height:O}),vs.copy(S.data,v,{x:0,y:0},{x:C+L,y:R},{width:1,height:O})}this.image=v,this.iconPositions=s,this.patternPositions=l}addImages(e,i,s){for(const l in e){const u=e[l],p={x:0,y:0,w:u.data.width+2*Jr,h:u.data.height+2*Jr};s.push(p),i[l]=new Sy(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const l in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[l],e.getImage(l,s),i),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l,s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[l,u]=e.tl,p=!!Object.keys(this.patternPositions).length;s.update(i.data,{useMipmap:p},{x:l,y:u})}}St(Sy,"ImagePosition"),St(zb,"ImageAtlas");const Vd=1e20;function Lb(t,e,i,s,l,u,p,g,v){for(let w=e;w<e+s;w++)kb(t,i*u+w,u,l,p,g,v);for(let w=i;w<i+l;w++)kb(t,w*u+e,1,s,p,g,v)}function kb(t,e,i,s,l,u,p){u[0]=0,p[0]=-Vd,p[1]=Vd,l[0]=t[e];for(let g=1,v=0,w=0;g<s;g++){l[g]=t[e+g*i];const S=g*g;do{const A=u[v];w=(l[g]-l[A]+S-A*A)/(g-A)/2}while(w<=p[v]&&--v>-1);v++,u[v]=g,p[v]=w,p[v+1]=Vd}for(let g=0,v=0;g<s;g++){for(;p[v+1]<g;)v++;const w=u[v],S=g-w;t[e+g*i]=l[w]+S*S}}const Js=2,Ey={none:0,ideographs:1,all:2};class ih{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,s){const l=[],u=this.urls[i]||Z.GLYPHS_URL;for(const p in e)for(const g of e[p])l.push({stack:p,id:g});Ph(l,({stack:p,id:g},v)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=w.glyphs[g];if(S!==void 0)return void v(null,{stack:p,id:g,glyph:S});if(S=this._tinySDF(w,p,g),S)return w.glyphs[g]=S,void v(null,{stack:p,id:g,glyph:S});const A=Math.floor(g/256);if(256*A>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void v(null,{stack:p,id:g,glyph:S});let C=w.requests[A];C||(C=w.requests[A]=[],ih.loadGlyphRange(p,A,u,this.requestManager,(R,L)=>{if(L){w.ascender=L.ascender,w.descender=L.descender;for(const O in L.glyphs)this._doesCharSupportLocalGlyph(+O)||(w.glyphs[+O]=L.glyphs[+O]);w.ranges[A]=!0}for(const O of C)O(R,L);delete w.requests[A]})),C.push((R,L)=>{R?v(R):L&&v(null,{stack:p,id:g,glyph:L.glyphs[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const v={};for(const{stack:w,id:S,glyph:A}of g)v[w]===void 0&&(v[w]={}),v[w].glyphs===void 0&&(v[w].glyphs={}),v[w].glyphs[S]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;s(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ey.none&&(this.localGlyphMode===Ey.all?!!this.localFontFamily:!!this.localFontFamily&&(n["CJK Unified Ideographs"](e)||n["Hangul Syllables"](e)||n.Hiragana(e)||n.Katakana(e)||n["CJK Symbols and Punctuation"](e)||n["CJK Unified Ideographs Extension A"](e)||n["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,s){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(s))return;let u=e.tinySDF;if(!u){let O="400";/bold/i.test(i)?O="900":/medium/i.test(i)?O="500":/light/i.test(i)&&(O="200"),u=e.tinySDF=new ih.TinySDF({fontFamily:l,fontWeight:O,fontSize:24*Js,buffer:3*Js,radius:8*Js}),u.fontWeight=O}if(this.localGlyphs[u.fontWeight][s])return this.localGlyphs[u.fontWeight][s];const p=String.fromCodePoint(s),{data:g,width:v,height:w,glyphWidth:S,glyphHeight:A,glyphLeft:C,glyphTop:R,glyphAdvance:L}=u.draw(p);return this.localGlyphs[u.fontWeight][s]={id:s,bitmap:new $a({width:v,height:w},g),metrics:{width:S/Js,height:A/Js,left:C/Js,top:R/Js-27,advance:L/Js,localGlyph:!0}}}}ih.loadGlyphRange=function(t,e,i,s,l){const u=256*e,p=u+255,g=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${u}-${p}`),su.Glyphs);Al(g,(v,w)=>{if(v)l(v);else if(w){const S={},A=function(C){return new eh(C).readFields(GA,{})}(w);for(const C of A.glyphs)S[C.id]=C;l(null,{glyphs:S,ascender:A.ascender,descender:A.descender})}})},ih.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const g=this.size=t+4*e,v=this._createCanvas(g),w=this.ctx=v.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${u} ${t}px ${l}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(t),p=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-l))),v=Math.min(this.size-this.buffer,p+Math.ceil(s)),w=g+2*this.buffer,S=v+2*this.buffer,A=Math.max(w*S,0),C=new Uint8ClampedArray(A),R={data:C,width:w,height:S,glyphWidth:g,glyphHeight:v,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(g===0||v===0)return R;const{ctx:L,buffer:O,gridInner:V,gridOuter:j}=this;L.clearRect(O,O,g,v),L.fillText(t,O,O+p);const X=L.getImageData(O,O,g,v);j.fill(Vd,0,A),V.fill(0,0,A);for(let ee=0;ee<v;ee++)for(let K=0;K<g;K++){const le=X.data[4*(ee*g+K)+3]/255;if(le===0)continue;const ie=(ee+O)*w+K+O;if(le===1)j[ie]=0,V[ie]=Vd;else{const ue=.5-le;j[ie]=ue>0?ue*ue:0,V[ie]=ue<0?ue*ue:0}}Lb(j,0,0,w,S,w,this.f,this.v,this.z),Lb(V,O,O,g,v,w,this.f,this.v,this.z);for(let ee=0;ee<A;ee++){const K=Math.sqrt(j[ee])-Math.sqrt(V[ee]);C[ee]=Math.round(255-255*(K/this.radius+this.cutoff))}return R}};const Ha=Jr;function Ob(t,e,i,s){const l=[],u=t.imagePrimary,p=u.pixelRatio,g=u.paddedRect.w-2*Ha,v=u.paddedRect.h-2*Ha,w=t.right-t.left,S=t.bottom-t.top,A=u.stretchX||[[0,g]],C=u.stretchY||[[0,v]],R=(we,Fe)=>we+Fe[1]-Fe[0],L=A.reduce(R,0),O=C.reduce(R,0),V=g-L,j=v-O;let X=0,ee=L,K=0,le=O,ie=0,ue=V,pe=0,ve=j;if(u.content&&s){const we=u.content;X=Am(A,0,we[0]),K=Am(C,0,we[1]),ee=Am(A,we[0],we[2]),le=Am(C,we[1],we[3]),ie=we[0]-X,pe=we[1]-K,ue=we[2]-we[0]-ee,ve=we[3]-we[1]-le}const Re=(we,Fe,Oe,ze)=>{const We=Im(we.stretch-X,ee,w,t.left),$e=Cm(we.fixed-ie,ue,we.stretch,L),Xe=Im(Fe.stretch-K,le,S,t.top),Qe=Cm(Fe.fixed-pe,ve,Fe.stretch,O),Ne=Im(Oe.stretch-X,ee,w,t.left),It=Cm(Oe.fixed-ie,ue,Oe.stretch,L),Tt=Im(ze.stretch-K,le,S,t.top),et=Cm(ze.fixed-pe,ve,ze.stretch,O),jt=new ct(We,Xe),zt=new ct(Ne,Xe),Ct=new ct(Ne,Tt),tt=new ct(We,Tt),Ft=new ct($e/p,Qe/p),ti=new ct(It/p,et/p),$t=e*Math.PI/180;if($t){const qi=Math.sin($t),Pi=Math.cos($t),vi=[Pi,-qi,qi,Pi];jt._matMult(vi),zt._matMult(vi),tt._matMult(vi),Ct._matMult(vi)}const si=we.stretch+we.fixed,ii=Oe.stretch+Oe.fixed,di=Fe.stretch+Fe.fixed,Gt=ze.stretch+ze.fixed,Hi=t.imageSecondary;return{tl:jt,tr:zt,bl:tt,br:Ct,texPrimary:{x:u.paddedRect.x+Ha+si,y:u.paddedRect.y+Ha+di,w:ii-si,h:Gt-di},texSecondary:Hi?{x:Hi.paddedRect.x+Ha+si,y:Hi.paddedRect.y+Ha+di,w:ii-si,h:Gt-di}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ft,pixelOffsetBR:ti,minFontScaleX:ue/p/w,minFontScaleY:ve/p/S,isSDF:i}};if(s&&(u.stretchX||u.stretchY)){const we=Fb(A,V,L),Fe=Fb(C,j,O);for(let Oe=0;Oe<we.length-1;Oe++){const ze=we[Oe],We=we[Oe+1];for(let $e=0;$e<Fe.length-1;$e++)l.push(Re(ze,Fe[$e],We,Fe[$e+1]))}}else l.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:v+1}));return l}function Am(t,e,i){let s=0;for(const l of t)s+=Math.max(e,Math.min(i,l[1]))-Math.max(e,Math.min(i,l[0]));return s}function Fb(t,e,i){const s=[{fixed:-Ha,stretch:0}];for(const[l,u]of t){const p=s[s.length-1];s.push({fixed:l-p.stretch,stretch:p.stretch}),s.push({fixed:l-p.stretch,stretch:p.stretch+(u-l)})}return s.push({fixed:e+Ha,stretch:i}),s}function Im(t,e,i,s){return t/e*i+s}function Cm(t,e,i,s){return t-e*i/s}function YA(t,e,i,s){const l=e+t.positionedLines[s].lineOffset;return s===0?i+l/2:i+(l+(e+t.positionedLines[s-1].lineOffset))/2}function KA(t,e=1,i=!1){let s=1/0,l=1/0,u=-1/0,p=-1/0;const g=t[0];for(let R=0;R<g.length;R++){const L=g[R];(!R||L.x<s)&&(s=L.x),(!R||L.y<l)&&(l=L.y),(!R||L.x>u)&&(u=L.x),(!R||L.y>p)&&(p=L.y)}const v=Math.min(u-s,p-l);let w=v/2;const S=new wu([],JA);if(v===0)return new ct(s,l);for(let R=s;R<u;R+=v)for(let L=l;L<p;L+=v)S.push(new nh(R+w,L+w,w,t));let A=function(R){let L=0,O=0,V=0;const j=R[0];for(let X=0,ee=j.length,K=ee-1;X<ee;K=X++){const le=j[X],ie=j[K],ue=le.x*ie.y-ie.x*le.y;O+=(le.x+ie.x)*ue,V+=(le.y+ie.y)*ue,L+=3*ue}return new nh(O/L,V/L,0,R)}(t),C=S.length;for(;S.length;){const R=S.pop();(R.d>A.d||!A.d)&&(A=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,C)),R.max-A.d<=e||(w=R.h/2,S.push(new nh(R.p.x-w,R.p.y-w,w,t)),S.push(new nh(R.p.x+w,R.p.y-w,w,t)),S.push(new nh(R.p.x-w,R.p.y+w,w,t)),S.push(new nh(R.p.x+w,R.p.y+w,w,t)),C+=4)}return i&&(console.log(`num probes: ${C}`),console.log(`best distance: ${A.d}`)),A.p}function JA(t,e){return e.max-t.max}class nh{constructor(e,i,s,l){this.p=new ct(e,i),this.h=s,this.d=function(u,p){let g=!1,v=1/0;for(let w=0;w<p.length;w++){const S=p[w];for(let A=0,C=S.length,R=C-1;A<C;R=A++){const L=S[A],O=S[R];L.y>u.y!=O.y>u.y&&u.x<(O.x-L.x)*(u.y-L.y)/(O.y-L.y)+L.x&&(g=!g),v=Math.min(v,ev(u,L,O))}}return(g?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Ay=Number.POSITIVE_INFINITY,eI=Math.sqrt(2);function Bb(t,[e,i]){let s=0,l=0;if(i===Ay){e<0&&(e=0);const u=e/eI;switch(t){case"top-right":case"top-left":l=u-7;break;case"bottom-right":case"bottom-left":l=7-u;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(t){case"top-right":case"bottom-right":s=-u;break;case"top-left":case"bottom-left":s=u;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":l=i-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-i}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,l]}function Iy(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tI(t,e,i,s,l,u,p,g,v,w,S,A,C,R,L){let O=u.textMaxSize.evaluate(e,{},A);O===void 0&&(O=p);const V=t.layers[0].layout,j=V.get("icon-offset").evaluate(e,{},A),X=Vb(i.horizontal)||i.vertical,ee=C.name==="globe",K=fr,le=p/K,ie=t.tilePixelRatio*O/K,ue=(We=t.overscaling,t.zoom>18&&We>2&&(We>>=1),Math.max(ut/(512*We),1)*V.get("symbol-spacing")),pe=V.get("text-padding")*t.tilePixelRatio,ve=V.get("icon-padding")*t.tilePixelRatio,Re=Mi(V.get("text-max-angle")),we=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Fe=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Oe=V.get("symbol-placement"),ze=ue/2;var We;const $e=V.get("icon-text-fit").evaluate(e,{},A),Xe=V.get("icon-text-fit-padding").evaluate(e,{},A),Qe=$e!=="none";let Ne;t.hasAnyIconTextFit===!1&&Qe&&(t.hasAnyIconTextFit=!0),s&&Qe&&(t.allowVerticalPlacement&&i.vertical&&(Ne=Sb(s,i.vertical,$e,Xe,j,le)),X&&(s=Sb(s,X,$e,Xe,j,le)));const It=(Tt,et,jt)=>{if(et.x<0||et.x>=ut||et.y<0||et.y>=ut)return;let zt=null;if(ee){const{x:Ct,y:tt,z:Ft}=C.projectTilePoint(et.x,et.y,jt);zt={anchor:new sa(Ct,tt,Ft,0,void 0),up:C.upVector(jt,et.x,et.y)}}(function(Ct,tt,Ft,ti,$t,si,ii,di,Gt,Hi,qi,Pi,vi,Di,rn,Ki,yn,pn,vr,En,dn,On,sr,or,en,Or,oa){const Fs=Ct.addToLineVertexArray(tt,ti);let ro,Ja,el,xc,U1,G1,$1,q1=0,W1=0,H1=0,Z1=0,Yy=-1,Ky=-1;const So={};let Q1=Dl("");const vc=Ft?Ft.anchor:tt,Jy=Gt.layout.get("icon-text-fit").evaluate(dn,{},en)!=="none";let e0=0,t0=0;if(Gt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[e0,t0]=Gt.layout.get("text-offset").evaluate(dn,{},en).map(es=>es*fr):(e0=Gt.layout.get("text-radial-offset").evaluate(dn,{},en)*fr,t0=Ay),Ct.allowVerticalPlacement&&$t.vertical){const es=$t.vertical;if(rn)G1=Cy(es),di&&($1=Cy(di));else{const ts=Gt.layout.get("text-rotate").evaluate(dn,{},en)+90;el=Pm(Hi,vc,tt,qi,Pi,vi,es,Di,ts,Ki),di&&(xc=Pm(Hi,vc,tt,qi,Pi,vi,di,pn,ts))}}if(si){const es=Gt.layout.get("icon-rotate").evaluate(dn,{},en),ts=Ob(si,es,sr,Jy),uh=di?Ob(di,es,sr,Jy):void 0;Ja=Pm(Hi,vc,tt,qi,Pi,vi,si,pn,es),q1=4*ts.length;const X1=Ct.iconSizeData;let bc=null;X1.kind==="source"?(bc=[Ks*Gt.layout.get("icon-size").evaluate(dn,{},en)],bc[0]>Za&&gn(`${Ct.layerIds[0]}: Value for "icon-size" is >= ${jd}. Reduce your "icon-size".`)):X1.kind==="composite"&&(bc=[Ks*On.compositeIconSizes[0].evaluate(dn,{},en),Ks*On.compositeIconSizes[1].evaluate(dn,{},en)],(bc[0]>Za||bc[1]>Za)&&gn(`${Ct.layerIds[0]}: Value for "icon-size" is >= ${jd}. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,ts,bc,En,vr,dn,!1,Ft,tt,Fs.lineStartIndex,Fs.lineLength,-1,or,en,Or,oa),Yy=Ct.icon.placedSymbolArray.length-1,uh&&(W1=4*uh.length,Ct.addSymbols(Ct.icon,uh,bc,En,vr,dn,bs.vertical,Ft,tt,Fs.lineStartIndex,Fs.lineLength,-1,or,en,Or,oa),Ky=Ct.icon.placedSymbolArray.length-1)}for(const es in $t.horizontal){const ts=$t.horizontal[es];ro||(Q1=Dl(ts.text),rn?U1=Cy(ts):ro=Pm(Hi,vc,tt,qi,Pi,vi,ts,Di,Gt.layout.get("text-rotate").evaluate(dn,{},en),Ki));const uh=ts.positionedLines.length===1;if(H1+=Nb(Ct,Ft,tt,ts,ii,Gt,rn,dn,Ki,Fs,$t.vertical?bs.horizontal:bs.horizontalOnly,uh?Object.keys($t.horizontal):[es],So,Yy,On,or,en,Or),uh)break}$t.vertical&&(Z1+=Nb(Ct,Ft,tt,$t.vertical,ii,Gt,rn,dn,Ki,Fs,bs.vertical,["vertical"],So,Ky,On,or,en,Or));let tl=-1;const i0=(es,ts)=>es?Math.max(es,ts):ts;tl=i0(U1,tl),tl=i0(G1,tl),tl=i0($1,tl);const xC=tl>-1?1:0;Ct.glyphOffsetArray.length>=65535&&gn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dn.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,dn.sortKey),Ct.symbolInstances.emplaceBack(tt.x,tt.y,vc.x,vc.y,vc.z,So.right>=0?So.right:-1,So.center>=0?So.center:-1,So.left>=0?So.left:-1,So.vertical>=0?So.vertical:-1,Yy,Ky,Q1,ro!==void 0?ro:Ct.collisionBoxArray.length,ro!==void 0?ro+1:Ct.collisionBoxArray.length,el!==void 0?el:Ct.collisionBoxArray.length,el!==void 0?el+1:Ct.collisionBoxArray.length,Ja!==void 0?Ja:Ct.collisionBoxArray.length,Ja!==void 0?Ja+1:Ct.collisionBoxArray.length,xc||Ct.collisionBoxArray.length,xc?xc+1:Ct.collisionBoxArray.length,qi,H1,Z1,q1,W1,xC,0,e0,t0,tl,0,Jy?1:0)})(t,et,zt,Tt,i,s,l,Ne,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,pe,we,v,0,ve,Fe,j,e,u,w,S,A,R,L)};if(Oe==="line")for(const Tt of Db(e.geometry,0,0,ut,ut)){const et=XA(Tt,ue,Re,i.vertical||X,s,K,ie,t.overscaling,ut);for(const jt of et)X&&iI(t,X.text,ze,jt)||It(Tt,jt,A)}else if(Oe==="line-center"){for(const Tt of e.geometry)if(Tt.length>1){const et=QA(Tt,Re,i.vertical||X,s,K,ie);et&&It(Tt,et,A)}}else if(e.type==="Polygon")for(const Tt of fy(e.geometry,0)){const et=KA(Tt,16);It(Tt[0],new sa(et.x,et.y,0,0,void 0),A)}else if(e.type==="LineString")for(const Tt of e.geometry)It(Tt,new sa(Tt[0].x,Tt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const Tt of e.geometry)for(const et of Tt)It([et],new sa(et.x,et.y,0,0,void 0),A)}const jd=255,Za=jd*Ks;function Nb(t,e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V,j){const X=function(le,ie,ue,pe,ve,Re,we,Fe){const Oe=[];if(ie.positionedLines.length===0)return Oe;const ze=pe.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,We=function(It){const Tt=It[0],et=It[1],jt=Tt*et;return jt>0?[Tt,-et]:jt<0?[-Tt,et]:Tt===0?[et,Tt]:[et,-Tt]}(ue);let $e=Math.abs(ie.top-ie.bottom);for(const It of ie.positionedLines)$e-=It.lineOffset;const Xe=ie.positionedLines.length,Qe=$e/Xe;let Ne=ie.top-ue[1];for(let It=0;It<Xe;++It){const Tt=ie.positionedLines[It];Ne=YA(ie,Qe,Ne,It);for(const et of Tt.positionedGlyphs){if(!et.rect)continue;const jt=et.rect||{};let zt=xb+1,Ct=!0,tt=1,Ft=0;if(et.imageName){const En=we[et.imageName];if(!En)continue;if(En.sdf){gn("SDF images are not supported in formatted text and will be ignored.");continue}Ct=!1,tt=En.pixelRatio,zt=Jr/tt}const ti=(ve||Fe)&&et.vertical,$t=et.metrics.advance*et.scale/2,si=et.metrics,ii=et.rect;if(ii===null)continue;Fe&&ie.verticalizable&&(Ft=et.imageName?$t-et.metrics.width*et.scale/2:0);const di=ve?[et.x+$t,et.y]:[0,0];let Gt=[0,0],Hi=[0,0],qi=!1;ve||(ti?(Hi=[et.x+$t+We[0],et.y+We[1]-Ft],qi=!0):Gt=[et.x+$t+ue[0],et.y+ue[1]-Ft]);const Pi=ii.w*et.scale/(tt*(et.localGlyph?Js:1)),vi=ii.h*et.scale/(tt*(et.localGlyph?Js:1));let Di,rn,Ki,yn;if(ti){const En=et.y-Ne,dn=new ct(-$t,$t-En),On=-Math.PI/2,sr=new ct(...Hi);Di=new ct(-$t+Gt[0],Gt[1]),Di._rotateAround(On,dn)._add(sr),Di.x+=-En+$t,Di.y-=(si.left-zt)*et.scale;const or=et.imageName?si.advance*et.scale:fr*et.scale,en=String.fromCodePoint(et.glyph);DA(en)?Di.x+=(1-zt)*et.scale:RA(en)?Di.x+=or-si.height*et.scale+(-zt-1)*et.scale:Di.x+=et.imageName||si.width+2*zt===ii.w&&si.height+2*zt===ii.h?(or-vi)/2:(or-(si.height+2*zt)*et.scale)/2,rn=new ct(Di.x,Di.y-Pi),Ki=new ct(Di.x+vi,Di.y),yn=new ct(Di.x+vi,Di.y-Pi)}else{const En=(si.left-zt)*et.scale-$t+Gt[0],dn=(-si.top-zt)*et.scale+Gt[1],On=En+Pi,sr=dn+vi;Di=new ct(En,dn),rn=new ct(On,dn),Ki=new ct(En,sr),yn=new ct(On,sr)}if(ze){let En;En=ve?new ct(0,0):qi?new ct(We[0],We[1]):new ct(ue[0],ue[1]),Di._rotateAround(ze,En),rn._rotateAround(ze,En),Ki._rotateAround(ze,En),yn._rotateAround(ze,En)}const pn=new ct(0,0),vr=new ct(0,0);Oe.push({tl:Di,tr:rn,bl:Ki,br:yn,texPrimary:jt,texSecondary:void 0,writingMode:ie.writingMode,glyphOffset:di,sectionIndex:et.sectionIndex,isSDF:Ct,pixelOffsetTL:pn,pixelOffsetBR:vr,minFontScaleX:0,minFontScaleY:0})}}return Oe}(0,s,v,u,p,g,l,t.allowVerticalPlacement),ee=t.textSizeData;let K=null;ee.kind==="source"?(K=[Ks*u.layout.get("text-size").evaluate(g,{},V)],K[0]>Za&&gn(`${t.layerIds[0]}: Value for "text-size" is >= ${jd}. Reduce your "text-size".`)):ee.kind==="composite"&&(K=[Ks*L.compositeTextSizes[0].evaluate(g,{},V),Ks*L.compositeTextSizes[1].evaluate(g,{},V)],(K[0]>Za||K[1]>Za)&&gn(`${t.layerIds[0]}: Value for "text-size" is >= ${jd}. Reduce your "text-size".`)),t.addSymbols(t.text,X,K,v,p,g,S,e,i,w.lineStartIndex,w.lineLength,R,O,V,j,!1);for(const le of A)C[le]=t.text.placedSymbolArray.length-1;return 4*X.length}function Vb(t){for(const e in t)return t[e];return null}function Pm(t,e,i,s,l,u,p,g,v,w){let S=p.top,A=p.bottom,C=p.left,R=p.right;const L=p.collisionPadding;if(L&&(C-=L[0],S-=L[1],R+=L[2],A+=L[3]),v){const O=new ct(C,S),V=new ct(R,S),j=new ct(C,A),X=new ct(R,A),ee=Mi(v);let K=new ct(0,0);w&&(K=new ct(w[0],w[1])),O._rotateAround(ee,K),V._rotateAround(ee,K),j._rotateAround(ee,K),X._rotateAround(ee,K),C=Math.min(O.x,V.x,j.x,X.x),R=Math.max(O.x,V.x,j.x,X.x),S=Math.min(O.y,V.y,j.y,X.y),A=Math.max(O.y,V.y,j.y,X.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,C,S,R,A,g,s,l,u),t.length-1}function Cy(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function iI(t,e,i,s){const l=t.compareText;if(e in l){const u=l[e];for(let p=u.length-1;p>=0;p--)if(s.dist(u[p])<i)return!0}else l[e]=[];return l[e].push(s),!1}function jb(t,e){const i=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),u=Math.sin(i)*l/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),p=Math.sin(t._pitch)*u+l;return Math.min(1.01*p,l*(1/t._horizonShift))}function Ud(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),s=t.x*i,l=(t.x+1)*i,u=t.y*i,p=(t.y+1)*i,g=Kr(s),v=Kr(l),w=dr(u),S=dr(p),A=e.project(g,w),C=e.project(v,w),R=e.project(v,S),L=e.project(g,S);let O=Math.min(A.x,C.x,R.x,L.x),V=Math.min(A.y,C.y,R.y,L.y),j=Math.max(A.x,C.x,R.x,L.x),X=Math.max(A.y,C.y,R.y,L.y);const ee=i/16;function K(ie,ue,pe,ve,Re,we){const Fe=(pe+Re)/2,Oe=(ve+we)/2,ze=e.project(Kr(Fe),dr(Oe)),We=Math.max(0,O-ze.x,V-ze.y,ze.x-j,ze.y-X);O=Math.min(O,ze.x),j=Math.max(j,ze.x),V=Math.min(V,ze.y),X=Math.max(X,ze.y),We>ee&&(K(ie,ze,pe,ve,Fe,Oe),K(ze,ue,Fe,Oe,Re,we))}K(A,C,s,u,l,u),K(C,R,l,u,l,p),K(R,L,l,p,s,p),K(L,A,s,p,s,u),O-=ee,V-=ee,j+=ee,X+=ee;const le=1/Math.max(j-O,X-V);return{scale:le,x:O*le,y:V*le,x2:j*le,y2:X*le,projection:e}}function Ub(t,{x:e,y:i},s=0){return new ct(((e-s)*t.scale-t.x)*ut,(i*t.scale-t.y)*ut)}const nI=r.a9.identity(new Float32Array(16));class Qa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Ai(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return kr(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return jb(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,l){const u=e.horizonLineFromTop(!1),p=new ct(i,Math.max(u,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}pointCoordinate3D(e,i,s){const l=new ct(i,s);if(e.elevation)return e.elevation.pointCoordinate(l);{const u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return nI}createTileMatrix(e,i,s){let l,u,p;const g=s.canonical,v=r.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Ud(g,this);l=1,u=w.x+s.wrap*w.scale,p=w.y,r.a9.scale(v,v,[l/w.scale,l/w.scale,e.pixelsPerMeter/i])}else l=i/e.zoomScale(g.z),u=(g.x+Math.pow(2,g.z)*s.wrap)*l,p=g.y*l;return r.a9.translate(v,v,[u,p,0]),r.a9.scale(v,v,[l/ut,l/ut,1]),v}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class rI extends Qa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Mi(i));this.n=(l+Math.sin(Mi(s)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:l,r0:u}=this,p=Mi(e-this.center[0]),g=Mi(i),v=Math.sqrt(l-2*s*Math.sin(g))/s;return{x:v*Math.sin(p*s),y:v*Math.cos(p*s)-u,z:0}}unproject(e,i){const{n:s,c:l,r0:u}=this,p=u+i;let g=Math.atan2(e,Math.abs(p))*Math.sign(p);p*s<0&&(g-=Math.PI*Math.sign(e)*Math.sign(p));const v=Mi(this.center[0])*s;g=Gs(g,-Math.PI-v,Math.PI-v);const w=mi(Er(g/s)+this.center[0],-180,180),S=Math.asin(mi((l-(e*e+p*p)*s*s)/(2*s),-1,1)),A=mi(Er(S),-Pn,Pn);return new Ai(w,A)}}const Gd=1.340264,$d=-.081106,qd=893e-6,Wd=.003796,Dm=Math.sqrt(3)/2;class sI extends Qa{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Dm*Math.sin(i)),l=s*s,u=l*l*l;return{x:.5*(e*Math.cos(s)/(Dm*(Gd+3*$d*l+u*(7*qd+9*Wd*l)))/Math.PI+.5),y:1-.5*(s*(Gd+$d*l+u*(qd+Wd*l))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,l=s*s,u=l*l*l;for(let S,A,C,R=0;R<12&&(A=s*(Gd+$d*l+u*(qd+Wd*l))-i,C=Gd+3*$d*l+u*(7*qd+9*Wd*l),S=A/C,s=mi(s-S,-Math.PI/3,Math.PI/3),l=s*s,u=l*l*l,!(Math.abs(S)<1e-12));++R);const p=Dm*e*(Gd+3*$d*l+u*(7*qd+9*Wd*l))/Math.cos(s),g=Math.asin(Math.sin(s)/Dm),v=mi(180*p/Math.PI,-180,180),w=mi(180*g/Math.PI,-Pn,Pn);return new Ai(v,w)}}class oI extends Qa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),l=mi(360*(.5-i),-Pn,Pn);return new Ai(s,l)}}const rh=Math.PI/2;function Rm(t){return Math.tan((rh+t)/2)}class aI extends Qa{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let l=Mi(i),u=Mi(s);this.southernCenter=l+u<0,this.southernCenter&&(l=-l,u=-u);const p=Math.cos(l),g=Rm(l);this.n=l===u?Math.sin(l):Math.log(p/Math.cos(u))/Math.log(Rm(u)/g),this.f=p*Math.pow(Rm(l),this.n)/this.n}project(e,i){i=Mi(i),this.southernCenter&&(i=-i),e=Mi(e-this.center[0]);const s=1e-6,{n:l,f:u}=this;u>0?i<-rh+s&&(i=-rh+s):i>rh-s&&(i=rh-s);const p=u/Math.pow(Rm(i),l);let g=p*Math.sin(l*e),v=u-p*Math.cos(l*e);return g=.5*(g/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:g,y:this.southernCenter?v:1-v,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:l}=this,u=l-i,p=Math.sign(u),g=Math.sign(s)*Math.sqrt(e*e+u*u);let v=Math.atan2(e,Math.abs(u))*p;u*s<0&&(v-=Math.PI*Math.sign(e)*p);const w=mi(Er(v/s)+this.center[0],-180,180),S=mi(Er(2*Math.atan(Math.pow(l/g,1/s))-rh),-Pn,Pn);return new Ai(w,this.southernCenter?-S:S)}}class Gb extends Qa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ja(e),y:ta(i),z:0}}unproject(e,i){const s=Kr(e),l=dr(i);return new Ai(s,l)}}const $b=Mi(Pn);class lI extends Qa{project(e,i){const s=(i=Mi(i))*i,l=s*s;return{x:.5*((e=Mi(e))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,l=25,u=0,p=s*s;do{p=s*s;const w=p*p;u=(s*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-i)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),s=mi(s-u,-$b,$b)}while(Math.abs(u)>1e-6&&--l>0);p=s*s;const g=mi(Er(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=Er(s);return new Ai(g,v)}}const qb=Mi(Pn);class cI extends Qa{project(e,i){i=Mi(i),e=Mi(e);const s=Math.cos(i),l=2/Math.PI,u=Math.acos(s*Math.cos(e/2)),p=Math.sin(u)/u,g=.5*(e*l+2*s*Math.sin(e/2)/p)||0,v=.5*(i+Math.sin(i)/p)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,l=i=(2*(1-i)-1)*Math.PI,u=25;const p=1e-6;let g=0,v=0;do{const w=Math.cos(l),S=Math.sin(l),A=2*S*w,C=S*S,R=w*w,L=Math.cos(s/2),O=Math.sin(s/2),V=2*L*O,j=O*O,X=1-R*L*L,ee=X?1/X:0,K=X?Math.acos(w*L)*Math.sqrt(1/X):0,le=.5*(2*K*w*O+2*s/Math.PI)-e,ie=.5*(K*S+l)-i,ue=.5*ee*(R*j+K*w*L*C)+1/Math.PI,pe=ee*(V*A/4-K*S*O),ve=.125*ee*(A*O-K*S*R*V),Re=.5*ee*(C*L+K*j*w)+.5,we=pe*ve-Re*ue;g=(ie*pe-le*Re)/we,v=(le*ve-ie*ue)/we,s=mi(s-g,-Math.PI,Math.PI),l=mi(l-v,-qb,qb)}while((Math.abs(g)>p||Math.abs(v)>p)&&--u>0);return new Ai(Er(s),Er(l))}}class Wb extends Qa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Mi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:l}=this;return{x:Mi(e)*l*s+.5,y:-Math.sin(Mi(i))/l*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:l}=this,u=-(i-.5)/s,p=mi(Er((e-.5)/s)/l,-180,180),g=Math.asin(mi(u*l,-1,1)),v=mi(Er(g),-Pn,Pn);return new Ai(p,v)}}class uI extends Gb{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const l=Pd(e,i,s),u=um(Mo(s));return r.Q.transformMat4(l,l,u),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,i){const s=hc(i.lat,i.lng),l=r.Q.normalize([],s),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,p=kr(1,0)*ut*u;r.Q.scaleAndAdd(s,s,l,p);const g=r.a9.identity(new Float64Array(16));return r.a9.multiply(g,e.pixelMatrix,e.globeMatrix),r.Q.transformMat4(s,s,g),new ct(s[0],s[1])}pixelsPerMeter(e,i){return kr(1,0)*i}pixelSpaceConversion(e,i,s){const l=kr(1,e)*i,u=ai(kr(1,45)*i,l,s);return this.pixelsPerMeter(e,i)/u}createTileMatrix(e,i,s){const l=sy(Mo(s.canonical));return r.a9.multiply(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,i){const{center:s}=e,l=um(Mo(i));return r.a9.rotateY(l,l,Mi(s.lng)),r.a9.rotateX(l,l,Mi(s.lat)),r.a9.scale(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,i,s,l){return cv(e,i,s,!0)||new xr(0,0)}pointCoordinate3D(e,i,s){const l=this.pointCoordinate(e,i,s,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,i){return!cv(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(l,u){const p=l.cameraToCenterDistance,g=l._centerAltitude*u,v=l._camera,w=l._camera.forward(),S=r.Q.add([],r.Q.scale([],w,-p),[0,0,g]),A=l.worldSize/(2*Math.PI),C=[0,0,-A],R=l.width/l.height,L=Math.tan(l.fovAboveCenter),O=r.Q.scale([],v.up(),L),V=r.Q.scale([],v.right(),L*R),j=r.Q.normalize([],r.Q.add([],r.Q.add([],w,O),V)),X=[];let ee;if(new ey(S,j).closestPointOnSphere(C,A,X)){const K=r.Q.add([],X,C),le=r.Q.sub([],K,S);ee=Math.cos(l.fovAboveCenter)*r.Q.length(le)}else{const K=r.Q.sub([],S,C),le=r.Q.sub([],C,S);r.Q.normalize(le,le);const ie=r.Q.length(K)-A;ee=Math.sqrt(ie*(ie+2*A));const ue=Math.acos(ee/(A+ie))-Math.acos(r.Q.dot(w,le));ee*=Math.cos(ue)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Ga(e.zoom);if(s>0){const l=jb(e,kr(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ai(i,l+u*(1-Math.cos(p)),Math.pow(s,10))}return i}upVector(e,i,s){return Pd(i,s,e,1)}upVectorScale(e){return{metersToTile:am(cm(Mo(e)))}}}function Hb(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Gb(t);case"equirectangular":return new oI(t);case"naturalEarth":return new lI(t);case"equalEarth":return new sI(t);case"winkelTripel":return new cI(t);case"albers":return i?new Wb(t):new rI(t);case"lambertConformalConic":return i?new Wb(t):new aI(t);case"globe":return new uI(t)}throw new Error(`Invalid projection name: ${t.name}`)}const hI=gm.types,dI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zm(t,e,i,s,l,u,p,g,v,w,S,A,C){const R=g?Math.min(Za,Math.round(g[0])):0,L=g?Math.min(Za,Math.round(g[1])):0;t.emplaceBack(e,i,Math.round(32*s),Math.round(32*l),u,p,(R<<1)+(v?1:0),L,16*w,16*S,256*A,256*C)}function Lm(t,e,i){t.emplaceBack(e,i)}function km(t,e,i,s,l,u,p){t.emplaceBack(e,i,s,l,u,p)}function Om(t,e,i,s,l){t.emplaceBack(e,i,s,l),t.emplaceBack(e,i,s,l),t.emplaceBack(e,i,s,l),t.emplaceBack(e,i,s,l)}function fI(t){for(const e of t.sections)if(D(e.text))return!0;return!1}class Py{constructor(e){this.layoutVertexArray=new zs,this.indexArray=new Hn,this.programConfigurations=e,this.segments=new Cn,this.dynamicLayoutVertexArray=new Wn,this.opacityVertexArray=new To,this.placedSymbolArray=new Rx,this.iconTransitioningVertexArray=new Yr,this.globeExtVertexArray=new Ls,this.zOffsetVertexArray=new Md}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,s,l,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,TA.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,dI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,SA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,wA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,MA.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}St(Py,"SymbolBuffers");class Dy{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Cn,this.collisionVertexArray=new Xs,this.collisionVertexArrayExt=new Wn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,EA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,AA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}St(Dy,"CollisionBuffers");class Fm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.a9.identity([]),this.placementViewportMatrix=r.a9.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vy(this.zoom,i["text-size"]),this.iconSizeData=vy(this.zoom,i["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),u=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(p=>bs[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate")}createArrays(){this.text=new Py(new Na(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Py(new Na(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new kx,this.lineVertexArray=new Ox,this.symbolInstances=new Lx}calculateGlyphDependencies(e,i,s,l,u){for(let p=0;p<e.length;p++){const g=e.codePointAt(p);if(g===void 0)break;if(i[g]=!0,l&&u&&g<=65535){const v=Bd[e.charAt(p)];v&&(i[v.charCodeAt(0)]=!0)}}}populate(e,i,s,l){const u=this.layers[0],p=u.layout,g=this.projection.name==="globe",v=p.get("text-font"),w=p.get("text-field"),S=p.get("icon-image"),A=(w.value.kind!=="constant"||w.value.value instanceof lr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),C=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,R=p.get("symbol-sort-key");if(this.features=[],!A&&!C)return;const L=i.iconDependencies,O=i.glyphDependencies,V=i.availableImages,j=new H(this.zoom);for(const{feature:X,id:ee,index:K,sourceLayerIndex:le}of e){const ie=u._featureFilter.needGeometry,ue=Ua(X,ie);if(!u._featureFilter.filter(j,ue,s))continue;if(ie||(ue.geometry=ia(X,s,l)),g&&X.type!==1&&s.z<=5){const we=ue.geometry,Fe=.98078528056,Oe=(ze,We)=>{const $e=Pd(ze.x,ze.y,s,1),Xe=Pd(We.x,We.y,s,1);return r.Q.dot($e,Xe)<Fe};for(let ze=0;ze<we.length;ze++)we[ze]=tE(we[ze],Oe)}let pe,ve;if(A){const we=u.getValueAndResolveTokens("text-field",ue,s,V),Fe=lr.factory(we);fI(Fe)&&(this.hasRTLText=!0),(!this.hasRTLText||re()==="unavailable"||this.hasRTLText&&oe.isParsed())&&(pe=PA(Fe,u,ue))}if(C){const we=u.getValueAndResolveTokens("icon-image",ue,s,V);ve=we instanceof Ur?we:Ur.fromString(we)}if(!pe&&!ve)continue;const Re=this.sortFeaturesByKey?R.evaluate(ue,{},s):void 0;if(this.features.push({id:ee,text:pe,icon:ve,index:K,sourceLayerIndex:le,geometry:ue.geometry,properties:X.properties,type:hI[X.type],sortKey:Re}),ve&&(L[ve.namePrimary]=!0,ve.nameSecondary&&(L[ve.nameSecondary]=!0)),pe){const we=v.evaluate(ue,{},s).join(","),Fe=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bs.vertical)>=0;for(const Oe of pe.sections)if(Oe.image)L[Oe.image.namePrimary]=!0;else{const ze=o(pe.toString()),We=Oe.fontStack||we,$e=O[We]=O[We]||{};this.calculateGlyphDependencies(Oe.text,$e,Fe,this.allowVerticalPlacement,ze)}}}p.get("symbol-placement")==="line"&&(this.features=function(X){const ee={},K={},le=[];let ie=0;function ue(we){le.push(X[we]),ie++}function pe(we,Fe,Oe){const ze=K[we];return delete K[we],K[Fe]=ze,le[ze].geometry[0].pop(),le[ze].geometry[0]=le[ze].geometry[0].concat(Oe[0]),ze}function ve(we,Fe,Oe){const ze=ee[Fe];return delete ee[Fe],ee[we]=ze,le[ze].geometry[0].shift(),le[ze].geometry[0]=Oe[0].concat(le[ze].geometry[0]),ze}function Re(we,Fe,Oe){const ze=Oe?Fe[0][Fe[0].length-1]:Fe[0][0];return`${we}:${ze.x}:${ze.y}`}for(let we=0;we<X.length;we++){const Fe=X[we],Oe=Fe.geometry,ze=Fe.text?Fe.text.toString():null;if(!ze){ue(we);continue}const We=Re(ze,Oe),$e=Re(ze,Oe,!0);if(We in K&&$e in ee&&K[We]!==ee[$e]){const Xe=ve(We,$e,Oe),Qe=pe(We,$e,le[Xe].geometry);delete ee[We],delete K[$e],K[Re(ze,le[Qe].geometry,!0)]=Qe,le[Xe].geometry=null}else We in K?pe(We,$e,Oe):$e in ee?ve(We,$e,Oe):(ue(we),ee[We]=ie-1,K[$e]=ie-1)}return le.filter(we=>we.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,ee)=>X.sortKey-ee.sortKey)}update(e,i,s,l,u){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const g=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,g,s,l,u),this.icon.programConfigurations.updatePaintArrays(e,i,g,s,l,u)}updateZOffset(){const e=(u,p,g)=>{s+=p,s>u.length&&u.resize(s);for(let v=-p;v<0;v++)u.emplace(v+s,g)},i=(u,p,g)=>{l+=p,l>u.length&&u.resize(l);for(let v=-p;v<0;v++)u.emplace(v+l,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,l=0;for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:v,numIconVertices:w}=p,S=p.zOffset,A=w>0;if((g>0||v>0)&&(e(this.text.zOffsetVertexArray,g,S),e(this.text.zOffsetVertexArray,v,S)),A){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:R}=p;C>=0&&i(this.icon.zOffsetVertexArray,w,S),R>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,S)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Hb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:u}of i)this.lineVertexArray.emplaceBack(l,u);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,l,u,p,g,v,w,S,A,C,R,L,O,V){const j=e.indexArray,X=e.layoutVertexArray,ee=e.globeExtVertexArray,K=e.segments.prepareSegment(4*i.length,X,j,this.canOverlap?p.sortKey:void 0),le=this.glyphOffsetArray.length,ie=K.vertexLength,ue=this.allowVerticalPlacement&&g===bs.vertical?Math.PI/2:0,pe=p.text&&p.text.sections;for(let Re=0;Re<i.length;Re++){const{tl:we,tr:Fe,bl:Oe,br:ze,texPrimary:We,texSecondary:$e,pixelOffsetTL:Xe,pixelOffsetBR:Qe,minFontScaleX:Ne,minFontScaleY:It,glyphOffset:Tt,isSDF:et,sectionIndex:jt}=i[Re],zt=K.vertexLength,Ct=Tt[1];if(zm(X,w.x,w.y,we.x,Ct+we.y,We.x,We.y,s,et,Xe.x,Xe.y,Ne,It),zm(X,w.x,w.y,Fe.x,Ct+Fe.y,We.x+We.w,We.y,s,et,Qe.x,Xe.y,Ne,It),zm(X,w.x,w.y,Oe.x,Ct+Oe.y,We.x,We.y+We.h,s,et,Xe.x,Qe.y,Ne,It),zm(X,w.x,w.y,ze.x,Ct+ze.y,We.x+We.w,We.y+We.h,s,et,Qe.x,Qe.y,Ne,It),v){const{x:tt,y:Ft,z:ti}=v.anchor,[$t,si,ii]=v.up;km(ee,tt,Ft,ti,$t,si,ii),km(ee,tt,Ft,ti,$t,si,ii),km(ee,tt,Ft,ti,$t,si,ii),km(ee,tt,Ft,ti,$t,si,ii),Om(e.dynamicLayoutVertexArray,tt,Ft,ti,ue)}else Om(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ue);if(V){const tt=$e||We;Lm(e.iconTransitioningVertexArray,tt.x,tt.y),Lm(e.iconTransitioningVertexArray,tt.x+tt.w,tt.y),Lm(e.iconTransitioningVertexArray,tt.x,tt.y+tt.h),Lm(e.iconTransitioningVertexArray,tt.x+tt.w,tt.y+tt.h)}j.emplaceBack(zt,zt+1,zt+2),j.emplaceBack(zt+1,zt+2,zt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tt[0]),Re!==i.length-1&&jt===i[Re+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,p,p.index,{},R,L,O,pe&&pe[jt])}const ve=v?v.anchor:w;e.placedSymbolArray.emplaceBack(ve.x,ve.y,ve.z,w.x,w.y,le,this.glyphOffsetArray.length-le,ie,S,A,w.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],g,0,!1,0,C,0)}_commitLayoutVertex(e,i,s,l,u,p,g){e.emplaceBack(i,s,l,u,p,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,s,l,u,p,g){const v=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=v.vertexLength,S=g.tileAnchorX,A=g.tileAnchorY;for(let R=0;R<4;R++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(s.layoutVertexArray,l,u,p,S,A,new ct(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,u,p,S,A,new ct(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,u,p,S,A,new ct(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,l,u,p,S,A,new ct(e.x1,e.y2)),v.vertexLength+=4;const C=s.indexArray;C.emplaceBack(w,w+1),C.emplaceBack(w+1,w+2),C.emplaceBack(w+2,w+3),C.emplaceBack(w+3,w),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,l,u,p){for(let g=l;g<u;g++){const v=s.get(g),w=this.getSymbolInstanceTextSize(e,p,i,g);this._addCollisionDebugVertices(v,w,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,s,l,u,p){for(let g=l;g<u;g++){const v=s.get(g),w=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(v,w,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dy(Oa,fb.members,Yr),this.iconCollisionBox=new Dy(Oa,fb.members,Yr);const s=Yu(this.iconSizeData,e),l=Yu(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(s,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(s,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,i,s,l){const u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:l),p=Tm(this.textSizeData,e,u)/fr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,s){const l=this.icon.placedSymbolArray.get(s),u=Tm(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,i,s,l){e.emplaceBack(i,-s,-s,l),e.emplaceBack(i,s,-s,l),e.emplaceBack(i,s,s,l),e.emplaceBack(i,-s,s,l)}_updateTextDebugCollisionBoxes(e,i,s,l,u,p){for(let g=l;g<u;g++){const v=s.get(g),w=this.getSymbolInstanceTextSize(e,p,i,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,v.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,l,u,p){for(let g=l;g<u;g++){const v=s.get(g),w=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,v.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Yu(this.iconSizeData,e),l=Yu(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(s,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(s,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,l,u,p,g,v,w){const S={};if(i<s){const{x1:A,y1:C,x2:R,y2:L,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:ee,tileAnchorY:K,featureIndex:le}=e.get(i);S.textBox={x1:A,y1:C,x2:R,y2:L,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:ee,tileAnchorY:K},S.textFeatureIndex=le}if(l<u){const{x1:A,y1:C,x2:R,y2:L,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:ee,tileAnchorY:K,featureIndex:le}=e.get(l);S.verticalTextBox={x1:A,y1:C,x2:R,y2:L,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:ee,tileAnchorY:K},S.verticalTextFeatureIndex=le}if(p<g){const{x1:A,y1:C,x2:R,y2:L,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:ee,tileAnchorY:K,featureIndex:le}=e.get(p);S.iconBox={x1:A,y1:C,x2:R,y2:L,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:ee,tileAnchorY:K},S.iconFeatureIndex=le}if(v<w){const{x1:A,y1:C,x2:R,y2:L,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:ee,tileAnchorY:K,featureIndex:le}=e.get(v);S.verticalIconBox={x1:A,y1:C,x2:R,y2:L,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:ee,tileAnchorY:K},S.verticalIconFeatureIndex=le}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),l=s.vertexStartIndex+4*s.numGlyphs;for(let u=s.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),l=[],u=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);const v=this.symbolInstances.get(g);l.push(0|Math.round(i*v.tileAnchorX+s*v.tileAnchorY)),u.push(v.featureIndex)}return p.sort((g,v)=>l[g]-l[v]||u[v]-u[g]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:w}=s;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&p!==l&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}St(Fm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Fm.addDynamicAttributes=Om;const pI=new ye({"symbol-placement":new me(se.layout_symbol["symbol-placement"]),"symbol-spacing":new me(se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new me(se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new be(se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new me(se.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new me(se.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new me(se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new me(se.layout_symbol["icon-ignore-placement"]),"icon-optional":new me(se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new me(se.layout_symbol["icon-rotation-alignment"]),"icon-size":new be(se.layout_symbol["icon-size"]),"icon-text-fit":new be(se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new be(se.layout_symbol["icon-text-fit-padding"]),"icon-image":new be(se.layout_symbol["icon-image"]),"icon-rotate":new be(se.layout_symbol["icon-rotate"]),"icon-padding":new me(se.layout_symbol["icon-padding"]),"icon-keep-upright":new me(se.layout_symbol["icon-keep-upright"]),"icon-offset":new be(se.layout_symbol["icon-offset"]),"icon-anchor":new be(se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new me(se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new me(se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new me(se.layout_symbol["text-rotation-alignment"]),"text-field":new be(se.layout_symbol["text-field"]),"text-font":new be(se.layout_symbol["text-font"]),"text-size":new be(se.layout_symbol["text-size"]),"text-max-width":new be(se.layout_symbol["text-max-width"]),"text-line-height":new be(se.layout_symbol["text-line-height"]),"text-letter-spacing":new be(se.layout_symbol["text-letter-spacing"]),"text-justify":new be(se.layout_symbol["text-justify"]),"text-radial-offset":new be(se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new me(se.layout_symbol["text-variable-anchor"]),"text-anchor":new be(se.layout_symbol["text-anchor"]),"text-max-angle":new me(se.layout_symbol["text-max-angle"]),"text-writing-mode":new me(se.layout_symbol["text-writing-mode"]),"text-rotate":new be(se.layout_symbol["text-rotate"]),"text-padding":new me(se.layout_symbol["text-padding"]),"text-keep-upright":new me(se.layout_symbol["text-keep-upright"]),"text-transform":new be(se.layout_symbol["text-transform"]),"text-offset":new be(se.layout_symbol["text-offset"]),"text-allow-overlap":new me(se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new me(se.layout_symbol["text-ignore-placement"]),"text-optional":new me(se.layout_symbol["text-optional"]),visibility:new me(se.layout_symbol.visibility)});var Ry={paint:new ye({"icon-opacity":new be(se.paint_symbol["icon-opacity"]),"icon-emissive-strength":new be(se.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new be(se.paint_symbol["text-emissive-strength"]),"icon-color":new be(se.paint_symbol["icon-color"]),"icon-halo-color":new be(se.paint_symbol["icon-halo-color"]),"icon-halo-width":new be(se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new be(se.paint_symbol["icon-halo-blur"]),"icon-translate":new me(se.paint_symbol["icon-translate"]),"icon-translate-anchor":new me(se.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new be(se.paint_symbol["icon-image-cross-fade"]),"text-opacity":new be(se.paint_symbol["text-opacity"]),"text-color":new be(se.paint_symbol["text-color"],{runtimeType:jr,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new be(se.paint_symbol["text-halo-color"]),"text-halo-width":new be(se.paint_symbol["text-halo-width"]),"text-halo-blur":new be(se.paint_symbol["text-halo-blur"]),"text-translate":new me(se.paint_symbol["text-translate"]),"text-translate-anchor":new me(se.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new me(se.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new me(se.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new me(se.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new me(se.paint_symbol["icon-color-brightness-max"])}),layout:pI};class Zb{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ui,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}St(Zb,"FormatSectionOverride",{omit:["defaultValue"]});class Bm extends oi{constructor(e,i,s){super(e,Ry,i,s),this._colorAdjustmentMatrix=r.a9.identity([])}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const u of s)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,l){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===l||(this._colorAdjustmentMatrix=function(u,p,g,v){u=cp(u),p=fs(p);const w=r.a9.create(),S=u/3,A=1-2*S,C=[A,S,S,0,S,A,S,0,S,S,A,0,0,0,0,1],R=.5-.5*p,L=v-g;return r.a9.multiply(w,[L,0,0,0,0,L,0,0,0,0,L,0,g,g,g,1],[p,0,0,0,0,p,0,0,0,0,p,0,R,R,R,1]),r.a9.multiply(w,w,C),w}(e,i,s,l),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,l){const u=this.layout.get(e).evaluate(i,{},s,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Bu(p.value)||!u?u:function(g,v){return v.replace(/{([^{}]+)}/g,(w,S)=>S in g?String(g[S]):"")}(i.properties,u)}createBucket(e){return new Fm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ry.paint.overridableProperties){if(!Bm.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new Zb(i),l=new Fu(s,i.property.specification,this.scope,this.options);let u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new tc("source",l):new ic("composite",l,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Te(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Bm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),l=Ry.paint.properties[i];let u=!1;const p=g=>{for(const v of g)if(l.overrides&&l.overrides.hasOverride(v))return void(u=!0)};if(s.value.kind==="constant"&&s.value.value instanceof lr)p(s.value.value.sections);else if(s.value.kind==="source"){const g=w=>{u||(w instanceof Ps&&Ln(w.value)===wa?p(w.value.sections):w instanceof Nl?p(w.sections):w.eachChild(g))},v=s.value;v._styleExpression&&g(v._styleExpression.expression)}return u}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,s=[];return e&&s.push("symbolIcon"),i&&s.push("symbolSDF"),s}getDefaultProgramParams(e,i){return{config:new uc(this,i),overrideFog:!1}}}const mI=new ye({visibility:new me(se.layout_background.visibility)});var _I={paint:new ye({"background-color":new me(se.paint_background["background-color"]),"background-pattern":new me(se.paint_background["background-pattern"]),"background-opacity":new me(se.paint_background["background-opacity"]),"background-emissive-strength":new me(se.paint_background["background-emissive-strength"])}),layout:mI};const gI=new ye({visibility:new me(se.layout_raster.visibility)});var yI={paint:new ye({"raster-opacity":new me(se.paint_raster["raster-opacity"]),"raster-color":new Ze(se.paint_raster["raster-color"]),"raster-color-mix":new me(se.paint_raster["raster-color-mix"]),"raster-color-range":new me(se.paint_raster["raster-color-range"]),"raster-hue-rotate":new me(se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new me(se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new me(se.paint_raster["raster-brightness-max"]),"raster-saturation":new me(se.paint_raster["raster-saturation"]),"raster-contrast":new me(se.paint_raster["raster-contrast"]),"raster-resampling":new me(se.paint_raster["raster-resampling"]),"raster-fade-duration":new me(se.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new me(se.paint_raster["raster-emissive-strength"]),"raster-array-band":new me(se.paint_raster["raster-array-band"]),"raster-elevation":new me(se.paint_raster["raster-elevation"])}),layout:gI},zy=ei([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ly{constructor(e,i,s,l){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,l)}update(e,i,s){const{width:l,height:u}=e,{context:p}=this,{gl:g}=p;if(g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!i||i.premultiply!==!1)),s||this.size&&this.size[0]===l&&this.size[1]===u){const{x:v,y:w}=s||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)g.texSubImage2D(g.TEXTURE_2D,0,v,w,g.RGBA,g.UNSIGNED_BYTE,e);else{let S=this.format,A=g.UNSIGNED_BYTE;this.format===g.R32F&&(S=g.RED,A=g.FLOAT),g.texSubImage2D(g.TEXTURE_2D,0,v,w,l,u,S,A,e.data)}}else if(this.size=[l,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let v=this.format;this.format===g.R8&&(v=g.RED),g.texImage2D(g.TEXTURE_2D,0,this.format,v,g.UNSIGNED_BYTE,e)}else{let v=this.format,w=this.format,S=g.UNSIGNED_BYTE;this.format===g.DEPTH_COMPONENT&&(v=g.DEPTH_COMPONENT16,S=g.UNSIGNED_SHORT),this.format===g.R8&&(w=g.RED),this.format===g.R32F&&(S=g.FLOAT,w=g.RED),g.texImage2D(g.TEXTURE_2D,0,v,l,u,0,w,S,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i,s=!1){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),this.wrapS=s),l!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Nm{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Vm(t,e,i,s,l,u,p,g){const v=[t,e,1,i,s,1,l,u,1],w=[p,g,1],S=r.ct.adjoint([],v),[A,C,R]=r.Q.transformMat3(w,w,S);return r.ct.multiply(v,v,[A,0,0,0,C,0,0,0,R])}function Qb(t,e,i,s,l,u,p,g){const v=function(w,S,A,C,R,L,O,V){const j=Vm(0,0,1,0,1,1,0,1),X=Vm(w,S,A,C,R,L,O,V),ee=r.ct.adjoint([],j);return r.ct.multiply(X,X,ee)}(t,e,i,s,l,u,p,g);return[v[2]/v[8]/ut,v[5]/v[8]/ut]}function jm(t){return[t[0],Math.min(Math.max(t[1],-Pn),Pn)]}class Xb extends Uo{constructor(e,i,s,l){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new mo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Vh(this.map._requestManager.transformRequest(this.url,su.Image),(s,l)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new pu(s)):l&&(this.image=l instanceof HTMLImageElement?Is.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Nm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new mo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Nm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const u of e)u[1]>s&&(s=u[1]),u[1]<i&&(i=u[1]);const l=(s+i)/2;if(l>Pn?this.onNorthPole=!0:l<-Pn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(xr.fromLngLat);this.tileID=function(p){let g=1/0,v=1/0,w=-1/0,S=-1/0;for(const O of p)g=Math.min(g,O.x),v=Math.min(v,O.y),w=Math.max(w,O.x),S=Math.max(S,O.y);const A=Math.max(w-g,S-v),C=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),R=Math.pow(2,C);let L=Math.floor((g+w)/2*R);return L>1&&(L-=1),new dc(C,L,Math.floor((v+S)/2*R))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new mo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const j in this.tiles){const X=this.tiles[j];X.state!=="loaded"&&(X.state="loaded",X.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Ud(new dc(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const X=j[1].x-j[0].x,ee=j[1].y-j[0].y,K=j[2].x-j[1].x,le=j[2].y-j[1].y,ie=j[3].x-j[2].x,ue=j[3].y-j[2].y,pe=j[0].x-j[3].x,ve=j[0].y-j[3].y,Re=X*le-K*ee,we=K*ue-ie*le,Fe=ie*ve-pe*ue,Oe=pe*ee-X*ve;return Re>0&&we>0&&Fe>0&&Oe>0||Re<0&&we<0&&Fe<0&&Oe<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=Ud(this.tileID,this.map.transform.projection),[u,p,g,v]=this.coordinates.map(j=>{const X=l.projection.project(j[0],j[1]);return Ub(l,X)._round()});this.perspectiveTransform=Qb(u.x,u.y,p.x,p.y,g.x,g.y,v.x,v.y);const w=this._boundsArray=new hr;w.emplaceBack(u.x,u.y,0,0),w.emplaceBack(p.x,p.y,ut,0),w.emplaceBack(v.x,v.y,0,ut),w.emplaceBack(g.x,g.y,ut,ut),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,zy.members),this.boundsSegments=Cn.simpleSegment(0,0,4,2);const S=[],A=[jm((C=this.coordinates)[0]),jm(C[1]),jm(C[2]),jm(C[3])];var C;const[R,L,O,V]=function(j){let X=j[0][0],ee=X,K=j[0][1],le=K;for(let ie=1;ie<j.length;ie++)j[ie][0]<X?X=j[ie][0]:j[ie][0]>ee&&(ee=j[ie][0]),j[ie][1]<K?K=j[ie][1]:j[ie][1]>le&&(le=j[ie][1]);return[X,K,ee-X,le-K]}(A);{const j=new hr,[X,ee,K,le]=function(Xe){let Qe=Xe[0].x,Ne=Qe,It=Xe[0].y,Tt=It;for(let et=1;et<Xe.length;et++)Xe[et].x<Qe?Qe=Xe[et].x:Xe[et].x>Ne&&(Ne=Xe[et].x),Xe[et].y<It?It=Xe[et].y:Xe[et].y>Tt&&(Tt=Xe[et].y);return[Qe,It,Ne-Qe,Tt-It]}(s),ie=Xe=>[(Xe.x-X)/K,(Xe.y-ee)/le],[ue,pe,ve,Re]=s.map(ie),we=function(Xe,Qe,Ne,It,Tt,et,jt,zt){const Ct=Vm(0,0,1,0,1,1,0,1),tt=Vm(Xe,Qe,Ne,It,Tt,et,jt,zt),Ft=r.ct.adjoint([],tt);return r.ct.multiply(Ct,Ct,Ft)}(ue[0],ue[1],pe[0],pe[1],ve[0],ve[1],Re[0],Re[1]);this.elevatedGlobePerspectiveTransform=Qb(ue[0],ue[1],pe[0],pe[1],ve[0],ve[1],Re[0],Re[1]);const Fe=(Xe,Qe)=>{S.push(Xe.lng);const Ne=Math.round((Xe.lng-R)/O*ut),It=Math.round((Xe.lat-L)/V*ut),Tt=ie(Qe),et=r.Q.transformMat3([],[Tt[0],Tt[1],1],we),jt=Math.round(et[0]/et[2]*ut),zt=Math.round(et[1]/et[2]*ut);j.emplaceBack(Ne,It,jt,zt)},Oe=s[3].x-s[0].x,ze=s[3].y-s[0].y,We=s[2].x-s[1].x,$e=s[2].y-s[1].y;for(let Xe=0;Xe<65;Xe++){const Qe=Xe/64,Ne=[s[0].x+Qe*Oe,s[0].y+Qe*ze],It=[s[1].x+Qe*We,s[1].y+Qe*$e],Tt=It[0]-Ne[0],et=It[1]-Ne[1];for(let jt=0;jt<65;jt++){const zt=jt/64,Ct={x:Ne[0]+Tt*zt,y:Ne[1]+et*zt,z:0};Fe(i.projection.unproject(Ct.x,Ct.y),Ct)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,zy.members)}{this.maxLongitudeTriangleSize=0;let j=[],X=new Hn;const ee=(K,le,ie)=>{X.emplaceBack(K,le,ie);const ue=S[K],pe=S[le],ve=S[ie],Re=Math.min(Math.min(ue,pe),ve),we=Math.max(Math.max(ue,pe),ve)-Re;we>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=we),j.push(Re+we/2)};for(let K=0;K<64;K++)for(let le=0;le<64;le++){const ie=65*K+le,ue=ie+1,pe=ie+65,ve=pe+1;ee(ie,pe,ue),ee(ue,pe,ve)}[j,X]=function(K,le){const ie=Array.from({length:K.length},(ve,Re)=>Re);ie.sort((ve,Re)=>K[ve]-K[Re]);const ue=[],pe=new Hn;for(let ve=0;ve<ie.length;ve++){const Re=ie[ve];ue.push(K[Re]);const we=3*Re,Fe=we+1;pe.emplaceBack(le.uint16[we],le.uint16[Fe],le.uint16[Fe+1])}return[ue,pe]}(j,X),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(X)}this.elevatedGlobeSegments=Cn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/ut,0,V/ut,0,0,L,R,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof Nm||(this.texture?this.texture.update(this.image):(this.texture=new Ly(i,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let l=((S,A)=>S+360*Math.round((A-S)/360))(e+180,s[0]);const u=new Cn,p=(S,A)=>{u.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:i.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},g=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-l)<=g){const S=kh(s,0,s.length,l+g);return S===s.length||p(S,Vo(s,S+1,s.length,l+360-g)-S),u}l<s[0]&&(l+=360);const v=Vo(s,0,s.length,l-g);if(v===s.length)return p(0,s.length),u;p(0,v-0);const w=kh(s,v+1,s.length,l+g);return w!==s.length&&p(w,s.length-w),u}}const xI=(Math.pow(256,2)-1)/16907520;class Yb extends oi{constructor(e,i,s){super(e,yI,i,s),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Xb&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(l)||s===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=Dd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,l])}}const vI=new ye({visibility:new me(se["layout_raster-particle"].visibility)});var bI={paint:new ye({"raster-particle-array-band":new me(se["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new me(se["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ze(se["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new me(se["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new me(se["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new me(se["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new me(se["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:vI};class Kb extends oi{constructor(e,i,s){super(e,bI,i,s),this._updateColorRamp(),this.lastInvalidatedAt=Is.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Dd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Is.now()}}class wI extends oi{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const TI=new ye({visibility:new me(se.layout_sky.visibility)});var MI={paint:new ye({"sky-type":new me(se.paint_sky["sky-type"]),"sky-atmosphere-sun":new me(se.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new me(se.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new me(se.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new me(se.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ze(se.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new me(se.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new me(se.paint_sky["sky-atmosphere-color"]),"sky-opacity":new me(se.paint_sky["sky-opacity"])}),layout:TI};function ky(t,e,i){const s=[0,0,1],l=r.bl.identity([]);return r.bl.rotateY(l,l,i?-Mi(t)+Math.PI:Mi(t)),r.bl.rotateX(l,l,-Mi(e)),r.Q.transformQuat(s,s,l),r.Q.normalize(s,s)}var SI={paint:new ye({})};function Jb(t,e){const i=Um(t.projection,t.zoom,t.width,t.height),s=function(u,p,g,v,w){const S=new Ai(g.lng-180*Xa,g.lat),A=new Ai(g.lng+180*Xa,g.lat),C=u.project(S.lng,S.lat),R=u.project(A.lng,A.lat),L=-Math.atan2(R.y-C.y,R.x-C.x),O=xr.fromLngLat(g);O.y=mi(O.y,-1+Xa,1-Xa);const V=O.toLngLat(),j=u.project(V.lng,V.lat),X=xr.fromLngLat(V);X.x+=Xa;const ee=X.toLngLat(),K=u.project(ee.lng,ee.lat),le=i1(K.x-j.x,K.y-j.y,L),ie=xr.fromLngLat(V);ie.y+=Xa;const ue=ie.toLngLat(),pe=u.project(ue.lng,ue.lat),ve=i1(pe.x-j.x,pe.y-j.y,L),Re=Math.abs(le.x)/Math.abs(ve.y),we=r.a9.identity([]);r.a9.rotateZ(we,we,-L*(1-(w?0:v)));const Fe=r.a9.identity([]);return r.a9.scale(Fe,Fe,[1,1-(1-Re)*v,1]),Fe[4]=-ve.x/ve.y*v,r.a9.rotateZ(Fe,Fe,L),r.a9.multiply(Fe,we,Fe),Fe}(t.projection,0,t.center,i,e),l=e1(t);return r.a9.scale(s,s,[l,l,1]),s}function e1(t){const e=t.projection,i=Um(t.projection,t.zoom,t.width,t.height),s=t1(e,t.center),l=t1(e,Ai.convert(e.center));return Math.pow(2,s*i+(1-i)*l)}function Um(t,e,i,s,l=1/0){const u=t.range;if(!u)return 0;const p=Math.min(l,Math.max(i,s)),g=Math.log(p/1024)/Math.LN2;return vl(u[0]+g,u[1]+g,e)}const Xa=1/4e4;function t1(t,e){const i=mi(e.lat,-Pn,Pn),s=new Ai(e.lng-180*Xa,i),l=new Ai(e.lng+180*Xa,i),u=t.project(s.lng,i),p=t.project(l.lng,i),g=xr.fromLngLat(s),v=xr.fromLngLat(l),w=p.x-u.x,S=p.y-u.y,A=v.x-g.x,C=v.y-g.y,R=Math.sqrt((A*A+C*C)/(w*w+S*S));return Math.log(R)/Math.LN2}function i1(t,e,i){const s=Math.cos(i),l=Math.sin(i);return{x:t*s-e*l,y:t*l+e*s}}function n1(t,e,i){r.a9.identity(t),r.a9.rotateZ(t,t,Mi(e[2])),r.a9.rotateX(t,t,Mi(e[0])),r.a9.rotateY(t,t,Mi(e[1])),r.a9.scale(t,t,i),r.a9.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Gm(t,e,i,s,l,u,p,g){const v=[i[0]-e[0],i[1]-e[1],0],w=[s[0]-e[0],s[1]-e[1],0];if(r.Q.length(v)<1e-12||r.Q.length(w)<1e-12)return r.bl.identity(t);const S=r.Q.cross([],v,w);r.Q.normalize(S,S),r.Q.subtract(w,s,e),v[2]=(u-l)*g,w[2]=(p-l)*g;const A=v;return r.Q.cross(A,v,w),r.Q.normalize(A,A),r.bl.rotationTo(t,S,A)}function Oy(t,e,i=!1){const s=Ga(e.zoom),l=function(u,p,g){const v=p.worldSize,w=[u[12],u[13],u[14]],S=dr(w[1]/v),A=Kr(w[0]/v),C=r.a9.identity([]),R=kr(1,S)*v,L=kr(1,0)*v*fc(S,p.zoom),O=1/oy(v);let V=L*O;if(g){const K=Um(p.projection,p.zoom,p.width,p.height,1024);V=O*p.projection.pixelSpaceConversion(p.center.lat,v,K)}const j=hc(S,A);r.Q.add(j,j,r.Q.scale([],r.Q.normalize([],j),R*V*w[2]));const X=function(K){const le=[K[0],K[1],K[2]];let ie=[0,1,0];const ue=r.Q.cross([],ie,le);return r.Q.cross(ie,le,ue),r.Q.squaredLength(ie)===0&&(ie=[0,1,0],r.Q.cross(ue,le,ie)),r.Q.normalize(ue,ue),r.Q.normalize(ie,ie),r.Q.normalize(le,le),[ue[0],ue[1],ue[2],0,ie[0],ie[1],ie[2],0,le[0],le[1],le[2],0,K[0],K[1],K[2],1]}(j);r.a9.scale(C,C,[V,V,V*R]),r.a9.translate(C,C,[-w[0],-w[1],-w[2]]);const ee=r.a9.multiply([],p.globeMatrix,X);return r.a9.multiply(ee,ee,C),r.a9.multiply(ee,ee,u),ee}(t,e,i);if(s>0){const u=function(p,g){const v=g.worldSize,w=kr(1,0)*v*fc(g.center.lat,g.zoom)/oy(v),S=kr(1,g.center.lat)*v,A=r.a9.identity([]);return r.a9.rotateY(A,A,Mi(g.center.lng)),r.a9.rotateX(A,A,Mi(g.center.lat)),r.a9.translate(A,A,[0,0,Lr]),r.a9.scale(A,A,[w,w,w*S]),r.a9.translate(A,A,[g.point.x-.5*v,g.point.y-.5*v,0]),r.a9.multiply(A,A,p),r.a9.multiply(A,g.globeMatrix,A)}(t,e);return function(p,g,v){const w=(L,O,V)=>{const j=r.Q.length(L),X=r.Q.length(O),ee=na(L,O,V);return r.Q.scale(ee,ee,1/r.Q.length(ee)*ai(j,X,V))},S=w([p[0],p[1],p[2]],[g[0],g[1],g[2]],v),A=w([p[4],p[5],p[6]],[g[4],g[5],g[6]],v),C=w([p[8],p[9],p[10]],[g[8],g[9],g[10]],v),R=na([p[12],p[13],p[14]],[g[12],g[13],g[14]],v);return[S[0],S[1],S[2],0,A[0],A[1],A[2],0,C[0],C[1],C[2],0,R[0],R[1],R[2],1]}(l,u,s)}return l}function r1(t,e,i,s){const l=un.projectAabbCorners(s,i);let u=Number.MAX_VALUE,p=-1;for(let w=0;w<l.length;++w){const S=l[w];S[0]=(.5*S[0]+.5)*e.width,S[1]=(.5-.5*S[1])*e.height,S[2]<u&&(p=w,u=S[2])}const g=w=>new ct(l[w][0],l[w][1]);let v;switch(p){case 0:case 6:v=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:v=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:v=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:v=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(Xg(t,v))return u}const EI=ei([{name:"a_pos_3f",components:3,type:"Float32"}]),AI=ei([{name:"a_color_3f",components:3,type:"Float32"}]),II=ei([{name:"a_color_4f",components:4,type:"Float32"}]),CI=ei([{name:"a_uv_2f",components:2,type:"Float32"}]),PI=ei([{name:"a_normal_3f",components:3,type:"Float32"}]),DI=ei([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),RI=ei([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class $m{constructor(e,i,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function s1(t,e){const i=t.indexOf("://")===-1;try{return new URL(t,i&&e?"http://example.com":void 0),!0}catch{return!1}}class o1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class a1{constructor(){this.instancedDataArray=new kg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Fy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(e,i,s,l){this.tileToMeter=im(s);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:g,index:v,sourceLayerIndex:w}of e){const S=g??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),A=Ua(p,u);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),A,s))continue;const C={id:S,sourceLayerIndex:w,index:v,geometry:u?A.geometry:ia(p,s,l),properties:p.properties,type:p.type,patterns:{}},R=this.addFeature(C,C.geometry,A);R&&i.featureIndex.insert(p,C.geometry,v,w,this.index,this.instancesPerModel[R].instancedDataArray.length,ut/32)}this.lookup=null}update(e,i,s,l){for(const u in this.instancesPerModel){const p=this.instancesPerModel[u];for(const g in e)p.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(p.features[p.idToFeaturesIndex[g]],e[g],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const l of s.features){const u=this.layers[0],p=l.feature,g=this.canonical,v=u.paint.get("model-rotation").evaluate(p,{},g),w=u.paint.get("model-scale").evaluate(p,{},g),S=u.paint.get("model-translation").evaluate(p,{},g);r.Q.exactEquals(l.rotation,v)&&r.Q.exactEquals(l.scale,w)&&r.Q.exactEquals(l.translation,S)||(this.evaluate(l,l.featureStates,s,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,DI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,s){const l=this.layers[0],u=l.layout.get("model-id").evaluate(s,{},this.canonical);if(!u)return gn(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),u;s1(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new a1);const p=this.instancesPerModel[u],g=p.instancedDataArray,v=new o1(s,g.length);for(const w of i)for(const S of w){if(S.x<0||S.x>=ut||S.y<0||S.y>=ut)continue;const A=(this.lookupDim-1)/ut,C=this.lookupDim*(S.y*A|0)+S.x*A|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const R=g.length;g.resize(R+1),p.instancesEvaluatedElevation.push(0),g.float32[16*R]=S.x,g.float32[16*R+1]=S.y}return v.instancedDataCount=p.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(v),this.evaluate(v,{},p,!1)),u}getModelUris(){return this.modelUris}evaluate(e,i,s,l){const u=this.layers[0],p=e.feature,g=this.canonical,v=e.rotation=u.paint.get("model-rotation").evaluate(p,i,g),w=e.scale=u.paint.get("model-scale").evaluate(p,i,g),S=e.translation=u.paint.get("model-translation").evaluate(p,i,g),A=u.paint.get("model-color").evaluate(p,i,g);A.a=u.paint.get("model-color-mix-intensity").evaluate(p,i,g);const C=[];this.maxVerticalOffset<S[2]&&(this.maxVerticalOffset=S[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),n1(C,v,w);const R=Math.round(100*A.a)+A.b/1.05;for(let L=0;L<e.instancedDataCount;++L){const O=e.instancedDataOffset+L,V=16*O,j=s.instancedDataArray.float32;let X=0;l&&(X=j[V+6]-s.instancesEvaluatedElevation[O]);const ee=0|j[V+1];j[V]=(0|j[V])+A.r/1.05,j[V+1]=ee+A.g/1.05,j[V+2]=R,j[V+3]=1/(g.z>10?this.tileToMeter:im(g,ee)),j[V+4]=S[0],j[V+5]=S[1],j[V+6]=S[2]+X,j[V+7]=C[0],j[V+8]=C[1],j[V+9]=C[2],j[V+10]=C[4],j[V+11]=C[5],j[V+12]=C[6],j[V+13]=C[8],j[V+14]=C[9],j[V+15]=C[10],s.instancesEvaluatedElevation[O]=S[2]}}}St(Fy,"ModelBucket",{omit:["layers"]}),St(a1,"PerModelAttributes"),St(o1,"ModelFeature");const zI=new ye({visibility:new me(se.layout_model.visibility),"model-id":new be(se.layout_model["model-id"])});var LI={paint:new ye({"model-opacity":new me(se.paint_model["model-opacity"]),"model-rotation":new be(se.paint_model["model-rotation"]),"model-scale":new be(se.paint_model["model-scale"]),"model-translation":new be(se.paint_model["model-translation"]),"model-color":new be(se.paint_model["model-color"]),"model-color-mix-intensity":new be(se.paint_model["model-color-mix-intensity"]),"model-type":new me(se.paint_model["model-type"]),"model-cast-shadows":new me(se.paint_model["model-cast-shadows"]),"model-receive-shadows":new me(se.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new me(se.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new be(se.paint_model["model-emissive-strength"]),"model-roughness":new be(se.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new be(se.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new me(se.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new me(se.paint_model["model-front-cutoff"])}),layout:zI};const _c=64,sh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function l1(t,e,i,s,l,u,p,g,v,w=!1){const S=i.zoom,A=i.project(s),C=fc(s.lat,S),R=1/C;r.a9.identity(t),r.a9.translate(t,t,[A.x+p[0]*R,A.y+p[1]*R,p[2]]);let L=1,O=1;const V=i.worldSize;if(w){if(i.projection.name==="mercator"){let K=0;i.elevation&&(K=i.elevation.getAtPointOrZero(new xr(A.x/V,A.y/V),0));const le=r.aa.transformMat4([],[A.x,A.y,K,1],i.projMatrix)[3]/i.cameraToCenterDistance;L=le,O=le*fc(i.center.lat,S)}else if(i.projection.name==="globe"){const K=Oy(t,i),le=r.a9.multiply([],i.projMatrix,K),ie=[0,0,0,1];r.aa.transformMat4(ie,ie,le);const ue=ie[3]/i.cameraToCenterDistance,pe=Ga(S),ve=i.projection.pixelsPerMeter(s.lat,V)*fc(s.lat,S),Re=i.projection.pixelsPerMeter(i.center.lat,V)*fc(i.center.lat,S);L=ue/ai(ve,Qx(i.center.lat),pe),O=ue*C/ve,L*=Re,O*=Re}}else L=R;r.a9.scale(t,t,[L,L,O]);const j=[...t],X=e.orientation,ee=[];if(n1(ee,[X[0]+l[0],X[1]+l[1],X[2]+l[2]],u),r.a9.multiply(t,j,ee),g&&i.elevation){let K=0;const le=[];if(v&&i.elevation){K=function(pe,ve,Re,we,Fe){const Oe=ve.elevation;if(!Oe)return 0;const ze=un.projectAabbCorners(Re,we),We=kr(1,Fe.lat)*ve.worldSize,$e=function(Ft,ti){const $t=[0,0,1],si=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ii of si){const di=Ft[ii.corners[0]],Gt=Ft[ii.corners[1]],Hi=Ft[ii.corners[2]],qi=[Gt[0]-di[0],Gt[1]-di[1],ti*(Gt[2]-di[2])],Pi=r.Q.cross(qi,qi,[Hi[0]-di[0],Hi[1]-di[1],ti*(Hi[2]-di[2])]);r.Q.normalize(Pi,Pi),ii.dotProductWithUp=r.Q.dot(Pi,$t)}return si.sort((ii,di)=>ii.dotProductWithUp-di.dotProductWithUp),si[0].corners}(ze,We),Xe=ze[$e[0]],Qe=ze[$e[1]],Ne=ze[$e[2]],It=ze[$e[3]],Tt=Oe.getAtPointOrZero(new xr(Xe[0]/ve.worldSize,Xe[1]/ve.worldSize),0),et=Oe.getAtPointOrZero(new xr(Qe[0]/ve.worldSize,Qe[1]/ve.worldSize),0),jt=Oe.getAtPointOrZero(new xr(Ne[0]/ve.worldSize,Ne[1]/ve.worldSize),0),zt=Oe.getAtPointOrZero(new xr(It[0]/ve.worldSize,It[1]/ve.worldSize),0),Ct=(Tt+zt)/2,tt=(et+jt)/2;return Ct>tt?et<jt?Gm(pe,Qe,It,Xe,et,zt,Tt,We):Gm(pe,Ne,Xe,It,jt,Tt,zt,We):Tt<zt?Gm(pe,Xe,Qe,Ne,Tt,et,jt,We):Gm(pe,It,Ne,Qe,zt,jt,et,We),Math.max(Ct,tt)}(le,i,e.aabb,t,s);const ie=r.a9.fromQuat([],le),ue=r.a9.multiply([],ie,ee);r.a9.multiply(t,j,ue)}else K=i.elevation.getAtPointOrZero(new xr(A.x/V,A.y/V),0);K!==0&&(t[14]+=K)}}function Hd(t,e,i=!1){t.uploaded||(t.gfxTexture=new Ly(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function kI(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,EI.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,PI.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,CI.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?AI:II).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,RI.members,!0)),t.segments=Cn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const s=t.material;s.pbrMetallicRoughness.baseColorTexture&&Hd(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Hd(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Hd(s.normalTexture,e),s.occlusionTexture&&Hd(s.occlusionTexture,e,i),s.emissionTexture&&Hd(s.emissionTexture,e)}function By(t,e,i){if(t.meshes)for(const s of t.meshes)kI(s,e,i);if(t.children)for(const s of t.children)By(s,e,i)}function qm(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)qm(e)}function Ny(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)Ny(i)}class OI{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class FI{constructor(){this.tasks={},this.taskQueue=[],Rh(["process"],this),this.invoker=new OI(this.process),this.nextId=0}add(e,i){const s=this.nextId++,l=function({type:u,isSymbolTile:p,zoom:g}){return g=g||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-g:u==="maybePrepare"&&p?400-g:500:200-g:100-g}(i);if(l===0){qs();try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:l,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){qs();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<i&&(i=u.priority,e=l)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class c1{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Rh(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new FI}send(e,i,s,l,u=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[g]=s);const v=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!s,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:rc(i,v)},v),{cancel:()=>{s&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const i=e.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(i.mustQueue||qs()){const l=this.callbacks[s],u=this.scheduler.add(()=>this.processTask(s,i),l&&l.metadata||{type:"message"});u&&(this.cancelCallbacks[s]=u)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(h(i.error)):s(null,h(i.data)))}else{const s=new Set,l=i.hasCallback?(p,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?rc(p):null,data:rc(g,s)},s)}:p=>{},u=h(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,u,l);else if(this.parent.getWorkerSource){const p=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,p[0],u.source,u.scope)[p[1]](u,l)}else l(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class oh{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=zi();const s=this.workerPool.acquire(this.id);for(let l=0;l<s.length;l++){const u=new oh.Actor(s[l],i,this.id);u.name=`Worker ${l}`,this.actors.push(u)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){Ph(this.actors,(l,u)=>{l.send(e,i,u)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}oh.Actor=c1;var Zd={workerUrl:"",workerClass:null,workerParams:void 0};function BI(){return Zd.workerClass!=null?new Zd.workerClass:new self.Worker(Zd.workerUrl,Zd.workerParams)}const Vy="mapboxgl_preloaded_worker_pool";class Qd{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Qd.workerCount;)this.workers.push(new BI);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Vy]}numActive(){return Object.keys(this.active).length}}let Xd;function Wm(){return Xd||(Xd=new Qd),Xd}Qd.workerCount=2;let Hm,jy,eo,ah,Uy,lh=null;function u1(){return qs()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:jy||Z.DRACO_URL}function h1(){if(qs()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ah)return ah;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ah=WebAssembly.validate(t)?Z.MESHOPT_SIMD_URL:Z.MESHOPT_URL,ah}const Zm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},NI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Yd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function d1(t,e,i){const s=i.json.bufferViews.length,l=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:l,byteLength:t.byteLength},i.buffers[l]=t}const Gy="KHR_draco_mesh_compression";function VI(t,e){const i=t.extensions&&t.extensions[Gy];if(!i)return;const s=new eo.Decoder,l=_1(e,i.bufferView),u=new eo.Mesh;if(!s.DecodeArrayToMesh(l,l.byteLength,u))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[t.indices],g=Zm[p.componentType],v=p.count*g.BYTES_PER_ELEMENT,w=eo._malloc(v);g===Uint16Array?s.GetTrianglesUInt16Array(u,v,w):s.GetTrianglesUInt32Array(u,v,w),d1(eo.memory.buffer.slice(w,w+v),p,e),eo._free(w);for(const S of Object.keys(i.attributes)){const A=s.GetAttributeByUniqueId(u,i.attributes[S]),C=e.json.accessors[t.attributes[S]],R=NI[C.componentType],L=C.count*Yd[C.type]*Zm[C.componentType].BYTES_PER_ELEMENT,O=eo._malloc(L);s.GetAttributeDataArrayForAllPoints(u,A,eo[R],L,O),d1(eo.memory.buffer.slice(O,O+L),C,e),eo._free(O)}s.destroy(),u.destroy(),delete t.extensions[Gy]}const Qm="EXT_meshopt_compression";function jI(t,e){if(!t.extensions||!t.extensions[Qm])return;const i=t.extensions[Qm],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),l=new Uint8Array(i.count*i.byteStride);Uy.decodeGltfBuffer(l,i.count,i.byteStride,s,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=l.buffer,delete t.extensions[Qm]}const f1=1179937895,p1=new TextDecoder("utf8");function m1(t,e){return new URL(t,e).href}function UI(t,e,i,s){return fetch(m1(t.uri,s)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[i]=l})}function _1(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function GI(t,e,i,s){if(t.uri){const l=m1(t.uri,s);return fetch(l).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[i]=u})}if(t.bufferView!==void 0){const l=_1(e,t.bufferView),u=new Blob([l],{type:t.mimeType});return createImageBitmap(u).then(p=>{e.images[i]=p})}}function g1(t,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===f1){const S=new Uint32Array(t,e);let A=2;const C=(S[A++]>>2)-3,R=S[A++]>>2;if(A++,s.json=JSON.parse(p1.decode(S.subarray(A,A+R))),A+=R,A<C){const L=S[A++];A++;const O=e+(A<<2);s.buffers[0]=t.slice(O,O+L)}}else s.json=JSON.parse(p1.decode(new Uint8Array(t,e)));const{buffers:l,images:u,meshes:p,extensionsUsed:g,bufferViews:v}=s.json;let w=Promise.resolve();if(l){const S=[];for(let A=0;A<l.length;A++){const C=l[A];C.uri?S.push(UI(C,s,A,i)):s.buffers[A]||(s.buffers[A]=null)}w=Promise.all(S)}return w.then(()=>{const S=[],A=g&&g.includes(Gy),C=g&&g.includes(Qm);if(A&&S.push(function(){if(!eo)return Hm||(Hm=function(R){let L,O=null;function V(){L=new Uint8Array(O.buffer)}function j(){throw new Error("Unexpected Draco error.")}const X={a:{a:j,d:function(ee,K,le){return L.copyWithin(ee,K,K+le)},c:function(ee){const K=L.length,le=Math.max(ee>>>0,Math.ceil(1.2*K)),ie=Math.ceil((le-K)/65536);try{return O.grow(ie),V(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,X):R.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,X))).then(ee=>{const{Rb:K,Qb:le,P:ie,T:ue,X:pe,Ja:ve,La:Re,Qa:we,Va:Fe,Wa:Oe,eb:ze,jb:We,f:$e,e:Xe,yb:Qe,zb:Ne,Ab:It,Bb:Tt,Db:et,Gb:jt}=ee.instance.exports;O=Xe;const zt=(()=>{let Ct=0,tt=0,Ft=0,ti=0;return $t=>{Ft&&(K(ti),K(Ct),tt+=Ft,Ft=Ct=0),Ct||(tt+=128,Ct=le(tt));const si=$t.length+7&-8;let ii=Ct;si>=tt&&(Ft=si,ii=ti=le(si));for(let di=0;di<$t.length;di++)L[ii+di]=$t[di];return ii}})();return V(),$e(),{memory:Xe,_free:K,_malloc:le,Mesh:class{constructor(){this.ptr=ie()}destroy(){ue(this.ptr)}},Decoder:class{constructor(){this.ptr=ve()}destroy(){We(this.ptr)}DecodeArrayToMesh(Ct,tt,Ft){const ti=zt(Ct),$t=Re(this.ptr,ti,tt,Ft.ptr);return!!pe($t)}GetAttributeByUniqueId(Ct,tt){return{ptr:we(this.ptr,Ct.ptr,tt)}}GetTrianglesUInt16Array(Ct,tt,Ft){Fe(this.ptr,Ct.ptr,tt,Ft)}GetTrianglesUInt32Array(Ct,tt,Ft){Oe(this.ptr,Ct.ptr,tt,Ft)}GetAttributeDataArrayForAllPoints(Ct,tt,Ft,ti,$t){ze(this.ptr,Ct.ptr,tt.ptr,Ft,ti,$t)}},DT_INT8:Qe(),DT_UINT8:Ne(),DT_INT16:It(),DT_UINT16:Tt(),DT_UINT32:et(),DT_FLOAT32:jt()}})}(fetch(u1())),Hm.then(R=>{eo=R,Hm=void 0}))}()),C&&S.push(function(){if(Uy)return;const R=function(L){let O;const V=WebAssembly.instantiateStreaming(L,{}).then(ee=>{O=ee.instance,O.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},X={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(ee,K,le,ie,ue,pe){(function(ve,Re,we,Fe,Oe,ze,We){const $e=ve.exports.sbrk,Xe=Fe+3&-4,Qe=$e(Xe*Oe),Ne=$e(ze.length),It=new Uint8Array(ve.exports.memory.buffer);It.set(ze,Ne);const Tt=Re(Qe,Fe,Oe,Ne,ze.length);if(Tt===0&&We&&We(Qe,Xe,Oe),we.set(It.subarray(Qe,Qe+Fe*Oe)),$e(Qe-$e(0)),Tt!==0)throw new Error(`Malformed buffer data: ${Tt}`)})(O,O.exports[X[ue]],ee,K,le,ie,O.exports[j[pe]])}}}(fetch(h1()));return R.ready.then(()=>{Uy=R})}()),u)for(let R=0;R<u.length;R++)S.push(GI(u[R],s,R,i));return(S.length?Promise.all(S):Promise.resolve()).then(()=>{if(A&&p)for(const{primitives:R}of p)for(const L of R)VI(L,s);if(C&&p&&v)for(const R of v)jI(R,s);return s})})}class y1{constructor(e,i,s,l){if(this.triangleCount=i.length/3,this.min=new ct(0,0),this.max=new ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[u,p]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){const C=e[A];u.x=Math.min(u.x,C.x),u.y=Math.min(u.y,C.y),p.x=Math.max(p.x,C.x),p.y=Math.max(p.y,C.y)}if(l){const A=Math.ceil(Math.max(p.x-u.x,p.y-u.y)/l);s=Math.max(s,A)}if(s===0)return;this.min=u,this.max=p;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const v=Math.max(g.x,g.y)/s;this.cellsX=Math.max(1,Math.ceil(g.x/v)),this.cellsY=Math.max(1,Math.ceil(g.y/v)),this.xScale=1/v,this.yScale=1/v;const w=[];for(let A=0;A<this.triangleCount;A++){const C=e[i[3*A+0]].sub(this.min),R=e[i[3*A+1]].sub(this.min),L=e[i[3*A+2]].sub(this.min),O=Ya(Math.floor(Math.min(C.x,R.x,L.x)),this.xScale,this.cellsX),V=Ya(Math.floor(Math.max(C.x,R.x,L.x)),this.xScale,this.cellsX),j=Ya(Math.floor(Math.min(C.y,R.y,L.y)),this.yScale,this.cellsY),X=Ya(Math.floor(Math.max(C.y,R.y,L.y)),this.yScale,this.cellsY),ee=new ct(0,0),K=new ct(0,0),le=new ct(0,0),ie=new ct(0,0);for(let ue=j;ue<=X;++ue){ee.y=K.y=ue*v,le.y=ie.y=(ue+1)*v;for(let pe=O;pe<=V;++pe)ee.x=le.x=pe*v,K.x=ie.x=(pe+1)*v,(Jg(C,R,L,ee,K,ie)||Jg(C,R,L,ee,ie,le))&&w.push({cellIdx:ue*this.cellsX+pe,triIdx:A})}}if(w.length===0)return;w.sort((A,C)=>A.cellIdx-C.cellIdx||A.triIdx-C.triIdx);let S=0;for(;S<w.length;){const A=w[S].cellIdx,C={start:this.payload.length,len:0};for(;S<w.length&&w[S].cellIdx===A;)++C.len,this.payload.push(w[S++].triIdx);this.cells[A]=C}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let v=0;v<this.lookup.length;v++)this.lookup[v]=0;const l=Ya(e.x-this.min.x,this.xScale,this.cellsX),u=Ya(i.x-this.min.x,this.xScale,this.cellsX),p=Ya(e.y-this.min.y,this.yScale,this.cellsY),g=Ya(i.y-this.min.y,this.yScale,this.cellsY);for(let v=p;v<=g;v++)for(let w=l;w<=u;w++){const S=this.cells[v*this.cellsX+w];if(S)for(let A=0;A<S.len;A++){const C=this.payload[S.start+A],R=Math.floor(C/8),L=1<<C%8;if(!(this.lookup[R]&L)&&(this.lookup[R]|=L,s.push(C),s.length===this.triangleCount))return}}}}function Ya(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function gc(t,e){const i=t.json.bufferViews[e.bufferView],s=Zm[e.componentType];return new s(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Yd[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:Yd[e.type]))}function $y(t,e,i,s){const l=Zm[e.componentType],u=function(S){switch(S){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),p=t.json.bufferViews[e.bufferView],g=p.byteStride?p.byteStride/l.BYTES_PER_ELEMENT:Yd[e.type],v=i.float32,w=v.length/i.capacity;for(let S=0,A=0;S<e.count*g;S+=g,A+=w)for(let C=0;C<w;C++)v[A+C]=s[S+C]*u;i._trim()}function $I(t,e,i){const s=t.indices,l=t.attributes,u={};u.indexArray=new Hn;const p=e.json.accessors[s],g=p.count/3;u.indexArray.reserve(g);const v=gc(e,p);for(let C=0;C<g;C++)u.indexArray.emplaceBack(v[3*C],v[3*C+1],v[3*C+2]);u.indexArray._trim(),u.vertexArray=new cc;const w=e.json.accessors[l.POSITION];u.vertexArray.reserve(w.count);const S=gc(e,w);for(let C=0;C<w.count;C++)u.vertexArray.emplaceBack(S[3*C],S[3*C+1],S[3*C+2]);if(u.vertexArray._trim(),u.aabb=new un(w.min,w.max),u.centroid=function(C,R){const L=[0,0,0],O=C.length;if(O>0){for(let V=0;V<O;V++){const j=3*C[V];L[0]+=R[j],L[1]+=R[j+1],L[2]+=R[j+2]}L[0]/=O,L[1]/=O,L[2]/=O}return L}(v,S),l.COLOR_0!==void 0){const C=e.json.accessors[l.COLOR_0],R=Yd[C.type],L=gc(e,C);u.colorArray=R===3?new cc:new Wn,u.colorArray.resize(C.count),$y(e,C,u.colorArray,L)}if(l.NORMAL!==void 0){u.normalArray=new cc;const C=e.json.accessors[l.NORMAL];u.normalArray.resize(C.count);const R=gc(e,C);$y(e,C,u.normalArray,R)}if(l.TEXCOORD_0!==void 0&&i.length>0){u.texcoordArray=new nr;const C=e.json.accessors[l.TEXCOORD_0];u.texcoordArray.resize(C.count);const R=gc(e,C);$y(e,C,u.texcoordArray,R)}if(l._FEATURE_ID_RGBA4444!==void 0){const C=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=gc(e,C))}l._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(gc(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const A=t.material;return u.material=function(C,R){const{emissiveFactor:L=[0,0,0],alphaMode:O="OPAQUE",alphaCutoff:V=.5,normalTexture:j,occlusionTexture:X,emissiveTexture:ee,doubleSided:K}=C,{baseColorFactor:le=[1,1,1,1],metallicFactor:ie=1,roughnessFactor:ue=1,baseColorTexture:pe,metallicRoughnessTexture:ve}=C.pbrMetallicRoughness||{},Re=X?R[X.index]:void 0;if(X&&X.extensions&&X.extensions.KHR_texture_transform&&Re){const we=X.extensions.KHR_texture_transform;Re.offsetScale=[we.offset[0],we.offset[1],we.scale[0],we.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ni(...le),metallicFactor:ie,roughnessFactor:ue,baseColorTexture:pe?R[pe.index]:void 0,metallicRoughnessTexture:ve?R[ve.index]:void 0},doubleSided:K,emissiveFactor:L,alphaMode:O,alphaCutoff:V,normalTexture:j?R[j.index]:void 0,occlusionTexture:Re,emissionTexture:ee?R[ee.index]:void 0,defined:C.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},i),u}function x1(t,e,i){const{matrix:s,rotation:l,translation:u,scale:p,mesh:g,extras:v,children:w}=t,S={};if(S.matrix=s||r.a9.fromRotationTranslationScale([],l||[0,0,0,1],u||[0,0,0],p||[1,1,1]),g!==void 0){S.meshes=i[g];const A=S.anchor=[0,0];for(const C of S.meshes){const{min:R,max:L}=C.aabb;A[0]+=R[0]+L[0],A[1]+=R[1]+L[1]}A[0]=Math.floor(A[0]/S.meshes.length/2),A[1]=Math.floor(A[1]/S.meshes.length/2)}if(v&&(v.id&&(S.id=v.id),v.lights&&(S.lights=function(A){if(!A.length)return[];const C=function(j){const X=atob(j),ee=new Uint8Array(X.length);for(let K=0;K<X.length;K++)ee[K]=X.codePointAt(K);return ee}(A),R=[],L=C.length/24,O=new Uint16Array(C.buffer),V=new Float32Array(C.buffer);for(let j=0;j<L;j++){const X=O[2*j*6]/30,ee=O[2*j*6+1]/30,K=O[2*j*6+10]/100,le=V[6*j+1],ie=V[6*j+2],ue=V[6*j+3],pe=V[6*j+4],ve=ue-le,Re=pe-ie,we=Math.hypot(ve,Re);R.push({pos:[le+.5*ve,ie+.5*Re,ee],normal:[Re/we,-ve/we,0],width:we,height:X,depth:K,points:[le,ie,ue,pe]})}return R}(v.lights))),w){const A=[];for(const C of w)A.push(x1(e.json.nodes[C],e,i));S.children=A}return S}function qI(t){if(t.vertices.length===0||t.indices.length===0)return null;const e=new y1(t.vertices,t.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:i,max:s}}function WI(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const p of i){if(!Array.isArray(p)||p.length!==2)continue;const g=p[0],v=p[1];typeof g=="number"&&typeof v=="number"&&s.push(new ct(g,v))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let l=0;for(let p=0;p<s.length;p++){const g=s[p],v=s[(p+1)%s.length],w=s[(p+2)%s.length];l+=(g.x-v.x)*(w.y-v.y)-(w.x-v.x)*(g.y-v.y)}l>0&&s.reverse();const u=mm(s.flatMap(p=>[p.x,p.y]),[]);return u.length===0?null:{vertices:s,indices:u}}function HI(t,e){const i=[],s=[];let l=0;const u=[];for(const p of t){l=i.length;const g=p.vertexArray.float32,v=p.indexArray.uint16;for(let w=0;w<p.vertexArray.length;w++)u[0]=g[3*w+0],u[1]=g[3*w+1],u[2]=g[3*w+2],r.Q.transformMat4(u,u,e),i.push(new ct(u[0],u[1]));for(let w=0;w<3*p.indexArray.length;w++)s.push(v[w]+l)}if(s.length%3!=0)return null;for(let p=0;p<s.length;p+=3){const g=i[s[p+0]],v=i[s[p+1]],w=i[s[p+2]];(g.x-v.x)*(w.y-v.y)-(w.x-v.x)*(g.y-v.y)>0&&([s[p+1],s[p+2]]=[s[p+2],s[p+1]])}return{vertices:i,indices:s}}function v1(t){const e=function(v,w){const S=[],A=WebGL2RenderingContext;if(v.json.textures)for(const C of v.json.textures){const R={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};C.sampler!==void 0&&Object.assign(R,v.json.samplers[C.sampler]),S.push({image:w[C.source],sampler:R,uploaded:!1})}return S}(t,t.images),i=function(v,w){const S=[];for(const A of v.json.meshes){const C=[];for(const R of A.primitives)C.push($I(R,v,w));S.push(C)}return S}(t,e),{scenes:s,scene:l,nodes:u}=t.json,p=s?s[l||0].nodes:u,g=[];for(const v of p)g.push(x1(u[v],t,i));return function(v,w,S){const A={},C=new Set;for(let R=0;R<v.length;R++){const L=S[w[R]];if(!L.extras)continue;const O=L.extras["mapbox:footprint:version"],V=L.extras["mapbox:footprint:id"];(O||V)&&C.add(R),O==="1.0.0"&&V&&(A[V]=R)}for(let R=0;R<v.length;R++){if(C.has(R))continue;const L=v[R],O=S[w[R]];if(!O.extras)continue;let V=null;L.id in A&&(V=HI(v[A[L.id]].meshes,L.matrix)),V||(V=WI(O)),V&&(L.footprint=qI(V))}if(C.size>0){const R=Array.from(C.values()).sort((L,O)=>L-O);for(let L=R.length-1;L>=0;L--)v.splice(R[L],1)}}(g,p,t.json.nodes),g}function ZI(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,s=t.aabb.min[1]-1,l=_c/(t.aabb.max[0]-i+2),u=_c/(t.aabb.max[1]-s+2);for(let p=0;p<e.length;p+=3){const g=e[p+2],v=(e[p+0]-i)*l|0,w=(e[p+1]-s)*u|0;g>t.heightmap[w*_c+v]&&(t.heightmap[w*_c+v]=g)}}function QI(t,e){const i={};i.indexArray=new Hn,i.indexArray.reserve(4*t.length),i.vertexArray=new cc,i.vertexArray.reserve(10*t.length),i.colorArray=new Wn,i.vertexArray.reserve(10*t.length);let s=0;for(const p of t){const g=Math.min(10,Math.max(4,1.3*p.height))*e,v=[-p.normal[1],p.normal[0],0],w=Math.min(.29,.1*p.width/p.depth),S=p.width-2*p.depth*e*(w+.01),A=r.Q.scaleAndAdd([],p.pos,v,S/2),C=r.Q.scaleAndAdd([],p.pos,v,-S/2),R=[A[0],A[1],A[2]+p.height],L=[C[0],C[1],C[2]+p.height],O=r.Q.scaleAndAdd([],p.normal,v,w);r.Q.scale(O,O,g);const V=r.Q.scaleAndAdd([],p.normal,v,-w);r.Q.scale(V,V,g),r.Q.add(O,A,O),r.Q.add(V,C,V),A[2]+=.1,C[2]+=.1,i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]);const j=S/g/2;i.colorArray.emplaceBack(-j-w,-1,j,.8),i.colorArray.emplaceBack(j+w,-1,j,.8),i.colorArray.emplaceBack(-j,0,j,1.3),i.colorArray.emplaceBack(j,0,j,1.3),i.colorArray.emplaceBack(j+w,-.8,j,.7),i.colorArray.emplaceBack(j+w,-.8,j,.7),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(j+w,-1.2,j,.8),i.colorArray.emplaceBack(j+w,-1.2,j,.8),i.indexArray.emplaceBack(6+s,4+s,8+s),i.indexArray.emplaceBack(7+s,9+s,5+s),i.indexArray.emplaceBack(0+s,1+s,2+s),i.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const l={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Ni.white,l.pbrMetallicRoughness=u,i.material=l,i.aabb=new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}St(y1,"TriangleGridIndex");class b1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const XI=["tile","layer","source","sourceLayer","state"];class w1{constructor(e,i,s,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of XI)this[i]!==void 0&&(e[i]=this[i]);return e}}class T1{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ka(ut,16,0),this.featureIndexArray=new Bx,this.promoteId=i,this.is3DTile=!1}insert(e,i,s,l,u,p=0,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,u,p);const w=this.grid;for(let S=0;S<i.length;S++){const A=i[S],C=[1/0,1/0,-1/0,-1/0];for(let R=0;R<A.length;R++){const L=A[R];C[0]=Math.min(C[0],L.x),C[1]=Math.min(C[1],L.y),C[2]=Math.max(C[2],L.x),C[3]=Math.max(C[3],L.y)}g!==0&&(C[0]-=g,C[1]-=g,C[2]+=g,C[3]+=g),C[0]<ut&&C[1]<ut&&C[2]>=0&&C[3]>=0&&w.insert(v,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gy(new eh(this.rawTileData)).layers,this.sourceLayerCoder=new b1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,l){this.loadVTLayers();const u=e.params||{},p=vt(u.filter),g=e.tileResult,v=e.transform,w=g.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(L,O,V,j)=>iv(g.bufferedTilespaceGeometry,L,O,V,j));S.sort(YI);let A=null;v.elevation&&S.length>0&&(A=Qu.create(v.elevation,this.tileID));const C={};let R;for(let L=0;L<S.length;L++){const O=S[L];if(O===R)continue;R=O;const V=this.featureIndexArray.get(O);let j=null;if(this.is3DTile){const X=this.bucketLayerIDs[0][0],ee=i[X];if(ee.type!=="model")continue;const{queryFeature:K,intersectionZ:le}=ee.queryIntersectsMatchingFeature(g,V.featureIndex,p,v);K&&this.appendToResult(C,X,V.featureIndex,K,le)}else this.loadMatchingFeature(C,V,p,u.layers,u.availableImages,i,s,l,(X,ee,K,le=0)=>(j||(j=ia(X,this.tileID.canonical,e.tileTransform)),ee.queryIntersectsFeature(g,X,K,j,this.z,e.transform,e.pixelPosMatrix,A,le)))}return C}loadMatchingFeature(e,i,s,l,u,p,g,v,w){const{featureIndex:S,bucketIndex:A,sourceLayerIndex:C,layoutVertexArrayOffset:R}=i,L=this.bucketLayerIDs[A];if(l&&!function(X,ee){for(let K=0;K<X.length;K++)if(ee.indexOf(X[K])>=0)return!0;return!1}(l,L))return;const O=this.sourceLayerCoder.decode(C),V=this.vtLayers[O].feature(S);if(s.needGeometry){const X=Ua(V,!0);if(!s.filter(new H(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!s.filter(new H(this.tileID.overscaledZ),V))return;const j=this.getId(V,O);for(let X=0;X<L.length;X++){const ee=L[X];if(l&&l.indexOf(ee)<0)continue;const K=p[ee];if(!K)continue;let le={};j!==void 0&&v&&(le=v.getState(K.sourceLayer||"_geojsonTileLayer",j));const ie=!w||w(V,K,le,R);if(!ie)continue;const ue=new w1(V,this.z,this.x,this.y,j),pe=Qr({},g[ee]);pe.paint=M1(pe.paint,K.paint,V,le,u),pe.layout=M1(pe.layout,K.layout,V,le,u),ue.layer=pe,this.appendToResult(e,ee,S,ue,ie)}}appendToResult(e,i,s,l,u){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:s,feature:l,intersectionZ:u})}lookupSymbolFeatures(e,i,s,l,u,p,g,v){const w={};this.loadVTLayers();const S=vt(u);for(const A of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:l,featureIndex:A,layoutVertexArrayOffset:0},S,p,g,v,i);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(s),u=this.vtFeatures[l];if(u[i])return u[i];const p=this.vtLayers[l].feature(i);return u[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];l!=null&&(s=e.properties[l]),typeof s=="boolean"&&(s=Number(s))}return s}}function M1(t,e,i,s,l){return fa(t,(u,p)=>{const g=e instanceof Pe?e.get(p):null;return g&&g.evaluate?g.evaluate(i,s,l):g})}function YI(t,e){return e-t}St(T1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const qy=new Float32Array(262144),yc=new Uint8Array(262144);function S1(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,S1(i));return e}function E1(t,e,i){if(t.meshes)for(const s of t.meshes)s.aabb.min[0]!==1/0&&i.insert(e,s.aabb.min[0],s.aabb.min[1],s.aabb.max[0],s.aabb.max[1]);if(t.children)for(const s of t.children)E1(s,e,i)}const A1=["","wall","door","roof","window","lamp","logo"];class I1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:S1(e)}}}getLocalBounds(){if(!this.node.meshes)return new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&i.encapsulate(s.aabb),e++;this.aabb=un.applyTransform(i,this.node.matrix)}return this.aabb}}class Xm{constructor(e,i,s,l,u,p){this.id=i,this.modelTraits|=sh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=sh.HasMapboxMeshFeatures),l&&(this.modelTraits|=sh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const g of e)this.nodesInfo.push(new I1(g)),E1(g,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const l=s.node;this.uploaded?this.updatePbrBuffer(l):By(l,e,!0)}for(const s of i)qm(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const l=e.transform.projectionOptions,u=e.style.getBrightness(),p=this.brightness!==u;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||Kd(s.paint.get("model-color").value,p)||Kd(s.paint.get("model-color-mix-intensity").value,p)||Kd(s.paint.get("model-roughness").value,p)||Kd(s.paint.get("model-emissive-strength").value,p)||Kd(s.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=l,this.brightness=u,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),l=this.id.canonical;for(const u of s){const p=u.feature;u.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},l)}}evaluate(e){const i=this.getNodesInfo();for(const s of i){if(!s.node.meshes)continue;const l=s.feature,u=s.node.meshes&&s.node.meshes[0].featureData,p=s.evaluatedColor[2],g=s.evaluatedRMEA[2],v=this.id.canonical;if(s.hasTranslucentParts=!1,u){for(let w=0;w<A1.length;w++){const S=A1[w];S.length&&(l.properties.part=S);const A=e.paint.get("model-color").evaluate(l,{},v),C=e.paint.get("model-color-mix-intensity").evaluate(l,{},v);s.evaluatedColor[w]=[A.r,A.g,A.b,C],s.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(l,{},v),s.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(l,{},v),s.evaluatedRMEA[w][3]=A.a,s.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},v),!s.hasTranslucentParts&&A.a<1&&(s.hasTranslucentParts=!0)}delete l.properties.part,JI(s,p!==s.evaluatedColor[2]||g!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,{},v);s.evaluatedScale=e.paint.get("model-scale").evaluate(l,{},v),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,l){const u=e.findDEMTileFor(s);if(u&&(u.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const p=Qu.create(e,s,u);if(!p)return;this.modelTraits&sh.HasMapboxMeshFeatures&&this.updateDEM(e,p,s,l);for(const g of this.getNodesInfo()){const v=g.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;const w=v.footprint.vertices;let S=p.getElevationAt(w[0].x,w[0].y,!0,!0);for(let A=1;A<w.length;A++)S=Math.min(S,p.getElevationAt(w[A].x,w[A].y,!0,!0));v.elevation=S}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,l){let u=i._dem._modifiedForSources[l];if(u===void 0&&(i._dem._modifiedForSources[l]=[],u=i._dem._modifiedForSources[l]),u.includes(s.canonical))return;const p=i._dem.dim;u.push(s.canonical);let g=!1;for(const v of this.getNodesInfo()){const w=v.node;if(!w.footprint||!w.footprint.grid)continue;const S=w.footprint.grid,A=i.tileCoordToPixel(S.min.x,S.min.y),C=i.tileCoordToPixel(S.max.x,S.max.y),R=Math.min(Math.min(p-C.y,A.x),Math.min(A.y,p-C.x));if(R<0)continue;const L=mi(R,2,5);let O=Math.max(0,A.x-L),V=Math.max(0,A.y-L),j=Math.min(C.x+L,p-1),X=Math.min(C.y+L,p-1);for(let ie=V;ie<=X;++ie)for(let ue=O;ue<=j;++ue)yc[ie*p+ue]=255;let ee=0,K=0;for(let ie=0;ie<S.cellsY;++ie)for(let ue=0;ue<S.cellsX;++ue){if(!S.cells[ie*S.cellsX+ue])continue;const pe=i.tileCoordToPixel(S.min.x+ue/S.xScale,S.min.y+ie/S.yScale),ve=i.tileCoordToPixel(S.min.x+(ue+1)/S.xScale,S.min.y+(ie+1)/S.yScale);for(let Re=pe.y;Re<=Math.min(ve.y+1,p-1);++Re)for(let we=pe.x;we<=Math.min(ve.x+1,p-1);++we)yc[Re*p+we]===255&&(yc[Re*p+we]=0,ee+=i.getElevationAtPixel(we,Re),K++)}const le=ee/K;O=Math.max(1,A.x-L),V=Math.max(1,A.y-L),j=Math.min(C.x+L,p-2),X=Math.min(C.y+L,p-2),g=!0;for(let ie=V;ie<=X;++ie)for(let ue=O;ue<=j;++ue)yc[ie*p+ue]===0&&(qy[ie*p+ue]=i._dem.set(ue,ie,le));for(let ie=1;ie<L;++ie){O=Math.max(1,A.x-ie),V=Math.max(1,A.y-ie),j=Math.min(C.x+ie,p-2),X=Math.min(C.y+ie,p-2);for(let ue=V;ue<=X;++ue)for(let pe=O;pe<=j;++pe){const ve=ue*p+pe;if(yc[ve]===255){let Re=0,we=0,Fe=-1,Oe=-1;for(let ze=-1;ze<=1;++ze)for(let We=-1;We<=1;++We){const $e=(ue+ze)*p+pe+We;if(yc[$e]>=ie)continue;const Xe=qy[$e],Qe=Math.abs(Xe);Qe>we&&(Re=Xe,we=Qe,Fe=We,Oe=ze)}if(we>.1){const ze=1-(ie+.5*Math.abs(Fe*Oe))/L;let We=i._dem.get(pe,ue)+Re*ze;const $e=i._dem.get(pe+Fe,ue+Oe),Xe=i._dem.get(pe-Fe,ue-Oe,!0);(We-$e)*(We-Xe)>0&&(We=($e+Xe)/2),qy[ve]=i._dem.set(pe,ue,We),yc[ve]=ie}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Is.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)qm(i.node),Ny(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const p=l[u].node;l[u].hiddenByReplacement=!!p.footprint&&!s.find(g=>g.footprint===p.footprint)}}getHeightAtTileCoord(e,i){const s=this.getNodesInfo(),l=[],u=[0,0,0];for(let p=0;p<this.nodesInfo.length;p++){const g=s[p],v=g.node.meshes[0],w=un.applyTransform(v.aabb,g.node.matrix);if(e<w.min[0]||i<w.min[1]||e>w.max[0]||i>w.max[1])continue;const S=(e-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*_c|0,A=Math.min(63,(i-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*_c|0)*_c+Math.min(63,S);if(u[2]=v.heightmap[A],r.Q.transformMat4(u,u,g.node.matrix),!(v.heightmap[A]<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:u[2],maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new ct(e,i),new ct(e,i),l),l.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function Kd(t,e){return!t.isLightConstant&&e}function KI(t,e,i,s,l,u,p,g){let v=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,S=240&e|(240&e)>>4;i[3]>0&&(v=ai(v,255*i[0],i[3]),w=ai(w,255*i[1],i[3]),S=ai(S,255*i[2],i[3]));const A=v<<8|w,C=S<<8|Math.floor(255*s[3]),R=function(ie){const ue=mi(ie,0,2);return Math.min(Math.round(.5*ue*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],L=mi(l[0],0,1),O=mi(l[1],0,1),V=mi(l[2],0,1),j=mi(l[3],0,1);let X,ee,K,le;if(L!==O&&p!==u&&O!==L){const ie=p-u;ee=1/(ie*(O-L)),K=-(u+ie*L)/(ie*(O-L));const ue=mi(l[4],-1,1);le=Math.pow(10,ue),X=255*V<<8|255*j}else X=65535,ee=0,K=1,le=1;if(t.emplaceBack(A,C,R,X,ee,K,le),g){const ie=g.length;g.clear();for(let ue=0;ue<ie;ue++)g.emplaceBack(A,C,R,X,ee,K,le)}}function JI(t,e,i){const s=t.node;let l=0;const u=i&sh.HasMeshoptCompression;for(const p of s.meshes){if(s.lights&&s.lightMeshIndex===l||!p.featureData)continue;p.featureArray=new Jp,p.featureArray.reserve(p.featureData.length);let g=e;for(const v of p.featureData){const w=u?65535&v:v>>16&65535,S=u?v>>16&65535:65535&v,A=(15&S)<8?15&S:0,C=t.evaluatedRMEA[A],R=t.evaluatedColor[A],L=t.emissionHeightBasedParams[A];let O;if(g&&A===2&&s.lights&&(O=new Jp,O.resize(10*s.lights.length)),KI(p.featureArray,w,R,C,L,p.aabb.min[2],p.aabb.max[2],O),O&&g){g=!1;const V=s.meshes[s.lightMeshIndex];V.featureArray=O,V.featureArray._trim()}}p.featureArray._trim(),l++}}function C1(t,e,i,s){const l=1<<t.z;e.lat=dr((s/ut+t.y)/l),e.lng=Kr((i/ut+t.x)/l)}St(Xm,"Tiled3dModelBucket",{omit:["layers"]}),St(I1,"Tiled3dModelFeature");const eC={circle:class extends oi{constructor(t,e,i){super(t,lE,e,i)}createBucket(t){return new Qg(t)}queryRadius(t){const e=t;return Wu("circle-radius",this,e)+Wu("circle-stroke-width",this,e)+sm(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,s,l,u,p,g){const v=rv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return yv(t,s,u,p,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=gv(this);return{config:new uc(this,e),defines:i,overrideFog:!1}}},heatmap:class extends oi{createBucket(t){return new vv(t)}constructor(t,e,i){super(t,vE,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Wu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,s,l,u,p,g){const v=this.paint.get("heatmap-radius").evaluate(e,i);return yv(t,s,u,p,g,!0,!0,new ct(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new uc(this,e),overrideFog:!1}:{}}},hillshade:class extends oi{constructor(t,e,i){super(t,wE,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends oi{constructor(t,e,i){super(t,OE,e,i)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new uc(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new _y(t)}queryRadius(){return sm(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,s,l,u){return!t.queryGeometry.isAboveHorizon&&Jx(nv(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends oi{constructor(t,e,i){super(t,uA,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new wm(t)}queryRadius(){return sm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,s,l,u,p,g,v){const w=rv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,i),A=this.paint.get("fill-extrusion-base").evaluate(e,i),C=[0,0],R=g&&u.elevation,L=u.elevation?u.elevation.exaggeration():1,O=t.tile.getBucket(this);if(R&&O instanceof wm){const K=O.centroidVertexArray,le=v+1;le<K.length&&(C[0]=K.geta_centroid_pos0(le),C[1]=K.geta_centroid_pos1(le))}if(C[0]===0&&C[1]===1)return!1;u.projection.name==="globe"&&(s=tb([s],[new ct(0,0),new ct(ut,ut)],t.tileID.canonical).map(K=>K.polygon).flat());const V=R?g:null,[j,X]=function(K,le,ie,ue,pe,ve,Re,we,Fe,Oe,ze){return K.projection.name==="globe"?function(We,$e,Xe,Qe,Ne,It,Tt,et,jt,zt,Ct){const tt=[],Ft=[],ti=We.projection.upVectorScale(Ct,We.center.lat,We.worldSize).metersToTile,$t=[0,0,0,1],si=[0,0,0,1],ii=(Gt,Hi,qi,Pi)=>{Gt[0]=Hi,Gt[1]=qi,Gt[2]=Pi,Gt[3]=1},di=eb();Xe>0&&(Xe+=di),Qe+=di;for(const Gt of $e){const Hi=[],qi=[];for(const Pi of Gt){const vi=Pi.x+Ne.x,Di=Pi.y+Ne.y,rn=We.projection.projectTilePoint(vi,Di,Ct),Ki=We.projection.upVector(Ct,Pi.x,Pi.y);let yn=Xe,pn=Qe;if(Tt){const vr=nb(vi,Di,Xe,Qe,Tt,et,jt,zt);yn+=vr.base,pn+=vr.top}Xe!==0?ii($t,rn.x+Ki[0]*ti*yn,rn.y+Ki[1]*ti*yn,rn.z+Ki[2]*ti*yn):ii($t,rn.x,rn.y,rn.z),ii(si,rn.x+Ki[0]*ti*pn,rn.y+Ki[1]*ti*pn,rn.z+Ki[2]*ti*pn),r.Q.transformMat4($t,$t,It),r.Q.transformMat4(si,si,It),Hi.push(new Xu($t[0],$t[1],$t[2])),qi.push(new Xu(si[0],si[1],si[2]))}tt.push(Hi),Ft.push(qi)}return[tt,Ft]}(K,le,ie,ue,pe,ve,Re,we,Fe,Oe,ze):Re?function(We,$e,Xe,Qe,Ne,It,Tt,et,jt){const zt=[],Ct=[],tt=[0,0,0,1];for(const Ft of We){const ti=[],$t=[];for(const si of Ft){const ii=si.x+Qe.x,di=si.y+Qe.y,Gt=nb(ii,di,$e,Xe,It,Tt,et,jt);tt[0]=ii,tt[1]=di,tt[2]=Gt.base,tt[3]=1,r.aa.transformMat4(tt,tt,Ne),tt[3]=Math.max(tt[3],1e-5);const Hi=new Xu(tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]);tt[0]=ii,tt[1]=di,tt[2]=Gt.top,tt[3]=1,r.aa.transformMat4(tt,tt,Ne),tt[3]=Math.max(tt[3],1e-5);const qi=new Xu(tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]);ti.push(Hi),$t.push(qi)}zt.push(ti),Ct.push($t)}return[zt,Ct]}(le,ie,ue,pe,ve,Re,we,Fe,Oe):function(We,$e,Xe,Qe,Ne){const It=[],Tt=[],et=Ne[8]*$e,jt=Ne[9]*$e,zt=Ne[10]*$e,Ct=Ne[11]*$e,tt=Ne[8]*Xe,Ft=Ne[9]*Xe,ti=Ne[10]*Xe,$t=Ne[11]*Xe;for(const si of We){const ii=[],di=[];for(const Gt of si){const Hi=Gt.x+Qe.x,qi=Gt.y+Qe.y,Pi=Ne[0]*Hi+Ne[4]*qi+Ne[12],vi=Ne[1]*Hi+Ne[5]*qi+Ne[13],Di=Ne[2]*Hi+Ne[6]*qi+Ne[14],rn=Ne[3]*Hi+Ne[7]*qi+Ne[15],Ki=Pi+et,yn=vi+jt,pn=Di+zt,vr=Math.max(rn+Ct,1e-5),En=Pi+tt,dn=vi+Ft,On=Di+ti,sr=Math.max(rn+$t,1e-5);ii.push(new Xu(Ki/vr,yn/vr,pn/vr)),di.push(new Xu(En/sr,dn/sr,On/sr))}It.push(ii),Tt.push(di)}return[It,Tt]}(le,ie,ue,pe,ve)}(u,s,A,S,w,p,V,C,L,u.center.lat,t.tileID.canonical),ee=t.queryGeometry;return function(K,le,ie){let ue=1/0;Jx(ie,le)&&(ue=ib(ie,le[0]));for(let pe=0;pe<le.length;pe++){const ve=le[pe],Re=K[pe];for(let we=0;we<ve.length-1;we++){const Fe=ve[we],Oe=[Fe,ve[we+1],Re[we+1],Re[we],Fe];Xg(ie,Oe)&&(ue=Math.min(ue,ib(ie,Oe)))}}return ue!==1/0&&ue}(j,X,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends oi{constructor(t,e,i){super(t,sb,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ql,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=hb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new xy(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=cb(this);return{config:new uc(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=db(Wu("line-width",this,e),Wu("line-gap-width",this,e)),s=Wu("line-offset",this,e);return i/2+Math.abs(s)+sm(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,s,l,u){if(t.queryGeometry.isAboveHorizon)return!1;const p=nv(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*db(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),v=this.paint.get("line-offset").evaluate(e,i);return v&&(s=function(w,S){const A=[],C=new ct(0,0);for(let R=0;R<w.length;R++){const L=w[R],O=[];for(let V=0;V<L.length;V++){const j=L[V],X=L[V+1],ee=V===0?C:j.sub(L[V-1])._unit()._perp(),K=V===L.length-1?C:X.sub(j)._unit()._perp(),le=ee._add(K)._unit();le._mult(1/(le.x*K.x+le.y*K.y)),O.push(le._mult(S)._add(j))}A.push(O)}return A}(s,v*t.pixelToTileUnitsFactor)),function(w,S,A){for(let C=0;C<S.length;C++){const R=S[C];if(w.length>=3){for(let L=0;L<R.length;L++)if(pc(w,R[L]))return!0}if(rE(w,R,A))return!0}return!1}(p,s,g)}isTileClipped(){return!0}},symbol:Bm,background:class extends oi{constructor(t,e,i){super(t,_I,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:Yb,"raster-particle":Kb,sky:class extends oi{constructor(t,e,i){super(t,MI,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Dd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),l=!s,u=t.style.light,p=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&gn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?ky(p.azimuthal,90-p.polar,e):ky(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return ky(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends oi{constructor(t,e,i){super(t,SI,e)}},model:class extends oi{constructor(t,e,i){super(t,LI,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Fy(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Xm?ut-1:0}queryIntersectsFeature(t,e,i,s,l,u){if(!this.modelManager)return!1;const p=this.modelManager,g=t.tile.getBucket(this);if(!(g&&g instanceof Fy))return!1;const v=g;for(const w in v.instancesPerModel){const S=v.instancesPerModel[w],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(A)){const C=S.features[S.idToFeaturesIndex[A]],R=p.getModel(w,this.scope);if(!R)return!1;let L=r.a9.create();const O=new Ai(0,0),V=v.canonical;let j=Number.MAX_VALUE;for(let X=0;X<C.instancedDataCount;++X){const ee=16*(C.instancedDataOffset+X),K=S.instancedDataArray.float32,le=[K[ee+4],K[ee+5],K[ee+6]];C1(V,O,K[ee],0|K[ee+1]),l1(L,R,u,O,C.rotation,C.scale,le,!1,!1,!1),u.projection.name==="globe"&&(L=Oy(L,u));const ie=r.a9.multiply([],u.projMatrix,L),ue=t.queryGeometry,pe=r1(ue.isPointQuery()?ue.screenBounds:ue.screenGeometry,u,ie,R.aabb);pe!=null&&(j=Math.min(pe,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ic}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,s){const l=t.tile,u=l.getBucket(this);let p=null,g=Number.MAX_VALUE;if(!(u&&u instanceof Xm))return{queryFeature:p,intersectionZ:g};const v=u.getNodesInfo()[e];if(v.hiddenByReplacement||!v.node.meshes||!i.filter(new H(l.tileID.overscaledZ),v.feature,l.tileID.canonical))return{queryFeature:p,intersectionZ:g};const w=v.node,S=s.calculatePosMatrix(l.tileID.toUnwrapped(),s.worldSize),A=v.evaluatedScale;let C=0;s.elevation&&w.elevation&&(C=w.elevation*s.elevation.exaggeration()),r.a9.translate(S,S,[(w.anchor?w.anchor[0]:0)*(A[0]-1),(w.anchor?w.anchor[1]:0)*(A[1]-1),C]),r.a9.scale(S,S,A),r.a9.multiply(S,S,w.matrix);const R=t.queryGeometry,L=R.isPointQuery()?R.screenBounds:R.screenGeometry,O=function(j){const X=r.a9.multiply([],S,j.matrix),ee=r.a9.multiply(X,s.expandedFarZProjMatrix,X);for(let K=0;K<j.meshes.length;++K){const le=j.meshes[K];if(K===j.lightMeshIndex)continue;const ie=r1(L,s,ee,le.aabb);ie!=null&&(g=Math.min(ie,g))}if(j.children)for(const K of j.children)O(K)};if(O(w),g===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:g};const V=new Ai(0,0);return C1(l.tileID.canonical,V,v.node.anchor[0],v.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[V.lng,V.lat]},properties:v.feature.properties,id:v.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:g}}}},Jt={read:function(t,e){return t.readFields(Jt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(Jt.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Jt.Filter.read=function(t,e){return t.readFields(Jt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Jt.Filter._readField=function(t,e,i){t===1?(e.delta_filter=Jt.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Jt.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Jt.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Jt.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},Jt.Filter.Delta={},Jt.Filter.Delta.read=function(t,e){return t.readFields(Jt.Filter.Delta._readField,{block_size:0},e)},Jt.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},Jt.Filter.Zigzag={},Jt.Filter.Zigzag.read=function(t,e){return t.readFields(Jt.Filter.Zigzag._readField,{},e)},Jt.Filter.Zigzag._readField=function(t,e,i){},Jt.Filter.BitShuffle={},Jt.Filter.BitShuffle.read=function(t,e){return t.readFields(Jt.Filter.BitShuffle._readField,{},e)},Jt.Filter.BitShuffle._readField=function(t,e,i){},Jt.Filter.ByteShuffle={},Jt.Filter.ByteShuffle.read=function(t,e){return t.readFields(Jt.Filter.ByteShuffle._readField,{},e)},Jt.Filter.ByteShuffle._readField=function(t,e,i){},Jt.Codec={},Jt.Codec.read=function(t,e){return t.readFields(Jt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Jt.Codec._readField=function(t,e,i){t===1?(e.gzip_data=Jt.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Jt.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Jt.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=Jt.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},Jt.Codec.GzipData={},Jt.Codec.GzipData.read=function(t,e){return t.readFields(Jt.Codec.GzipData._readField,{},e)},Jt.Codec.GzipData._readField=function(t,e,i){},Jt.Codec.JpegImage={},Jt.Codec.JpegImage.read=function(t,e){return t.readFields(Jt.Codec.JpegImage._readField,{},e)},Jt.Codec.JpegImage._readField=function(t,e,i){},Jt.Codec.WebpImage={},Jt.Codec.WebpImage.read=function(t,e){return t.readFields(Jt.Codec.WebpImage._readField,{},e)},Jt.Codec.WebpImage._readField=function(t,e,i){},Jt.Codec.PngImage={},Jt.Codec.PngImage.read=function(t,e){return t.readFields(Jt.Codec.PngImage._readField,{},e)},Jt.Codec.PngImage._readField=function(t,e,i){},Jt.DataIndexEntry={},Jt.DataIndexEntry.read=function(t,e){return t.readFields(Jt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Jt.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(Jt.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=Jt.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},Jt.Layer={},Jt.Layer.read=function(t,e){return t.readFields(Jt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Jt.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(Jt.DataIndexEntry.read(i,i.readVarint()+i.pos))};const to={read:function(t,e){return t.readFields(to._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=to.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=to.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};to.Uint32Values.read=function(t,e){return t.readFields(to.Uint32Values._readField,{values:[]},e)},to.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(s){if(s.type!==2)throw new Error(`Unsupported pbf type "${s.type}"`);const l=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(s),u=s.pos;return s.pos=l,function(p){s.pos=u;let g=0;for(;s.pos<l;){const v=s.readVarint();p[g++]=v}return p}}(i))},to.Fixed32Values={},to.Fixed32Values.read=function(t,e){return t.readFields(to.Fixed32Values._readField,{values:[]},e)},to.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.6
 */class tC{constructor(e=0,i=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=s,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){const i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){const s=this.items[e];this.ttl>0&&s.expiry<=Date.now()?this.delete(e):(i=s.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){const e=[];let i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,s=!1,l=this.resetTtl){let u;if(s||this.has(e)){if(u=this.items[e],u.value=i,s===!1&&l&&(u.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==u){const p=this.last,g=u.next,v=u.prev;this.first===u&&(this.first=u.next),u.next=null,u.prev=this.last,p.next=u,v!==null&&(v.next=g),g!==null&&(g.prev=v)}}else this.max>0&&this.size===this.max&&this.evict(!0),u=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=u:this.last.next=u;return this.last=u,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function iC(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const l=s===1?1:0,u=s===2?1:0;for(let p=0;p<e[0];p++){const g=e[1]*p;for(let v=l;v<e[1];v++){const w=e[2]*(v+g);for(let S=u;S<e[2];S++){const A=e[3]*(S+w);for(let C=0;C<e[3];C++){const R=A+C;t[R]+=t[R-i]}}}}i*=e[s]}return t}function nC(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function rC(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){const s=t[i],l=t[i+1];t[i]=(240&s)>>4|(61440&s)>>8|(240&l)<<4|61440&l,t[i+1]=15&s|(3840&s)>>4|(15&l)<<8|(3840&l)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){const s=t[i],l=t[i+1],u=t[i+2],p=t[i+3];t[i+0]=(192&s)>>6|(192&l)>>4|(192&u)>>2|192&p,t[i+1]=(48&s)>>4|(48&l)>>2|48&u|(48&p)<<2,t[i+2]=(12&s)>>2|12&l|(12&u)<<2|(12&p)<<4,t[i+3]=3&s|(3&l)<<2|(3&u)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Ka extends Error{constructor(e){super(e),this.name="MRTError"}}var ws=Uint8Array,Jd=Uint16Array,sC=Int32Array,P1=new ws([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),D1=new ws([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),oC=new ws([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),R1=function(t,e){for(var i=new Jd(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];var l=new sC(i[30]);for(s=1;s<30;++s)for(var u=i[s];u<i[s+1];++u)l[u]=u-i[s]<<5|s;return{b:i,r:l}},z1=R1(P1,2),L1=z1.b,aC=z1.r;L1[28]=258,aC[258]=28;for(var lC=R1(D1,0).b,k1=new Jd(32768),Rn=0;Rn<32768;++Rn){var ch=(43690&Rn)>>1|(21845&Rn)<<1;k1[Rn]=((65280&(ch=(61680&(ch=(52428&ch)>>2|(13107&ch)<<2))>>4|(3855&ch)<<4))>>8|(255&ch)<<8)>>1}var ef=function(t,e,i){for(var s=t.length,l=0,u=new Jd(e);l<s;++l)t[l]&&++u[t[l]-1];var p,g=new Jd(e);for(l=1;l<e;++l)g[l]=g[l-1]+u[l-1]<<1;{p=new Jd(1<<e);var v=15-e;for(l=0;l<s;++l)if(t[l])for(var w=l<<4|t[l],S=e-t[l],A=g[t[l]-1]++<<S,C=A|(1<<S)-1;A<=C;++A)p[k1[A]>>v]=w}return p},tf=new ws(288);for(Rn=0;Rn<144;++Rn)tf[Rn]=8;for(Rn=144;Rn<256;++Rn)tf[Rn]=9;for(Rn=256;Rn<280;++Rn)tf[Rn]=7;for(Rn=280;Rn<288;++Rn)tf[Rn]=8;var O1=new ws(32);for(Rn=0;Rn<32;++Rn)O1[Rn]=5;var cC=ef(tf,9),uC=ef(O1,5),Wy=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},io=function(t,e,i){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&i},Hy=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},hC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],no=function(t,e,i){var s=new Error(e||hC[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,no),!i)throw s;return s},dC=new ws(0),fC=typeof TextDecoder<"u"&&new TextDecoder;try{fC.decode(dC,{stream:!0})}catch{}const pC={gzip_data:"gzip"},mC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},_C={uint32:1,uint16:2,uint8:4},gC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class F1{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new Ka("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new Ka(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const l=new eh(i.subarray(0,s)),u=Jt.read(l);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Ka(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new yC(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let l=0;l<s.dataIndex.length;l++){const u=s.dataIndex[l],p=u.first_byte-e.firstByte,g=u.last_byte+1-e.firstByte;if(l<e.firstBlock||l>e.lastBlock||s._blocksInProgress.has(l))continue;const v={layerName:s.name,firstByte:p,lastByte:g,pixelFormat:s.pixelFormat,blockIndex:l,blockShape:[u.bands.length].concat(s.bandShape),buffer:s.buffer,codec:u.codec.codec,filters:u.filters.map(w=>w.filter)};s._blocksInProgress.add(l),i.push(v)}return new B1(i,()=>{i.forEach(l=>s._blocksInProgress.delete(l.blockIndex))},(l,u)=>{if(i.forEach(p=>s._blocksInProgress.delete(p.blockIndex)),l)throw l;u.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class yC{constructor({version:e,name:i,units:s,tilesize:l,pixel_format:u,buffer:p,data_index:g},v){if(this.version=e,this.version!==1)throw new Ka(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=l,this.buffer=p,this.pixelFormat=mC[u],this.dataIndex=g,this.bandShape=[l+2*p,l+2*p,_C[this.pixelFormat]],this._decodedBlocks=function(w=1e3,S=0,A=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(S)||S<0)throw new TypeError("Invalid ttl value");if(typeof A!="boolean")throw new TypeError("Invalid resetTtl value");return new tC(w,S,A)}(v?v.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,l]of this.dataIndex.entries()){for(const[u,p]of l.bands.entries())if(p===e)return{bandIndex:i+u,blockIndex:s,blockBandIndex:u};i+=l.bands.length}break;case"number":for(const[s,l]of this.dataIndex.entries()){if(e>=i&&e<i+l.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=l.bands.length}break;default:throw new Ka(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ka(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,s=-1/0,l=1/0,u=-1/0;for(const p of e){const{blockIndex:g}=this.getBlockForBand(p);if(g<0)throw new Ka(`Invalid band: ${JSON.stringify(p)}`);const v=this.dataIndex[g];l=Math.min(l,g),u=Math.max(u,g),i=Math.min(i,v.first_byte),s=Math.max(s,v.last_byte)}return{layerName:this.name,firstByte:i,lastByte:s,firstBlock:l,lastBlock:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e),l=this._decodedBlocks.get(i.toString());if(!l)throw new Ka(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[i],p=this.bandShape.reduce((w,S)=>w*S,1),g=s*p,v=l.subarray(g,g+p);return{data:v,bytes:new Uint8Array(v.buffer).subarray(v.byteOffset,v.byteOffset+v.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:u.offset,scale:u.scale}}}class B1{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}F1.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{const{layerName:s,firstByte:l,lastByte:u,pixelFormat:p,blockShape:g,blockIndex:v,filters:w,codec:S}=i,A=new Uint8Array(t).subarray(l,u+1),C=new Uint32Array(g[0]*g[1]*g[2]);let R;if(S!=="gzip_data")throw new Error(`Unhandled codec: ${S}`);return R=function(L,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((ee=function(ie){ie[0]==31&&ie[1]==139&&ie[2]==8||no(6,"invalid gzip data");var ue=ie[3],pe=10;4&ue&&(pe+=2+(ie[10]|ie[11]<<8));for(var ve=(ue>>3&1)+(ue>>4&1);ve>0;ve-=!ie[pe++]);return pe+(2&ue)}(X=L))+8>X.length&&no(6,"invalid gzip data"),function(ie,ue,pe,ve){var Re=ie.length;if(!Re||ue.f&&!ue.l)return pe||new ws(0);var we=!pe,Fe=we||ue.i!=2,Oe=ue.i;we&&(pe=new ws(3*Re));var ze,We,$e=function(Ja){var el=pe.length;if(Ja>el){var xc=new ws(Math.max(2*el,Ja));xc.set(pe),pe=xc}},Xe=ue.f||0,Qe=ue.p||0,Ne=ue.b||0,It=ue.l,Tt=ue.d,et=ue.m,jt=ue.n,zt=8*Re;do{if(!It){Xe=io(ie,Qe,1);var Ct=io(ie,Qe+1,3);if(Qe+=3,!Ct){var tt=ie[(vi=4+((Qe+7)/8|0))-4]|ie[vi-3]<<8,Ft=vi+tt;if(Ft>Re){Oe&&no(0);break}Fe&&$e(Ne+tt),pe.set(ie.subarray(vi,Ft),Ne),ue.b=Ne+=tt,ue.p=Qe=8*Ft,ue.f=Xe;continue}if(Ct==1)It=cC,Tt=uC,et=9,jt=5;else if(Ct==2){var ti=io(ie,Qe,31)+257,$t=io(ie,Qe+10,15)+4,si=ti+io(ie,Qe+5,31)+1;Qe+=14;for(var ii=new ws(si),di=new ws(19),Gt=0;Gt<$t;++Gt)di[oC[Gt]]=io(ie,Qe+3*Gt,7);Qe+=3*$t;var Hi=Wy(di),qi=(1<<Hi)-1,Pi=ef(di,Hi);for(Gt=0;Gt<si;){var vi,Di=Pi[io(ie,Qe,qi)];if(Qe+=15&Di,(vi=Di>>4)<16)ii[Gt++]=vi;else{var rn=0,Ki=0;for(vi==16?(Ki=3+io(ie,Qe,3),Qe+=2,rn=ii[Gt-1]):vi==17?(Ki=3+io(ie,Qe,7),Qe+=3):vi==18&&(Ki=11+io(ie,Qe,127),Qe+=7);Ki--;)ii[Gt++]=rn}}var yn=ii.subarray(0,ti),pn=ii.subarray(ti);et=Wy(yn),jt=Wy(pn),It=ef(yn,et),Tt=ef(pn,jt)}else no(1);if(Qe>zt){Oe&&no(0);break}}Fe&&$e(Ne+131072);for(var vr=(1<<et)-1,En=(1<<jt)-1,dn=Qe;;dn=Qe){var On=(rn=It[Hy(ie,Qe)&vr])>>4;if((Qe+=15&rn)>zt){Oe&&no(0);break}if(rn||no(2),On<256)pe[Ne++]=On;else{if(On==256){dn=Qe,It=null;break}var sr=On-254;On>264&&(sr=io(ie,Qe,(1<<(Or=P1[Gt=On-257]))-1)+L1[Gt],Qe+=Or);var or=Tt[Hy(ie,Qe)&En],en=or>>4;if(or||no(3),Qe+=15&or,pn=lC[en],en>3){var Or=D1[en];pn+=Hy(ie,Qe)&(1<<Or)-1,Qe+=Or}if(Qe>zt){Oe&&no(0);break}Fe&&$e(Ne+131072);var oa=Ne+sr;if(Ne<pn){var Fs=0-pn,ro=Math.min(pn,oa);for(Fs+Ne<0&&no(3);Ne<ro;++Ne)pe[Ne]=(void 0)[Fs+Ne]}for(;Ne<oa;++Ne)pe[Ne]=pe[Ne-pn]}}ue.l=It,ue.p=dn,ue.b=Ne,ue.f=Xe,It&&(Xe=1,ue.m=et,ue.d=Tt,ue.n=jt)}while(!Xe);return Ne!=pe.length&&we?(ze=pe,((We=Ne)==null||We>ze.length)&&(We=ze.length),new ws(ze.subarray(0,We))):pe.subarray(0,Ne)}(X.subarray(ee,-8),{i:2},new ws(((V=X)[(j=V.length)-4]|V[j-3]<<8|V[j-2]<<16|V[j-1]<<24)>>>0))));var V,j,X,ee;const K=pC[O];if(!K)throw new Error(`Unhandled codec: ${O}`);const le=new globalThis.DecompressionStream(K);return new Response(new Blob([L]).stream().pipeThrough(le)).arrayBuffer().then(ie=>new Uint8Array(ie))}(A,S).then(L=>{const O=to.read(new eh(L));if(O.values==="uint32_values")return O.uint32_values.readValuesInto(C),new gC[p](C.buffer);throw new Error(`Unhandled numeric data "${O.values}"`)}),R.then(L=>{for(let O=w.length-1;O>=0;O--)switch(w[O]){case"delta_filter":iC(L,g);break;case"zigzag_filter":nC(L);break;case"bitshuffle_filter":rC(L,p);break;default:throw new Error(`Unhandled filter "${w[O]}"`)}return{layerName:s,blockIndex:v,data:L}}).catch(L=>{throw L})}))},St(B1,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const N1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const u=N1[15&s];if(!u)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Zy(g,p,u,e)}constructor(e,i=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=N1.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-g%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+g+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Qy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:g}=this,v=[0,u.length-1,0],w=[];for(;v.length;){const S=v.pop()||0,A=v.pop()||0,C=v.pop()||0;if(A-C<=g){for(let V=C;V<=A;V++){const j=p[2*V],X=p[2*V+1];j>=e&&j<=s&&X>=i&&X<=l&&w.push(u[V])}continue}const R=C+A>>1,L=p[2*R],O=p[2*R+1];L>=e&&L<=s&&O>=i&&O<=l&&w.push(u[R]),(S===0?e<=L:i<=O)&&(v.push(C),v.push(R-1),v.push(1-S)),(S===0?s>=L:l>=O)&&(v.push(R+1),v.push(A),v.push(1-S))}return w}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:u,nodeSize:p}=this,g=[0,l.length-1,0],v=[],w=s*s;for(;g.length;){const S=g.pop()||0,A=g.pop()||0,C=g.pop()||0;if(A-C<=p){for(let V=C;V<=A;V++)j1(u[2*V],u[2*V+1],e,i)<=w&&v.push(l[V]);continue}const R=C+A>>1,L=u[2*R],O=u[2*R+1];j1(L,O,e,i)<=w&&v.push(l[R]),(S===0?e-s<=L:i-s<=O)&&(g.push(C),g.push(R-1),g.push(1-S)),(S===0?e+s>=L:i+s>=O)&&(g.push(R+1),g.push(A),g.push(1-S))}return v}}function Qy(t,e,i,s,l,u){if(l-s<=i)return;const p=s+l>>1;V1(t,e,p,s,l,u),Qy(t,e,i,s,p-1,1-u),Qy(t,e,i,p+1,l,1-u)}function V1(t,e,i,s,l,u){for(;l>s;){if(l-s>600){const w=l-s+1,S=i-s+1,A=Math.log(w),C=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*C*(w-C)/w)*(S-w/2<0?-1:1);V1(t,e,i,Math.max(s,Math.floor(i-S*C/w+R)),Math.min(l,Math.floor(i+(w-S)*C/w+R)),u)}const p=e[2*i+u];let g=s,v=l;for(nf(t,e,s,i),e[2*l+u]>p&&nf(t,e,s,l);g<v;){for(nf(t,e,g,v),g++,v--;e[2*g+u]<p;)g++;for(;e[2*v+u]>p;)v--}e[2*s+u]===p?nf(t,e,s,v):(v++,nf(t,e,v,l)),v<=i&&(s=v+1),i<=v&&(l=v-1)}}function nf(t,e,i,s){Xy(t,i,s),Xy(e,2*i,2*s),Xy(e,2*i+1,2*s+1)}function Xy(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function j1(t,e,i,s){const l=t-i,u=e-s;return l*l+u*u}r.$=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,s]){const l=Tl([1,i,s]);return{x:l.x,y:l.y,z:l.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:ai(t.x,e.x,i),y:ai(t.y,e.y,i),z:ai(t.z,e.z,i)}}},r.A=je,r.B=wd,r.C=Rr,r.D=qp,r.E=Uo,r.F=function(t){const e=t.value;let i=[];if(!e)return i;const s=go(e);return s!=="string"?(i=i.concat([new $m(t.key,e,`string expected, "${s}" found`)]),i):(s1(e,!0)||(i=i.concat([new $m(t.key,e,`invalid url "${e}"`)])),i)},r.G=se,r.H=ye,r.I=Sy,r.J=me,r.K=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Tl(t.expression.evaluate(e))}interpolate(t,e,i){return{x:ai(t.x,e.x,i),y:ai(t.y,e.y,i),z:ai(t.z,e.z,i),azimuthal:ai(t.azimuthal,e.azimuthal,i),polar:ai(t.polar,e.polar,i)}}},r.L=ce,r.M=class{constructor(t,e,i,s){this.id=t,this.position=e!=null?new Ai(e[0],e[1]):new Ai(0,0),this.orientation=i??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.a9.multiply(t.matrix,e,t.matrix),t.meshes)for(const i of t.meshes){const s=un.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(s)}if(t.children)for(const i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){const t=r.a9.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,s,l,u,p=!1){l1(this.matrix,this,t.transform,this.position,e,i,s,l,u,p)}upload(t){if(!this.uploaded){for(const e of this.nodes)By(e,t);for(const e of this.nodes)qm(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)Ny(t)}},r.N=H,r.O=xr,r.P=ct,r.R=su,r.S=vl,r.T=Ly,r.U=Pe,r.V=$m,r.W=Ga,r.X=ai,r.Y=ut,r.Z=ic,r._=Ll,r.a=pu,r.a$=Rh,r.a0=function(t,e,i=0,s=!0){const l=new ct(i,i),u=t.sub(l),p=e.add(l),g=[u,new ct(p.x,u.y),p,new ct(u.x,p.y)];return s&&g.push(u.clone()),g},r.a1=function(t,e){const i=[];for(let s=0;s<t.length;s++){const l=Gs(s-1,-1,t.length-1),u=Gs(s+1,-1,t.length-1),p=t[s],g=t[u],v=t[l].sub(p).unit(),w=g.sub(p).unit(),S=w.angleWithSep(v.x,v.y),A=v.add(w).unit().mult(-1*e/Math.sin(S/2));i.push(p.add(A))}return i},r.a2=Ub,r.a3=iv,r.a4=function(t,e,i=0){return r.Q.fromValues(((e.x-i)*t.scale-t.x)*ut,(e.y*t.scale-t.y)*ut,Zx(e.z,e.y))},r.a5=ey,r.a6=ob,r.a7=function(t){let e=1/0,i=1/0,s=-1/0,l=-1/0;for(const u of t)e=Math.min(e,u.x),i=Math.min(i,u.y),s=Math.max(s,u.x),l=Math.max(l,u.y);return{min:new ct(e,i),max:new ct(s,l)}},r.a8=ja,r.aA=Ni,r.aB=ei,r.aC=Vp,r.aD=Og,r.aE=Cn,r.aF=zi,r.aG=Px,r.aH=Fm,r.aI=function(){oe.isLoading()||oe.isLoaded()||re()!=="deferred"||ne()},r.aJ=vt,r.aK=Ua,r.aL=w1,r.aM=Vr,r.aN=xy,r.aO=_y,r.aP=ia,r.aQ=ur,r.aR=Lg,r.aS=lv,r.aT=mm,r.aU=zy,r.aV=function(t,e){const i=Ga(e.zoom);if(i===0)return Mo(t);const s=lm(t),l=ry(s),u=ja(s.getWest())*e.worldSize,p=ja(s.getEast())*e.worldSize,g=ta(s.getNorth())*e.worldSize,v=ta(s.getSouth())*e.worldSize,w=[u,g,0],S=[p,g,0],A=[u,v,0],C=[p,v,0],R=r.a9.invert([],e.globeMatrix);return r.Q.transformMat4(w,w,R),r.Q.transformMat4(S,S,R),r.Q.transformMat4(A,A,R),r.Q.transformMat4(C,C,R),l[0]=na(l[0],A,i),l[1]=na(l[1],C,i),l[2]=na(l[2],S,i),l[3]=na(l[3],w,i),un.fromPoints(l)},r.aW=um,r.aX=Pd,r.aY=na,r.aZ=qn,r.a_=uE,r.ab=pc,r.ac=Yx,r.ad=mi,r.ae=Lr,r.af=function(t,e){const i={};for(let s=0;s<e.length;s++){const l=e[s];l in t&&(i[l]=t[l])}return i},r.ag=Va,r.ah=ta,r.ai=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,s){const l=this.entries[t]=this.entries[t]||{callbacks:[]};if(l.result){const[u,p]=l.result;return this.scheduler?this.scheduler.add(()=>{s(u,p)},e):s(u,p),()=>{}}return l.callbacks.push(s),l.cancel||(l.cancel=i((u,p)=>{l.result=[u,p];for(const g of l.callbacks)this.scheduler?this.scheduler.add(()=>{g(u,p)},e):g(u,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(u=>u!==s),l.callbacks.length||(l.cancel(),delete this.entries[t]))}}},r.aj=Xi,r.ak=function(t,e,i){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},l=>{const u=Al(t.request,(p,g,v,w)=>{p?l(p):g&&l(null,{vectorTile:i?void 0:new gy(new eh(g)),rawData:g,cacheControl:v,expires:w})});return()=>{u.cancel(),l()}},e)},r.al=function(t){Fh++,Fh>up&&(t.getActor().send("enforceCacheSizeLimit",nu),Fh=0)},r.am=Pr,r.an=eu,r.ao=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.ap=yr,r.aq=Yb,r.ar=Kb,r.as=Xb,r.at=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<t.length;s++){const l=document.createElement("source");Nh(t[s])||(i.crossOrigin="Anonymous"),l.src=t[s],i.appendChild(l)}return{cancel:()=>{}}},r.au=Nm,r.av=Ud,r.aw=Kr,r.ax=dr,r.ay=hr,r.az=Hn,r.b=mo,r.b$=ih,r.b0=F1,r.b1=Al,r.b2=function(t){const e=[];for(const i in t)e.push(t[i]);return e},r.b3=function(t,e){const i=[];for(const s in t)s in e||i.push(s);return i},r.b4=Ph,r.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.b6=function(t,e){const{x:i,y:s}=t.point,l=pv(i,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.a9.multiply(l,l,sy(Mo(e)))},r.b8=Yu,r.b9=bs,r.bA=qx,r.bB=function(t){const e=r.a9.identity(new Float64Array(16));r.a9.multiply(e,t.pixelMatrix,t.globeMatrix);const i=[0,ks,0],s=[0,Os,0];return r.Q.transformMat4(i,i,e),r.Q.transformMat4(s,s,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!ay(t,new Ai(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!ay(t,new Ai(t.center.lat,-90))]},r.bC=function(t,e){const{scale:i}=t.tileTransform,s=i*ut/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.b7.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},r.bD=Um,r.bE=Jb,r.bF=function(t){const e=Jb(t,!0);return r.b7.invert([],[e[0],e[1],e[4],e[5]])},r.bG=ty,r.bH=function(t){const{x:e,y:i}=t.point,{lng:s,lat:l}=t._center;return pv(e,i,t.worldSize,s,l)},r.bI=Er,r.bJ=Ug,r.bK=function(t){const e=Math.round((t+45+360)%360/90)%4;return sp[e]},r.bL=45,r.bM=qg,r.bN=Ed,r.bO=Fa,r.bP=Ng,r.bQ=zr,r.bR=tm,r.bS=Ux,r.bT=function(t,e,i){const s=Math.sqrt(t*t+e*e+i*i),l=s>0?Math.acos(i/s)*Ch:0;let u=t!==0||e!==0?Math.atan2(-e,-t)*Ch+90:0;return u<0&&(u+=360),[s,u,l]},r.bU=im,r.bV=un,r.bW=Tl,r.bX=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.bY=function(t){return t({pluginStatus:G,pluginURL:U}),Y.on("pluginStateChange",t),t},r.bZ=oh,r.b_=Wm,r.ba=Tm,r.bb=function(t,e,i,s,l){const u=5*e+2;t.float32[u+0]=i,t.float32[u+1]=s,t.float32[u+2]=l},r.bc=Om,r.bd=Db,r.be=Xg,r.bf=fr,r.bg=Iy,r.bh=Bb,r.bi=My,r.bj=Zy,r.bk=Gs,r.bm=Mi,r.bn=No,r.bo=kr,r.bp=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.bq=Ai,r.br=Hb,r.bs=Hx,r.bt=iy,r.bu=e1,r.bv=dc,r.bw=hv,r.bx=function(t,e,i,s,l,u,p,g,v){if(v.name==="globe")return hv(t,e,new dc(i,s,l),!1);const w=Ud({z:i,x:s,y:l},v);return new un([(u+w.x/w.scale)*e,e*(w.y/w.scale),p],[(u+w.x2/w.scale)*e,e*(w.y2/w.scale),g])},r.by=function(t,e,i){let s=0;for(let l=0;l<2;++l)t[l]>0&&(s+=(t[l]-0)*(t[l]-0)),e[l]<0&&(s+=(0-e[l])*(0-e[l]));return s},r.bz=Pn,r.c=v1,r.c$=[1,1,1],r.c0=Ey,r.c1=ya,r.c2=$,r.c3=fe,r.c4=iu,r.c5=Dl,r.c6=$s,r.c7=function(t,e,i){return t.type==="custom"?new wI(t,e):new eC[t.type](t,e,i)},r.c8=function(t){const e=t.indexOf(In);return e>=0?t.slice(0,e):t},r.c9=function(t){return t.indexOf(In)>=0},r.cA=t=>({u_matrix:new Ed(t),u_pixels_to_tile_units:new Vg(t),u_device_pixel_ratio:new zr(t),u_units_to_pixels:new Fa(t),u_dash_image:new tm(t),u_gradient_image:new tm(t),u_image_height:new zr(t),u_texsize:new Fa(t),u_tile_units_to_pixels:new zr(t),u_alpha_discard_threshold:new zr(t),u_trim_offset:new Fa(t),u_emissive_strength:new zr(t)}),r.cB=t=>({u_matrix:new Ed(t),u_texsize:new Fa(t),u_pixels_to_tile_units:new Vg(t),u_device_pixel_ratio:new zr(t),u_image:new tm(t),u_units_to_pixels:new Fa(t),u_tile_units_to_pixels:new zr(t),u_alpha_discard_threshold:new zr(t),u_trim_offset:new Fa(t)}),r.cC=oc,r.cD=IA,r.cE=CA,r.cF=gv,r.cG=(t,e,i,s,l,u)=>{const p=t.transform,g=p.projection.name==="globe";let v;if(u.paint.get("circle-pitch-alignment")==="map")if(g){const S=fv(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;v=Float32Array.from([S,0,0,S])}else v=p.calculatePixelsToTileUnitsMatrix(i);else v=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const w={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Is.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:mE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(g){w.u_inv_rot_matrix=s,w.u_merc_center=l,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Ga(p.zoom);const S=l[0]*ut,A=l[1]*ut;w.u_up_dir=p.projection.upVector(new dc(0,0,0),S,A)}return w},r.cH=cb,r.cI=(t,e,i,s,l,u)=>{const p=t.transform;return{u_matrix:lb(t,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:ab(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u}},r.cJ=(t,e,i,s,l,u,p)=>{const g=t.transform,v=g.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:lb(t,e,i,s),u_pixels_to_tile_units:v,u_device_pixel_ratio:u,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:ub(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ab(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:i.paint.get("line-emissive-strength")}},r.cK=Dh,r.cL=Dd,r.cM=eb,r.cN=KS,r.cO=wm,r.cP=Wa,r.cQ=450,r.cR=7,r.cS=xI,r.cT=256,r.cU=sy,r.cV=cc,r.cW=lc,r.cX=Rg,r.cY=function(t,e,i,s,l){return mi((t-e)/(i-e)*(l-s)+s,s,l)},r.cZ=fc,r.c_=Oy,r.ca=function(t){const e=t.indexOf(In);return e>=0?t.slice(e+1):""},r.cb=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cc=bl,r.cd=Y,r.ce=El,r.cf=Gx,r.cg=class extends Jo{constructor(t){super(t),this.current=$S}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.ch=Zc,r.ci=function(t,e,i){const s=Ga(i.zoom),l=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return s===0&&!l&&!u},r.cj=function(t){const e=t.pixelsPerMeter,i=e/kr(1,t.center.lat),s=r.a9.identity(new Float64Array(16));return r.a9.translate(s,s,[t.point.x,t.point.y,0]),r.a9.scale(s,s,[i,i,e]),Float32Array.from(s)},r.ck=lm,r.cl=function(t){const e=Pn-5;t=mi(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Mi(t))),3);return Math.round(i*(Gg.length-1))},r.cm=function(t,e,i,s){const l=e.getNorth(),u=e.getSouth(),p=e.getWest(),g=e.getEast(),v=1<<t.z,w=g-p,S=l-u,A=w/Uu,C=-S/Gg[i],R=[0,A,0,C,0,0,l,p,0];if(t.z>0){const L=180/s;r.ct.multiply(R,R,[L/w+1,0,0,0,L/S+1,0,-.5*L/A,.5*L/C,1])}return R[2]=v,R[5]=t.x,R[8]=t.y,R},r.cn=Mo,r.co=function(t,e,i){const s=r.a9.identity(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return r.a9.rotateY(s,i.globeMatrix,l),Float32Array.from(s)},r.cp=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,l=Math.floor(t.x),u=Math.floor((t.x-l)*s),p=Math.floor(t.y*s),g=this.findDEMTileFor(new yr(i,l,i,u,p));return!(!g||!g.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const l=s.getSource().maxzoom,u=1<<l,p=Math.floor(t.x),g=t.x-p,v=new yr(l,p,l,Math.floor(g*u),Math.floor(t.y*u)),w=this.findDEMTileFor(v);if(!w||!w.dem)return e;const S=w.dem,A=1<<w.tileID.canonical.z,C=(g*A-w.tileID.canonical.x)*S.dim,R=(t.y*A-w.tileID.canonical.y)*S.dim,L=Math.floor(C),O=Math.floor(R);return(i?this.exaggeration():1)*ai(ai(S.get(L,O),S.get(L,O+1),R-O),ai(S.get(L+1,O),S.get(L+1,O+1),R-O),C-L)}getAtTileOffset(t,e,i){const s=1<<t.canonical.z;return this.getAtPointOrZero(new xr(t.wrap+(t.canonical.x+e/ut)/s,(t.canonical.y+i/ut)/s))}getAtTileOffsetFunc(t,e,i,s){return l=>{const u=this.getAtTileOffset(t,l.x,l.y),p=s.upVector(t.canonical,l.x,l.y),g=s.upVectorScale(t.canonical,e,i).metersToTile;return r.Q.scale(p,p,u*g),p}}getForTilePoints(t,e,i,s){if(this.isUsingMockSource())return!1;const l=Qu.create(this,t,s);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,l=1<<t.canonical.z-s.canonical.z;let u=t.canonical.x/l-s.canonical.x,p=t.canonical.y/l-s.canonical.y,g=0;for(let v=0;v<t.canonical.z-s.canonical.z&&!i.leaves[g];v++){u*=2,p*=2;const w=2*Math.floor(p)+Math.floor(u);g=i.childOffsets[g]+w,u%=1,p%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const l of t){const u=this.getMinMaxForTile(l.tileID);u&&(i=Math.min(i,u.min),s=Math.max(s,u.max),e=!0)}return e?{min:i,max:s}:null}},r.cq=am,r.cr=Tv,r.cs=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.cu=fv,r.cv=cp,r.cw=fs,r.cx=256,r.cy=function(t,e){const i=[0,0,0],s=um(Mo(e.canonical));return r.Q.transformMat4(i,i,s),r.Q.transformMat4(i,i,t),i},r.cz=t=>({u_camera_to_center_distance:new zr(t),u_extrude_scale:new Vg(t),u_device_pixel_ratio:new zr(t),u_matrix:new Ed(t),u_inv_rot_matrix:new Ed(t),u_merc_center:new Fa(t),u_tile_id:new Ng(t),u_zoom_transition:new zr(t),u_up_dir:new Ng(t),u_emissive_strength:new zr(t)}),r.d=Vh,r.d$=c1,r.d0=Qu,r.d1=sh,r.d2=Yr,r.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=zv(new ct(0,0),new ct(ut,ut),t),i=[];for(const s of this._activeRegions){if(s.hiddenByOverlap||!Rv(e,s))continue;const l=XE(s.min,s.max,t);i.push({min:l.min,max:l.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(s).buckets[e.layer];if(l)for(const u of l.getNodesInfo()){const p=u.node;p.footprint&&i.push({footprint:p.footprint,id:s.toUnwrapped()})}}return i}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const i of e){if(!i.footprint)continue;const s=zv(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:s.min,max:s.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||xm(e.min,i.min)||xm(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){const s=this._activeRegions[e],l=this._prevRegions[i];t=s.priority!==l.priority||!Dv(s,l),++e,++i}}if(t){++this._updateTime;const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const l=s[i].priority;for(;i<s.length&&s[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let l=i;const u=i;for(;l!==s;){const p=this._activeRegions[l];p.hiddenByOverlap=!1;for(let g=0;g<u;g++){const v=this._activeRegions[g];if(!v.hiddenByOverlap&&Rv(p,v)&&(p.hiddenByOverlap=kv(p.footprint,p.tileId,v.footprint,v.tileId),p.hiddenByOverlap))break}++l}i=s,s=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.d4=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new ur,s=new Hn,l=[],u=t+1+2,p=e[0]+1,g=e[0]+1+(1+e.length),v=(w,S,A)=>{let C=w===u-1?w-2:w===0?w:w-1;return C+=A?24575:0,[C,S]};for(let w=0;w<u;++w)i.emplaceBack(...v(w,0,!0));for(let w=0;w<p;++w)for(let S=0;S<u;++S)i.emplaceBack(...v(S,w,(S===0||S===u-1)&&!0));for(let w=0;w<e.length;++w){const S=e[w];for(let A=0;A<u;++A)i.emplaceBack(...v(A,S,!0))}for(let w=0;w<e.length;++w){const S=s.length,A=e[w]+1+2,C=new Hn;for(let O=0;O<A-1;O++){const V=O===A-2,j=V?u*(g-e.length+w-O):u;for(let X=0;X<u-1;X++){const ee=O*u+X;O===0||V||X===0||X===u-2?(C.emplaceBack(ee+1,ee,ee+j),C.emplaceBack(ee+j,ee+j+1,ee+1)):(s.emplaceBack(ee+1,ee,ee+j),s.emplaceBack(ee+j,ee+j+1,ee+1))}}const R=Cn.simpleSegment(0,S,i.length,s.length-S);for(let O=0;O<C.uint16.length;O+=3)s.emplaceBack(C.uint16[O],C.uint16[O+1],C.uint16[O+2]);const L=Cn.simpleSegment(0,S,i.length,s.length-S);l.push({withoutSkirts:R,withSkirts:L})}return{vertices:i,indices:s,segments:l}}_createGrid(t){const e=this._fillGridMeshWithLods(Uu,Gg);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,lv.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Hn;for(let p=0;p<=Uu;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new lc,s=new lc,l=new lc,u=new lc;this._poleSegments=[];for(let p=0,g=0;p<Ug;p++){const v=360/(1<<p);i.emplaceBack(0,-Lr,0,.5,0),s.emplaceBack(0,-Lr,0,.5,1),l.emplaceBack(0,-Lr,0,.5,.5),u.emplaceBack(0,-Lr,0,.5,.5);for(let w=0;w<=Uu;w++){let S=w/Uu,A=0;const C=ai(0,v,S),[R,L,O]=Gu(fE,pE,C,Lr);i.emplaceBack(R,L,O,S,A),s.emplaceBack(R,L,O,S,1-A);const V=Mi(C);S=.5+.5*Math.sin(V),A=.5+.5*Math.cos(V),l.emplaceBack(R,L,O,S,A),u.emplaceBack(R,L,O,S,1-A)}this._poleSegments.push(Cn.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,om,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,om,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,om,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,om,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.d5=function(t){return du.has(t)},r.d6=op,r.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d8=ds,r.d9=Xx,r.dA=Qd,r.dB=function(t){const e=Oh();if(!e)return;const i=e.delete(ma);t&&i.catch(t).then(()=>t())},r.dC=Zd,r.dD=u1,r.dE=function(t){jy=Is.resolveURL(t),lh||(lh=new oh(Wm(),new Uo)),lh.broadcast("setDracoUrl",jy)},r.dF=h1,r.dG=function(t){ah=Is.resolveURL(t),lh||(lh=new oh(Wm(),new Uo)),lh.broadcast("setMeshoptUrl",ah)},r.dH=St,r.dI=$a,r.dJ=Js,r.dK=b1,r.dL=T1,r.dM=rb,r.dN=fa,r.dO=zb,r.dP=function(t,e,i,s,l,u,p,g,v,w,S){t.createArrays(),t.tilePixelRatio=ut/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=t.textSizeData;R.compositeTextSizes=[C["text-size"].possiblyEvaluate(new H(j),g),C["text-size"].possiblyEvaluate(new H(X),g)]}if(t.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=t.iconSizeData;R.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new H(j),g),C["icon-size"].possiblyEvaluate(new H(X),g)]}R.layoutTextSize=C["text-size"].possiblyEvaluate(new H(v+1),g),R.layoutIconSize=C["icon-size"].possiblyEvaluate(new H(v+1),g),R.textMaxSize=C["text-size"].possiblyEvaluate(new H(18),g);const L=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",O=A.get("text-size");let V=!1;for(const j of t.features)if(j.icon&&j.icon.nameSecondary){V=!0;break}for(const j of t.features){const X=A.get("text-font").evaluate(j,{},g).join(","),ee=O.evaluate(j,{},g),K=R.layoutTextSize.evaluate(j,{},g),le=(R.layoutIconSize.evaluate(j,{},g),{horizontal:{},vertical:void 0}),ie=j.text;let ue,pe=[0,0];if(ie){const we=ie.toString(),Fe=A.get("text-letter-spacing").evaluate(j,{},g)*fr,Oe=A.get("text-line-height").evaluate(j,{},g)*fr,ze=f(we)?Fe:0,We=A.get("text-anchor").evaluate(j,{},g),$e=A.get("text-variable-anchor");if(!$e){const Tt=A.get("text-radial-offset").evaluate(j,{},g);pe=Tt?Bb(We,[Tt*fr,Ay]):A.get("text-offset").evaluate(j,{},g).map(et=>et*fr)}let Xe=L?"center":A.get("text-justify").evaluate(j,{},g);const Qe=A.get("symbol-placement")==="point",Ne=Qe?A.get("text-max-width").evaluate(j,{},g)*fr:1/0,It=Tt=>{t.allowVerticalPlacement&&o(we)&&(le.vertical=Ty(ie,e,i,l,X,Ne,Oe,We,Tt,ze,pe,bs.vertical,!0,K,ee))};if(!L&&$e){const Tt=Xe==="auto"?$e.map(jt=>Iy(jt)):[Xe];let et=!1;for(let jt=0;jt<Tt.length;jt++){const zt=Tt[jt];if(!le.horizontal[zt])if(et)le.horizontal[zt]=le.horizontal[0];else{const Ct=Ty(ie,e,i,l,X,Ne,Oe,"center",zt,ze,pe,bs.horizontal,!1,K,ee);Ct&&(le.horizontal[zt]=Ct,et=Ct.positionedLines.length===1)}}It("left")}else{if(Xe==="auto"&&(Xe=Iy(We)),Qe||A.get("text-writing-mode").indexOf("horizontal")>=0||!o(we)){const Tt=Ty(ie,e,i,l,X,Ne,Oe,We,Xe,ze,pe,bs.horizontal,!1,K,ee);Tt&&(le.horizontal[Xe]=Tt)}It(Qe?"left":Xe)}}let ve=!1;if(j.icon&&j.icon.namePrimary){const we=s[j.icon.namePrimary];we&&(ue=ZA(l[j.icon.namePrimary],j.icon.nameSecondary?l[j.icon.nameSecondary]:void 0,A.get("icon-offset").evaluate(j,{},g),A.get("icon-anchor").evaluate(j,{},g)),ve=we.sdf,t.sdfIcons===void 0?t.sdfIcons=we.sdf:t.sdfIcons!==we.sdf&&gn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Re=Vb(le.horizontal)||le.vertical;t.iconsInText||(t.iconsInText=!!Re&&Re.iconsInText),(Re||ue)&&tI(t,j,le,ue,s,R,K,0,pe,ve,p,g,w,S,V)}u&&t.generateCollisionDebugBuffers(v,t.collisionBoxArray)},r.dQ=gy,r.dR=eh,r.dS=vm,r.dT=gm,r.dU=_m,r.dV=Hc,r.dW=pb,r.dX=dt,r.dY=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==f1){const i=new Uint32Array(t,0,7),[,,s,l,u,p]=i;e=i.byteLength+l+u+p+u,(s!==t.byteLength||e>=t.byteLength)&&gn("Invalid b3dm header information.")}return g1(t,e)},r.dZ=function(t,e){const i=v1(t);for(const s of i){for(const l of s.meshes)ZI(l);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(QI(s.lights,e)))}return i},r.d_=Xm,r.da=hc,r.db=function([t,e,i]){const s=Math.hypot(t,e,i),l=Math.atan2(t,i),u=.5*Math.PI-Math.acos(-e/s);return new Ai(Er(l),Er(u))},r.dc=$u,r.dd=Z,r.de=ay,r.df=mv,r.dg=function(t){const e=[0,0,0],i=r.a9.identity(new Float64Array(16));return r.a9.multiply(i,t.pixelMatrix,t.globeMatrix),r.Q.transformMat4(e,e,i),new ct(e[0],e[1])},r.dh=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(Jc==null){const s=i.navigator?i.navigator.userAgent:null;Jc=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Jc}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.di=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Cl,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!fe(t))return t;const i=ps(t);return i.params.push(`sdk=js-${B}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!fe(t))return t;const i=ps(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!fe(t))return t;const i=ps(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,s){if(!fe(t))return t;const l=ps(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),i&&l.params.push(`language=${i}`),s&&l.params.push(`worldview=${s}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,s){const l=ps(t);return fe(t)?(l.path=`/styles/v1${l.path}/sprite${e}${i}`,this._makeAPIURL(l,this._customAccessToken||s)):(l.path+=`${e}${i}`,xa(l))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!fe(t))return t;const s=ps(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&s.authority!=="raster"&&i===512?"@2x":""}${jo.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${Z.RASTER_URL_PREFIX}${s.path}`:s.authority==="rasterarrays"?s.path=`/${Z.RASTERARRAYS_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Z.TILE_URL_VERSION}${s.path}`);const l=this._customAccessToken||function(u){for(const p of u){const g=p.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(s.params)||Z.ACCESS_TOKEN;return Z.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,l)}canonicalizeTileURL(t,e){const i=ps(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${Z.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${i.path.replace(`/${Z.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${Z.TILE_URL_VERSION}/`,"")}`;let l=i.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(s+=`?${l.join("&")}`),s}canonicalizeTileset(t,e){const i=!!e&&fe(e),s=[];for(const l of t.tiles||[])ae(l)?s.push(this.canonicalizeTileURL(l,i)):s.push(l);return s}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=ps(Z.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,t.protocol==="http"){const l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(s.path!=="/"&&(t.path=`${s.path}${t.path}`),!Z.REQUIRE_ACCESS_TOKEN)return xa(t);if(e=e||Z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),xa(t)}},r.dj=function(t,e){e?du.add(t):du.delete(t)},r.dk=jo,r.dl=uu,r.dm=Gh,r.dn=lu,r.dp=Dr,r.dq=fg,r.dr=function(t){du.delete(t)},r.ds=hu,r.dt=po,r.du=B,r.dv=function(t,e){nu=t,up=e},r.dw=function(t,e,i=!1){if(G===z||G===k||G===F)throw new Error("setRTLTextPlugin cannot be called multiple times.");U=Is.resolveURL(t),G=z,N=e,q(),i||ne()},r.dx=re,r.dy=function(){Wm().acquire(Vy)},r.dz=function(){const t=Xd;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Vy),Xd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.e=Qr,r.e0=oe,r.e1=function(t){_a(),Ws&&Ws.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-t;s++)e.delete(i[s])})})},r.f=Is,r.g=function(t,e){return El(Qr(t,{type:"json"}),e)},r.h=vs,r.i=class extends $m{},r.j=go,r.k=gu,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>g1(e,0,t))},r.m=Ou,r.n=Wp,r.o=Bu,r.p=Rb,r.q=Ie,r.r=Qp,r.s=za,r.t=La,r.u=Se,r.v=Wl,r.w=gn,r.x=Zl,r.y=vo}),E(["./shared"],function(r){function B(Me){const Q=Me?Me.url.toString():void 0;return Q?performance.getEntriesByName(Q):[]}function W(Me){if(typeof Me=="number"||typeof Me=="boolean"||typeof Me=="string"||Me==null)return JSON.stringify(Me);if(Array.isArray(Me)){let te="[";for(const de of Me)te+=`${W(de)},`;return`${te}]`}let Q="{";for(const te of Object.keys(Me).sort())Q+=`${te}:${W(Me[te])},`;return`${Q}}`}function Z(Me){let Q="";for(const te of r.b5)Q+=`/${W(Me[te])}`;return Q}class ae{constructor(Q){this.keyCache={},this._layers={},this._layerConfigs={},Q&&this.replace(Q)}replace(Q,te){this._layerConfigs={},this._layers={},this.update(Q,[],te)}update(Q,te,de){this._options=de;for(const ke of Q)this._layerConfigs[ke.id]=ke,(this._layers[ke.id]=r.c7(ke,this.scope,this._options)).compileFilter(),this.keyCache[ke.id]&&delete this.keyCache[ke.id];for(const ke of te)delete this.keyCache[ke],delete this._layerConfigs[ke],delete this._layers[ke];this.familiesBySource={};const Ce=function(ke,He){const xt={};for(let bt=0;bt<ke.length;bt++){const Et=He&&He[ke[bt].id]||Z(ke[bt]);He&&(He[ke[bt].id]=Et);let Rt=xt[Et];Rt||(Rt=xt[Et]=[]),Rt.push(ke[bt])}const Be=[];for(const bt in xt)Be.push(xt[bt]);return Be}(r.b2(this._layerConfigs),this.keyCache);for(const ke of Ce){const He=ke.map(_t=>this._layers[_t.id]),xt=He[0];if(xt.visibility==="none")continue;const Be=xt.source||"";let bt=this.familiesBySource[Be];bt||(bt=this.familiesBySource[Be]={});const Et=xt.sourceLayer||"_geojsonTileLayer";let Rt=bt[Et];Rt||(Rt=bt[Et]=[]),Rt.push(He)}}}const fe=1*r.dJ;class Le{constructor(Q){const te={},de=[];for(const xt in Q){const Be=Q[xt],bt=te[xt]={};for(const Et in Be.glyphs){const Rt=Be.glyphs[+Et];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const _t=Rt.metrics.localGlyph?fe:1,fi={x:0,y:0,w:Rt.bitmap.width+2*_t,h:Rt.bitmap.height+2*_t};de.push(fi),bt[Et]=fi}}const{w:Ce,h:ke}=r.p(de),He=new r.dI({width:Ce||1,height:ke||1});for(const xt in Q){const Be=Q[xt];for(const bt in Be.glyphs){const Et=Be.glyphs[+bt];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;const Rt=te[xt][bt],_t=Et.metrics.localGlyph?fe:1;r.dI.copy(Et.bitmap,He,{x:0,y:0},{x:Rt.x+_t,y:Rt.y+_t},Et.bitmap)}}this.image=He,this.positions=te}}r.dH(Le,"GlyphAtlas");class De{constructor(Q){this.tileID=new r.ap(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.scope=Q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.promoteId=Q.promoteId,this.isSymbolTile=Q.isSymbolTile,this.tileTransform=r.av(Q.tileID.canonical,Q.projection),this.projection=Q.projection,this.brightness=Q.brightness,this.extraShadowCaster=!!Q.extraShadowCaster}parse(Q,te,de,Ce,ke){this.status="parsing",this.data=Q,this.collisionBoxArray=new r.aG;const He=new r.dK(Object.keys(Q.layers).sort()),xt=new r.dL(this.tileID,this.promoteId);xt.bucketLayerIDs=[];const Be={},bt=new r.dM(256,256),Et={featureIndex:xt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:bt,availableImages:de,brightness:this.brightness},Rt=te.familiesBySource[this.source];for(const Zi in Rt){const fn=Q.layers[Zi];if(!fn)continue;let Xn=!1,sn=!1,Tr=!1;for(const zn of Rt[Zi])zn[0].type==="symbol"?Xn=!0:sn=!0,zn[0].is3D()&&zn[0].type!=="model"&&(Tr=!0);if(this.extraShadowCaster&&!Tr||this.isSymbolTile===!0&&!Xn||this.isSymbolTile===!1&&!sn)continue;fn.version===1&&r.w(`Vector tile source "${this.source}" layer "${Zi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _r=He.encode(Zi),cs=[];for(let zn=0;zn<fn.length;zn++){const mn=fn.feature(zn),Ue=xt.getId(mn,Zi);cs.push({feature:mn,id:Ue,index:zn,sourceLayerIndex:_r})}for(const zn of Rt[Zi]){const mn=zn[0];(!this.extraShadowCaster||mn.is3D()&&mn.type!=="model")&&(this.isSymbolTile!==void 0&&mn.type==="symbol"!==this.isSymbolTile||mn.minzoom&&this.zoom<Math.floor(mn.minzoom)||mn.maxzoom&&this.zoom>=mn.maxzoom||mn.visibility!=="none"&&(Ve(zn,this.zoom,Et.brightness,de),(Be[mn.id]=mn.createBucket({index:xt.bucketLayerIDs.length,layers:zn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_r,sourceID:this.source,projection:this.projection.spec})).populate(cs,Et,this.tileID.canonical,this.tileTransform),xt.bucketLayerIDs.push(zn.map(Ue=>Ue.id))))}}let _t,fi,li,Bi;bt.trim();const Oi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Fi=()=>{if(_t)return this.status="done",ke(_t);if(this.extraShadowCaster)this.status="done",ke(null,{buckets:r.b2(Be).filter(Zi=>!Zi.isEmpty()),featureIndex:xt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Et.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(fi&&li&&Bi){const Zi=new Le(fi),fn=new r.dO(li,Bi);for(const Xn in Be){const sn=Be[Xn];sn instanceof r.aH?(Ve(sn.layers,this.zoom,Et.brightness,de),r.dP(sn,fi,Zi.positions,li,fn.iconPositions,this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):sn.hasPattern&&(sn instanceof r.aN||sn instanceof r.aO||sn instanceof r.cO)&&(Ve(sn.layers,this.zoom,Et.brightness,de),sn.addFeatures(Et,this.tileID.canonical,fn.patternPositions,de,this.tileTransform,this.brightness))}this.status="done",ke(null,{buckets:r.b2(Be).filter(Xn=>!Xn.isEmpty()),featureIndex:xt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zi.image,lineAtlas:bt,imageAtlas:fn,brightness:Et.brightness})}};if(!this.extraShadowCaster){const Zi=r.dN(Et.glyphDependencies,sn=>Object.keys(sn).map(Number));Object.keys(Zi).length?Ce.send("getGlyphs",{uid:this.uid,stacks:Zi,scope:this.scope},(sn,Tr)=>{_t||(_t=sn,fi=Tr,Fi())},void 0,!1,Oi):fi={};const fn=Object.keys(Et.iconDependencies);fn.length?Ce.send("getImages",{icons:fn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(sn,Tr)=>{_t||(_t=sn,li=Tr,Fi())},void 0,!1,Oi):li={};const Xn=Object.keys(Et.patternDependencies);Xn.length?Ce.send("getImages",{icons:Xn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(sn,Tr)=>{_t||(_t=sn,Bi=Tr,Fi())},void 0,!1,Oi):Bi={}}Fi()}}function Ve(Me,Q,te,de){const Ce=new r.N(Q,{brightness:te});for(const ke of Me)ke.recalculate(Ce,de)}class Ye extends r.E{constructor(Q,te,de,Ce,ke,He){super(),this.actor=Q,this.layerIndex=te,this.availableImages=de,this.loadVectorData=ke||r.ak,this.loading={},this.loaded={},this.deduped=new r.ai(Q.scheduler),this.isSpriteLoaded=Ce,this.scheduler=Q.scheduler,this.brightness=He}loadTile(Q,te){const de=Q.uid,Ce=Q&&Q.request,ke=Ce&&Ce.collectResourceTiming,He=this.loading[de]=new De(Q);He.abort=this.loadVectorData(Q,(xt,Be)=>{const bt=!this.loading[de];if(delete this.loading[de],bt||xt||!Be)return He.status="done",bt||(this.loaded[de]=He),te(xt);const Et=Be.rawData,Rt={};Be.expires&&(Rt.expires=Be.expires),Be.cacheControl&&(Rt.cacheControl=Be.cacheControl),He.vectorTile=Be.vectorTile||new r.dQ(new r.dR(Et));const _t=()=>{He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor,(fi,li)=>{if(fi||!li)return te(fi);const Bi={};if(ke){const Oi=B(Ce);Oi.length>0&&(Bi.resourceTiming=JSON.parse(JSON.stringify(Oi)))}te(null,r.e({rawTileData:Et.slice(0)},li,Rt,Bi))})};this.isSpriteLoaded?_t():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_t,{type:"parseTile",isSymbolTile:Q.isSymbolTile,zoom:Q.tileZoom}):_t()}),this.loaded=this.loaded||{},this.loaded[de]=He})}reloadTile(Q,te){const de=this.loaded,Ce=Q.uid,ke=this;if(de&&de[Ce]){const He=de[Ce];He.showCollisionBoxes=Q.showCollisionBoxes,He.projection=Q.projection,He.brightness=Q.brightness,He.tileTransform=r.av(Q.tileID.canonical,Q.projection),He.extraShadowCaster=Q.extraShadowCaster;const xt=(Be,bt)=>{const Et=He.reloadCallback;Et&&(delete He.reloadCallback,He.parse(He.vectorTile,ke.layerIndex,this.availableImages,ke.actor,Et)),te(Be,bt)};He.status==="parsing"?He.reloadCallback=xt:He.status==="done"&&(He.vectorTile?He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor,xt):xt())}else te(null,void 0)}abortTile(Q,te){const de=Q.uid,Ce=this.loading[de];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[de]),te()}removeTile(Q,te){const de=this.loaded,Ce=Q.uid;de&&de[Ce]&&delete de[Ce],te()}}class lt{loadTile(Q,te){const{uid:de,encoding:Ce,rawImageData:ke,padding:He}=Q,xt=ImageBitmap&&ke instanceof ImageBitmap?this.getImageData(ke,He):ke;te(null,new r.dS(de,xt,Ce,He<1))}getImageData(Q,te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);const de=this.offscreenCanvasContext.getImageData(-te,-te,Q.width+2*te,Q.height+2*te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}class dt{decodeRasterArray({task:Q,buffer:te},de){r.b0.performDecoding(te,Q).then(Ce=>{de(null,Ce)},Ce=>{de(Ce)})}}const gt=r.dT.prototype.toGeoJSON;let yt=class{constructor(Me){this._feature=Me,this.extent=r.Y,this.type=Me.type,this.properties=Me.tags,"id"in Me&&!isNaN(Me.id)&&(this.id=parseInt(Me.id,10))}loadGeometry(){if(this._feature.type===1){const Me=[];for(const Q of this._feature.geometry)Me.push([new r.P(Q[0],Q[1])]);return Me}{const Me=[];for(const Q of this._feature.geometry){const te=[];for(const de of Q)te.push(new r.P(de[0],de[1]));Me.push(te)}return Me}}toGeoJSON(Me,Q,te){return gt.call(this,Me,Q,te)}},Ut=class{constructor(Me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.Y,this.length=Me.length,this._features=Me}feature(Me){return new yt(this._features[Me])}};var Yt={exports:{}},wi=r.dV,Gi=r.dU.VectorTileFeature,Qt=tn;function tn(Me,Q){this.options=Q||{},this.features=Me,this.length=Me.length}function Ui(Me,Q){this.id=typeof Me.id=="number"?Me.id:void 0,this.type=Me.type,this.rawGeometry=Me.type===1?[Me.geometry]:Me.geometry,this.properties=Me.tags,this.extent=Q||4096}tn.prototype.feature=function(Me){return new Ui(this.features[Me],this.options.extent)},Ui.prototype.loadGeometry=function(){var Me=this.rawGeometry;this.geometry=[];for(var Q=0;Q<Me.length;Q++){for(var te=Me[Q],de=[],Ce=0;Ce<te.length;Ce++)de.push(new wi(te[Ce][0],te[Ce][1]));this.geometry.push(de)}return this.geometry},Ui.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Me=this.geometry,Q=1/0,te=-1/0,de=1/0,Ce=-1/0,ke=0;ke<Me.length;ke++)for(var He=Me[ke],xt=0;xt<He.length;xt++){var Be=He[xt];Q=Math.min(Q,Be.x),te=Math.max(te,Be.x),de=Math.min(de,Be.y),Ce=Math.max(Ce,Be.y)}return[Q,de,te,Ce]},Ui.prototype.toGeoJSON=Gi.prototype.toGeoJSON;var Un=r.dW,er=Qt;function Ri(Me){var Q=new Un;return function(te,de){for(var Ce in te.layers)de.writeMessage(3,qt,te.layers[Ce])}(Me,Q),Q.finish()}function qt(Me,Q){var te;Q.writeVarintField(15,Me.version||1),Q.writeStringField(1,Me.name||""),Q.writeVarintField(5,Me.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<Me.length;te++)de.feature=Me.feature(te),Q.writeMessage(2,Ci,de);var Ce=de.keys;for(te=0;te<Ce.length;te++)Q.writeStringField(3,Ce[te]);var ke=de.values;for(te=0;te<ke.length;te++)Q.writeMessage(4,Kt,ke[te])}function Ci(Me,Q){var te=Me.feature;te.id!==void 0&&Q.writeVarintField(1,te.id),Q.writeMessage(2,Ti,Me),Q.writeVarintField(3,te.type),Q.writeMessage(4,Gn,te)}function Ti(Me,Q){var te=Me.feature,de=Me.keys,Ce=Me.values,ke=Me.keycache,He=Me.valuecache;for(var xt in te.properties){var Be=te.properties[xt],bt=ke[xt];if(Be!==null){bt===void 0&&(de.push(xt),ke[xt]=bt=de.length-1),Q.writeVarint(bt);var Et=typeof Be;Et!=="string"&&Et!=="boolean"&&Et!=="number"&&(Be=JSON.stringify(Be));var Rt=Et+":"+Be,_t=He[Rt];_t===void 0&&(Ce.push(Be),He[Rt]=_t=Ce.length-1),Q.writeVarint(_t)}}}function Tn(Me,Q){return(Q<<3)+(7&Me)}function tr(Me){return Me<<1^Me>>31}function Gn(Me,Q){for(var te=Me.loadGeometry(),de=Me.type,Ce=0,ke=0,He=te.length,xt=0;xt<He;xt++){var Be=te[xt],bt=1;de===1&&(bt=Be.length),Q.writeVarint(Tn(1,bt));for(var Et=de===3?Be.length-1:Be.length,Rt=0;Rt<Et;Rt++){Rt===1&&de!==1&&Q.writeVarint(Tn(2,Et-1));var _t=Be[Rt].x-Ce,fi=Be[Rt].y-ke;Q.writeVarint(tr(_t)),Q.writeVarint(tr(fi)),Ce+=_t,ke+=fi}de===3&&Q.writeVarint(Tn(7,1))}}function Kt(Me,Q){var te=typeof Me;te==="string"?Q.writeStringField(1,Me):te==="boolean"?Q.writeBooleanField(7,Me):te==="number"&&(Me%1!=0?Q.writeDoubleField(3,Me):Me<0?Q.writeSVarintField(6,Me):Q.writeVarintField(5,Me))}Yt.exports=Ri,Yt.exports.fromVectorTileJs=Ri,Yt.exports.fromGeojsonVt=function(Me,Q){Q=Q||{};var te={};for(var de in Me)te[de]=new er(Me[de].features,Q),te[de].name=de,te[de].version=Q.version,te[de].extent=Q.extent;return Ri({layers:te})},Yt.exports.GeoJSONWrapper=er;var wr=r.dX(Yt.exports);const vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Me=>Me},Cr=Math.fround||(Mn=new Float32Array(1),Me=>(Mn[0]=+Me,Mn[0]));var Mn;const ar=3,Nt=5,Es=6;class Wi{constructor(Q){this.options=Object.assign(Object.create(vn),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:te,minZoom:de,maxZoom:Ce}=this.options;te&&console.time("total time");const ke=`prepare ${Q.length} points`;te&&console.time(ke),this.points=Q;const He=[];for(let Be=0;Be<Q.length;Be++){const bt=Q[Be];if(!bt.geometry)continue;const[Et,Rt]=bt.geometry.coordinates,_t=Cr(xe(Et)),fi=Cr(Ee(Rt));He.push(_t,fi,1/0,Be,-1,1),this.options.reduce&&He.push(0)}let xt=this.trees[Ce+1]=this._createTree(He);te&&console.timeEnd(ke);for(let Be=Ce;Be>=de;Be--){const bt=+Date.now();xt=this.trees[Be]=this._createTree(this._cluster(xt,Be)),te&&console.log("z%d: %d clusters in %dms",Be,xt.numItems,+Date.now()-bt)}return te&&console.timeEnd("total time"),this}getClusters(Q,te){let de=((Q[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,Q[1]));let ke=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)de=-180,ke=180;else if(de>ke){const Rt=this.getClusters([de,Ce,180,He],te),_t=this.getClusters([-180,Ce,ke,He],te);return Rt.concat(_t)}const xt=this.trees[this._limitZoom(te)],Be=xt.range(xe(de),Ee(He),xe(ke),Ee(Ce)),bt=xt.data,Et=[];for(const Rt of Be){const _t=this.stride*Rt;Et.push(bt[_t+Nt]>1?uo(bt,_t,this.clusterProps):this.points[bt[_t+ar]])}return Et}getChildren(Q){const te=this._getOriginId(Q),de=this._getOriginZoom(Q),Ce="No cluster with the specified id.",ke=this.trees[de];if(!ke)throw new Error(Ce);const He=ke.data;if(te*this.stride>=He.length)throw new Error(Ce);const xt=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Be=ke.within(He[te*this.stride],He[te*this.stride+1],xt),bt=[];for(const Et of Be){const Rt=Et*this.stride;He[Rt+4]===Q&&bt.push(He[Rt+Nt]>1?uo(He,Rt,this.clusterProps):this.points[He[Rt+ar]])}if(bt.length===0)throw new Error(Ce);return bt}getLeaves(Q,te,de){const Ce=[];return this._appendLeaves(Ce,Q,te=te||10,de=de||0,0),Ce}getTile(Q,te,de){const Ce=this.trees[this._limitZoom(Q)],ke=Math.pow(2,Q),{extent:He,radius:xt}=this.options,Be=xt/He,bt=(de-Be)/ke,Et=(de+1+Be)/ke,Rt={features:[]};return this._addTileFeatures(Ce.range((te-Be)/ke,bt,(te+1+Be)/ke,Et),Ce.data,te,de,ke,Rt),te===0&&this._addTileFeatures(Ce.range(1-Be/ke,bt,1,Et),Ce.data,ke,de,ke,Rt),te===ke-1&&this._addTileFeatures(Ce.range(0,bt,Be/ke,Et),Ce.data,-1,de,ke,Rt),Rt.features.length?Rt:null}getClusterExpansionZoom(Q){let te=this._getOriginZoom(Q)-1;for(;te<=this.options.maxZoom;){const de=this.getChildren(Q);if(te++,de.length!==1)break;Q=de[0].properties.cluster_id}return te}_appendLeaves(Q,te,de,Ce,ke){const He=this.getChildren(te);for(const xt of He){const Be=xt.properties;if(Be&&Be.cluster?ke+Be.point_count<=Ce?ke+=Be.point_count:ke=this._appendLeaves(Q,Be.cluster_id,de,Ce,ke):ke<Ce?ke++:Q.push(xt),Q.length===de)break}return ke}_createTree(Q){const te=new r.bj(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<Q.length;de+=this.stride)te.add(Q[de],Q[de+1]);return te.finish(),te.data=Q,te}_addTileFeatures(Q,te,de,Ce,ke,He){for(const xt of Q){const Be=xt*this.stride,bt=te[Be+Nt]>1;let Et,Rt,_t;if(bt)Et=js(te,Be,this.clusterProps),Rt=te[Be],_t=te[Be+1];else{const Bi=this.points[te[Be+ar]];Et=Bi.properties;const[Oi,Fi]=Bi.geometry.coordinates;Rt=xe(Oi),_t=Ee(Fi)}const fi={type:1,geometry:[[Math.round(this.options.extent*(Rt*ke-de)),Math.round(this.options.extent*(_t*ke-Ce))]],tags:Et};let li;li=bt||this.options.generateId?te[Be+ar]:this.points[te[Be+ar]].id,li!==void 0&&(fi.id=li),He.features.push(fi)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,te){const{radius:de,extent:Ce,reduce:ke,minPoints:He}=this.options,xt=de/(Ce*Math.pow(2,te)),Be=Q.data,bt=[],Et=this.stride;for(let Rt=0;Rt<Be.length;Rt+=Et){if(Be[Rt+2]<=te)continue;Be[Rt+2]=te;const _t=Be[Rt],fi=Be[Rt+1],li=Q.within(Be[Rt],Be[Rt+1],xt),Bi=Be[Rt+Nt];let Oi=Bi;for(const Fi of li){const Zi=Fi*Et;Be[Zi+2]>te&&(Oi+=Be[Zi+Nt])}if(Oi>Bi&&Oi>=He){let Fi,Zi=_t*Bi,fn=fi*Bi,Xn=-1;const sn=(Rt/Et<<5)+(te+1)+this.points.length;for(const Tr of li){const _r=Tr*Et;if(Be[_r+2]<=te)continue;Be[_r+2]=te;const cs=Be[_r+Nt];Zi+=Be[_r]*cs,fn+=Be[_r+1]*cs,Be[_r+4]=sn,ke&&(Fi||(Fi=this._map(Be,Rt,!0),Xn=this.clusterProps.length,this.clusterProps.push(Fi)),ke(Fi,this._map(Be,_r)))}Be[Rt+4]=sn,bt.push(Zi/Oi,fn/Oi,1/0,sn,-1,Oi),ke&&bt.push(Xn)}else{for(let Fi=0;Fi<Et;Fi++)bt.push(Be[Rt+Fi]);if(Oi>1)for(const Fi of li){const Zi=Fi*Et;if(!(Be[Zi+2]<=te)){Be[Zi+2]=te;for(let fn=0;fn<Et;fn++)bt.push(Be[Zi+fn])}}}}return bt}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,te,de){if(Q[te+Nt]>1){const He=this.clusterProps[Q[te+Es]];return de?Object.assign({},He):He}const Ce=this.points[Q[te+ar]].properties,ke=this.options.map(Ce);return de&&ke===Ce?Object.assign({},ke):ke}}function uo(Me,Q,te){return{type:"Feature",id:Me[Q+ar],properties:js(Me,Q,te),geometry:{type:"Point",coordinates:[(de=Me[Q],360*(de-.5)),it(Me[Q+1])]}};var de}function js(Me,Q,te){const de=Me[Q+Nt],Ce=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,ke=Me[Q+Es],He=ke===-1?{}:Object.assign({},te[ke]);return Object.assign(He,{cluster:!0,cluster_id:Me[Q+ar],point_count:de,point_count_abbreviated:Ce})}function xe(Me){return Me/360+.5}function Ee(Me){const Q=Math.sin(Me*Math.PI/180),te=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return te<0?0:te>1?1:te}function it(Me){const Q=(180-360*Me)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}var ht={exports:{}};ht.exports=function(){function Me(Ue,Ge,Ke,st){for(var rt,pt=st,mt=Ke-Ge>>1,ot=Ke-Ge,wt=Ue[Ge],at=Ue[Ge+1],Ht=Ue[Ke],yi=Ue[Ke+1],kt=Ge+3;kt<Ke;kt+=3){var Qi=Q(Ue[kt],Ue[kt+1],wt,at,Ht,yi);if(Qi>pt)rt=kt,pt=Qi;else if(Qi===pt){var _n=Math.abs(kt-mt);_n<ot&&(rt=kt,ot=_n)}}pt>st&&(rt-Ge>3&&Me(Ue,Ge,rt,st),Ue[rt+2]=pt,Ke-rt>3&&Me(Ue,rt,Ke,st))}function Q(Ue,Ge,Ke,st,rt,pt){var mt=rt-Ke,ot=pt-st;if(mt!==0||ot!==0){var wt=((Ue-Ke)*mt+(Ge-st)*ot)/(mt*mt+ot*ot);wt>1?(Ke=rt,st=pt):wt>0&&(Ke+=mt*wt,st+=ot*wt)}return(mt=Ue-Ke)*mt+(ot=Ge-st)*ot}function te(Ue,Ge,Ke,st){var rt={id:Ue===void 0?null:Ue,type:Ge,geometry:Ke,tags:st,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pt){var mt=pt.geometry,ot=pt.type;if(ot==="Point"||ot==="MultiPoint"||ot==="LineString")de(pt,mt);else if(ot==="Polygon"||ot==="MultiLineString")for(var wt=0;wt<mt.length;wt++)de(pt,mt[wt]);else if(ot==="MultiPolygon")for(wt=0;wt<mt.length;wt++)for(var at=0;at<mt[wt].length;at++)de(pt,mt[wt][at])}(rt),rt}function de(Ue,Ge){for(var Ke=0;Ke<Ge.length;Ke+=3)Ue.minX=Math.min(Ue.minX,Ge[Ke]),Ue.minY=Math.min(Ue.minY,Ge[Ke+1]),Ue.maxX=Math.max(Ue.maxX,Ge[Ke]),Ue.maxY=Math.max(Ue.maxY,Ge[Ke+1])}function Ce(Ue,Ge,Ke,st){if(Ge.geometry){var rt=Ge.geometry.coordinates,pt=Ge.geometry.type,mt=Math.pow(Ke.tolerance/((1<<Ke.maxZoom)*Ke.extent),2),ot=[],wt=Ge.id;if(Ke.promoteId?wt=Ge.properties[Ke.promoteId]:Ke.generateId&&(wt=st||0),pt==="Point")ke(rt,ot);else if(pt==="MultiPoint")for(var at=0;at<rt.length;at++)ke(rt[at],ot);else if(pt==="LineString")He(rt,ot,mt,!1);else if(pt==="MultiLineString"){if(Ke.lineMetrics){for(at=0;at<rt.length;at++)He(rt[at],ot=[],mt,!1),Ue.push(te(wt,"LineString",ot,Ge.properties));return}xt(rt,ot,mt,!1)}else if(pt==="Polygon")xt(rt,ot,mt,!0);else{if(pt!=="MultiPolygon"){if(pt==="GeometryCollection"){for(at=0;at<Ge.geometry.geometries.length;at++)Ce(Ue,{id:wt,geometry:Ge.geometry.geometries[at],properties:Ge.properties},Ke,st);return}throw new Error("Input data is not a valid GeoJSON object.")}for(at=0;at<rt.length;at++){var Ht=[];xt(rt[at],Ht,mt,!0),ot.push(Ht)}}Ue.push(te(wt,pt,ot,Ge.properties))}}function ke(Ue,Ge){Ge.push(Be(Ue[0])),Ge.push(bt(Ue[1])),Ge.push(0)}function He(Ue,Ge,Ke,st){for(var rt,pt,mt=0,ot=0;ot<Ue.length;ot++){var wt=Be(Ue[ot][0]),at=bt(Ue[ot][1]);Ge.push(wt),Ge.push(at),Ge.push(0),ot>0&&(mt+=st?(rt*at-wt*pt)/2:Math.sqrt(Math.pow(wt-rt,2)+Math.pow(at-pt,2))),rt=wt,pt=at}var Ht=Ge.length-3;Ge[2]=1,Me(Ge,0,Ht,Ke),Ge[Ht+2]=1,Ge.size=Math.abs(mt),Ge.start=0,Ge.end=Ge.size}function xt(Ue,Ge,Ke,st){for(var rt=0;rt<Ue.length;rt++){var pt=[];He(Ue[rt],pt,Ke,st),Ge.push(pt)}}function Be(Ue){return Ue/360+.5}function bt(Ue){var Ge=Math.sin(Ue*Math.PI/180),Ke=.5-.25*Math.log((1+Ge)/(1-Ge))/Math.PI;return Ke<0?0:Ke>1?1:Ke}function Et(Ue,Ge,Ke,st,rt,pt,mt,ot){if(st/=Ge,pt>=(Ke/=Ge)&&mt<st)return Ue;if(mt<Ke||pt>=st)return null;for(var wt=[],at=0;at<Ue.length;at++){var Ht=Ue[at],yi=Ht.geometry,kt=Ht.type,Qi=rt===0?Ht.minX:Ht.minY,_n=rt===0?Ht.maxX:Ht.maxY;if(Qi>=Ke&&_n<st)wt.push(Ht);else if(!(_n<Ke||Qi>=st)){var Ji=[];if(kt==="Point"||kt==="MultiPoint")Rt(yi,Ji,Ke,st,rt);else if(kt==="LineString")_t(yi,Ji,Ke,st,rt,!1,ot.lineMetrics);else if(kt==="MultiLineString")li(yi,Ji,Ke,st,rt,!1);else if(kt==="Polygon")li(yi,Ji,Ke,st,rt,!0);else if(kt==="MultiPolygon")for(var An=0;An<yi.length;An++){var bn=[];li(yi[An],bn,Ke,st,rt,!0),bn.length&&Ji.push(bn)}if(Ji.length){if(ot.lineMetrics&&kt==="LineString"){for(An=0;An<Ji.length;An++)wt.push(te(Ht.id,kt,Ji[An],Ht.tags));continue}kt!=="LineString"&&kt!=="MultiLineString"||(Ji.length===1?(kt="LineString",Ji=Ji[0]):kt="MultiLineString"),kt!=="Point"&&kt!=="MultiPoint"||(kt=Ji.length===3?"Point":"MultiPoint"),wt.push(te(Ht.id,kt,Ji,Ht.tags))}}}return wt.length?wt:null}function Rt(Ue,Ge,Ke,st,rt){for(var pt=0;pt<Ue.length;pt+=3){var mt=Ue[pt+rt];mt>=Ke&&mt<=st&&(Ge.push(Ue[pt]),Ge.push(Ue[pt+1]),Ge.push(Ue[pt+2]))}}function _t(Ue,Ge,Ke,st,rt,pt,mt){for(var ot,wt,at=fi(Ue),Ht=rt===0?Oi:Fi,yi=Ue.start,kt=0;kt<Ue.length-3;kt+=3){var Qi=Ue[kt],_n=Ue[kt+1],Ji=Ue[kt+2],An=Ue[kt+3],bn=Ue[kt+4],Ei=rt===0?Qi:_n,Nr=rt===0?An:bn,us=!1;mt&&(ot=Math.sqrt(Math.pow(Qi-An,2)+Math.pow(_n-bn,2))),Ei<Ke?Nr>Ke&&(wt=Ht(at,Qi,_n,An,bn,Ke),mt&&(at.start=yi+ot*wt)):Ei>st?Nr<st&&(wt=Ht(at,Qi,_n,An,bn,st),mt&&(at.start=yi+ot*wt)):Bi(at,Qi,_n,Ji),Nr<Ke&&Ei>=Ke&&(wt=Ht(at,Qi,_n,An,bn,Ke),us=!0),Nr>st&&Ei<=st&&(wt=Ht(at,Qi,_n,An,bn,st),us=!0),!pt&&us&&(mt&&(at.end=yi+ot*wt),Ge.push(at),at=fi(Ue)),mt&&(yi+=ot)}var ir=Ue.length-3;Qi=Ue[ir],_n=Ue[ir+1],Ji=Ue[ir+2],(Ei=rt===0?Qi:_n)>=Ke&&Ei<=st&&Bi(at,Qi,_n,Ji),ir=at.length-3,pt&&ir>=3&&(at[ir]!==at[0]||at[ir+1]!==at[1])&&Bi(at,at[0],at[1],at[2]),at.length&&Ge.push(at)}function fi(Ue){var Ge=[];return Ge.size=Ue.size,Ge.start=Ue.start,Ge.end=Ue.end,Ge}function li(Ue,Ge,Ke,st,rt,pt){for(var mt=0;mt<Ue.length;mt++)_t(Ue[mt],Ge,Ke,st,rt,pt,!1)}function Bi(Ue,Ge,Ke,st){Ue.push(Ge),Ue.push(Ke),Ue.push(st)}function Oi(Ue,Ge,Ke,st,rt,pt){var mt=(pt-Ge)/(st-Ge);return Ue.push(pt),Ue.push(Ke+(rt-Ke)*mt),Ue.push(1),mt}function Fi(Ue,Ge,Ke,st,rt,pt){var mt=(pt-Ke)/(rt-Ke);return Ue.push(Ge+(st-Ge)*mt),Ue.push(pt),Ue.push(1),mt}function Zi(Ue,Ge){for(var Ke=[],st=0;st<Ue.length;st++){var rt,pt=Ue[st],mt=pt.type;if(mt==="Point"||mt==="MultiPoint"||mt==="LineString")rt=fn(pt.geometry,Ge);else if(mt==="MultiLineString"||mt==="Polygon"){rt=[];for(var ot=0;ot<pt.geometry.length;ot++)rt.push(fn(pt.geometry[ot],Ge))}else if(mt==="MultiPolygon")for(rt=[],ot=0;ot<pt.geometry.length;ot++){for(var wt=[],at=0;at<pt.geometry[ot].length;at++)wt.push(fn(pt.geometry[ot][at],Ge));rt.push(wt)}Ke.push(te(pt.id,mt,rt,pt.tags))}return Ke}function fn(Ue,Ge){var Ke=[];Ke.size=Ue.size,Ue.start!==void 0&&(Ke.start=Ue.start,Ke.end=Ue.end);for(var st=0;st<Ue.length;st+=3)Ke.push(Ue[st]+Ge,Ue[st+1],Ue[st+2]);return Ke}function Xn(Ue,Ge){if(Ue.transformed)return Ue;var Ke,st,rt,pt=1<<Ue.z,mt=Ue.x,ot=Ue.y;for(Ke=0;Ke<Ue.features.length;Ke++){var wt=Ue.features[Ke],at=wt.geometry,Ht=wt.type;if(wt.geometry=[],Ht===1)for(st=0;st<at.length;st+=2)wt.geometry.push(sn(at[st],at[st+1],Ge,pt,mt,ot));else for(st=0;st<at.length;st++){var yi=[];for(rt=0;rt<at[st].length;rt+=2)yi.push(sn(at[st][rt],at[st][rt+1],Ge,pt,mt,ot));wt.geometry.push(yi)}}return Ue.transformed=!0,Ue}function sn(Ue,Ge,Ke,st,rt,pt){return[Math.round(Ke*(Ue*st-rt)),Math.round(Ke*(Ge*st-pt))]}function Tr(Ue,Ge,Ke,st,rt){for(var pt=Ge===rt.maxZoom?0:rt.tolerance/((1<<Ge)*rt.extent),mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ke,y:st,z:Ge,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ot=0;ot<Ue.length;ot++){mt.numFeatures++,_r(mt,Ue[ot],pt,rt);var wt=Ue[ot].minX,at=Ue[ot].minY,Ht=Ue[ot].maxX,yi=Ue[ot].maxY;wt<mt.minX&&(mt.minX=wt),at<mt.minY&&(mt.minY=at),Ht>mt.maxX&&(mt.maxX=Ht),yi>mt.maxY&&(mt.maxY=yi)}return mt}function _r(Ue,Ge,Ke,st){var rt=Ge.geometry,pt=Ge.type,mt=[];if(pt==="Point"||pt==="MultiPoint")for(var ot=0;ot<rt.length;ot+=3)mt.push(rt[ot]),mt.push(rt[ot+1]),Ue.numPoints++,Ue.numSimplified++;else if(pt==="LineString")cs(mt,rt,Ue,Ke,!1,!1);else if(pt==="MultiLineString"||pt==="Polygon")for(ot=0;ot<rt.length;ot++)cs(mt,rt[ot],Ue,Ke,pt==="Polygon",ot===0);else if(pt==="MultiPolygon")for(var wt=0;wt<rt.length;wt++){var at=rt[wt];for(ot=0;ot<at.length;ot++)cs(mt,at[ot],Ue,Ke,!0,ot===0)}if(mt.length){var Ht=Ge.tags||null;if(pt==="LineString"&&st.lineMetrics){for(var yi in Ht={},Ge.tags)Ht[yi]=Ge.tags[yi];Ht.mapbox_clip_start=rt.start/rt.size,Ht.mapbox_clip_end=rt.end/rt.size}var kt={geometry:mt,type:pt==="Polygon"||pt==="MultiPolygon"?3:pt==="LineString"||pt==="MultiLineString"?2:1,tags:Ht};Ge.id!==null&&(kt.id=Ge.id),Ue.features.push(kt)}}function cs(Ue,Ge,Ke,st,rt,pt){var mt=st*st;if(st>0&&Ge.size<(rt?mt:st))Ke.numPoints+=Ge.length/3;else{for(var ot=[],wt=0;wt<Ge.length;wt+=3)(st===0||Ge[wt+2]>mt)&&(Ke.numSimplified++,ot.push(Ge[wt]),ot.push(Ge[wt+1])),Ke.numPoints++;rt&&function(at,Ht){for(var yi=0,kt=0,Qi=at.length,_n=Qi-2;kt<Qi;_n=kt,kt+=2)yi+=(at[kt]-at[_n])*(at[kt+1]+at[_n+1]);if(yi>0===Ht)for(kt=0,Qi=at.length;kt<Qi/2;kt+=2){var Ji=at[kt],An=at[kt+1];at[kt]=at[Qi-2-kt],at[kt+1]=at[Qi-1-kt],at[Qi-2-kt]=Ji,at[Qi-1-kt]=An}}(ot,pt),Ue.push(ot)}}function zn(Ue,Ge){var Ke=(Ge=this.options=function(rt,pt){for(var mt in pt)rt[mt]=pt[mt];return rt}(Object.create(this.options),Ge)).debug;if(Ke&&console.time("preprocess data"),Ge.maxZoom<0||Ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ge.promoteId&&Ge.generateId)throw new Error("promoteId and generateId cannot be used together.");var st=function(rt,pt){var mt=[];if(rt.type==="FeatureCollection")for(var ot=0;ot<rt.features.length;ot++)Ce(mt,rt.features[ot],pt,ot);else Ce(mt,rt.type==="Feature"?rt:{geometry:rt},pt);return mt}(Ue,Ge);this.tiles={},this.tileCoords=[],Ke&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ge.indexMaxZoom,Ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(st=function(rt,pt){var mt=pt.buffer/pt.extent,ot=rt,wt=Et(rt,1,-1-mt,mt,0,-1,2,pt),at=Et(rt,1,1-mt,2+mt,0,-1,2,pt);return(wt||at)&&(ot=Et(rt,1,-mt,1+mt,0,-1,2,pt)||[],wt&&(ot=Zi(wt,1).concat(ot)),at&&(ot=ot.concat(Zi(at,-1)))),ot}(st,Ge)).length&&this.splitTile(st,0,0,0),Ke&&(st.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mn(Ue,Ge,Ke){return 32*((1<<Ue)*Ke+Ge)+Ue}return zn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},zn.prototype.splitTile=function(Ue,Ge,Ke,st,rt,pt,mt){for(var ot=[Ue,Ge,Ke,st],wt=this.options,at=wt.debug;ot.length;){st=ot.pop(),Ke=ot.pop(),Ge=ot.pop(),Ue=ot.pop();var Ht=1<<Ge,yi=mn(Ge,Ke,st),kt=this.tiles[yi];if(!kt&&(at>1&&console.time("creation"),kt=this.tiles[yi]=Tr(Ue,Ge,Ke,st,wt),this.tileCoords.push({z:Ge,x:Ke,y:st}),at)){at>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ge,Ke,st,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));var Qi="z"+Ge;this.stats[Qi]=(this.stats[Qi]||0)+1,this.total++}if(kt.source=Ue,rt){if(Ge===wt.maxZoom||Ge===rt)continue;var _n=1<<rt-Ge;if(Ke!==Math.floor(pt/_n)||st!==Math.floor(mt/_n))continue}else if(Ge===wt.indexMaxZoom||kt.numPoints<=wt.indexMaxPoints)continue;if(kt.source=null,Ue.length!==0){at>1&&console.time("clipping");var Ji,An,bn,Ei,Nr,us,ir=.5*wt.buffer/wt.extent,ko=.5-ir,xl=.5+ir,Mr=1+ir;Ji=An=bn=Ei=null,Nr=Et(Ue,Ht,Ke-ir,Ke+xl,0,kt.minX,kt.maxX,wt),us=Et(Ue,Ht,Ke+ko,Ke+Mr,0,kt.minX,kt.maxX,wt),Ue=null,Nr&&(Ji=Et(Nr,Ht,st-ir,st+xl,1,kt.minY,kt.maxY,wt),An=Et(Nr,Ht,st+ko,st+Mr,1,kt.minY,kt.maxY,wt),Nr=null),us&&(bn=Et(us,Ht,st-ir,st+xl,1,kt.minY,kt.maxY,wt),Ei=Et(us,Ht,st+ko,st+Mr,1,kt.minY,kt.maxY,wt),us=null),at>1&&console.timeEnd("clipping"),ot.push(Ji||[],Ge+1,2*Ke,2*st),ot.push(An||[],Ge+1,2*Ke,2*st+1),ot.push(bn||[],Ge+1,2*Ke+1,2*st),ot.push(Ei||[],Ge+1,2*Ke+1,2*st+1)}}},zn.prototype.getTile=function(Ue,Ge,Ke){var st=this.options,rt=st.extent,pt=st.debug;if(Ue<0||Ue>24)return null;var mt=1<<Ue,ot=mn(Ue,Ge=(Ge%mt+mt)%mt,Ke);if(this.tiles[ot])return Xn(this.tiles[ot],rt);pt>1&&console.log("drilling down to z%d-%d-%d",Ue,Ge,Ke);for(var wt,at=Ue,Ht=Ge,yi=Ke;!wt&&at>0;)at--,Ht=Math.floor(Ht/2),yi=Math.floor(yi/2),wt=this.tiles[mn(at,Ht,yi)];return wt&&wt.source?(pt>1&&console.log("found parent tile z%d-%d-%d",at,Ht,yi),pt>1&&console.time("drilling down"),this.splitTile(wt.source,at,Ht,yi,Ue,Ge,Ke),pt>1&&console.timeEnd("drilling down"),this.tiles[ot]?Xn(this.tiles[ot],rt):null):null},function(Ue,Ge){return new zn(Ue,Ge)}}();var nt=r.dX(ht.exports);function Dt(Me,Q){const te=Me.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);const de=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!de)return Q(null,null);const Ce=new Ut(de.features);let ke=wr(Ce);ke.byteOffset===0&&ke.byteLength===ke.buffer.byteLength||(ke=new Uint8Array(ke)),Q(null,{vectorTile:Ce,rawData:ke.buffer})}class Je extends Ye{constructor(Q,te,de,Ce,ke,He){super(Q,te,de,Ce,Dt,He),ke&&(this.loadGeoJSON=ke),this._featureMap=new Map}loadData(Q,te){const de=Q&&Q.request,Ce=de&&de.collectResourceTiming;this.loadGeoJSON(Q,(ke,He)=>{if(ke||!He)return te(ke);if(typeof He!="object")return te(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));{try{if(Q.filter){const Be=r.t(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(bt=>`${bt.key}: ${bt.message}`).join(", "));He.features=He.features.filter(bt=>Be.value.evaluate({zoom:0},bt))}if(Q.dynamic){He.type==="Feature"&&(He={type:"FeatureCollection",features:[He]}),Q.append||this._featureMap.clear();for(const Be of He.features||[]){const bt=Be.id;bt!==void 0&&(Be.geometry?this._featureMap.set(bt,Be):this._featureMap.delete(bt))}He.features=[...this._featureMap.values()]}this._geoJSONIndex=Q.cluster?new Wi(function({superclusterOptions:Be,clusterProperties:bt}){if(!bt||!Be)return Be;const Et={},Rt={},_t={accumulated:null,zoom:0},fi={properties:null},li=Object.keys(bt);for(const Bi of li){const[Oi,Fi]=bt[Bi],Zi=r.t(Fi),fn=r.t(typeof Oi=="string"?[Oi,["accumulated"],["get",Bi]]:Oi);Et[Bi]=Zi.value,Rt[Bi]=fn.value}return Be.map=Bi=>{fi.properties=Bi;const Oi={};for(const Fi of li)Oi[Fi]=Et[Fi].evaluate(_t,fi);return Oi},Be.reduce=(Bi,Oi)=>{fi.properties=Oi;for(const Fi of li)_t.accumulated=Bi[Fi],Bi[Fi]=Rt[Fi].evaluate(_t,fi)},Be}(Q)).load(He.features):nt(He,Q.geojsonVtOptions)}catch(Be){return te(Be)}this.loaded={};const xt={};if(Ce){const Be=B(de);Be&&(xt.resourceTiming={},xt.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Be)))}te(null,xt)}})}reloadTile(Q,te){const de=this.loaded;return de&&de[Q.uid]?super.reloadTile(Q,te):this.loadTile(Q,te)}loadGeoJSON(Q,te){if(Q.request)r.g(Q.request,te);else{if(typeof Q.data!="string")return te(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));try{return te(null,JSON.parse(Q.data))}catch{return te(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Q,te){try{te(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(de){te(de)}}getClusterChildren(Q,te){try{te(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(de){te(de)}}getClusterLeaves(Q,te){try{te(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(de){te(de)}}}class qe{constructor(Q,te){this.tileID=new r.ap(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Q.projection,this.brightness=te}parse(Q,te,de,Ce){this.status="parsing";const ke=new r.ap(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),He={},xt=te.familiesBySource[de.source],Be=new r.dL(ke,de.promoteId);return Be.bucketLayerIDs=[],Be.is3DTile=!0,r.dY(Q).then(bt=>{if(!bt)return Ce(new Error("Could not parse tile"));const Et=r.dZ(bt,1/r.bU(de.tileID.canonical)),Rt=bt.json.extensionsUsed&&bt.json.extensionsUsed.includes("MAPBOX_mesh_features")||bt.json.asset.extras&&bt.json.asset.extras.MAPBOX_mesh_features,_t=bt.json.extensionsUsed&&bt.json.extensionsUsed.includes("EXT_meshopt_compression"),fi=new r.N(this.zoom,{brightness:this.brightness});for(const li in xt)for(const Bi of xt[li]){const Oi=Bi[0];Be.bucketLayerIDs.push(Bi.map(Zi=>Zi.id)),Oi.recalculate(fi,[]);const Fi=new r.d_(Et,ke,Rt,_t,this.brightness,Be);Rt||(Fi.needsUpload=!0),He[Oi.fqid]=Fi,Fi.evaluate(Oi)}this.status="done",Ce(null,{buckets:He,featureIndex:Be})}).catch(bt=>Ce(new Error(bt.message)))}}class Lt{constructor(Q,te,de,Ce,ke,He){this.actor=Q,this.layerIndex=te,this.brightness=He,this.loading={},this.loaded={}}loadTile(Q,te){const de=Q.uid,Ce=this.loading[de]=new qe(Q,this.brightness);r.b1(Q.request,(ke,He)=>{const xt=!this.loading[de];return delete this.loading[de],xt||ke?(Ce.status="done",xt||(this.loaded[de]=Ce),te(ke)):He&&He.byteLength!==0?void Ce.parse(He,this.layerIndex,Q,(Be,bt)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[de]=Ce,Be||!bt?te(Be):te(null,bt)}):(Ce.status="done",this.loaded[de]=Ce,te())})}reloadTile(Q,te){const de=this.loaded,Ce=Q.uid;if(de&&de[Ce]){const ke=de[Ce];ke.projection=Q.projection,ke.brightness=Q.brightness;const He=(xt,Be)=>{ke.reloadCallback&&(delete ke.reloadCallback,this.loadTile(Q,te)),te(xt,Be)};ke.status==="parsing"?ke.reloadCallback=He:ke.status==="done"&&this.loadTile(Q,te)}}abortTile(Q,te){const de=Q.uid;this.loading[de]&&delete this.loading[de],te()}removeTile(Q,te){const de=this.loaded,Ce=Q.uid;de&&de[Ce]&&delete de[Ce],te()}}class ft{constructor(Q){this.self=Q,this.actor=new r.d$(Q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.br({name:"mercator"}),this.workerSourceTypes={vector:Ye,geojson:Je,"batched-model":Lt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(te,de)=>{if(this.workerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.workerSourceTypes[te]=de},this.self.registerRTLTextPlugin=te=>{if(r.e0.isParsed())throw new Error("RTL text plugin already registered.");r.e0.applyArabicShaping=te.applyArabicShaping,r.e0.processBidirectionalText=te.processBidirectionalText,r.e0.processStyledBidirectionalText=te.processStyledBidirectionalText}}clearCaches(Q,te,de){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q],delete this.rasterArrayWorkerSource,de()}checkIfReady(Q,te,de){de()}setReferrer(Q,te){this.referrer=te}spriteLoaded(Q,{scope:te,isLoaded:de}){if(this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={}),this.isSpriteLoaded[Q][te]=de,this.workerSources[Q]&&this.workerSources[Q][te])for(const Ce in this.workerSources[Q][te]){const ke=this.workerSources[Q][te][Ce];for(const He in ke)ke[He]instanceof Ye&&(ke[He].isSpriteLoaded=de,ke[He].fire(new r.b("isSpriteLoaded")))}}setImages(Q,{scope:te,images:de},Ce){if(this.availableImages[Q]||(this.availableImages[Q]={}),this.availableImages[Q][te]=de,this.workerSources[Q]&&this.workerSources[Q][te]){for(const ke in this.workerSources[Q][te]){const He=this.workerSources[Q][te][ke];for(const xt in He)He[xt].availableImages=de}Ce()}else Ce()}setProjection(Q,te){this.projections[Q]=r.br(te)}setBrightness(Q,te,de){this.brightness=te,de()}setLayers(Q,te,de){this.getLayerIndex(Q,te.scope).replace(te.layers,te.options),de()}updateLayers(Q,te,de){this.getLayerIndex(Q,te.scope).update(te.layers,te.removedIds,te.options),de()}loadTile(Q,te,de){te.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,te.type,te.source,te.scope).loadTile(te,de)}loadDEMTile(Q,te,de){this.getDEMWorkerSource(Q,te.source,te.scope).loadTile(te,de)}decodeRasterArray(Q,te,de){this.getRasterArrayWorkerSource().decodeRasterArray(te,de)}reloadTile(Q,te,de){te.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,te.type,te.source,te.scope).reloadTile(te,de)}abortTile(Q,te,de){this.getWorkerSource(Q,te.type,te.source,te.scope).abortTile(te,de)}removeTile(Q,te,de){this.getWorkerSource(Q,te.type,te.source,te.scope).removeTile(te,de)}removeSource(Q,te,de){if(!(this.workerSources[Q]&&this.workerSources[Q][te.scope]&&this.workerSources[Q][te.scope][te.type]&&this.workerSources[Q][te.scope][te.type][te.source]))return;const Ce=this.workerSources[Q][te.scope][te.type][te.source];delete this.workerSources[Q][te.scope][te.type][te.source],Ce.removeSource!==void 0?Ce.removeSource(te,de):de()}loadWorkerSource(Q,te,de){try{this.self.importScripts(te.url),de()}catch(Ce){de(Ce.toString())}}syncRTLPluginState(Q,te,de){try{r.e0.setState(te);const Ce=r.e0.getPluginURL();if(r.e0.isLoaded()&&!r.e0.isParsed()&&Ce!=null){this.self.importScripts(Ce);const ke=r.e0.isParsed();de(ke?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ce}`),ke)}}catch(Ce){de(Ce.toString())}}setDracoUrl(Q,te){this.dracoUrl=te}getAvailableImages(Q,te){this.availableImages[Q]||(this.availableImages[Q]={});let de=this.availableImages[Q][te];return de||(de=[]),de}getLayerIndex(Q,te){this.layerIndexes[Q]||(this.layerIndexes[Q]={});let de=this.layerIndexes[Q][te];return de||(de=this.layerIndexes[Q][te]=new ae,de.scope=te),de}getWorkerSource(Q,te,de,Ce){if(this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][Ce]||(this.workerSources[Q][Ce]={}),this.workerSources[Q][Ce][te]||(this.workerSources[Q][Ce][te]={}),this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={}),!this.workerSources[Q][Ce][te][de]){const ke={send:(He,xt,Be,bt,Et,Rt)=>{this.actor.send(He,xt,Be,Q,Et,Rt)},scheduler:this.actor.scheduler};this.workerSources[Q][Ce][te][de]=new this.workerSourceTypes[te](ke,this.getLayerIndex(Q,Ce),this.getAvailableImages(Q,Ce),this.isSpriteLoaded[Q][Ce],void 0,this.brightness)}return this.workerSources[Q][Ce][te][de]}getDEMWorkerSource(Q,te,de){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][de]||(this.demWorkerSources[Q][de]={}),this.demWorkerSources[Q][de][te]||(this.demWorkerSources[Q][de][te]=new lt),this.demWorkerSources[Q][de][te]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new dt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Q,te){r.e1(te)}getWorkerPerformanceMetrics(Q,te,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ft(self)),ft}),E(["./shared"],function(r){function B(h,n){if(Array.isArray(h)){if(!Array.isArray(n)||h.length!==n.length)return!1;for(let o=0;o<h.length;o++)if(!B(h[o],n[o]))return!1;return!0}if(typeof h=="object"&&h!==null&&n!==null){if(typeof n!="object"||Object.keys(h).length!==Object.keys(n).length)return!1;for(const o in h)if(!B(h[o],n[o]))return!1;return!0}return h===n}var W=Z;function Z(h){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,y=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(y);try{_=new Worker(b),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(b),f}()?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var y=_.getImageData(0,0,1,1);return y&&y.width===f.width}()?(ae[o=n&&n.failIfMajorPerformanceCaveat]===void 0&&(ae[o]=function(f){var _,y=function(b){var M=document.createElement("canvas"),I=Object.create(Z.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=b,M.getContext("webgl2",I)}(f);if(!y)return!1;try{_=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!_||y.isContextLost())&&(y.shaderSource(_,"void main() {}"),y.compileShader(_),y.getShaderParameter(_,y.COMPILE_STATUS)===!0)}(o)),ae[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var o}(h)}var ae={};function fe(h,n,o){const f=document.createElement(h);return n!=null&&(f.className=n),o&&o.appendChild(f),f}function Le(h,n,o){const f=document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(n))f.setAttributeNS(null,_,String(n[_]));return o&&o.appendChild(f),f}Z.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const De=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ve=De&&De.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ye;function lt(){De&&Ve&&(Ye=De[Ve],De[Ve]="none")}function dt(){De&&Ve&&(De[Ve]=Ye)}function gt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",gt,!0)}function yt(){window.addEventListener("click",gt,!0),window.setTimeout(()=>{window.removeEventListener("click",gt,!0)},0)}function Ut(h,n){const o=h.getBoundingClientRect();return Gi(h,o,n)}function Yt(h,n){const o=h.getBoundingClientRect(),f=[];for(let _=0;_<n.length;_++)f.push(Gi(h,o,n[_]));return f}function wi(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Gi(h,n,o){const f=h.offsetWidth===n.width?1:h.offsetWidth/n.width;return new r.P((o.clientX-n.left)*f,(o.clientY-n.top)*f)}class Qt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,o){this._updatedSourceCaches[n]=o,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const o=n.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(n.id),this.setDirty()}removeLayer(n){const o=n.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][n.id]=n,this._updatedLayers[o].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const o in this._updatedLayers)n[o]=n[o]||{},n[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)n[o]=n[o]||{},n[o].removedIds=Object.keys(this._removedLayers[o]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class tn extends r.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,o){return r.l(this.requestManager.transformRequest(o,r.R.Model).url).then(f=>{if(!f)return;const _=r.c(f),y=new r.M(n,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(f=>{if(f&&f.status===404)return null;this.fire(new r.a(new Error(`Could not load model ${n} from ${o}: ${f.message}`)))})}load(n,o){this.models[o]||(this.models[o]={});const f=Object.keys(n);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+f.length;const _=[];for(const y of f)_.push(this.loadModel(y,n[y]));Promise.allSettled(_).then(y=>{for(let b=0;b<y.length;b++){const{status:M,value:I}=y[b];M==="fulfilled"&&I&&(this.models[o][f[b]]={model:I,numReferences:1})}this.numModelsLoading[o]-=f.length,this.fire(new r.b("data",{dataType:"style"}))}).catch(y=>{this.fire(new r.a(new Error(`Could not load models: ${y.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,o){return!!this.getModel(n,o)}getModel(n,o){return this.models[o]||(this.models[o]={}),this.models[o][n]?this.models[o][n].model:void 0}addModel(n,o,f){this.models[f]||(this.models[f]={}),this.hasModel(n,f)&&this.models[f][n].numReferences++,this.load({[n]:this.requestManager.normalizeModelURL(o)},f)}addModels(n,o){this.models[o]||(this.models[o]={});const f={};for(const _ in n)this.models[o][_]={},f[_]=this.requestManager.normalizeModelURL(n[_]);this.load(f,o)}addModelsFromBucket(n,o){this.models[o]||(this.models[o]={});const f={};for(const _ of n)this.hasModel(_,o)?this.models[o][_].numReferences++:f[_]=this.requestManager.normalizeModelURL(_);this.load(f,o)}removeModel(n,o){if(this.models[o]&&this.models[o][n]&&(this.models[o][n].numReferences--,this.models[o][n].numReferences===0)){const f=this.models[o][n].model;delete this.models[o][n],f.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,o){this.models[o]||(this.models[o]={});for(const f in this.models[o])this.models[o][f].model&&this.models[o][f].model.upload(n.context)}}class Ui{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,f){const _=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][_]=this.stateChanges[n][_]||{},r.e(this.stateChanges[n][_],f),this.deletedStates[n]===null){this.deletedStates[n]={};for(const y in this.state[n])y!==_&&(this.deletedStates[n][y]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][_]===null){this.deletedStates[n][_]={};for(const y in this.state[n][_])f[y]||(this.deletedStates[n][_][y]=null)}else for(const y in f)this.deletedStates[n]&&this.deletedStates[n][_]&&this.deletedStates[n][_][y]===null&&delete this.deletedStates[n][_][y]}removeFeatureState(n,o,f){if(this.deletedStates[n]===null)return;const _=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},f&&o!==void 0)this.deletedStates[n][_]!==null&&(this.deletedStates[n][_]=this.deletedStates[n][_]||{},this.deletedStates[n][_][f]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][_])for(f in this.deletedStates[n][_]={},this.stateChanges[n][_])this.deletedStates[n][_][f]=null;else this.deletedStates[n][_]=null;else this.deletedStates[n]=null}getState(n,o){const f=String(o),_=r.e({},(this.state[n]||{})[f],(this.stateChanges[n]||{})[f]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const y=this.deletedStates[n][o];if(y===null)return{};for(const b in y)delete _[b]}return _}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const y={};for(const b in this.stateChanges[_])this.state[_][b]||(this.state[_][b]={}),r.e(this.state[_][b],this.stateChanges[_][b]),y[b]=this.state[_][b];f[_]=y}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const y={};if(this.deletedStates[_]===null)for(const b in this.state[_])y[b]={},this.state[_][b]={};else for(const b in this.deletedStates[_]){if(this.deletedStates[_][b]===null)this.state[_][b]={};else if(this.state[_][b])for(const M of Object.keys(this.deletedStates[_][b]))delete this.state[_][b][M];y[b]=this.state[_][b]}f[_]=f[_]||{},r.e(f[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in n)n[_].setFeatureState(f,o)}}function Un(h){const{userImage:n}=h;return!!(n&&n.render&&n.render())&&(h.data.replace(new Uint8Array(n.data.buffer)),!0)}class er extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new r.h({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,o){if(this.loaded[o]!==n&&(this.loaded[o]=n,n)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,o,_);this.requestors=[]}}hasImage(n,o){return!!this.getImage(n,o)}getImage(n,o){return this.images[o][n]}addImage(n,o,f){this._validate(n,f)&&(this.images[o][n]=f)}_validate(n,o){let f=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(o.content,o)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,o){if(!n)return!0;let f=0;for(const _ of n){if(_[0]<f||_[1]<_[0]||o<_[1])return!1;f=_[1]}return!0}_validateContent(n,o){return!(n&&(n.length!==4||n[0]<0||o.data.width<n[0]||n[1]<0||o.data.height<n[1]||n[2]<0||o.data.width<n[2]||n[3]<0||o.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,o,f){f.version=this.images[o][n].version+1,this.images[o][n]=f,this.updatedImages[o][n]=!0}removeImage(n,o){const f=this.images[o][n];delete this.images[o][n],delete this.patterns[o][n],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,o,f){let _=!0;const y=!!this.loaded[o];if(!y)for(const b of n)this.images[o][b]||(_=!1);y||_?this._notify(n,o,f):this.requestors.push({ids:n,scope:o,callback:f})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,o,f){const _={};for(const y of n){this.images[o][y]||this.fire(new r.b("styleimagemissing",{id:y}));const b=this.images[o][y];b?_[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:r.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,_)}getPixelSize(n){const{width:o,height:f}=this.atlasImage[n];return{width:o,height:f}}getPattern(n,o){const f=this.patterns[o][n],_=this.getImage(n,o);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new r.I(y,_);this.patterns[o][n]={bin:y,position:b}}return this._updatePatternAtlas(o),this.patterns[o][n].position}bind(n,o){const f=n.gl;let _=this.atlasTexture[o];_?this.dirty&&(_.update(this.atlasImage[o]),this.dirty=!1):(_=new r.T(n,this.atlasImage[o],f.RGBA),this.atlasTexture[o]=_),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(n){const o=[];for(const b in this.patterns[n])o.push(this.patterns[n][b].bin);const{w:f,h:_}=r.p(o),y=this.atlasImage[n];y.resize({width:f||1,height:_||1});for(const b in this.patterns[n]){const{bin:M}=this.patterns[n][b],I=M.x+1,D=M.y+1,z=this.images[n][b].data,k=z.width,F=z.height;r.h.copy(z,y,{x:0,y:0},{x:I,y:D},{width:k,height:F}),r.h.copy(z,y,{x:0,y:F-1},{x:I,y:D-1},{width:k,height:1}),r.h.copy(z,y,{x:0,y:0},{x:I,y:D+F},{width:k,height:1}),r.h.copy(z,y,{x:k-1,y:0},{x:I-1,y:D},{width:1,height:F}),r.h.copy(z,y,{x:0,y:0},{x:I+k,y:D},{width:1,height:F})}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,o){for(const f of n){if(this.callbackDispatchedThisFrame[o][f])continue;this.callbackDispatchedThisFrame[o][f]=!0;const _=this.images[o][f];Un(_)&&this.updateImage(f,o,_)}}}function Ri(h){const n=h.key,o=h.value,f=h.valueSpec||{},_=h.objectElementValidators||{},y=h.style,b=h.styleSpec;let M=[];const I=r.j(o);if(I!=="object")return[new r.V(n,o,`object expected, ${I} found`)];for(const D in o){const z=D.split(".")[0];let k;_[z]?k=_[z]:f[z]?k=nt:_["*"]?k=_["*"]:f["*"]&&(k=nt),k?M=M.concat(k({key:(n&&`${n}.`)+D,value:o[D],valueSpec:f[z]||f["*"],style:y,styleSpec:b,object:o,objectKey:D},o)):M.push(new r.i(n,o[D],`unknown property "${D}"`))}for(const D in f)_[D]||f[D].required&&f[D].default===void 0&&o[D]===void 0&&M.push(new r.V(n,o,`missing required property "${D}"`));return M}function qt(h){const n=h.value,o=h.valueSpec,f=h.style,_=h.styleSpec,y=h.key,b=h.arrayElementValidator||nt;if(r.j(n)!=="array")return[new r.V(y,n,`array expected, ${r.j(n)} found`)];if(o.length&&n.length!==o.length)return[new r.V(y,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new r.V(y,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let M={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};_.$version<7&&(M.function=o.function),r.j(o.value)==="object"&&(M=o.value);let I=[];for(let D=0;D<n.length;D++)I=I.concat(b({array:n,arrayIndex:D,value:n[D],valueSpec:M,style:f,styleSpec:_,key:`${y}[${D}]`},!0));return I}function Ci(h){const n=h.key,o=h.value,f=h.valueSpec;let _=r.j(o);if(_==="number"&&o!=o&&(_="NaN"),_!=="number")return[new r.V(n,o,`number expected, ${_} found`)];if("minimum"in f){let y=f.minimum;if(r.j(f.minimum)==="array"&&(y=f.minimum[h.arrayIndex]),o<y)return[new r.V(n,o,`${o} is less than the minimum value ${y}`)]}if("maximum"in f){let y=f.maximum;if(r.j(f.maximum)==="array"&&(y=f.maximum[h.arrayIndex]),o>y)return[new r.V(n,o,`${o} is greater than the maximum value ${y}`)]}return[]}function Ti(h){const n=h.valueSpec,o=r.u(h.value.type);let f,_,y,b={};const M=o!=="categorical"&&h.value.property===void 0,I=!M,D=r.j(h.value.stops)==="array"&&r.j(h.value.stops[0])==="array"&&r.j(h.value.stops[0][0])==="object",z=Ri({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(N){if(o==="identity")return[new r.V(N.key,N.value,'identity function may not have a "stops" property')];let G=[];const U=N.value;return G=G.concat(qt({key:N.key,value:U,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:k})),r.j(U)==="array"&&U.length===0&&G.push(new r.V(N.key,U,"array must have at least one stop")),G},default:function(N){return nt({key:N.key,value:N.value,valueSpec:n,style:N.style,styleSpec:N.styleSpec})}}});return o==="identity"&&M&&z.push(new r.V(h.key,h.value,'missing required property "property"')),o==="identity"||h.value.stops||z.push(new r.V(h.key,h.value,'missing required property "stops"')),o==="exponential"&&h.valueSpec.expression&&!r.s(h.valueSpec)&&z.push(new r.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(I&&!r.m(h.valueSpec)?z.push(new r.V(h.key,h.value,"property functions not supported")):M&&!r.n(h.valueSpec)&&z.push(new r.V(h.key,h.value,"zoom functions not supported"))),o!=="categorical"&&!D||h.value.property!==void 0||z.push(new r.V(h.key,h.value,'"property" property is required')),z;function k(N){let G=[];const U=N.value,$=N.key;if(r.j(U)!=="array")return[new r.V($,U,`array expected, ${r.j(U)} found`)];if(U.length!==2)return[new r.V($,U,`array length 2 expected, length ${U.length} found`)];if(D){if(r.j(U[0])!=="object")return[new r.V($,U,`object expected, ${r.j(U[0])} found`)];if(U[0].zoom===void 0)return[new r.V($,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new r.V($,U,"object stop key must have value")];const q=r.u(U[0].zoom);if(typeof q!="number")return[new r.V($,U[0].zoom,"stop zoom values must be numbers")];if(y&&y>q)return[new r.V($,U[0].zoom,"stop zoom values must appear in ascending order")];q!==y&&(y=q,_=void 0,b={}),G=G.concat(Ri({key:`${$}[0]`,value:U[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:Ci,value:F}}))}else G=G.concat(F({key:`${$}[0]`,value:U[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},U));return r.o(r.q(U[1]))?G.concat([new r.V(`${$}[1]`,U[1],"expressions are not allowed in function stops.")]):G.concat(nt({key:`${$}[1]`,value:U[1],valueSpec:n,style:N.style,styleSpec:N.styleSpec}))}function F(N,G){const U=r.j(N.value),$=r.u(N.value),q=N.value!==null?N.value:G;if(f){if(U!==f)return[new r.V(N.key,q,`${U} stop domain type must match previous stop domain type ${f}`)]}else f=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new r.V(N.key,q,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&o!=="categorical"){let Y=`number expected, ${U} found`;return r.m(n)&&o===void 0&&(Y+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(N.key,q,Y)]}return o!=="categorical"||U!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?o!=="categorical"&&U==="number"&&typeof $=="number"&&typeof _=="number"&&_!==void 0&&$<_?[new r.V(N.key,q,"stop domain values must appear in ascending order")]:(_=$,o==="categorical"&&$ in b?[new r.V(N.key,q,"stop domain values must be unique")]:(b[$]=!0,[])):[new r.V(N.key,q,`integer expected, found ${String($)}`)]}}function Tn(h){const n=(h.expressionContext==="property"?r.r:r.t)(r.q(h.value),h.valueSpec);if(n.result==="error")return n.value.map(f=>new r.V(`${h.key}${f.key}`,h.value,f.message));const o=n.value.expression||n.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!o.outputDefined())return[new r.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!r.v(o))return[new r.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return tr(o,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!r.x(o,["zoom","feature-state"]))return[new r.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!r.y(o))return[new r.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tr(h,n){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const _ of n.valueSpec.expression.parameters)o.delete(_);if(o.size===0)return[];const f=[];return h instanceof r.C&&o.has(h.name)?[new r.V(n.key,n.value,`["${h.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(h.eachChild(_=>{f.push(...tr(_,n))}),f)}function Gn(h){const n=h.key,o=h.value,f=h.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(r.u(o))===-1&&_.push(new r.V(n,o,`expected one of [${f.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(f.values).indexOf(r.u(o))===-1&&_.push(new r.V(n,o,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(o)} found`)),_}function Kt(h){return r.A(r.q(h.value))?Tn(r.k({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):wr(h)}function wr(h){const n=h.value,o=h.key;if(r.j(n)!=="array")return[new r.V(o,n,`array expected, ${r.j(n)} found`)];const f=h.styleSpec;let _,y=[];if(n.length<1)return[new r.V(o,n,"filter array must have at least 1 element")];switch(y=y.concat(Gn({key:`${o}[0]`,value:n[0],valueSpec:f.filter_operator,style:h.style,styleSpec:h.styleSpec})),r.u(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&r.u(n[1])==="$type"&&y.push(new r.V(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new r.V(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=r.j(n[1]),_!=="string"&&y.push(new r.V(`${o}[1]`,n[1],`string expected, ${_} found`)));for(let b=2;b<n.length;b++)_=r.j(n[b]),r.u(n[1])==="$type"?y=y.concat(Gn({key:`${o}[${b}]`,value:n[b],valueSpec:f.geometry_type,style:h.style,styleSpec:h.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&y.push(new r.V(`${o}[${b}]`,n[b],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)y=y.concat(wr({key:`${o}[${b}]`,value:n[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":_=r.j(n[1]),n.length!==2?y.push(new r.V(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&y.push(new r.V(`${o}[1]`,n[1],`string expected, ${_} found`))}return y}function vn(h,n){const o=h.key,f=h.style,_=h.layer,y=h.styleSpec,b=h.value,M=h.objectKey,I=y[`${n}_${h.layerType}`];if(!I)return[];const D=M.match(/^(.*)-transition$/);if(n==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return nt({key:o,value:b,valueSpec:y.transition,style:f,styleSpec:y});const z=h.valueSpec||I[M];if(!z)return[new r.i(o,b,`unknown property "${M}"`)];let k;if(r.j(b)==="string"&&r.m(z)&&!z.tokens&&(k=/^{([^}]+)}$/.exec(b))){const N=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new r.V(o,b,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${N}.`)]}const F=[];if(h.layerType==="symbol")M!=="text-field"||!f||f.glyphs||f.imports||F.push(new r.V(o,b,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&r.B(r.q(b))&&r.u(b.type)==="identity"&&F.push(new r.V(o,b,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&n==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&r.m(z)&&(r.D(z)||r.n(z))){const N=r.r(r.q(b),z),G=N.value.expression||N.value._styleExpression.expression;G&&!r.x(G,["measure-light"])&&(M==="model-emissive-strength"&&r.y(G)&&r.v(G)||F.push(new r.V(o,b,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(nt({key:h.key,value:b,valueSpec:z,style:f,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:M}))}function Cr(h){return vn(h,"paint")}function Mn(h){return vn(h,"layout")}function ar(h){let n=[];const o=h.value,f=h.key,_=h.style,y=h.styleSpec;o.type||o.ref||n.push(new r.V(f,o,'either "type" or "ref" is required'));let b=r.u(o.type);const M=r.u(o.ref);if(o.id){const I=r.u(o.id);for(let D=0;D<h.arrayIndex;D++){const z=_.layers[D];r.u(z.id)===I&&n.push(new r.V(f,o.id,`duplicate layer id "${o.id}", previously used at line ${z.id.__line__}`))}}if("ref"in o){let I;["type","source","source-layer","filter","layout"].forEach(D=>{D in o&&n.push(new r.V(f,o[D],`"${D}" is prohibited for ref layers`))}),_.layers.forEach(D=>{r.u(D.id)===M&&(I=D)}),I?I.ref?n.push(new r.V(f,o.ref,"ref cannot reference another ref layer")):b=r.u(I.type):typeof M=="string"&&n.push(new r.V(f,o.ref,`ref layer "${M}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(o.source){const I=_.sources&&_.sources[o.source],D=I&&r.u(I.type);I?D==="vector"&&b==="raster"?n.push(new r.V(f,o.source,`layer "${o.id}" requires a raster source`)):D==="raster"&&b!=="raster"?n.push(new r.V(f,o.source,`layer "${o.id}" requires a vector source`)):D!=="vector"||o["source-layer"]?D==="raster-dem"&&b!=="hillshade"?n.push(new r.V(f,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||D==="geojson"&&I.lineMetrics?b==="raster-particle"&&D!=="raster-array"&&n.push(new r.V(f,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):n.push(new r.V(f,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new r.V(f,o.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new r.V(f,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new r.V(f,o.source,`source "${o.source}" not found`))}else n.push(new r.V(f,o,'missing required property "source"'));return n=n.concat(Ri({key:f,value:o,valueSpec:y.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>nt({key:`${f}.type`,value:o.type,valueSpec:y.layer.type,style:h.style,styleSpec:h.styleSpec,object:o,objectKey:"type"}),filter:I=>Kt(r.k({layerType:b},I)),layout:I=>Ri({layer:o,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":D=>Mn(r.k({layerType:b},D))}}),paint:I=>Ri({layer:o,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":D=>Cr(r.k({layerType:b,layer:o},D))}})}})),n}function Nt(h){const n=h.value,o=h.key,f=r.j(n);return f!=="string"?[new r.V(o,n,`string expected, ${f} found`)]:[]}const Es={promoteId:function({key:h,value:n}){if(r.j(n)==="string")return Nt({key:h,value:n});{const o=[];for(const f in n)o.push(...Nt({key:`${h}.${f}`,value:n[f]}));return o}}};function Wi(h){const n=h.value,o=h.key,f=h.styleSpec,_=h.style;if(!n.type)return[new r.V(o,n,'"type" is required')];const y=r.u(n.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(n.url||n.tiles||b.push(new r.i(o,n,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Ri({key:o,value:n,valueSpec:f[`source_${y.replace("-","_")}`],style:h.style,styleSpec:f,objectElementValidators:Es})),b;case"geojson":if(b=Ri({key:o,value:n,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:Es}),n.cluster)for(const M in n.clusterProperties){const[I,D]=n.clusterProperties[M],z=typeof I=="string"?[I,["accumulated"],["get",M]]:I;b.push(...Tn({key:`${o}.${M}.map`,value:D,expressionContext:"cluster-map"})),b.push(...Tn({key:`${o}.${M}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return b;case"video":return Ri({key:o,value:n,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return Ri({key:o,value:n,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new r.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gn({key:`${o}.type`,value:n.type,valueSpec:{values:uo(f)},style:_,styleSpec:f})}}function uo(h){return h.source.reduce((n,o)=>{const f=h[o];return f.type.type==="enum"&&(n=n.concat(Object.keys(f.type.values))),n},[])}function js(h){const n=h.value,o=h.styleSpec,f=o.light,_=h.style;let y=[];const b=r.j(n);if(n===void 0)return y;if(b!=="object")return y=y.concat([new r.V("light",n,`object expected, ${b} found`)]),y;for(const M in n){const I=M.match(/^(.*)-transition$/);y=y.concat(I&&f[I[1]]&&f[I[1]].transition?nt({key:M,value:n[M],valueSpec:o.transition,style:_,styleSpec:o}):f[M]?nt({key:M,value:n[M],valueSpec:f[M],style:_,styleSpec:o}):[new r.V(M,n[M],`unknown property "${M}"`)])}return y}function xe(h){const n=h.value;let o=[];if(!n)return o;const f=r.j(n);if(f!=="object")return o=o.concat([new r.V("light-3d",n,`object expected, ${f} found`)]),o;const _=h.styleSpec,y=_["light-3d"],b=h.key,M=h.style,I=h.style.lights;for(const k of["type","id"])if(!(k in n))return o=o.concat([new r.V("light-3d",n,`missing property ${k} on light`)]),o;if(n.type&&I)for(let k=0;k<h.arrayIndex;k++){const F=r.u(n.type),N=I[k];r.u(N.type)===F&&o.push(new r.V(b,n.id,`duplicate light type "${n.type}", previously defined at line ${N.id.__line__}`))}const D=`properties_light_${n.type}`;if(!(D in _))return o=o.concat([new r.V("light-3d",n,`Invalid light type ${n.type}`)]),o;const z=_[D];for(const k in n)if(k==="properties"){const F=n[k],N=r.j(F);if(N!=="object")return o=o.concat([new r.V("properties",F,`object expected, ${N} found`)]),o;for(const G in F)o=o.concat(z[G]?nt({key:G,value:F[G],valueSpec:z[G],style:M,styleSpec:_}):[new r.i(h.key,F[G],`unknown property "${G}"`)])}else{const F=k.match(/^(.*)-transition$/);o=o.concat(F&&y[F[1]]&&y[F[1]].transition?nt({key:k,value:n[k],valueSpec:_.transition,style:M,styleSpec:_}):y[k]?nt({key:k,value:n[k],valueSpec:y[k],style:M,styleSpec:_}):[new r.i(k,n[k],`unknown property "${k}"`)])}return o}function Ee(h){const n=h.value,o=h.key,f=h.style,_=h.styleSpec,y=_.terrain;let b=[];const M=r.j(n);if(n===void 0||M==="null")return b;if(M!=="object")return b=b.concat([new r.V("terrain",n,`object expected, ${M} found`)]),b;for(const I in n){const D=I.match(/^(.*)-transition$/);b=b.concat(D&&y[D[1]]&&y[D[1]].transition?nt({key:I,value:n[I],valueSpec:_.transition,style:f,styleSpec:_}):y[I]?nt({key:I,value:n[I],valueSpec:y[I],style:f,styleSpec:_}):[new r.i(I,n[I],`unknown property "${I}"`)])}if(n.source){const I=f.sources&&f.sources[n.source],D=I&&r.u(I.type);I?D!=="raster-dem"&&b.push(new r.V(o,n.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):b.push(new r.V(o,n.source,`source "${n.source}" not found`))}else b.push(new r.V(o,n,'terrain is missing required property "source"'));return b}function it(h){const n=h.value,o=h.style,f=h.styleSpec,_=f.fog;let y=[];const b=r.j(n);if(n===void 0)return y;if(b!=="object")return y=y.concat([new r.V("fog",n,`object expected, ${b} found`)]),y;for(const M in n){const I=M.match(/^(.*)-transition$/);y=y.concat(I&&_[I[1]]&&_[I[1]].transition?nt({key:M,value:n[M],valueSpec:f.transition,style:o,styleSpec:f}):_[M]?nt({key:M,value:n[M],valueSpec:_[M],style:o,styleSpec:f}):[new r.i(M,n[M],`unknown property "${M}"`)])}return y}const ht={"*":()=>[],array:qt,boolean:function(h){const n=h.value,o=h.key,f=r.j(n);return f!=="boolean"?[new r.V(o,n,`boolean expected, ${f} found`)]:[]},number:Ci,color:function(h){const n=h.key,o=h.value,f=r.j(o);return f!=="string"?[new r.V(n,o,`color expected, ${f} found`)]:r.z(o)===null?[new r.V(n,o,`color expected, "${o}" found`)]:[]},enum:Gn,filter:Kt,function:Ti,layer:ar,object:Ri,source:Wi,model:r.F,light:js,"light-3d":xe,terrain:Ee,fog:it,string:Nt,formatted:function(h){return Nt(h).length===0?[]:Tn(h)},resolvedImage:function(h){return Nt(h).length===0?[]:Tn(h)},projection:function(h){const n=h.value,o=h.styleSpec,f=o.projection,_=h.style;let y=[];const b=r.j(n);if(b==="object")for(const M in n)y=y.concat(nt({key:M,value:n[M],valueSpec:f[M],style:_,styleSpec:o}));else b!=="string"&&(y=y.concat([new r.V("projection",n,`object or string expected, ${b} found`)]));return y},import:function(h){const{value:n,styleSpec:o}=h,{data:f,..._}=n;Object.defineProperty(_,"__line__",{value:n.__line__,enumerable:!1});let y=Ri(r.k({},h,{value:_,valueSpec:o.import}));return r.u(_.id)===""&&y.push(new r.V(`${h.key}.id`,_,"import id can't be an empty string")),f&&(y=y.concat(Je(f,o,{key:`${h.key}.data`}))),y}};function nt(h,n=!1){const o=h.value,f=h.valueSpec,_=h.styleSpec;if(f.expression&&r.B(r.u(o)))return Ti(h);if(f.expression&&r.o(r.q(o)))return Tn(h);if(f.type&&ht[f.type]){const y=ht[f.type](h);return n===!0&&y.length>0&&r.j(h.value)==="array"?Tn(h):y}return Ri(r.k({},h,{valueSpec:f.type?_[f.type]:f}))}function Dt(h){const n=h.value,o=h.key,f=Nt(h);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new r.V(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new r.V(o,n,'"glyphs" url must include a "{range}" token'))),f}function Je(h,n=r.G,o={}){return nt({key:o.key||"",value:h,valueSpec:n.$root,styleSpec:n,style:h,objectElementValidators:{glyphs:Dt,"*":()=>[]}})}function qe(h,n=r.G){return Be(Je(h,n))}const Lt=h=>Be(Wi(h)),ft=h=>Be(js(h)),Me=h=>Be(xe(h)),Q=h=>Be(Ee(h)),te=h=>Be(it(h)),de=h=>Be(ar(h)),Ce=h=>Be(Kt(h)),ke=h=>Be(Cr(h)),He=h=>Be(Mn(h)),xt=h=>Be(r.F(h));function Be(h){return h.slice().sort((n,o)=>n.line&&o.line?n.line-o.line:0)}function bt(h,n){let o=!1;if(n&&n.length)for(const f of n)f instanceof r.i?r.w(f.message):(h.fire(new r.a(new Error(f.message))),o=!0);return o}const Et=new r.H({anchor:new r.J(r.G.light.anchor),position:new r.K(r.G.light.position),color:new r.J(r.G.light.color),intensity:new r.J(r.G.light.intensity)});class Rt extends r.E{constructor(n,o="flat"){super(),this._transitionable=new r.L(Et),this.setLight(n,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,o,f={}){this._validate(ft,n,f)||(this._transitionable.setTransitionOrValue(n),this.id=o)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,f){return(!f||f.validate!==!1)&&bt(this,n.call(qe,r.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.G})))}}const _t=new r.H({source:new r.J(r.G.terrain.source),exaggeration:new r.J(r.G.terrain.exaggeration)});let fi=class extends r.E{constructor(h,n,o,f){super(),this.scope=o,this._transitionable=new r.L(_t,o,f),this._transitionable.setTransitionOrValue(h,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(h,n){this._transitionable.setTransitionOrValue(h,n)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new r.N(h)).get("exaggeration")}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof r.Z}};const li=45,Bi=65,Oi=.05;function Fi(h,n,o,f){const _=r.S(li,Bi,o),[y,b]=Zi(h,f);let M=1-Math.min(1,Math.exp((n-y)/(b-y)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*_*h.alpha}function Zi(h,n){const o=.5/Math.tan(.5*n);return[h.range[0]+o,h.range[1]+o]}function fn(h,n,o,f,_){const y=r.Q.transformMat4([],[n,o,f],_.mercatorFogMatrix);return Fi(h,r.Q.length(y),_.pitch,_._fov)}function Xn(h,n,o,f,_,y,b){const M=[[o,f,0],[_,f,0],[_,y,0],[o,y,0]];let I=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const z of M){const k=r.Q.transformMat4([],z,n),F=r.Q.length(k);I=Math.min(I,F),D=Math.max(D,F)}return[Fi(h,I,b.pitch,b._fov),Fi(h,D,b.pitch,b._fov)]}const sn=new r.H({range:new r.J(r.G.fog.range),color:new r.J(r.G.fog.color),"high-color":new r.J(r.G.fog["high-color"]),"space-color":new r.J(r.G.fog["space-color"]),"horizon-blend":new r.J(r.G.fog["horizon-blend"]),"star-intensity":new r.J(r.G.fog["star-intensity"]),"vertical-range":new r.J(r.G.fog["vertical-range"])});class Tr extends r.E{constructor(n,o,f,_){super(),this._transitionable=new r.L(sn,f,new Map(_)),this.set(n,_),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new r.U(sn)}get state(){const n=this._transform,o=n.projection.name==="globe",f=r.W(n.zoom),_=this.properties.get("range"),y=[.5,3];return{range:o?[r.X(y[0],_[0],f),r.X(y[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,o,f={}){if(this._validate(te,n,f))return;const _=r.e({},n);for(const y of Object.keys(r.G.fog))_[y]===void 0&&(_[y]=r.G.fog[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.S(li,Bi,n))*o.a}getOpacityAtLatLng(n,o){return this._transform.projection.supportsFog?function(f,_,y){const b=r.O.fromLngLat(_),M=y.elevation?y.elevation.getAtPointOrZero(b):0;return fn(f,b.x,b.y,M,y)}(this.state,n,o):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Xn(this.state,o,0,0,r.Y,r.Y,this._transform)}getOpacityForBounds(n,o,f,_,y){return this._transform.projection.supportsFog?Xn(this.state,n,o,f,_,y,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Zi(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const f of o){const _=n.points[f];let y;if(_[2]>=0)y=_;else{const b=n.points[f-4];y=r._(b,_,b[2]/(b[2]-_[2]))}if(fn(this.state,y[0],y[1],0,this._transform)>=Oi)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,f){return(!f||f.validate!==!1)&&bt(this,n.call(qe,r.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.G})))}}class _r extends r.E{constructor(n,o,f,_){super(),this.scope=f,this._options=n,this.properties=new r.U(o),this._transitionable=new r.L(o,f,new Map(_)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,o){this._options=n,this._transitionable.setTransitionOrValue(n.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const cs=new r.H({color:new r.J(r.G.properties_light_ambient.color),intensity:new r.J(r.G.properties_light_ambient.intensity)}),zn=new r.H({direction:new r.$(r.G.properties_light_directional.direction),color:new r.J(r.G.properties_light_directional.color),intensity:new r.J(r.G.properties_light_directional.intensity),"cast-shadows":new r.J(r.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.J(r.G.properties_light_directional["shadow-intensity"])});class mn{constructor(n,o,f,_){this.screenBounds=n,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(n,o){let f,_;if(n instanceof r.P||typeof n[0]=="number"){const y=r.P.convert(n);f=[y],_=o.isPointAboveHorizon(y)}else{const y=r.P.convert(n[0]),b=r.P.convert(n[1]);f=[y,b],_=r.a0(y,b).every(M=>o.isPointAboveHorizon(M))}return new mn(f,o.getCameraPoint(),_,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.a0(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.a0(o,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(_[3]=this.cameraPoint)),r.a1(_,n)}bufferedCameraGeometryGlobe(n){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.a0(o,f,n),y=this.cameraPoint.clone();switch(3*((y.y>o.y)+(y.y>f.y))+((y.x>o.x)+(y.x>f.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(n,o,f,_=0){const y=n.queryPadding/o._pixelsPerMercatorPixel+1,b=f?this._bufferedCameraMercator(y,o):this._bufferedScreenMercator(y,o);let M=n.tileID.wrap+(b.unwrapped?_:0);const I=b.polygon.map($=>r.a2(n.tileTransform,$,M));if(!r.a3(I,0,0,r.Y,r.Y))return;M=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const D=this.screenGeometryMercator.polygon.map($=>r.a4(n.tileTransform,$,M)),z=D.map($=>new r.P($[0],$[1])),k=o.getFreeCameraOptions().position||new r.O(0,0,0),F=r.a4(n.tileTransform,k,M),N=D.map($=>{const q=r.Q.sub($,$,F);return r.Q.normalize(q,q),new r.a5(F,q)}),G=r.a6(n,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:N,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(U=r.a7(I),U.min.x=r.ad(U.min.x,0,r.Y),U.min.y=r.ad(U.min.y,0,r.Y),U.max.x=r.ad(U.max.x,0,r.Y),U.max.y=r.ad(U.max.y,0,r.Y),U),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:G};var U}_bufferedScreenMercator(n,o){const f=Ke(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),o):{polygon:this.bufferedScreenGeometry(n).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(n,o){const f=Ke(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),o):{polygon:this.bufferedCameraGeometry(n).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(n,o){const f=function(y,b){const M=r.a9.multiply([],b.pixelMatrix,b.globeMatrix),I=[0,-r.ae,0,1],D=[0,r.ae,0,1],z=[0,0,0,1];r.aa.transformMat4(I,I,M),r.aa.transformMat4(D,D,M),r.aa.transformMat4(z,z,M);const k=new r.P(I[0]/I[3],I[1]/I[3]),F=new r.P(D[0]/D[3],D[1]/D[3]),N=r.ab(y,k)&&I[3]<z[3],G=r.ab(y,F)&&D[3]<z[3];if(!N&&!G)return null;const U=function(J,he,ce){for(let ge=1;ge<J.length;ge++){const Ae=Ge(he.pointCoordinate3D(J[ge-1]).x),_e=Ge(he.pointCoordinate3D(J[ge]).x);if(ce<0){if(Ae<_e)return{idx:ge,t:-Ae/(_e-1-Ae)}}else if(_e<Ae)return{idx:ge,t:(1-Ae)/(_e+1-Ae)}}return null}(y,b,N?-1:1);if(!U)return null;const{idx:$,t:q}=U;let Y=$>1?Ue(y.slice(0,$),b):[],re=$<y.length?Ue(y.slice($),b):[];Y=Y.map(J=>new r.P(Ge(J.x),J.y)),re=re.map(J=>new r.P(Ge(J.x),J.y));const ne=[...Y];ne.length===0&&ne.push(re[re.length-1]);const oe=r.X(ne[ne.length-1].y,(re.length===0?Y[0]:re[0]).y,q);let H;return H=N?[new r.P(0,oe),new r.P(0,0),new r.P(1,0),new r.P(1,oe)]:[new r.P(1,oe),new r.P(1,1),new r.P(0,1),new r.P(0,oe)],ne.push(...H),re.length===0?ne.push(Y[0]):ne.push(...re),{polygon:ne.map(J=>new r.O(J.x,J.y)),unwrapped:!1}}(n,o);if(f)return f;const _=function(y,b){let M=!1,I=-1/0,D=0;for(let k=0;k<y.length-1;k++)y[k].x>I&&(I=y[k].x,D=k);for(let k=0;k<y.length-1;k++){const F=(D+k)%(y.length-1),N=y[F],G=y[F+1];Math.abs(N.x-G.x)>.5&&(N.x<G.x?(N.x+=1,F===0&&(y[y.length-1].x+=1)):(G.x+=1,F+1===y.length-1&&(y[0].x+=1)),M=!0)}const z=r.a8(b.center.lng);return M&&z<Math.abs(z-1)&&y.forEach(k=>{k.x-=1}),{polygon:y,unwrapped:M}}(Ue(n,o).map(y=>new r.P(Ge(y.x),y.y)),o);return{polygon:_.polygon.map(y=>new r.O(y.x,y.y)),unwrapped:_.unwrapped}}}function Ue(h,n){return r.ac(h,o=>{const f=n.pointCoordinate3D(o);o.x=f.x,o.y=f.y},1/256)}function Ge(h){return h<0?1+h%1:h%1}function Ke(h){return 100*h|0}function st(h,n,o,f,_){const y=function(b,M){if(b)return _(b);if(M){h.url&&M.tiles&&h.tiles&&delete h.tiles;const I=r.af(r.e(M,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(I.vectorLayers=M.vector_layers,I.vectorLayerIds=I.vectorLayers.map(D=>D.id)),M.raster_layers&&(I.rasterLayers=M.raster_layers,I.rasterLayerIds=I.rasterLayers.map(D=>D.id)),I.tiles=n.canonicalizeTileset(I,h.url),_(null,I)}};return h.url?r.g(n.transformRequest(n.normalizeSourceURL(h.url,null,o,f),r.R.Source),y):r.f.frame(()=>y(null,h))}class rt{constructor(n,o,f){this.bounds=r.ag.convert(this.validateBounds(n)),this.minzoom=o||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const o=Math.pow(2,n.z),f=Math.floor(r.a8(this.bounds.getWest())*o),_=Math.floor(r.ah(this.bounds.getNorth())*o),y=Math.ceil(r.a8(this.bounds.getEast())*o),b=Math.ceil(r.ah(this.bounds.getSouth())*o);return n.x>=f&&n.x<y&&n.y>=_&&n.y<b}}class pt extends r.E{constructor(n,o,f,_){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.e(this,r.af(o,["url","scheme","tileSize","promoteId"])),this._options=r.e({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new r.ai}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=st(this._options,this.map._requestManager,o,f,(_,y)=>{this._tileJSONRequest=null,this._loaded=!0,_?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new r.a(_))):y&&(r.e(this,y),y.bounds&&(this.tileBounds=new rt(y.bounds,this.minzoom,this.maxzoom)),r.am(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(_)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=r.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}loadTile(n,o){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(f,r.R.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster};if(_.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=o:n.request=n.actor.send("reloadTile",_,y.bind(this));else if(n.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",_,y.bind(this),void 0,!0);else{const b=r.ak.call({deduped:this._deduped},_,(M,I)=>{M||!I?y.call(this,M):(_.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},n.actor&&n.actor.send("loadTile",_,y.bind(this),void 0,!0))},!0);n.request={cancel:b}}function y(b,M){return delete n.request,n.aborted?o(null):b&&b.status!==404?o(b):(M&&M.resourceTiming&&(n.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&n.setExpiryData(M),n.loadVectorData(M,this.map.painter),r.al(this.dispatcher),o(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class mt extends r.E{constructor(n,o,f,_){super(),this.id=n,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.e({type:"raster"},o),r.e(this,r.af(o,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._tileJSONRequest=st(this._options,this.map._requestManager,null,null,(o,f)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new r.a(o)):f&&(r.e(this,f),f.bounds&&(this.tileBounds=new rt(f.bounds,this.minzoom,this.maxzoom)),r.am(f.tiles),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(o)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=r.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,o){const f=r.f.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=r.d(this.map._requestManager.transformRequest(_,r.R.Tile),(y,b,M,I)=>(delete n.request,n.aborted?(n.state="unloaded",o(null)):y?(n.state="errored",o(y)):b?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:M,expires:I}),n.setTexture(b,this.map.painter),n.state="loaded",r.al(this.dispatcher),void o(null)):o(null)))}abortTile(n,o){n.request&&(n.request.cancel(),delete n.request),o()}unloadTile(n,o){n.texture&&n.texture instanceof r.T?(n.destroy(!0),n.texture&&n.texture instanceof r.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ot extends mt{constructor(n,o,f,_){super(n,o,f,_),this.type="raster-array",this.maxzoom=22,this._options=r.e({type:"raster-array"},o)}triggerRepaint(n){const o=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);o&&o.enabled&&f&&o._clearRenderCacheForTile(f.id,n.tileID),this.map.triggerRepaint()}loadTile(n,o){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,r.R.Tile);n.requestParams=_,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(y,b,M,I)=>{if(delete n.request,n.aborted)return n.state="unloaded",o(null);if(y)return y.code===20?void 0:(n.state="errored",o(y));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:M,expires:I}),n.state="empty",o(null)})}unloadTile(n){const o=n.texture;o&&o instanceof r.T?(n.destroy(!0),this.map.painter.saveTileTexture(o)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,o,f){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(o,f,(_,y)=>{if(_)return n.state="errored",this.fire(new r.a(_)),void this.triggerRepaint(n);y&&(n.setTexture(y,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:y})=>y===n),f=o&&o.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(n,o,f){if(!n)return;const _=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;o instanceof r.aq?y=o.paint.get("raster-array-band"):o instanceof r.ar&&(y=o.paint.get("raster-particle-array-band"));const b=y||this.getInitialBand(_);if(b!=null)if(n.textureDescriptor){if(!n.updateNeeded(_,b)||f)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,_,b)}}const wt=32,at=33,Ht=new Uint16Array(8184);for(let h=0;h<2046;h++){let n=h+2,o=0,f=0,_=0,y=0,b=0,M=0;for(1&n?_=y=b=wt:o=f=M=wt;(n>>=1)>1;){const D=o+_>>1,z=f+y>>1;1&n?(_=o,y=f,o=b,f=M):(o=_,f=y,_=b,y=M),b=D,M=z}const I=4*h;Ht[I+0]=o,Ht[I+1]=f,Ht[I+2]=_,Ht[I+3]=y}const yi=new Uint16Array(2178),kt=new Uint8Array(1089),Qi=new Uint16Array(1089);function _n(h){return h===0?-.03125:h===32?.03125:0}class Ji{constructor(n,o,f,_){this.id=Ji.uniqueIdxCounter,Ji.uniqueIdxCounter++,this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||_||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Ji.uniqueIdxCounter,Ji.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ji.uniqueIdxCounter=0;const An={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bn{constructor(n,o,f,_,y,b){this.length=o.length,this.attributes=f,this.itemSize=o.bytesPerElement,this.dynamicDraw=_,this.instanceCount=b,this.context=n;const M=n.gl;this.buffer=M.createBuffer(),n.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,o){for(let f=0;f<this.attributes.length;f++){const _=o.attributes[this.attributes[f].name];_!==void 0&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,o,f){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],b=o.attributes[y.name];b!==void 0&&n.vertexAttribPointer(b,y.components,n[An[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(n,o,f){for(let _=0;_<this.attributes.length;_++){const y=o.attributes[this.attributes[_].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(y,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ei{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Nr extends Ei{getDefault(){return r.aA.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class us extends Ei{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class ir extends Ei{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class ko extends Ei{getDefault(){return[!0,!0,!0,!0]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class xl extends Ei{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Mr extends Ei{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ag extends Ei{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const o=this.current;(n.func!==o.func||n.ref!==o.ref||n.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class pi extends Ei{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class wh extends Ei{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=n,this.dirty=!1}}class Sr extends Ei{getDefault(){return[0,1]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Us extends Ei{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=n,this.dirty=!1}}class Gf extends Ei{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class $f extends Ei{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.BLEND):o.disable(o.BLEND),this.current=n,this.dirty=!1}}class Th extends Ei{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class qf extends Ei{getDefault(){return r.aA.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Wf extends Ei{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Hf extends Ei{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=n,this.dirty=!1}}class Zf extends Ei{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Qf extends Ei{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Gc=class extends Ei{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class ni extends Ei{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Mh extends Ei{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Oo extends Ei{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Xf extends Ei{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Yf extends Ei{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Kf extends Ei{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Jf extends Ei{getDefault(){return null}set(n){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ep extends Ei{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class tp extends Ei{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class ip extends Ei{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class np extends Ei{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class $c extends Ei{constructor(n,o){super(n),this.context=n,this.parent=o}getDefault(){return null}}class lg extends $c{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class qc extends $c{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class cg extends $c{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class ug extends qc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class hg{constructor(n,o,f,_,y){this.context=n,this.width=o,this.height=f;const b=this.framebuffer=n.gl.createFramebuffer();_&&(this.colorAttachment=new lg(n,b)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new qc(n,b):new cg(n,b))}destroy(){const n=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&n.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&n.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&n.deleteTexture(o)}n.deleteFramebuffer(this.framebuffer)}}class Vt{constructor(n,o,f){this.func=n,this.mask=o,this.range=f}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);const Sh=7680;class Xt{constructor(n,o,f,_,y,b){this.test=n,this.ref=o,this.mask=f,this.fail=_,this.depthFail=y,this.pass=b}}Xt.disabled=new Xt({func:519,mask:0},0,0,Sh,Sh,Sh);const Wc=771;class ci{constructor(n,o,f,_){this.blendFunction=n,this.blendColor=o,this.mask=f,this.blendEquation=_}}ci.Replace=[1,0,1,0],ci.disabled=new ci(ci.Replace,r.aA.transparent,[!1,!1,!1,!1]),ci.unblended=new ci(ci.Replace,r.aA.transparent,[!0,!0,!0,!0]),ci.alphaBlended=new ci([1,Wc,1,Wc],r.aA.transparent,[!0,!0,!0,!0]),ci.multiply=new ci([774,0,774,0],r.aA.transparent,[!0,!0,!0,!0]);const Eh=1029,Ah=2305;class Wt{constructor(n,o,f){this.enable=n,this.mode=o,this.frontFace=f}}Wt.disabled=new Wt(!1,Eh,Ah),Wt.backCCW=new Wt(!0,Eh,Ah),Wt.backCW=new Wt(!0,Eh,2304),Wt.frontCW=new Wt(!0,1028,2304),Wt.frontCCW=new Wt(!0,1028,Ah);class As{constructor(n,o){this.gl=n,this.clearColor=new Nr(this),this.clearDepth=new us(this),this.clearStencil=new ir(this),this.colorMask=new ko(this),this.depthMask=new xl(this),this.stencilMask=new Mr(this),this.stencilFunc=new ag(this),this.stencilOp=new pi(this),this.stencilTest=new wh(this),this.depthRange=new Sr(this),this.depthTest=new Us(this),this.depthFunc=new Gf(this),this.blend=new $f(this),this.blendFunc=new Th(this),this.blendColor=new qf(this),this.blendEquation=new Wf(this),this.cullFace=new Hf(this),this.cullFaceSide=new Zf(this),this.frontFace=new Qf(this),this.program=new Gc(this),this.activeTexture=new ni(this),this.viewport=new Mh(this),this.bindFramebuffer=new Oo(this),this.bindRenderbuffer=new Xf(this),this.bindTexture=new Yf(this),this.bindVertexBuffer=new Kf(this),this.bindElementBuffer=new Jf(this),this.bindVertexArrayOES=new ep(this),this.pixelStoreUnpack=new tp(this),this.pixelStoreUnpackPremultiplyAlpha=new ip(this),this.pixelStoreUnpackFlipY=new np(this),this.options=o?{...o}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,o,f){return new Ji(this,n,o,f)}createVertexBuffer(n,o,f,_,y){return new bn(this,n,o,f,_,y)}createRenderbuffer(n,o,f){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,n,o,f),this.bindRenderbuffer.set(null),y}createFramebuffer(n,o,f,_){return new hg(this,n,o,f,_)}clear({color:n,depth:o,stencil:f,colorMask:_}){const y=this.gl;let b=0;n&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(_||[!0,!0,!0,!0])),o!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),f!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){B(n.blendFunction,ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var dg=r.aB([{name:"a_index",type:"Int16",components:1}]);const Fo=.15000000000000002;class rp{constructor(n,o,f,_){const y={width:f[0],height:f[1],data:null},b=n.gl;this.targetColorTexture=new r.T(n,y,b.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(n,y,b.RGBA,{useMipmap:!1}),this.context=n,this.setParticleTextureDimension(o,_),this.lastInvalidatedAt=0}setParticleTextureDimension(n,o){if(this.particleTextureDimension===o)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,_=o*o,y=new Uint8Array(4*_),b=.7692307692307692,M=r.aC(n.key);for(let z=0;z<y.length;z+=4){const k=b*(M()+Fo),F=b*(M()+Fo),N=255*k%1,G=255*F%1,U=N,$=F-G/255,q=G;y[z+0]=Math.floor(255*(k-N/255)),y[z+1]=Math.floor(255*U),y[z+2]=Math.floor(255*$),y[z+3]=Math.floor(255*q)}const I=new r.h({width:o,height:o},y);this.particleTexture0=new r.T(this.context,I,f.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,I,f.RGBA,{premultiply:!1,useMipmap:!1});const D=new r.aD;D.reserve(_);for(let z=0;z<_;z++)D.emplaceBack(z);this.particleIndexBuffer=this.context.createVertexBuffer(D,dg.members,!0),this.particleSegment=r.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=r.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}const Hc={type:2,extent:r.Y,loadGeometry:()=>[[new r.P(0,0),new r.P(r.Y+1,0),new r.P(r.Y+1,r.Y+1),new r.P(0,r.Y+1),new r.P(0,0)]]};class hs{constructor(n,o,f,_,y){this.tileID=n,this.uid=r.aF(),this.uses=0,this.tileSize=o,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<r.f.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,f){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(_,y){const b={};if(!y)return b;for(const M of _){const I=M.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(I.length!==0){M.layers=I,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(D=>I.filter(z=>z.id===D)[0]));for(const D of I)b[D.fqid]=M}}return b}(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof r.aH){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof r.aH&&y.hasRTLText){this.hasRTLText=!0,r.aI();break}}this.queryPadding=0;for(const _ in this.buckets){const y=this.buckets[_],b=o.style.getOwnLayer(_);if(!b)continue;const M=b.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,M)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new r.aG}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(n)}const o=n.gl,f=this.imageAtlas;if(f&&!f.uploaded){const _=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new r.T(n,f.image,o.RGBA,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(n,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(n,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(n,o,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,f),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=o.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this._lastUpdatedBrightness=_,this.updateBuckets(void 0,o)))}queryRenderedFeatures(n,o,f,_,y,b,M,I){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:M,transform:b,params:y,tileTransform:this.tileTransform},n,o,f):{}}querySourceFeatures(n,o){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),y=o?o.sourceLayer:"",b=_._geojsonTileLayer||_[y];if(!b)return;const M=r.aJ(o&&o.filter),{z:I,x:D,y:z}=this.tileID.canonical,k={z:I,x:D,y:z};for(let F=0;F<b.length;F++){const N=b.feature(F);if(M.needGeometry){const $=r.aK(N,!0);if(!M.filter(new r.N(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!M.filter(new r.N(this.tileID.overscaledZ),N))continue;const G=f.getId(N,y),U=new r.aL(N,I,D,z,G);U.tile=k,n.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const n in this.buckets)if(this.buckets[n].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const f=r.aM(n.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{const y=this.expirationTime-o;y?this.expirationTime=f+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&o&&this.updateBuckets(n,o)}updateBuckets(n,o){if(!this.latestFeatureIndex)return;const f=this.latestFeatureIndex.loadVTLayers(),_=o.style.listImages(),y=o.style.getBrightness();for(const b in this.buckets){if(!o.style.hasLayer(b))continue;const M=this.buckets[b],I=M.layers[0].sourceLayer||"_geojsonTileLayer",D=f[I];let z={};if(n&&(z=n[I],!D||!z||Object.keys(z).length===0))continue;if(M.update(z,D,_,this.imageAtlas&&this.imageAtlas.patternPositions||{},y),M instanceof r.aN||M instanceof r.aO){const F=o.style.getOwnSourceCache(M.layers[0].source);o._terrain&&o._terrain.enabled&&F&&M.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(F.id,this.tileID)}const k=o&&o.style&&o.style.getOwnLayer(b);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=r.f.now()+n}setTexture(n,o){const f=o.context,_=f.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!0}):(this.texture=new r.T(f,n,_.RGBA,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(n,o){const f={};for(const _ of o)f[_]=!0;this.dependencies[n]=f}hasDependency(n,o){for(const f of n){const _=this.dependencies[f];if(_){for(const y of o)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const f=r.aP(Hc,this.tileID.canonical,this.tileTransform)[0],_=new r.aQ,y=new r.aR;for(let b=0;b<f.length;b++){const{x:M,y:I}=f[b];_.emplaceBack(M,I),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(y),this._tileDebugBuffer=n.createVertexBuffer(_,r.aS.members),this._tileDebugSegments=r.aE.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const f=r.aP(Hc,this.tileID.canonical,this.tileTransform)[0];let _,y;if(this.isRaster){const b=function(M,I){const D=r.av(M,I),z=Math.pow(2,M.z);for(let $=0;$<at;$++)for(let q=0;q<at;q++){const Y=r.aw((M.x+(q+_n(q))/wt)/z),re=r.ax((M.y+($+_n($))/wt)/z),ne=I.project(Y,re),oe=$*at+q;yi[2*oe+0]=Math.round((ne.x*D.scale-D.x)*r.Y),yi[2*oe+1]=Math.round((ne.y*D.scale-D.y)*r.Y)}kt.fill(0),Qi.fill(0);for(let $=2045;$>=0;$--){const q=4*$,Y=Ht[q+0],re=Ht[q+1],ne=Ht[q+2],oe=Ht[q+3],H=Y+ne>>1,J=re+oe>>1,he=H+J-re,ce=J+Y-H,ge=re*at+Y,Ae=oe*at+ne,_e=J*at+H,Te=Math.hypot((yi[2*ge+0]+yi[2*Ae+0])/2-yi[2*_e+0],(yi[2*ge+1]+yi[2*Ae+1])/2-yi[2*_e+1])>=16;kt[_e]=kt[_e]||(Te?1:0),$<1022&&(kt[_e]=kt[_e]||kt[(re+ce>>1)*at+(Y+he>>1)]||kt[(oe+ce>>1)*at+(ne+he>>1)])}const k=new r.ay,F=new r.az;let N=0;function G($,q){const Y=q*at+$;return Qi[Y]===0&&(k.emplaceBack(yi[2*Y+0],yi[2*Y+1],$*r.Y/wt,q*r.Y/wt),Qi[Y]=++N),Qi[Y]-1}function U($,q,Y,re,ne,oe){const H=$+Y>>1,J=q+re>>1;if(Math.abs($-ne)+Math.abs(q-oe)>1&&kt[J*at+H])U(ne,oe,$,q,H,J),U(Y,re,ne,oe,H,J);else{const he=G($,q),ce=G(Y,re),ge=G(ne,oe);F.emplaceBack(he,ce,ge)}}return U(0,0,wt,wt,wt,0),U(wt,wt,0,0,0,wt),{vertices:k,indices:F}}(this.tileID.canonical,o);_=b.vertices,y=b.indices}else{_=new r.ay,y=new r.az;for(const{x:M,y:I}of f)_.emplaceBack(M,I,0,0);const b=r.aT(_.int16,void 0,4);for(let M=0;M<b.length;M+=3)y.emplaceBack(b[M],b[M+1],b[M+2])}this._tileBoundsBuffer=n.createVertexBuffer(_,r.aU.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(y),this._tileBoundsSegments=r.aE.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(n,o){const f=o.projection;if(!f||f.name!=="globe"||o.freezeTileCoverage)return;const _=this.tileID.canonical,y=r.aV(_,o),b=r.aW(y),M=r.W(o.zoom);let I;M>0&&(I=r.a9.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,_,o,b,I,M),this._makeGlobeTileDebugTextBuffer(n,_,o,b,I,M)}_globePoint(n,o,f,_,y,b,M){let I=r.aX(n,o,f);if(b){const D=1<<f.z,z=r.a8(_.center.lng),k=r.ah(_.center.lat),F=(f.x+.5)/D-z;let N=0;F>.5?N=-1:F<-.5&&(N=1);let G=(n/r.Y+f.x)/D+N,U=(o/r.Y+f.y)/D;G=(G-z)*_._pixelsPerMercatorPixel+z,U=(U-k)*_._pixelsPerMercatorPixel+k;const $=[G*_.worldSize,U*_.worldSize,0];r.Q.transformMat4($,$,b),I=r.aY(I,$,M)}return r.Q.transformMat4(I,I,y)}_makeGlobeTileDebugBorderBuffer(n,o,f,_,y,b){const M=new r.aQ,I=new r.aR,D=new r.aZ,z=(F,N,G,U,$)=>{const q=(G-F)/($-1),Y=(U-N)/($-1),re=M.length;for(let ne=0;ne<$;ne++){const oe=F+ne*q,H=N+ne*Y;M.emplaceBack(oe,H);const J=this._globePoint(oe,H,o,f,_,y,b);D.emplaceBack(J[0],J[1],J[2]),I.emplaceBack(re+ne)}},k=r.Y;z(0,0,k,0,16),z(k,0,k,k,16),z(k,k,0,k,16),z(0,k,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(I),this._tileDebugBuffer=n.createVertexBuffer(M,r.aS.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(D,r.a_.members),this._tileDebugSegments=r.aE.simpleSegment(0,0,M.length,I.length)}_makeGlobeTileDebugTextBuffer(n,o,f,_,y,b){const M=r.Y/4,I=new r.aQ,D=new r.az,z=new r.aZ,k=25;D.reserve(32),I.reserve(k),z.reserve(k);const F=(N,G)=>k*N+G;for(let N=0;N<k;N++){const G=N*M;for(let U=0;U<k;U++){const $=U*M;I.emplaceBack($,G);const q=this._globePoint($,G,o,f,_,y,b);z.emplaceBack(q[0],q[1],q[2])}}for(let N=0;N<4;N++)for(let G=0;G<4;G++){const U=F(N,G),$=F(N,G+1),q=F(N+1,G),Y=F(N+1,G+1);D.emplaceBack(U,$,q),D.emplaceBack(q,$,Y)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(D),this._tileDebugTextBuffer=n.createVertexBuffer(I,r.aS.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(z,r.a_.members),this._tileDebugTextSegments=r.aE.simpleSegment(0,0,k,32)}destroy(n=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const ct={vector:pt,raster:mt,"raster-dem":class extends mt{constructor(h,n,o,f){super(h,n,o,f),this.type="raster-dem",this.maxzoom=22,this._options=r.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(h,n){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,y){_&&(h.state="errored",n(_)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",n(null))}h.request=r.d(this.map._requestManager.transformRequest(o,r.R.Tile),(function(_,y,b,M){if(delete h.request,h.aborted)h.state="unloaded",n(null);else if(_)h.state="errored",n(_);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:M});const I=ImageBitmap&&y instanceof ImageBitmap&&r.an(),D=1-(y.width-r.ao(y.width))/2;D<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const z=I?y:r.f.getImageData(y,D),k={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:D};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",k,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const n=h.canonical,o=Math.pow(2,n.z),f=(n.x-1+o)%o,_=n.x===0?h.wrap-1:h.wrap,y=(n.x+1+o)%o,b=n.x+1===o?h.wrap+1:h.wrap,M={};return M[new r.ap(h.overscaledZ,_,n.z,f,n.y).key]={backfilled:!1},M[new r.ap(h.overscaledZ,b,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(M[new r.ap(h.overscaledZ,_,n.z,f,n.y-1).key]={backfilled:!1},M[new r.ap(h.overscaledZ,h.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new r.ap(h.overscaledZ,b,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<o&&(M[new r.ap(h.overscaledZ,_,n.z,f,n.y+1).key]={backfilled:!1},M[new r.ap(h.overscaledZ,h.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new r.ap(h.overscaledZ,b,n.z,y,n.y+1).key]={backfilled:!1}),M}},"raster-array":ot,geojson:class extends r.E{constructor(h,n,o,f){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(f),this._data=n.data,this._options=r.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=r.Y/this.tileSize;this.workerOptions=r.e({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:r.Y,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.Y,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){return this._options.dynamic?(this._data=h,this._updateWorkerData(!0),this):this.fire(new r.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(h,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterChildren(h,n){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterLeaves(h,n,o,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:n,offset:o},f),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.b("dataloading",{dataType:"source"})),this._loaded=!1;const n=r.e({append:h},this.workerOptions);n.scope=this.scope;const o=this._data;typeof o=="string"?(n.request=this.map._requestManager.transformRequest(r.f.resolveURL(o),r.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new r.a(f));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),this.fire(new r.b("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,n){const o=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const f={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};h.request=this.actor.send(o,f,(_,y)=>(delete h.request,h.destroy(),h.aborted?n(null):_?n(_):(h.loadVectorData(y,this.map.painter,o==="reloadTile"),n(null))),void 0,o==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.as{constructor(h,n,o,f){super(h,n,o,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const n of h.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.R.Source).url);r.at(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new r.a(n)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const n=this.video.seekable;h<n.start(0)||h>n.end(0)?this.fire(new r.a(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,n=h.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(h,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.as,model:class extends r.E{constructor(h,n,o,f){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const h=[];for(const n in this._options.models){const o=this._options.models[n],f=r.l(this.map._requestManager.transformRequest(o.uri,r.R.Model).url).then(_=>{if(!_)return;const y=r.c(_),b=new r.M(n,o.position,o.orientation,y);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(_=>{this.fire(new r.a(new Error(`Could not load model ${n} from ${o.uri}: ${_.message}`)))});h.push(f)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new r.a(new Error(`Could not load models: ${n.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,n){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(h,n,o,f){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=st(this._options,this.map._requestManager,n,o,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new r.a(f))):_&&(r.e(this,_),_.bounds&&(this.tileBounds=new rt(_.bounds,this.minzoom,this.maxzoom)),r.am(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),h&&h(f)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,n){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(o,r.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=n;else{if(h.buckets){const y=Object.values(h.buckets);for(const b of y)b.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",f,_.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(y,b){return h.aborted?n(null):y&&y.status!==404?n(y):(b&&(b.resourceTiming&&(h.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&h.setExpiryData(b),h.buckets={...h.buckets,...b.buckets},b.featureIndex&&(h.latestFeatureIndex=b.featureIndex)),h.state="loaded",void n(null))}}serialize(){return r.e({},this._options)}},canvas:class extends r.as{constructor(h,n,o,f){super(h,n,o,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new r.a(new r.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.a(new r.V(`sources.${h}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.a(new r.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new r.a(new r.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.a(new r.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof r.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends r.E{constructor(h,n,o,f){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new rt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.e(this,r.af(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:n,y:o,z:f}=h.canonical;return this._implementation.hasTile({x:n,y:o,z:f})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,n){const{x:o,y:f,z:_}=h.tileID.canonical,y=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:o,y:f,z:_},{signal:y.signal})).then((function(b){return delete h.request,h.aborted?(h.state="unloaded",n(null)):b===void 0?(h.state="errored",n(null)):b===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",n(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(b)?(this.loadTileData(h,b),h.state="loaded",void n(null)):(h.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.code!==20&&(h.state="errored",n(b))}),h.request.cancel=()=>y.abort()}loadTileData(h,n){h.setTexture(n,this._map.painter)}unloadTile(h,n){if(h.texture&&h.texture instanceof r.T?(h.destroy(!0),h.texture&&h.texture instanceof r.T&&this._map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:o,y:f,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:o,y:f,z:_})}n()}abortTile(h,n){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=r.aj(this.id,this.scope);this._map.style.clearSource(h)}_update(){this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}}},Ih=function(h,n,o,f){const _=new ct[n.type](h,n,o,f);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return r.a$(["load","abort","unload","serialize","prepare"],_),_};function Ch(h,n){const o=r.a9.identity([]);return r.a9.scale(o,o,[.5*h.width,.5*-h.height,1]),r.a9.translate(o,o,[1,-1,0]),r.a9.multiply(o,o,h.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(o)}function Mi(h,n,o,f,_,y,b,M=!1){const I=h.tilesIn(f,b,M);I.sort(sp);const D=[];for(const k of I)D.push({wrappedTileID:k.tile.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(n,o,h._state,k,_,y,Ch(h.transform,k.tile.tileID),M)});const z=function(k){const F={},N={};for(const G of k){const U=G.queryResults,$=G.wrappedTileID,q=N[$]=N[$]||{};for(const Y in U){const re=U[Y],ne=q[Y]=q[Y]||{},oe=F[Y]=F[Y]||[];for(const H of re)ne[H.featureIndex]||(ne[H.featureIndex]=!0,oe.push(H))}}return F}(D);for(const k in z)z[k].forEach(F=>{const N=F.feature,G=N.layer;G&&G.type!=="background"&&G.type!=="sky"&&G.type!=="slot"&&(N.source=G.source,G["source-layer"]&&(N.sourceLayer=G["source-layer"]),N.state=N.id!==void 0?h.getFeatureState(G["source-layer"],N.id):{})});return z}function Er(h,n){const o=h.getRenderableIds().map(y=>h.getTileByID(y)),f=[],_={};for(let y=0;y<o.length;y++){const b=o[y],M=b.tileID.canonical.key;_[M]||(_[M]=!0,b.querySourceFeatures(f,n))}return f}function sp(h,n){const o=h.tileID,f=n.tileID;return o.overscaledZ-f.overscaledZ||o.canonical.y-f.canonical.y||o.wrap-f.wrap||o.canonical.x-f.canonical.x}class Zc extends hs{constructor(n,o,f,_,y){super(n,o,f,_,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,o){const f=o.context,_=f.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new r.T(f,n,_.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,o){const f=this._mrt=new r.b0(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=r.b1(_,(y,b,M,I)=>{if(y)o(y);else try{const D=f.getHeaderLength(b);if(D>n)return void(this.request=this.fetchHeader(D,o));f.parseHeader(b),this._isHeaderLoaded=!0;let z=0;for(const k of Object.values(f.layers))z=Math.max(z,k.dataIndex[k.dataIndex.length-1].last_byte);b.byteLength>=z&&(this.entireBuffer=b),o(null,this.entireBuffer||b,M,I)}catch(D){o(D)}}),this.request}fetchBand(n,o,f){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void f(new Error("Tile header is not ready"));const y=this.actor;if(!y)return void f(new Error("Can't fetch tile band without an actor"));let b;const M=(k,F)=>{b.complete(k,F),k?f(k):(this.updateTextureDescriptor(n,o),f(null,this.textureDescriptor&&this.textureDescriptor.img))},I=(k,F)=>{if(k)return f(k);const N=y.send("decodeRasterArray",{buffer:F,task:b},M,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),b.cancel()})},D=_.getLayer(n);if(!D)return void f(new Error(`Unknown sourceLayer "${n}"`));if(D.hasDataForBand(o))return this.updateTextureDescriptor(n,o),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const z=D.getDataRange([o]);if(b=_.createDecodingTask(z),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)I(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),F=r.b1(k,I);this._fetchQueue.push(()=>{F.cancel(),b.cancel()})}else f(null)}updateNeeded(n,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,o){if(!this._mrt)return;const f=this._mrt.getLayer(n);if(!f||!f.hasBand(o)||!f.hasDataForBand(o))return;const{bytes:_,tileSize:y,buffer:b,offset:M,scale:I}=f.getBandView(o),D=y+2*b,z={data:_,width:D,height:D},k=this.texture;k&&k instanceof r.T&&k.update(z,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:o,img:z,buffer:b,offset:M,tileSize:y,format:f.pixelFormat,mix:[I,256*I,65536*I,16777216*I]}}}class op{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,f){const _=n.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const y={value:o,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(n,y)},f)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const f=n.wrapped().key,_=o===void 0?0:this.data[f].indexOf(o),y=this.data[f][_];return this.data[f].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const f in this.data)for(const _ of this.data[f])n(_.value)||o.push(_);for(const f of o)this.remove(f.value.tileID,f)}}class ds extends r.E{constructor(n,o,f){super(),this.id=n,this._onlySymbols=f,o.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new op(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ui,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="errored"&&(o.state!=="loaded"||!o.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const f=this._tiles[o];f.upload(n),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.b2(this._tiles).map(n=>n.tileID).sort(mi).map(n=>n.key)}getRenderableIds(n,o){const f=[];for(const _ in this._tiles)this._isIdRenderable(+_,n,o)&&f.push(this._tiles[_]);return n?f.sort((_,y)=>{const b=_.tileID,M=y.tileID,I=new r.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),D=new r.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-M.overscaledZ||D.y-I.y||D.x-I.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(mi).map(_=>_.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o,f){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())&&(f||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const f=this._tiles[n];f&&(f.state!=="loading"&&(f.state=o),this._loadTile(f,this._tileLoaded.bind(this,f,n,o)))}_tileLoaded(n,o,f,_){if(_)if(n.state="errored",_.status!==404)this._source.fire(new r.a(_,{tile:n}));else{if(!(n.tileID.key in this._loadedParentTiles))return void this._source.fire(new r.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=r.f.now(),f==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new r.b("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let _=0;_<o.length;_++){const y=o[_];if(n.neighboringTiles&&n.neighboringTiles[y]){const b=this.getTileByID(y);f(n,b),f(b,n)}}function f(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-_.tileID.canonical.x;const M=y.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),D=y.tileID.key;b===0&&M===0||Math.abs(M)>1||(Math.abs(b)>1&&(Math.abs(b+I)===1?b+=I:Math.abs(b-I)===1&&(b-=I)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,b,M),_.neighboringTiles&&_.neighboringTiles[D]&&(_.neighboringTiles[D].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,f,_){for(const y in this._tiles){let b=this._tiles[y];if(_[y]||!b.hasData()||b.tileID.overscaledZ<=o||b.tileID.overscaledZ>f)continue;let M=b.tileID;for(;b&&b.tileID.overscaledZ>o+1;){const D=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[D.key],b&&b.hasData()&&(M=D)}let I=M;for(;I.overscaledZ>o;)if(I=I.scaledTo(I.overscaledZ-1),n[I.key]){_[M.key]=M;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const f=this._loadedParentTiles[n.key];return f&&f.tileID.overscaledZ>=o?f:null}for(let f=n.overscaledZ-1;f>=o;f--){const _=n.scaledTo(f),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const f=Math.ceil(n.width/o)+1,_=Math.ceil(n.height/o)+1,y=Math.floor(f*_*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(M)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const f={};for(const _ in this._tiles){const y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),f[y.tileID.key]=y}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(n,o,f,_){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let y;if(this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)y=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new r.ap(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y));else if(this.tileCoverLift!==0){const I=n.clone();I.tileCoverLift=this.tileCoverLift,y=I.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&n.projection.name==="globe"&&(y.push(new r.ap(1,0,1,0,0)),y.push(new r.ap(1,0,1,1,0)),y.push(new r.ap(1,0,1,0,1)),y.push(new r.ap(1,0,1,1,1)))}else y=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(y=y.filter(I=>this._source.hasTile(I)));else y=[];if(y.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!vl(this._source.type)){const I=n.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),D=Math.min(I,this._source.maxzoom),z=n.extendTileCoverForShadows(y,_,D);for(const k of z)this._shadowCasterTiles[k.key]=!0,y.push(k)}const b=this._updateRetainedTiles(y);if(vl(this._source.type)&&y.length!==0){const I={},D={},z=Object.keys(b);for(const F of z){const N=b[F],G=this._tiles[F];if(!G||G.fadeEndTime&&G.fadeEndTime<=r.f.now())continue;const U=this.findLoadedParent(N,Math.max(N.overscaledZ-ds.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),I[U.tileID.key]=U.tileID),D[F]=N}const k=y[y.length-1].overscaledZ;for(const F in this._tiles){const N=this._tiles[F];if(b[F]||!N.hasData())continue;let G=N.tileID;for(;G.overscaledZ>k;){G=G.scaledTo(G.overscaledZ-1);const U=this._tiles[G.key];if(U&&U.hasData()&&D[G.key]){b[F]=N.tileID;break}}}for(const F in I)b[F]||(this._coveredTiles[F]=!0,b[F]=I[F])}for(const I in b)this._tiles[I].clearFadeHold();const M=r.b3(this._tiles,b);for(const I of M){const D=this._tiles[I];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+I)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const f={},_=n.reduce((D,z)=>Math.min(D,z.overscaledZ),1/0),y=n[0].overscaledZ,b=Math.max(y-ds.maxOverzooming,this._source.minzoom),M=Math.max(y+ds.maxUnderzooming,this._source.minzoom),I={};for(const D of n){const z=this._addTile(D);o[D.key]=D,z.hasData()||_<this._source.maxzoom&&(I[D.key]=D)}this._retainLoadedChildren(I,_,M,o);for(const D of n){let z=this._tiles[D.key];if(z.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const F=D.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){o[F.key]=F;continue}}else{const F=D.children(this._source.maxzoom);if(o[F[0].key]&&o[F[1].key]&&o[F[2].key]&&o[F[3].key])continue}let k=z.wasRequested();for(let F=D.overscaledZ-1;F>=b;--F){const N=D.scaledTo(F);if(f[N.key]||(f[N.key]=!0,z=this.getTile(N),!z&&k&&(z=this._addTile(N)),z&&(o[N.key]=N,k=z.wasRequested(),z.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let f,_=this._tiles[n].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}o.push(_.key);const y=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;_=y}for(const y of o)this._loadedParentTiles[y]=f}}_addTile(n){let o=this._tiles[n.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const f=!!o;if(!f){const _=this.map?this.map.painter:null,y=this._source.tileSize*n.overscaleFactor();o=this._source.type==="raster-array"?new Zc(n,y,this.transform.tileZoom,_,this._isRaster):new hs(n,y,this.transform.tileZoom,_,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,f||this._source.fire(new r.b("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const f=o.getExpiryTimeout();f&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},f))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,f){const _=[],y=this.transform;if(!y)return _;const b=y.projection.name==="globe",M=r.a8(y.center.lng);for(const I in this._tiles){const D=this._tiles[I];if(f&&D.clearQueryDebugViz(),D.holdingForFade())continue;let z;if(b){const k=D.tileID.canonical;if(k.z===0){const F=[Math.abs(r.ad(M,...Gs(k,-1))-M),Math.abs(r.ad(M,...Gs(k,1))-M)];z=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(r.ad(M,...Gs(k,-1))-M),Math.abs(r.ad(M,...Gs(k,0))-M),Math.abs(r.ad(M,...Gs(k,1))-M)];z=[F.indexOf(Math.min(...F))-1]}}else z=[0];for(const k of z){const F=n.containsTile(D,y,o,k);F&&_.push(F)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,o){const f=this.getRenderableIds(n,o).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(const y of f)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return f}sortCoordinatesByDistance(n){const o=n.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(const b of o){const M=1/(1<<b.canonical.z);y[b.key]=((b.canonical.x+.5)*M+b.wrap-f[0])*_[0]+((b.canonical.y+.5)*M-f[1])*_[1]-f[2]*_[2]}return o.sort((b,M)=>y[b.key]-y[M.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(vl(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=r.f.now())return!0}return!1}setFeatureState(n,o,f){this._state.updateState(n=n||"_geojsonTileLayer",o,f)}removeFeatureState(n,o,f){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,f)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,f){const _=this._tiles[n];_&&_.setDependencies(o,f)}reloadTilesForDependencies(n,o){for(const f in this._tiles)this._tiles[f].hasDependency(n,o)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(n,o))}_preloadTiles(n,o){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(n,o))};return void this._source.on("data",I)}const f=new Map,_=Array.isArray(n)?n:[n],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const I of _){const D=I.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of D)f.set(z.key,z);this.usedForTerrain&&I.updateElevation(!1)}const M=Array.from(f.values());r.b4(M,(I,D)=>{const z=new hs(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,k=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),D(k,z)})},o)}}function mi(h,n){const o=Math.abs(2*h.wrap)-+(h.wrap<0),f=Math.abs(2*n.wrap)-+(n.wrap<0);return h.overscaledZ-n.overscaledZ||f-o||n.canonical.y-h.canonical.y||n.canonical.x-h.canonical.x}function vl(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Gs(h,n){const o=1<<h.z;return[h.x/o+n,(h.x+1)/o+n]}ds.maxOverzooming=10,ds.maxUnderzooming=3;class Ph{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,o=!1;for(const f in this.style._mergedLayers){const _=this.style._mergedLayers[f];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:n,visibilityChanged:o});else if(_.type==="model"){const y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:n,visibilityChanged:o})}}}onNewFrame(n){this.layersGotHidden=!1;for(const o of this.layers){const f=o.layer;let _=!1;f.type==="fill-extrusion"?_=!f.isHidden(n)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(_=!f.isHidden(n)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&o.visible,o.visible=_}}updateZOffset(n,o){this.currentBuildingBuckets=[];for(const _ of this.layers){const y=_.layer,b=this.style.getLayerSourceCache(y);let M=1;y.type==="fill-extrusion"&&(M=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0);let I=b?b.getTile(o):null;if(!I&&b&&o.canonical.z>b.getSource().minzoom){let D=o.scaledTo(Math.min(b.getSource().maxzoom,o.overscaledZ-1));for(;D.overscaledZ>=b.getSource().minzoom&&(I=b.getTile(D),!I&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:I?I.getBucket(y):null,tileID:I?I.tileID:o,verticalScale:M})}n.hasAnyZOffset=!1;let f=!1;for(let _=0;_<n.symbolInstances.length;_++){const y=n.symbolInstances.get(_),b=y.zOffset,M=this._getHeightAtTileOffset(o,y.tileAnchorX,y.tileAnchorY);y.zOffset=M!==Number.NEGATIVE_INFINITY?M:b,f||b===y.zOffset||(f=!0),n.hasAnyZOffset||y.zOffset===0||(n.hasAnyZOffset=!0)}f&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,o,f,_){let y=o,b=f;if(n.canonical.z!==_.canonical.z){const M=_.canonical,I=1/(1<<n.canonical.z-M.z);y=(o+n.canonical.x*r.Y)*I-M.x*r.Y|0,b=(f+n.canonical.y*r.Y)*I-M.y*r.Y|0}return{tileX:y,tileY:b}}_getHeightAtTileOffset(n,o,f){let _,y;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;const{bucket:M,tileID:I,verticalScale:D}=this.currentBuildingBuckets[b];if(!M)continue;const{tileX:z,tileY:k}=this._mapCoordToOverlappingTile(n,o,f,I),F=M.getHeightAtTileCoord(z,k);F&&F.height!==void 0&&(F.hidden?_=F.height:y=Math.max(F.height*D,y||0))}if(y!==void 0)return y;for(let b=0;b<this.layers.length;++b){const M=this.layers[b];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:I,tileID:D}=this.currentBuildingBuckets[b];if(!I)continue;const{tileX:z,tileY:k}=this._mapCoordToOverlappingTile(n,o,f,D),F=I.getHeightAtTileCoord(z,k);if(F&&!F.hidden)return F.height===void 0&&_!==void 0?Math.min(F.maxHeight,_)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Qr(h,n){const o={};for(const f in h)f!=="ref"&&(o[f]=h[f]);return r.b5.forEach(f=>{f in n&&(o[f]=n[f])}),o}function ap(h){h=h.slice();const n=Object.create(null);for(let o=0;o<h.length;o++)n[h[o].id]=h[o];for(let o=0;o<h.length;o++)"ref"in h[o]&&(h[o]=Qr(h[o],n[h[o].ref]));return h}const zi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Qc(h,n,o){o.push({command:zi.addSource,args:[h,n[h]]})}function Dh(h,n,o){n.push({command:zi.removeSource,args:[h]}),o[h]=!0}function lp(h,n,o,f){Dh(h,o,f),Qc(h,n,o)}function Rh(h,n,o){let f;for(f in h[o])if(h[o].hasOwnProperty(f)&&f!=="data"&&!B(h[o][f],n[o][f]))return!1;for(f in n[o])if(n[o].hasOwnProperty(f)&&f!=="data"&&!B(h[o][f],n[o][f]))return!1;return!0}function Bo(h,n,o,f,_,y){let b;for(b in n=n||{},h=h||{})h.hasOwnProperty(b)&&(B(h[b],n[b])||o.push({command:y,args:[f,b,n[b],_]}));for(b in n)n.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(B(h[b],n[b])||o.push({command:y,args:[f,b,n[b],_]}))}function fa(h){return h.id}function bl(h,n){return h[n.id]=n,h}class $s{constructor(n,o){this.reset(n,o)}reset(n,o){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.ad(n,0,1);let o=1,f=this._distances[o];const _=n*this.paddedLength+this.padding;for(;f<_&&o<this._distances.length;)f=this._distances[++o];const y=o-1,b=this._distances[y],M=f-b,I=M>0?(_-b)/M:0;return this.points[y].mult(1-I).add(this.points[o].mult(I))}}class zh{constructor(n,o,f){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(o/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=o,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,o,f,_,y){this._forEachCell(o,f,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(n,o,f,_){this._forEachCell(o-_,f-_,o+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(o),this.circles.push(f),this.circles.push(_)}_insertBoxCell(n,o,f,_,y,b){this.boxCells[y].push(b)}_insertCircleCell(n,o,f,_,y,b){this.circleCells[y].push(b)}_query(n,o,f,_,y,b){if(f<0||n>this.width||_<0||o>this.height)return!y&&[];const M=[];if(n<=0&&o<=0&&this.width<=f&&this.height<=_){if(y)return!0;for(let I=0;I<this.boxKeys.length;I++)M.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const D=this.circles[3*I],z=this.circles[3*I+1],k=this.circles[3*I+2];M.push({key:this.circleKeys[I],x1:D-k,y1:z-k,x2:D+k,y2:z+k})}return b?M.filter(b):M}return this._forEachCell(n,o,f,_,this._queryCell,M,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?M.length>0:M}_queryCircle(n,o,f,_,y){const b=n-f,M=n+f,I=o-f,D=o+f;if(M<0||b>this.width||D<0||I>this.height)return!_&&[];const z=[];return this._forEachCell(b,I,M,D,this._queryCellCircle,z,{hitTest:_,circle:{x:n,y:o,radius:f},seenUids:{box:{},circle:{}}},y),_?z.length>0:z}query(n,o,f,_,y){return this._query(n,o,f,_,!1,y)}hitTest(n,o,f,_,y){return this._query(n,o,f,_,!0,y)}hitTestCircle(n,o,f,_){return this._queryCircle(n,o,f,!0,_)}_queryCell(n,o,f,_,y,b,M,I){const D=M.seenUids,z=this.boxCells[y];if(z!==null){const F=this.bboxes;for(const N of z)if(!D.box[N]){D.box[N]=!0;const G=4*N;if(n<=F[G+2]&&o<=F[G+3]&&f>=F[G+0]&&_>=F[G+1]&&(!I||I(this.boxKeys[N]))){if(M.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[N],x1:F[G],y1:F[G+1],x2:F[G+2],y2:F[G+3]})}}}const k=this.circleCells[y];if(k!==null){const F=this.circles;for(const N of k)if(!D.circle[N]){D.circle[N]=!0;const G=3*N;if(this._circleAndRectCollide(F[G],F[G+1],F[G+2],n,o,f,_)&&(!I||I(this.circleKeys[N]))){if(M.hitTest)return b.push(!0),!0;{const U=F[G],$=F[G+1],q=F[G+2];b.push({key:this.circleKeys[N],x1:U-q,y1:$-q,x2:U+q,y2:$+q})}}}}}_queryCellCircle(n,o,f,_,y,b,M,I){const D=M.circle,z=M.seenUids,k=this.boxCells[y];if(k!==null){const N=this.bboxes;for(const G of k)if(!z.box[G]){z.box[G]=!0;const U=4*G;if(this._circleAndRectCollide(D.x,D.y,D.radius,N[U+0],N[U+1],N[U+2],N[U+3])&&(!I||I(this.boxKeys[G])))return b.push(!0),!0}}const F=this.circleCells[y];if(F!==null){const N=this.circles;for(const G of F)if(!z.circle[G]){z.circle[G]=!0;const U=3*G;if(this._circlesCollide(N[U],N[U+1],N[U+2],D.x,D.y,D.radius)&&(!I||I(this.circleKeys[G])))return b.push(!0),!0}}}_forEachCell(n,o,f,_,y,b,M,I){const D=this._convertToXCellCoord(n),z=this._convertToYCellCoord(o),k=this._convertToXCellCoord(f),F=this._convertToYCellCoord(_);for(let N=D;N<=k;N++)for(let G=z;G<=F;G++)if(y.call(this,n,o,f,_,this.xCellCount*G+N,b,M,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,o,f,_,y,b){const M=_-n,I=y-o,D=f+b;return D*D>M*M+I*I}_circleAndRectCollide(n,o,f,_,y,b,M){const I=(b-_)/2,D=Math.abs(n-(_+I));if(D>I+f)return!1;const z=(M-y)/2,k=Math.abs(o-(y+z));if(k>z+f)return!1;if(D<=I||k<=z)return!0;const F=D-I,N=k-z;return F*F+N*N<=f*f}}const gn={unknown:0,flipRequired:1,flipNotRequired:2},ho=Math.tan(85*Math.PI/180);function wl(h,n,o,f,_,y,b){const M=r.a9.create();if(o)if(y.name==="globe"){const I=r.b6(_,n);r.a9.multiply(M,M,I)}else{const I=r.b7.invert([],b);M[0]=I[0],M[1]=I[1],M[4]=I[2],M[5]=I[3],f||r.a9.rotateZ(M,M,_.angle)}else r.a9.multiply(M,_.labelPlaneMatrix,h);return M}function Tl(h,n,o,f,_,y,b){const M=wl(h,n,o,f,_,y,b);return y.name==="globe"&&o||(M[2]=M[6]=M[10]=M[14]=0),M}function qs(h,n,o,f,_,y,b){if(o){if(y.name==="globe"){const M=wl(h,n,o,f,_,y,b);return r.a9.invert(M,M),r.a9.multiply(M,h,M),M}{const M=r.a9.clone(h),I=r.a9.identity([]);return I[0]=b[0],I[1]=b[1],I[4]=b[2],I[5]=b[3],r.a9.multiply(M,M,I),f||r.a9.rotateZ(M,M,-_.angle),M}}return _.glCoordMatrix}function Vr(h,n,o,f){const _=[h,n,o,1];o?r.aa.transformMat4(_,_,f):kh(_,_,f);const y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function Xc(h,n){return Math.min(.5+h/n*.5,1.5)}function Yc(h,n){const o=h[0]/h[3],f=h[1]/h[3];return o>=-n[0]&&o<=n[0]&&f>=-n[1]&&f<=n[1]}function Kc(h,n,o,f,_,y,b,M,I,D){const z=o.transform,k=f?h.textSizeData:h.iconSizeData,F=r.b8(k,o.transform.zoom),N=z.projection.name==="globe",G=[256/o.width*2+1,256/o.height*2+1],U=f?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;U.clear();let $=null;N&&($=f?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const q=h.lineVertexArray,Y=f?h.text.placedSymbolArray:h.icon.placedSymbolArray,re=o.transform.width/o.transform.height;let ne,oe=!1;for(let H=0;H<Y.length;H++){const J=Y.get(H),{numGlyphs:he,writingMode:ce}=J;if(ce!==r.b9.vertical||oe||ne===r.b9.horizontal||(oe=!0),ne=ce,(J.hidden||ce===r.b9.vertical)&&!oe){Vo(he,U);continue}oe=!1;const ge=new r.P(J.tileAnchorX,J.tileAnchorY);let{x:Ae,y:_e,z:Te}=z.projection.projectTilePoint(ge.x,ge.y,D.canonical);if(I){const[vt,At,Ot]=I(ge);Ae+=vt,_e+=At,Te+=Ot}const Pe=[Ae,_e,Te,1];if(r.aa.transformMat4(Pe,Pe,n),!Yc(Pe,G)){Vo(he,U);continue}const me=Pe[3],be=Xc(o.transform.getCameraToCenterDistance(z.projection),me),Ze=r.ba(k,F,J),ye=b?Ze/be:Ze*be,Se=Vr(Ae,_e,Te,_);if(Se[3]<=0){Vo(he,U);continue}let Ie={};const se=b?null:I,je=pa(J,ye,!1,M,n,_,y,h.glyphOffsetArray,q,U,$,Se,ge,Ie,re,se,z.projection,D,b);oe=je.useVertical,se&&je.needsFlipping&&(Ie={}),(je.notEnoughRoom||oe||je.needsFlipping&&pa(J,ye,!0,M,n,_,y,h.glyphOffsetArray,q,U,$,Se,ge,Ie,re,se,z.projection,D,b).notEnoughRoom)&&Vo(he,U)}f?(h.text.dynamicLayoutVertexBuffer.updateData(U),$&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData($)):(h.icon.dynamicLayoutVertexBuffer.updateData(U),$&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData($))}function Ml(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U){const{lineStartIndex:$,glyphStartIndex:q,segment:Y}=M,re=q+M.numGlyphs,ne=$+M.lineLength,oe=n.getoffsetX(q),H=n.getoffsetX(re-1),J=No(h*oe,o,f,_,y,b,Y,$,ne,I,D,z,k,F,!0,N,G,U);if(!J)return null;const he=No(h*H,o,f,_,y,b,Y,$,ne,I,D,z,k,F,!0,N,G,U);return he?{first:J,last:he}:null}function fo(h,n,o,f){return h===r.b9.horizontal&&Math.abs(f)>Math.abs(o)?{useVertical:!0}:h===r.b9.vertical?f>0?{needsFlipping:!0}:null:n!==gn.unknown&&function(_,y){return _===0||Math.abs(y/_)>ho}(o,f)?n===gn.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function pa(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U,$,q,Y){const re=n/24,ne=h.lineOffsetX*re,oe=h.lineOffsetY*re,{lineStartIndex:H,glyphStartIndex:J,numGlyphs:he,segment:ce,writingMode:ge,flipState:Ae}=h,_e=H+h.lineLength,Te=Pe=>{if(z){const[ye,Se,Ie]=Pe.up,se=D.length;r.bb(z,se+0,ye,Se,Ie),r.bb(z,se+1,ye,Se,Ie),r.bb(z,se+2,ye,Se,Ie),r.bb(z,se+3,ye,Se,Ie)}const[me,be,Ze]=Pe.point;r.bc(D,me,be,Ze,Pe.angle)};if(he>1){const Pe=Ml(re,M,ne,oe,o,k,F,h,I,y,N,U,!1,$,q,Y);if(!Pe)return{notEnoughRoom:!0};if(f&&!o){let[me,be,Ze]=Pe.first.point,[ye,Se,Ie]=Pe.last.point;[me,be]=Vr(me,be,Ze,b),[ye,Se]=Vr(ye,Se,Ie,b);const se=fo(ge,Ae,(ye-me)*G,Se-be);if(h.flipState=se&&se.needsFlipping?gn.flipRequired:gn.flipNotRequired,se)return se}Te(Pe.first);for(let me=J+1;me<J+he-1;me++){const be=No(re*M.getoffsetX(me),ne,oe,o,k,F,ce,H,_e,I,y,N,U,!1,!1,$,q,Y);if(!be)return D.length-=4*(me-J),{notEnoughRoom:!0};Te(be)}Te(Pe.last)}else{if(f&&!o){const me=Vr(F.x,F.y,0,_),be=H+ce+1,Ze=new r.P(I.getx(be),I.gety(be)),ye=Vr(Ze.x,Ze.y,0,_),Se=ye[3]>0?ye:Lh(F,Ze,me,1,_,void 0,$,q.canonical),Ie=fo(ge,Ae,(Se[0]-me[0])*G,Se[1]-me[1]);if(h.flipState=Ie&&Ie.needsFlipping?gn.flipRequired:gn.flipNotRequired,Ie)return Ie}const Pe=No(re*M.getoffsetX(J),ne,oe,o,k,F,ce,H,_e,I,y,N,U,!1,!1,$,q,Y);if(!Pe)return{notEnoughRoom:!0};Te(Pe)}return{}}function Jc(h,n,o,f,_){const{x:y,y:b,z:M}=f.projectTilePoint(h.x,h.y,n);if(!_)return Vr(y,b,M,o);const[I,D,z]=_(h);return Vr(y+I,b+D,M+z,o)}function Lh(h,n,o,f,_,y,b,M){const I=Jc(h.sub(n)._unit()._add(h),M,_,b,y);return r.Q.sub(I,o,I),r.Q.normalize(I,I),r.Q.scaleAndAdd(I,o,I,f)}function No(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U,$,q){const Y=f?h-n:h+n;let re=Y>0?1:-1,ne=0;f&&(re*=-1,ne=Math.PI),re<0&&(ne+=Math.PI);let oe=M+b+(re>0?0:1)|0,H=_,J=_,he=0,ce=0;const ge=Math.abs(Y),Ae=[],_e=[];let Te=y,Pe=Te;const me=()=>Lh(Pe,Te,J,ge-he+1,z,F,U,$.canonical);for(;he+ce<=ge;){if(oe+=re,oe<M||oe>=I)return null;if(J=H,Pe=Te,Ae.push(J),N&&_e.push(Pe),Te=new r.P(D.getx(oe),D.gety(oe)),H=k[oe],!H){const At=Jc(Te,$.canonical,z,U,F);H=At[3]>0?k[oe]=At:me()}he+=ce,ce=r.Q.distance(J,H)}G&&F&&(k[oe]&&(H=me(),ce=r.Q.distance(J,H)),k[oe]=H);const be=(ge-he)/ce,Ze=Te.sub(Pe)._mult(be)._add(Pe),ye=r.Q.sub([],H,J),Se=r.Q.scaleAndAdd([],J,ye,be);let Ie=[0,0,1],se=ye[0],je=ye[1];if(q&&(Ie=U.upVector($.canonical,Ze.x,Ze.y),Ie[0]!==0||Ie[1]!==0||Ie[2]!==1)){const At=[Ie[2],0,-Ie[0]],Ot=r.Q.cross([],Ie,At);r.Q.normalize(At,At),r.Q.normalize(Ot,Ot),se=r.Q.dot(ye,At),je=r.Q.dot(ye,Ot)}if(o){const At=r.Q.cross([],Ie,ye);r.Q.normalize(At,At),r.Q.scaleAndAdd(Se,Se,At,o*re)}const vt=ne+Math.atan2(je,se);return Ae.push(Se),N&&_e.push(Ze),{point:Se,angle:vt,path:Ae,tilePath:_e,up:Ie}}function Vo(h,n){const o=n.length,f=o+4*h;n.resize(f),n.float32.fill(-1/0,4*o,4*f)}function kh(h,n,o){const f=n[0],_=n[1];return h[0]=o[0]*f+o[4]*_+o[12],h[1]=o[1]*f+o[5]*_+o[13],h[3]=o[3]*f+o[7]*_+o[15],h}const fs=100;class cp{constructor(n,o,f=new zh(n.width+200,n.height+200,25),_=new zh(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+fs,this.screenBottomBoundary=n.height+fs,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=o}placeCollisionBox(n,o,f,_,y,b,M,I){let D=f.projectedAnchorX,z=f.projectedAnchorY,k=f.projectedAnchorZ;const F=f.elevation,N=f.tileID,G=n.getProjection();if(F&&N){const[H,J,he]=G.upVector(N.canonical,f.tileAnchorX,f.tileAnchorY),ce=G.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=H*F*ce,z+=J*F*ce,k+=he*F*ce}const U=this.projectAndGetPerspectiveRatio(M,D,z,k,f.tileID,G.name==="globe"||!!F||this.transform.pitch>0,G),$=b*U.perspectiveRatio,q=(f.x1*o+_.x-f.padding)*$+U.point.x,Y=(f.y1*o+_.y-f.padding)*$+U.point.y,re=(f.x2*o+_.x+f.padding)*$+U.point.x,ne=(f.y2*o+_.y+f.padding)*$+U.point.y,oe=U.perspectiveRatio<=.55||U.occluded;return!this.isInsideGrid(q,Y,re,ne)||!y&&this.grid.hitTest(q,Y,re,ne,I)||oe?{box:[],offscreen:!1,occluded:U.occluded}:{box:[q,Y,re,ne],offscreen:this.isOffscreen(q,Y,re,ne),occluded:!1}}placeCollisionCircles(n,o,f,_,y,b,M,I,D,z,k,F,N,G,U){const $=[],q=this.transform.elevation,Y=n.getProjection(),re=q?q.getAtTileOffsetFunc(U,this.transform.center.lat,this.transform.worldSize,Y):null,ne=new r.P(f.tileAnchorX,f.tileAnchorY);let{x:oe,y:H,z:J}=Y.projectTilePoint(ne.x,ne.y,U.canonical);if(re){const[Ze,ye,Se]=re(ne);oe+=Ze,H+=ye,J+=Se}const he=Y.name==="globe",ce=this.projectAndGetPerspectiveRatio(M,oe,H,J,U,he||!!q||this.transform.pitch>0,Y),{perspectiveRatio:ge}=ce,Ae=(k?b/ge:b*ge)/r.bf,_e=Vr(oe,H,J,I),Te=ce.signedDistanceFromCamera>0?Ml(Ae,y,f.lineOffsetX*Ae,f.lineOffsetY*Ae,!1,_e,ne,f,_,I,{},q&&!k?re:null,k&&!!q,Y,U,k):null;let Pe=!1,me=!1,be=!0;if(Te&&!ce.occluded){const Ze=.5*N*ge+G,ye=new r.P(-100,-100),Se=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Ie=new $s,{first:se,last:je}=Te,vt=se.path.length;let At=[];for(let Bt=vt-1;Bt>=1;Bt--)At.push(se.path[Bt]);for(let Bt=1;Bt<je.path.length;Bt++)At.push(je.path[Bt]);const Ot=2.5*Ze;D&&(At=At.map(([Bt,_i,Zt],xi)=>(re&&!he&&(Zt=re(xi<vt-1?se.tilePath[vt-1-xi]:je.tilePath[xi-vt+2])[2]),Vr(Bt,_i,Zt,D))),At.some(Bt=>Bt[3]<=0)&&(At=[]));let Pt=[];if(At.length>0){let Bt=1/0,_i=-1/0,Zt=1/0,xi=-1/0;for(const gi of At)Bt=Math.min(Bt,gi[0]),Zt=Math.min(Zt,gi[1]),_i=Math.max(_i,gi[0]),xi=Math.max(xi,gi[1]);_i>=ye.x&&Bt<=Se.x&&xi>=ye.y&&Zt<=Se.y&&(Pt=[At.map(gi=>new r.P(gi[0],gi[1]))],(Bt<ye.x||_i>Se.x||Zt<ye.y||xi>Se.y)&&(Pt=r.bd(Pt,ye.x,ye.y,Se.x,Se.y)))}for(const Bt of Pt){Ie.reset(Bt,.25*Ze);let _i=0;_i=Ie.length<=.5*Ze?1:Math.ceil(Ie.paddedLength/Ot)+1;for(let Zt=0;Zt<_i;Zt++){const xi=Zt/Math.max(_i-1,1),gi=Ie.lerp(xi),cn=gi.x+fs,Vi=gi.y+fs;$.push(cn,Vi,Ze,0);const kn=cn-Ze,In=Vi-Ze,Xi=cn+Ze,$i=Vi+Ze;if(be=be&&this.isOffscreen(kn,In,Xi,$i),me=me||this.isInsideGrid(kn,In,Xi,$i),!o&&this.grid.hitTestCircle(cn,Vi,Ze,F)&&(Pe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Pe,occluded:!1}}}}return{circles:!z&&Pe||!me?[]:$,offscreen:be,collisionDetected:Pe,occluded:ce.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let f=1/0,_=1/0,y=-1/0,b=-1/0;for(const z of n){const k=new r.P(z.x+fs,z.y+fs);f=Math.min(f,k.x),_=Math.min(_,k.y),y=Math.max(y,k.x),b=Math.max(b,k.y),o.push(k)}const M=this.grid.query(f,_,y,b).concat(this.ignoredGrid.query(f,_,y,b)),I={},D={};for(const z of M){const k=z.key;if(I[k.bucketInstanceId]===void 0&&(I[k.bucketInstanceId]={}),I[k.bucketInstanceId][k.featureIndex])continue;const F=[new r.P(z.x1,z.y1),new r.P(z.x2,z.y1),new r.P(z.x2,z.y2),new r.P(z.x1,z.y2)];r.be(o,F)&&(I[k.bucketInstanceId][k.featureIndex]=!0,D[k.bucketInstanceId]===void 0&&(D[k.bucketInstanceId]=[]),D[k.bucketInstanceId].push(k.featureIndex))}return D}insertCollisionBox(n,o,f,_,y){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:y},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,o,f,_,y){const b=o?this.ignoredGrid:this.grid,M={bucketInstanceId:f,featureIndex:_,collisionGroupID:y};for(let I=0;I<n.length;I+=4)b.insertCircle(M,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,o,f,_,y,b,M){const I=[o,f,_,1];let D=!1;_||this.transform.pitch>0?(r.aa.transformMat4(I,I,n),this.fogState&&y&&M.name!=="globe"&&(D=function(F,N,G,U,$,q){const Y=q.calculateFogTileMatrix($),re=[N,G,U];return r.Q.transformMat4(re,re,Y),Fi(F,r.Q.length(re),q.pitch,q._fov)}(this.fogState,o,f,_,y.toUnwrapped(),this.transform)>.9)):kh(I,I,n);const z=I[3];return{point:new r.P((I[0]/z+1)/2*this.transform.width+fs,(-I[1]/z+1)/2*this.transform.height+fs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/z*.5,1.5),signedDistanceFromCamera:z,occluded:b&&I[2]>z||D}}isOffscreen(n,o,f,_){return f<fs||n>=this.screenRightBoundary||_<fs||o>this.screenBottomBoundary}isInsideGrid(n,o,f,_){return f>=0&&n<this.gridRightBoundary&&_>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const n=r.a9.identity([]);return r.a9.translate(n,n,[-100,-100,0]),n}}function eu(h,n,o){const f=n.createTileMatrix(h,h.worldSize,o.toUnwrapped());return r.a9.multiply(new Float32Array(16),h.projMatrix,f)}function Is(h,n,o){if(n.projection.name===o.projection.name)return h.projMatrix;const f=o.clone();return f.setProjection(n.projection),eu(f,n.getProjection(),h)}function tu(h,n,o){return n.name===o.projection.name?h.projMatrix:eu(o,n,h)}class iu{constructor(n,o,f,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?o:-o))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class ma{constructor(n,o,f,_,y,b=!1){this.text=new iu(n?n.text:null,o,f,y),this.icon=new iu(n?n.icon:null,o,_,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nu{constructor(n,o,f,_=!1){this.text=n,this.icon=o,this.skipFade=f,this.clipped=_}}class up{constructor(){this.invProjMatrix=r.a9.create(),this.viewportMatrix=r.a9.create(),this.circles=[]}}class Ws{constructor(n,o,f,_,y){this.bucketInstanceId=n,this.featureIndex=o,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=y}}class ru{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const o=++this.maxGroupID;this.collisionGroups[n]={ID:o,predicate:f=>f.collisionGroupID===o}}return this.collisionGroups[n]}}function Oh(h,n,o,f,_){const{horizontalAlign:y,verticalAlign:b}=r.bi(h),M=-(y-.5)*n,I=-(b-.5)*o,D=r.bh(h,f);return new r.P(M+D[0]*_,I+D[1]*_)}function _a(h,n,o,f,_){const y=new r.P(h,n);return o&&y._rotate(f?_:-_),y}class Fh{constructor(n,o,f,_,y,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new cp(this.transform,y),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new ru(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,o,f,_){const y=f.getBucket(o),b=f.latestFeatureIndex;if(!y||!b||o.fqid!==y.layerIds[0])return;const M=y.layers[0].layout,I=f.collisionBoxArray,D=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),z=f.tileSize/r.Y,k=f.tileID.toUnwrapped();this.transform.setProjection(y.projection);const F=(N=f.tileID,G=y.getProjection(),U=this.transform,G.name===this.projection?U.calculateProjMatrix(N.toUnwrapped()):eu(U,G,N));var N,G,U;const $=M.get("text-pitch-alignment")==="map",q=M.get("text-rotation-alignment")==="map";o.compileFilter();const Y=o.dynamicFilter(),re=o.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(f),oe=Tl(F,f.tileID.canonical,$,q,this.transform,y.getProjection(),ne);let H=null;if($){const ce=qs(F,f.tileID.canonical,$,q,this.transform,y.getProjection(),ne);H=r.a9.multiply([],this.transform.labelPlaneMatrix,ce)}let J=null;Y&&f.latestFeatureIndex&&(J={unwrappedTileID:k,dynamicFilter:Y,dynamicFilterNeedsFeature:re,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Ws(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,f.tileID);const he={bucket:y,layout:M,posMatrix:F,textLabelPlaneMatrix:oe,labelToScreenMatrix:H,clippingData:J,scale:D,textPixelRatio:z,holdingForFade:f.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:r.b8(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.b8(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(_)for(const ce of y.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:Ae,symbolInstanceEnd:_e}=ce;n.push({sortKey:ge,symbolInstanceStart:Ae,symbolInstanceEnd:_e,parameters:he})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:he})}attemptAnchorPlacement(n,o,f,_,y,b,M,I,D,z,k,F,N,G,U,$,q,Y){const{textOffset0:re,textOffset1:ne,crossTileID:oe}=F,H=[re,ne],J=Oh(n,f,_,H,y),he=this.collisionIndex.placeCollisionBox(G,y,o,_a(J.x,J.y,b,M,this.transform.angle),k,I,D,z.predicate);if($){const ce=G.getSymbolInstanceIconSize(Y,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(G,ce,$,_a(J.x,J.y,b,M,this.transform.angle),k,I,D,z.predicate).box.length===0)return}if(he.box.length>0){let ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[oe]&&this.prevPlacement.placements[oe]&&this.prevPlacement.placements[oe].text&&(ce=this.prevPlacement.variableOffsets[oe].anchor),this.variableOffsets[oe]={textOffset:H,width:f,height:_,anchor:n,textScale:y,prevAnchor:ce},this.markUsedJustification(G,n,F,U),G.allowVerticalPlacement&&(this.markUsedOrientation(G,U,F),this.placedOrientations[oe]=U),{shift:J,placedGlyphBoxes:he}}}placeLayerBucketPart(n,o,f,_){const{bucket:y,layout:b,posMatrix:M,textLabelPlaneMatrix:I,labelToScreenMatrix:D,clippingData:z,textPixelRatio:k,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:U,collisionGroup:$}=n.parameters,q=b.get("text-optional"),Y=b.get("icon-optional"),re=b.get("text-allow-overlap"),ne=b.get("icon-allow-overlap"),oe=b.get("text-rotation-alignment")==="map",H=b.get("text-pitch-alignment")==="map",J=b.get("symbol-z-order")==="viewport-y",he=b.get("symbol-z-elevate");this.transform.setProjection(y.projection);let ce=re&&(ne||!y.hasIconData()||Y),ge=ne&&(re||!y.hasTextData()||q);!y.collisionArrays&&N&&y.deserializeCollisionBoxes(N),f&&_&&y.updateCollisionDebugBuffers(this.transform.zoom,N);const Ae=(_e,Te,Pe)=>{const{crossTileID:me,numVerticalGlyphVertices:be}=_e;if(z){const Xi={zoom:this.transform.zoom,pitch:this.transform.pitch};let $i=null;if(z.dynamicFilterNeedsFeature){const ri=this.retainedQueryData[y.bucketInstanceId];$i=z.featureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:ri.bucketIndex,sourceLayerIndex:ri.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Xi,$i,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new r.P(_e.tileAnchorX,_e.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[me]=new nu(!1,!1,!1,!0),void o.add(me)}if(o.has(me))return;if(F)return void(this.placements[me]=new nu(!1,!1,!1));let Ze=!1,ye=!1,Se=!0,Ie=!1,se=!1,je=null,vt={box:null,offscreen:null,occluded:null},At={box:null,offscreen:null,occluded:null},Ot=null,Pt=null,Bt=null,_i=0,Zt=0,xi=0;Pe.textFeatureIndex?_i=Pe.textFeatureIndex:_e.useRuntimeCollisionCircles&&(_i=_e.featureIndex),Pe.verticalTextFeatureIndex&&(Zt=Pe.verticalTextFeatureIndex);const gi=Xi=>{Xi.tileID=this.retainedQueryData[y.bucketInstanceId].tileID;const $i=this.transform.elevation;Xi.elevation=_e.zOffset+($i?$i.getAtTileOffset(Xi.tileID,Xi.tileAnchorX,Xi.tileAnchorY):0)},cn=Pe.textBox;if(cn){gi(cn);const Xi=ri=>{let oi=r.b9.horizontal;if(y.allowVerticalPlacement&&!ri&&this.prevPlacement){const nn=this.prevPlacement.placedOrientations[me];nn&&(this.placedOrientations[me]=nn,oi=nn,this.markUsedOrientation(y,oi,_e))}return oi},$i=(ri,oi)=>{if(y.allowVerticalPlacement&&be>0&&Pe.verticalTextBox){for(const nn of y.writingModes)if(nn===r.b9.vertical?(vt=oi(),At=vt):vt=ri(),vt&&vt.box&&vt.box.length)break}else vt=ri()};if(b.get("text-variable-anchor")){let ri=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[me]){const Yi=this.prevPlacement.variableOffsets[me];ri.indexOf(Yi.anchor)>0&&(ri=ri.filter(hi=>hi!==Yi.anchor),ri.unshift(Yi.anchor))}const oi=(Yi,hi,ei)=>{const Ar=y.getSymbolInstanceTextSize(G,_e,this.transform.zoom,Te),ur=(Yi.x2-Yi.x1)*Ar+2*Yi.padding,qn=(Yi.y2-Yi.y1)*Ar+2*Yi.padding,hr=_e.hasIconTextFit&&!ne?hi:null;hr&&gi(hr);let Ir={box:[],offscreen:!1,occluded:!1};const gr=re?2*ri.length:ri.length;for(let Wn=0;Wn<gr;++Wn){const nr=this.attemptAnchorPlacement(ri[Wn%ri.length],Yi,ur,qn,Ar,oe,H,k,M,$,Wn>=ri.length,_e,Te,y,ei,hr,G,U);if(nr&&(Ir=nr.placedGlyphBoxes,Ir&&Ir.box&&Ir.box.length)){Ze=!0,je=nr.shift;break}}return Ir};$i(()=>oi(cn,Pe.iconBox,r.b9.horizontal),()=>{const Yi=Pe.verticalTextBox;return Yi&&gi(Yi),y.allowVerticalPlacement&&!(vt&&vt.box&&vt.box.length)&&be>0&&Yi?oi(Yi,Pe.verticalIconBox,r.b9.vertical):{box:null,offscreen:null,occluded:null}}),vt&&(Ze=vt.box,Se=vt.offscreen,Ie=vt.occluded);const nn=Xi(!(!vt||!vt.box));if(!Ze&&this.prevPlacement){const Yi=this.prevPlacement.variableOffsets[me];Yi&&(this.variableOffsets[me]=Yi,this.markUsedJustification(y,Yi.anchor,_e,nn))}}else{const ri=(oi,nn)=>{const Yi=y.getSymbolInstanceTextSize(G,_e,this.transform.zoom,Te),hi=this.collisionIndex.placeCollisionBox(y,Yi,oi,new r.P(0,0),re,k,M,$.predicate);return hi&&hi.box&&hi.box.length&&(this.markUsedOrientation(y,nn,_e),this.placedOrientations[me]=nn),hi};$i(()=>ri(cn,r.b9.horizontal),()=>{const oi=Pe.verticalTextBox;return y.allowVerticalPlacement&&be>0&&oi?(gi(oi),ri(oi,r.b9.vertical)):{box:null,offscreen:null,occluded:null}}),Xi(!!(vt&&vt.box&&vt.box.length))}}if(Ot=vt,Ze=Ot&&Ot.box&&Ot.box.length>0,Se=Ot&&Ot.offscreen,Ie=Ot&&Ot.occluded,_e.useRuntimeCollisionCircles){const Xi=y.text.placedSymbolArray.get(_e.centerJustifiedTextSymbolIndex>=0?_e.centerJustifiedTextSymbolIndex:_e.verticalPlacedTextSymbolIndex),$i=r.ba(y.textSizeData,G,Xi),ri=b.get("text-padding");Pt=this.collisionIndex.placeCollisionCircles(y,re,Xi,y.lineVertexArray,y.glyphOffsetArray,$i,M,I,D,f,H,$.predicate,_e.collisionCircleDiameter*$i/r.bf,ri,this.retainedQueryData[y.bucketInstanceId].tileID),Ze=re||Pt.circles.length>0&&!Pt.collisionDetected,Se=Se&&Pt.offscreen,Ie=Pt.occluded}if(Pe.iconFeatureIndex&&(xi=Pe.iconFeatureIndex),Pe.iconBox){const Xi=$i=>{gi($i);const ri=_e.hasIconTextFit&&je?_a(je.x,je.y,oe,H,this.transform.angle):new r.P(0,0),oi=y.getSymbolInstanceIconSize(U,this.transform.zoom,_e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,oi,$i,ri,ne,k,M,$.predicate)};At&&At.box&&At.box.length&&Pe.verticalIconBox?(Bt=Xi(Pe.verticalIconBox),ye=Bt.box.length>0):(Bt=Xi(Pe.iconBox),ye=Bt.box.length>0),Se=Se&&Bt.offscreen,se=Bt.occluded}const Vi=q||_e.numHorizontalGlyphVertices===0&&be===0,kn=Y||_e.numIconVertices===0;if(Vi||kn?kn?Vi||(ye=ye&&Ze):Ze=ye&&Ze:ye=Ze=ye&&Ze,Ze&&Ot&&Ot.box&&this.collisionIndex.insertCollisionBox(Ot.box,b.get("text-ignore-placement"),y.bucketInstanceId,At&&At.box&&Zt?Zt:_i,$.ID),ye&&Bt&&this.collisionIndex.insertCollisionBox(Bt.box,b.get("icon-ignore-placement"),y.bucketInstanceId,xi,$.ID),Pt&&(Ze&&this.collisionIndex.insertCollisionCircles(Pt.circles,b.get("text-ignore-placement"),y.bucketInstanceId,_i,$.ID),f)){const Xi=y.bucketInstanceId;let $i=this.collisionCircleArrays[Xi];$i===void 0&&($i=this.collisionCircleArrays[Xi]=new up);for(let ri=0;ri<Pt.circles.length;ri+=4)$i.circles.push(Pt.circles[ri+0]),$i.circles.push(Pt.circles[ri+1]),$i.circles.push(Pt.circles[ri+2]),$i.circles.push(Pt.collisionDetected?1:0)}const In=y.projection.name!=="globe";ce=ce&&(In||!Ie),ge=ge&&(In||!se),this.placements[me]=new nu(Ze||ce,ye||ge,Se||y.justReloaded),o.add(me)};if(he&&this.buildingIndex&&(this.buildingIndex.updateZOffset(y,this.retainedQueryData[y.bucketInstanceId].tileID),y.updateZOffset()),J){const _e=y.getSortedSymbolIndexes(this.transform.angle);for(let Te=_e.length-1;Te>=0;--Te){const Pe=_e[Te];Ae(y.symbolInstances.get(Pe),Pe,y.collisionArrays[Pe])}y.hasAnyZOffset&&r.w(`${y.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(y.hasAnyZOffset){const _e=y.getSortedIndexesByZOffset();for(let Te=0;Te<_e.length;++Te){const Pe=_e[Te];Ae(y.symbolInstances.get(Pe),Pe,y.collisionArrays[Pe])}}else for(let _e=n.symbolInstanceStart;_e<n.symbolInstanceEnd;_e++)Ae(y.symbolInstances.get(_e),_e,y.collisionArrays[_e]);if(f&&y.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[y.bucketInstanceId];r.a9.invert(_e.invProjMatrix,M),_e.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(n,o,f,_){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:I,crossTileID:D}=f,z=r.bg(o),k=_===r.b9.vertical?I:z==="left"?y:z==="center"?b:z==="right"?M:-1;y>=0&&(n.text.placedSymbolArray.get(y).crossTileID=k>=0&&y!==k?0:D),b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=k>=0&&b!==k?0:D),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=k>=0&&M!==k?0:D),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=k>=0&&I!==k?0:D)}markUsedOrientation(n,o,f){const _=o===r.b9.horizontal||o===r.b9.horizontalOnly?o:0,y=o===r.b9.vertical?o:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:D}=f,z=n.text.placedSymbolArray;b>=0&&(z.get(b).placedOrientation=_),M>=0&&(z.get(M).placedOrientation=_),I>=0&&(z.get(I).placedOrientation=_),D>=0&&(z.get(D).placedOrientation=y)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let f=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const _=o?o.symbolFadeChange(n):1,y=o?o.opacities:{},b=o?o.variableOffsets:{},M=o?o.placedOrientations:{};for(const I in this.placements){const D=this.placements[I],z=y[I];z?(this.opacities[I]=new ma(z,_,D.text,D.icon,null,D.clipped),f=f||D.text!==z.text.placed||D.icon!==z.icon.placed):(this.opacities[I]=new ma(null,_,D.text,D.icon,D.skipFade,D.clipped),f=f||D.text||D.icon)}for(const I in y){const D=y[I];if(!this.opacities[I]){const z=new ma(D,_,!1,!1);z.isHidden()||(this.opacities[I]=z,f=f||D.text.placed||D.icon.placed)}}for(const I in b)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=b[I]);for(const I in M)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=M[I]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:n)}updateLayerOpacities(n,o){const f=new Set;for(const _ of o){const y=_.getBucket(n);y&&_.latestFeatureIndex&&n.fqid===y.layerIds[0]&&(this.updateBucketOpacities(y,f,_.collisionBoxArray),y.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(y,_.tileID),y.updateZOffset()))}}updateBucketOpacities(n,o,f){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const _=n.layers[0].layout,y=!!n.layers[0].dynamicFilter(),b=new ma(null,0,!1,!1,!0),M=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),D=_.get("text-variable-anchor"),z=_.get("text-rotation-alignment")==="map",k=_.get("text-pitch-alignment")==="map",F=new ma(null,0,M&&(I||!n.hasIconData()||_.get("icon-optional")),I&&(M||!n.hasTextData()||_.get("text-optional")),!0);!n.collisionArrays&&f&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(f);const N=(U,$,q)=>{for(let Y=0;Y<$/4;Y++)U.opacityVertexArray.emplaceBack(q)};let G=0;for(let U=0;U<n.symbolInstances.length;U++){const $=n.symbolInstances.get(U),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:Y,crossTileID:re,numIconVertices:ne}=$,oe=o.has(re);let H=this.opacities[re];oe?H=b:H||(H=F,this.opacities[re]=H),o.add(re);const J=q>0||Y>0,he=ne>0,ce=this.placedOrientations[re],ge=ce===r.b9.vertical,Ae=ce===r.b9.horizontal||ce===r.b9.horizontalOnly;if(!J&&!he||H.isHidden()||G++,J){const _e=ou(H.text);N(n.text,q,ge?ya:_e),N(n.text,Y,Ae?ya:_e);const Te=H.text.isHidden(),{leftJustifiedTextSymbolIndex:Pe,centerJustifiedTextSymbolIndex:me,rightJustifiedTextSymbolIndex:be,verticalPlacedTextSymbolIndex:Ze}=$,ye=n.text.placedSymbolArray,Se=Te||ge?1:0;Pe>=0&&(ye.get(Pe).hidden=Se),me>=0&&(ye.get(me).hidden=Se),be>=0&&(ye.get(be).hidden=Se),Ze>=0&&(ye.get(Ze).hidden=Te||Ae?1:0);const Ie=this.variableOffsets[re];Ie&&this.markUsedJustification(n,Ie.anchor,$,ce);const se=this.placedOrientations[re];se&&(this.markUsedJustification(n,"left",$,se),this.markUsedOrientation(n,se,$))}if(he){const _e=ou(H.icon),{placedIconSymbolIndex:Te,verticalPlacedIconSymbolIndex:Pe}=$,me=n.icon.placedSymbolArray,be=H.icon.isHidden()?1:0;Te>=0&&(N(n.icon,ne,ge?ya:_e),me.get(Te).hidden=be),Pe>=0&&(N(n.icon,$.numVerticalIconVertices,Ae?ya:_e),me.get(Pe).hidden=be)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const _e=n.collisionArrays[U];if(_e){let Te=new r.P(0,0),Pe=!0;if(_e.textBox||_e.verticalTextBox){if(D){const be=this.variableOffsets[re];be?(Te=Oh(be.anchor,be.width,be.height,be.textOffset,be.textScale),z&&Te._rotate(k?this.transform.angle:-this.transform.angle)):Pe=!1}y&&(Pe=!H.clipped),_e.textBox&&jo(n.textCollisionBox.collisionVertexArray,H.text.placed,!Pe||ge,Te.x,Te.y),_e.verticalTextBox&&jo(n.textCollisionBox.collisionVertexArray,H.text.placed,!Pe||Ae,Te.x,Te.y)}const me=Pe&&!!(!Ae&&_e.verticalIconBox);_e.iconBox&&jo(n.iconCollisionBox.collisionVertexArray,H.icon.placed,me,$.hasIconTextFit?Te.x:0,$.hasIconTextFit?Te.y:0),_e.verticalIconBox&&jo(n.iconCollisionBox.collisionVertexArray,H.icon.placed,!me,$.hasIconTextFit?Te.x:0,$.hasIconTextFit?Te.y:0)}}}if(n.fullyClipped=G===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const U=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=U.invProjMatrix,n.placementViewportMatrix=U.viewportMatrix,n.collisionCircleArray=U.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,o){const f=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function jo(h,n,o,f,_){h.emplaceBack(n?1:0,o?1:0,f||0,_||0),h.emplaceBack(n?1:0,o?1:0,f||0,_||0),h.emplaceBack(n?1:0,o?1:0,f||0,_||0),h.emplaceBack(n?1:0,o?1:0,f||0,_||0)}const Sl=Math.pow(2,25),ga=Math.pow(2,24),Bh=Math.pow(2,17),hp=Math.pow(2,16),dp=Math.pow(2,9),fp=Math.pow(2,8),su=Math.pow(2,1);function ou(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const n=h.placed?1:0,o=Math.floor(127*h.opacity);return o*Sl+n*ga+o*Bh+n*hp+o*dp+n*fp+o*su+n}const ya=0;class El{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,o,f,_,y){const b=this._bucketParts;for(;this._currentTileIndex<n.length;)if(o.getBucketParts(b,_,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((M,I)=>M.sortKey-I.sortKey));this._currentPartIndex<b.length;){const M=b[this._currentPartIndex];if(o.placeLayerBucketPart(M,this._seenCrossTileIDs,f,M.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class Al{constructor(n,o,f,_,y,b,M,I,D){this.placement=new Fh(n,y,b,M,I,D),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,o,f,_){const y=r.f.now(),b=()=>{const M=r.f.now()-y;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=o[n[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=I)&&(!M.maxzoom||M.maxzoom>I)){const D=M,z=D.layout.get("symbol-z-elevate"),k=this._inProgressLayer=this._inProgressLayer||new El(D),F=r.aj(M.source,M.scope);if(k.continuePlacement(z?_[F]:f[F],this.placement,this._showCollisionBoxes,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Nh=512/r.Y/2;class pp{constructor(n,o,f){this.tileID=n,this.bucketInstanceId=f,this.index=new r.bj(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=n.canonical.x*r.Y,y=n.canonical.y*r.Y;for(let b=0;b<o.length;b++){const{key:M,crossTileID:I,tileAnchorX:D,tileAnchorY:z}=o.get(b),k=Math.floor((_+D)*Nh),F=Math.floor((y+z)*Nh);this.index.add(k,F),this.keys.push(M),this.crossTileIDs.push(I)}this.index.finish()}findMatches(n,o,f){const _=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),y=Nh/Math.pow(2,o.canonical.z-this.tileID.canonical.z),b=o.canonical.x*r.Y,M=o.canonical.y*r.Y;for(let I=0;I<n.length;I++){const D=n.get(I);if(D.crossTileID)continue;const{key:z,tileAnchorX:k,tileAnchorY:F}=D,N=Math.floor((b+k)*y),G=Math.floor((M+F)*y),U=this.index.range(N-_,G-_,N+_,G+_);for(const $ of U){const q=this.crossTileIDs[$];if(this.keys[$]===z&&!f.has(q)){f.add(q),D.crossTileID=q;break}}}}}class au{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Il{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const o=Math.round((n-this.lng)/360);if(o!==0)for(const f in this.indexes){const _=this.indexes[f],y={};for(const b in _){const M=_[b];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+o),y[M.tileID.key]=M}this.indexes[f]=y}this.lng=n}addBucket(n,o,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const _=this.usedCrossTileIDs[n.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>n.overscaledZ)for(const M in b){const I=b[M];I.tileID.isChildOf(n)&&I.findMatches(o.symbolInstances,n,_)}else{const M=b[n.scaledTo(Number(y)).key];M&&M.findMatches(o.symbolInstances,n,_)}}for(let y=0;y<o.symbolInstances.length;y++){const b=o.symbolInstances.get(y);b.crossTileID||(b.crossTileID=f.generate(),_.add(b.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new pp(n,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(n,o){for(const f of o.crossTileIDs)this.usedCrossTileIDs[n].delete(f)}removeStaleBuckets(n){let o=!1;for(const f in this.indexes){const _=this.indexes[f];for(const y in _)n[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[y]),delete _[y],o=!0)}return o}}class Vh{constructor(){this.layerIndexes={},this.crossTileIDs=new au,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,o,f,_){let y=this.layerIndexes[n.fqid];y===void 0&&(y=this.layerIndexes[n.fqid]=new Il);let b=!1;const M={};_.name!=="globe"&&y.handleWrapJump(f);for(const I of o){const D=I.getBucket(n);D&&n.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(I.tileID,D,this.crossTileIDs)&&(b=!0),M[D.bucketInstanceId]=!0)}return y.removeStaleBuckets(M)&&(b=!0),b}pruneUnusedLayers(n){const o={};n.forEach(f=>{o[f]=!0});for(const f in this.layerIndexes)o[f]||delete this.layerIndexes[f]}}class Cl{constructor(n=0,o=0,f=0,_=0){if(isNaN(n)||n<0||isNaN(o)||o<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=o,this.left=f,this.right=_}interpolate(n,o,f){return o.top!=null&&n.top!=null&&(this.top=r.X(n.top,o.top,f)),o.bottom!=null&&n.bottom!=null&&(this.bottom=r.X(n.bottom,o.bottom,f)),o.left!=null&&n.left!=null&&(this.left=r.X(n.left,o.left,f)),o.right!=null&&n.right!=null&&(this.right=r.X(n.right,o.right,f)),this}getCenter(n,o){const f=r.ad((this.left+n-this.right)/2,0,n),_=r.ad((this.top+o-this.bottom)/2,0,o);return new r.P(f,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Cl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function lu(h,n){const o=r.bn(h,3);r.a9.fromQuat(h,n),r.bp(h,3,o)}function jh(h,n){const o=r.bl.identity([]);return r.bl.rotateZ(o,o,-n),r.bl.rotateX(o,o,-h),o}function ps(h,n){const o=[h[0],h[1],0],f=[n[0],n[1],0];if(r.Q.length(o)>=1e-15){const b=r.Q.normalize([],o);r.Q.scale(f,b,r.Q.dot(f,b)),n[0]=f[0],n[1]=f[1]}const _=r.Q.cross([],n,h);if(r.Q.len(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return jh(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}class xa{constructor(n,o){this.position=n,this.orientation=o}get position(){return this._position}set position(n){if(n){const o=n instanceof r.O?n:new r.O(n[0],n[1],n[2]);this._renderWorldCopies&&(o.x=r.bk(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(n,o){if(this.orientation=null,!this.position)return;const f=this.position,_=this._elevation?this._elevation.getAtPointOrZero(r.O.fromLngLat(n)):0,y=r.O.fromLngLat(n,_),b=[y.x-f.x,y.y-f.y,y.z-f.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=ps(b,o)}setPitchBearing(n,o){this.orientation=jh(r.bm(n),r.bm(-o))}}class Pl{constructor(n,o){this._transform=r.a9.identity([]),this.orientation=o,this.position=n}get mercatorPosition(){const n=this.position;return new r.O(n[0],n[1],n[2])}get position(){const n=r.bn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var o;n&&r.bp(this._transform,3,[(o=n)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.bl.identity([]),n&&lu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,o){this._orientation=jh(n,o),lu(this._transform,this._orientation)}forward(){const n=r.bn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=r.bn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=r.bn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,o){const f=new Float64Array(16);return r.a9.invert(f,this.getWorldToCamera(n,o)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,o,f){const _=this.position;r.Q.scale(_,_,-n);const y=new Float64Array(16);return r.a9.fromScaling(y,[f,f,f]),r.a9.translate(y,y,_),y[10]*=o,y}getWorldToCamera(n,o){const f=new Float64Array(16),_=new Float64Array(4),y=this.position;return r.bl.conjugate(_,this._orientation),r.Q.scale(y,y,-n),r.a9.fromQuat(f,_),r.a9.translate(f,f,y),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=o,f[9]*=o,f[10]*=o,f[11]*=o,f}getCameraToClipPerspective(n,o,f,_){const y=new Float64Array(16);return r.a9.perspective(y,n,o,f,_),y}getCameraToClipOrthographic(n,o,f,_,y,b){const M=new Float64Array(16);return r.a9.ortho(M,n,o,f,_,y,b),M}getDistanceToElevation(n,o=!1){const f=n===0?0:r.bo(n,o?r.ax(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new Pl([...this.position],[...this.orientation])}}const Uh=(h,n,o)=>(1-o)*h+o*n,va=h=>h*h*h*h*h;class cu{constructor(n,o,f,_,y,b,M){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=n||0,this._maxZoom=o||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(b),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new r.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Cl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Pl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new cu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,o=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return r.af(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=r.br(this.projectionOptions);const f=!B(o,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.br({name:"mercator"});const o=n!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bk(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const o=-n*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=r.b7.create(),r.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const o=r.ad(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.bm(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const o=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,y=0;for(let b=0;b<o.length;b++){const M=new r.P(o[b][0]*this.width,f+o[b][1]*(this.height-f)),I=n.pointCoordinate(M);if(!I)continue;const D=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);_+=I[3]*D,y+=D}return y===0?NaN:_/y}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*o,_=this._mercatorZfromZoom(n),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(_-f,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[o.x,o.y,o.z]:[n.x,n.y,n.z];const _=r.Q.length(r.Q.sub([],this._camera.position,f));return r.ad(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let o=!1;if(n.orientation&&!r.bl.exactEquals(n.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];r.Q.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,o=new xa;return o.position=new r.O(n[0],n[1],n[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(n){if(!r.bl.length(n))return!1;r.bl.normalize(n,n);const o=r.Q.transformQuat([],[0,0,-1],n),f=r.Q.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const _=ps(o,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const o=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=r.ad(n[2],_/f,_/o),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,o,f){this._unmodified=!1,this._edgeInsets.interpolate(n,o,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const o=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(n){const o=[new r.bs(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new r.P(0,0)),_=this.pointCoordinate(new r.P(this.width,0)),y=this.pointCoordinate(new r.P(this.width,this.height)),b=this.pointCoordinate(new r.P(0,this.height)),M=Math.floor(Math.min(f.x,_.x,y.x,b.x)),I=Math.floor(Math.max(f.x,_.x,y.x,b.x)),D=1;for(let z=M-D;z<=I+D;z++)z!==0&&o.push(new r.bs(z,n))}return o}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(n,o,f){let _=[];if(o[0]===0&&o[1]===0)return _;for(const b of n){const M=b.canonical,I=b.overscaledZ,D=b.wrap,z=1<<M.z,k=M.x+1<z,F=M.x>0,N=M.y+1<z,G=M.y>0,U=b.wrap-(F?0:1),$=b.wrap+(k?0:1),q=F?M.x-1:z-1,Y=k?M.x+1:0;o[0]<0?(_.push(new r.ap(I,$,M.z,Y,M.y)),o[1]<0&&N&&(_.push(new r.ap(I,D,M.z,M.x,M.y+1)),_.push(new r.ap(I,$,M.z,Y,M.y+1))),o[1]>0&&G&&(_.push(new r.ap(I,D,M.z,M.x,M.y-1)),_.push(new r.ap(I,$,M.z,Y,M.y-1)))):o[0]>0?(_.push(new r.ap(I,U,M.z,q,M.y)),o[1]<0&&N&&(_.push(new r.ap(I,D,M.z,M.x,M.y+1)),_.push(new r.ap(I,U,M.z,q,M.y+1))),o[1]>0&&G&&(_.push(new r.ap(I,D,M.z,M.x,M.y-1)),_.push(new r.ap(I,U,M.z,q,M.y-1)))):o[1]<0&&N?_.push(new r.ap(I,D,M.z,M.x,M.y+1)):G&&_.push(new r.ap(I,D,M.z,M.x,M.y-1))}if(_.length>1){_.sort((I,D)=>I.overscaledZ-D.overscaledZ||I.wrap-D.wrap||I.canonical.z-D.canonical.z||I.canonical.x-D.canonical.x||I.canonical.y-D.canonical.y);let b=0,M=0;for(;M<_.length;)_[M].equals(_[b])?++M:_[++b]=_[M++];_.length=b+1}const y=[];for(const b of _)_.some(M=>b.isChildOf(M))||y.push(b);return _=y.filter(b=>!n.some(M=>!!(b.overscaledZ<f&&M.isChildOf(b))||b.equals(M)||b.isChildOf(M))),_}coveringTiles(n){let o=this.coveringZoomLevel(n);const f=o,_=this.elevation&&this.elevation.exaggeration(),y=_&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&o<n.minzoom)return[];n.maxzoom!==void 0&&o>n.maxzoom&&(o=n.maxzoom);const M=this.locationCoordinate(this.center),I=this.center.lat,D=1<<o,z=[D*M.x,D*M.y,0],k=this.projection.name==="globe",F=!k,N=r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,F),G=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=D*r.bo(1,this.center.lat),$=this._camera.position[2]/r.bo(1,this.center.lat),q=[D*G.x,D*G.y,$*(F?1:U)],Y=k||_,re=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ne=this.isLODDisabled(!0)?o:0;let oe;if(this._elevation&&n.isTerrainDEM)oe=1e4*this._elevation.exaggeration();else if(this._elevation){const ye=this._elevation.getMinMaxForVisibleTiles();oe=ye?ye.max:this._centerAltitude}else oe=this._centerAltitude;const H=n.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,J=this.projection.isReprojectedInTileSpace?r.bu(this):1,he=ye=>{const Ie=new r.O(ye.x+25e-6,ye.y,ye.z),se=new r.O(ye.x,ye.y+25e-6,ye.z),je=ye.toLngLat(),vt=Ie.toLngLat(),At=se.toLngLat(),Ot=this.locationCoordinate(je),Pt=this.locationCoordinate(vt),Bt=this.locationCoordinate(At),_i=Math.hypot(Pt.x-Ot.x,Pt.y-Ot.y),Zt=Math.hypot(Bt.x-Ot.x,Bt.y-Ot.y);return Math.sqrt(_i*Zt)*J/25e-6},ce=ye=>{const Se=oe,Ie=H;return{aabb:r.bx(this,D,0,0,0,ye,Ie,Se,this.projection),zoom:0,x:0,y:0,minZ:Ie,maxZ:Se,wrap:ye,fullyVisible:!1}},ge=[];let Ae=[];const _e=o,Te=n.reparseOverscaled?f:o,Pe=ye=>ye*ye,me=Pe(($-this._centerAltitude)*U),be=ye=>{if(!this._elevation||!ye.tileID||!b)return;const Se=this._elevation.getMinMaxForTile(ye.tileID),Ie=ye.aabb;Se?(Ie.min[2]=Se.min,Ie.max[2]=Se.max,Ie.center[2]=(Ie.min[2]+Ie.max[2])/2):(ye.shouldSplit=Ze(ye),ye.shouldSplit||(Ie.min[2]=Ie.max[2]=Ie.center[2]=this._centerAltitude))},Ze=ye=>{if(ye.zoom<ne)return!0;if(ye.zoom===_e)return!1;if(ye.shouldSplit!=null)return ye.shouldSplit;const Se=ye.aabb.distanceX(q),Ie=ye.aabb.distanceY(q);let se=me,je=1;if(k){se=Pe(ye.aabb.distanceZ(q));const Ot=Math.pow(2,ye.zoom),Pt=r.ax((ye.y+1)/Ot),Bt=r.ax(ye.y/Ot),_i=Math.min(Math.max(I,Pt),Bt),Zt=r.bM(_i)/r.bM(I);if(je=_i===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Zt/this._mercatorScaleRatio),this.zoom<=r.bJ&&ye.zoom===_e-1&&Zt>=.9)return!0}else if(y&&(se=Pe(ye.aabb.distanceZ(q)*U)),this.projection.isReprojectedInTileSpace&&f<=5){const Ot=Math.pow(2,ye.zoom),Pt=he(new r.O((ye.x+.5)/Ot,(ye.y+.5)/Ot));je=Pt>.85?1:Pt}const vt=Se*Se+Ie*Ie+se,At=Pe((1<<_e-ye.zoom)*re*je*((Ot,Pt)=>{if(Pt*Pe(.707)<Ot)return 1;const Bt=Math.sqrt(Pt/Ot);return Bt/(1.4144271570014144+(Math.pow(1.1,Bt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(se,me),vt));return vt<At};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)ge.push(ce(-ye)),ge.push(ce(ye));for(ge.push(ce(0));ge.length>0;){const ye=ge.pop(),Se=ye.x,Ie=ye.y;let se=ye.fullyVisible;const je=()=>this.projection.name==="globe"&&(ye.y===0||ye.y===(1<<ye.zoom)-1);if(!se){let vt=Y?ye.aabb.intersects(N):ye.aabb.intersectsFlat(N);if(vt===0&&je()){const At=new r.bv(ye.zoom,Se,Ie);vt=r.bw(this,D,At,!0).intersects(N)}if(vt===0)continue;se=vt===2}if(ye.zoom!==_e&&Ze(ye))for(let vt=0;vt<4;vt++){const At=(Se<<1)+vt%2,Ot=(Ie<<1)+(vt>>1),Pt={aabb:b?ye.aabb.quadrant(vt):r.bx(this,D,ye.zoom+1,At,Ot,ye.wrap,ye.minZ,ye.maxZ,this.projection),zoom:ye.zoom+1,x:At,y:Ot,wrap:ye.wrap,fullyVisible:se,tileID:void 0,shouldSplit:void 0,minZ:ye.minZ,maxZ:ye.maxZ};y&&!k&&(Pt.tileID=new r.ap(ye.zoom+1===_e?Te:ye.zoom+1,ye.wrap,ye.zoom+1,At,Ot),be(Pt)),ge.push(Pt)}else{const vt=ye.zoom===_e?Te:ye.zoom;if(n.minzoom&&n.minzoom>vt)continue;if(!se){let Bt=Y?ye.aabb.intersectsPrecise(N):ye.aabb.intersectsPreciseFlat(N);if(Bt===0&&je()){const _i=new r.bv(ye.zoom,Se,Ie);Bt=r.bw(this,D,_i,!0).intersectsPrecise(N)}if(Bt===0)continue}const At=z[0]-(.5+Se+(ye.wrap<<ye.zoom))*(1<<o-ye.zoom),Ot=z[1]-.5-Ie,Pt=ye.tileID?ye.tileID:new r.ap(vt,ye.wrap,ye.zoom,Se,Ie);Ae.push({tileID:Pt,distanceSq:At*At+Ot*Ot})}}if(this.fogCullDistSq){const ye=this.fogCullDistSq,Se=this.horizonLineFromTop();Ae=Ae.filter(Ie=>{const se=[0,0,0,1],je=[r.Y,r.Y,0,1],vt=this.calculateFogTileMatrix(Ie.tileID.toUnwrapped());r.aa.transformMat4(se,se,vt),r.aa.transformMat4(je,je,vt);const At=r.aa.min([],se,je),Ot=r.aa.max([],se,je),Pt=r.by(At,Ot);if(Pt===0)return!0;let Bt=!1;const _i=this._elevation;if(_i&&Pt>ye&&Se!==0){const Zt=this.calculateProjMatrix(Ie.tileID.toUnwrapped());let xi;n.isTerrainDEM||(xi=_i.getMinMaxForTile(Ie.tileID)),xi||(xi={min:H,max:oe});const gi=r.bK(this.rotation),cn=[gi[0]*r.Y,gi[1]*r.Y,xi.max];r.Q.transformMat4(cn,cn,Zt),Bt=(1-cn[1])*this.height*.5<Se}return Pt<ye||Bt})}return Ae.sort((ye,Se)=>ye.distanceSq-Se.distanceSq).map(ye=>ye.tileID)}resize(n,o){this.width=n,this.height=o,this.pixelsToGLUnits=[2/n,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const o=r.ad(n.lat,-r.bz,r.bz),f=this.projection.project(n.lng,o);return new r.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,o){let f,_;const y=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;f=(o.x-y.x)/M,_=(o.y-y.y)/M}else{const M=this.pointCoordinate(o),I=this.pointCoordinate(y);f=M.x-I.x,_=M.y-I.y}const b=this.locationCoordinate(n);this.setLocation(new r.O(b.x-f,b.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,o){const f=o?r.bo(o,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new r.O(_.x,_.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,o){const f=o??this._centerAltitude,_=[n.x,n.y,0,1],y=[n.x,n.y,1,1];r.aa.transformMat4(_,_,this.pixelMatrixInverse),r.aa.transformMat4(y,y,this.pixelMatrixInverse);const b=y[3];r.aa.scale(_,_,1/_[3]),r.aa.scale(y,y,1/b);const M=_[2],I=y[2];return{p0:_,p1:y,t:M===I?0:(f-M)/(I-M)}}screenPointToMercatorRay(n){const o=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return r.aa.transformMat4(o,o,this.pixelMatrixInverse),r.aa.transformMat4(f,f,this.pixelMatrixInverse),r.aa.scale(o,o,1/o[3]),r.aa.scale(f,f,1/f[3]),o[2]=r.bo(o[2],this._center.lat)*this.worldSize,f[2]=r.bo(f[2],this._center.lat)*this.worldSize,r.aa.scale(o,o,1/this.worldSize),r.aa.scale(f,f,1/this.worldSize),new r.a5([o[0],o[1],o[2]],r.Q.normalize([],r.Q.sub([],f,o)))}rayIntersectionCoordinate(n){const{p0:o,p1:f,t:_}=n,y=r.bo(o[2],this._center.lat),b=r.bo(f[2],this._center.lat);return new r.O(r.X(o[0],f[0],_)/this.worldSize,r.X(o[1],f[1],_)/this.worldSize,r.X(y,b,_))}pointCoordinate(n,o=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,o)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let o=this.projection.pointCoordinate3D(this,n.x,n.y);if(o)return new r.O(o[0],o[1],o[2]);let f=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const y=.02*_,b=n.clone();for(let M=0;M<10&&_-f>y;M++){b.y=r.X(f,_,.66);const I=this.projection.pointCoordinate3D(this,b.x,b.y);I?(_=b.y,o=I):f=b.y}return o?new r.O(o[0],o[1],o[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.bA)return!this.isPointAboveHorizon(n);const o=this.pointCoordinate(n);return o.y>=0&&o.y<=1}_coordinatePoint(n,o){const f=o&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return r.aa.transformMat4(_,_,this.pixelMatrix),_[3]>0?new r.P(_[0]/_[3],_[1]/_[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:o}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new r.P(o,n)),b=this.pointLocation3D(new r.P(_,n)),M=this.pointLocation3D(new r.P(_,f)),I=this.pointLocation3D(new r.P(o,f));let D=Math.min(y.lng,b.lng,M.lng,I.lng),z=Math.max(y.lng,b.lng,M.lng,I.lng),k=Math.min(y.lat,b.lat,M.lat,I.lat),F=Math.max(y.lat,b.lat,M.lat,I.lat);const N=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,U=($,q,Y,re,ne)=>{const oe=($+Y)/2,H=(q+re)/2,J=new r.P(oe,H),{lng:he,lat:ce}=this.pointLocation3D(J),ge=Math.max(0,D-he,k-ce,he-z,ce-F);D=Math.min(D,he),z=Math.max(z,he),k=Math.min(k,ce),F=Math.max(F,ce),(ne<G||ge>N)&&(U($,q,oe,H,ne+1),U(oe,H,Y,re,ne+1))};if(U(o,n,_,n,1),U(_,n,_,f,1),U(_,f,o,f,1),U(o,f,o,n,1),this.projection.name==="globe"){const[$,q]=r.bB(this);$?(F=90,z=180,D=-180):q&&(k=-90,z=180,D=-180)}return new r.ag(new r.bq(D,k),new r.bq(z,F))}_getBoundsRectangular(n,o){const{top:f,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,M=new r.P(_,f),I=new r.P(b,f),D=new r.P(b,y),z=new r.P(_,y);let k=this.pointCoordinate(M,n),F=this.pointCoordinate(I,n);const N=this.pointCoordinate(D,o),G=this.pointCoordinate(z,o),U=($,q)=>(q.y-$.y)/(q.x-$.x);return k.y>1&&F.y>=0?k=new r.O((1-G.y)/U(G,k)+G.x,1):k.y<0&&F.y<=1&&(k=new r.O(-G.y/U(G,k)+G.x,0)),F.y>1&&k.y>=0?F=new r.O((1-N.y)/U(N,F)+N.x,1):F.y<0&&k.y<=1&&(F=new r.O(-N.y/U(N,F)+N.x,0)),new r.ag().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=n.visibleDemTiles.reduce((f,_)=>{if(_.dem){const y=_.dem.tree;f.min=Math.min(f.min,y.minimums[0]),f.max=Math.max(f.max,y.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*n.exaggeration(),o.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-o*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.bz,this.maxLat=r.bz,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.a8(this.minLng)*this.tileSize,this.worldMaxX=r.a8(this.maxLng)*this.tileSize,this.worldMinY=r.ah(this.maxLat)*this.tileSize,this.worldMaxY=r.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,o){return this.projection.createTileMatrix(this,o,n)}calculateDistanceTileData(n){const o=n.key,f=this._distanceTileDataCache;if(f[o])return f[o];const _=n.canonical,y=1/this.height,b=this.cameraWorldSize,M=b/this.zoomScale(_.z),I=(_.x+Math.pow(2,_.z)*n.wrap)*M,D=_.y*M,z=this.point;z.x*=b/this.worldSize,z.y*=b/this.worldSize;const k=this.angle,F=Math.sin(-k),N=-Math.cos(-k);return f[o]={bearing:[F,N],center:[(z.x-I)*y,(z.y-D)*y],scale:M/r.Y*y},f[o]}calculateFogTileMatrix(n){const o=n.key,f=this._fogTileMatrixCache;if(f[o])return f[o];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.a9.multiply(_,this.worldToFogMatrix,_),f[o]=new Float32Array(_),f[o]}calculateProjMatrix(n,o=!1,f=!1){const _=n.key;let y;if(y=f?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];const b=this.calculatePosMatrix(n,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,r.a9.multiply(b,M,b),y[_]=new Float32Array(b),y[_]}calculatePixelsToTileUnitsMatrix(n){const o=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[o])return f[o];const _=r.bC(n,this);return f[o]=_,f[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,o=r.a9.fromScaling([],[n,n,n]);return r.a9.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const o=r.bo(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(o),_=this._camera.forward(),y=r.bo(1,this._center.lat);f[2]/=y,_[2]/=y,r.Q.normalize(_,_);const b=n.raycast(f,_,n.exaggeration());if(b){const M=r.Q.scaleAndAdd([],f,_,b),I=new r.O(M[0],M[1],r.bo(M[2],r.ax(M[1]))),D=(I.z+r.Q.length([I.x-f[0],I.y-f[1],I.z-f[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const o=this._elevation,f=r.bo(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),y=o.getAtPointOrZero(new r.O(..._)),b=this.pixelsPerMeter/this.worldSize*y,M=this._minimumHeightOverTerrain(),I=_[2]-b;if(I<=M)if(I<0||n){const D=this.locationCoordinate(this._center,this._centerAltitude),z=[_[0],_[1],D.z-_[2]],k=r.Q.length(z);z[2]-=(M-I)/this._pixelsPerMercatorPixel;const F=r.Q.length(z);if(F===0)return;r.Q.scale(z,z,k/F*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],D.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const F=this.center;return F.lat=r.ad(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(F.lng=r.ad(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const o=this._unmodified,{x:f,y:_}=this.point;let y=0,b=f,M=_;const I=this.width/2,D=this.height/2,z=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(_-D<z&&(M=z+D),_+D>k&&(M=k-D),k-z<this.height&&(y=Math.max(y,this.height/(k-z)),M=(k+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,G=this.worldSize/2-(F+N)/2;b=(f+G+this.worldSize)%this.worldSize-G,b-I<F&&(b=F+I),b+I>N&&(b=N-I),N-F<this.width&&(y=Math.max(y,this.width/(N-F)),b=(N+F)/2)}b===f&&M===_||(this.center=this.unproject(new r.P(b,M))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,o=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bo(1,this.center.lat)/r.bo(1,r.bL));const _=r.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,y);let M;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-n.x/this.width,I[9]=2*n.y/this.height,this.isOrthographic){let ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=ce*this.aspect,Ae=-ge,_e=-ce;ge-=n.x,Ae-=n.x,ce+=n.y,_e+=n.y,M=this._camera.getCameraToClipOrthographic(Ae,ge,_e,ce,this._nearZ,this._farZ),((Te,Pe,me,be)=>{for(let Ze=0;Ze<16;Ze++)Te[Ze]=Uh(Pe[Ze],me[Ze],be)})(M,M,I,va(this.pitch>=15?1:this.pitch/15))}else M=I;const D=r.a9.mul([],I,b);let z=r.a9.mul([],M,b);if(this.projection.isReprojectedInTileSpace){const ce=this.locationCoordinate(this.center),ge=r.a9.identity([]);r.a9.translate(ge,ge,[ce.x*this.worldSize,ce.y*this.worldSize,0]),r.a9.multiply(ge,ge,r.bE(this)),r.a9.translate(ge,ge,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),r.a9.multiply(z,z,ge),r.a9.multiply(D,D,ge),this.inverseAdjustmentMatrix=r.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.a9.scale([],z,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=z,this.invProjMatrix=r.a9.invert(new Float64Array(16),this.projMatrix),o){const ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ce[8]=2*-n.x/this.width,ce[9]=2*n.y/this.height,this.expandedFarZProjMatrix=r.a9.mul([],ce,b)}else this.expandedFarZProjMatrix=this.projMatrix;const k=r.a9.invert([],M);this.frustumCorners=r.bG.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const F=new Float32Array(16);r.a9.identity(F),r.a9.scale(F,F,[1,-1,1]),r.a9.rotateX(F,F,this._pitch),r.a9.rotateZ(F,F,this.angle);const N=r.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.a9.clone(N);const G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-n.x/this.width,N[9]=2*(n.y+G)/this.height,this.skyboxMatrix=r.a9.multiply(F,N,F);const U=this.point,$=U.x,q=U.y,Y=this.width%2/2,re=this.height%2/2,ne=Math.cos(this.angle),oe=Math.sin(this.angle),H=$-Math.round($)+ne*Y+oe*re,J=q-Math.round(q)+ne*re+oe*Y,he=new Float64Array(z);if(r.a9.translate(he,he,[H>.5?H-1:H,J>.5?J-1:J,0]),this.alignedProjMatrix=he,z=r.a9.create(),r.a9.scale(z,z,[this.width/2,-this.height/2,1]),r.a9.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=r.a9.create(),r.a9.scale(z,z,[1,-1,1]),r.a9.translate(z,z,[-1,-1,0]),r.a9.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=r.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},z=r.a9.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.bH(this);const ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.Q.transformMat4(ce,ce,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[n,n,o];r.Q.scale(y,y,_),r.Q.scale(f,f,-1),r.Q.multiply(f,f,y);const b=r.a9.create();r.a9.translate(b,b,f),r.a9.scale(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,o,_)}_computeCameraPosition(n){const o=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*y,_.y/this.worldSize-f[1]*y,n/this.worldSize*this._centerAltitude-f[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=n[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((o-f)/_,1)),this._camera.position=r.Q.scaleAndAdd([],this._camera.position,n,y),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,o=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),y=r.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.bm(this._maxPitch)),M=Math.max((n[2]-y)/Math.cos(f),b),I=this._zoomFromMercatorZ(M);r.Q.scaleAndAdd(n,n,o,M),this._pitch=r.ad(f,r.bm(this.minPitch),r.bm(this.maxPitch)),this.angle=r.bk(_,-Math.PI,Math.PI),this._setZoom(r.ad(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.O(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let o=0,f=r.bA,_=0,y=1/0;for(;f-o>1e-6&&f>o;){const b=o+.5*(f-o),M=this.tileSize*Math.pow(2,b),I=this.getCameraToCenterDistance(this.projection,b,M),D=this.scaleZoom(I/(n*this.tileSize)),z=Math.abs(b-D);z<y&&(y=z,_=b),b<D?o=b:f=b}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,o){const f=Math.min(n.x,o.x),_=Math.max(n.x,o.x),y=Math.min(n.y,o.y),b=Math.max(n.y,o.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new r.P(f,y),new r.P(_,b),new r.P(f,b),new r.P(_,y)],I=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const z of M){const k=this.pointRayIntersection(z);if(k.t<0)return!0;const F=this.rayIntersectionCoordinate(k);if(F.x<I||F.y<0||F.x>D||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(n,o){const f=r.Q.length(r.Q.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(f)+o;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([o,f,_],y){const b=[o,f,_,1];r.aa.transformMat4(b,b,y);const M=b[3]=Math.max(b[3],1e-6);return b[0]/=M,b[1]/=M,b[2]/=M,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,n))}}getCameraToCenterDistance(n,o=this.zoom,f=this.worldSize){const _=r.bD(n,o,this.width,this.height,1024),y=n.pixelSpaceConversion(this.center.lat,f,_);let b=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(b=Uh(1,b,va(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.a9.multiply(n,n,this.globeMatrix),n}getFrustum(n){return r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Pr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},po=(h,n)=>{if(n>0&&h.terrain&&r.w("Cutoff is currently disabled on terrain"),n<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=h.transform,f=Math.max(Math.abs(o._zoom-(h.minCutoffZoom-1)),1),_=o.isLODDisabled(!1)?r.S(60,45,o.pitch):r.S(30,15,o.pitch),y=o._farZ-o._nearZ,b=n*o.height,M=((1-(I=_))*o.cameraToCenterDistance+I*(o._farZ+b))*f;var I;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(M-o._nearZ)/y,(M-b-o._nearZ)/y]}}},Dr={cascadeCount:2,shadowMapResolution:2048};class mp{constructor(n,o){this.aabb=n,this.lastCascade=o}}class fg{add(n,o){const f=this.receivers[n.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],o.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],o.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],o.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],o.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],o.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],o.max[2])):this.receivers[n.key]=new mp(o,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,o,f){const _=r.bV.fromPoints(n.points);let y=0;for(const b in this.receivers){const M=this.receivers[b];if(!M||!_.intersectsAabb(M.aabb))continue;M.aabb.min=_.closestPoint(M.aabb.min),M.aabb.max=_.closestPoint(M.aabb.max);const I=M.aabb.getCorners();for(let D=0;D<f.length;D++){let z=!0;for(const k of I){const F=[k[0]*o,k[1]*o,k[2]];if(r.Q.transformMat4(F,F,f[D].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){z=!1;break}}if(M.lastCascade=D,y=Math.max(y,D),z)break}}return y+1}}class _p{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new fg,this._depthMode=new Vt(n.context.gl.LEQUAL,Vt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(Dr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Dr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,o){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const _=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((G,U)=>{const $=f.style._mergedLayers[U];return G+($.hasShadowPass()&&!$.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=f.context,b=Dr.shadowMapResolution,M=Dr.shadowMapResolution;if(this._cascades.length===0||Dr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let G=0;G<Dr.cascadeCount;++G){const U=f._shadowMapDebug,$=y.gl,q=y.createFramebuffer(b,M,U,"texture"),Y=new r.T(y,{width:b,height:M,data:null},$.DEPTH_COMPONENT);if(q.depthAttachment.set(Y.texture),U){const re=new r.T(y,{width:b,height:M,data:null},$.RGBA);q.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:q,texture:Y,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bt,scale:0})}}this.shadowDirection=hu(o);let I=0;if(n.elevation){const G=n.elevation,U=[1e4,-1e4];G.visibleDemTiles.filter($=>$.dem).forEach($=>{const q=$.dem.tree;U[0]=Math.min(U[0],q.minimums[0]),U[1]=Math.max(U[1],q.maximums[0])}),U[0]!==1e4&&(I=(U[1]-U[0])*G.exaggeration())}const D=1.5*n.cameraToCenterDistance,z=3*D,k=new Float64Array(16);for(let G=0;G<this._cascades.length;++G){const U=this._cascades[G];let $=n.height/50,q=1;Dr.cascadeCount===1?q=z:G===0?q=D:($=D,q=z);const[Y,re]=du(n,this.shadowDirection,$,q,Dr.shadowMapResolution,I);U.scale=n.scale,U.matrix=Y,U.boundingSphereRadius=re,r.a9.invert(k,U.matrix),U.frustum=r.bt.fromInvProjectionMatrix(k,1,0,!0),U.far=q}const F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Dr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Dr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Pr.ShadowMap0,this._uniformValues.u_shadowmap_1=Pr.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const N=f.transform.elevation;for(const G of this._groundShadowTiles){let U={min:0,max:0};if(N){const $=N.getMinMaxForTile(G);$&&(U=$)}this.addShadowReceiver(G.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,o){if(!this.enabled)return;const f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,Dr.shadowMapResolution,Dr.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){f.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:r.aA.white,depth:1});for(const b of n.order){const M=n._mergedLayers[b];if(!M.hasShadowPass()||M.isHidden(f.transform.zoom))continue;const I=n.getLayerSourceCache(M),D=I?o[I.id]:void 0;(M.type==="model"||D&&D.length)&&f.renderLayer(f,I,M,D)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,o=n.style,f=n.context,_=o.directionalLight,y=o.ambientLight;if(!_||!y)return;const b=[],M=po(n,n.longestCutoffRange);M.shouldRenderCutoff&&b.push("RENDER_CUTOFF");const I=Gh(_,y),D=new Vt(f.gl.LEQUAL,Vt.ReadOnly,n.depthRangeFor3D);for(const z of this._groundShadowTiles){const k=z.toUnwrapped(),F=n.isTileAffectedByFog(z),N=n.getOrCreateProgram("groundShadow",{defines:b,overrideFog:F});this.setupShadows(k,N),n.uploadCommonUniforms(f,N,k,null,M);const G={u_matrix:n.transform.calculateProjMatrix(k),u_ground_shadow_factor:I};N.draw(n,f.gl.TRIANGLES,D,Xt.disabled,ci.multiply,Wt.disabled,G,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ci.unblended:ci.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const o=this.painter.transform,f=o.calculatePosMatrix(n,o.worldSize);return r.a9.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(n){return r.a9.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,o,f,_=0){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,M=b.gl,I=this._uniformValues,D=new Float64Array(16),z=y.calculatePosMatrix(n,y.worldSize);for(let k=0;k<this._cascades.length;k++)r.a9.multiply(D,this._cascades[k].matrix,z),I[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),b.activeTexture.set(M.TEXTURE0+Pr.ShadowMap0+k),this._cascades[k].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){const k=r.bU(n.canonical),F=2/y.tileSize*r.Y/Dr.shadowMapResolution,N=F*this._cascades[0].boundingSphereRadius,G=F*this._cascades[this._cascades.length-1].boundingSphereRadius,U=(f==="vector-tile"?1:3)/Math.pow(2,_-n.canonical.z-(1-y.zoom+Math.floor(y.zoom)));I.u_shadow_normal_offset=[k,N*U,G*U],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(b,I)}setupShadowsFromMatrix(n,o,f=!1){if(!this.enabled)return;const _=this.painter.context,y=_.gl,b=this._uniformValues,M=new Float64Array(16);for(let I=0;I<Dr.cascadeCount;I++)r.a9.multiply(M,this._cascades[I].matrix,n),b[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),_.activeTexture.set(y.TEXTURE0+Pr.ShadowMap0+I),this._cascades[I].texture.bind(y.NEAREST,y.CLAMP_TO_EDGE);this.useNormalOffset=f,f?(b.u_shadow_normal_offset=[1,5,5],b.u_shadow_bias=[6e-5,.0012,.012]):b.u_shadow_bias=[36e-5,.0012,.012],o.setShadowUniformValues(_,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,o,f,_){if(_[2]>=0)return{};const y=function(I,D,z){const k=z/(1<<I.canonical.z);return new r.bV([I.canonical.x*k+I.wrap*z,I.canonical.y*k+I.wrap*z,0],[(I.canonical.x+1)*k+I.wrap*z,(I.canonical.y+1)*k+I.wrap*z,D])}(n,o,f).getCorners(),b=o/-_[2];_[0]<0?(r.Q.add(y[0],y[0],[_[0]*b,0,0]),r.Q.add(y[3],y[3],[_[0]*b,0,0])):_[0]>0&&(r.Q.add(y[1],y[1],[_[0]*b,0,0]),r.Q.add(y[2],y[2],[_[0]*b,0,0])),_[1]<0?(r.Q.add(y[0],y[0],[0,_[1]*b,0]),r.Q.add(y[1],y[1],[0,_[1]*b,0])):_[1]>0&&(r.Q.add(y[2],y[2],[0,_[1]*b,0]),r.Q.add(y[3],y[3],[0,_[1]*b,0]));const M={};return M.vertices=y,M.planes=[uu(y[1],y[0],y[4]),uu(y[2],y[1],y[5]),uu(y[3],y[2],y[6]),uu(y[0],y[3],y[7])],M}addShadowReceiver(n,o,f){this._receivers.add(n,r.bV.fromTileIdAndHeight(n,o,f))}getMaxCascadeForTile(n){const o=this._receivers.get(n);return o&&o.lastCascade?o.lastCascade:0}}function uu(h,n,o){const f=r.Q.sub([],o,n),_=r.Q.sub([],h,n),y=r.Q.cross([],f,_),b=r.Q.length(y);return b===0?[0,0,1,0]:(r.Q.scale(y,y,1/b),[y[0],y[1],y[2],-r.Q.dot(y,n)])}function hu(h){const n=h.properties.get("direction"),o=r.bT(n.x,n.y,n.z);o[2]=r.ad(o[2],0,75);const f=r.bW([o[0],o[1],o[2]]);return r.Q.fromValues(f.x,f.y,f.z)}function Gh(h,n){const o=h.properties.get("color"),f=h.properties.get("intensity"),_=h.properties.get("direction"),y=[_.x,_.y,_.z],b=n.properties.get("color"),M=n.properties.get("intensity"),I=Math.max(r.Q.dot([0,0,1],y),0),D=[0,0,0];r.Q.scale(D,b.toArray01Linear().slice(0,3),M);const z=[0,0,0];return r.Q.scale(z,o.toArray01Linear().slice(0,3),I*f),r.bX([D[0]>0?D[0]/(D[0]+z[0]):0,D[1]>0?D[1]/(D[1]+z[1]):0,D[2]>0?D[2]/(D[2]+z[2]):0])}function du(h,n,o,f,_,y){const b=h.zoom,M=h.scale,I=h.worldSize,D=1/I,z=h.aspect,k=Math.sqrt(1+z*z)*Math.tan(.5*h.fovX),F=k*k,N=f-o,G=f+o;let U,$;F>N/G?(U=f,$=f*k):(U=.5*G*(1+F),$=.5*Math.sqrt(N*N+2*(f*f+o*o)*F+G*G*F*F));const q=h.projection.pixelsPerMeter(h.center.lat,I),Y=h._camera.getCameraToWorldMercator(),re=[0,0,-U*D];r.Q.transformMat4(re,re,Y);let ne=$*D;const oe=h._edgeInsets;if(!(oe.left===0&&oe.top===0&&oe.right===0&&oe.bottom===0||oe.left===oe.right&&oe.top===oe.bottom)){const se=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?q:1),je=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,o,f);je[8]=2*-h.centerOffset.x/h.width,je[9]=2*h.centerOffset.y/h.height;const vt=new Float64Array(16);r.a9.mul(vt,je,se);const At=new Float64Array(16);r.a9.invert(At,vt);const Ot=r.bt.fromInvProjectionMatrix(At,I,b,!0);for(const Pt of Ot.points){const Bt=((H=Pt)[0]/=M,H[1]/=M,H[2]=r.bo(H[2],h._center.lat),H);ne=Math.max(ne,r.Q.len(r.Q.subtract([],re,Bt)))}}var H;ne*=_/(_-1);const J=Math.acos(n[2]),he=Math.atan2(-n[0],-n[1]),ce=new Pl;ce.position=re,ce.setPitchBearing(J,he);const ge=ce.getWorldToCamera(I,q),Ae=ne*I,_e=Math.min(h._mercatorZfromZoom(17)*I*-2,-2*Ae),Te=ce.getCameraToClipOrthographic(-Ae,Ae,-Ae,Ae,_e,(Ae+y*q)/n[2]),Pe=new Float64Array(16);r.a9.multiply(Pe,Te,ge);const me=r.Q.fromValues(Math.floor(1e6*re[0])/1e6*I,Math.floor(1e6*re[1])/1e6*I,0),be=.5*_,Ze=[0,0,0];r.Q.transformMat4(Ze,me,Pe),r.Q.scale(Ze,Ze,be);const ye=[Math.floor(Ze[0]),Math.floor(Ze[1]),Math.floor(Ze[2])],Se=[0,0,0];r.Q.sub(Se,Ze,ye),r.Q.scale(Se,Se,-1/be);const Ie=new Float64Array(16);return r.a9.identity(Ie),r.a9.translate(Ie,Ie,Se),r.a9.multiply(Pe,Ie,Pe),[Pe,Ae]}const Cs=(h,n)=>bt(h,n&&n.filter(o=>o.identifier!=="source.canvas")),gp=r.af(zi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),pg=r.af(zi,["setCenter","setZoom","setBearing","setPitch"]),$h={version:8,layers:[],sources:{}},qh={duration:300,delay:0};class ms extends r.E{constructor(n,o={}){super(),this.map=n,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=r.e({},qh),this._buildingIndex=new Ph(this),this.crossTileSymbolIndex=new Vh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Qt,this.dispatcher=o.dispatcher?o.dispatcher:new r.bZ(r.b_(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new er,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new r.b$(n._requestManager,o.localFontFamily?r.c0.all:o.localIdeographFontFamily?r.c0.ideographs:r.c0.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new tn(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",r.c1());const f=this;this._rtlTextPluginCallback=ms.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,b)=>{if(r.c2(y),b&&b.every(M=>M))for(const M in f._sourceCaches){const I=f._sourceCaches[M],D=I.getSource().type;D!=="vector"&&D!=="geojson"||I.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const M=this._layers[b];M.source===y.id&&this._validateLayer(M)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(r.c3(n))return n;const o=r.c4(n);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${r.c5(JSON.stringify(n))}`}_diffStyle(n,o,f){this.globalId=this._getGlobalId(n);const _=(y,b)=>{try{b(null,this.setState(y,f))}catch(M){b(M,!1)}};if(typeof n=="string"){const y=this.map._requestManager.normalizeStyleURL(n),b=this.map._requestManager.transformRequest(y,r.R.Style);r.g(b,(M,I)=>{M?this.fire(new r.a(M)):I&&_(I,o)})}else typeof n=="object"&&_(n,o)}loadURL(n,o={}){this.fire(new r.b("dataloading",{dataType:"style"}));const f=typeof o.validate=="boolean"?o.validate:!r.c3(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,o.accessToken),this.resolvedImports.add(n);const _=this.importsCache.get(n);if(_)return this._load(_,f);const y=this.map._requestManager.transformRequest(n,r.R.Style);this._request=r.g(y,(b,M)=>{if(this._request=null,b)this.fire(new r.a(b));else if(M)return this.importsCache.set(n,M),this._load(M,f)})}loadJSON(n,o={}){this.fire(new r.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=r.f.frame(()=>{this._request=null,this._load(n,o.validate!==!1)})}loadEmpty(){this.fire(new r.b("dataloading",{dataType:"style"})),this._load($h,!1)}_loadImports(n,o,f){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const y of n){const b=this._createFragmentStyle(y),M=new Promise(z=>{b.once("style.import.load",z),b.once("error",z)}).then(()=>this.mergeAll());if(_.push(M),this.resolvedImports.has(y.url)){b.loadEmpty();continue}const I=y.data||this.importsCache.get(y.url);I?(b.loadJSON(I,{validate:o}),this._isInternalStyle(I)&&(b.globalId=null)):y.url?b.loadURL(y.url,{validate:o}):b.loadEmpty();const D={style:b,id:y.id,config:y.config};if(f){const z=this.fragments.findIndex(({id:k})=>k===f);this.fragments=this.fragments.slice(0,z).concat(D).concat(this.fragments.slice(z))}else this.fragments.push(D)}return Promise.allSettled(_)}getImportGlobalIds(n=this,o=new Set){for(const f of n.fragments)f.style.globalId&&o.add(f.style.globalId),this.getImportGlobalIds(f.style,o);return[...o.values()]}_createFragmentStyle(n){const o=this.scope?r.aj(n.id,this.scope):n.id;let f;const _=this._initialConfig&&this._initialConfig[o];(n.config||_)&&(f=r.e({},n.config,_));const y=new ms(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,o){const f=n.schema;if(this._isInternalStyle(n)){const M=r.e({},$h,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(M,o)}if(this.updateConfig(this._config,f),o&&Cs(this,qe(n)))return;this._loaded=!0,this.stylesheet=r.c6(n);for(const M in n.sources)this.addSource(M,n.sources[M],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const _=ap(this.stylesheet.layers);if(this._order=_.map(M=>M.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const M=this.stylesheet.lights[0];this.light=new Rt(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Rt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const M of _){const I=r.c7(M,this.scope,this.options);I.isConfigDependent&&this._configDependentLayers.add(I.fqid),I.setEventedParent(this,{layer:{id:I.id}}),this._layers[I.id]=I,this._serializedLayers[I.id]=I.serialize();const D=this.getOwnLayerSourceCache(I),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&I.canCastShadows()&&z&&(D.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const y=this.stylesheet.terrain;y&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(y,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.b("data",{dataType:"style"}));const b=this.isRootStyle();n.imports?this._loadImports(n.imports,o).then(()=>{this._reloadImports(),this.fire(new r.b(b?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.b(b?"style.load":"style.import.load")))}isRootStyle(){return this.importDepth===0}mergeAll(){let n,o,f,_,y,b,M,I;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(n=D.light),D.stylesheet.lights)for(const z of D.stylesheet.lights)z.type==="ambient"&&D.ambientLight!=null&&(o=D.ambientLight),z.type==="directional"&&D.directionalLight!=null&&(f=D.directionalLight);_=this._prioritizeTerrain(_,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(y=D.fog),D.stylesheet.camera!=null&&(I=D.stylesheet.camera),D.stylesheet.projection!=null&&(b=D.stylesheet.projection),D.stylesheet.transition!=null&&(M=D.stylesheet.transition)}}),this.light=n,this.ambientLight=o,this.directionalLight=f,this.fog=y,_===null?delete this.terrain:this.terrain=_,this.camera=I||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=r.e({},qh,M),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const o=f=>{for(const _ of f.fragments)o(_.style);n(f)};o(this)}_prioritizeTerrain(n,o,f){const _=n&&n.drapeRenderMode===0;return f===null?o&&o.drapeRenderMode===0?o:_?n:null:o!=null&&(!n||_||o&&o.drapeRenderMode===1)?o:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{n=this._prioritizeTerrain(n,o.terrain,o.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(n=o.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},o={},f={};this.forEachFragmentStyle(_=>{for(const y in _._sourceCaches){const b=r.aj(y,_.scope);n[b]=_._sourceCaches[y]}for(const y in _._otherSourceCaches){const b=r.aj(y,_.scope);o[b]=_._otherSourceCaches[y]}for(const y in _._symbolSourceCaches){const b=r.aj(y,_.scope);f[b]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=f}mergeLayers(){const n={},o=[],f={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(y=>{for(const b of y._order){const M=y._layers[b];if(M.type==="slot"){const I=r.c8(b);if(n[I])continue;n[I]=[]}M.slot&&n[M.slot]?n[M.slot].push(M):o.push(M)}}),this._mergedOrder=[];const _=(y=[])=>{for(const b of y)if(b.type==="slot"){const M=r.c8(b.id);n[M]&&_(n[M])}else{const M=r.aj(b.id,b.scope);this._mergedOrder.push(M),f[M]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0)}};_(o),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=r.e({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(o,f,_){let y,b,M;const I=r.f.devicePixelRatio>1?"@2x":"";let D=r.g(f.transformRequest(f.normalizeSpriteURL(o,I,".json"),r.R.SpriteJSON),(F,N)=>{D=null,M||(M=F,y=N,k())}),z=r.d(f.transformRequest(f.normalizeSpriteURL(o,I,".png"),r.R.SpriteImage),(F,N)=>{z=null,M||(M=F,b=N,k())});function k(){if(M)_(M);else if(y&&b){const F=r.f.getImageData(b),N={};for(const G in y){const{width:U,height:$,x:q,y:Y,sdf:re,pixelRatio:ne,stretchX:oe,stretchY:H,content:J}=y[G],he=new r.h({width:U,height:$});r.h.copy(F,he,{x:q,y:Y},{x:0,y:0},{width:U,height:$}),N[G]={data:he,pixelRatio:ne,sdf:re,stretchX:oe,stretchY:H,content:J}}_(null,N)}}return{cancel(){D&&(D.cancel(),D=null),z&&(z.cancel(),z=null)}}}(n,this.map._requestManager,(o,f)=>{if(this._spriteRequest=null,o)this.fire(new r.a(o));else if(f)for(const _ in f)this.imageManager.addImage(_,this.scope,f[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.b("data",{dataType:"style"}))})}_validateLayer(n){const o=this.getOwnSource(n.source);if(!o)return;const f=n.sourceLayer;f&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(f)===-1)&&this.fire(new r.a(new Error(`Source layer "${f}" does not exist on source "${o.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,o)=>{const f=this.fragments[o];return f&&f.style&&(n.data=f.style.serialize()),n})}_serializeSources(){const n={};for(const o in this._sourceCaches){const f=this._sourceCaches[o].getSource();n[f.id]||(n[f.id]=f.serialize())}return n}_serializeLayers(n){const o=[];for(const f of n){const _=this._layers[f];_&&_.type!=="custom"&&o.push(_.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const o=this.getOwnLayer(n);if(o)return o;this.fire(new r.a(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const o=this.getOwnSource(n);if(o)return o;this.fire(new r.a(new Error(`The source '${n}' does not exist in the map's style.`)))}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const o=this.calculateLightsBrightness();n.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const f=this._changes.isDirty();if(this._changes.isDirty()){const y=this._changes.getLayerUpdatesByScope();for(const b in y){const{updatedIds:M,removedIds:I}=y[b];(M||I)&&this._updateWorkerLayers(b,M,I)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}const _={};for(const y in this._mergedSourceCaches){const b=this._mergedSourceCaches[y];_[y]=b.used,b.used=!1,b.tileCoverLift=0}for(const y of this._mergedOrder){const b=this._mergedLayers[y];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const M=this.getLayerSourceCache(b);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,b.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let M=b.minzoom||0;M<(b.maxzoom||25.5);M++){const I=this.map.painter;if(I){const D=b.getProgramIds();if(!D)continue;for(const z of D){const k=b.getDefaultProgramParams(z,n.zoom);k&&(I.style=this,this.fog&&(I._fogVisible=!0,k.overrideFog=!0,I.getOrCreateProgram(z,k)),I._fogVisible=!1,k.overrideFog=!1,I.getOrCreateProgram(z,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,I.getOrCreateProgram(z,k)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const y in _){const b=this._mergedSourceCaches[y];_[y]!==b.used&&b.getSource().fire(new r.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new r.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,o,f){const _=this.getFragmentStyle(n);_&&this.dispatcher.broadcast("updateLayers",{layers:o?_._serializeLayers(o):[],scope:n,removedIds:f||[],options:_.options})}setState(n,o){if(this._checkLoaded(),Cs(this,qe(n)))return!1;(n=r.c6(n)).layers=ap(n.layers);const f=function(b,M){if(!b)return[{command:zi.setStyle,args:[M]}];let I=[];try{if(!B(b.version,M.version))return[{command:zi.setStyle,args:[M]}];B(b.center,M.center)||I.push({command:zi.setCenter,args:[M.center]}),B(b.zoom,M.zoom)||I.push({command:zi.setZoom,args:[M.zoom]}),B(b.bearing,M.bearing)||I.push({command:zi.setBearing,args:[M.bearing]}),B(b.pitch,M.pitch)||I.push({command:zi.setPitch,args:[M.pitch]}),B(b.sprite,M.sprite)||I.push({command:zi.setSprite,args:[M.sprite]}),B(b.glyphs,M.glyphs)||I.push({command:zi.setGlyphs,args:[M.glyphs]}),B(b.imports,M.imports)||function(N=[],G=[],U){G=G||[];const $=(N=N||[]).map(fa),q=G.map(fa),Y=N.reduce(bl,{}),re=G.reduce(bl,{}),ne=$.slice();let oe,H,J,he;for(oe=0,H=0;oe<$.length;oe++)J=$[oe],re.hasOwnProperty(J)?H++:(U.push({command:zi.removeImport,args:[J]}),ne.splice(ne.indexOf(J,H),1));for(oe=0,H=0;oe<q.length;oe++)J=q[q.length-1-oe],ne[ne.length-1-oe]!==J&&(Y.hasOwnProperty(J)?(U.push({command:zi.removeImport,args:[J]}),ne.splice(ne.lastIndexOf(J,ne.length-H),1)):H++,he=ne[ne.length-oe],U.push({command:zi.addImport,args:[re[J],he]}),ne.splice(ne.length-oe,0,J));for(const ce of G){const ge=Y[ce.id];ge&&!B(ge,ce)&&U.push({command:zi.updateImport,args:[ce.id,ce]})}}(b.imports,M.imports,I),B(b.transition,M.transition)||I.push({command:zi.setTransition,args:[M.transition]}),B(b.light,M.light)||I.push({command:zi.setLight,args:[M.light]}),B(b.fog,M.fog)||I.push({command:zi.setFog,args:[M.fog]}),B(b.projection,M.projection)||I.push({command:zi.setProjection,args:[M.projection]}),B(b.lights,M.lights)||I.push({command:zi.setLights,args:[M.lights]}),B(b.camera,M.camera)||I.push({command:zi.setCamera,args:[M.camera]});const D={},z=[];(function(N,G,U,$){let q;for(q in G=G||{},N=N||{})N.hasOwnProperty(q)&&(G.hasOwnProperty(q)||Dh(q,U,$));for(q in G){if(!G.hasOwnProperty(q))continue;const Y=G[q];N.hasOwnProperty(q)?B(N[q],Y)||(N[q].type==="geojson"&&Y.type==="geojson"&&Rh(N,G,q)?U.push({command:zi.setGeoJSONSourceData,args:[q,Y.data]}):lp(q,G,U,$)):Qc(q,G,U)}})(b.sources,M.sources,z,D);const k=[];b.layers&&b.layers.forEach(N=>{N.source&&D[N.source]?I.push({command:zi.removeLayer,args:[N.id]}):k.push(N)});let F=b.terrain;F&&D[F.source]&&(I.push({command:zi.setTerrain,args:[void 0]}),F=void 0),I=I.concat(z),B(F,M.terrain)||I.push({command:zi.setTerrain,args:[M.terrain]}),function(N,G,U){G=G||[];const $=(N=N||[]).map(fa),q=G.map(fa),Y=N.reduce(bl,{}),re=G.reduce(bl,{}),ne=$.slice(),oe=Object.create(null);let H,J,he,ce,ge,Ae,_e;for(H=0,J=0;H<$.length;H++)he=$[H],re.hasOwnProperty(he)?J++:(U.push({command:zi.removeLayer,args:[he]}),ne.splice(ne.indexOf(he,J),1));for(H=0,J=0;H<q.length;H++)he=q[q.length-1-H],ne[ne.length-1-H]!==he&&(Y.hasOwnProperty(he)?(U.push({command:zi.removeLayer,args:[he]}),ne.splice(ne.lastIndexOf(he,ne.length-J),1)):J++,Ae=ne[ne.length-H],U.push({command:zi.addLayer,args:[re[he],Ae]}),ne.splice(ne.length-H,0,he),oe[he]=!0);for(H=0;H<q.length;H++)if(he=q[H],ce=Y[he],ge=re[he],!oe[he]&&!B(ce,ge))if(B(ce.source,ge.source)&&B(ce["source-layer"],ge["source-layer"])&&B(ce.type,ge.type)){for(_e in Bo(ce.layout,ge.layout,U,he,null,zi.setLayoutProperty),Bo(ce.paint,ge.paint,U,he,null,zi.setPaintProperty),B(ce.slot,ge.slot)||U.push({command:zi.setSlot,args:[he,ge.slot]}),B(ce.filter,ge.filter)||U.push({command:zi.setFilter,args:[he,ge.filter]}),B(ce.minzoom,ge.minzoom)&&B(ce.maxzoom,ge.maxzoom)||U.push({command:zi.setLayerZoomRange,args:[he,ge.minzoom,ge.maxzoom]}),ce)ce.hasOwnProperty(_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&_e!=="slot"&&(_e.indexOf("paint.")===0?Bo(ce[_e],ge[_e],U,he,_e.slice(6),zi.setPaintProperty):B(ce[_e],ge[_e])||U.push({command:zi.setLayerProperty,args:[he,_e,ge[_e]]}));for(_e in ge)ge.hasOwnProperty(_e)&&!ce.hasOwnProperty(_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&_e!=="slot"&&(_e.indexOf("paint.")===0?Bo(ce[_e],ge[_e],U,he,_e.slice(6),zi.setPaintProperty):B(ce[_e],ge[_e])||U.push({command:zi.setLayerProperty,args:[he,_e,ge[_e]]}))}else U.push({command:zi.removeLayer,args:[he]}),Ae=ne[ne.lastIndexOf(he)+1],U.push({command:zi.addLayer,args:[ge,Ae]})}(k,M.layers,I)}catch(D){console.warn("Unable to compute style diff:",D),I=[{command:zi.setStyle,args:[M]}]}return I}(this.serialize(),n).filter(b=>!(b.command in pg));if(f.length===0)return!1;const _=f.filter(b=>!(b.command in gp));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);const y=[];return f.forEach(b=>{y.push(this[b.command].apply(this,b.args))}),o&&Promise.all(y).then(o),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,o){return this.getImage(n)?this.fire(new r.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,o),this._afterImageUpdated(n),this)}updateImage(n,o){this.imageManager.updateImage(n,this.scope,o)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new r.a(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,o,f={}){return this._checkLoaded(),this._validate(xt,`models.${n}`,o,null,f)||(this.modelManager.addModel(n,o,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new r.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,o,f={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Lt,`sources.${n}`,o,null,f))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const _=Ih(n,o,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const y=b=>{const M=(b?"symbol:":"other:")+_.id,I=r.aj(M,this.scope),D=this._sourceCaches[M]=new ds(I,_,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=D,D.onAdd(this.map)};y(!1),o.type!=="vector"&&o.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const o=this.getOwnSource(n);if(!o)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this.getOwnSourceCaches(n);for(const _ of f){const y=r.c8(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new r.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,o){this._checkLoaded(),this.getOwnSource(n).setData(o),this._changes.setDirty()}getOwnSource(n){const o=this.getOwnSourceCache(n);return o&&o.getSource()}getOwnSources(){const n=[];for(const o in this._otherSourceCaches){const f=this.getOwnSourceCache(o);f&&n.push(f.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const o in n){const f=n[o]._tiles;for(const _ in f){const y=f[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const _ of n){if(this._validate(Me,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const y=this.ambientLight;y.set(_),y.updateTransitions(o)}else this.ambientLight=new _r(_,cs,this.scope,this.options);break;case"directional":if(this.directionalLight){const y=this.directionalLight;y.set(_),y.updateTransitions(o)}else this.directionalLight=new _r(_,zn,this.scope,this.options)}}const f=new r.N(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,o=this.ambientLight;if(!n||!o)return;const f=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),_=n.properties.get("color").toArray01(),y=n.properties.get("intensity"),b=n.properties.get("direction"),M=1-r.bT(b.x,b.y,b.z)[2]/90,I=f(_)*y*M,D=o.properties.get("color").toArray01(),z=o.properties.get("intensity");return(I+f(D)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(r.c9(n)){const o=r.ca(n),f=this.fragments.find(({id:y})=>y===o);if(!f)throw new Error(`Style import not found: ${n}`);const _=r.c8(n);return f.style.getFragmentStyle(_)}{const o=this.fragments.find(({id:f})=>f===n);if(!o)throw new Error(`Style import not found: ${n}`);return o.style}}getConfigProperty(n,o){const f=this.getFragmentStyle(n);if(!f)return null;const _=r.aj(o,f.scope),y=f.options.get(_),b=y?y.value||y.default:null;return b?b.serialize():null}setConfigProperty(n,o,f){const _=this.getFragmentStyle(n);if(!_)return;const y=_.stylesheet.schema;if(!y||!y[o])return;const b=r.t(f);if(b.result!=="success")return void Cs(this,b.value);const M=b.value.expression,I=r.aj(o,_.scope),D=_.options.get(I);if(!D)return;let z;const{minValue:k,maxValue:F,stepValue:N,type:G,values:U}=y[o],$=r.t(y[o].default);$.result==="success"&&(z=$.value.expression),z?(this.options.set(I,{...D,value:M,default:z,minValue:k,maxValue:F,stepValue:N,type:G,values:U}),this.updateConfigDependencies()):this.fire(new r.a(new Error(`No schema defined for the config option "${o}" in the "${n}" fragment.`)))}getConfig(n){const o=this.getFragmentStyle(n);if(!o)return null;const f=o.stylesheet.schema;if(!f)return null;const _={};for(const y in f){const b=r.aj(y,o.scope),M=o.options.get(b),I=M?M.value||M.default:null;_[y]=I?I.serialize():null}return _}setConfig(n,o){const f=this.getFragmentStyle(n);f&&(f.updateConfig(o,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const o=this.getFragmentStyle(n);return o?o.stylesheet.schema:null}setSchema(n,o){const f=this.getFragmentStyle(n);f&&(f.stylesheet.schema=o,f.updateConfig(f._config,o),this.updateConfigDependencies())}updateConfig(n,o){if(this._config=n,n||o)if(o)for(const f in o){let _,y;const b=r.t(o[f].default);if(b.result==="success"&&(_=b.value.expression),n&&n[f]!==void 0){const F=r.t(n[f]);F.result==="success"&&(y=F.value.expression)}const{minValue:M,maxValue:I,stepValue:D,type:z,values:k}=o[f];if(_){const F=r.aj(f,this.scope);this.options.set(F,{default:_,value:y,minValue:M,maxValue:I,stepValue:D,type:z,values:k})}else this.fire(new r.a(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new r.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const n of this._configDependentLayers){const o=this.getLayer(n);o&&(o.possiblyEvaluateVisibility(),this._updateLayer(o))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(n,o,f={}){this._checkLoaded();const _=n.id;if(this._layers[_])return void this.fire(new r.a(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(n.type==="custom"){if(Cs(this,r.cb(n)))return;y=r.c7(n,this.scope,this.options)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=r.c6(n),n=r.e(n,{source:_})),this._validate(de,`layers.${_}`,n,{arrayIndex:-1},f))return;y=r.c7(n,this.scope,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[y.id]=y.serialize()}y.isConfigDependent&&this._configDependentLayers.add(y.fqid);let b=this._order.length;if(o){const z=this._order.indexOf(o);if(z===-1)return void this.fire(new r.a(new Error(`Layer with id "${o}" does not exist on this map.`)));y.slot===this._layers[o].slot?b=z:r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const M=this.getOwnLayerSourceCache(y),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&y.canCastShadows()&&I&&(M.castsShadows=!0);const D=this._changes.getRemovedLayer(y);if(D&&y.source&&M&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const z=r.aj(y.source,y.scope);D.type!==y.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),M.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(n,o){this._checkLoaded();const f=this._checkLayer(n);if(!f||n===o)return;const _=this._order.indexOf(n);this._order.splice(_,1);let y=this._order.length;if(o){const b=this._order.indexOf(o);if(b===-1)return void this.fire(new r.a(new Error(`Layer with id "${o}" does not exist on this map.`)));f.slot===this._layers[o].slot?y=b:r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const o=this._checkLayer(n);if(!o)return;o.setEventedParent(null);const f=this._order.indexOf(n);this._order.splice(f,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const _=this.getOwnLayerSourceCache(o);if(_&&_.castsShadows){let y=!1;for(const b in this._layers)if(this._layers[b].source===o.source&&this._layers[b].canCastShadows()){y=!0;break}_.castsShadows=y}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const o in this._layers)if(this._layers[o].type===n)return!0;return!1}setLayerZoomRange(n,o,f){this._checkLoaded();const _=this._checkLayer(n);_&&(_.minzoom===o&&_.maxzoom===f||(o!=null&&(_.minzoom=o),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}setSlot(n,o){this._checkLoaded();const f=this._checkLayer(n);f&&f.slot!==o&&(f.slot=o,this._updateLayer(f))}setFilter(n,o,f={}){this._checkLoaded();const _=this._checkLayer(n);if(_&&!B(_.filter,o))return o==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Ce,`layers.${_.id}.filter`,o,{layerType:_.type},f)||(_.filter=r.c6(o),this._updateLayer(_)))}getFilter(n){const o=this._checkLayer(n);if(o)return r.c6(o.filter)}setLayoutProperty(n,o,f,_={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!B(y.getLayoutProperty(o),f)){if(f!=null&&(!_||_.validate!==!1)&&Cs(y,He.call(qe,{key:`layers.${n}.layout.${o}`,layerType:y.type,objectKey:o,value:f,styleSpec:r.G,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(o,f),y.isConfigDependent&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(n,o){const f=this._checkLayer(n);if(f)return f.getLayoutProperty(o)}setPaintProperty(n,o,f,_={}){this._checkLoaded();const y=this._checkLayer(n);if(!y||B(y.getPaintProperty(o),f)||f!=null&&(!_||_.validate!==!1)&&Cs(y,ke.call(qe,{key:`layers.${n}.paint.${o}`,layerType:y.type,objectKey:o,value:f,styleSpec:r.G})))return;const b=y.setPaintProperty(o,f);y.isConfigDependent&&this._configDependentLayers.add(y.fqid),b&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(n,o){const f=this._checkLayer(n);if(f)return f.getPaintProperty(o)}setFeatureState(n,o){this._checkLoaded();const f=n.source,_=n.sourceLayer,y=this._checkSource(f);if(!y)return;const b=y.type;if(b==="geojson"&&_)return void this.fire(new r.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!_)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(f);for(const I of M)I.setFeatureState(_,n.id,o)}removeFeatureState(n,o){this._checkLoaded();const f=n.source,_=this._checkSource(f);if(!_)return;const y=_.type,b=y==="vector"?n.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.a(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(f);for(const I of M)I.removeFeatureState(b,n.id,o)}getFeatureState(n){this._checkLoaded();const o=n.source,f=n.sourceLayer,_=this._checkSource(o);if(_){if(_.type!=="vector"||f)return n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(f,n.id);this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=r.e({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return r.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),o=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return r.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(n){this._changes.updateLayer(n);const o=this.getLayerSourceCache(n),f=r.aj(n.source,n.scope),_=this._changes.getUpdatedSourceCaches();n.source&&!_[f]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),o.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const o=M=>this._mergedLayers[M].type==="fill-extrusion"||this._mergedLayers[M].type==="model",f=this.order,_={},y=[];for(let M=f.length-1;M>=0;M--){const I=f[M];if(o(I)){_[I]=M;for(const D of n){const z=D[I];if(z)for(const k of z)y.push(k)}}}y.sort((M,I)=>I.intersectionZ-M.intersectionZ);const b=[];for(let M=f.length-1;M>=0;M--){const I=f[M];if(o(I))for(let D=y.length-1;D>=0;D--){const z=y[D].feature;if(_[z.layer.id]<M)break;b.push(z),y.pop()}else for(const D of n){const z=D[I];if(z)for(const k of z)b.push(k.feature)}}return b}queryRenderedFeatures(n,o,f){o&&o.filter&&this._validate(Ce,"queryRenderedFeatures.filter",o.filter,null,o),o.scope=this.scope,o.availableImages=this._availableImages,o.serializedLayers=this._serializedLayers;const _={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new r.a(new Error("parameters.layers must be an Array."))),[];for(const D of o.layers){const z=this._mergedLayers[D];if(!z)return this.fire(new r.a(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const y=[],b=o.serializedLayers||{},M=o&&o.layers?o.layers.some(D=>{const z=this.getLayer(D);return z&&z.is3D()}):this.has3DLayers(),I=mn.createFromScreenPoints(n,f);for(const D in this._mergedSourceCaches){const z=this._mergedSourceCaches[D].getSource();if(!z||z.scope!==o.scope)continue;const k=this._mergedSourceCaches[D].getSource().id;o.layers&&!_[k]||y.push(Mi(this._mergedSourceCaches[D],this._mergedLayers,b,I,o,f,M,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(D,z,k,F,N,G,U){const $={},q=G.queryRenderedSymbols(F),Y=[];for(const re of Object.keys(q).map(Number))Y.push(U[re]);Y.sort(sp);for(const re of Y){const ne=re.featureIndex.lookupSymbolFeatures(q[re.bucketInstanceId],z,re.bucketIndex,re.sourceLayerIndex,N.filter,N.layers,N.availableImages,D);for(const oe in ne){const H=$[oe]=$[oe]||[],J=ne[oe];J.sort((he,ce)=>{const ge=re.featureSortOrder;if(ge){const Ae=ge.indexOf(he.featureIndex);return ge.indexOf(ce.featureIndex)-Ae}return ce.featureIndex-he.featureIndex});for(const he of J)H.push(he)}}for(const re in $)$[re].forEach(ne=>{const oe=ne.feature,H=k(D[re]);if(!H)return;const J=H.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=J});return $}(this._mergedLayers,b,this.getLayerSourceCache.bind(this),I.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(n,o){o&&o.filter&&this._validate(Ce,"querySourceFeatures.filter",o.filter,null,o);const f=this.getOwnSourceCaches(n);let _=[];for(const y of f)_=_.concat(Er(y,o));return _}addSourceType(n,o,f){return ms.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(ms.setSourceType(n,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:o.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,o,f={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const M in n)if(!B(n[M],_[M])){y=!0;break}if(!y)return;const b=this._getTransitionParameters();this.light.setLight(n,o,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,o=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()&&o!==0||delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let f=n;const _=n.source==null;if(o===1){if(typeof f.source=="object"){const M="terrain-dem-src";this.addSource(M,f.source),f=r.c6(f),f=r.e(f,{source:M})}const y=r.e({},f),b={};if(this.terrain&&_){y.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(b.style=M.serialize())}if(this._validate(Q,"terrain",y,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&o!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,o),this.fire(new r.b("data",{dataType:"style"}))}else{const y=this.terrain,b=y.get();for(const M of Object.keys(r.G.terrain))!f.hasOwnProperty(M)&&r.G.terrain[M].default&&(f[M]=r.G.terrain[M].default);for(const M in n)if(!B(n[M],b[M])){y.set(n,this.options),this.stylesheet.terrain=n;const I=this._getTransitionParameters({duration:0});y.updateTransitions(I),this.fire(new r.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const o=this.fog=new Tr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!B(o.get(),n)){o.set(n,this.options),this.stylesheet.fog=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}}else this._createFog(n);this._markersNeedUpdate=!0}_getTransitionParameters(n){return{now:r.f.now(),transition:r.e(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],o=[];for(const f in this._mergedLayers)this.isLayerDraped(this._mergedLayers[f])?n.push(f):o.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...o)}_createTerrain(n,o){const f=this.terrain=new fi(n,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const o=this._layers[n];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const o=this._layers[n];o.type==="symbol"&&this._updateLayer(o)}}_validate(n,o,f,_,y={}){if(y&&y.validate===!1)return!1;const b=r.e({},this.serialize());return Cs(this,n.call(qe,r.e({key:o,style:b,value:f,styleSpec:r.G},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const o=this.getSourceCaches(n);for(const f of o)f.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const o=this.getSourceCaches(n);for(const f of o)f.resume(),f.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let o;this.directionalLight&&(o=hu(this.directionalLight));for(const f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(n,void 0,void 0,o)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const o=this._sourceCaches[n];o.resume(),o.reload()}}_updatePlacement(n,o,f,_,y=!1){let b=!1,M=!1;const I={},D={};for(const z of this._mergedOrder){const k=this._mergedLayers[z];if(k.type!=="symbol")continue;const F=r.aj(k.source,k.scope);let N=I[F];if(!N){const U=this.getLayerSourceCache(k);if(!U)continue;const $=U.getRenderableIds(!0).map(q=>U.getTileByID(q));D[F]=$.slice(),N=I[F]=$.sort((q,Y)=>Y.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(Y.tileID)?-1:1))}const G=this.crossTileSymbolIndex.addLayer(k,N,n.center.lng,n.projection);b=b||G}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),y=y||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new r.b("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.f.now(),n.zoom))&&(this.pauseablePlacement=new Al(n,this._mergedOrder,y,o,f,_,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.f.now()),M=!0),b&&this.pauseablePlacement.placement.setStale()),M||b){this._buildingIndex.onNewFrame(n.zoom);for(const z of this._mergedOrder){const k=this._mergedLayers[z];k.type==="symbol"&&this.placement.updateLayerOpacities(k,I[r.aj(k.source,k.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.f.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,o){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:y})=>y===n.id)!==-1)return void this.fire(new r.a(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!o)return f.push(n),this._loadImports([n],!0);const _=f.findIndex(({id:y})=>y===o);return _===-1&&this.fire(new r.a(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(n).concat(f.slice(_)),this._loadImports([n],!0,o)}updateImport(n,o){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(n);return _===-1?this:typeof o=="string"?(this.setImportUrl(n,o),this):(o.url&&o.url!==f[_].url&&this.setImportUrl(n,o.url),B(o.config,f[_].config)||this.setImportConfig(n,o.config),B(o.data,f[_].data)||this.setImportData(n,o.data),this)}moveImport(n,o){this._checkLoaded();let f=this.stylesheet.imports||[];const _=this.getImportIndex(n);if(_===-1)return this;const y=this.getImportIndex(o);if(y===-1)return this;const b=f[_],M=this.fragments[_];return f=f.filter(({id:I})=>I!==n),this.fragments=this.fragments.filter(({id:I})=>I!==n),this.stylesheet.imports=f.slice(0,y).concat(b).concat(f.slice(y)),this.fragments=this.fragments.slice(0,y).concat(M).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(n,o){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(n);if(_===-1)return this;f[_].url=o;const y=this.fragments[_];return y.style=this._createFragmentStyle(f[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(o),this}setImportData(n,o){this._checkLoaded();const f=this.getImportIndex(n),_=this.stylesheet.imports||[];return f===-1?this:o?(this.fragments[f].style.setState(o),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(n,_[f].url))}setImportConfig(n,o){this._checkLoaded();const f=this.getImportIndex(n),_=this.stylesheet.imports||[];if(f===-1)return this;o?_[f].config=o:delete _[f].config;const y=this.fragments[f],b=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=o,y.style.updateConfig(o,b),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const o=this.stylesheet.imports||[],f=this.getImportIndex(n);f!==-1&&(o.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(n){const o=(this.stylesheet.imports||[]).findIndex(f=>f.id===n);return o===-1&&this.fire(new r.a(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),o}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const o in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[o];f&&n.push(f.getSource())}return n}getSource(n,o){const f=this.getSourceCache(n,o);return f&&f.getSource()}getLayerSource(n){const o=this.getLayerSourceCache(n);return o&&o.getSource()}getSourceCache(n,o){const f=r.aj(n,o);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(n){const o=r.aj(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[n]&&o.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&o.push(this._mergedSymbolSourceCaches[n]),o}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const o in n){const f=n[o];f==="reload"?this.reloadSource(o):f==="clear"&&this.clearSource(o)}}updateLayers(n){const o=this._changes.getUpdatedPaintProperties();for(const f of o){const _=this.getLayer(f);_&&_.updateTransitions(n)}}getImages(n,o,f){this.imageManager.getImages(o.icons,o.scope,f),this._updateTilesForChangedImages();const _=y=>{y&&y.setDependencies(o.tileID.key,o.type,o.icons)};_(this._otherSourceCaches[o.source]),_(this._symbolSourceCaches[o.source])}getGlyphs(n,o,f){this.glyphManager.getGlyphs(o.stacks,o.scope,f)}getResource(n,o,f){return r.ce(o,f)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const o=[];return this._otherSourceCaches[n]&&o.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&o.push(this._symbolSourceCaches[n]),o}_isSourceCacheLoaded(n){const o=this.getOwnSourceCaches(n);return o.length===0?(this.fire(new r.a(new Error(`There is no source with ID '${n}'`))),!1):o.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ms.getSourceType=function(h){return ct[h]},ms.setSourceType=function(h,n){ct[h]=n},ms.registerForPluginStateChange=r.bY;var Dl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Wh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,fu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,mo="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",pu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Uo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Hh=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Rl=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,mu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,zl=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,_u=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ni=[];_o(Dl,Ni),_o(fu,Ni),_o(Wh,Ni);const ai={"_prelude_fog.vertex.glsl":Uo,"_prelude_terrain.vertex.glsl":pu,"_prelude_shadow.vertex.glsl":zl,"_prelude_fog.fragment.glsl":Hh,"_prelude_shadow.fragment.glsl":_u,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Rl,"_prelude_raster_particle.glsl":mu},Ll={};ui("",pu),ui(Hh,Uo),ui(_u,zl),ui(Rl,""),ui(mu,"");const kl=ui(Wh,fu),gu=Dl;var _s={background:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ui("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ui(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ui("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ui("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ui(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ui(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ui(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ui(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;
#ifdef LINE_JOIN_NONE
in vec2 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ui("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ui("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ui(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:ui(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:ui(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:ui(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ui("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ui(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,mo),skyboxGradient:ui(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,mo),skyboxCapture:ui(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ui(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ui(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ui(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function _o(h,n){const o=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of o)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const y of _)n.includes(y)||n.push(y)}}function ui(h,n){const o=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(D=>{const z=D.split(" ");return z[z.length-1]}),_=[...new Set(_)]);const y={},b=[],M=[];if(h=h.replace(o,(D,z)=>(M.push(z),"")),(n=n.replace(o,(D,z)=>(b.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Ni];_o(h,I),_o(n,I);for(const D of[...b,...M])ai[D]||console.error(`Undefined include: ${D}`),Ll[D]||(Ll[D]=[],_o(ai[D],Ll[D])),I=[...I,...Ll[D]];return{fragmentSource:h=h.replace(f,(D,z,k,F,N)=>(y[N]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${k} ${F} ${N};
#else
uniform ${k} ${F} u_${N};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${k} ${F} ${N} = u_${N};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${k} ${F} ${N};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(f,(D,z,k,F,N)=>{const G=F==="float"?"vec2":F,U=N.match(/color/)?"color":G;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${k} ${F} a_${N};
#endif
`:y[N]?z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${G} a_${N};
out ${k} ${F} ${N};
#else
uniform ${k} ${F} u_${N};
#endif
`:z==="initialize"?U==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${k} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${U}(a_${N}, u_${N}_t);
#else
    ${k} ${F} ${N} = u_${N};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${k} ${F} a_${N};
    out ${k} ${F} ${N};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${G} a_${N};
#else
uniform ${k} ${F} u_${N};
#endif
`:z==="define-instanced"?U==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${k} ${F} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${G} a_${N};
#else
uniform ${k} ${F} u_${N};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${k} ${F} ${N} = a_${N};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${F} ${N} = a_${N};
#else
    ${k} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${F} ${N} = unpack_mix_${U}(a_${N}, u_${N}_t);
#else
    ${k} ${F} ${N} = u_${N};
#endif
`}),staticAttributes:_,usedDefines:I,vertexIncludes:b,fragmentIncludes:M}}class Mt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,o,f,_,y,b,M,I){this.context=n;let D=this.boundPaintVertexBuffers.length!==_.length;for(let k=0;!D&&k<_.length;k++)this.boundPaintVertexBuffers[k]!==_[k]&&(D=!0);let z=this.boundDynamicVertexBuffers.length!==M.length;for(let k=0;!z&&k<M.length;k++)this.boundDynamicVertexBuffers[k]!==M[k]&&(z=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==f||D||z||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(o,f,_,y,b,M,I);else{n.bindVertexArrayOES.set(this.vao);for(const k of M)k&&(k.bind(),I&&k.instanceCount&&k.setVertexAttribDivisor(n.gl,o,I));y&&y.dynamicDraw&&y.bind()}}freshBind(n,o,f,_,y,b,M){const I=n.numAttributes,D=this.context,z=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b,o.enableAttributes(z,n),o.bind(),o.setVertexAttribPointers(z,n,y);for(const k of f)k.enableAttributes(z,n),k.bind(),k.setVertexAttribPointers(z,n,y);for(const k of b)k&&(k.enableAttributes(z,n),k.bind(),k.setVertexAttribPointers(z,n,y),M&&k.instanceCount&&k.setVertexAttribDivisor(z,n,M));_&&_.bind(),D.currentNumAttributes=I}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Li(h,n){const o=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new r.O(0,f/o).toLngLat().lat,new r.O(0,(f+1)/o).toLngLat().lat]}function ki(h,n,o,f,_,y,b){const M=h.context,I=M.gl,D=o.hillshadeFBO;if(!D)return;h.prepareDrawTile();const z=h.isTileAffectedByFog(n),k=h.getOrCreateProgram("hillshade",{overrideFog:z});M.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,D.colorAttachment.get());const F=(($,q,Y,re)=>{const ne=Y.paint.get("hillshade-shadow-color"),oe=Y.paint.get("hillshade-highlight-color"),H=Y.paint.get("hillshade-accent-color"),J=Y.paint.get("hillshade-emissive-strength");let he=r.bm(Y.paint.get("hillshade-illumination-direction"));if(Y.paint.get("hillshade-illumination-anchor")==="viewport")he-=$.transform.angle;else if($.style&&$.style.enable3dLights()&&$.style.directionalLight){const ge=$.style.directionalLight.properties.get("direction"),Ae=r.bT(ge.x,ge.y,ge.z);he=r.bm(Ae[1])}const ce=!$.options.moving;return{u_matrix:re||$.transform.calculateProjMatrix(q.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Li(0,q.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),he],u_shadow:ne,u_highlight:oe,u_emissive_strength:J,u_accent:H}})(h,o,f,h.terrain?n.projMatrix:null);h.uploadCommonUniforms(M,k,n.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:G,tileBoundsSegments:U}=h.getTileBoundsBuffers(o);k.draw(h,I.TRIANGLES,_,y,b,Wt.disabled,F,f.id,N,G,U)}function jr(h,n,o){if(!n.needsDEMTextureUpload)return;const f=h.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||h.getTileTexture(o.stride);const y=o.getPixels();n.demTexture?n.demTexture.update(y,{premultiply:!1}):n.demTexture=new r.T(f,y,_.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ba(h,n,o){const f=h.context,_=f.gl;if(!n.dem)return;const y=n.dem;if(f.activeTexture.set(_.TEXTURE1),jr(h,n,y),!n.demTexture)return;n.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const b=y.dim;f.activeTexture.set(_.TEXTURE0);let M=n.hillshadeFBO;if(!M){const F=new r.T(f,{width:b,height:b,data:null},_.RGBA);F.bind(_.LINEAR,_.CLAMP_TO_EDGE),M=n.hillshadeFBO=f.createFramebuffer(b,b,!0,"renderbuffer"),M.colorAttachment.set(F.texture)}f.bindFramebuffer.set(M.framebuffer),f.viewport.set([0,0,b,b]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:D,tileBoundsSegments:z}=h.getMercatorTileBoundsBuffers(),k=[];h.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(h,_.TRIANGLES,Vt.disabled,Xt.disabled,ci.unblended,Wt.disabled,((F,N)=>{const G=N.stride,U=r.a9.create();return r.a9.ortho(U,0,r.Y,-r.Y,0,0,1),r.a9.translate(U,U,[0,-r.Y,0]),{u_matrix:U,u_image:1,u_dimension:[G,G],u_zoom:F.overscaledZ}})(n.tileID,y),o.id,I,D,z),n.needsHillshadePrepare=!1}const Si=h=>({u_matrix:new r.bN(h),u_image0:new r.bR(h),u_skirt_height:new r.bQ(h),u_ground_shadow_factor:new r.bP(h)}),Ol=(h,n,o)=>({u_matrix:h,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:o}),wa=(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:o,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:M,u_frustum_br:I,u_frustum_bl:D,u_globe_pos:z,u_globe_radius:k,u_viewport:F,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:G});function Ta(h,n){return h!=null&&n!=null&&!(!h.hasData()||!n.hasData())&&h.demTexture!=null&&n.demTexture!=null&&h.tileID.key!==n.tileID.key}const Yn=new class{constructor(){this.operations={}}newMorphing(h,n,o,f,_){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==o.tileID.key&&(y.queued=o)}else this.operations[h]={startTime:f,phase:0,duration:_,from:n,to:o,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const n=this.operations[h];return{from:n.from,to:n.to,phase:n.phase}}update(h){for(const n in this.operations){const o=this.operations[n];for(o.phase=(h-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,h)){delete this.operations[n];break}}}_nextOp(h,n){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=n,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Sn={0:null,1:"TERRAIN_VERTEX_MORPHING"};function yp(h,n,o){if(n===0)return 0;const f=n<1&&o===514?.25/n:1;return 6*Math.pow(1.5,22-h)*Math.max(n,1)*f}function Fl(h,n){const o=1<<h.z;return!n&&(h.x===0||h.x===o-1)||h.y===0||h.y===o-1}const Bl=h=>({u_matrix:h});function Go(h,n,o,f,_){if(_>0){const y=r.f.now(),b=(y-h.timeAdded)/_,M=n?(y-n.timeAdded)/_:-1,I=o.getSource(),D=f.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-D)>Math.abs(h.tileID.overscaledZ-D),k=z&&h.refreshedUponExpiration?1:r.ad(z?b:1-M,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),n?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class Zh extends ds{constructor(n){const o={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new r.bZ(r.b_(),null),_=Ih("mock-dem",o,f,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,o){n.state="loaded",o(null)}}class yu extends ds{constructor(n){const o=Ih("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new r.bZ(r.b_(),null),n.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,o,f){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const M=new hs(b,this._source.tileSize*b.overscaleFactor(),n.tileZoom);M.state="loaded",this._tiles[b.key]=M}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(n){const o=this.proxyCachedFBO[n];if(o!==void 0){const f=Object.values(o);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class lr extends r.ap{constructor(n,o,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=o,this.projMatrix=f}}class Ur extends r.cp{constructor(n,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,y]=function(I){const D=new r.aQ,z=new r.az,k=131;D.reserve(17161),z.reserve(33800);const F=r.Y/128,N=r.Y+F/2,G=N+F;for(let $=-F;$<G;$+=F)for(let q=-F;q<G;q+=F){const Y=q<0||q>N||$<0||$>N?24575:0,re=r.ad(Math.round(q),0,r.Y),ne=r.ad(Math.round($),0,r.Y);D.emplaceBack(re+Y,ne)}const U=($,q)=>{const Y=q*k+$;z.emplaceBack(Y+1,Y,Y+k),z.emplaceBack(Y+k,Y+k+1,Y+1)};for(let $=1;$<129;$++)for(let q=1;q<129;q++)U(q,$);return[0,129].forEach($=>{for(let q=0;q<130;q++)U(q,$),U($,q)}),[D,z,32768]}(),b=n.context;this.gridBuffer=b.createVertexBuffer(f,r.aS.members),this.gridIndexBuffer=b.createIndexBuffer(_),this.gridSegments=r.aE.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=r.aE.simpleSegment(0,0,f.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new yu(o.map),this.orthoMatrix=r.a9.create(),r.a9.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.Y,0,r.Y,0,1);const M=b.gl;this._overlapStencilMode=new Xt({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Zh(o.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,o,f){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const _=n.terrain.properties,y=n.terrain.drapeRenderMode===0,b=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.f.now();const M=n.terrain&&n.terrain.scope,I=_.get("source"),D=y?this._mockSourceCache:n.getSourceCache(I,M);if(!D)return void r.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=D,this._exaggeration=b?this.calculateExaggeration(o):_.get("exaggeration"),!o.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(o,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),o.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(n){const o=this._previousCameraAltitude,f=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=f;const _=o!=null?f-o:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const y=n.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(y);let M=y-this._previousZoom;const I=this._previousUpdateTimestamp;let D=y;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(y-D)>.5&&(M=.5*(y-D+M)),M*_<0&&(D+=M)),this._evaluationZoom=D;const z=b.getExaggeration(D),k=z===b.getExaggeration(Math.max(0,D-.1));if(k&&Math.abs(z-this._exaggeration)<.01)return z;let F=Math.min(.1,.00375*(this._updateTimestamp-I));return(k||z<.1||Math.abs(M)<1e-4)&&(F=Math.min(.2,4*F)),r.X(this._exaggeration,z,F)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(r.O.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=o.getIds().map(I=>{const D=o.getTileByID(I).tileID;return D.projMatrix=f.calculateProjMatrix(D.toUnwrapped()),D});(function(I,D){const z=D.transform.pointCoordinate(D.transform.getCameraPoint()),k=new r.P(z.x,z.y);I.sort((F,N)=>{if(N.overscaledZ-F.overscaledZ)return N.overscaledZ-F.overscaledZ;const G=new r.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),U=new r.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),$=k.mult(1<<F.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(G)-$.distSqr(U)})})(_,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const I in b){const D=b[I];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,n[I],y),D.usedForTerrain))continue;const z=n[I];D.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[o.id]=_.map(I=>new lr(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const D=this.terrainTileForTile[I.key];if(!D)continue;const z=D.tileID.key;z in M||(this._visibleDemTiles.push(D),M[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach(o=>{if(this.terrainTileForTile[o.key])return;const f=this._findTileCoveringTileID(o,this.sourceCache);f&&(this.terrainTileForTile[o.key]=f)})}_prepareDEMTextures(){const n=this.painter.context,o=n.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(o.TEXTURE1),jr(this.painter,_,y))}}_prepareDemTileUniforms(n,o,f,_){if(!o||o.demTexture==null)return!1;const y=n.tileID.canonical,b=Math.pow(2,o.tileID.canonical.z-y.z),M=_||"";return f[`u_dem_tl${M}`]=[y.x*b%1,y.y*b%1],f[`u_dem_scale${M}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,o=n.gl;if(!this._emptyDepthBufferTexture){const f=new r.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(n,f,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const o=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const y=_.dem.tree.minimums[0];return y>0&&n++,f+y},0);return n?o/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,o=n.gl;n.activeTexture.set(o.TEXTURE2);const f=this._getLoadedAreaMinimum(),[_,y]=(()=>{const M=new r.cr({width:1,height:1},new Float32Array([f]));return[o.R32F,M]})();this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(n,y,_,{premultiply:!1}),b}setupElevationDraw(n,o,f){const _=this.painter.context,y=_.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};b.u_exaggeration=this.exaggeration();let M=null,I=null,D=1;if(f&&f.morphing&&this._useVertexMorphing){const F=f.morphing.srcDemTile,N=f.morphing.dstDemTile;D=f.morphing.phase,F&&N&&(this._prepareDemTileUniforms(n,F,b,"_prev")&&(I=F),this._prepareDemTileUniforms(n,N,b)&&(M=N))}const z=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,k=F=>{b.u_dem_size=F.size[0]===1?1:F.size[0]-2};if(I&&M)_.activeTexture.set(y.TEXTURE2),M.demTexture.bind(z(M),y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE4),I.demTexture.bind(z(I),y.CLAMP_TO_EDGE),M.demTexture&&k(M.demTexture),b.u_dem_lerp=D;else{M=this.terrainTileForTile[n.tileID.key],_.activeTexture.set(y.TEXTURE2);const F=this._prepareDemTileUniforms(n,M,b)?M.demTexture:this.emptyDEMTexture;F.bind(z(M),y.CLAMP_TO_EDGE),k(F)}if(_.activeTexture.set(y.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&M){const F=(1<<M.tileID.canonical.z)*r.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=F}if(f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),o.setTerrainUniformValues(_,b),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);o.setGlobeUniformValues(_,F)}}globeUniformValues(n,o,f){const _=n.projection;return{u_tile_tl_up:_.upVector(o,0,0),u_tile_tr_up:_.upVector(o,r.Y,0),u_tile_br_up:_.upVector(o,r.Y,r.Y),u_tile_bl_up:_.upVector(o,0,r.Y),u_tile_up_scale:f?r.cq(1):_.upVectorScale(o,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const o=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,y,b,M,I){if(_.transform.projection.name==="globe")(function(D,z,k,F,N){const G=D.context,U=G.gl;let $,q;const Y=D.transform,re=r.ci(D,G,Y),ne=(Te,Pe)=>{if(q===Pe)return;const me=[Sn[Pe],"PROJECTION_GLOBE_VIEW"];re&&me.push("CUSTOM_ANTIALIASING");const be=D.isTileAffectedByFog(Te);$=D.getOrCreateProgram("globeRaster",{defines:me,overrideFog:be}),q=Pe},oe=D.colorModeForRenderPass(),H=new Vt(U.LEQUAL,Vt.ReadWrite,D.depthRangeFor3D);Yn.update(N);const J=r.cj(Y),he=[r.a8(Y.center.lng),r.ah(Y.center.lat)],ce=D.globeSharedBuffers,ge=[Y.width*r.f.devicePixelRatio,Y.height*r.f.devicePixelRatio],Ae=Float32Array.from(Y.globeMatrix),_e={useDenormalizedUpVectorScale:!0};{const Te=D.transform,Pe=yp(Te.zoom,z.exaggeration(),z.sourceCache._source.tileSize);q=-1;const me=U.TRIANGLES;for(const be of F){const Ze=k.getTile(be),ye=Xt.disabled,Se=z.prevTerrainTileForTile[be.key],Ie=z.terrainTileForTile[be.key];Ta(Se,Ie)&&Yn.newMorphing(be.key,Se,Ie,N,250),G.activeTexture.set(U.TEXTURE0),Ze.texture&&Ze.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const se=Yn.getMorphValuesForProxy(be.key),je=se?1:0;se&&r.k(_e,{morphing:{srcDemTile:se.from,dstDemTile:se.to,phase:r.ch(se.phase)}});const vt=r.ck(be.canonical),At=r.cl(vt.getCenter().lat),Ot=r.cm(be.canonical,vt,At,Te.worldSize/Te._pixelsPerMercatorPixel),Pt=r.aW(r.cn(be.canonical)),Bt=wa(Te.expandedFarZProjMatrix,Ae,J,Pt,r.W(Te.zoom),he,Te.frustumCorners.TL,Te.frustumCorners.TR,Te.frustumCorners.BR,Te.frustumCorners.BL,Te.globeCenterInViewSpace,Te.globeRadius,ge,Pe,Te._farZ,Ot);if(ne(be,je),$&&(z.setupElevationDraw(Ze,$,_e),D.uploadCommonUniforms(G,$,be.toUnwrapped()),ce)){const[_i,Zt,xi]=ce.getGridBuffers(At,Pe!==0);$.draw(D,me,H,ye,oe,Wt.backCCW,Bt,"globe_raster",_i,Zt,xi)}}}if(ce&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const Te=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Te.push("CUSTOM_ANTIALIASING"),$=D.getOrCreateProgram("globeRaster",{defines:Te});for(const Pe of F){const{x:me,y:be,z:Ze}=Pe.canonical,ye=be===0,Se=be===(1<<Ze)-1,[Ie,se,je,vt]=ce.getPoleBuffers(Ze,!1);if(vt&&(ye||Se)){const At=k.getTile(Pe);G.activeTexture.set(U.TEXTURE0),At.texture&&At.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let Ot=r.co(Ze,me,Y);const Pt=r.aW(r.cn(Pe.canonical)),Bt=(_i,Zt)=>_i.draw(D,U.TRIANGLES,H,Xt.disabled,oe,Wt.disabled,wa(Y.expandedFarZProjMatrix,Ot,Ot,Pt,0,he,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,ge,0,Y._farZ),"globe_pole_raster",Zt,je,vt);z.setupElevationDraw(At,$,_e),D.uploadCommonUniforms(G,$,Pe.toUnwrapped()),ye&&D.renderDefaultNorthPole&&Bt($,Ie),Se&&D.renderDefaultSouthPole&&(Ot=r.a9.scale(r.a9.create(),Ot,[1,-1,1]),Bt($,se))}}}})(_,y,b,M,I);else{const D=_.context,z=D.gl;let k,F;const N=_.shadowRenderer,G=po(_,_.longestCutoffRange),U=oe=>{if(F===oe)return;const H=[];H.push(Sn[oe]),G.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),k=_.getOrCreateProgram("terrainRaster",{defines:H}),F=oe},$=_.colorModeForRenderPass(),q=new Vt(z.LEQUAL,Vt.ReadWrite,_.depthRangeFor3D);Yn.update(I);const Y=_.transform,re=yp(Y.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let ne=[0,0,0];if(N){const oe=_.style.directionalLight,H=_.style.ambientLight;oe&&H&&(ne=Gh(oe,H))}{F=-1;const oe=z.TRIANGLES,[H,J]=[y.gridIndexBuffer,y.gridSegments];for(const he of M){const ce=b.getTile(he),ge=Xt.disabled,Ae=y.prevTerrainTileForTile[he.key],_e=y.terrainTileForTile[he.key];Ta(Ae,_e)&&Yn.newMorphing(he.key,Ae,_e,I,250),D.activeTexture.set(z.TEXTURE0),ce.texture&&ce.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Te=Yn.getMorphValuesForProxy(he.key),Pe=Te?1:0;let me;Te&&(me={morphing:{srcDemTile:Te.from,dstDemTile:Te.to,phase:r.ch(Te.phase)}});const be=Ol(he.projMatrix,Fl(he.canonical,Y.renderWorldCopies)?re/10:re,ne);if(U(Pe),!k)continue;y.setupElevationDraw(ce,k,me);const Ze=he.toUnwrapped();N&&N.setupShadows(Ze,k),_.uploadCommonUniforms(D,k,Ze,null,G),k.draw(_,oe,q,ge,$,Wt.backCCW,be,"terrain_raster",y.gridBuffer,H,J)}}}}(o,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const o=this.painter,f=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],b=this._drapedRenderBatches.shift(),M=o.style.order,I=[];let D=0;for(const z of y){const k=_.getTileByID(z.proxyTileKey),F=_.proxyCachedFBO[z.key]?_.proxyCachedFBO[z.key][n]:void 0,N=F!==void 0?_.renderCache[F]:this.pool[D++],G=F!==void 0;if(k.texture=N.tex,G&&!N.dirty){I.push(k.tileID);continue}let U;f.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(f.clear({color:r.aA.transparent,stencil:0}),N.dirty=!1);for(let $=b.start;$<=b.end;++$){const q=o.style._mergedLayers[M[$]];if(q.isHidden(o.transform.zoom))continue;const Y=o.style.getLayerSourceCache(q),re=Y?this.proxyToSource[z.key][Y.id]:[z];if(!re)continue;const ne=re;f.viewport.set([0,0,N.fb.width,N.fb.height]),U!==(Y?Y.id:null)&&(this._setupStencil(N,re,q,Y),U=Y?Y.id:null),o.renderLayer(o,Y,q,ne)}if(this._drapedRenderBatches.length===0)for(const $ of this._pendingGroundEffectLayers){const q=o.style._mergedLayers[M[$]];if(q.isHidden(o.transform.zoom))continue;const Y=o.style.getLayerSourceCache(q),re=Y?this.proxyToSource[z.key][Y.id]:[z];if(!re)continue;const ne=re;f.viewport.set([0,0,N.fb.width,N.fb.height]),U!==(Y?Y.id:null)&&(this._setupStencil(N,re,q,Y),U=Y?Y.id:null),o.renderLayer(o,Y,q,ne)}this.renderedToTile?(N.dirty=!0,I.push(k.tileID)):G||--D,D===5&&(D=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),b.end+1}postRender(){}isLayerOrderingCorrect(n){const o=n.order.length;let f=-1,_=o;for(let y=0;y<o;++y)this._style.isLayerDraped(n._mergedLayers[n.order[y]])?f=Math.max(f,y):_=Math.min(_,y);return _>f}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{n=Math.min(n,o.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,o,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,M=1<<b.overscaledZ,{x:I,y:D}=b.canonical,z=I/M,k=(I+1)/M,F=D/M,N=(D+1)/M;return{minx:z,miny:F,maxx:k,maxy:N,t:y.dem.tree.raycastRoot(z,F,k,N,n,o,f),tile:y}});_.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,n,o,f);if(b!=null)return b}return null}_createFBO(){const n=this.painter.context,o=n.gl,f=this.drapeBufferSize;n.activeTexture.set(o.TEXTURE0);const _=new r.T(n,{width:f[0],height:f[1],data:null},o.RGBA);_.bind(o.LINEAR,o.CLAMP_TO_EDGE);const y=n.createFramebuffer(f[0],f[1],!0,null);return y.colorAttachment.set(_.texture),y.depthAttachment=new ug(n,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const o=this._style._mergedLayers[n],f=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!f&&o.shouldRedrape():!f&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style.getSources())if(f instanceof pt){n=!0;break}if(!n)return;const o={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(y&&!o[y.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof r.Z){o[y.id]=!0;for(const b of this.proxyCoords){const M=this.proxyToSource[b.key][y.id];if(M)for(const I of M)this._clearRenderCacheForTile(y.id,I)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof mt){n=!0;break}if(!n)return;const o={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(!y||o[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const b=_.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const I=this.proxyToSource[M.key][y.id];if(I)for(const D of I){const z=Go(y.getTile(D),y.findLoadedParent(D,0),y,this.painter.transform,b);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(y.id,D)}}}}_setupDrapedRenderBatches(){const n=this._style.order,o=n.length;if(o===0)return;const f=[];this._pendingGroundEffectLayers=[];let _,y=0,b=this._style._mergedLayers[n[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<o;)b=this._style._mergedLayers[n[y]];for(;y<o;++y){const M=this._style._mergedLayers[n[y]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?_===void 0&&(_=y):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(f.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:y-1}),f.length!==0){const M=f[f.length-1];this._pendingGroundEffectLayers.every(I=>I>M.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(n){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const b=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let M=0;M<b.length;++M){const I=Object.values(b[M]);o.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let b=f.length-1;b>=0;b--){const M=f[b];if(o.getTileByID(M.key),o.proxyCachedFBO[M.key]!==void 0){const I=n[M.key],D=this.proxyToSource[M.key];let z=0;for(const k in D){const F=D[k],N=I[k];if(!N||N.length!==F.length||F.some((G,U)=>G!==N[U]||_[k]&&_[k].hasOwnProperty(G.key))){z=-1;break}++z}for(const k in o.proxyCachedFBO[M.key])o.renderCache[o.proxyCachedFBO[M.key][k]].dirty=z<0||z!==Object.values(I).length}}const y=[...this._drapedRenderBatches];y.sort((b,M)=>M.end-M.start-(b.end-b.start));for(const b of y)for(const M of f){if(o.proxyCachedFBO[M.key])continue;let I=o.renderCachePool.pop();I===void 0&&o.renderCache.length<50&&(I=o.renderCache.length,o.renderCache.push(this._createFBO())),I!==void 0&&(o.proxyCachedFBO[M.key]={},o.proxyCachedFBO[M.key][b.start]=I,o.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,o,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let M;if(f.isTileClipped())M=o.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Xt.disabled}_renderTileClippingMasks(n,o){const f=this.painter,_=this.painter.context,y=_.gl;f._tileClippingMaskIDs={},_.setColorMode(ci.disabled),_.setDepthMode(Vt.disabled);const b=f.getOrCreateProgram("clippingMask");for(const M of n){const I=f._tileClippingMaskIDs[M.key]=--o;b.draw(f,y.TRIANGLES,Vt.disabled,new Xt({func:y.ALWAYS,mask:0},I,255,y.KEEP,y.KEEP,y.REPLACE),ci.disabled,Wt.disabled,Bl(M.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const o=this.painter.transform;if(n.x<0||n.x>o.width||n.y<0||n.y>o.height)return null;const f=[n.x,n.y,1,1];r.aa.transformMat4(f,f,o.pixelMatrixInverse),r.aa.scale(f,f,1/f[3]),f[0]/=o.worldSize,f[1]/=o.worldSize;const _=o._camera.position,y=r.bo(1,o.center.lat),b=[_[0],_[1],_[2]/y,0],M=r.Q.subtract([],f.slice(0,3),b);r.Q.normalize(M,M);const I=this.raycast(b,M,this._exaggeration);return I!==null&&I?(r.Q.scaleAndAdd(b,b,M,I),b[3]=b[2],b[2]*=y,b):null}drawDepth(){const n=this.painter,o=n.context,f=this.proxySourceCache,_=Math.ceil(n.width),y=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const b=o.gl,M=o.createFramebuffer(_,y,!0,"renderbuffer");o.activeTexture.set(b.TEXTURE0);const I=new r.T(o,{width:_,height:y,data:null},b.RGBA);I.bind(b.NEAREST,b.CLAMP_TO_EDGE),M.colorAttachment.set(I.texture);const D=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,_,y);M.depthAttachment.set(D),this._depthFBO=M,this._depthTexture=I}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,_,y]),function(b,M,I,D){if(b.transform.projection.name==="globe")return;const z=b.context,k=z.gl;z.clear({depth:1});const F=b.getOrCreateProgram("terrainDepth"),N=new Vt(k.LESS,Vt.ReadWrite,b.depthRangeFor3D);for(const G of D){const U=I.getTile(G),$=Ol(G.projMatrix,0,[0,0,0]);M.setupElevationDraw(U,F),F.draw(b,k.TRIANGLES,N,Xt.disabled,ci.unblended,Wt.backCCW,$,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(n,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,o,f){if(n.getSource()instanceof r.as)return this._setupProxiedCoordsForImageSource(n,o,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],y=this.proxyCoords;for(let I=0;I<y.length;I++){const D=y[I],z=this._findTileCoveringTileID(D,n);if(z){const k=this._createProxiedId(D,z,f[D.key]&&f[D.key][n.id]);_.push(k),this.proxyToSource[D.key][n.id]=[k]}}let b=!1;const M=new Set;for(let I=0;I<o.length;I++){const D=n.getTile(o[I]);if(!D||!D.hasData())continue;const z=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==D.tileID.canonical.z){const k=this.proxyToSource[z.tileID.key][n.id],F=this._createProxiedId(z.tileID,D,f[z.tileID.key]&&f[z.tileID.key][n.id]);k?k.splice(k.length-1,0,F):this.proxyToSource[z.tileID.key][n.id]=[F];const N=this.proxyToSource[z.tileID.key][n.id];M.has(N)||M.add(N),_.push(F),b=!0}}if(this._sourceTilesOverlap[n.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const I of M)I.sort((D,z)=>z.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(n,o,f){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],y=this.proxyCoords,b=n.getSource(),M=b.tileID;if(!M)return;const I=new r.P(M.x,M.y)._div(1<<M.z),D=b.coordinates.map(r.O.fromLngLat).reduce((k,F)=>(k.min.x=Math.min(k.min.x,F.x-I.x),k.min.y=Math.min(k.min.y,F.y-I.y),k.max.x=Math.max(k.max.x,F.x-I.x),k.max.y=Math.max(k.max.y,F.y-I.y),k),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(k,F)=>{const N=k.wrap+k.canonical.x/(1<<k.canonical.z),G=k.canonical.y/(1<<k.canonical.z),U=r.Y/(1<<k.canonical.z),$=F.wrap+F.canonical.x/(1<<F.canonical.z),q=F.canonical.y/(1<<F.canonical.z);return N+U<$+D.min.x||N>$+D.max.x||G+U<q+D.min.y||G>q+D.max.y};for(let k=0;k<y.length;k++){const F=y[k];for(let N=0;N<o.length;N++){const G=n.getTile(o[N]);if(!G||!G.hasData()||z(F,G.tileID))continue;const U=this._createProxiedId(F,G,f[F.key]&&f[F.key][n.id]),$=this.proxyToSource[F.key][n.id];$?$.push(U):this.proxyToSource[F.key][n.id]=[U],_.push(U)}}}_createProxiedId(n,o,f){let _=this.orthoMatrix;if(f){const y=f.find(b=>b.key===o.tileID.key);if(y)return y}if(o.tileID.key!==n.key){const y=n.canonical.z-o.tileID.canonical.z;let b,M,I;_=r.a9.create();const D=o.tileID.wrap-n.wrap<<n.overscaledZ;y>0?(b=r.Y>>y,M=b*((o.tileID.canonical.x<<y)-n.canonical.x+D),I=b*((o.tileID.canonical.y<<y)-n.canonical.y)):(b=r.Y<<-y,M=r.Y*(o.tileID.canonical.x-(n.canonical.x+D<<-y)),I=r.Y*(o.tileID.canonical.y-(n.canonical.y<<-y))),r.a9.ortho(_,0,b,0,b,0,1),r.a9.translate(_,_,[M,I,0])}return new lr(o.tileID,n.key,_)}_findTileCoveringTileID(n,o){let f=o.getTile(n);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[o.id],y=_[n.key];if(f=y?o.getTileByID(y):null,f&&f.hasData()||y===null)return f;let b=f?f.tileID:n,M=b.overscaledZ;const I=o.getSource().minzoom,D=[];if(!y){const k=o.getSource().maxzoom;if(n.canonical.z>=k){const F=n.canonical.z-k;o.getSource().reparseOverscaled?(M=Math.max(n.canonical.z+2,o.transform.tileZoom),b=new r.ap(M,n.wrap,k,n.canonical.x>>F,n.canonical.y>>F)):F!==0&&(M=k,b=new r.ap(M,n.wrap,k,n.canonical.x>>F,n.canonical.y>>F))}b.key!==n.key&&(D.push(b.key),f=o.getTile(b))}const z=k=>{D.forEach(F=>{_[F]=k}),D.length=0};for(M-=1;M>=I&&(!f||!f.hasData());M--){f&&z(f.tileID.key);const k=b.calculateScaledKey(M);if(f=o.getTileByID(k),f&&f.hasData())break;const F=_[k];if(F===null)break;F===void 0?D.push(k):f=o.getTileByID(F)}return z(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,o){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[o.key]=!0}}function xp(h,n,o){const f=function(M,I,D){const z=r.Q.dot(I,M),k=r.Q.dot(D,[.2126,.7152,.0722]),F=(G,U,$)=>(1-$)*G+$*U,N=F(1-.3*Math.min(k,1),1,Math.min(z+1,1));return F(.92,1,Math.asin(r.ad(I[2],-1,1))/Math.PI+.5)*N}(h,[0,0,1],n),_=[0,0,0];r.Q.scale(_,o.slice(0,3),f);const y=[0,0,0];r.Q.scale(y,n.slice(0,3),h[2]);const b=[0,0,0];return r.Q.add(b,_,y),r.bX(b)}const Ma=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ln=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Xr{static cacheKey(n,o,f,_){let y=`${o}${_?_.cacheKey:""}`;for(const b of f)n.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(n,o,f,_,y,b){const M=n.gl;this.program=M.createProgram(),this.configuration=_,this.name=o,this.fixedDefines=[...b];const I=_?_.getBinderAttributes():[],D=(f.staticAttributes||[]).concat(I);let z=_?_.defines():[];z=z.concat(b.map($=>`#define ${$}`));const k=`#version 300 es
`;let F=k+z.concat("precision mediump float;",gu,kl.fragmentSource).join(`
`);for(const $ of f.fragmentIncludes)F+=`
${ai[$]}`;F+=`
${f.fragmentSource}`;let N=k+z.concat("precision highp float;",gu,kl.vertexSource).join(`
`);for(const $ of f.vertexIncludes)N+=`
${ai[$]}`;N+=`
${f.vertexSource}`;const G=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(G,F),M.compileShader(G),M.attachShader(this.program,G);const U=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(U,N),M.compileShader(U),M.attachShader(this.program,U),this.attributes={},this.numAttributes=D.length;for(let $=0;$<this.numAttributes;$++)if(D[$]){const q=D[$].startsWith("a_")?D[$]:`a_${D[$]}`;M.bindAttribLocation(this.program,$,q),this.attributes[q]=$}M.linkProgram(this.program),M.deleteShader(U),M.deleteShader(G),this.fixedUniforms=y(n),this.binderUniforms=_?_.getUniforms(n):[],b.includes("TERRAIN")&&(this.terrainUniforms=($=>({u_dem:new r.bR($),u_dem_prev:new r.bR($),u_dem_tl:new r.bO($),u_dem_scale:new r.bQ($),u_dem_tl_prev:new r.bO($),u_dem_scale_prev:new r.bQ($),u_dem_size:new r.bQ($),u_dem_lerp:new r.bQ($),u_exaggeration:new r.bQ($),u_depth:new r.bR($),u_depth_size_inv:new r.bO($),u_meter_to_dem:new r.bQ($),u_label_plane_matrix_inv:new r.bN($)}))(n)),b.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new r.bP($),u_tile_tr_up:new r.bP($),u_tile_br_up:new r.bP($),u_tile_bl_up:new r.bP($),u_tile_up_scale:new r.bQ($)}))(n)),b.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new r.bN($),u_fog_range:new r.bO($),u_fog_color:new r.bS($),u_fog_horizon_blend:new r.bQ($),u_fog_vertical_limit:new r.bO($),u_fog_temporal_offset:new r.bQ($),u_frustum_tl:new r.bP($),u_frustum_tr:new r.bP($),u_frustum_br:new r.bP($),u_frustum_bl:new r.bP($),u_globe_pos:new r.bP($),u_globe_radius:new r.bQ($),u_globe_transition:new r.bQ($),u_is_globe:new r.bR($),u_viewport:new r.bO($)}))(n)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new r.bS($)}))(n)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new r.bP($),u_lighting_directional_dir:new r.bP($),u_lighting_directional_color:new r.bP($),u_ground_radiance:new r.bP($)}))(n)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new r.bN($),u_light_matrix_1:new r.bN($),u_fade_range:new r.bO($),u_shadow_normal_offset:new r.bP($),u_shadow_intensity:new r.bQ($),u_shadow_texel_size:new r.bQ($),u_shadow_map_resolution:new r.bQ($),u_shadow_direction:new r.bP($),u_shadow_bias:new r.bP($),u_shadowmap_0:new r.bR($),u_shadowmap_1:new r.bR($)}))(n))}}setTerrainUniformValues(n,o){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_]&&f[_].set(this.program,_,o[_])}}setGlobeUniformValues(n,o){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_]&&f[_].set(this.program,_,o[_])}}setFogUniformValues(n,o){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setCutoffUniformValues(n,o){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setLightsUniformValues(n,o){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setShadowUniformValues(n,o){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}_drawDebugWireframe(n,o,f,_,y,b,M,I,D,z){const k=n.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const F=n.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||n._terrain&&n._terrain.renderingToTexture||!Ma.includes(this.name))||!(!k.layers3D||!Ln.includes(this.name))))return;const N=F.gl,G=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,y,F);if(!G)return;const U=[...this.fixedDefines];U.push("DEBUG_WIREFRAME");const $=n.getOrCreateProgram(this.name,{config:this.configuration,defines:U});F.program.set($.program);const q=(ne,oe,H)=>{if(oe[ne]&&H[ne])for(const J in oe[ne])H[ne][J]&&H[ne][J].set(H.program,J,oe[ne][J].current)};D&&D.setUniforms($.program,F,$.binderUniforms,M,{zoom:I}),q("fixedUniforms",this,$),q("terrainUniforms",this,$),q("globeUniforms",this,$),q("fogUniforms",this,$),q("lightsUniforms",this,$),q("shadowUniforms",this,$),G.bind(),F.setColorMode(new ci([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],r.aA.transparent,[!0,!0,!0,!1])),F.setDepthMode(new Vt(o.func===N.LESS?N.LEQUAL:o.func,Vt.ReadOnly,o.range)),F.setStencilMode(Xt.disabled);const Y=3*b.primitiveLength*2,re=3*b.primitiveOffset*2*2;z&&z>1?N.drawElementsInstanced(N.LINES,Y,N.UNSIGNED_SHORT,re,z):N.drawElements(N.LINES,Y,N.UNSIGNED_SHORT,re),y.bind(),F.program.set(this.program),F.setDepthMode(o),F.setStencilMode(f),F.setColorMode(_)}draw(n,o,f,_,y,b,M,I,D,z,k,F,N,G,U,$){const q=n.context,Y=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(f),q.setStencilMode(_),q.setColorMode(y),q.setCullFace(b);for(const oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(this.program,oe,M[oe]);G&&G.setUniforms(this.program,q,this.binderUniforms,F,{zoom:N});const re={[Y.POINTS]:1,[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[o],ne=$&&$>0?1:void 0;for(const oe of k.get()){const H=oe.vaos||(oe.vaos={});(H[I]||(H[I]=new Mt)).bind(q,this,D,G?G.getPaintVertexBuffers():[],z,oe.vertexOffset,U||[],ne),$&&$>1?Y.drawElementsInstanced(o,oe.primitiveLength*re,Y.UNSIGNED_SHORT,oe.primitiveOffset*re*2,$):z?Y.drawElements(o,oe.primitiveLength*re,Y.UNSIGNED_SHORT,oe.primitiveOffset*re*2):Y.drawArrays(o,oe.vertexOffset,oe.vertexLength),o===Y.TRIANGLES&&z&&this._drawDebugWireframe(n,f,_,y,z,oe,F,N,G,$)}}}function Ps(h,n){const o=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,h.transform.tileZoom)/o,_=f*(n.tileID.canonical.x+n.tileID.wrap*o),y=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.a6(n,1,h.transform.tileZoom),u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y]}}const $n=r.a9.create(),xu=(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U)=>{const $=n.style.light,q=$.properties.get("position"),Y=[q.x,q.y,q.z],re=r.ct.create();$.properties.get("anchor")==="viewport"&&(r.ct.fromRotation(re,-n.transform.angle),r.Q.transformMat3(Y,Y,re));const ne=$.properties.get("color"),oe=n.transform,H={u_matrix:h,u_lightpos:Y,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+o,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$n,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:y,u_flood_light_color:k,u_vertical_scale:F,u_flood_light_intensity:N,u_ground_shadow_factor:G,u_emissive_strength:U};return oe.projection.name==="globe"&&(H.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],H.u_zoom_transition=I,H.u_inv_rot_matrix=z,H.u_merc_center=D,H.u_up_dir=oe.projection.upVector(new r.bv(0,0,0),D[0]*r.Y,D[1]*r.Y),H.u_height_lift=M),H},gs=(h,n,o)=>({u_matrix:h,u_edge_radius:n,u_vertical_scale:o}),Nl=(h,n,o,f,_,y,b,M,I,D,z,k,F,N)=>{const G=xu(h,n,o,f,_,y,b,I,D,z,k,F,N,1,[0,0,0],0),U={u_height_factor:-Math.pow(2,b.overscaledZ)/M.tileSize/8};return r.e(G,Ps(n,M),U)},Sa=(h,n)=>({u_matrix:h,u_emissive_strength:n}),go=(h,n,o,f)=>r.e(Sa(h,n),Ps(o,f)),mg=(h,n,o)=>({u_matrix:h,u_world:o,u_emissive_strength:n}),Hs=(h,n,o,f,_)=>r.e(go(h,n,o,f),{u_world:_}),_g=(h,n,o,f)=>{const _=r.Y/o.tileSize;return{u_matrix:h,u_camera_to_center_distance:n.getCameraToCenterDistance(f),u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},Qh=(h,n,o=1)=>({u_matrix:h,u_color:n,u_overlay:0,u_overlay_scale:o}),Rr=r.a9.create(),gg=(h,n,o,f,_,y,b)=>{const M=h.transform,I=M.projection.name==="globe",D=I?r.cu(M.zoom,n.canonical)*M._pixelsPerMercatorPixel:r.a6(o,1,y),z={u_matrix:n.projMatrix,u_extrude_scale:D,u_intensity:b,u_inv_rot_matrix:Rr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){z.u_inv_rot_matrix=f,z.u_merc_center=_,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=r.W(M.zoom);const k=_[0]*r.Y,F=_[1]*r.Y;z.u_up_dir=M.projection.upVector(new r.bv(0,0,0),k,F)}return z};function Vl(h,[n,o,f,_],[y,b]){if(y===b)return[0,0,0,0];const M=255*(h-1)/(h*(b-y));return[n*M,o*M,f*M,_*M]}function Xh(h,n,[o,f]){return o===f?0:.5/h+(n-o)*(h-1)/(h*(f-o))}const vp=(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U,$,q,Y,re,ne)=>({u_matrix:h,u_normalize_matrix:n,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:D,u_fade_t:z.mix,u_opacity:z.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:r.cv(k.paint.get("raster-saturation")),u_contrast_factor:r.cw(k.paint.get("raster-contrast")),u_spin_weights:yg(k.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:N,u_zoom_transition:b,u_merc_center:M,u_cutoff_params:I,u_colorization_mix:Vl(r.cx,U,q),u_colorization_offset:Xh(r.cx,$,q),u_color_ramp:G,u_texture_offset:[re/(Y+2*re),Y/(Y+2*re)],u_texture_res:[Y+2*re,Y+2*re],u_emissive_strength:ne});function yg(h){h*=Math.PI/180;const n=Math.sin(h),o=Math.cos(h);return[(2*o+1)/3,(-Math.sqrt(3)*n-o+1)/3,(Math.sqrt(3)*n-o+1)/3]}const jl=(h,n,o,f,_,y,b,M,I,D,z,k)=>({u_matrix:h,u_normalize_matrix:n,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:D,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:b,u_merc_center:M,u_cutoff_params:I}),Ul=(h,n,o,f,_,y,b,M,I,D)=>({u_particle_texture:h,u_particle_texture_side_len:n,u_tile_offset:o,u_velocity:f,u_color_ramp:y,u_velocity_res:_,u_max_speed:b,u_uv_offset:M,u_data_scale:I,u_data_offset:D,u_particle_pos_scale:1.3,u_particle_pos_offset:[Fo,Fo]}),xg=(h,n,o,f,_,y,b,M,I,D)=>({u_particle_texture:h,u_particle_texture_side_len:n,u_velocity:o,u_velocity_res:f,u_max_speed:_,u_speed_factor:y,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:I,u_data_offset:D,u_particle_pos_scale:1.3,u_particle_pos_offset:[Fo,Fo]}),$o=r.a9.create(),Yh=(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U,$,q)=>{const Y=_.transform,re={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Y.getCameraToCenterDistance(U),u_rotate_symbol:+o,u_aspect_ratio:Y.width/Y.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:M,u_is_text:+I,u_pitch_with_map:+f,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$o,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$o,u_up_vector:[0,-1,0],u_color_adj_mat:$,u_icon_transition:q||0};return U.name==="globe"&&(re.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],re.u_zoom_transition=k,re.u_inv_rot_matrix=N,re.u_merc_center=F,re.u_camera_forward=Y._camera.forward(),re.u_ecef_origin=r.cy(Y.globeMatrix,z.toUnwrapped()),re.u_tile_matrix=Float32Array.from(Y.globeMatrix),re.u_up_vector=G),re},Ea=(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U,$)=>r.e(Yh(h,n,o,f,_,y,b,M,I,D,k,F,N,G,U,$),{u_gamma_scale:f?_.transform.getCameraToCenterDistance($)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:r.f.devicePixelRatio,u_is_halo:+z,undefined:void 0}),yo=(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U)=>r.e(Ea(h,n,o,f,_,y,b,M,!0,I,!0,z,k,F,N,G,U),{u_texsize_icon:D,u_texture_icon:1}),vg=(h,n,o,f)=>({u_matrix:h,u_emissive_strength:n,u_opacity:o,u_color:f}),bg=(h,n,o,f,_,y,b)=>r.e(function(M,I,D,z){const k=D.imageManager.getPattern(M.toString(),I),{width:F,height:N}=D.imageManager.getPixelSize(I),G=Math.pow(2,z.tileID.overscaledZ),U=z.tileSize*Math.pow(2,D.transform.tileZoom)/G,$=U*(z.tileID.canonical.x+z.tileID.wrap*G),q=U*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[F,N],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/r.a6(z,1,D.transform.tileZoom),u_pixel_coord_upper:[$>>16,q>>16],u_pixel_coord_lower:[65535&$,65535&q]}}(_,y,f,b),{u_matrix:h,u_emissive_strength:n,u_opacity:o}),Kh=new Float32Array(r.a9.identity([])),vu=(h,n,o,f,_,y,b,M,I,D,z,k,F,N=[0,0,0],G)=>{const U=_.style.light,$=U.properties.get("position"),q=[-$.x,-$.y,$.z],Y=r.ct.create();U.properties.get("anchor")==="viewport"&&(r.ct.fromRotation(Y,-_.transform.angle),r.Q.transformMat3(q,q,Y));const re=z.alphaMode==="MASK",ne=U.properties.get("color"),oe=F.paint.get("model-ambient-occlusion-intensity"),H=F.paint.get("model-color").constantOr(r.aA.white),J=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:n,u_normal_matrix:o,u_node_matrix:f||Kh,u_lightpos:q,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:N,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:I,u_roughnessFactor:D,u_baseColorTexture:Pr.BaseColor,u_metallicRoughnessTexture:Pr.MetallicRoughness,u_normalTexture:Pr.Normal,u_occlusionTexture:Pr.Occlusion,u_emissionTexture:Pr.Emission,u_color_mix:[H.r,H.g,H.b,J],u_aoIntensity:oe,u_emissive_strength:k,u_occlusionTextureTransform:G||[0,0,0,0]}},bp=(h,n=Kh,o=Kh)=>({u_matrix:h,u_instance:n,u_node_matrix:o}),Jh={fillExtrusion:h=>({u_matrix:new r.bN(h),u_lightpos:new r.bP(h),u_lightintensity:new r.bQ(h),u_lightcolor:new r.bP(h),u_vertical_gradient:new r.bQ(h),u_opacity:new r.bQ(h),u_edge_radius:new r.bQ(h),u_ao:new r.bO(h),u_tile_id:new r.bP(h),u_zoom_transition:new r.bQ(h),u_inv_rot_matrix:new r.bN(h),u_merc_center:new r.bO(h),u_up_dir:new r.bP(h),u_height_lift:new r.bQ(h),u_flood_light_color:new r.bP(h),u_vertical_scale:new r.bQ(h),u_flood_light_intensity:new r.bQ(h),u_ground_shadow_factor:new r.bP(h),u_emissive_strength:new r.bQ(h)}),fillExtrusionDepth:h=>({u_matrix:new r.bN(h),u_edge_radius:new r.bQ(h),u_vertical_scale:new r.bQ(h)}),fillExtrusionPattern:h=>({u_matrix:new r.bN(h),u_lightpos:new r.bP(h),u_lightintensity:new r.bQ(h),u_lightcolor:new r.bP(h),u_vertical_gradient:new r.bQ(h),u_height_factor:new r.bQ(h),u_edge_radius:new r.bQ(h),u_ao:new r.bO(h),u_tile_id:new r.bP(h),u_zoom_transition:new r.bQ(h),u_inv_rot_matrix:new r.bN(h),u_merc_center:new r.bO(h),u_up_dir:new r.bP(h),u_height_lift:new r.bQ(h),u_image:new r.bR(h),u_texsize:new r.bO(h),u_pixel_coord_upper:new r.bO(h),u_pixel_coord_lower:new r.bO(h),u_tile_units_to_pixels:new r.bQ(h),u_opacity:new r.bQ(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new r.bN(h),u_opacity:new r.bQ(h),u_ao_pass:new r.bQ(h),u_meter_to_tile:new r.bQ(h),u_ao:new r.bO(h),u_flood_light_intensity:new r.bQ(h),u_flood_light_color:new r.bP(h),u_attenuation:new r.bQ(h),u_edge_radius:new r.bQ(h),u_fb:new r.bR(h),u_fb_size:new r.bQ(h)}),fill:h=>({u_matrix:new r.bN(h),u_emissive_strength:new r.bQ(h)}),fillPattern:h=>({u_matrix:new r.bN(h),u_emissive_strength:new r.bQ(h),u_image:new r.bR(h),u_texsize:new r.bO(h),u_pixel_coord_upper:new r.bO(h),u_pixel_coord_lower:new r.bO(h),u_tile_units_to_pixels:new r.bQ(h)}),fillOutline:h=>({u_matrix:new r.bN(h),u_emissive_strength:new r.bQ(h),u_world:new r.bO(h)}),fillOutlinePattern:h=>({u_matrix:new r.bN(h),u_emissive_strength:new r.bQ(h),u_world:new r.bO(h),u_image:new r.bR(h),u_texsize:new r.bO(h),u_pixel_coord_upper:new r.bO(h),u_pixel_coord_lower:new r.bO(h),u_tile_units_to_pixels:new r.bQ(h)}),circle:r.cz,collisionBox:h=>({u_matrix:new r.bN(h),u_camera_to_center_distance:new r.bQ(h),u_extrude_scale:new r.bO(h)}),collisionCircle:h=>({u_matrix:new r.bN(h),u_inv_matrix:new r.bN(h),u_camera_to_center_distance:new r.bQ(h),u_viewport_size:new r.bO(h)}),debug:h=>({u_color:new r.cf(h),u_matrix:new r.bN(h),u_overlay:new r.bR(h),u_overlay_scale:new r.bQ(h)}),clippingMask:h=>({u_matrix:new r.bN(h)}),heatmap:h=>({u_extrude_scale:new r.bQ(h),u_intensity:new r.bQ(h),u_matrix:new r.bN(h),u_inv_rot_matrix:new r.bN(h),u_merc_center:new r.bO(h),u_tile_id:new r.bP(h),u_zoom_transition:new r.bQ(h),u_up_dir:new r.bP(h)}),heatmapTexture:h=>({u_image:new r.bR(h),u_color_ramp:new r.bR(h),u_opacity:new r.bQ(h)}),hillshade:h=>({u_matrix:new r.bN(h),u_image:new r.bR(h),u_latrange:new r.bO(h),u_light:new r.bO(h),u_shadow:new r.cf(h),u_highlight:new r.cf(h),u_emissive_strength:new r.bQ(h),u_accent:new r.cf(h)}),hillshadePrepare:h=>({u_matrix:new r.bN(h),u_image:new r.bR(h),u_dimension:new r.bO(h),u_zoom:new r.bQ(h)}),line:r.cA,linePattern:r.cB,raster:h=>({u_matrix:new r.bN(h),u_normalize_matrix:new r.bN(h),u_globe_matrix:new r.bN(h),u_merc_matrix:new r.bN(h),u_grid_matrix:new r.cg(h),u_tl_parent:new r.bO(h),u_scale_parent:new r.bQ(h),u_fade_t:new r.bQ(h),u_opacity:new r.bQ(h),u_image0:new r.bR(h),u_image1:new r.bR(h),u_brightness_low:new r.bQ(h),u_brightness_high:new r.bQ(h),u_saturation_factor:new r.bQ(h),u_contrast_factor:new r.bQ(h),u_spin_weights:new r.bP(h),u_perspective_transform:new r.bO(h),u_raster_elevation:new r.bQ(h),u_zoom_transition:new r.bQ(h),u_merc_center:new r.bO(h),u_cutoff_params:new r.bS(h),u_colorization_mix:new r.bS(h),u_colorization_offset:new r.bQ(h),u_color_ramp:new r.bR(h),u_texture_offset:new r.bO(h),u_texture_res:new r.bO(h),u_emissive_strength:new r.bQ(h)}),rasterParticle:h=>({u_matrix:new r.bN(h),u_normalize_matrix:new r.bN(h),u_globe_matrix:new r.bN(h),u_merc_matrix:new r.bN(h),u_grid_matrix:new r.cg(h),u_tl_parent:new r.bO(h),u_scale_parent:new r.bQ(h),u_fade_t:new r.bQ(h),u_opacity:new r.bQ(h),u_image0:new r.bR(h),u_image1:new r.bR(h),u_raster_elevation:new r.bQ(h),u_zoom_transition:new r.bQ(h),u_merc_center:new r.bO(h),u_cutoff_params:new r.bS(h)}),rasterParticleTexture:h=>({u_texture:new r.bR(h),u_opacity:new r.bQ(h)}),rasterParticleDraw:h=>({u_particle_texture:new r.bR(h),u_particle_texture_side_len:new r.bQ(h),u_tile_offset:new r.bO(h),u_velocity:new r.bR(h),u_color_ramp:new r.bR(h),u_velocity_res:new r.bO(h),u_max_speed:new r.bQ(h),u_uv_offset:new r.bO(h),u_data_scale:new r.bS(h),u_data_offset:new r.bQ(h),u_particle_pos_scale:new r.bQ(h),u_particle_pos_offset:new r.bO(h)}),rasterParticleUpdate:h=>({u_particle_texture:new r.bR(h),u_particle_texture_side_len:new r.bQ(h),u_velocity:new r.bR(h),u_velocity_res:new r.bO(h),u_max_speed:new r.bQ(h),u_speed_factor:new r.bQ(h),u_reset_rate:new r.bQ(h),u_rand_seed:new r.bQ(h),u_uv_offset:new r.bO(h),u_data_scale:new r.bS(h),u_data_offset:new r.bQ(h),u_particle_pos_scale:new r.bQ(h),u_particle_pos_offset:new r.bO(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new r.bR(h),u_is_size_feature_constant:new r.bR(h),u_size_t:new r.bQ(h),u_size:new r.bQ(h),u_camera_to_center_distance:new r.bQ(h),u_rotate_symbol:new r.bR(h),u_aspect_ratio:new r.bQ(h),u_fade_change:new r.bQ(h),u_matrix:new r.bN(h),u_label_plane_matrix:new r.bN(h),u_coord_matrix:new r.bN(h),u_is_text:new r.bR(h),u_pitch_with_map:new r.bR(h),u_texsize:new r.bO(h),u_tile_id:new r.bP(h),u_zoom_transition:new r.bQ(h),u_inv_rot_matrix:new r.bN(h),u_merc_center:new r.bO(h),u_camera_forward:new r.bP(h),u_tile_matrix:new r.bN(h),u_up_vector:new r.bP(h),u_ecef_origin:new r.bP(h),u_texture:new r.bR(h),u_icon_transition:new r.bQ(h),u_color_adj_mat:new r.bN(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new r.bR(h),u_is_size_feature_constant:new r.bR(h),u_size_t:new r.bQ(h),u_size:new r.bQ(h),u_camera_to_center_distance:new r.bQ(h),u_rotate_symbol:new r.bR(h),u_aspect_ratio:new r.bQ(h),u_fade_change:new r.bQ(h),u_matrix:new r.bN(h),u_label_plane_matrix:new r.bN(h),u_coord_matrix:new r.bN(h),u_is_text:new r.bR(h),u_pitch_with_map:new r.bR(h),u_texsize:new r.bO(h),u_texture:new r.bR(h),u_gamma_scale:new r.bQ(h),u_device_pixel_ratio:new r.bQ(h),u_tile_id:new r.bP(h),u_zoom_transition:new r.bQ(h),u_inv_rot_matrix:new r.bN(h),u_merc_center:new r.bO(h),u_camera_forward:new r.bP(h),u_tile_matrix:new r.bN(h),u_up_vector:new r.bP(h),u_ecef_origin:new r.bP(h),u_is_halo:new r.bR(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new r.bR(h),u_is_size_feature_constant:new r.bR(h),u_size_t:new r.bQ(h),u_size:new r.bQ(h),u_camera_to_center_distance:new r.bQ(h),u_rotate_symbol:new r.bR(h),u_aspect_ratio:new r.bQ(h),u_fade_change:new r.bQ(h),u_matrix:new r.bN(h),u_label_plane_matrix:new r.bN(h),u_coord_matrix:new r.bN(h),u_is_text:new r.bR(h),u_pitch_with_map:new r.bR(h),u_texsize:new r.bO(h),u_texsize_icon:new r.bO(h),u_texture:new r.bR(h),u_texture_icon:new r.bR(h),u_gamma_scale:new r.bQ(h),u_device_pixel_ratio:new r.bQ(h),u_is_halo:new r.bR(h)}),background:h=>({u_matrix:new r.bN(h),u_emissive_strength:new r.bQ(h),u_opacity:new r.bQ(h),u_color:new r.cf(h)}),backgroundPattern:h=>({u_matrix:new r.bN(h),u_emissive_strength:new r.bQ(h),u_opacity:new r.bQ(h),u_image:new r.bR(h),u_pattern_tl:new r.bO(h),u_pattern_br:new r.bO(h),u_texsize:new r.bO(h),u_pattern_size:new r.bO(h),u_pixel_coord_upper:new r.bO(h),u_pixel_coord_lower:new r.bO(h),u_tile_units_to_pixels:new r.bQ(h)}),terrainRaster:Si,terrainDepth:Si,skybox:h=>({u_matrix:new r.bN(h),u_sun_direction:new r.bP(h),u_cubemap:new r.bR(h),u_opacity:new r.bQ(h),u_temporal_offset:new r.bQ(h)}),skyboxGradient:h=>({u_matrix:new r.bN(h),u_color_ramp:new r.bR(h),u_center_direction:new r.bP(h),u_radius:new r.bQ(h),u_opacity:new r.bQ(h),u_temporal_offset:new r.bQ(h)}),skyboxCapture:h=>({u_matrix_3f:new r.cg(h),u_sun_direction:new r.bP(h),u_sun_intensity:new r.bQ(h),u_color_tint_r:new r.bS(h),u_color_tint_m:new r.bS(h),u_luminance:new r.bQ(h)}),globeRaster:h=>({u_proj_matrix:new r.bN(h),u_globe_matrix:new r.bN(h),u_normalize_matrix:new r.bN(h),u_merc_matrix:new r.bN(h),u_zoom_transition:new r.bQ(h),u_merc_center:new r.bO(h),u_image0:new r.bR(h),u_grid_matrix:new r.cg(h),u_skirt_height:new r.bQ(h),u_far_z_cutoff:new r.bQ(h),u_frustum_tl:new r.bP(h),u_frustum_tr:new r.bP(h),u_frustum_br:new r.bP(h),u_frustum_bl:new r.bP(h),u_globe_pos:new r.bP(h),u_globe_radius:new r.bQ(h),u_viewport:new r.bO(h)}),globeAtmosphere:h=>({u_frustum_tl:new r.bP(h),u_frustum_tr:new r.bP(h),u_frustum_br:new r.bP(h),u_frustum_bl:new r.bP(h),u_horizon:new r.bQ(h),u_transition:new r.bQ(h),u_fadeout_range:new r.bQ(h),u_color:new r.bS(h),u_high_color:new r.bS(h),u_space_color:new r.bS(h),u_temporal_offset:new r.bQ(h),u_horizon_angle:new r.bQ(h)}),model:h=>({u_matrix:new r.bN(h),u_lighting_matrix:new r.bN(h),u_normal_matrix:new r.bN(h),u_node_matrix:new r.bN(h),u_lightpos:new r.bP(h),u_lightintensity:new r.bQ(h),u_lightcolor:new r.bP(h),u_camera_pos:new r.bP(h),u_opacity:new r.bQ(h),u_baseColorFactor:new r.bS(h),u_emissiveFactor:new r.bS(h),u_metallicFactor:new r.bQ(h),u_roughnessFactor:new r.bQ(h),u_baseTextureIsAlpha:new r.bR(h),u_alphaMask:new r.bR(h),u_alphaCutoff:new r.bQ(h),u_baseColorTexture:new r.bR(h),u_metallicRoughnessTexture:new r.bR(h),u_normalTexture:new r.bR(h),u_occlusionTexture:new r.bR(h),u_emissionTexture:new r.bR(h),u_color_mix:new r.bS(h),u_aoIntensity:new r.bQ(h),u_emissive_strength:new r.bQ(h),u_occlusionTextureTransform:new r.bS(h)}),modelDepth:h=>({u_matrix:new r.bN(h),u_instance:new r.bN(h),u_node_matrix:new r.bN(h)}),groundShadow:h=>({u_matrix:new r.bN(h),u_ground_shadow_factor:new r.bP(h)}),stars:h=>({u_matrix:new r.bN(h),u_up:new r.bP(h),u_right:new r.bP(h),u_intensity_multiplier:new r.bQ(h)})};let Gl;function ed(h,n,o,f,_,y,b){const M=h.context,I=M.gl,D=h.transform,z=h.getOrCreateProgram("collisionBox"),k=[];let F=0,N=0;for(let ne=0;ne<f.length;ne++){const oe=f[ne],H=n.getTile(oe),J=H.getBucket(o);if(!J)continue;const he=Is(oe,J,D);let ce=he;_[0]===0&&_[1]===0||(ce=h.translatePosMatrix(he,H,_,y));const ge=b?J.textCollisionBox:J.iconCollisionBox,Ae=J.collisionCircleArray;if(Ae.length>0){const _e=r.a9.create(),Te=ce;r.a9.mul(_e,J.placementInvProjMatrix,D.glCoordMatrix),r.a9.mul(_e,_e,J.placementViewportMatrix),k.push({circleArray:Ae,circleOffset:N,transform:Te,invTransform:_e,projection:J.getProjection()}),F+=Ae.length/4,N=F}ge&&(h.terrain&&h.terrain.setupElevationDraw(H,z),z.draw(h,I.LINES,Vt.disabled,Xt.disabled,h.colorModeForRenderPass(),Wt.disabled,_g(ce,D,H,J.getProjection()),o.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,D.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!b||!k.length)return;const G=h.getOrCreateProgram("collisionCircle"),U=new r.cC;U.resize(4*F),U._trim();let $=0;for(const ne of k)for(let oe=0;oe<ne.circleArray.length/4;oe++){const H=4*oe,J=ne.circleArray[H+0],he=ne.circleArray[H+1],ce=ne.circleArray[H+2],ge=ne.circleArray[H+3];U.emplace($++,J,he,ce,ge,0),U.emplace($++,J,he,ce,ge,1),U.emplace($++,J,he,ce,ge,2),U.emplace($++,J,he,ce,ge,3)}(!Gl||Gl.length<2*F)&&(Gl=function(ne){const oe=2*ne,H=new r.az;H.resize(oe),H._trim();for(let J=0;J<oe;J++){const he=6*J;H.uint16[he+0]=4*J+0,H.uint16[he+1]=4*J+1,H.uint16[he+2]=4*J+2,H.uint16[he+3]=4*J+2,H.uint16[he+4]=4*J+3,H.uint16[he+5]=4*J+0}return H}(F));const q=M.createIndexBuffer(Gl,!0),Y=M.createVertexBuffer(U,r.cD.members,!0);for(const ne of k){const oe={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(re=D).getCameraToCenterDistance(ne.projection),u_viewport_size:[re.width,re.height]};G.draw(h,I.TRIANGLES,Vt.disabled,Xt.disabled,h.colorModeForRenderPass(),Wt.disabled,oe,o.id,Y,q,r.aE.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,D.zoom)}var re;Y.destroy(),q.destroy()}const $l=r.a9.create();function td(h){const n=h._camera.getWorldToCamera(h.worldSize,1),o=r.a9.multiply([],n,h.globeMatrix);r.a9.invert(o,o);const f=[0,0,0],_=[0,1,0,0];return r.aa.transformMat4(_,_,o),f[0]=_[0],f[1]=_[1],f[2]=_[2],r.Q.normalize(f,f),f}function qo({width:h,height:n,anchor:o,textOffset:f,textScale:_},y){const{horizontalAlign:b,verticalAlign:M}=r.bi(o),I=-(b-.5)*h,D=-(M-.5)*n,z=r.bh(o,f);return new r.P((I/_+z[0])*y,(D/_+z[1])*y)}function wp(h,n,o,f,_,y,b,M,I,D,z){const k=h.text.placedSymbolArray,F=h.text.dynamicLayoutVertexArray,N=h.icon.dynamicLayoutVertexArray,G={},U=h.getProjection(),$=tu(M,U,y),q=y.elevation,Y=U.upVectorScale(M.canonical,y.center.lat,y.worldSize).metersToTile;F.clear();for(let re=0;re<k.length;re++){const ne=k.get(re),{tileAnchorX:oe,tileAnchorY:H,numGlyphs:J}=ne,he=ne.hidden||!ne.crossTileID||h.allowVerticalPlacement&&!ne.placedOrientation?null:f[ne.crossTileID];if(he){let ce=0,ge=0,Ae=0;if(q){const Ie=q?q.getAtTileOffset(M,oe,H):0,[se,je,vt]=U.upVector(M.canonical,oe,H);ce=Ie*se*Y,ge=Ie*je*Y,Ae=Ie*vt*Y}let[_e,Te,Pe,me]=Vr(ne.projectedAnchorX+ce,ne.projectedAnchorY+ge,ne.projectedAnchorZ+Ae,o?$:b);const be=Xc(y.getCameraToCenterDistance(U),me);let Ze=_.evaluateSizeForFeature(h.textSizeData,D,ne)*be/r.bf;o&&(Ze*=h.tilePixelRatio/I);const ye=qo(he,Ze);o?({x:_e,y:Te,z:Pe}=U.projectTilePoint(oe+ye.x,H+ye.y,M.canonical),[_e,Te,Pe]=Vr(_e+ce,Te+ge,Pe+Ae,b)):(n&&ye._rotate(-y.angle),_e+=ye.x,Te+=ye.y,Pe=0);const Se=h.allowVerticalPlacement&&ne.placedOrientation===r.b9.vertical?Math.PI/2:0;for(let Ie=0;Ie<J;Ie++)r.bc(F,_e,Te,Pe,Se);z&&ne.associatedIconIndex>=0&&(G[ne.associatedIconIndex]={x:_e,y:Te,z:Pe,angle:Se})}else Vo(J,F)}if(z){N.clear();const re=h.icon.placedSymbolArray;for(let ne=0;ne<re.length;ne++){const oe=re.get(ne),{numGlyphs:H}=oe,J=G[ne];if(oe.hidden||!J)Vo(H,N);else{const{x:he,y:ce,z:ge,angle:Ae}=J;for(let _e=0;_e<H;_e++)r.bc(N,he,ce,ge,Ae)}}h.icon.dynamicLayoutVertexBuffer.updateData(N)}h.text.dynamicLayoutVertexBuffer.updateData(F)}function ql(h,n,o,f,_,y,b={}){const M=o.paint.get("icon-translate"),I=o.paint.get("text-translate"),D=o.paint.get("icon-translate-anchor"),z=o.paint.get("text-translate-anchor"),k=o.layout.get("icon-rotation-alignment"),F=o.layout.get("text-rotation-alignment"),N=o.layout.get("icon-pitch-alignment"),G=o.layout.get("text-pitch-alignment"),U=o.layout.get("icon-keep-upright"),$=o.layout.get("text-keep-upright"),q=o.paint.get("icon-color-saturation"),Y=o.paint.get("icon-color-contrast"),re=o.paint.get("icon-color-brightness-min"),ne=o.paint.get("icon-color-brightness-max"),oe=h.context,H=oe.gl,J=h.transform,he=k==="map",ce=F==="map",ge=N==="map",Ae=G==="map",_e=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Te=!1;const Pe=h.depthModeForSublayer(0,Vt.ReadOnly),me=[r.a8(J.center.lng),r.ah(J.center.lat)],be=o.layout.get("text-variable-anchor"),Ze=J.projection.name==="globe",ye=[],Se=[0,-1,0];for(const Ie of f){const se=n.getTile(Ie),je=se.getBucket(o);if(!je||je.projection.name==="mercator"&&Ze||je.fullyClipped)continue;const vt=je.projection.name==="globe",At=vt?r.W(J.zoom):0,Ot=tu(Ie,je.getProjection(),J),Pt=J.calculatePixelsToTileUnitsMatrix(se),Bt=be&&je.hasTextData(),_i=je.hasIconTextFit()&&Bt&&je.hasIconData(),Zt=je.getProjection().createInversionMatrix(J,Ie.canonical),xi=()=>{const ri=he&&o.layout.get("symbol-placement")!=="point",oi=[],nn=ri||_i,Yi=o.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&ge&&oi.push("PITCH_WITH_MAP_TERRAIN"),vt&&(oi.push("PROJECTION_GLOBE_VIEW"),nn&&oi.push("PROJECTED_POS_ON_VIEWPORT")),Yi>0&&oi.push("ICON_TRANSITION"),je.icon.zOffsetVertexBuffer&&oi.push("Z_OFFSET"),q===0&&Y===0&&re===0&&ne===1||oi.push("COLOR_ADJUSTMENT");const hi=je.icon.programConfigurations.get(o.id),ei=h.getOrCreateProgram(je.sdfIcons?"symbolSDF":"symbolIcon",{config:hi,defines:oi});let Ar;const ur=se.imageAtlasTexture?se.imageAtlasTexture.size:[0,0],qn=je.iconSizeData,hr=r.b8(qn,J.zoom),Ir=ge||J.pitch!==0,gr=wl(Ot,se.tileID.canonical,ge,he,J,je.getProjection(),Pt),Wn=qs(Ot,se.tileID.canonical,ge,he,J,je.getProjection(),Pt),nr=h.translatePosMatrix(Wn,se,M,D,!0),rr=h.translatePosMatrix(Ot,se,M,D),Rs=nn?$l:gr,xs=he&&!ge&&!ri;let zs=Se;!Ze&&!J.mercatorFromTransition||he||(zs=td(J));const Ls=vt?zs:Se;if(je.sdfIcons&&!je.iconsInText)Ar=Ea(qn.kind,hr,xs,ge,h,rr,Rs,nr,!1,ur,!0,Ie,At,me,Zt,Ls,je.getProjection());else{const Xs=o.getColorAdjustmentMatrix(q,Y,re,ne);Ar=Yh(qn.kind,hr,xs,ge,h,rr,Rs,nr,!1,ur,Ie,At,me,Zt,Ls,je.getProjection(),Xs,Yi)}const To=se.imageAtlasTexture?se.imageAtlasTexture:null,Yr=o.layout.get("icon-size").constantOr(0)!==1||je.iconsNeedLinear,sc=je.sdfIcons||h.options.rotating||h.options.zooming||Yr||Ir?H.LINEAR:H.NEAREST,Oa=je.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,oc=h.terrain&&ge&&ri?r.a9.invert(r.a9.create(),gr):$l;if(ri&&je.icon){const Xs=J.elevation,Hn=Xs?Xs.getAtTileOffsetFunc(Ie,J.center.lat,J.worldSize,je.getProjection()):null,ac=Tl(Ot,se.tileID.canonical,ge,he,J,je.getProjection(),Pt);Kc(je,Ot,h,!1,ac,Wn,ge,U,Hn,Ie)}return{program:ei,buffers:je.icon,uniformValues:Ar,atlasTexture:To,atlasTextureIcon:null,atlasInterpolation:sc,atlasInterpolationIcon:null,isSDF:je.sdfIcons,hasHalo:Oa,tile:se,labelPlaneMatrixInv:oc}},gi=()=>{const ri=ce&&o.layout.get("symbol-placement")!=="point",oi=[],nn=ri||be||_i;h.terrainRenderModeElevated()&&Ae&&oi.push("PITCH_WITH_MAP_TERRAIN"),vt&&(oi.push("PROJECTION_GLOBE_VIEW"),nn&&oi.push("PROJECTED_POS_ON_VIEWPORT")),je.text.zOffsetVertexBuffer&&oi.push("Z_OFFSET");const Yi=je.text.programConfigurations.get(o.id),hi=h.getOrCreateProgram(je.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Yi,defines:oi});let ei,Ar=[0,0],ur=null;const qn=je.textSizeData;je.iconsInText&&(Ar=se.imageAtlasTexture?se.imageAtlasTexture.size:[0,0],ur=se.imageAtlasTexture?se.imageAtlasTexture:null,ei=Ae||J.pitch!==0||h.options.rotating||h.options.zooming||qn.kind==="composite"||qn.kind==="camera"?H.LINEAR:H.NEAREST);const hr=se.glyphAtlasTexture?se.glyphAtlasTexture.size:[0,0],Ir=r.b8(qn,J.zoom),gr=wl(Ot,se.tileID.canonical,Ae,ce,J,je.getProjection(),Pt),Wn=qs(Ot,se.tileID.canonical,Ae,ce,J,je.getProjection(),Pt),nr=h.translatePosMatrix(Wn,se,I,z,!0),rr=h.translatePosMatrix(Ot,se,I,z),Rs=nn?$l:gr,xs=ce&&!Ae&&!ri;let zs=Se;!Ze&&!J.mercatorFromTransition||ce||(zs=td(J));const Ls=vt?zs:Se;let To;To=je.iconsInText?yo(qn.kind,Ir,xs,Ae,h,rr,Rs,nr,hr,Ar,Ie,At,me,Zt,Ls,je.getProjection()):Ea(qn.kind,Ir,xs,Ae,h,rr,Rs,nr,!0,hr,!0,Ie,At,me,Zt,Ls,je.getProjection());const Yr=se.glyphAtlasTexture?se.glyphAtlasTexture:null,sc=H.LINEAR,Oa=o.paint.get("text-halo-width").constantOr(1)!==0,oc=h.terrain&&Ae&&ri?r.a9.invert(r.a9.create(),gr):$l;if(ri&&je.text){const Xs=J.elevation,Hn=Xs?Xs.getAtTileOffsetFunc(Ie,J.center.lat,J.worldSize,je.getProjection()):null,ac=Tl(Ot,se.tileID.canonical,Ae,ce,J,je.getProjection(),Pt);Kc(je,Ot,h,!0,ac,Wn,Ae,$,Hn,Ie)}return{program:hi,buffers:je.text,uniformValues:To,atlasTexture:Yr,atlasTextureIcon:ur,atlasInterpolation:sc,atlasInterpolationIcon:ei,isSDF:!0,hasHalo:Oa,tile:se,labelPlaneMatrixInv:oc}},cn=je.icon.segments.get().length,Vi=je.text.segments.get().length,kn=cn&&!b.onlyText?xi():null,In=Vi&&!b.onlyIcons?gi():null,Xi=o.paint.get("icon-opacity").constantOr(1),$i=o.paint.get("text-opacity").constantOr(1);if(_e&&je.canOverlap){Te=!0;const ri=Xi&&!b.onlyText?je.icon.segments.get():[],oi=$i&&!b.onlyIcons?je.text.segments.get():[];for(const nn of ri)ye.push({segments:new r.aE([nn]),sortKey:nn.sortKey,state:kn});for(const nn of oi)ye.push({segments:new r.aE([nn]),sortKey:nn.sortKey,state:In})}else b.onlyText||ye.push({segments:Xi?je.icon.segments:new r.aE([]),sortKey:0,state:kn}),b.onlyIcons||ye.push({segments:$i?je.text.segments:new r.aE([]),sortKey:0,state:In})}Te&&ye.sort((Ie,se)=>Ie.sortKey-se.sortKey);for(const Ie of ye){const se=Ie.state;if(se)if(h.terrain&&h.terrain.setupElevationDraw(se.tile,se.program,{useDepthForOcclusion:J.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:se.labelPlaneMatrixInv}),oe.activeTexture.set(H.TEXTURE0),se.atlasTexture&&se.atlasTexture.bind(se.atlasInterpolation,H.CLAMP_TO_EDGE,!0),se.atlasTextureIcon&&(oe.activeTexture.set(H.TEXTURE1),se.atlasTextureIcon&&se.atlasTextureIcon.bind(se.atlasInterpolationIcon,H.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,se.program),se.hasHalo){const je=se.uniformValues;je.u_is_halo=1,bu(se.buffers,Ie.segments,o,h,se.program,Pe,_,y,je,2),je.u_is_halo=0}else{if(se.isSDF){const je=se.uniformValues;se.hasHalo&&(je.u_is_halo=1,bu(se.buffers,Ie.segments,o,h,se.program,Pe,_,y,je,1)),je.u_is_halo=0}bu(se.buffers,Ie.segments,o,h,se.program,Pe,_,y,se.uniformValues,1)}}}function bu(h,n,o,f,_,y,b,M,I,D){const z=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,y,b,M,Wt.disabled,I,o.id,h.layoutVertexBuffer,h.indexBuffer,n,o.paint,f.transform.zoom,h.programConfigurations.get(o.id),z,D)}function wu(h,n,o,f,_,y,b){const M=h.context.gl,I=o.paint.get("fill-pattern"),D=I&&I.constantOr(1);let z,k,F,N,G;b?(k=D&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=M.LINES):(k=D?"fillPattern":"fill",z=M.TRIANGLES);for(const U of f){const $=n.getTile(U);if(D&&!$.patternsLoaded())continue;const q=$.getBucket(o);if(!q)continue;h.prepareDrawTile();const Y=q.programConfigurations.get(o.id),re=h.isTileAffectedByFog(U),ne=h.getOrCreateProgram(k,{config:Y,overrideFog:re});D&&(h.context.activeTexture.set(M.TEXTURE0),$.imageAtlasTexture&&$.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Y.updatePaintBuffers());const oe=I.constantOr(null);if(oe&&$.imageAtlas){const he=$.imageAtlas.patternPositions[oe.toString()];he&&Y.setConstantPatternPositions(he)}const H=h.translatePosMatrix(U.projMatrix,$,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),J=o.paint.get("fill-emissive-strength");if(b){N=q.indexBuffer2,G=q.segments2;const he=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];F=k==="fillOutlinePattern"&&D?Hs(H,J,h,$,he):mg(H,J,he)}else N=q.indexBuffer,G=q.segments,F=D?go(H,J,h,$):Sa(H,J);h.uploadCommonUniforms(h.context,ne,U.toUnwrapped()),ne.draw(h,z,_,h.stencilModeForClipping(U),y,Wt.disabled,F,o.id,q.layoutVertexBuffer,N,G,o.paint,h.transform.zoom,Y,void 0)}}function ut(h,n,o,f,_,y,b,M){o.resetLayerRenderingStats(h);const I=h.context,D=I.gl,z=h.transform,k=o.paint.get("fill-extrusion-pattern"),F=k.constantOr(1),N=o.paint.get("fill-extrusion-opacity"),G=h.style.enable3dLights(),U=o.paint.get(G&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),$=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],q=o.layout.get("fill-extrusion-edge-radius"),Y=q>0&&!o.paint.get("fill-extrusion-rounded-roof"),re=Y?0:q,ne=z.projection.name==="globe"?r.cM():0,oe=z.projection.name==="globe",H=oe?r.W(z.zoom):0,J=[r.a8(z.center.lng),r.ah(z.center.lat)],he=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ce=o.paint.get("fill-extrusion-flood-light-intensity"),ge=o.paint.get("fill-extrusion-vertical-scale"),Ae=po(h,o.paint.get("fill-extrusion-cutoff-fade-range")),_e=o.paint.get("fill-extrusion-emissive-strength"),Te=[];let Pe;oe&&Te.push("PROJECTION_GLOBE_VIEW"),$[0]>0&&Te.push("FAUX_AO"),Y&&Te.push("ZERO_ROOF_RADIUS"),M&&Te.push("HAS_CENTROID"),ce>0&&Te.push("FLOOD_LIGHT"),Ae.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const me=h.renderPass==="shadow",be=h.shadowRenderer,Ze=me&&!!be;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let ye=[0,0,0];if(be){const se=h.style.directionalLight,je=h.style.ambientLight;se&&je&&(ye=Gh(se,je)),Pe=Te.concat(["SHADOWS_SINGLE_CASCADE"])}const Se=Ze?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",Ie=o.getLayerRenderingStats();for(const se of f){const je=n.getTile(se),vt=je.getBucket(o);if(!vt||vt.projection.name!==z.projection.name)continue;let At=!1;be&&(At=be.getMaxCascadeForTile(se.toUnwrapped())===0);const Ot=h.isTileAffectedByFog(se),Pt=vt.programConfigurations.get(o.id),Bt=h.getOrCreateProgram(Se,{config:Pt,defines:At?Pe:Te,overrideFog:Ot});if(h.terrain&&h.terrain.setupElevationDraw(je,Bt,{useMeterToDem:!0}),!vt.centroidVertexBuffer){const Vi=Bt.attributes.a_centroid_pos;Vi!==void 0&&D.vertexAttrib2f(Vi,0,0)}!me&&be&&be.setupShadows(je.tileID.toUnwrapped(),Bt,"vector-tile",je.tileID.overscaledZ),F&&(h.context.activeTexture.set(D.TEXTURE0),je.imageAtlasTexture&&je.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Pt.updatePaintBuffers());const _i=k.constantOr(null);if(_i&&je.imageAtlas){const Vi=je.imageAtlas.patternPositions[_i.toString()];Vi&&Pt.setConstantPatternPositions(Vi)}const Zt=o.paint.get("fill-extrusion-vertical-gradient");let xi;if(me&&be){if(Zs(je.tileID,vt,h))continue;const Vi=be.calculateShadowPassMatrixFromTile(je.tileID.toUnwrapped());xi=gs(Vi,re,ge)}else{const Vi=h.translatePosMatrix(se.expandedProjMatrix,je,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),kn=z.projection.createInversionMatrix(z,se.canonical);xi=F?Nl(Vi,h,Zt,N,$,re,se,je,ne,H,J,kn,he,ge):xu(Vi,h,Zt,N,$,re,se,ne,H,J,kn,he,ge,ce,ye,_e)}h.uploadCommonUniforms(I,Bt,se.toUnwrapped(),null,Ae);let gi=vt.segments;if(z.projection.name==="mercator"&&!me&&(gi=vt.getVisibleSegments(je.tileID,h.terrain,h.transform.getFrustum(0)),!gi.get().length))continue;if(Ie)if(me)for(const Vi of gi.get())Ie.numRenderedVerticesInShadowPass+=Vi.primitiveLength;else for(const Vi of gi.get())Ie.numRenderedVerticesInTransparentPass+=Vi.primitiveLength;const cn=[];(h.terrain||M)&&cn.push(vt.centroidVertexBuffer),oe&&cn.push(vt.layoutVertexExtBuffer),Bt.draw(h,I.gl.TRIANGLES,_,y,b,Wt.backCCW,xi,o.id,vt.layoutVertexBuffer,vt.indexBuffer,gi,o.paint,h.transform.zoom,Pt,cn)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function Wo(h,n,o,f,_,y,b,M,I,D,z,k,F,N,G,U,$,q,Y){const re=h.context,ne=re.gl,oe=h.transform,H=h.transform.zoom,J=[],he=po(h,o.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(J.push("CLEAR_SUBPASS"),Y&&(J.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(ne.TEXTURE0),Y.bind(ne.LINEAR,ne.CLAMP_TO_EDGE))):D==="sdf"&&J.push("SDF_SUBPASS"),$&&J.push("HAS_CENTROID"),he.shouldRenderCutoff&&J.push("RENDER_CUTOFF");const ce=o.layout.get("fill-extrusion-edge-radius"),ge=(Ae,_e,Te,Pe,me)=>{const be=_e.programConfigurations.get(o.id),Ze=h.isTileAffectedByFog(Ae),ye=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:be,defines:J,overrideFog:Ze}),Se=((se,je,vt,At,Ot,Pt,Bt,_i,Zt,xi,gi)=>({u_matrix:je,u_opacity:vt,u_ao_pass:At?1:0,u_meter_to_tile:Ot,u_ao:Pt,u_flood_light_intensity:Bt,u_flood_light_color:_i,u_attenuation:Zt,u_edge_radius:xi,u_fb:0,u_fb_size:gi}))(0,Pe,z,I,me,[k,F*me],N,G,U,H>=17?0:ce*me,Y?Y.size[0]:0),Ie=[];$&&Ie.push(_e.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(re,ye,Ae.toUnwrapped(),null,he),ye.draw(h,re.gl.TRIANGLES,_,y,b,M,Se,o.id,_e.vertexBuffer,_e.indexBuffer,Te,o.paint,H,be,Ie)};for(const Ae of f){const _e=n.getTile(Ae),Te=_e.getBucket(o);if(!Te||Te.projection.name!==oe.projection.name||!Te.groundEffect||Te.groundEffect&&!Te.groundEffect.hasData())continue;const Pe=Te.groundEffect,me=1/Te.tileToMeter;{const be=h.translatePosMatrix(Ae.projMatrix,_e,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Ze=Pe.getDefaultSegment();ge(Ae,Pe,Ze,be,me)}if(q)for(let be=0;be<4;be++){const Ze=r.cN[be](Ae),ye=n.getTile(Ze);if(!ye)continue;const Se=ye.getBucket(o);if(!Se||Se.projection.name!==oe.projection.name||!Se.groundEffect||Se.groundEffect&&!Se.groundEffect.hasData())continue;const Ie=Se.groundEffect;let se,je;be===0?(se=[-r.Y,0,0],je=1):be===1?(se=[r.Y,0,0],je=0):be===2?(se=[0,-r.Y,0],je=3):(se=[0,r.Y,0],je=2);const vt=Ie.regionSegments[je];if(!vt)continue;const At=new Float32Array(16);r.a9.translate(At,Ae.projMatrix,se),ge(Ae,Ie,vt,h.translatePosMatrix(At,_e,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),me)}}}function id(h,n,o,f,_,y,b){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const M=y?y.findDEMTileFor(o):null;if(!(M&&M.dem||b))return;const I=q=>new r.P(Math.ceil((q+r.cQ)*r.cR),0),D=q=>{const Y=n.getSource().minzoom,re=oe=>{const H=n.getTileByID(oe);if(H&&H.hasData())return H.getBucket(_)},ne=[0,-1,1];for(const oe of ne){if(q.overscaledZ+oe<Y)continue;const H=re(q.calculateScaledKey(q.overscaledZ+oe));if(H)return H}},z=[0,0,0],k=(q,Y)=>(z[0]=Math.min(q.min.y,Y.min.y),z[1]=Math.max(q.max.y,Y.max.y),z[2]=r.Y-Y.min.x>q.max.x?Y.min.x-r.Y:q.max.x,z),F=(q,Y)=>(z[0]=Math.min(q.min.x,Y.min.x),z[1]=Math.max(q.max.x,Y.max.x),z[2]=r.Y-Y.min.y>q.max.y?Y.min.y-r.Y:q.max.y,z),N=[(q,Y)=>k(q,Y),(q,Y)=>k(Y,q),(q,Y)=>F(q,Y),(q,Y)=>F(Y,q)],G=(q,Y,re,ne,oe,H,J)=>{if(!y)return 0;const he=[[H?re:q,H?q:re,0],[H?re:Y,H?Y:re,0]],ce=J<0?r.Y+J:J,ge=[H?ce:(q+Y)/2,H?(q+Y)/2:ce,0];return re===0&&J<0||re!==0&&J>0?y.getForTilePoints(oe,[ge],!0,ne):he.push(ge),y.getForTilePoints(o,he,!0,M),Math.max(he[0][2],he[1][2],ge[2])/y.exaggeration()};for(let q=0;q<4;q++){const Y=f.borderFeatureIndices[q];if(Y.length===0)continue;const re=r.cN[q](o),ne=D(re);if(!(ne&&ne instanceof r.cO)||f.borderDoneWithNeighborZ[q]===ne.canonical.z)continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();const oe=y?y.findDEMTileFor(re):null;if(!(oe&&oe.dem||b))continue;const H=(q<2?1:5)-q,J=ne.borderDoneWithNeighborZ[H]!==f.canonical.z,he=ne.borderFeatureIndices[H];let ce=0;if(f.canonical.z!==ne.canonical.z){for(const ge of Y)f.showCentroid(f.featuresOnBorder[ge]);if(J)for(const ge of he)ne.showCentroid(ne.featuresOnBorder[ge]);f.borderDoneWithNeighborZ[q]=ne.canonical.z,ne.borderDoneWithNeighborZ[H]=f.canonical.z}for(const ge of Y){const Ae=f.featuresOnBorder[ge],_e=f.centroidData[Ae.centroidDataIndex],Te=Ae.borders[q];let Pe;for(;ce<he.length;){Pe=ne.featuresOnBorder[he[ce]];const me=Pe.borders[H];if(me[1]>Te[0]+3||me[0]>Te[0]-3)break;ne.showCentroid(Pe),ce++}if(Pe&&ce<he.length){const me=ce;let be=0;for(;!(Pe.borders[H][0]>Te[1]-3)&&(be++,++ce!==he.length);)Pe=ne.featuresOnBorder[he[ce]];if(Pe=ne.featuresOnBorder[he[me]],be>1){const Se=Pe.borders[H];Math.abs(Te[0]-Se[0])<3&&Math.abs(Te[1]-Se[1])<3&&(be=1,ce=me+1)}else if(be===0){f.showCentroid(Ae);continue}const Ze=ne.centroidData[Pe.centroidDataIndex];b&&be===1&&(((U=_e).flags|($=Ze).flags)&r.cP?(U.flags|=r.cP,$.flags|=r.cP):(U.flags&=~r.cP,$.flags&=~r.cP));const ye=Ae.intersectsCount()>1||Pe.intersectsCount()>1;if(be>1)ce=me,_e.centroidXY=Ze.centroidXY=new r.P(0,0);else if(oe&&oe.dem&&!ye){const Se=N[q](_e,Ze),Ie=q%2?r.Y-1:0,se=G(Se[0],Math.min(r.Y-1,Se[1]),Ie,oe,re,q<2,Se[2]);_e.centroidXY=Ze.centroidXY=I(se)}else ye?_e.centroidXY=Ze.centroidXY=new r.P(0,0):(_e.centroidXY=f.encodeBorderCentroid(Ae),Ze.centroidXY=ne.encodeBorderCentroid(Pe));f.writeCentroidToBuffer(_e),ne.writeCentroidToBuffer(Ze)}else f.showCentroid(Ae)}f.borderDoneWithNeighborZ[q]=ne.canonical.z,ne.borderDoneWithNeighborZ[H]=f.canonical.z}var U,$;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(h)}const nd=[1,0,0],Tp=[0,1,0],Tu=[0,0,1];function Zs(h,n,o){const f=o.transform,_=o.shadowRenderer;if(!_)return!0;const y=h.toUnwrapped(),b=f.tileSize*_._cascades[o.currentShadowCascade].scale;let M=n.maxHeight;if(f.elevation){const U=f.elevation.getMinMaxForTile(h);U&&(M+=U.max)}const I=[..._.shadowDirection];I[2]=-I[2];const D=_.computeSimplifiedTileShadowVolume(y,M,b,I);if(!D)return!1;const z=[nd,Tp,Tu,I,[I[0],0,I[2]],[0,I[1],I[2]]],k=f.projection.name==="globe",F=f.scaleZoom(b),N=r.bt.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,F,!k),G=_.getCurrentCascadeFrustum();return N.intersectsPrecise(D.vertices,D.planes,z)===0||G.intersectsPrecise(D.vertices,D.planes,z)===0}function Mu(h){return[h[0]*r.cS,h[1]*r.cS,h[2]*r.cS,0]}function Qs(h,n,o,f,_,y,b,M,I){const D=f.getSource(),z=o.globeSharedBuffers;if(!z)return;let k,F,N;if(n&&(k=f.getTile(n)),D instanceof r.as?(F=D.texture,N=r.co(0,0,o.transform)):k&&n&&(F=k.texture,N=r.co(n.canonical.z,n.canonical.x,o.transform)),!F||!N)return;h||(N=r.a9.scale(r.a9.create(),N,[1,-1,1]));const G=o.context,U=G.gl,$=_.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,q=o.colorModeForDrapableLayerRenderPass(y),Y=b.defines;Y.push("GLOBE_POLES");const re=new Vt(U.LEQUAL,Vt.ReadWrite,o.depthRangeFor3D),ne=Float32Array.from(o.transform.expandedFarZProjMatrix),oe=Float32Array.from(r.aW(r.cn(new r.bv(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),G.activeTexture.set(U.TEXTURE0),F.bind($,U.CLAMP_TO_EDGE),G.activeTexture.set(U.TEXTURE1),F.bind($,U.CLAMP_TO_EDGE),F.useMipmap&&G.extTextureFilterAnisotropic&&o.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const[H,J,he,ce]=n?z.getPoleBuffers(n.canonical.z,!1):z.getPoleBuffers(0,!0),ge=_.paint.get("raster-elevation");let Ae;h?(Ae=H,o.renderDefaultNorthPole=ge!==0):(Ae=J,o.renderDefaultSouthPole=ge!==0);const _e=Mu(b.mix),Te=((me,be,Ze,ye,Se,Ie,se,je,vt,At,Ot,Pt,Bt)=>vp(me,be,Ze,new Float32Array(16),new Float32Array(9),[0,0],ye,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ie,[0,0],je,2,At,Ot,Pt,1,0,Bt))(ne,oe,N,r.W(o.transform.zoom),0,_,0,ge,0,_e,b.offset,b.range,y),Pe=o.getOrCreateProgram("raster",{defines:Y});o.uploadCommonUniforms(G,Pe,null),Pe.draw(o,U.TRIANGLES,re,I,q,M,Te,_.id,Ae,he,ce)}function Su(h){const n=h._nearZ,o=h.projection.farthestPixelDistance(h),f=o-n,_=.2*h.height,y=n+_;return[n,o,(y-_-n)/f,(y-n)/f]}function Aa(h,n,o,f){if(h)return n instanceof ot&&h instanceof Zc?n.getTextureDescriptor(h,o,!0):{texture:h.texture,mix:Mu(f.mix),offset:f.offset,buffer:0,tileSize:1}}function wg(h,n,o){if(!h)return null;const f=n.getTextureDescriptor(h,o,!0);if(!f)return null;let{texture:_,mix:y,offset:b,tileSize:M,buffer:I,format:D}=f;if(!_||!D)return null;let z=!1;return D==="uint32"&&(z=!0,y[3]=0,y=Vl(r.cT,y,[0,o.paint.get("raster-particle-max-speed")]),b=Xh(r.cT,b,[0,o.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[I/(M+2*I),M/(M+2*I)],tileSize:M,scalarData:z,scale:y,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function Tg(h){const n=h._nearZ,o=h.projection.farthestPixelDistance(h),f=o-n,_=.2*h.height,y=n+_;return[n,o,(y-_-n)/f,(y-n)/f]}const rd=new r.aA(1,0,0,1),Mg=new r.aA(0,1,0,1),Mp=new r.aA(0,0,1,1),Sp=new r.aA(1,0,1,1),sd=new r.aA(0,1,1,1);function Ia(h,n,o,f,_,y,b){const M=h.context,I=h.transform,D=M.gl,z=I.projection.name==="globe",k=z?["PROJECTION_GLOBE_VIEW"]:[];let F=r.a9.clone(o.projMatrix);if(z&&r.W(I.zoom)>0){const _e=r.aV(o.canonical,I),Te=r.cU(_e);F=r.a9.multiply(new Float32Array(16),I.globeMatrix,Te),r.a9.multiply(F,I.projMatrix,F)}const N=r.a9.create();N[12]+=2*_/(r.f.devicePixelRatio*I.width),N[13]+=2*y/(r.f.devicePixelRatio*I.height),r.a9.multiply(F,N,F);const G=h.getOrCreateProgram("debug",{defines:k}),U=n.getTileByID(o.key);h.terrain&&h.terrain.setupElevationDraw(U,G);const $=Vt.disabled,q=Xt.disabled,Y=h.colorModeForRenderPass(),re="$debug";M.activeTexture.set(D.TEXTURE0),h.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),z?U._makeGlobeTileDebugBuffers(h.context,I):U._makeDebugTileBoundsBuffers(h.context,I.projection);const ne=U._tileDebugBuffer||h.debugBuffer,oe=U._tileDebugIndexBuffer||h.debugIndexBuffer,H=U._tileDebugSegments||h.debugSegments;if(G.draw(h,D.LINE_STRIP,$,q,Y,Wt.disabled,Qh(F,f),re,ne,oe,H,null,null,null,[U._globeTileDebugBorderBuffer]),b){const _e=U.latestRawTileData,Te=Math.floor((_e&&_e.byteLength||0)/1024);let Pe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Pe+=` => ${o.overscaledZ}`),Pe+=` ${U.state}`,Pe+=` ${Te}kb`,function(me,be){me.initDebugOverlayCanvas();const Ze=me.debugOverlayCanvas,ye=me.context.gl,Se=me.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,Ze.width,Ze.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(be,5,5),Se.strokeText(be,5,5),me.debugOverlayTexture.update(Ze),me.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(h,Pe)}const J=n.getTile(o).tileSize,he=512/Math.min(J,512)*(o.overscaledZ/I.zoom)*.5,ce=U._tileDebugTextBuffer||h.debugBuffer,ge=U._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Ae=U._tileDebugTextSegments||h.debugSegments;G.draw(h,D.TRIANGLES,$,q,ci.alphaBlended,Wt.disabled,Qh(F,r.aA.transparent,he),re,ce,ge,Ae,null,null,null,[U._globeTileDebugTextBuffer])}function Ep(h,n,o,f){Eu(h,0,n+o/2,h.transform.width,o,f)}function Ap(h,n,o,f){Eu(h,n-o/2,0,o,h.transform.height,f)}function Eu(h,n,o,f,_,y){const b=h.context,M=b.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*r.f.devicePixelRatio,o*r.f.devicePixelRatio,f*r.f.devicePixelRatio,_*r.f.devicePixelRatio),b.clear({color:y}),M.disable(M.SCISSOR_TEST)}const Ip=r.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sg}=Ip;function ys(h,n,o,f){h.emplaceBack(n,o,f)}class Cp{constructor(n){this.vertexArray=new r.cV,this.indices=new r.az,ys(this.vertexArray,-1,-1,1),ys(this.vertexArray,1,-1,1),ys(this.vertexArray,-1,1,1),ys(this.vertexArray,1,1,1),ys(this.vertexArray,-1,-1,-1),ys(this.vertexArray,1,-1,-1),ys(this.vertexArray,-1,1,-1),ys(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Sg),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.aE.simpleSegment(0,0,36,12)}}function Ho(h,n,o,f,_,y){const b=h.context.gl,M=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),D=n.paint.get("sky-atmosphere-sun-intensity"),z=((k,F,N,G,U)=>({u_matrix_3f:k,u_sun_direction:F,u_sun_intensity:N,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(r.ct.fromMat4(r.ct.create(),f),_,D,M,I);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,n.skyboxTexture,0),o.draw(h,b.TRIANGLES,Vt.disabled,Xt.disabled,ci.unblended,Wt.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const od=r.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Au{constructor(n){const o=new r.cW;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const f=new r.az;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(o,od.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=r.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ad=r.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Zo{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ld{constructor(n){this.colorModeAlphaBlendedWriteRGB=new ci([1,Wc,1,Wc],r.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ci([1,0,1,0],r.aA.transparent,[!1,!1,!1,!0]),this.params=new Zo,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const o=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Au(o);const f=this.params.sizeRange,_=this.params.intensityRange,y=function(z){const k=r.aC(30),F=[];for(let N=0;N<z;++N){const G=2*Math.PI*k(),U=Math.acos(1-2*k())-.5*Math.PI;F.push(r.Q.fromValues(Math.cos(U)*Math.cos(G),Math.cos(U)*Math.sin(G),Math.sin(U)))}return F}(this.params.starsCount),b=r.aC(300),M=new r.cX,I=new r.az;let D=0;for(let z=0;z<y.length;++z){const k=r.Q.scale([],y[z],200),F=Math.max(0,1+.01*f*(1*b()-.5)),N=Math.max(0,1+.01*_*(1*b()-.5));M.emplaceBack(k[0],k[1],k[2],-1,-1,F,N),M.emplaceBack(k[0],k[1],k[2],1,-1,F,N),M.emplaceBack(k[0],k[1],k[2],1,1,F,N),M.emplaceBack(k[0],k[1],k[2],-1,1,F,N),I.emplaceBack(D+0,D+1,D+2),I.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=o.createVertexBuffer(M,ad.members),this.starsIdx=o.createIndexBuffer(I),this.starsSegments=r.aE.simpleSegment(0,0,M.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,o){const f=n.context,_=f.gl,y=n.transform,b=new Vt(_.LEQUAL,Vt.ReadOnly,[0,1]),M=r.W(y.zoom),I=o.properties.get("color").toArray01(),D=o.properties.get("high-color").toArray01(),z=o.properties.get("space-color").toArray01PremultipliedAlpha(),k=5e-4,F=r.cY(o.properties.get("horizon-blend"),0,1,k,.25),N=r.ci(n,f,y)&&F===k?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,G=n.frameCounter/1e3%1,U=r.Q.length(y.globeCenterInViewSpace),$=Math.sqrt(Math.pow(U,2)-Math.pow(N,2)),q=Math.acos($/U),Y=re=>{const ne=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];re&&ne.push("ALPHA_PASS");const oe=n.getOrCreateProgram("globeAtmosphere",{defines:ne}),H=((he,ce,ge,Ae,_e,Te,Pe,me,be,Ze,ye,Se)=>({u_frustum_tl:he,u_frustum_tr:ce,u_frustum_br:ge,u_frustum_bl:Ae,u_horizon:_e,u_transition:Te,u_fadeout_range:Pe,u_color:me,u_high_color:be,u_space_color:Ze,u_temporal_offset:ye,u_horizon_angle:Se}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,M,F,I,D,z,G,q);n.uploadCommonUniforms(f,oe);const J=this.atmosphereBuffer;J&&oe.draw(n,_.TRIANGLES,b,Xt.disabled,re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Wt.backCW,H,re?"atmosphere_glow_alpha":"atmosphere_glow",J.vertexBuffer,J.indexBuffer,J.segments)};Y(!1),Y(!0)}drawStars(n,o){const f=r.ad(o.properties.get("star-intensity"),0,1);if(f===0)return;const _=n.context,y=_.gl,b=n.transform,M=n.getOrCreateProgram("stars"),I=r.bl.identity([]);r.bl.rotateX(I,I,-b._pitch),r.bl.rotateZ(I,I,-b.angle),r.bl.rotateX(I,I,r.bm(b._center.lat)),r.bl.rotateY(I,I,-r.bm(b._center.lng));const D=r.a9.fromQuat(new Float32Array(16),I),z=r.a9.multiply([],b.starsProjMatrix,D),k=r.ct.fromMat4([],D),F=r.ct.invert([],k),N=[0,1,0];r.Q.transformMat3(N,N,F),r.Q.scale(N,N,this.params.sizeMultiplier);const G=[1,0,0];r.Q.transformMat3(G,G,F),r.Q.scale(G,G,this.params.sizeMultiplier);const U=($=N,q=G,Y=f,{u_matrix:Float32Array.from(z),u_up:$,u_right:q,u_intensity_multiplier:Y});var $,q,Y;n.uploadCommonUniforms(_,M),this.starsVx&&this.starsIdx&&M.draw(n,y.TRIANGLES,Vt.disabled,Xt.disabled,this.colorModeAlphaBlendedWriteRGB,Wt.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function cd(h,n){const o=[...h],f=n.cameraWorldSizeForFog/n.worldSize,_=r.a9.identity([]);return r.a9.scale(_,_,[f,f,1]),r.a9.multiply(o,_,o),r.a9.multiply(o,n.worldToFogMatrix,o),o}function xo(h,n,o,f){const _=o.material,y=f.context,{baseColorTexture:b,metallicRoughnessTexture:M}=_.pbrMetallicRoughness,{normalTexture:I,occlusionTexture:D,emissionTexture:z}=_;function k(F,N,G){if(F&&(h.push(N),y.activeTexture.set(y.gl.TEXTURE0+G),F.gfxTexture)){const{minFilter:U,magFilter:$,wrapS:q,wrapT:Y}=F.sampler;F.gfxTexture.bindExtraParam(U,$,q,Y)}}k(b,"HAS_TEXTURE_u_baseColorTexture",Pr.BaseColor),k(M,"HAS_TEXTURE_u_metallicRoughnessTexture",Pr.MetallicRoughness),k(I,"HAS_TEXTURE_u_normalTexture",Pr.Normal),k(D,"HAS_TEXTURE_u_occlusionTexture",Pr.Occlusion),k(z,"HAS_TEXTURE_u_emissionTexture",Pr.Emission),o.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(o.texcoordBuffer)),o.colorBuffer&&(h.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(o.colorBuffer)),o.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(o.normalBuffer)),o.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(o.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES")}function vo(h,n,o,f,_,y){const b=o.paint.get("model-opacity"),M=n.context,I=new Vt(n.context.gl.LEQUAL,Vt.ReadWrite,n.depthRangeFor3D),D=n.transform,z=h.mesh,k=z.material,F=k.pbrMetallicRoughness,N=n.style.fog;let G;G=n.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:r.a9.multiply([],f.zScaleMatrix,h.nodeModelMatrix),r.a9.multiply(G,f.negCameraPosMatrix,G);const U=r.a9.invert([],G);r.a9.transpose(U,U);const $=o.paint.get("model-emissive-strength").constantOr(0),q=vu(new Float32Array(h.worldViewProjection),new Float32Array(G),new Float32Array(U),null,n,b,F.baseColorFactor,k.emissiveFactor,F.metallicFactor,F.roughnessFactor,k,$,o),Y={defines:[]},re=[];xo(Y.defines,re,z,n);const ne=n.shadowRenderer;ne&&(ne.useNormalOffset=!1);let oe=null;if(N){const he=cd(h.nodeModelMatrix,n.transform);if(oe=new Float32Array(he),D.projection.name!=="globe"){const ce=z.aabb.min,ge=z.aabb.max,[Ae,_e]=N.getOpacityForBounds(he,ce[0],ce[1],ge[0],ge[1]);Y.overrideFog=Ae>=Oi||_e>=Oi}}const H=po(n,o.paint.get("model-cutoff-fade-range"));H.shouldRenderCutoff&&Y.defines.push("RENDER_CUTOFF");const J=n.getOrCreateProgram("model",Y);n.uploadCommonUniforms(M,J,null,oe,H),n.renderPass!=="shadow"&&ne&&ne.setupShadowsFromMatrix(h.nodeModelMatrix,J),J.draw(n,M.gl.TRIANGLES,I,_,y,z.material.doubleSided?Wt.disabled:Wt.backCCW,q,o.id,z.vertexBuffer,z.indexBuffer,z.segments,o.paint,n.transform.zoom,void 0,re)}function Wl(h,n,o,f,_,y,b){let M;M=h.projection.name==="globe"?r.c_(o,h):[...o],r.a9.multiply(M,M,n.matrix);const I=r.a9.multiply([],f,M);if(n.meshes)for(const D of n.meshes){if(D.material.alphaMode!=="BLEND"){b.push({mesh:D,depth:0,modelIndex:_,worldViewProjection:I,nodeModelMatrix:M});continue}const z=r.Q.transformMat4([],D.centroid,I);z[2]>0&&y.push({mesh:D,depth:z[2],modelIndex:_,worldViewProjection:I,nodeModelMatrix:M})}if(n.children)for(const D of n.children)Wl(h,D,o,f,_,y,b)}function Hl(h,n,o,f){const _=o.shadowRenderer;if(!_)return;const y=_.getShadowPassDepthMode(),b=_.getShadowPassColorMode(),M=_.calculateShadowPassMatrixFromMatrix(n),I=bp(M);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,y,Xt.disabled,b,Wt.backCCW,I,f.id,h.vertexBuffer,h.indexBuffer,h.segments,f.paint,o.transform.zoom,void 0,void 0)}function Zl(h,n,o){const f=n.updateZoomBasedPaintProperties(),_=function(y,b,M){let I,D,z,k=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&k>0){const F=y.terrain,N=F.findDEMTileFor(M);N&&N.dem?I=r.d0.create(F,M,N):k=0}if(k===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),k===b.validForExaggeration&&(k===0||I&&I._demTile&&I._demTile.tileID===b.validForDEMTile.id&&I._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const F in b.instancesPerModel){const N=b.instancesPerModel[F];for(let G=0;G<N.instancedDataArray.length;++G){const U=(I?k*I.getElevationAt(0|N.instancedDataArray.float32[16*G],0|N.instancedDataArray.float32[16*G+1],!0,!0):0)+N.instancesEvaluatedElevation[G];N.instancedDataArray.float32[16*G+6]=U,D=D?Math.min(b.terrainElevationMin,U):U,z=z?Math.max(b.terrainElevationMax,U):U}}return b.terrainElevationMin=D||0,b.terrainElevationMax=z||0,b.validForExaggeration=k,b.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,n,o);(f||_)&&(n.uploaded=!1,n.upload(h.context))}const Gr={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.bV([0,0,0],[r.Y,r.Y,0])};function Iu(h,n){const o=1<<h.canonical.z,f=n.getFreeCameraOptions().position,_=n.elevation,y=h.canonical.x/o,b=(h.canonical.x+1)/o,M=h.canonical.y/o,I=(h.canonical.y+1)/o;let D=n._centerAltitude;if(_){const N=_.getMinMaxForTile(h);N&&N.max>D&&(D=N.max)}const z=r.ad(f.x,y,b)-f.x,k=r.ad(f.y,M,I)-f.y,F=r.bo(D,n.center.lat)-f.z;return n._zoomFromMercatorZ(Math.sqrt(z*z+k*k+F*F))}function Cu(h,n,o,f,_,y,b){const M=h.context,I=h.renderPass==="shadow",D=h.shadowRenderer,z=I&&D?D.getShadowPassDepthMode():new Vt(M.gl.LEQUAL,Vt.ReadWrite,h.depthRangeFor3D),k=h.isTileAffectedByFog(y);if(o.meshes)for(const F of o.meshes){const N=["MODEL_POSITION_ON_GPU"],G=[];let U,$,q;f.instancedDataArray.length>20&&N.push("INSTANCED_ARRAYS");const Y=po(h,n.paint.get("model-cutoff-fade-range"));if(Y.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),I&&D)U=h.getOrCreateProgram("modelDepth",{defines:N}),$=bp(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(o.matrix)),q=D.getShadowPassColorMode();else{xo(N,G,F,h),U=h.getOrCreateProgram("model",{defines:N,overrideFog:k});const ne=F.material,oe=ne.pbrMetallicRoughness,H=n.paint.get("model-opacity"),J=n.paint.get("model-emissive-strength").constantOr(0);$=vu(y.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,h,H,oe.baseColorFactor,ne.emissiveFactor,oe.metallicFactor,oe.roughnessFactor,ne,J,n,_),D&&(b.shadowUniformsInitialized?U.setShadowUniformValues(M,D.getShadowUniformValues()):(D.setupShadows(y.toUnwrapped(),U,"model-tile",y.overscaledZ),b.shadowUniformsInitialized=!0)),q=Y.shouldRenderCutoff||H<1||ne.alphaMode!=="OPAQUE"?ci.alphaBlended:ci.unblended}h.uploadCommonUniforms(M,U,y.toUnwrapped(),null,Y);const re=F.material.doubleSided?Wt.disabled:Wt.backCCW;if(f.instancedDataArray.length>20)G.push(f.instancedDataBuffer),U.draw(h,M.gl.TRIANGLES,z,Xt.disabled,q,re,$,n.id,F.vertexBuffer,F.indexBuffer,F.segments,n.paint,h.transform.zoom,void 0,G,f.instancedDataArray.length);else{const ne=I?"u_instance":"u_normal_matrix";for(let oe=0;oe<f.instancedDataArray.length;++oe)$[ne]=new Float32Array(f.instancedDataArray.arrayBuffer,64*oe,16),U.draw(h,M.gl.TRIANGLES,z,Xt.disabled,q,re,$,n.id,F.vertexBuffer,F.indexBuffer,F.segments,n.paint,h.transform.zoom,void 0,G)}}if(o.children)for(const F of o.children)Cu(h,n,F,f,_,y,b)}const Pu=[1,-1,1];function Ql(h,n,o,f){if(!o.modelManager)return!0;const _=o.modelManager;if(!o.shadowRenderer)return!0;const y=o.shadowRenderer,b=n.aabb;let M=!0,I=h.maxHeight;if(I===0){let z=0;for(const k in h.instancesPerModel){const F=_.getModel(k,f);F?z=Math.max(z,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):M=!1}I=h.maxScale*z*1.41+h.maxVerticalOffset,M&&(h.maxHeight=I)}b.max[2]=I,b.min[2]+=h.terrainElevationMin,b.max[2]+=h.terrainElevationMax,r.Q.transformMat4(b.min,b.min,n.tileMatrix),r.Q.transformMat4(b.max,b.max,n.tileMatrix);const D=b.intersects(y.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=D===2),D===0}class Pp{}class Dp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,o,f){{const k=this._storage.get(o.id);if(k)return k.lastUsedFrameIdx=n,k.buf}const _=f.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),b=new ArrayBuffer(y),M=new Int16Array(b);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const I=new r.d2;for(let k=0;k<y/2;k+=3){const F=M[k],N=M[k+1],G=M[k+2];I.emplaceBack(F,N),I.emplaceBack(N,G),I.emplaceBack(G,F)}const D=f.bindVertexArrayOES.current,z=new Pp;return z.buf=new Ji(f,I),z.lastUsedFrameIdx=n,this._storage.set(o.id,z),f.bindVertexArrayOES.set(D),z.buf}update(n){for(const[o,f]of this._storage)n-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(o))}destroy(){for(const[n,o]of this._storage)o.buf.destroy(),this._storage.delete(n)}}const Du={symbol:function(h,n,o,f,_){if(h.renderPass!=="translucent")return;const y=Xt.disabled,b=h.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(D,z,k,F,N,G,U){const $=z.transform,q=N==="map",Y=G==="map";for(const re of D){const ne=F.getTile(re),oe=ne.getBucket(k);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const H=r.b8(oe.textSizeData,$.zoom),J=tu(re,oe.getProjection(),$),he=$.calculatePixelsToTileUnitsMatrix(ne),ce=wl(J,ne.tileID.canonical,Y,q,$,oe.getProjection(),he),ge=oe.hasIconTextFit()&&oe.hasIconData();if(H){const Ae=Math.pow(2,$.zoom-ne.tileID.overscaledZ);wp(oe,q,Y,U,r.cE,$,ce,re,Ae,H,ge)}}}(f,h,o,n,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),_);const M=o.paint.get("icon-opacity").constantOr(1)!==0,I=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(M||I)?ql(h,n,o,f,y,b):(M&&ql(h,n,o,f,y,b,{onlyIcons:!0}),I&&ql(h,n,o,f,y,b,{onlyText:!0})),n.map.showCollisionBoxes&&(ed(h,n,o,f,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),ed(h,n,o,f,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(h,n,o,f){if(h.renderPass!=="translucent")return;const _=o.paint.get("circle-opacity"),y=o.paint.get("circle-stroke-width"),b=o.paint.get("circle-stroke-opacity"),M=o.layout.get("circle-sort-key").constantOr(1)!==void 0,I=o.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const D=h.context,z=D.gl,k=h.transform,F=h.depthModeForSublayer(0,Vt.ReadOnly),N=Xt.disabled,G=h.colorModeForDrapableLayerRenderPass(I),U=k.projection.name==="globe",$=[r.a8(k.center.lng),r.ah(k.center.lat)],q=[];for(let re=0;re<f.length;re++){const ne=f[re],oe=n.getTile(ne),H=oe.getBucket(o);if(!H||H.projection.name!==k.projection.name)continue;const J=H.programConfigurations.get(o.id),he=r.cF(o),ce=h.isTileAffectedByFog(ne);U&&he.push("PROJECTION_GLOBE_VIEW");const ge=h.getOrCreateProgram("circle",{config:J,defines:he,overrideFog:ce}),Ae=H.layoutVertexBuffer,_e=H.globeExtVertexBuffer,Te=H.indexBuffer,Pe=k.projection.createInversionMatrix(k,ne.canonical),me={programConfiguration:J,program:ge,layoutVertexBuffer:Ae,globeExtVertexBuffer:_e,indexBuffer:Te,uniformValues:r.cG(h,ne,oe,Pe,$,o),tile:oe};if(M){const be=H.segments.get();for(const Ze of be)q.push({segments:new r.aE([Ze]),sortKey:Ze.sortKey,state:me})}else q.push({segments:H.segments,sortKey:0,state:me})}M&&q.sort((re,ne)=>re.sortKey-ne.sortKey);const Y={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const re of q){const{programConfiguration:ne,program:oe,layoutVertexBuffer:H,globeExtVertexBuffer:J,indexBuffer:he,uniformValues:ce,tile:ge}=re.state,Ae=re.segments;h.terrain&&h.terrain.setupElevationDraw(ge,oe,Y),h.uploadCommonUniforms(D,oe,ge.tileID.toUnwrapped()),oe.draw(h,z.TRIANGLES,F,N,G,Wt.disabled,ce,o.id,H,he,Ae,o.paint,k.zoom,ne,[J])}},heatmap:function(h,n,o,f){if(o.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,y=_.gl,b=Xt.disabled,M=new ci([y.ONE,y.ONE,y.ONE,y.ONE],r.aA.transparent,[!0,!0,!0,!0]);(function(N,G,U,$){const q=N.gl,Y=G.width*$,re=G.height*$;N.activeTexture.set(q.TEXTURE1),N.viewport.set([0,0,Y,re]);let ne=U.heatmapFbo;if(!ne||ne&&(ne.width!==Y||ne.height!==re)){ne&&ne.destroy();const oe=q.createTexture();q.bindTexture(q.TEXTURE_2D,oe),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),ne=U.heatmapFbo=N.createFramebuffer(Y,re,!0,null),function(H,J,he,ce,ge,Ae){const _e=H.gl;_e.texImage2D(_e.TEXTURE_2D,0,H.extRenderToTextureHalfFloat?_e.RGBA16F:_e.RGBA,ge,Ae,0,_e.RGBA,H.extRenderToTextureHalfFloat?_e.HALF_FLOAT:_e.UNSIGNED_BYTE,null),ce.colorAttachment.set(he)}(N,0,oe,ne,Y,re)}else q.bindTexture(q.TEXTURE_2D,ne.colorAttachment.get()),N.bindFramebuffer.set(ne.framebuffer)})(_,h,o,h.transform.projection.name==="globe"?.5:.25),_.clear({color:r.aA.transparent});const I=h.transform,D=I.projection.name==="globe",z=D?["PROJECTION_GLOBE_VIEW"]:[],k=D?Wt.frontCCW:Wt.disabled,F=[r.a8(I.center.lng),r.ah(I.center.lat)];for(let N=0;N<f.length;N++){const G=f[N];if(n.hasRenderableParent(G))continue;const U=n.getTile(G),$=U.getBucket(o);if(!$||$.projection.name!==I.projection.name)continue;const q=h.isTileAffectedByFog(G),Y=$.programConfigurations.get(o.id),re=h.getOrCreateProgram("heatmap",{config:Y,defines:z,overrideFog:q}),{zoom:ne}=h.transform;h.terrain&&h.terrain.setupElevationDraw(U,re),h.uploadCommonUniforms(_,re,G.toUnwrapped());const oe=I.projection.createInversionMatrix(I,G.canonical);re.draw(h,y.TRIANGLES,Vt.disabled,b,M,k,gg(h,G,U,oe,F,ne,o.paint.get("heatmap-intensity")),o.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,o.paint,h.transform.zoom,Y,D?[$.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,y){const b=_.context,M=b.gl,I=y.heatmapFbo;if(!I)return;b.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,I.colorAttachment.get()),b.activeTexture.set(M.TEXTURE1);let D=y.colorRampTexture;D||(D=y.colorRampTexture=new r.T(b,y.colorRamp,M.RGBA)),D.bind(M.LINEAR,M.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,M.TRIANGLES,Vt.disabled,Xt.disabled,_.colorModeForRenderPass(),Wt.disabled,((z,k,F,N)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(h,o))},line:function(h,n,o,f){if(h.renderPass!=="translucent")return;const _=o.paint.get("line-opacity"),y=o.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const b=o.paint.get("line-emissive-strength"),M=h.depthModeForSublayer(0,Vt.ReadOnly),I=h.colorModeForDrapableLayerRenderPass(b),D=h.terrain&&h.terrain.renderingToTexture?1:r.f.devicePixelRatio,z=o.paint.get("line-dasharray"),k=z.constantOr(1),F=o.layout.get("line-cap"),N=o.paint.get("line-pattern"),G=N.constantOr(1),U=o.paint.get("line-opacity").constantOr(1)!==1;let $=!G&&U;const q=o.paint.get("line-gradient"),Y=G?"linePattern":"line",re=h.context,ne=re.gl,oe=r.cH(o);h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&($=!1);for(const H of f){const J=n.getTile(H);if(G&&!J.patternsLoaded())continue;const he=J.getBucket(o);if(!he)continue;h.prepareDrawTile();const ce=he.programConfigurations.get(o.id),ge=h.isTileAffectedByFog(H),Ae=h.getOrCreateProgram(Y,{config:ce,defines:oe,overrideFog:ge}),_e=N.constantOr(null);if(_e&&J.imageAtlas){const Ie=J.imageAtlas.patternPositions[_e.toString()];Ie&&ce.setConstantPatternPositions(Ie)}const Te=z.constantOr(null),Pe=F.constantOr(null);if(!G&&Te&&Pe&&J.lineAtlas){const Ie=J.lineAtlas.getDash(Te,Pe);Ie&&ce.setConstantPatternPositions(Ie)}let[me,be]=o.paint.get("line-trim-offset");(Pe==="round"||Pe==="square")&&me!==be&&(me===0&&(me-=1),be===1&&(be+=1));const Ze=h.terrain?H.projMatrix:null,ye=G?r.cI(h,J,o,Ze,D,[me,be]):r.cJ(h,J,o,Ze,he.lineClipsArray.length,D,[me,be]);if(q){const Ie=he.gradients[o.id];let se=Ie.texture;if(o.gradientVersion!==Ie.version){let je=256;if(o.stepInterpolant){const vt=n.getSource().maxzoom,At=H.canonical.z===vt?Math.ceil(1<<h.transform.maxZoom-H.canonical.z):1;je=r.ad(r.cK(he.maxLineLength/r.Y*1024*At),256,re.maxTextureSize)}Ie.gradient=r.cL({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:je,image:Ie.gradient||void 0,clips:he.lineClipsArray}),Ie.texture?Ie.texture.update(Ie.gradient):Ie.texture=new r.T(re,Ie.gradient,ne.RGBA),Ie.version=o.gradientVersion,se=Ie.texture}re.activeTexture.set(ne.TEXTURE1),se.bind(o.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}k&&(re.activeTexture.set(ne.TEXTURE0),J.lineAtlasTexture&&J.lineAtlasTexture.bind(ne.LINEAR,ne.REPEAT),ce.updatePaintBuffers()),G&&(re.activeTexture.set(ne.TEXTURE0),J.imageAtlasTexture&&J.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),ce.updatePaintBuffers()),h.uploadCommonUniforms(re,Ae,H.toUnwrapped());const Se=Ie=>{Ae.draw(h,ne.TRIANGLES,M,Ie,I,Wt.disabled,ye,o.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,o.paint,h.transform.zoom,ce,[he.layoutVertexBuffer2,he.patternVertexBuffer])};if($){const Ie=h.stencilModeForClipping(H).ref;Ie===0&&h.terrain&&re.clear({stencil:0});const se={func:ne.EQUAL,mask:255};ye.u_alpha_discard_threshold=.8,Se(new Xt(se,Ie,255,ne.KEEP,ne.KEEP,ne.INVERT)),ye.u_alpha_discard_threshold=0,Se(new Xt(se,Ie,255,ne.KEEP,ne.KEEP,ne.KEEP))}else Se(h.stencilModeForClipping(H))}$&&(h.resetStencilClippingMasks(),h.terrain&&re.clear({stencil:0}))},fill:function(h,n,o,f){const _=o.paint.get("fill-color"),y=o.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=o.paint.get("fill-emissive-strength"),M=h.colorModeForDrapableLayerRenderPass(b),I=o.paint.get("fill-pattern"),D=h.opaquePassEnabledForLayer()&&!I.constantOr(1)&&_.constantOr(r.aA.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===D){const z=h.depthModeForSublayer(1,h.renderPass==="opaque"?Vt.ReadWrite:Vt.ReadOnly);wu(h,n,o,f,z,M,!1)}if(h.renderPass==="translucent"&&o.paint.get("fill-antialias")){const z=h.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);wu(h,n,o,f,z,M,!0)}},"fill-extrusion":function(h,n,o,f){const _=o.paint.get("fill-extrusion-opacity"),y=h.context,b=y.gl,M=h.terrain,I=M&&M.renderingToTexture;if(_===0)return;const D=h.conflationActive&&h.layerUsedInConflation(o,n.getSource());if(D&&function(z,k,F,N){for(const G of N){const U=k.getTile(G).getBucket(F);U&&(U.updateReplacement(G,z.replacementSource),U.uploadCentroid(z.context))}}(h,n,o,f),M||D)for(const z of f){const k=n.getTile(z).getBucket(o);k&&id(h.context,n,z,k,o,M,D)}if(h.renderPass==="shadow"&&h.shadowRenderer){const z=h.shadowRenderer;if(M&&_<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;const k=z.getShadowPassDepthMode(),F=z.getShadowPassColorMode();ut(h,n,o,f,k,Xt.disabled,F,D)}else if(h.renderPass==="translucent"){const z=!o.paint.get("fill-extrusion-pattern").constantOr(1),k=o.paint.get("fill-extrusion-color").constantOr(r.aA.white);if(!I&&k.a!==0){const F=new Vt(h.context.gl.LEQUAL,Vt.ReadWrite,h.depthRangeFor3D);_===1&&z?ut(h,n,o,f,F,Xt.disabled,ci.unblended,D):(ut(h,n,o,f,F,Xt.disabled,ci.disabled,D),ut(h,n,o,f,F,h.stencilModeFor3D(),h.colorModeForRenderPass(),D),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&z&&(!M&&h.transform.projection.name!=="globe"||I)){const F=o.paint.get("fill-extrusion-opacity"),N=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),U=o.paint.get("fill-extrusion-flood-light-intensity"),$=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),q=N>0&&G>0,Y=U>0,re=(oe,H,J)=>(1-J)*oe+J*H,ne=oe=>{const H=h.depthModeForSublayer(1,Vt.ReadOnly,b.LEQUAL,!0),J=o.paint.get(oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),he=re(.1,3,J),ce=h._showOverdrawInspector;if(!ce){const ge=new Xt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ae=new ci([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0],b.MIN);Wo(h,n,o,f,H,ge,Ae,Wt.disabled,oe,"sdf",F,N,G,U,$,he,D,!1)}{const ge=ce?Xt.disabled:new Xt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ae=ce?h.colorModeForRenderPass():new ci([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],r.aA.transparent,[!0,!0,!0,!0]);Wo(h,n,o,f,H,ge,Ae,Wt.disabled,oe,"color",F,N,G,U,$,he,D,!1)}};if(I){const oe=(H,J,he)=>{const ce=h.depthModeForSublayer(1,Vt.ReadOnly,b.LEQUAL,!1),ge=o.paint.get(H?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ae=re(.1,3,ge);{const _e=new ci([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0]);Wo(h,n,o,f,ce,Xt.disabled,_e,Wt.disabled,H,"clear",F,N,G,U,$,Ae,D,J)}{const _e=new Xt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Te=new ci([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0],b.MIN);Wo(h,n,o,f,ce,_e,Te,Wt.disabled,H,"sdf",F,N,G,U,$,Ae,D,J)}{const _e=H?b.ZERO:b.ONE_MINUS_DST_ALPHA,Te=new Xt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Pe=new ci([_e,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],r.aA.transparent,[!0,!0,!0,!0]);Wo(h,n,o,f,ce,Te,Pe,Wt.disabled,H,"color",F,N,G,U,$,Ae,D,J)}{const _e=new ci([b.ONE,b.ONE,b.ONE,H?b.ZERO:b.ONE],r.aA.transparent,[!1,!1,!1,!0],H?b.FUNC_ADD:b.MAX);Wo(h,n,o,f,ce,Xt.disabled,_e,Wt.disabled,H,"clear",F,N,G,U,$,Ae,D,J,he)}};if(q||Y){let H;if(h.prepareDrawTile(),M){const J=M.drapeBufferSize[0],he=M.drapeBufferSize[1];H=M.framebufferCopyTexture,H&&(!H||H.size[0]===J&&H.size[1]===he)||(H&&H.destroy(),H=M.framebufferCopyTexture=new r.T(y,new r.h({width:J,height:he}),b.RGBA)),H.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,0,0,J,he,0)}q&&oe(!0,!1,H),Y&&oe(!1,!0,H)}}else q&&ne(!0),Y&&ne(!1)}}},hillshade:function(h,n,o,f){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const _=h.context,y=h.terrain&&h.terrain.renderingToTexture,[b,M]=h.renderPass!=="translucent"||y?[{},f]:h.stencilConfigForOverlap(f);for(const I of M){const D=n.getTile(I);if(D.needsHillshadePrepare&&h.renderPass==="offscreen")ba(h,D,o);else if(h.renderPass==="translucent"){const z=h.depthModeForSublayer(0,Vt.ReadOnly),k=o.paint.get("hillshade-emissive-strength"),F=h.colorModeForDrapableLayerRenderPass(k),N=y&&h.terrain?h.terrain.stencilModeForRTTOverlap(I):b[I.overscaledZ];ki(h,I,D,o,z,N,F)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,n,o,f,_,y){if(h.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const b=h.transform.projection.name==="globe",M=o.paint.get("raster-elevation")!==0,I=M&&b;if(h.renderElevatedRasterBackface&&!I)return;const D=h.context,z=D.gl,k=n.getSource(),F=function(H,J,he,ce){const ge=J.paint.get("raster-color"),Ae=H.type==="raster-array",_e=[],Te=J.paint.get("raster-resampling"),Pe=J.paint.get("raster-color-mix");let me=J.paint.get("raster-color-range");const be=[Pe[0],Pe[1],Pe[2],0],Ze=Pe[3];let ye=Te==="nearest"?ce.NEAREST:ce.LINEAR;if(Ae&&(_e.push("RASTER_ARRAY"),ge||_e.push("RASTER_COLOR"),Te==="linear"&&_e.push("RASTER_ARRAY_LINEAR"),ye=ce.NEAREST,!me&&H.rasterLayers)){const Se=H.rasterLayers.find(({id:Ie})=>Ie===J.sourceLayer);Se&&Se.fields&&Se.fields.range&&(me=Se.fields.range)}if(me=me||[0,1],ge){_e.push("RASTER_COLOR"),he.activeTexture.set(ce.TEXTURE2),J.updateColorRamp(me);let Se=J.colorRampTexture;Se||(Se=J.colorRampTexture=new r.T(he,J.colorRamp,ce.RGBA)),Se.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}return{mix:be,range:me,offset:Ze,defines:_e,resampling:ye}}(k,o,D,z);if(k instanceof r.as&&!f.length&&!b)return;const N=o.paint.get("raster-emissive-strength"),G=h.colorModeForDrapableLayerRenderPass(N),U=h.terrain&&h.terrain.renderingToTexture,$=!h.options.moving,q=o.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(k instanceof r.as&&!f.length&&(k.onNorthPole||k.onSouthPole)){const H=M?h.stencilModeFor3D():Xt.disabled;return void Qs(!!k.onNorthPole,null,h,n,o,N,F,Wt.disabled,H)}if(!f.length)return;const[Y,re]=k instanceof r.as||U?[{},f]:h.stencilConfigForOverlap(f),ne=re[re.length-1].overscaledZ;I&&F.defines.push("PROJECTION_GLOBE_VIEW"),M&&F.defines.push("RENDER_CUTOFF");const oe=(H,J,he)=>{for(const ce of H){const ge=ce.toUnwrapped(),Ae=n.getTile(ce);if(U&&(!Ae||!Ae.hasData()))continue;D.activeTexture.set(z.TEXTURE0);const _e=Aa(Ae,k,o,F);if(!_e||!_e.texture)continue;const{texture:Te,mix:Pe,offset:me,tileSize:be,buffer:Ze}=_e;let ye,Se;U?(ye=Vt.disabled,Se=ce.projMatrix):M?(ye=new Vt(z.LEQUAL,Vt.ReadWrite,h.depthRangeFor3D),Se=b?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(ge,$)):(ye=h.depthModeForSublayer(ce.overscaledZ-ne,o.paint.get("raster-opacity")===1?Vt.ReadWrite:Vt.ReadOnly,z.LESS),Se=h.transform.calculateProjMatrix(ge,$));const Ie=h.terrain&&U?h.terrain.stencilModeForRTTOverlap(ce):Y[ce.overscaledZ],se=y?0:o.paint.get("raster-fade-duration");Ae.registerFadeDuration(se);const je=n.findLoadedParent(ce,0),vt=Go(Ae,je,n,h.transform,se);let At,Ot;h.terrain&&h.terrain.prepareDrawTile(),D.activeTexture.set(z.TEXTURE0),Te.bind(q,z.CLAMP_TO_EDGE),D.activeTexture.set(z.TEXTURE1),je?(je.texture&&je.texture.bind(q,z.CLAMP_TO_EDGE),At=Math.pow(2,je.tileID.overscaledZ-Ae.tileID.overscaledZ),Ot=[Ae.tileID.canonical.x*At%1,Ae.tileID.canonical.y*At%1]):Te.bind(q,z.CLAMP_TO_EDGE),Te.useMipmap&&D.extTextureFilterAnisotropic&&h.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const Pt=h.transform;let Bt;const _i=M?Su(Pt):[0,0,0,0];let Zt,xi,gi,cn,Vi,kn=0;if(I&&k instanceof r.as&&k.coordinates.length>3)Zt=Float32Array.from(r.aW(r.cn(new r.bv(0,0,0)))),xi=Float32Array.from(Pt.globeMatrix),gi=Float32Array.from(r.cj(Pt)),cn=[r.a8(Pt.center.lng),r.ah(Pt.center.lat)],Bt=k.elevatedGlobePerspectiveTransform,Vi=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const ri=r.ck(ce.canonical);kn=r.cl(ri.getCenter().lat),Zt=Float32Array.from(r.aW(r.cn(ce.canonical))),xi=Float32Array.from(Pt.globeMatrix),gi=Float32Array.from(r.cj(Pt)),cn=[r.a8(Pt.center.lng),r.ah(Pt.center.lat)],Bt=[0,0],Vi=Float32Array.from(r.cm(ce.canonical,ri,kn,Pt.worldSize/Pt._pixelsPerMercatorPixel))}else Bt=k instanceof r.as?k.perspectiveTransform:[0,0],Zt=new Float32Array(16),xi=new Float32Array(9),gi=new Float32Array(16),cn=[0,0],Vi=new Float32Array(9);const In=vp(Se,Zt,xi,gi,Vi,Ot||[0,0],r.W(h.transform.zoom),cn,_i,At||1,vt,o,Bt,M?o.paint.get("raster-elevation"):0,2,Pe,me,F.range,be,Ze,N),Xi=h.isTileAffectedByFog(ce),$i=h.getOrCreateProgram("raster",{defines:F.defines,overrideFog:Xi});if(h.uploadCommonUniforms(D,$i,ge),k instanceof r.as){const ri=k.elevatedGlobeVertexBuffer,oi=k.elevatedGlobeIndexBuffer;if(U||!b)k.boundsBuffer&&k.boundsSegments&&$i.draw(h,z.TRIANGLES,ye,Xt.disabled,G,Wt.disabled,In,o.id,k.boundsBuffer,h.quadTriangleIndexBuffer,k.boundsSegments);else if(ri&&oi){const nn=Pt.zoom<=r.bJ?k.elevatedGlobeSegments:k.getSegmentsForLongitude(Pt.center.lng);nn&&$i.draw(h,z.TRIANGLES,ye,Xt.disabled,G,J,In,o.id,ri,oi,nn)}}else if(I){ye=new Vt(z.LEQUAL,Vt.ReadOnly,h.depthRangeFor3D);const ri=h.globeSharedBuffers;if(ri){const[oi,nn,Yi]=ri.getGridBuffers(kn,!1);$i.draw(h,z.TRIANGLES,ye,he||Ie,h.colorModeForRenderPass(),J,In,o.id,oi,nn,Yi)}}else{const{tileBoundsBuffer:ri,tileBoundsIndexBuffer:oi,tileBoundsSegments:nn}=h.getTileBoundsBuffers(Ae);$i.draw(h,z.TRIANGLES,ye,Ie,G,Wt.disabled,In,o.id,ri,oi,nn)}}if(!(k instanceof r.as)&&I)for(const ce of H){const ge=ce.canonical.y===(1<<ce.canonical.z)-1;ce.canonical.y===0&&Qs(!0,ce,h,n,o,N,F,J,he||Xt.disabled),ge&&Qs(!1,ce,h,n,o,N,F,J===Wt.frontCW?Wt.backCW:Wt.frontCW,he||Xt.disabled)}};I?oe(re,h.renderElevatedRasterBackface?Wt.backCW:Wt.frontCW,h.stencilModeFor3D()):oe(re,Wt.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,n,o,f,_,y){h.renderPass==="offscreen"&&function(b,M,I,D){if(!D.length)return;const z=b.context,k=z.gl,F=M.getSource();if(!(F instanceof ot))return;const N=Math.ceil(Math.sqrt(I.paint.get("raster-particle-count")));let G=I.particleFramebuffer;G?G.width!==N&&(G.destroy(),G=I.particleFramebuffer=z.createFramebuffer(N,N,!0,null)):G=I.particleFramebuffer=z.createFramebuffer(N,N,!0,null);const U=[];for(const Y of D){const re=M.getTile(Y);if(!(re instanceof Zc))continue;const ne=wg(re,F,I);if(!ne)continue;const oe=[re.tileSize,re.tileSize];let H=I.tileFramebuffer;H||(H=I.tileFramebuffer=z.createFramebuffer(oe[0],oe[1],!0,null));let J=re.rasterParticleState;J||(J=re.rasterParticleState=new rp(z,Y,oe,N));const he=J.update(I.lastInvalidatedAt);J.particleTextureDimension!==N&&J.setParticleTextureDimension(Y,N);const ce=J.targetColorTexture;J.targetColorTexture=J.backgroundColorTexture,J.backgroundColorTexture=ce;const ge=J.particleTexture0;J.particleTexture0=J.particleTexture1,J.particleTexture1=ge,U.push([Y,ne,J,he])}if(U.length===0)return;const $=r.f.now(),q=I.previousDrawTimestamp?.001*($-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=$,I.hasColorMap()){z.activeTexture.set(k.TEXTURE0+2);let Y=I.colorRampTexture;Y||(Y=I.colorRampTexture=new r.T(z,I.colorRamp,k.RGBA)),Y.bind(k.LINEAR,k.CLAMP_TO_EDGE)}z.bindFramebuffer.set(I.tileFramebuffer.framebuffer),function(Y,re,ne){const oe=Y.context,H=oe.gl,J=re.tileFramebuffer;oe.activeTexture.set(H.TEXTURE0);const he={u_texture:0,u_opacity:1.05*(ge=re.paint.get("raster-particle-fade-opacity-factor"))/(ge+.05)},ce=Y.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ge;for(const Ae of ne){const[,,_e,Te]=Ae;J.colorAttachment.set(_e.targetColorTexture.texture),oe.viewport.set([0,0,J.width,J.height]),oe.clear({color:r.aA.transparent}),Te&&(_e.backgroundColorTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE),ce.draw(Y,H.TRIANGLES,Vt.disabled,Xt.disabled,ci.alphaBlended,Wt.disabled,he,re.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments))}}(b,I,U),function(Y,re,ne,oe){const H=Y.context,J=H.gl,he=ne.tileFramebuffer,ce=Y.transform.projection.name==="globe",ge=ne.paint.get("raster-particle-max-speed");for(const Ae of oe){const[_e,Te,Pe]=Ae;H.activeTexture.set(J.TEXTURE0+0),Te.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE),he.colorAttachment.set(Pe.targetColorTexture.texture);const me=Y.getOrCreateProgram("rasterParticleDraw",{defines:Te.defines,overrideFog:!1});H.activeTexture.set(J.TEXTURE0+1);const be=Te.scalarData?[]:[0,1,2,3].map(Se=>r.cN[Se](_e));be.push(_e);const Ze=_e.canonical.x,ye=_e.canonical.y;for(const Se of be){const Ie=re.getTile(ce?Se.wrapped():Se);if(!Ie)continue;const se=Ie.rasterParticleState;if(!se)continue;const je=Se.canonical.x+(1<<Se.canonical.z)*(Se.wrap-_e.wrap),vt=Se.canonical.y;se.particleTexture0.bind(J.NEAREST,J.CLAMP_TO_EDGE);const At=Ul(1,se.particleTexture0.size[0],[je-Ze,vt-ye],0,Te.texture.size,2,ge,Te.textureOffset,Te.scale,Te.offset);me.draw(Y,J.POINTS,Vt.disabled,Xt.disabled,ci.alphaBlended,Wt.disabled,At,ne.id,se.particleIndexBuffer,void 0,se.particleSegment)}}}(b,M,I,U),z.bindFramebuffer.set(I.particleFramebuffer.framebuffer),function(Y,re,ne,oe){const H=Y.context,J=H.gl,he=re.paint.get("raster-particle-max-speed"),ce=oe*re.paint.get("raster-particle-speed-factor")*.3,ge=function(_e){return Math.pow(_e,6)}(.01+1*re.paint.get("raster-particle-reset-rate-factor")),Ae=re.particleFramebuffer;H.viewport.set([0,0,Ae.width,Ae.height]);for(const _e of ne){const[,Te,Pe]=_e;H.activeTexture.set(J.TEXTURE0+0),Te.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE),H.activeTexture.set(J.TEXTURE0+1);const me=Pe.particleTexture0;me.bind(J.NEAREST,J.CLAMP_TO_EDGE);const be=xg(1,me.size[0],0,Te.texture.size,he,ce,ge,Te.textureOffset,Te.scale,Te.offset);Ae.colorAttachment.set(Pe.particleTexture1.texture),H.clear({color:r.aA.transparent}),Y.getOrCreateProgram("rasterParticleUpdate",{defines:Te.defines}).draw(Y,J.TRIANGLES,Vt.disabled,Xt.disabled,ci.unblended,Wt.disabled,be,re.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments)}}(b,I,U,q)}(h,n,o,f),h.renderPass==="translucent"&&(function(b,M,I,D,z){const k=b.context,F=k.gl,N=!b.options.moving,G=b.transform.projection.name==="globe";if(!D.length)return;const[U,$]=b.stencilConfigForOverlap(D),q=[];G&&q.push("PROJECTION_GLOBE_VIEW");const Y=b.stencilModeFor3D();for(const re of $){const ne=re.toUnwrapped(),oe=M.getTile(re);if(!oe.rasterParticleState)continue;const H=oe.rasterParticleState,J=100;oe.registerFadeDuration(J);const he=M.findLoadedParent(re,0),ce=Go(oe,he,M,b.transform,J);let ge,Ae;b.terrain&&b.terrain.prepareDrawTile(),k.activeTexture.set(F.TEXTURE0),H.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),k.activeTexture.set(F.TEXTURE1),he&&he.rasterParticleState?(he.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),ge=Math.pow(2,he.tileID.overscaledZ-oe.tileID.overscaledZ),Ae=[oe.tileID.canonical.x*ge%1,oe.tileID.canonical.y*ge%1]):H.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const _e=G?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(ne,N),Te=b.transform,Pe=Tg(Te),me=r.ck(re.canonical),be=r.cl(me.getCenter().lat);let Ze,ye,Se,Ie,se;G?(Ze=Float32Array.from(r.aW(r.cn(re.canonical))),ye=Float32Array.from(Te.globeMatrix),Se=Float32Array.from(r.cj(Te)),Ie=[r.a8(Te.center.lng),r.ah(Te.center.lat)],se=Float32Array.from(r.cm(re.canonical,me,be,Te.worldSize/Te._pixelsPerMercatorPixel))):(Ze=new Float32Array(16),ye=new Float32Array(9),Se=new Float32Array(16),Ie=[0,0],se=new Float32Array(9));const je=jl(_e,Ze,ye,Se,se,Ae||[0,0],r.W(b.transform.zoom),Ie,Pe,ge||1,ce,250),vt=b.isTileAffectedByFog(re),At=b.getOrCreateProgram("rasterParticle",{defines:q,overrideFog:vt});if(b.uploadCommonUniforms(k,At,ne),G){const Ot=new Vt(F.LEQUAL,Vt.ReadWrite,b.depthRangeFor3D),Pt=0,Bt=b.globeSharedBuffers;if(Bt){const[_i,Zt,xi]=Bt.getGridBuffers(be,Pt!==0);At.draw(b,F.TRIANGLES,Ot,Y,ci.alphaBlended,Wt.backCCW,je,I.id,_i,Zt,xi)}}else{const Ot=b.depthModeForSublayer(0,Vt.ReadOnly),Pt=U[re.overscaledZ],{tileBoundsBuffer:Bt,tileBoundsIndexBuffer:_i,tileBoundsSegments:Zt}=b.getTileBoundsBuffers(oe);At.draw(b,F.TRIANGLES,Ot,Pt,ci.alphaBlended,Wt.disabled,je,I.id,Bt,_i,Zt)}}b.resetStencilClippingMasks()}(h,n,o,f),h.style.map.triggerRepaint())},background:function(h,n,o,f){const _=o.paint.get("background-color"),y=o.paint.get("background-opacity"),b=o.paint.get("background-emissive-strength");if(y===0)return;const M=h.context,I=M.gl,D=h.transform,z=D.tileSize,k=o.paint.get("background-pattern");if(h.isPatternMissing(k,o.scope))return;const F=!k&&_.a===1&&y===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==F)return;const N=Xt.disabled,G=h.depthModeForSublayer(0,F==="opaque"?Vt.ReadWrite:Vt.ReadOnly),U=h.colorModeForDrapableLayerRenderPass(b),$=k?"backgroundPattern":"background";let q,Y=f;Y||(q=h.getBackgroundTiles(),Y=Object.values(q).map(re=>re.tileID)),k&&(M.activeTexture.set(I.TEXTURE0),h.imageManager.bind(h.context,o.scope));for(const re of Y){const ne=h.isTileAffectedByFog(re),oe=h.getOrCreateProgram($,{overrideFog:ne}),H=re.toUnwrapped(),J=f?re.projMatrix:h.transform.calculateProjMatrix(H);h.prepareDrawTile();const he=n?n.getTile(re):q?q[re.key]:new hs(re,z,D.zoom,h),ce=k?bg(J,b,y,h,k,o.scope,{tileID:re,tileSize:z}):vg(J,b,y,_);h.uploadCommonUniforms(M,oe,H);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Ae,tileBoundsSegments:_e}=h.getTileBoundsBuffers(he);oe.draw(h,I.TRIANGLES,G,N,U,Wt.disabled,ce,o.id,ge,Ae,_e)}},sky:function(h,n,o){const f=h._atmosphere?r.W(h.transform.zoom):1,_=o.paint.get("sky-opacity")*f;if(_===0)return;const y=h.context,b=o.paint.get("sky-type"),M=new Vt(y.gl.LEQUAL,Vt.ReadOnly,[0,1]),I=h.frameCounter/1e3%1;b==="atmosphere"?h.renderPass==="offscreen"?o.needsSkyboxCapture(h)&&(function(D,z,k,F){const N=D.context,G=N.gl;let U=z.skyboxFbo;if(!U){U=z.skyboxFbo=N.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new Cp(N),z.skyboxTexture=N.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,z.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let re=0;re<6;++re)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(U.framebuffer),N.viewport.set([0,0,32,32]);const $=z.getCenter(D,!0),q=D.getOrCreateProgram("skyboxCapture"),Y=new Float64Array(16);r.a9.identity(Y),r.a9.rotateY(Y,Y,.5*-Math.PI),Ho(D,z,q,Y,$,0),r.a9.identity(Y),r.a9.rotateY(Y,Y,.5*Math.PI),Ho(D,z,q,Y,$,1),r.a9.identity(Y),r.a9.rotateX(Y,Y,.5*-Math.PI),Ho(D,z,q,Y,$,2),r.a9.identity(Y),r.a9.rotateX(Y,Y,.5*Math.PI),Ho(D,z,q,Y,$,3),r.a9.identity(Y),Ho(D,z,q,Y,$,4),r.a9.identity(Y),r.a9.rotateY(Y,Y,Math.PI),Ho(D,z,q,Y,$,5),N.viewport.set([0,0,D.width,D.height])}(h,o),o.markSkyboxValid(h)):h.renderPass==="sky"&&function(D,z,k,F,N){const G=D.context,U=G.gl,$=D.transform,q=D.getOrCreateProgram("skybox");G.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,z.skyboxTexture);const Y=((re,ne,oe,H,J)=>({u_matrix:re,u_sun_direction:ne,u_cubemap:0,u_opacity:H,u_temporal_offset:J}))($.skyboxMatrix,z.getCenter(D,!1),0,F,N);D.uploadCommonUniforms(G,q),q.draw(D,U.TRIANGLES,k,Xt.disabled,D.colorModeForRenderPass(),Wt.backCW,Y,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(h,o,M,_,I):b==="gradient"&&h.renderPass==="sky"&&function(D,z,k,F,N){const G=D.context,U=G.gl,$=D.transform,q=D.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Cp(G)),G.activeTexture.set(U.TEXTURE0);let Y=z.colorRampTexture;Y||(Y=z.colorRampTexture=new r.T(G,z.colorRamp,U.RGBA)),Y.bind(U.LINEAR,U.CLAMP_TO_EDGE);const re=((ne,oe,H,J,he)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:oe,u_radius:r.bm(H),u_opacity:J,u_temporal_offset:he}))($.skyboxMatrix,z.getCenter(D,!1),z.paint.get("sky-gradient-radius"),F,N);D.uploadCommonUniforms(G,q),q.draw(D,U.TRIANGLES,k,Xt.disabled,D.colorModeForRenderPass(),Wt.backCW,re,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(h,o,M,_,I)},debug:function(h,n,o,f,_,y){for(let b=0;b<o.length;b++)if(_){const D=new r.aA(f.r*.8,f.g*.8,f.b*.8,1);Ia(h,n,o[b],f,-1,-1,y),Ia(h,n,o[b],f,-1,1,y),Ia(h,n,o[b],f,1,1,y),Ia(h,n,o[b],f,1,-1,y),Ia(h,n,o[b],D,0,0,y)}else Ia(h,n,o[b],f,0,0,y)},custom:function(h,n,o,f){const _=h.context,y=o.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&o.isDraped(n)){if(h.renderPass==="offscreen"){const b=y.prerender;if(b){if(h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const M=h.transform.pointMerc;b.call(y,_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),r.W(h.transform.zoom),[M.x,M.y],h.transform.pixelsPerMeterRatio)}else b.call(y,_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const M=y.renderToTile;if(M){const I=f[0].canonical,D=new r.O(I.x+f[0].wrap*(1<<I.z),I.y,I.z);_.setDepthMode(Vt.disabled),_.setStencilMode(Xt.disabled),_.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),M.call(y,_.gl,D),_.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),_.setStencilMode(Xt.disabled);const b=y.renderingMode==="3d"?new Vt(h.context.gl.LEQUAL,Vt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Vt.ReadOnly);if(_.setDepthMode(b),h.transform.projection.name==="globe"){const M=h.transform.pointMerc;y.render(_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),r.W(h.transform.zoom),[M.x,M.y],h.transform.pixelsPerMeterRatio)}else y.render(_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState(),_.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,n,o,f){if(h.renderPass==="opaque")return;const _=o.paint.get("model-opacity");if(_===0)return;const y=o.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!y||h.terrain&&_<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;const b=h.shadowRenderer,M=o.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,M||(b.enabled=!1));const I=()=>{b&&(b.useNormalOffset=!0,M||(b.enabled=!0))},D=n.getSource();if(h.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(q,Y,re,ne,oe){const H=q.transform;if(H.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${H.projection.name} projection is not yet implemented`);const J=H.getFreeCameraOptions().position;if(!q.modelManager)return;const he=q.modelManager;re.modelManager=he;const ce=q.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ge=re._unevaluatedLayout._values["model-id"],Ae={...re.layout.get("model-id").parameters};for(const _e of ne){const Te=Y.getTile(_e).getBucket(re);if(!Te||Te.projection.name!==H.projection.name)continue;const Pe=Te.getModelUris();Pe&&!Te.modelsRequested&&(he.addModelsFromBucket(Pe,oe),Te.modelsRequested=!0);const me=Iu(_e,H);Ae.zoom=me;const be=ge.possiblyEvaluate(Ae);if(Zl(q,Te,_e),Gr.shadowUniformsInitialized=!1,Gr.useSingleShadowCascade=!!ce&&ce.getMaxCascadeForTile(_e.toUnwrapped())===0,q.renderPass==="shadow"&&ce){if(q.currentShadowCascade===1&&Te.isInsideFirstShadowMapFrustum)continue;const Se=H.calculatePosMatrix(_e.toUnwrapped(),H.worldSize);if(Gr.tileMatrix.set(Se),Gr.shadowTileMatrix=Float32Array.from(ce.calculateShadowPassMatrixFromMatrix(Se)),Gr.aabb.min.fill(0),Gr.aabb.max[0]=Gr.aabb.max[1]=r.Y,Gr.aabb.max[2]=0,Ql(Te,Gr,q,re.scope))continue}const Ze=1<<_e.canonical.z,ye=[((J.x-_e.wrap)*Ze-_e.canonical.x)*r.Y,(J.y*Ze-_e.canonical.y)*r.Y,J.z*Ze*r.Y];for(let Se in Te.instancesPerModel){const Ie=Te.instancesPerModel[Se];Ie.features.length>0&&(Se=be.evaluate(Ie.features[0].feature,{}));const se=he.getModel(Se,oe);if(se&&se.uploaded)for(const je of se.nodes)Cu(q,re,je,Ie,ye,_e,Gr)}}}(h,n,o,f,D.type==="vector"?o.scope:""),void I();if(!D.loaded())return;if(D.type==="batched-model")return function(q,Y,re,ne){re.resetLayerRenderingStats(q);const oe=q.context,H=q.transform,J=q.style.fog,he=q.shadowRenderer;if(H.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${H.projection.name} projection is not yet implemented`);const ce=q.transform.getFreeCameraOptions().position,ge=r.Q.scale([],[ce.x,ce.y,ce.z],q.transform.worldSize);r.Q.negate(ge,ge);const Ae=r.a9.identity([]),_e=r.cZ(H.center.lat,H.zoom),Te=r.a9.fromScaling([],[1,1,1/_e]);r.a9.translate(Ae,Ae,ge);const Pe=re.paint.get("model-opacity"),me=new Vt(oe.gl.LEQUAL,Vt.ReadWrite,q.depthRangeFor3D),be=new Vt(oe.gl.LEQUAL,Vt.ReadOnly,q.depthRangeFor3D),Ze=new r.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ye=q.renderPass==="shadow",Se=ye&&he?he.getCurrentCascadeFrustum():H.getFrustum(H.scaleZoom(H.worldSize)),Ie=re.getLayerRenderingStats(),se=function(je,vt){for(const At of ne){const Ot=Y.getTile(At).getBucket(re);if(!Ot||!Ot.uploaded)continue;let Pt=!1;he&&(Pt=he.getMaxCascadeForTile(At.toUnwrapped())===0);const Bt=H.calculatePosMatrix(At.toUnwrapped(),H.worldSize),_i=Ot.modelTraits;for(const Zt of Ot.getNodesInfo()){if(Zt.hiddenByReplacement||!Zt.node.meshes)continue;const xi=Zt.evaluatedScale,gi=Zt.node;let cn=0;if(q.terrain&&gi.elevation&&(cn=gi.elevation*q.terrain.exaggeration()),xi[0]<=1&&xi[1]<=1&&xi[2]<=1&&(()=>{const hi=Zt.getLocalBounds();return Ze.min=[...hi.min],Ze.max=[...hi.max],Ze.min[2]+=cn,Ze.max[2]+=cn,r.Q.transformMat4(Ze.min,Ze.min,Bt),r.Q.transformMat4(Ze.max,Ze.max,Bt),Ze})().intersects(Se)===0)continue;const Vi=[...Bt];r.a9.translate(Vi,Vi,[(gi.anchor?gi.anchor[0]:0)*(xi[0]-1),(gi.anchor?gi.anchor[1]:0)*(xi[1]-1),cn]),r.Q.exactEquals(xi,r.c$)||r.a9.scale(Vi,Vi,xi);const kn=r.a9.multiply([],Vi,gi.matrix);let In=r.a9.multiply([],Te,Vi);r.a9.multiply(In,Ae,In);const Xi=r.a9.invert([],In);r.a9.transpose(Xi,Xi),r.a9.scale(Xi,Xi,Pu),In=r.a9.multiply(In,In,gi.matrix);const $i=q.renderPass==="light-beam",ri=r.a9.multiply([],H.expandedFarZProjMatrix,kn),oi=r.a9.multiply([],H.expandedFarZProjMatrix,Vi),nn=_i&r.d1.HasMapboxMeshFeatures,Yi=nn?0:Zt.evaluatedRMEA[0][2];for(let hi=0;hi<gi.meshes.length;++hi){const ei=gi.meshes[hi],Ar=hi===gi.lightMeshIndex;let ur=ri;if(Ar){if(!$i&&!q.terrain&&q.shadowRenderer){q.currentLayer<q.firstLightBeamLayer&&(q.firstLightBeamLayer=q.currentLayer);continue}ur=oi}else if($i)continue;const qn={defines:[]},hr=[];if(xo(qn.defines,hr,ei,q),nn||qn.defines.push("DIFFUSE_SHADED"),Pt&&qn.defines.push("SHADOWS_SINGLE_CASCADE"),Ie&&(ye?Ie.numRenderedVerticesInShadowPass+=ei.vertexArray.length:Ie.numRenderedVerticesInTransparentPass+=ei.vertexArray.length),ye){Hl(ei,kn,q,re);continue}let Ir=null;if(J){const xs=cd(kn,q.transform);if(Ir=new Float32Array(xs),H.projection.name!=="globe"){const zs=ei.aabb.min,Ls=ei.aabb.max,[To,Yr]=J.getOpacityForBounds(xs,zs[0],zs[1],Ls[0],Ls[1]);qn.overrideFog=To>=Oi||Yr>=Oi}}const gr=ei.material;let Wn;gr.occlusionTexture&&gr.occlusionTexture.offsetScale&&(Wn=gr.occlusionTexture.offsetScale,qn.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ye&&he&&(he.useNormalOffset=!!ei.normalBuffer);const nr=q.getOrCreateProgram("model",qn);!ye&&he&&he.setupShadowsFromMatrix(Vi,nr,he.useNormalOffset),q.uploadCommonUniforms(oe,nr,null,Ir);const rr=gr.pbrMetallicRoughness;rr.metallicFactor=.9,rr.roughnessFactor=.5;const Rs=vu(new Float32Array(ur),new Float32Array(In),new Float32Array(Xi),new Float32Array(gi.matrix),q,Pe,rr.baseColorFactor,gr.emissiveFactor,rr.metallicFactor,rr.roughnessFactor,gr,Yi,re,[0,0,0],Wn);nr.draw(q,oe.gl.TRIANGLES,vt&&!Ar?me:be,Xt.disabled,je?Ar||Pe<1||Zt.hasTranslucentParts?ci.alphaBlended:ci.unblended:ci.disabled,Wt.backCCW,Rs,re.id,ei.vertexBuffer,ei.indexBuffer,ei.segments,re.paint,q.transform.zoom,void 0,hr)}}}};(function(je,vt,At,Ot){const Pt=je.terrain?je.terrain.exaggeration():0,Bt=je.transform.zoom;for(const _i of Ot){const Zt=vt.getTile(_i).getBucket(At);Zt&&(je.conflationActive&&Zt.updateReplacement(_i,je.replacementSource),Zt.evaluateScale(je,At),je.terrain&&Pt>0&&Zt.elevationUpdate(je.terrain,Pt,_i,At.source),Zt.needsReEvaluation(je,Bt,At)&&Zt.evaluate(At))}})(q,Y,re,ne),Pe===1?se(!0,!0):(se(!1,!0),se(!0,!1))}(h,n,o,f),void I();const z=D.getModels(),k=[],F=h.transform.getFreeCameraOptions().position,N=r.Q.scale([],[F.x,F.y,F.z],h.transform.worldSize);r.Q.negate(N,N);const G=[],U=[];let $=0;for(const q of z){const Y=o.paint.get("model-rotation").constantOr(null),re=o.paint.get("model-scale").constantOr(null),ne=o.paint.get("model-translation").constantOr(null);q.computeModelMatrix(h,Y,re,ne,!0,!0,!1);const oe=r.a9.identity([]),H=r.cZ(q.position.lat,h.transform.zoom),J=r.a9.fromScaling([],[1,1,1/H]);r.a9.translate(oe,oe,N),k.push({zScaleMatrix:J,negCameraPosMatrix:oe});for(const he of q.nodes)Wl(h.transform,he,q.matrix,h.transform.expandedFarZProjMatrix,$,G,U);$++}if(G.sort((q,Y)=>Y.depth-q.depth),h.renderPass!=="shadow"){if(_===1)for(const q of U)vo(q,h,o,k[q.modelIndex],Xt.disabled,h.colorModeForRenderPass());else{for(const q of U)vo(q,h,o,k[q.modelIndex],Xt.disabled,ci.disabled);for(const q of U)vo(q,h,o,k[q.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const q of G)vo(q,h,o,k[q.modelIndex],Xt.disabled,h.colorModeForRenderPass());I()}else{for(const q of U)Hl(q.mesh,q.nodeModelMatrix,h,o);for(const q of G)Hl(q.mesh,q.nodeModelMatrix,h,o);I()}}},Qo={model:function(h,n,o){const f=n.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,f.type==="vector"?h.scope:""));if(f.type==="batched-model")return;const _=f.getModels();for(const y of _)y.upload(o.context)},raster:function(h,n,o){const f=n.getSource();if(!(f instanceof ot&&f.loaded()))return;const _=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const y=h.paint.get("raster-array-band")||f.getInitialBand(_);if(y==null)return;const b=n.getIds().map(M=>n.getTileByID(M));for(const M of b)M.updateNeeded(_,y)&&f.prepareTile(M,_,y)},"raster-particle":function(h,n,o){const f=n.getSource();if(!(f instanceof ot&&f.loaded()))return;const _=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const y=h.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(y==null)return;const b=n.getIds().map(M=>n.getTileByID(M));for(const M of b)M.updateNeeded(_,y)&&f.prepareTile(M,_,y)}};class Rp{constructor(n,o,f,_){this.context=new As(n,o),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=new Date().getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const y=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const b of y)this._debugParams.enabledLayers[b]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const b of y)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],b);this.setup(),this.numSublayers=ds.maxUnderzooming+ds.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _p(this),this._wireframeDebugCache=new Dp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(n,o){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ur(this,n));const _=this._terrain;this.transform.elevation=f?_:null,_.update(n,this.transform,o),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(n){const o=n.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=o.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const y=f+.78*(_-f);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,o){if(this.width=n*r.f.devicePixelRatio,this.height=o*r.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const n=this.context,o=new r.aQ;o.emplaceBack(0,0),o.emplaceBack(r.Y,0),o.emplaceBack(0,r.Y),o.emplaceBack(r.Y,r.Y),this.tileExtentBuffer=n.createVertexBuffer(o,r.aS.members),this.tileExtentSegments=r.aE.simpleSegment(0,0,4,2);const f=new r.aQ;f.emplaceBack(0,0),f.emplaceBack(r.Y,0),f.emplaceBack(0,r.Y),f.emplaceBack(r.Y,r.Y),this.debugBuffer=n.createVertexBuffer(f,r.aS.members),this.debugSegments=r.aE.simpleSegment(0,0,4,5);const _=new r.aQ;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,r.aS.members),this.viewportSegments=r.aE.simpleSegment(0,0,4,2);const y=new r.ay;y.emplaceBack(0,0,0,0),y.emplaceBack(r.Y,0,r.Y,0),y.emplaceBack(0,r.Y,0,r.Y),y.emplaceBack(r.Y,r.Y,r.Y,r.Y),this.mercatorBoundsBuffer=n.createVertexBuffer(y,r.aU.members),this.mercatorBoundsSegments=r.aE.simpleSegment(0,0,4,2);const b=new r.az;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(b);const M=new r.aR;for(const D of[0,1,3,2,0])M.emplaceBack(D);this.debugIndexBuffer=n.createIndexBuffer(M),this.emptyTexture=new r.T(n,new r.h({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.a9.create();const I=this.context.gl;this.stencilClearMode=new Xt({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Vt.disabled,this.stencilClearMode,ci.disabled,Wt.disabled,Bl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,o,f){if(!o||this.currentStencilSource===o.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const I of f)if(this._tileClippingMaskIDs[I.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=o.id;const _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(ci.disabled),_.setDepthMode(Vt.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of f){const I=o.getTile(M),D=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:k,tileBoundsSegments:F}=this.getTileBoundsBuffers(I);b.draw(this,y.TRIANGLES,Vt.disabled,new Xt({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),ci.disabled,Wt.disabled,Bl(M.projMatrix),"$clipping",z,k,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,o=this.context.gl;return new Xt({func:o.NOTEQUAL,mask:255},n,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const o=this.context.gl;return new Xt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(n){const o=this.context.gl,f=n.sort((b,M)=>M.overscaledZ-b.overscaledZ),_=f[f.length-1].overscaledZ,y=f[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let M=0;M<y;M++)b[M+_]=new Xt({func:o.GEQUAL,mask:255},M+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[b,f]}return[{[_]:Xt.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new ci([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new r.aA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ci.unblended:ci.alphaBlended}colorModeForDrapableLayerRenderPass(n){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new ci([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new r.aA(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,o,f,_=!1){if(!this.opaquePassEnabledForLayer()&&!_)return Vt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Vt(f||this.context.gl.LEQUAL,o,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){const n=new Date().getTime(),o=n-this._timeStamp;this._timeStamp=n,this._fpsHistory.push(o===0?0:1e3/o),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((f,_)=>f+_/this._fpsHistory.length,0))}render(n,o){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=o;const f=this.style._mergedLayers,_=this.style.order.filter(H=>{const J=f[H];return!(J.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[J.type]}),y=_.map(H=>f[H]),b=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.f.now()),this.imageManager.beginFrame();let M=0,I=!1;for(const H in b){const J=b[H];J.used&&(J.prepare(this.context),J.getSource().usedInConflation&&++M)}for(const H of y)H.isHidden(this.transform.zoom)||this.prepareLayer(H);const D={},z={},k={},F={},N={};for(const H in b){const J=b[H];D[H]=J.getVisibleCoordinates(),z[H]=D[H].slice().reverse(),k[H]=J.getVisibleCoordinates(!0).reverse(),F[H]=J.getShadowCasterCoordinates(),N[H]=J.sortCoordinatesByDistance(D[H])}const G=H=>{const J=this.style.getLayerSourceCache(H);return J&&J.used?J.getSource():null};if(M){const H=[];for(const J of y)this.layerUsedInConflation(J,G(J))&&H.push(J);if(H&&H.length>1){const J=[];for(const he of H){const ce=this.style.getLayerSourceCache(he);ce&&ce.used&&ce.getSource().usedInConflation&&J.push({layer:he.fqid,cache:ce})}this.replacementSource.setSources(J),I=!0}}I||this.replacementSource.clear(),this.conflationActive=I,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const H of y){const J=H.cutoffRange();if(this.longestCutoffRange=Math.max(J,this.longestCutoffRange),J>0){const he=G(H);he&&(this.minCutoffZoom=Math.max(he.minzoom,this.minCutoffZoom)),H.minzoom&&(this.minCutoffZoom=Math.max(H.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let H=0;H<y.length;H++)if(y[H].is3D()){this.opaquePassCutoff=H;break}const U=this.style&&this.style.fog;U?(this._fogVisible=U.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=U.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0);const $=this._shadowRenderer;if($){$.updateShadowParameters(this.transform,this.style.directionalLight);for(const H in b)for(const J of D[H]){let he={min:0,max:0};this.terrain&&(he=this.terrain.getMinMaxForTile(J)||he),$.addShadowReceiver(J.toUnwrapped(),he.min,he.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ld(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.d5(this.context.gl))return;this.renderPass="offscreen";for(const H of y){const J=n.getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const he=J?z[J.id]:void 0;(H.type==="custom"||H.type==="raster"||H.type==="raster-particle"||H.isSky()||he&&he.length)&&this.renderLayer(this,J,H,he)}this.depthRangeFor3D=[0,1-(y.length+2)*this.numSublayers*this.depthEpsilon];const q=this.terrain;q&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&q.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,F)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Y=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),re=(()=>{if(o.showOverdrawInspector)return r.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Y){const H=this.style.fog.properties.get("color").toArray01();return new r.aA(...H)}if(this.style.fog&&this.transform.projection.supportsFog&&Y){const H=this.style.fog.properties.get("space-color").toArray01();return new r.aA(...H)}return r.aA.transparent})();if(this.context.clear({color:re,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const H=y[this.currentLayer],J=n.getLayerSourceCache(H);if(H.isSky())continue;const he=J?(H.is3D()?N:z)[J.id]:void 0;this._renderTileClippingMasks(H,J,he),this.renderLayer(this,J,H,he)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.W(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const H=y[this.currentLayer],J=n.getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,J,H,J?z[J.id]:void 0)}function ne(H,J){let he;return J&&(he=(H.type==="symbol"?k:H.is3D()?N:z)[J.id]),he}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<_.length;){const H=y[this.currentLayer];if(H.type==="raster"){const J=n.getLayerSourceCache(H);this.renderLayer(this,J,H,ne(H,J))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let oe=0;for($&&(oe=$.getShadowCastingLayerCount());this.currentLayer<_.length;){const H=y[this.currentLayer],J=n.getLayerSourceCache(H);if(H.isSky())++this.currentLayer;else if(q&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=q.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(H,J,J?D[J.id]:void 0),this.renderLayer(this,J,H,ne(H,J)),!q&&$&&oe>0&&H.hasShadowPass()&&--oe==0&&($.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const he=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=he;this.currentLayer++){const ce=y[this.currentLayer];if(!ce.hasLightBeamPass())continue;const ge=n.getLayerSourceCache(ce);this.renderLayer(this,ge,ce,ge?z[ge.id]:void 0)}this.currentLayer=he,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;y.forEach(J=>{const he=n.getLayerSourceCache(J);he&&!J.isHidden(this.transform.zoom)&&he.getVisibleCoordinates().length&&(!H||H.getSource().maxzoom<he.getSource().maxzoom)&&(H=he)}),H&&this.options.showTileBoundaries&&Du.debug(this,H,H.getVisibleCoordinates(),r.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Du.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(H){const J=H.transform.padding;Ep(H,H.transform.height-(J.top||0),3,rd),Ep(H,J.bottom||0,3,Mg),Ap(H,J.left||0,3,Mp),Ap(H,H.transform.width-(J.right||0),3,Sp);const he=H.transform.centerPoint;(function(ce,ge,Ae,_e){Eu(ce,ge-1,Ae-10,2,20,_e),Eu(ce,ge-10,Ae-1,20,2,_e)})(H,he.x,H.transform.height-he.y,sd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),I||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:o}=this.transform.projection,f=!o||!o.includes(n.type);if(Qo[n.type]&&(f||this.terrain&&n.type==="custom")){const _=this.style.getLayerSourceCache(n);Qo[n.type](n,_,this)}this.gpuTimingEnd()}renderLayer(n,o,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(f.type)||n.terrain&&f.type==="custom")&&Du[f.type](n,o,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,f=this.context.gl;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(o.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,o=this.context.gl,f=o.createQuery();this.deferredRenderGpuTimeQueries.push(f),o.beginQuery(n.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const o={};for(const f in n){const _=n[f],y=this.context.extTimerQuery,b=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),o[f]=b}return o}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery,f=this.context.gl;let _=0;for(const y of n)_+=o.getQueryParameter(y,f.QUERY_RESULT)/1e6,o.deleteQueryEXT(y);return _}translatePosMatrix(n,o,f,_,y){if(!f[0]&&!f[1])return n;const b=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(b){const D=Math.sin(b),z=Math.cos(b);f=[f[0]*z-f[1]*D,f[0]*D+f[1]*z]}const M=[y?f[0]:r.a6(o,f[0],this.transform.zoom),y?f[1]:r.a6(o,f[1],this.transform.zoom),0],I=new Float32Array(16);return r.a9.translate(I,n,M),I}saveTileTexture(n){const o=n.size[0],f=this._tileTextures[o];f?f.push(n):this._tileTextures[o]=[n]}getTileTexture(n){const o=this._tileTextures[n];return o&&o.length>0?o.pop():null}isPatternMissing(n,o){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString(),o)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,o,f){const _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,y=this.terrain&&this.terrain.exaggeration()===0,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||b.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?b.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):b.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT"),y&&b.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||_||o!==void 0&&!o||b.push("FOG","FOG_DITHERING"),_&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,o){this.cache=this.cache||{};const f=o&&o.defines||[],_=o&&o.config,y=this.currentGlobalDefines(n,o&&o.overrideFog,o&&o.overrideRtt).concat(f),b=Xr.cacheKey(_s[n],n,y,_);return this.cache[b]||(this.cache[b]=new Xr(this.context,n,_s[n],_,Jh[n],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,o){if(this.style.enable3dLights()){const f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){const y=((b,M)=>{const I=b.properties.get("direction"),D=b.properties.get("color").toArray01(),z=b.properties.get("intensity"),k=M.properties.get("color").toArray01(),F=M.properties.get("intensity"),N=[I.x,I.y,I.z],G=r.cs(k,F),U=r.cs(D,z);return{u_lighting_ambient_color:G,u_lighting_directional_dir:N,u_lighting_directional_color:U,u_ground_radiance:xp(N,U,G)}})(f,_);o.setLightsUniformValues(n,y)}}}uploadCommonUniforms(n,o,f,_,y){if(this.uploadCommonLightUniforms(n,o),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const M=b.getOpacity(this.transform.pitch),I=((D,z,k,F,N,G,U,$,q,Y,re,ne)=>{const oe=D.transform,H=z.properties.get("color").toArray01();H[3]=F;const J=D.frameCounter/1e3%1,[he,ce]=z.properties.get("vertical-range");return{u_fog_matrix:k?oe.calculateFogTileMatrix(k):ne||D.identityMat,u_fog_range:z.getFovAdjustedRange(oe._fov),u_fog_color:H,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,ce),ce],u_fog_temporal_offset:J,u_frustum_tl:N,u_frustum_tr:G,u_frustum_br:U,u_frustum_bl:$,u_globe_pos:q,u_globe_radius:Y,u_viewport:re,u_globe_transition:r.W(oe.zoom),u_is_globe:+(oe.projection.name==="globe")}})(this,b,f,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.f.devicePixelRatio,this.transform.height*r.f.devicePixelRatio],_);o.setFogUniformValues(n,I)}y&&o.setCutoffUniformValues(n,y.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,o=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)o[_.key]=n[_.key]||new hs(_,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(n,o){return!(!n.is3D()||n.minzoom&&n.minzoom>this.transform.zoom||n.sourceLayer!=="building"&&(!o||o.type!=="batched-model"))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[n.key];return o||(this._cachedTileFogOpacities[n.key]=o=this.style.fog.getOpacityForTile(n)),o[0]>=Oi||o[1]>=Oi}}function zp(h,n){let o=!1,f=null;const _=()=>{f=null,o&&(h(),f=setTimeout(_,n),o=!1)};return()=>(o=!0,f||_(),f)}class Eg{constructor(n){this._hashName=n&&encodeURIComponent(n),r.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=zp(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const o=Lp(n);if(this._hashName){const f=this._hashName;let _=!1;const y=location.hash.slice(1).split("&").map(b=>{const M=b.split("=")[0];return M===f?(_=!0,`${M}=${o}`):b}).filter(b=>b);return _||y.push(`${f}=${o}`),`#${y.join("&")}`}return`#${o}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(o=f)}),(o&&o[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(f=>isNaN(f))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(o[3]||0):n.getBearing();return n.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:f,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Lp(h,n){const o=h.getCenter(),f=Math.round(100*h.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),b=Math.round(o.lng*y)/y,M=Math.round(o.lat*y)/y,I=h.getBearing(),D=h.getPitch();let z=n?`/${b}/${M}/${f}`:`${f}/${M}/${b}`;return(I||D)&&(z+="/"+Math.round(10*I)/10),D&&(z+=`/${Math.round(D)}`),z}const Ca={linearity:.3,easing:r.d6(0,0,.3,1)},ud=r.e({deceleration:2500,maxSpeed:1400},Ca),hd=r.e({deceleration:20,maxSpeed:1400},Ca),dd=r.e({deceleration:1e3,maxSpeed:360},Ca),kp=r.e({deceleration:1e3,maxSpeed:90},Ca);class Op{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.f.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,o=r.f.now();for(;n.length>0&&o-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(o.pan.mag()){const y=bo(o.pan.mag(),f,r.e({},ud,n||{}));_.offset=o.pan.mult(y.amount/o.pan.mag()),_.center=this._map.transform.center,Ru(_,y)}if(o.zoom){const y=bo(o.zoom,f,hd);_.zoom=this._map.transform.zoom+y.amount,Ru(_,y)}if(o.bearing){const y=bo(o.bearing,f,dd);_.bearing=this._map.transform.bearing+r.ad(y.amount,-179,179),Ru(_,y)}if(o.pitch){const y=bo(o.pitch,f,kp);_.pitch=this._map.transform.pitch+y.amount,Ru(_,y)}if(_.zoom||_.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Ru(h,n){(!h.duration||h.duration<n.duration)&&(h.duration=n.duration,h.easing=n.easing)}function bo(h,n,o){const{maxSpeed:f,linearity:_,deceleration:y}=o,b=r.ad(h*_/(n/1e3),-f,f),M=Math.abs(b)/(y*_);return{easing:o.easing,duration:1e3*M,amount:b*(M/2)}}class cr extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f,_={}){const y=Ut(o.getCanvasContainer(),f),b=o.unproject(y);super(n,r.e({point:y,lngLat:b,originalEvent:f},_)),this._defaultPrevented=!1,this.target=o}}class Xl extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f){const _=n==="touchend"?f.changedTouches:f.touches,y=Yt(o.getCanvasContainer(),_),b=y.map(I=>o.unproject(I)),M=y.reduce((I,D,z,k)=>I.add(D.div(k.length)),new r.P(0,0));super(n,{points:y,point:M,lngLats:b,lngLat:o.unproject(M),originalEvent:f}),this._defaultPrevented=!1}}class $r extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class fd{constructor(n,o){this._map=n,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new $r(n.type,this._map,n))}mousedown(n,o){return this._mousedownPos=o,this._firePreventable(new cr(n.type,this._map,n))}mouseup(n){this._map.fire(new cr(n.type,this._map,n))}preclick(n){const o=r.e({},n);o.type="preclick",this._map.fire(new cr(o.type,this._map,o))}click(n,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(n),this._map.fire(new cr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new cr(n.type,this._map,n))}mouseover(n){this._map.fire(new cr(n.type,this._map,n))}mouseout(n){this._map.fire(new cr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Xl(n.type,this._map,n))}touchmove(n){this._map.fire(new Xl(n.type,this._map,n))}touchend(n){this._map.fire(new Xl(n.type,this._map,n))}touchcancel(n){this._map.fire(new Xl(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zu{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new cr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new cr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new cr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lu{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,o){this.isEnabled()&&n.shiftKey&&n.button===0&&(lt(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(n,o){if(!this._active)return;const f=o,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=fe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(_.x,f.x),M=Math.max(_.x,f.x),I=Math.min(_.y,f.y),D=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${I}px)`,this._box.style.width=M-b+"px",this._box.style.height=D-I+"px")})}mouseupWindow(n,o){if(!this._active)return;const f=this._startPos,_=o;if(f&&n.button===0){if(this.reset(),yt(),f.x!==_.x||f.y!==_.y)return this._map.fire(new r.b("boxzoomend",{originalEvent:n})),{cameraAnimation:y=>y.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),dt(),delete this._startPos,delete this._lastPos}_fireEvent(n,o){return this._map.fire(new r.b(n,{originalEvent:o}))}}function Yl(h,n){const o={};for(let f=0;f<h.length;f++)o[h[f].identifier]=n[f];return o}class pd{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,o,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const y=new r.P(0,0);for(const b of _)y._add(b);return y.div(_.length)}(o),this.touches=Yl(f,o)))}touchmove(n,o,f){if(this.aborted||!this.centroid)return;const _=Yl(f,o);for(const y in this.touches){const b=_[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(n,o,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Pa{constructor(n){this.singleTap=new pd(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,o,f){this.singleTap.touchstart(n,o,f)}touchmove(n,o,f){this.singleTap.touchmove(n,o,f)}touchend(n,o,f){const _=this.singleTap.touchend(n,o,f);if(_){const y=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(_)<30;if(y&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class md{constructor(){this._zoomIn=new Pa({numTouches:1,numTaps:2}),this._zoomOut=new Pa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,o,f){this._zoomIn.touchstart(n,o,f),this._zoomOut.touchstart(n,o,f)}touchmove(n,o,f){this._zoomIn.touchmove(n,o,f),this._zoomOut.touchmove(n,o,f)}touchend(n,o,f){const _=this._zoomIn.touchend(n,o,f),y=this._zoomOut.touchend(n,o,f);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:n})}):y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _d={0:1,2:2};class Da{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,o){return!1}_move(n,o){return{}}mousedown(n,o){if(this._lastPoint)return;const f=wi(n);this._correctButton(n,f)&&(this._lastPoint=o,this._eventButton=f)}mousemoveWindow(n,o){const f=this._lastPoint;if(f){if(n.preventDefault(),this._eventButton!=null&&function(_,y){const b=_d[y];return _.buttons===void 0||(_.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(o.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(f,o)}}mouseupWindow(n){this._lastPoint&&wi(n)===this._eventButton&&(this._moved&&yt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fp extends Da{mousedown(n,o){super.mousedown(n,o),this._lastPoint&&(this._active=!0)}_correctButton(n,o){return o===0&&!n.ctrlKey}_move(n,o){return{around:o,panDelta:o.sub(n)}}}class gd extends Da{_correctButton(n,o){return o===0&&n.ctrlKey||o===2}_move(n,o){const f=.8*(o.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class Xo extends Da{_correctButton(n,o){return o===0&&n.ctrlKey||o===2}_move(n,o){const f=-.5*(o.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class Ag{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),r.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(n,o,f){return this._calculateTransform(n,o,f)}touchmove(n,o,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!r.d7())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,o,f)}}touchend(n,o,f){this._calculateTransform(n,o,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,o,f){f.length>0&&(this._active=!0);const _=Yl(f,o),y=new r.P(0,0),b=new r.P(0,0);let M=0;for(const D in _){const z=_[D],k=this._touches[D];k&&(y._add(z),b._add(z.sub(k)),M++,_[D]=z)}if(this._touches=_,M<this._minTouches||!b.mag())return;const I=b.div(M);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(M),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=fe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class yd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,o,f){return{}}touchstart(n,o,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([o[0],o[1]]))}touchmove(n,o,f){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[y,b]=_,M=ku(f,o,y),I=ku(f,o,b);if(!M||!I)return;const D=this._aroundCenter?null:M.add(I).div(2);return this._move([M,I],D,n)}touchend(n,o,f){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,b=ku(f,o,_),M=ku(f,o,y);b&&M||(this._active&&yt(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ku(h,n,o){for(let f=0;f<h.length;f++)if(h[f].identifier===o)return n[f]}function Bp(h,n){return Math.log(h/n)/Math.LN2}class Ig extends yd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,o){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Bp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bp(this._distance,f),pinchAround:o}}}function Np(h,n){return 180*h.angleWith(n)/Math.PI}class xd extends yd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,o){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Np(this._vector,f),pinchAround:o}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const o=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=Np(n,f);return Math.abs(_)<o}}function Kl(h){return Math.abs(h.y)>Math.abs(h.x)}class Vp extends yd{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Kl(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,o,f){const _=this._lastPoints;if(!_)return;const y=n[0].sub(_[0]),b=n[1].sub(_[1]);return this._map._cooperativeGestures&&!r.d7()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(n,o,f){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,y=o.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const b=n.y>0==o.y>0;return Kl(n)&&Kl(o)&&b}}const Ra={panStep:100,bearingStep:15,pitchStep:10};class jp{constructor(){const n=Ra;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let o=0,f=0,_=0,y=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),y=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),y=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:M=>{const I=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Up,zoom:o?Math.round(I)+o*(n.shiftKey?2:1):I,bearing:M.getBearing()+f*this._bearingStep,pitch:M.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:M.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Up(h){return h*(2-h)}const vd=4.000244140625,bd=1/450;class Yo{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=bd,r.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.d7()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=r.f.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,o!==0&&o%vd==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),n.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=n,this._delta-=o,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Ut(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>vd?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&z!==0&&(z=1/z);const k=o(),F=Math.pow(2,k),N=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(N*z))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:o(),_=this._startZoom,y=this._easing;let b,M=!1;if(this._type==="wheel"&&_&&y){const D=Math.min((r.f.now()-this._lastWheelEventTime)/200,1),z=y(D);b=r.X(_,f,z),D<1?this._frameId||(this._frameId=!0):M=!0}else b=f,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=b-o();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let o=r.d8;if(this._prevEase){const f=this._prevEase,_=(r.f.now()-f.start)/f.duration,y=f.easing(_+.01)-f.easing(_),b=.27/Math.sqrt(y*y+1e-4)*.01,M=Math.sqrt(.0729-b*b);o=r.d6(b,M,.25,1)}return this._prevEase={start:r.f.now(),duration:n,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=fe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Gp{constructor(n,o){this._clickZoom=n,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ko{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,o){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(o)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $p{constructor(){this._tap=new Pa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,o,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=o[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,o,f))}touchmove(n,o,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=o[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(n,o,f)}touchend(n,o,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,o,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ou{constructor(n,o,f){this._el=n,this._mousePan=o,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qp{constructor(n,o,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=o,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wp{constructor(n,o,f,_){this._el=n,this._touchZoom=o,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const za=h=>h.zoom||h.drag||h.pitch||h.rotate;class wd extends r.b{}class Cg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,o){const f=r.Q.sub([],o,n);this.radius=r.Q.length(f[2]<0?r.Q.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){r.Q.div(n,n,this.constants),r.Q.normalize(n,n),r.Q.mul(n,n,this.constants);const o=r.Q.scale([],n,this.radius);if(o[2]>0){const f=r.Q.scale([],[0,0,1],r.Q.dot(o,[0,0,1])),_=r.Q.scale([],r.Q.normalize([],[o[0],o[1],0]),this.radius),y=r.Q.add([],o,r.Q.scale([],r.Q.sub([],r.Q.add([],_,f),o),2));o[0]=y[0],o[1]=y[1]}return o}}function Jl(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class ec{constructor(n,o){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Op(n),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Cg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),r.a$(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,y,b]of this._listeners){const M=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,M,b)}}destroy(){for(const[n,o,f]of this._listeners){const _=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(o,_,f)}}_addDefaultHandlers(n){const o=this._map,f=o.getCanvasContainer();this._add("mapEvent",new fd(o,n));const _=o.boxZoom=new Lu(o,n);this._add("boxZoom",_);const y=new md,b=new Ko;o.doubleClickZoom=new Gp(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const M=new $p;this._add("tapDragZoom",M);const I=o.touchPitch=new Vp(o);this._add("touchPitch",I);const D=new gd(n),z=new Xo(n);o.dragRotate=new qp(n,D,z),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const k=new Fp(n),F=new Ag(o,n);o.dragPan=new Ou(f,k,F),this._add("mousePan",k),this._add("touchPan",F,["touchZoom","touchRotate"]);const N=new xd,G=new Ig;o.touchZoomRotate=new Wp(f,G,N,M),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new zu(o));const U=o.scrollZoom=new Yo(o,this);this._add("scrollZoom",U,["mousePan"]);const $=o.keyboard=new jp;this._add("keyboard",$);for(const q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[q]&&o[q].enable(n[q])}_add(n,o,f){this._handlers.push({handlerName:n,handler:o,allowed:f}),this._handlersById[n]=o}stop(n){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!za(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,o,f){for(const _ in n)if(_!==f&&(!o||o.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const o=[];for(const f of n)this._el.contains(f.target)&&o.push(f);return o}handleEvent(n,o){this._updatingCamera=!0;const f=n.type==="renderFrame",_=f?void 0:n,y={needsRenderFrame:!1},b={},M={},I=n.touches?this._getMapTouches(n.touches):void 0,D=I?Yt(this._el,I):f?void 0:Ut(this._el,n);for(const{handlerName:F,handler:N,allowed:G}of this._handlers){if(!N.isEnabled())continue;let U;this._blockedByActive(M,G,F)?N.reset():N[o||n.type]&&(U=N[o||n.type](n,D,I),this.mergeHandlerResult(y,b,U,F,_),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||N.isActive())&&(M[F]=N)}const z={};for(const F in this._previousActiveHandlers)M[F]||(z[F]=_);this._previousActiveHandlers=M,(Object.keys(z).length||Jl(y))&&(this._changes.push([y,b,z]),this._triggerRenderFrame()),(Object.keys(M).length||Jl(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=y;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(n,o,f,_,y){if(!f)return;r.e(n,f);const b={handlerName:_,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(o.zoom=b),f.panDelta!==void 0&&(o.drag=b),f.pitchDelta!==void 0&&(o.pitch=b),f.bearingDelta!==void 0&&(o.rotate=b)}_applyChanges(){const n={},o={},f={};for(const[_,y,b]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new r.P(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),r.e(o,y),r.e(f,b);this._updateMapTransform(n,o,f),this._changes=[]}_updateMapTransform(n,o,f){const _=this._map,y=_.transform,b=Y=>[Y.x,Y.y,Y.z];if((Y=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Jl(n)){const Y=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),Y!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!Jl(n))return void this._fireEvents(o,f,!0);let{panDelta:M,zoomDelta:I,bearingDelta:D,pitchDelta:z,around:k,aroundCoord:F,pinchAround:N}=n;y._isCameraConstrained&&(I>0&&(I=0),y._isCameraConstrained=!1),N!==void 0&&(k=N),(I||(Y=>o[Y]&&!this._eventsInProgress[Y])("drag"))&&k&&(this._dragOrigin=b(y.pointCoordinate3D(k)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),k=k||_.transform.centerPoint,D&&(y.bearing+=D),z&&(y.pitch+=z),y._updateCameraState();const G=[0,0,0];if(M)if(y.projection.name==="mercator"){const Y=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(k).dir),re=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(k.sub(M)).dir);G[0]=re[0]-Y[0],G[1]=re[1]-Y[1]}else{const Y=y.pointCoordinate(k);if(y.projection.name==="globe"){M=M.rotate(-y.angle);const re=y._pixelsPerMercatorPixel/y.worldSize;G[0]=-M.x*r.d9(r.ax(Y.y))*re,G[1]=-M.y*r.d9(y.center.lat)*re}else{const re=y.pointCoordinate(k.sub(M));Y&&re&&(G[0]=re.x-Y.x,G[1]=re.y-Y.y)}}const U=y.zoom,$=[0,0,0];if(I){const Y=b(F||y.pointCoordinate3D(k)),re={dir:r.Q.normalize([],r.Q.sub([],Y,y._camera.position))};if(re.dir[2]<0){const ne=y.zoomDeltaToMovement(Y,I);r.Q.scale($,re.dir,ne)}}const q=r.Q.add(G,G,$);y._translateCameraConstrained(q),I&&Math.abs(y.zoom-U)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(o,f,!0)}_fireEvents(n,o,f){const _=za(this._eventsInProgress),y=za(n),b={};for(const z in n){const{originalEvent:k}=n[z];this._eventsInProgress[z]||(b[`${z}start`]=k),this._eventsInProgress[z]=n[z]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const z in b)this._fireEvent(z,b[z]);y&&this._fireEvent("move",y.originalEvent);for(const z in n){const{originalEvent:k}=n[z];this._fireEvent(z,k)}const M={};let I;for(const z in this._eventsInProgress){const{handlerName:k,originalEvent:F}=this._eventsInProgress[z];this._handlersById[k].isActive()||(delete this._eventsInProgress[z],I=o[k]||F,M[`${z}end`]=I)}for(const z in M)this._fireEvent(z,M[z]);const D=za(this._eventsInProgress);if(f&&(_||y)&&!D){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;z?(k(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new r.b("moveend",{originalEvent:I})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,o){this._map.fire(new r.b(n,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new wd("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Hp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pg extends r.E{constructor(n,o){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,r.a$(["_renderFrameCallback"],this)}getCenter(){return new r.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(n,o){return this.jumpTo({center:n},o)}panBy(n,o,f){return n=r.P.convert(n).mult(-1),this.panTo(this.transform.center,r.e({offset:n},o),f)}panTo(n,o,f){return this.easeTo(r.e({center:n},o),f)}getZoom(){return this.transform.zoom}setZoom(n,o){return this.jumpTo({zoom:n},o),this}zoomTo(n,o,f){return this.easeTo(r.e({zoom:n},o),f)}zoomIn(n,o){return this.zoomTo(this.getZoom()+1,n,o),this}zoomOut(n,o){return this.zoomTo(this.getZoom()-1,n,o),this}getBearing(){return this.transform.bearing}setBearing(n,o){return this.jumpTo({bearing:n},o),this}getPadding(){return this.transform.padding}setPadding(n,o){return this.jumpTo({padding:n},o),this}rotateTo(n,o,f){return this.easeTo(r.e({bearing:n},o),f)}resetNorth(n,o){return this.rotateTo(0,r.e({duration:1e3},n),o),this}resetNorthPitch(n,o){return this.easeTo(r.e({bearing:0,pitch:0,duration:1e3},n),o),this}snapToNorth(n,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,o):this}getPitch(){return this.transform.pitch}setPitch(n,o){return this.jumpTo({pitch:n},o),this}cameraForBounds(n,o){n=r.ag.convert(n);const f=o&&o.bearing||0,_=o&&o.pitch||0,y=n.getNorthWest(),b=n.getSouthEast();return this._cameraForBounds(this.transform,y,b,f,_,o)}_extendPadding(n){const o={top:0,right:0,bottom:0,left:0};return n==null?r.e({},o,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:r.e({},o,n)}_extendCameraOptions(n){return(n=r.e({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,o){const f=o.max[0]-o.min[0],_=o.max[1]-o.min[1];return f/_>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):_/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,o,f,_,y,b){const M=n.clone(),I=this._extendCameraOptions(b);M.bearing=_,M.pitch=y;const D=r.bq.convert(o),z=r.bq.convert(f),k=.5*(D.lat+z.lat),F=.5*(D.lng+z.lng),N=r.da(k,F),G=r.Q.normalize([],N),U=r.Q.normalize([],r.Q.cross([],G,[0,1,0])),$=r.Q.cross([],U,G),q=[U[0],U[1],U[2],0,$[0],$[1],$[2],0,G[0],G[1],G[2],0,0,0,0,1],Y=[N,r.da(D.lat,D.lng),r.da(z.lat,D.lng),r.da(z.lat,z.lng),r.da(D.lat,z.lng),r.da(k,D.lng),r.da(k,z.lng),r.da(D.lat,F),r.da(z.lat,F)];let re=r.bV.fromPoints(Y.map(Ie=>[r.Q.dot(U,Ie),r.Q.dot($,Ie),r.Q.dot(G,Ie)]));const ne=r.Q.transformMat4([],re.center,q);r.Q.squaredLength(ne)===0&&r.Q.set(ne,0,0,1),r.Q.normalize(ne,ne),r.Q.scale(ne,ne,r.ae),M.center=r.db(ne);const oe=M.getWorldToCameraMatrix(),H=r.a9.invert(new Float64Array(16),oe);re=r.bV.applyTransform(re,r.a9.multiply([],oe,q));const J=this._extendAABB(re,M,I,_);if(!J)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=J,r.Q.transformMat4(ne,ne,oe);const he=.5*(re.max[2]-re.min[2]),ce=this._minimumAABBFrustumDistance(M,re),ge=r.Q.scale([],[0,0,1],he),Ae=r.Q.add(ge,ne,ge),_e=ce+(M.pitch===0?0:r.Q.distance(ne,Ae)),Te=M.globeCenterInViewSpace,Pe=r.Q.sub([],ne,[Te[0],Te[1],Te[2]]);r.Q.normalize(Pe,Pe),r.Q.scale(Pe,Pe,_e);const me=r.Q.add([],ne,Pe);r.Q.transformMat4(me,me,H);const be=r.dc/r.ae,Ze=r.Q.length(me),ye=r.bo(Math.max(Ze*be-r.dc,Number.EPSILON),0),Se=Math.min(M.zoomFromMercatorZAdjusted(ye),I.maxZoom);return Se>.5*(r.bJ+r.bA)?(M.setProjection({name:"mercator"}),M.zoom=Se,this._cameraForBounds(M,o,f,_,y,b)):{center:M.center,zoom:Se,bearing:_,pitch:y}}_extendAABB(n,o,f,_){const y=.5*((f.padding.left||0)+(f.padding.right||0)),b=.5*((f.padding.top||0)+(f.padding.bottom||0)),M=b,I=y,D=y,z=b,k=o.width-(I+D),F=o.height-(M+z),N=r.Q.sub([],n.max,n.min),G=Math.min(k/N[0],F/N[1]),U=Math.min(o.scaleZoom(o.scale*G),f.maxZoom);if(isNaN(U))return null;const $=o.scale/o.zoomScale(U),q=new r.bV([n.min[0]-I*$,n.min[1]-z*$,n.min[2]],[n.max[0]+D*$,n.max[1]+M*$,n.max[2]]),Y=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new r.P(f.offset.x,f.offset.y):r.P.convert(f.offset)).rotate(-r.bm(_));return q.center[0]-=Y.x*$,q.center[1]+=Y.y*$,q}queryTerrainElevation(n,o){const f=this.transform.elevation;return f?(o=r.e({},{exaggerated:!0},o),f.getAtPoint(r.O.fromLngLat(n),null,o.exaggerated)):null}_cameraForBounds(n,o,f,_,y,b){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,o,f,_,y,b);const M=n.clone(),I=this._extendCameraOptions(b);M.bearing=_,M.pitch=y;const D=r.bq.convert(o),z=r.bq.convert(f),k=new r.bq(D.lng,z.lat),F=new r.bq(z.lng,D.lat),N=M.project(D),G=M.project(z),U=this.queryTerrainElevation(D),$=this.queryTerrainElevation(z),q=this.queryTerrainElevation(k),Y=this.queryTerrainElevation(F),re=[[N.x,N.y,Math.min(U||0,$||0,q||0,Y||0)],[G.x,G.y,Math.max(U||0,$||0,q||0,Y||0)]];let ne=r.bV.fromPoints(re);const oe=M.getWorldToCameraMatrix(),H=r.a9.invert(new Float64Array(16),oe);ne=r.bV.applyTransform(ne,oe);const J=this._extendAABB(ne,M,I,_);if(!J)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=J;const he=.5*r.Q.sub([],ne.max,ne.min)[2],ce=this._minimumAABBFrustumDistance(M,ne),ge=[0,0,1,0];r.aa.transformMat4(ge,ge,oe),r.aa.normalize(ge,ge);const Ae=r.Q.scale([],ge,ce+he),_e=r.Q.add([],ne.center,Ae);r.Q.transformMat4(ne.center,ne.center,H),r.Q.transformMat4(_e,_e,H);const Te=[ne.center[0],ne.center[1],_e[2]*M.pixelsPerMeter];r.Q.scale(Te,Te,1/M.worldSize);const Pe=r.aw(Te[0]),me=r.ax(Te[1]),be=Math.min(M._zoomFromMercatorZ(Te[2]),I.maxZoom),Ze=new r.bq(Pe,me);return M.mercatorFromTransition&&be<.5*(r.bJ+r.bA)?(M.setProjection({name:"globe"}),M.zoom=be,this._cameraForBounds(M,o,f,_,y,b)):{center:Ze,zoom:be,bearing:_,pitch:y}}fitBounds(n,o,f){const _=this.cameraForBounds(n,o);return this._fitInternal(_,o,f)}fitScreenCoordinates(n,o,f,_,y){const b=r.P.convert(n),M=r.P.convert(o),I=new r.P(Math.min(b.x,M.x),Math.min(b.y,M.y)),D=new r.P(Math.max(b.x,M.x),Math.max(b.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,M))return this;const z=this.transform.pointLocation3D(I),k=this.transform.pointLocation3D(D),F=this.transform.pointLocation3D(new r.P(I.x,D.y)),N=this.transform.pointLocation3D(new r.P(D.x,I.y)),G=[Math.min(z.lng,k.lng,F.lng,N.lng),Math.min(z.lat,k.lat,F.lat,N.lat)],U=[Math.max(z.lng,k.lng,F.lng,N.lng),Math.max(z.lat,k.lat,F.lat,N.lat)],$=_&&_.pitch?_.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,G,U,f,$,_);return this._fitInternal(q,_,y)}_fitInternal(n,o,f){return n?(o=r.e(n,o)).linear?this.easeTo(o,f):this.flyTo(o,f):this}jumpTo(n,o){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,b=!1;return"zoom"in n&&f.zoom!==+n.zoom&&(_=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=r.bq.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(y=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(b=!0,f.pitch=+n.pitch),n.padding==null||f.isPaddingEqual(n.padding)||(f.padding=n.padding),n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new r.b("movestart",o)).fire(new r.b("move",o)),_&&this.fire(new r.b("zoomstart",o)).fire(new r.b("zoom",o)).fire(new r.b("zoomend",o)),y&&this.fire(new r.b("rotatestart",o)).fire(new r.b("rotate",o)).fire(new r.b("rotateend",o)),b&&this.fire(new r.b("pitchstart",o)).fire(new r.b("pitch",o)).fire(new r.b("pitchend",o)),this.fire(new r.b("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Hp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,o){const f=this.transform;if(!f.projection.supportsFreeCamera)return r.w(Hp),this;this.stop();const _=f.zoom,y=f.pitch,b=f.bearing;f.setFreeCameraOptions(n);const M=_!==f.zoom,I=y!==f.pitch,D=b!==f.bearing;return this.fire(new r.b("movestart",o)).fire(new r.b("move",o)),M&&this.fire(new r.b("zoomstart",o)).fire(new r.b("zoom",o)).fire(new r.b("zoomend",o)),D&&this.fire(new r.b("rotatestart",o)).fire(new r.b("rotate",o)).fire(new r.b("rotateend",o)),I&&this.fire(new r.b("pitchstart",o)).fire(new r.b("pitch",o)).fire(new r.b("pitchend",o)),this.fire(new r.b("moveend",o)),this}easeTo(n,o){this._stop(!1,n.easeId),((n=r.e({offset:[0,0],duration:500,easing:r.d8},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const f=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),M=this.getPadding(),I="zoom"in n?+n.zoom:_,D="bearing"in n?this._normalizeBearing(n.bearing,y):y,z="pitch"in n?+n.pitch:b,k=this._extendPadding(n.padding),F=r.P.convert(n.offset);let N,G,U;if(f.projection.name==="globe"){const ce=r.O.fromLngLat(f.center),ge=F.rotate(-f.angle);ce.x+=ge.x/f.worldSize,ce.y+=ge.y/f.worldSize;const Ae=ce.toLngLat(),_e=r.bq.convert(n.center||Ae);this._normalizeCenter(_e),N=f.centerPoint.add(ge),G=new r.P(ce.x,ce.y).mult(f.worldSize),U=new r.P(r.a8(_e.lng),r.ah(_e.lat)).mult(f.worldSize).sub(G)}else{N=f.centerPoint.add(F);const ce=f.pointLocation(N),ge=r.bq.convert(n.center||ce);this._normalizeCenter(ge),G=f.project(ce),U=f.project(ge).sub(G)}const $=f.zoomScale(I-_);let q,Y;n.around&&(q=r.bq.convert(n.around),Y=f.locationPoint(q));const re=this._zooming||I!==_,ne=this._rotating||y!==D,oe=this._pitching||z!==b,H=!f.isPaddingEqual(k),J=ce=>ge=>{if(re&&(ce.zoom=r.X(_,I,ge)),ne&&(ce.bearing=r.X(y,D,ge)),oe&&(ce.pitch=r.X(b,z,ge)),H&&(ce.interpolatePadding(M,k,ge),N=ce.centerPoint.add(F)),q)ce.setLocationAtPoint(q,Y);else{const Ae=ce.zoomScale(ce.zoom-_),_e=I>_?Math.min(2,$):Math.max(.5,$),Te=Math.pow(_e,1-ge),Pe=ce.unproject(G.add(U.mult(ge*Te)).mult(Ae));ce.setLocationAtPoint(ce.renderWorldCopies?Pe.wrap():Pe,N)}return n.preloadOnly||this._fireMoveEvents(o),ce};if(n.preloadOnly){const ce=this._emulate(J,n.duration,f);return this._preloadTiles(ce),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ne,this._pitching=oe,this._padding=H,this._easeId=n.easeId,this._prepareEase(o,n.noMoveStart,he),this._ease(J(f),ce=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(o,ce)},n),this}_prepareEase(n,o,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||f.moving||this.fire(new r.b("movestart",n)),this._zooming&&!f.zooming&&this.fire(new r.b("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new r.b("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new r.b("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.b("move",n)),this._zooming&&this.fire(new r.b("zoom",n)),this._rotating&&this.fire(new r.b("rotate",n)),this._pitching&&this.fire(new r.b("pitch",n))}_afterEase(n,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new r.b("zoomend",n)),_&&this.fire(new r.b("rotateend",n)),y&&this.fire(new r.b("pitchend",n)),this.fire(new r.b("moveend",n))}flyTo(n,o){if(this._prefersReducedMotion(n)){const Se=r.af(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Se,o)}this.stop(),n=r.e({offset:[0,0],speed:1.2,curve:1.42,easing:r.d8},n);const f=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),M=this.getPadding(),I="zoom"in n?r.ad(+n.zoom,f.minZoom,f.maxZoom):_,D="bearing"in n?this._normalizeBearing(n.bearing,y):y,z="pitch"in n?+n.pitch:b,k=this._extendPadding(n.padding),F=f.zoomScale(I-_),N=r.P.convert(n.offset);let G=f.centerPoint.add(N);const U=f.pointLocation(G),$=r.bq.convert(n.center||U);this._normalizeCenter($);const q=f.project(U),Y=f.project($).sub(q);let re=n.curve;const ne=Math.max(f.width,f.height),oe=ne/F,H=Y.mag();if("minZoom"in n){const Se=r.ad(Math.min(n.minZoom,_,I),f.minZoom,f.maxZoom),Ie=ne/f.zoomScale(Se-_);re=Math.sqrt(Ie/H*2)}const J=re*re;function he(Se){const Ie=(oe*oe-ne*ne+(Se?-1:1)*J*J*H*H)/(2*(Se?oe:ne)*J*H);return Math.log(Math.sqrt(Ie*Ie+1)-Ie)}function ce(Se){return(Math.exp(Se)-Math.exp(-Se))/2}function ge(Se){return(Math.exp(Se)+Math.exp(-Se))/2}const Ae=he(0);let _e=function(Se){return ge(Ae)/ge(Ae+re*Se)},Te=function(Se){return ne*((ge(Ae)*(ce(Ie=Ae+re*Se)/ge(Ie))-ce(Ae))/J)/H;var Ie},Pe=(he(1)-Ae)/re;if(Math.abs(H)<1e-6||!isFinite(Pe)){if(Math.abs(ne-oe)<1e-6)return this.easeTo(n,o);const Se=oe<ne?-1:1;Pe=Math.abs(Math.log(oe/ne))/re,Te=function(){return 0},_e=function(Ie){return Math.exp(Se*re*Ie)}}n.duration="duration"in n?+n.duration:1e3*Pe/("screenSpeed"in n?+n.screenSpeed/re:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const me=y!==D,be=z!==b,Ze=!f.isPaddingEqual(k),ye=Se=>Ie=>{const se=Ie*Pe,je=1/_e(se);Se.zoom=Ie===1?I:_+Se.scaleZoom(je),me&&(Se.bearing=r.X(y,D,Ie)),be&&(Se.pitch=r.X(b,z,Ie)),Ze&&(Se.interpolatePadding(M,k,Ie),G=Se.centerPoint.add(N));const vt=Ie===1?$:Se.unproject(q.add(Y.mult(Te(se))).mult(je));return Se.setLocationAtPoint(Se.renderWorldCopies?vt.wrap():vt,G),Se._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(o),Se};if(n.preloadOnly){const Se=this._emulate(ye,n.duration,f);return this._preloadTiles(Se),this}return this._zooming=!0,this._rotating=me,this._pitching=be,this._padding=Ze,this._prepareEase(o,!1),this._ease(ye(f),()=>this._afterEase(o),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,o)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,o,f){f.animate===!1||f.duration===0?(n(1),o()):(this._easeStart=r.f.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((r.f.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,o){n=r.bk(n,-180,180);const f=Math.abs(n-o);return Math.abs(n-360-o)<f&&(n-=360),Math.abs(n+360-o)<f&&(n+=360),n}_normalizeCenter(n){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const f=n.lng-o.center.lng;n.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.f.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,o,f){const _=Math.ceil(15*o/1e3),y=[],b=n(f.clone());for(let M=0;M<=_;M++){const I=b(M/_);y.push(I.clone())}return y}_preloadTiles(n,o){}}class Td{constructor(n={}){this.options=n,r.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const o=this.options&&this.options.compact;return this._map=n,this._container=fe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=fe("button","mapboxgl-ctrl-attrib-button",this._container),fe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=fe("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,o){const f=this._map._getUIString(`AttributionControl.${o}`);n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.dd.ACCESS_TOKEN}];if(n){const f=o.reduce((_,y,b)=>(y.value&&(_+=`${y.key}=${y.value}${b<o.length-1?"&":""}`),_),"?");n.href=`${r.dd.FEEDBACK_URL}/${f}#${Lp(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const o=this._map.style._mergedSourceCaches;for(const _ in o){const y=o[_];if(y.used){const b=y.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort((_,y)=>_.length-y.length),n=n.filter((_,y)=>{for(let b=y+1;b<n.length;b++)if(n[b].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Zp{constructor(){r.a$(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=fe("div","mapboxgl-ctrl");const o=fe("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const o in n){const f=n[o].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Fu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const o=++this._id;return this._queue.push({callback:n,id:o,cancelled:!1}),o}remove(n){const o=this._currentlyRunning,f=o?this._queue.concat(o):this._queue;for(const _ of f)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const f of o)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Bu(h,n,o){if(h=new r.bq(h.lng,h.lat),n){const f=new r.bq(h.lng-360,h.lat),_=new r.bq(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-o.center.lng)/360),b=o.locationPoint(h).distSqr(n),M=n.x<0||n.y<0||n.x>o.width||n.y>o.height;o.locationPoint(f).distSqr(n)<b&&(M||Math.abs(f.lng-o.center.lng)<y)?h=f:o.locationPoint(_).distSqr(n)<b&&(M||Math.abs(_.lng-o.center.lng)<y)&&(h=_)}for(;Math.abs(h.lng-o.center.lng)>180;){const f=o.locationPoint(h);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;h.lng>o.center.lng?h.lng-=360:h.lng+=360}return h}const La={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class tc extends r.E{constructor(n,o){if(super(),(n instanceof HTMLElement||o)&&(n=r.e({element:n},o)),r.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=fe("div");const y=41,b=27,M=Le("svg",{display:"block",height:y*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${y}`},this._element),I=Le("radialGradient",{id:"shadowGradient"},Le("defs",{},M));Le("stop",{offset:"10%","stop-opacity":.4},I),Le("stop",{offset:"100%","stop-opacity":.05},I),Le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=r.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const f=this._element.classList;for(const y in La)f.remove(`mapboxgl-marker-anchor-${y}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=n&&n.className?n.className.trim().split(/\s+/):[];f.add(..._),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.bq.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const o=n.code,f=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const o=n.originalEvent.target,f=this._element;this._popup&&(o===f||f.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,o=this._pos;if(!n||!o)return!1;const f=n.unproject(o),_=n.getFreeCameraOptions();if(!_.position)return!1;const y=_.position.toLngLat();return y.distanceTo(f)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const o=this._pos;if(!o||o.x<0||o.x>n.transform.width||o.y<0||o.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(o);let _;n._showingGlobe()&&r.de(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${La[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const n=this._pos,o=this._map,f=this.getPitchAlignment();if(!o||!n||f!=="map")return"";if(!o._showingGlobe()){const I=o.getPitch();return I?`rotateX(${I}deg)`:""}const _=r.bI(r.df(o.transform,this._lngLat)),y=n.sub(r.dg(o.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";const M=_/b;return`rotateX(${-y.y*M}deg) rotateY(${y.x*M}deg)`}_calculateZTransform(){const n=this._pos,o=this._map;if(!o||!n)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(o._showingGlobe()){const y=o.project(new r.bq(this._lngLat.lng,this._lngLat.lat+.001)),b=o.project(new r.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);f=r.bI(Math.atan2(b.y,b.x))-90}else f=-o.getBearing();else if(_==="horizon"){const y=r.S(4,6,o.getZoom()),b=r.dg(o.transform);b.y+=y*o.transform.height;const M=n.sub(b),I=r.bI(Math.atan2(M.y,M.x));f=(I>90?I-270:I+90)*(1-y)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Bu(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const o=this._map;if(!o)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const y=this._clickTolerance||o._clickTolerance;if(n.point.dist(f)<y)return;this._isDragging=!0}this._pos=n.point.sub(_),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.b("dragstart"))),this.fire(new r.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.b("dragend")),this._state="inactive"}_addDragHandler(n){const o=this._map,f=this._pos;o&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const o=this._map;return o&&(n?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ic={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Qp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nc(h=new r.P(0,0),n="bottom"){if(typeof h=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(n){case"top":return new r.P(0,h);case"top-left":return new r.P(o,o);case"top-right":return new r.P(-o,o);case"bottom":return new r.P(0,-h);case"bottom-left":return new r.P(o,-o);case"bottom-right":return new r.P(-o,-o);case"left":return new r.P(h,0);case"right":return new r.P(-h,0)}return new r.P(0,0)}return h instanceof r.P||Array.isArray(h)?r.P.convert(h):r.P.convert(h[n]||[0,0])}class Nu{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const o=r.ch((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,o,f){this._start=this.getValue(o),this._end=n,this._startTime=o,this._endTime=o+f}}class Xp{registerParameter(n,o,f,_,y){}registerButton(n,o,f){}registerBinding(n,o,f,_){}refreshUI(){}}const wo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ds={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},ka={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vu{constructor(n,o,f=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new gd({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new Xo({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(n,o){this.mouseRotate.mousedown(n,o),this.mousePitch&&this.mousePitch.mousedown(n,o),lt()}move(n,o){const f=this.map,_=this.mouseRotate.mousemoveWindow(n,o),y=_&&_.bearingDelta;if(y&&f.setBearing(f.getBearing()+y),this.mousePitch){const b=this.mousePitch.mousemoveWindow(n,o),M=b&&b.pitchDelta;M&&f.setPitch(f.getPitch()+M)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){dt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.e({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ut(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ut(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Yt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Yt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const St={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Yp={maxWidth:100,unit:"metric"},Kp={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.du,supported:W,setRTLTextPlugin:r.dw,getRTLTextPluginStatus:r.dx,Map:class extends Pg{constructor(h){const n=h;if((h=r.e({},Ds,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&r.dh(window)&&(h.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new cu(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Fu,this._domRenderTaskQueue=new Fu,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aF(),this._locale=r.e({},wo,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.di(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?{...h.contextCreateOptions}:{},typeof h.container=="string"){const o=document.getElementById(h.container);if(!o)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=o}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),r.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=h.devtools?new Xp(this):new Xp,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ec(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||r.dd.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new Eg(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const o=h.bounds;o&&(this.resize(),this.fitBounds(o,r.e({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Td({customAttribution:h.customAttribution})),this._logoControl=new Zp,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new r.b(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new r.b(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(h,n){if(n===void 0&&(n=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new r.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=h.onAdd(this);this._controls.push(h);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(o,f.firstChild):f.appendChild(o),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new r.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(h);return n>-1&&this._controls.splice(n,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new r.b("movestart",h)).fire(new r.b("move",h)),this.fire(new r.b("resize",h)),n&&this.fire(new r.b("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(r.ag.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(n=>n==="auto"?navigator.language:n):h}setLanguage(h){const n=this._parseLanguage(h);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,n=h.projection.name;let o;n==="globe"&&h.zoom>=r.bA?(h.setMercatorFromTransition(),o=!0):n==="mercator"&&h.zoom<r.bA&&(h.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,n){return this._updateProjection(h||n||{name:"mercator"})}_updateProjection(h){let n;return n=h.name==="globe"&&this.transform.zoom>=r.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(r.bq.convert(h))}unproject(h){return this.transform.pointLocation3D(r.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,n,o){if(h==="mouseenter"||h==="mouseover"){let f=!1;const _=b=>{const M=n.filter(D=>this.getLayer(D)),I=M.length?this.queryRenderedFeatures(b.point,{layers:M}):[];I.length?f||(f=!0,o.call(this,new cr(h,this,b.originalEvent,{features:I}))):f=!1},y=()=>{f=!1};return{layers:new Set(n),listener:o,delegates:{mousemove:_,mouseout:y}}}if(h==="mouseleave"||h==="mouseout"){let f=!1;const _=b=>{const M=n.filter(I=>this.getLayer(I));(M.length?this.queryRenderedFeatures(b.point,{layers:M}):[]).length?f=!0:f&&(f=!1,o.call(this,new cr(h,this,b.originalEvent)))},y=b=>{f&&(f=!1,o.call(this,new cr(h,this,b.originalEvent)))};return{layers:new Set(n),listener:o,delegates:{mousemove:_,mouseout:y}}}{const f=_=>{const y=n.filter(M=>this.getLayer(M)),b=y.length?this.queryRenderedFeatures(_.point,{layers:y}):[];b.length&&(_.features=b,o.call(this,_),delete _.features)};return{layers:new Set(n),listener:o,delegates:{[h]:f}}}}on(h,n,o){if(o===void 0)return super.on(h,n);if(Array.isArray(n)||(n=[n]),n){for(const _ of n)if(!this._isValidId(_))return this}const f=this._createDelegatedListener(h,n,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(h,n,o){if(o===void 0)return super.once(h,n);if(Array.isArray(n)||(n=[n]),n){for(const _ of n)if(!this._isValidId(_))return this}const f=this._createDelegatedListener(h,n,o);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(h,n,o){if(o===void 0)return super.off(h,n);n=new Set(Array.isArray(n)?n:[n]);for(const y of n)if(!this._isValidId(y))return this;const f=(y,b)=>{if(y.size!==b.size)return!1;for(const M of y)if(!b.has(M))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(y=>{for(let b=0;b<y.length;b++){const M=y[b];if(M.listener===o&&f(M.layers,n)){for(const I in M.delegates)this.off(I,M.delegates[I]);return y.splice(b,1),this}}})(_),this}queryRenderedFeatures(h,n){if(!this.style)return[];if(n!==void 0||h===void 0||h instanceof r.P||Array.isArray(h)||(n=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(const o of n.layers)if(!this._isValidId(o))return[]}return this.style.queryRenderedFeatures(h,n,this.transform)}querySourceFeatures(h,n){return this._isValidId(h)?this.style.querySourceFeatures(h,n):[]}isPointOnSurface(h){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(h))}setStyle(h,n){return n=r.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&h&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(h,(o,f)=>{o?(r.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(h,n)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(h,n))}_getUIString(h){const n=this._locale[h];if(n==null)throw new Error(`Missing UI string '${h}'`);return n}_updateStyle(h,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const o=r.e({},n);n&&n.config&&(o.initialConfig=n.config,delete o.config),this.style=new ms(this,o).setEventedParent(this,{style:this.style}).load(h)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ms(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new r.a(new Error("IDs can't be empty."))),!1):!r.c9(h)||(this.fire(new r.a(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}addSource(h,n){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,n),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,n,o){this._lazyInitEmptyStyle(),this.style.addSourceType(h,n,o)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,n,{pixelRatio:o=1,sdf:f=!1,stretchX:_,stretchY:y,content:b}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:M,height:I,data:D}=r.f.getImageData(n);this.style.addImage(h,{data:new r.h({width:M,height:I},D),pixelRatio:o,stretchX:_,stretchY:y,content:b,sdf:f,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:I}=n,D=n;this.style.addImage(h,{data:new r.h({width:M,height:I},new Uint8Array(D.data)),pixelRatio:o,stretchX:_,stretchY:y,content:b,sdf:f,version:0,userImage:D}),D.onAdd&&D.onAdd(this,h)}}updateImage(h,n){this._lazyInitEmptyStyle();const o=this.style.getImage(h);if(!o)return void this.fire(new r.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?r.f.getImageData(n):n,{width:_,height:y}=f,b=f.data;if(_===void 0||y===void 0)return void this.fire(new r.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==o.data.width||y!==o.data.height)return void this.fire(new r.a(new Error(`The width and height of the updated image (${_}, ${y})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));const M=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);o.data.replace(b,M),this.style.updateImage(h,o)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new r.a(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,n){r.d(this._requestManager.transformRequest(h,r.R.Image),(o,f)=>{n(o,f instanceof HTMLImageElement?r.f.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(h,n){this._lazyInitEmptyStyle(),this.style.addModel(h,n)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new r.a(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,n){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,n),this._update(!0)):this}getSlot(h){const n=this.getLayer(h);return n&&n.slot||null}setSlot(h,n){return this.style.setSlot(h,n),this.style.mergeLayers(),this._update(!0)}addImport(h,n){return this.style.addImport(h,n),this}updateImport(h,n){return typeof n!="string"&&n.id!==h?(this.removeImport(h),this.addImport(n)):(this.style.updateImport(h,n),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,n){return this.style.moveImport(h,n),this._update(!0)}moveLayer(h,n){return this._isValidId(h)?(this.style.moveLayer(h,n),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){return this._isValidId(h)?this.style.getOwnLayer(h):null}setLayerZoomRange(h,n,o){return this._isValidId(h)?(this.style.setLayerZoomRange(h,n,o),this._update(!0)):this}setFilter(h,n,o={}){return this._isValidId(h)?(this.style.setFilter(h,n,o),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,n,o,f={}){return this._isValidId(h)?(this.style.setPaintProperty(h,n,o,f),this._update(!0)):this}getPaintProperty(h,n){return this._isValidId(h)?this.style.getPaintProperty(h,n):null}setLayoutProperty(h,n,o,f={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,n,o,f),this._update(!0)):this}getLayoutProperty(h,n){return this._isValidId(h)?this.style.getLayoutProperty(h,n):null}getSchema(h){return this.style.getSchema(h)}setSchema(h,n){return this.style.setSchema(h,n),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,n){return this.style.setConfig(h,n),this._update(!0)}getConfigProperty(h,n){return this.style.getConfigProperty(h,n)}setConfigProperty(h,n,o){return this.style.setConfigProperty(h,n,o),this._update(!0)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const n=h[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bq.convert(h),this.transform):0}setFeatureState(h,n){return this._isValidId(h.source)?(this.style.setFeatureState(h,n),this._update()):this}removeFeatureState(h,n){return this._isValidId(h.source)?(this.style.removeFeatureState(h,n),this._update()):this}getFeatureState(h){return this._isValidId(h.source)?this.style.getFeatureState(h):null}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let o,f,_,y=this._container;for(;y&&(!f||!_);){const b=window.getComputedStyle(y).transform;b&&b!=="none"&&(o=b.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(f=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(_=o[3])),y=y.parentElement}this._containerWidth=f?Math.abs(h/f):h,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=fe("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=fe("div","mapboxgl-canvas-container",h);this._canvas=fe("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=fe("div","mapboxgl-control-container",h),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{f[_]=fe("div",`mapboxgl-ctrl-${_}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,n){const o=r.f.devicePixelRatio||1;this._canvas.width=o*Math.ceil(h),this._canvas.height=o*Math.ceil(n),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${n}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const n=this._markers.indexOf(h);n!==-1&&this._markers.splice(n,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const n=this._popups.indexOf(h);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const h=r.e({},W.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",h);n?(r.dj(n,!0),this.painter=new Rp(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.dk.testSupport(n)):this.fire(new r.a(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.b("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new r.b("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let n;this.fire(new r.b("renderstart"));const o=this.painter.context.extTimerQuery,f=r.f.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=_.createQuery(),_.beginQuery(o.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,D=this.transform.pitch,z=r.f.now(),k=new r.N(I,{now:z,fadeDuration:y,pitch:D,transition:this.style.transition});this.style.update(k)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const I=r.f.now()-f;_.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const D=_.getQueryParameter(n,_.QUERY_RESULT)/1e6;_.deleteQuery(n),this.fire(new r.b("gpu-timing-frame",{cpuTime:I,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(I);this.fire(new r.b("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(I);this.fire(new r.b("gpu-timing-deferred-render",{gpuTime:D}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(M||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new r.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new r.b("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,this._performanceMetricsCollection&&r.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const n of this._markers)h&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!h||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(h,n=!1){const o=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(n||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=h;const b=Math.abs(_-y);if(b>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(y),o(y);this._averageElevation.easeTo(y,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(y),o(y)}return!!this._averageElevation.isEasing(h)&&o(this._averageElevation.getValue(h))}_authenticate(){r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===r.dn||h.status===401)){const n=this.painter.context.gl;r.dj(n,!1),this._logoControl instanceof Zp&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const o=this.painter.context.gl,f=o.createFramebuffer();function _(y){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,y,0);const b=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,b),b}return o.bindFramebuffer(o.FRAMEBUFFER,f),this._canvasPixelComparison(_(h),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(h,n,o){let f=o[1]-o[0];const _=h.length/4;for(let y=0;y<n.length;y++){const b=n[y];let M=0;for(let I=0;I<b.length;I+=4)b[I]===h[I]&&b[I+1]===h[I+1]&&b[I+2]===h[I+2]&&b[I+3]===h[I+3]&&(M+=1);f+=(o[y+2]-o[y+1])*(1-M/_)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dr(this.painter.context.gl),r.ds.remove(),r.dt.remove(),this._removed=!0,this.fire(new r.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=r.f.frame(n=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(n)}))}_preloadTiles(h){const n=this.style?this.style.getSourceCaches():[];return r.b4(n,(o,f)=>o._preloadTiles(h,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,n){r.dv(h,n)}get version(){return r.du}},NavigationControl:class{constructor(h){this.options=r.e({},ka,h),this._container=fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),fe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),fe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:n}):o.resetNorth({},{originalEvent:n}))}),this._compassIcon=fe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const n=h.getZoom(),o=n===h.getMaxZoom(),f=n===h.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vu(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,n){const o=fe("button",h,this._container);return o.type="button",o.addEventListener("click",n),o}_setButtonTitle(h,n){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${n}`);h.setAttribute("aria-label",o),h.firstElementChild&&h.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends r.E{constructor(h){super();const n=navigator.geolocation;this.options=r.e({geolocation:n},St,h),r.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=zp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const n=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,h(o)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>n(o.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(h){const n=this._map.getMaxBounds(),o=h.coords;return!!n&&(o.longitude<n.getWest()||o.longitude>n.getEast()||o.latitude<n.getSouth()||o.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new r.b("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("geolocate",h)),this._finish()}}_updateCamera(h){const n=new r.bq(h.coords.longitude,h.coords.latitude),o=h.coords.accuracy,f=this._map.getBearing(),_=r.e({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(o),_,{geolocateSource:!0})}_updateMarker(h){if(h){const n=new r.bq(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,n=r.bo(1,h._center.lat)*h.worldSize,o=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=fe("button","mapboxgl-ctrl-geolocate",this._container),fe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=fe("div","mapboxgl-user-location"),this._dotElement.appendChild(fe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(fe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new tc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=fe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new tc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.b("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Td,ScaleControl:class{constructor(h){this.options=r.e({},Yp,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,n=this._map,o=n._containerHeight/2,f=n._containerWidth/2-h/2,_=n.unproject([f,o]),y=n.unproject([f+h,o]),b=_.distanceTo(y);if(this.options.unit==="imperial"){const M=3.2808*b;M>5280?this._setScale(h,M/5280,"mile"):this._setScale(h,M,"foot")}else this.options.unit==="nautical"?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,n,o){this._map._requestDomTask(()=>{const f=function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let M=y/b;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(I){const D=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*D)/D}(M),b*M}(n),_=f/n;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(f):`${f}&nbsp;${Kp[o]}`,this._container.style.width=h*_+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=fe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:r.w("Full screen control 'container' must be a DOM element.")),r.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=fe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);fe("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(h){super(),this.options=r.e(Object.create(ic),h),r.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new r.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new r.b("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=r.bq.convert(h),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const n=document.createDocumentFragment(),o=document.createElement("body");let f;for(o.innerHTML=h;f=o.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=fe("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(h),this.options.closeButton){const o=this._closeButton=fe("button","mapboxgl-popup-close-button",n);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let n;return this._classList.delete(h)?n=!1:(this._classList.add(h),n=!0),this._updateClassList(),n}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const n=this._map,o=this._container,f=this._pos;if(!n||!o||!f)return"bottom";const _=o.offsetWidth,y=o.offsetHeight,b=f.x<_/2,M=f.x>n.transform.width-_/2;if(f.y+h<y)return b?"top-left":M?"top-right":"top";if(f.y>n.transform.height-y){if(b)return"bottom-left";if(M)return"bottom-right"}return b?"left":M?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),h.className=n.join(" ")}_update(h){const n=this._map,o=this._content;if(!n||!this._lngLat&&!this._trackPointer||!o)return;let f=this._container;if(f||(f=this._container=fe("div","mapboxgl-popup",n.getContainer()),this._tip=fe("div","mapboxgl-popup-tip",f),f.appendChild(o)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bu(this._lngLat,this._pos,n.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:n.project(this._lngLat),y=nc(this.options.offset),b=this._anchor=this._getAnchor(y.y),M=nc(this.options.offset,b),I=_.add(M).round();n._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${La[b]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&n._showingGlobe()){const _=r.de(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Qp);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:tc,Style:ms,LngLat:r.bq,LngLatBounds:r.ag,Point:r.P,MercatorCoordinate:r.O,FreeCameraOptions:xa,Evented:r.E,config:r.dd,prewarm:r.dy,clearPrewarmedResources:r.dz,get accessToken(){return r.dd.ACCESS_TOKEN},set accessToken(h){r.dd.ACCESS_TOKEN=h},get baseApiUrl(){return r.dd.API_URL},set baseApiUrl(h){r.dd.API_URL=h},get workerCount(){return r.dA.workerCount},set workerCount(h){r.dA.workerCount=h},get maxParallelImageRequests(){return r.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){r.dd.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){r.dB(h)},get workerUrl(){return r.dC.workerUrl},set workerUrl(h){r.dC.workerUrl=h},get workerClass(){return r.dC.workerClass},set workerClass(h){r.dC.workerClass=h},get workerParams(){return r.dC.workerParams},set workerParams(h){r.dC.workerParams=h},get dracoUrl(){return r.dD()},set dracoUrl(h){r.dE(h)},get meshoptUrl(){return r.dF()},set meshoptUrl(h){r.dG(h)},setNow:r.f.setNow,restoreNow:r.f.restoreNow}});var P=T;return P})})(WM);var ZM=WM.exports;const QM=QD(ZM),Vn=Q_({selectedFeature:{},formData:{},map:{}});function XD(c){for(var a={},d,m,x,T=0;T<c.geometry.coordinates.length;T++){c.geometry.coordinates.length===1?d=c.geometry.coordinates[0]:d=c.geometry.coordinates[T][0];for(var E=0;E<d.length;E++)x=d[E][0],m=d[E][1],a.xMin=a.xMin<x?a.xMin:x,a.xMax=a.xMax>x?a.xMax:x,a.yMin=a.yMin<m?a.yMin:m,a.yMax=a.yMax>m?a.yMax:m}return a}const XM=(c,a)=>{const d=c.__vccOpts||c;for(const[m,x]of a)d[m]=x;return d};QM.accessToken="pk.eyJ1IjoibW1vbHRhIiwiYSI6ImNqZDBkMDZhYjJ6YzczNHJ4cno5eTcydnMifQ.RJNJ7s7hBfrJITOBZBdcOA";const YD={props:["modelValue"],data:()=>({map:null}),mounted(){const{lng:c,lat:a,zoom:d,bearing:m,pitch:x}=this.modelValue;new ZM.LngLatBounds([[-76.09405517578125,39.49211914385648],[-74.32525634765625,40.614734298694216]]);const T=new QM.Map({container:this.$refs.mapContainer,style:"mapbox://styles/mapbox/light-v11",center:[-75.2273,40.071],bearing:m,pitch:x,zoom:d});Vn.map=T,T.on("load",()=>{T.addSource("parcels",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),T.addLayer({id:"parcels-fill",type:"fill",source:"parcels",layout:{},paint:{"fill-color":"#1868d1","fill-opacity":["case",["boolean",["feature-state","click"],!1],.8,.2]}})}),T.on("click","parcels-fill",E=>{Vn.selectedFeature=E.features[0],T.removeFeatureState({source:"parcels"}),T.setFeatureState({source:"parcels",id:Vn.selectedFeature.id},{click:!0}),Vn.formData={}}),this.map=T,zc(()=>Vn.selectedFeature,E=>{if(Object.keys(E).length){T.getSource("parcels").setData(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=${encodeURI(JSON.stringify({rings:[...E.geometry.coordinates],spatialReference:{wkid:4326}}))}&geometryType=esriGeometryPolygon&inSR=&spatialRel=esriSpatialRelEnvelopeIntersects&resultType=none&distance=&units=esriSRUnit_Meter&relationParam=&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&returnEnvelope=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&defaultSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token=`);const P=XD(E),{xMin:r,xMax:B,yMin:W,yMax:Z}=P;r&&T.fitBounds([[r,W],[B,Z]],{maxZoom:17})}})},unmounted(){this.map.remove(),this.map=null}},KD={ref:"mapContainer",class:"map-container"};function JD(c,a,d,m,x,T){return Ns(),zo("div",KD,null,512)}const eR=XM(YD,[["render",JD]]),tR=["name","placeholder"],n_={__name:"TextField",props:VP({placeholder:String,name:String,required:Boolean},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const a=xD(c,"modelValue");return(d,m)=>EP((Ns(),zo("input",{class:"pvm-search-control-input",type:"text","onUpdate:modelValue":m[0]||(m[0]=x=>a.value=x),name:c.name,placeholder:c.placeholder,required:""},null,8,tR)),[[UD,a.value]])}},iR={props:{text:String}},nR={class:"btn"};function rR(c,a,d,m,x,T){return Ns(),zo("button",nR,gh(d.text),1)}const sR=XM(iR,[["render",rR]]);function oR(c,a){let d;return function(...m){d&&clearTimeout(d);const x=this;d=setTimeout(()=>{c.apply(x,m)},a)}}/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function Nf(c){return c+.5|0}const al=(c,a,d)=>Math.max(Math.min(c,d),a);function ff(c){return al(Nf(c*2.55),0,255)}function fl(c){return al(Nf(c*255),0,255)}function ua(c){return al(Nf(c/2.55)/100,0,1)}function Cw(c){return al(Nf(c*100),0,100)}const Bs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},N0=[..."0123456789ABCDEF"],aR=c=>N0[c&15],lR=c=>N0[(c&240)>>4]+N0[c&15],r_=c=>(c&240)>>4===(c&15),cR=c=>r_(c.r)&&r_(c.g)&&r_(c.b)&&r_(c.a);function uR(c){var a=c.length,d;return c[0]==="#"&&(a===4||a===5?d={r:255&Bs[c[1]]*17,g:255&Bs[c[2]]*17,b:255&Bs[c[3]]*17,a:a===5?Bs[c[4]]*17:255}:(a===7||a===9)&&(d={r:Bs[c[1]]<<4|Bs[c[2]],g:Bs[c[3]]<<4|Bs[c[4]],b:Bs[c[5]]<<4|Bs[c[6]],a:a===9?Bs[c[7]]<<4|Bs[c[8]]:255})),d}const hR=(c,a)=>c<255?a(c):"";function dR(c){var a=cR(c)?aR:lR;return c?"#"+a(c.r)+a(c.g)+a(c.b)+hR(c.a,a):void 0}const fR=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function YM(c,a,d){const m=a*Math.min(d,1-d),x=(T,E=(T+c/30)%12)=>d-m*Math.max(Math.min(E-3,9-E,1),-1);return[x(0),x(8),x(4)]}function pR(c,a,d){const m=(x,T=(x+c/60)%6)=>d-d*a*Math.max(Math.min(T,4-T,1),0);return[m(5),m(3),m(1)]}function mR(c,a,d){const m=YM(c,1,.5);let x;for(a+d>1&&(x=1/(a+d),a*=x,d*=x),x=0;x<3;x++)m[x]*=1-a-d,m[x]+=a;return m}function _R(c,a,d,m,x){return c===x?(a-d)/m+(a<d?6:0):a===x?(d-c)/m+2:(c-a)/m+4}function gx(c){const d=c.r/255,m=c.g/255,x=c.b/255,T=Math.max(d,m,x),E=Math.min(d,m,x),P=(T+E)/2;let r,B,W;return T!==E&&(W=T-E,B=P>.5?W/(2-T-E):W/(T+E),r=_R(d,m,x,W,T),r=r*60+.5),[r|0,B||0,P]}function yx(c,a,d,m){return(Array.isArray(a)?c(a[0],a[1],a[2]):c(a,d,m)).map(fl)}function xx(c,a,d){return yx(YM,c,a,d)}function gR(c,a,d){return yx(mR,c,a,d)}function yR(c,a,d){return yx(pR,c,a,d)}function KM(c){return(c%360+360)%360}function xR(c){const a=fR.exec(c);let d=255,m;if(!a)return;a[5]!==m&&(d=a[6]?ff(+a[5]):fl(+a[5]));const x=KM(+a[2]),T=+a[3]/100,E=+a[4]/100;return a[1]==="hwb"?m=gR(x,T,E):a[1]==="hsv"?m=yR(x,T,E):m=xx(x,T,E),{r:m[0],g:m[1],b:m[2],a:d}}function vR(c,a){var d=gx(c);d[0]=KM(d[0]+a),d=xx(d),c.r=d[0],c.g=d[1],c.b=d[2]}function bR(c){if(!c)return;const a=gx(c),d=a[0],m=Cw(a[1]),x=Cw(a[2]);return c.a<255?`hsla(${d}, ${m}%, ${x}%, ${ua(c.a)})`:`hsl(${d}, ${m}%, ${x}%)`}const Pw={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Dw={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function wR(){const c={},a=Object.keys(Dw),d=Object.keys(Pw);let m,x,T,E,P;for(m=0;m<a.length;m++){for(E=P=a[m],x=0;x<d.length;x++)T=d[x],P=P.replace(T,Pw[T]);T=parseInt(Dw[E],16),c[P]=[T>>16&255,T>>8&255,T&255]}return c}let s_;function TR(c){s_||(s_=wR(),s_.transparent=[0,0,0,0]);const a=s_[c.toLowerCase()];return a&&{r:a[0],g:a[1],b:a[2],a:a.length===4?a[3]:255}}const MR=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function SR(c){const a=MR.exec(c);let d=255,m,x,T;if(a){if(a[7]!==m){const E=+a[7];d=a[8]?ff(E):al(E*255,0,255)}return m=+a[1],x=+a[3],T=+a[5],m=255&(a[2]?ff(m):al(m,0,255)),x=255&(a[4]?ff(x):al(x,0,255)),T=255&(a[6]?ff(T):al(T,0,255)),{r:m,g:x,b:T,a:d}}}function ER(c){return c&&(c.a<255?`rgba(${c.r}, ${c.g}, ${c.b}, ${ua(c.a)})`:`rgb(${c.r}, ${c.g}, ${c.b})`)}const f0=c=>c<=.0031308?c*12.92:Math.pow(c,1/2.4)*1.055-.055,hh=c=>c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4);function AR(c,a,d){const m=hh(ua(c.r)),x=hh(ua(c.g)),T=hh(ua(c.b));return{r:fl(f0(m+d*(hh(ua(a.r))-m))),g:fl(f0(x+d*(hh(ua(a.g))-x))),b:fl(f0(T+d*(hh(ua(a.b))-T))),a:c.a+d*(a.a-c.a)}}function o_(c,a,d){if(c){let m=gx(c);m[a]=Math.max(0,Math.min(m[a]+m[a]*d,a===0?360:1)),m=xx(m),c.r=m[0],c.g=m[1],c.b=m[2]}}function JM(c,a){return c&&Object.assign(a||{},c)}function Rw(c){var a={r:0,g:0,b:0,a:255};return Array.isArray(c)?c.length>=3&&(a={r:c[0],g:c[1],b:c[2],a:255},c.length>3&&(a.a=fl(c[3]))):(a=JM(c,{r:0,g:0,b:0,a:1}),a.a=fl(a.a)),a}function IR(c){return c.charAt(0)==="r"?SR(c):xR(c)}class Rf{constructor(a){if(a instanceof Rf)return a;const d=typeof a;let m;d==="object"?m=Rw(a):d==="string"&&(m=uR(a)||TR(a)||IR(a)),this._rgb=m,this._valid=!!m}get valid(){return this._valid}get rgb(){var a=JM(this._rgb);return a&&(a.a=ua(a.a)),a}set rgb(a){this._rgb=Rw(a)}rgbString(){return this._valid?ER(this._rgb):void 0}hexString(){return this._valid?dR(this._rgb):void 0}hslString(){return this._valid?bR(this._rgb):void 0}mix(a,d){if(a){const m=this.rgb,x=a.rgb;let T;const E=d===T?.5:d,P=2*E-1,r=m.a-x.a,B=((P*r===-1?P:(P+r)/(1+P*r))+1)/2;T=1-B,m.r=255&B*m.r+T*x.r+.5,m.g=255&B*m.g+T*x.g+.5,m.b=255&B*m.b+T*x.b+.5,m.a=E*m.a+(1-E)*x.a,this.rgb=m}return this}interpolate(a,d){return a&&(this._rgb=AR(this._rgb,a._rgb,d)),this}clone(){return new Rf(this.rgb)}alpha(a){return this._rgb.a=fl(a),this}clearer(a){const d=this._rgb;return d.a*=1-a,this}greyscale(){const a=this._rgb,d=Nf(a.r*.3+a.g*.59+a.b*.11);return a.r=a.g=a.b=d,this}opaquer(a){const d=this._rgb;return d.a*=1+a,this}negate(){const a=this._rgb;return a.r=255-a.r,a.g=255-a.g,a.b=255-a.b,this}lighten(a){return o_(this._rgb,2,a),this}darken(a){return o_(this._rgb,2,-a),this}saturate(a){return o_(this._rgb,1,a),this}desaturate(a){return o_(this._rgb,1,-a),this}rotate(a){return vR(this._rgb,a),this}}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function aa(){}const CR=(()=>{let c=0;return()=>c++})();function wn(c){return c===null||typeof c>"u"}function jn(c){if(Array.isArray&&Array.isArray(c))return!0;const a=Object.prototype.toString.call(c);return a.slice(0,7)==="[object"&&a.slice(-6)==="Array]"}function an(c){return c!==null&&Object.prototype.toString.call(c)==="[object Object]"}function br(c){return(typeof c=="number"||c instanceof Number)&&isFinite(+c)}function Ts(c,a){return br(c)?c:a}function Fn(c,a){return typeof c>"u"?a:c}const PR=(c,a)=>typeof c=="string"&&c.endsWith("%")?parseFloat(c)/100:+c/a,eS=(c,a)=>typeof c=="string"&&c.endsWith("%")?parseFloat(c)/100*a:+c;function Zn(c,a,d){if(c&&typeof c.call=="function")return c.apply(d,a)}function xn(c,a,d,m){let x,T,E;if(jn(c))for(T=c.length,x=0;x<T;x++)a.call(d,c[x],x);else if(an(c))for(E=Object.keys(c),T=E.length,x=0;x<T;x++)a.call(d,c[E[x]],E[x])}function k_(c,a){let d,m,x,T;if(!c||!a||c.length!==a.length)return!1;for(d=0,m=c.length;d<m;++d)if(x=c[d],T=a[d],x.datasetIndex!==T.datasetIndex||x.index!==T.index)return!1;return!0}function O_(c){if(jn(c))return c.map(O_);if(an(c)){const a=Object.create(null),d=Object.keys(c),m=d.length;let x=0;for(;x<m;++x)a[d[x]]=O_(c[d[x]]);return a}return c}function tS(c){return["__proto__","prototype","constructor"].indexOf(c)===-1}function DR(c,a,d,m){if(!tS(c))return;const x=a[c],T=d[c];an(x)&&an(T)?zf(x,T,m):a[c]=O_(T)}function zf(c,a,d){const m=jn(a)?a:[a],x=m.length;if(!an(c))return c;d=d||{};const T=d.merger||DR;let E;for(let P=0;P<x;++P){if(E=m[P],!an(E))continue;const r=Object.keys(E);for(let B=0,W=r.length;B<W;++B)T(r[B],c,E,d)}return c}function Tf(c,a){return zf(c,a,{merger:RR})}function RR(c,a,d){if(!tS(c))return;const m=a[c],x=d[c];an(m)&&an(x)?Tf(m,x):Object.prototype.hasOwnProperty.call(a,c)||(a[c]=O_(x))}const zw={"":c=>c,x:c=>c.x,y:c=>c.y};function zR(c){const a=c.split("."),d=[];let m="";for(const x of a)m+=x,m.endsWith("\\")?m=m.slice(0,-1)+".":(d.push(m),m="");return d}function LR(c){const a=zR(c);return d=>{for(const m of a){if(m==="")break;d=d&&d[m]}return d}}function ml(c,a){return(zw[a]||(zw[a]=LR(a)))(c)}function vx(c){return c.charAt(0).toUpperCase()+c.slice(1)}const Lf=c=>typeof c<"u",_l=c=>typeof c=="function",Lw=(c,a)=>{if(c.size!==a.size)return!1;for(const d of c)if(!a.has(d))return!1;return!0};function kR(c){return c.type==="mouseup"||c.type==="click"||c.type==="contextmenu"}const Jn=Math.PI,os=2*Jn,F_=Number.POSITIVE_INFINITY,OR=Jn/180,Hr=Jn/2,Mc=Jn/4,kw=Jn*2/3,ll=Math.log10,pl=Math.sign;function M_(c,a,d){return Math.abs(c-a)<d}function Ow(c){const a=Math.round(c);c=M_(c,a,c/1e3)?a:c;const d=Math.pow(10,Math.floor(ll(c))),m=c/d;return(m<=1?1:m<=2?2:m<=5?5:10)*d}function FR(c){const a=[],d=Math.sqrt(c);let m;for(m=1;m<d;m++)c%m===0&&(a.push(m),a.push(c/m));return d===(d|0)&&a.push(d),a.sort((x,T)=>x-T).pop(),a}function B_(c){return!isNaN(parseFloat(c))&&isFinite(c)}function BR(c,a){const d=Math.round(c);return d-a<=c&&d+a>=c}function iS(c,a,d){let m,x,T;for(m=0,x=c.length;m<x;m++)T=c[m][d],isNaN(T)||(a.min=Math.min(a.min,T),a.max=Math.max(a.max,T))}function ao(c){return c*(Jn/180)}function bx(c){return c*(180/Jn)}function Fw(c){if(!br(c))return;let a=1,d=0;for(;Math.round(c*a)/a!==c;)a*=10,d++;return d}function NR(c,a){const d=a.x-c.x,m=a.y-c.y,x=Math.sqrt(d*d+m*m);let T=Math.atan2(m,d);return T<-.5*Jn&&(T+=os),{angle:T,distance:x}}function VR(c,a){return Math.sqrt(Math.pow(a.x-c.x,2)+Math.pow(a.y-c.y,2))}function Co(c){return(c%os+os)%os}function V0(c,a,d,m){const x=Co(c),T=Co(a),E=Co(d),P=Co(T-x),r=Co(E-x),B=Co(x-T),W=Co(x-E);return x===T||x===E||m&&T===E||P>r&&B<W}function lo(c,a,d){return Math.max(a,Math.min(d,c))}function jR(c){return lo(c,-32768,32767)}function Bw(c,a,d,m=1e-6){return c>=Math.min(a,d)-m&&c<=Math.max(a,d)+m}function wx(c,a,d){d=d||(E=>c[E]<a);let m=c.length-1,x=0,T;for(;m-x>1;)T=x+m>>1,d(T)?x=T:m=T;return{lo:x,hi:m}}const j0=(c,a,d,m)=>wx(c,d,m?x=>{const T=c[x][a];return T<d||T===d&&c[x+1][a]===d}:x=>c[x][a]<d),UR=(c,a,d)=>wx(c,d,m=>c[m][a]>=d);function GR(c,a,d){let m=0,x=c.length;for(;m<x&&c[m]<a;)m++;for(;x>m&&c[x-1]>d;)x--;return m>0||x<c.length?c.slice(m,x):c}const nS=["push","pop","shift","splice","unshift"];function $R(c,a){if(c._chartjs){c._chartjs.listeners.push(a);return}Object.defineProperty(c,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[a]}}),nS.forEach(d=>{const m="_onData"+vx(d),x=c[d];Object.defineProperty(c,d,{configurable:!0,enumerable:!1,value(...T){const E=x.apply(this,T);return c._chartjs.listeners.forEach(P=>{typeof P[m]=="function"&&P[m](...T)}),E}})})}function Nw(c,a){const d=c._chartjs;if(!d)return;const m=d.listeners,x=m.indexOf(a);x!==-1&&m.splice(x,1),!(m.length>0)&&(nS.forEach(T=>{delete c[T]}),delete c._chartjs)}function rS(c){const a=new Set(c);return a.size===c.length?c:Array.from(a)}const sS=function(){return typeof window>"u"?function(c){return c()}:window.requestAnimationFrame}();function oS(c,a){let d=[],m=!1;return function(...x){d=x,m||(m=!0,sS.call(window,()=>{m=!1,c.apply(a,d)}))}}function qR(c,a){let d;return function(...m){return a?(clearTimeout(d),d=setTimeout(c,a,m)):c.apply(this,m),a}}const aS=c=>c==="start"?"left":c==="end"?"right":"center",Mf=(c,a,d)=>c==="start"?a:c==="end"?d:(a+d)/2,a_=c=>c===0||c===1,Vw=(c,a,d)=>-(Math.pow(2,10*(c-=1))*Math.sin((c-a)*os/d)),jw=(c,a,d)=>Math.pow(2,-10*c)*Math.sin((c-a)*os/d)+1,Sf={linear:c=>c,easeInQuad:c=>c*c,easeOutQuad:c=>-c*(c-2),easeInOutQuad:c=>(c/=.5)<1?.5*c*c:-.5*(--c*(c-2)-1),easeInCubic:c=>c*c*c,easeOutCubic:c=>(c-=1)*c*c+1,easeInOutCubic:c=>(c/=.5)<1?.5*c*c*c:.5*((c-=2)*c*c+2),easeInQuart:c=>c*c*c*c,easeOutQuart:c=>-((c-=1)*c*c*c-1),easeInOutQuart:c=>(c/=.5)<1?.5*c*c*c*c:-.5*((c-=2)*c*c*c-2),easeInQuint:c=>c*c*c*c*c,easeOutQuint:c=>(c-=1)*c*c*c*c+1,easeInOutQuint:c=>(c/=.5)<1?.5*c*c*c*c*c:.5*((c-=2)*c*c*c*c+2),easeInSine:c=>-Math.cos(c*Hr)+1,easeOutSine:c=>Math.sin(c*Hr),easeInOutSine:c=>-.5*(Math.cos(Jn*c)-1),easeInExpo:c=>c===0?0:Math.pow(2,10*(c-1)),easeOutExpo:c=>c===1?1:-Math.pow(2,-10*c)+1,easeInOutExpo:c=>a_(c)?c:c<.5?.5*Math.pow(2,10*(c*2-1)):.5*(-Math.pow(2,-10*(c*2-1))+2),easeInCirc:c=>c>=1?c:-(Math.sqrt(1-c*c)-1),easeOutCirc:c=>Math.sqrt(1-(c-=1)*c),easeInOutCirc:c=>(c/=.5)<1?-.5*(Math.sqrt(1-c*c)-1):.5*(Math.sqrt(1-(c-=2)*c)+1),easeInElastic:c=>a_(c)?c:Vw(c,.075,.3),easeOutElastic:c=>a_(c)?c:jw(c,.075,.3),easeInOutElastic(c){return a_(c)?c:c<.5?.5*Vw(c*2,.1125,.45):.5+.5*jw(c*2-1,.1125,.45)},easeInBack(c){return c*c*((1.70158+1)*c-1.70158)},easeOutBack(c){return(c-=1)*c*((1.70158+1)*c+1.70158)+1},easeInOutBack(c){let a=1.70158;return(c/=.5)<1?.5*(c*c*(((a*=1.525)+1)*c-a)):.5*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)},easeInBounce:c=>1-Sf.easeOutBounce(1-c),easeOutBounce(c){return c<1/2.75?7.5625*c*c:c<2/2.75?7.5625*(c-=1.5/2.75)*c+.75:c<2.5/2.75?7.5625*(c-=2.25/2.75)*c+.9375:7.5625*(c-=2.625/2.75)*c+.984375},easeInOutBounce:c=>c<.5?Sf.easeInBounce(c*2)*.5:Sf.easeOutBounce(c*2-1)*.5+.5};function lS(c){if(c&&typeof c=="object"){const a=c.toString();return a==="[object CanvasPattern]"||a==="[object CanvasGradient]"}return!1}function Uw(c){return lS(c)?c:new Rf(c)}function p0(c){return lS(c)?c:new Rf(c).saturate(.5).darken(.1).hexString()}const WR=["x","y","borderWidth","radius","tension"],HR=["color","borderColor","backgroundColor"];function ZR(c){c.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),c.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:a=>a!=="onProgress"&&a!=="onComplete"&&a!=="fn"}),c.set("animations",{colors:{type:"color",properties:HR},numbers:{type:"number",properties:WR}}),c.describe("animations",{_fallback:"animation"}),c.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:a=>a|0}}}})}function QR(c){c.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Gw=new Map;function XR(c,a){a=a||{};const d=c+JSON.stringify(a);let m=Gw.get(d);return m||(m=new Intl.NumberFormat(c,a),Gw.set(d,m)),m}function Vf(c,a,d){return XR(a,d).format(c)}const cS={values(c){return jn(c)?c:""+c},numeric(c,a,d){if(c===0)return"0";const m=this.chart.options.locale;let x,T=c;if(d.length>1){const B=Math.max(Math.abs(d[0].value),Math.abs(d[d.length-1].value));(B<1e-4||B>1e15)&&(x="scientific"),T=YR(c,d)}const E=ll(Math.abs(T)),P=isNaN(E)?1:Math.max(Math.min(-1*Math.floor(E),20),0),r={notation:x,minimumFractionDigits:P,maximumFractionDigits:P};return Object.assign(r,this.options.ticks.format),Vf(c,m,r)},logarithmic(c,a,d){if(c===0)return"0";const m=d[a].significand||c/Math.pow(10,Math.floor(ll(c)));return[1,2,3,5,10,15].includes(m)||a>.8*d.length?cS.numeric.call(this,c,a,d):""}};function YR(c,a){let d=a.length>3?a[2].value-a[1].value:a[1].value-a[0].value;return Math.abs(d)>=1&&c!==Math.floor(c)&&(d=c-Math.floor(c)),d}var ng={formatters:cS};function KR(c){c.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(a,d)=>d.lineWidth,tickColor:(a,d)=>d.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:ng.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),c.route("scale.ticks","color","","color"),c.route("scale.grid","color","","borderColor"),c.route("scale.border","color","","borderColor"),c.route("scale.title","color","","color"),c.describe("scale",{_fallback:!1,_scriptable:a=>!a.startsWith("before")&&!a.startsWith("after")&&a!=="callback"&&a!=="parser",_indexable:a=>a!=="borderDash"&&a!=="tickBorderDash"&&a!=="dash"}),c.describe("scales",{_fallback:"scale"}),c.describe("scale.ticks",{_scriptable:a=>a!=="backdropPadding"&&a!=="callback",_indexable:a=>a!=="backdropPadding"})}const Bc=Object.create(null),U0=Object.create(null);function Ef(c,a){if(!a)return c;const d=a.split(".");for(let m=0,x=d.length;m<x;++m){const T=d[m];c=c[T]||(c[T]=Object.create(null))}return c}function m0(c,a,d){return typeof a=="string"?zf(Ef(c,a),d):zf(Ef(c,""),a)}class JR{constructor(a,d){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=m=>m.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(m,x)=>p0(x.backgroundColor),this.hoverBorderColor=(m,x)=>p0(x.borderColor),this.hoverColor=(m,x)=>p0(x.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(a),this.apply(d)}set(a,d){return m0(this,a,d)}get(a){return Ef(this,a)}describe(a,d){return m0(U0,a,d)}override(a,d){return m0(Bc,a,d)}route(a,d,m,x){const T=Ef(this,a),E=Ef(this,m),P="_"+d;Object.defineProperties(T,{[P]:{value:T[d],writable:!0},[d]:{enumerable:!0,get(){const r=this[P],B=E[x];return an(r)?Object.assign({},B,r):Fn(r,B)},set(r){this[P]=r}}})}apply(a){a.forEach(d=>d(this))}}var Kn=new JR({_scriptable:c=>!c.startsWith("on"),_indexable:c=>c!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[ZR,QR,KR]);function ez(c){return!c||wn(c.size)||wn(c.family)?null:(c.style?c.style+" ":"")+(c.weight?c.weight+" ":"")+c.size+"px "+c.family}function N_(c,a,d,m,x){let T=a[x];return T||(T=a[x]=c.measureText(x).width,d.push(x)),T>m&&(m=T),m}function tz(c,a,d,m){m=m||{};let x=m.data=m.data||{},T=m.garbageCollect=m.garbageCollect||[];m.font!==a&&(x=m.data={},T=m.garbageCollect=[],m.font=a),c.save(),c.font=a;let E=0;const P=d.length;let r,B,W,Z,ae;for(r=0;r<P;r++)if(Z=d[r],Z!=null&&!jn(Z))E=N_(c,x,T,E,Z);else if(jn(Z))for(B=0,W=Z.length;B<W;B++)ae=Z[B],ae!=null&&!jn(ae)&&(E=N_(c,x,T,E,ae));c.restore();const fe=T.length/2;if(fe>d.length){for(r=0;r<fe;r++)delete x[T[r]];T.splice(0,fe)}return E}function Sc(c,a,d){const m=c.currentDevicePixelRatio,x=d!==0?Math.max(d/2,.5):0;return Math.round((a-x)*m)/m+x}function $w(c,a){!a&&!c||(a=a||c.getContext("2d"),a.save(),a.resetTransform(),a.clearRect(0,0,c.width,c.height),a.restore())}function qw(c,a,d,m){iz(c,a,d,m)}function iz(c,a,d,m,x){let T,E,P,r,B,W,Z,ae;const fe=a.pointStyle,Le=a.rotation,De=a.radius;let Ve=(Le||0)*OR;if(fe&&typeof fe=="object"&&(T=fe.toString(),T==="[object HTMLImageElement]"||T==="[object HTMLCanvasElement]")){c.save(),c.translate(d,m),c.rotate(Ve),c.drawImage(fe,-fe.width/2,-fe.height/2,fe.width,fe.height),c.restore();return}if(!(isNaN(De)||De<=0)){switch(c.beginPath(),fe){default:c.arc(d,m,De,0,os),c.closePath();break;case"triangle":W=De,c.moveTo(d+Math.sin(Ve)*W,m-Math.cos(Ve)*De),Ve+=kw,c.lineTo(d+Math.sin(Ve)*W,m-Math.cos(Ve)*De),Ve+=kw,c.lineTo(d+Math.sin(Ve)*W,m-Math.cos(Ve)*De),c.closePath();break;case"rectRounded":B=De*.516,r=De-B,E=Math.cos(Ve+Mc)*r,Z=Math.cos(Ve+Mc)*r,P=Math.sin(Ve+Mc)*r,ae=Math.sin(Ve+Mc)*r,c.arc(d-Z,m-P,B,Ve-Jn,Ve-Hr),c.arc(d+ae,m-E,B,Ve-Hr,Ve),c.arc(d+Z,m+P,B,Ve,Ve+Hr),c.arc(d-ae,m+E,B,Ve+Hr,Ve+Jn),c.closePath();break;case"rect":if(!Le){r=Math.SQRT1_2*De,W=r,c.rect(d-W,m-r,2*W,2*r);break}Ve+=Mc;case"rectRot":Z=Math.cos(Ve)*De,E=Math.cos(Ve)*De,P=Math.sin(Ve)*De,ae=Math.sin(Ve)*De,c.moveTo(d-Z,m-P),c.lineTo(d+ae,m-E),c.lineTo(d+Z,m+P),c.lineTo(d-ae,m+E),c.closePath();break;case"crossRot":Ve+=Mc;case"cross":Z=Math.cos(Ve)*De,E=Math.cos(Ve)*De,P=Math.sin(Ve)*De,ae=Math.sin(Ve)*De,c.moveTo(d-Z,m-P),c.lineTo(d+Z,m+P),c.moveTo(d+ae,m-E),c.lineTo(d-ae,m+E);break;case"star":Z=Math.cos(Ve)*De,E=Math.cos(Ve)*De,P=Math.sin(Ve)*De,ae=Math.sin(Ve)*De,c.moveTo(d-Z,m-P),c.lineTo(d+Z,m+P),c.moveTo(d+ae,m-E),c.lineTo(d-ae,m+E),Ve+=Mc,Z=Math.cos(Ve)*De,E=Math.cos(Ve)*De,P=Math.sin(Ve)*De,ae=Math.sin(Ve)*De,c.moveTo(d-Z,m-P),c.lineTo(d+Z,m+P),c.moveTo(d+ae,m-E),c.lineTo(d-ae,m+E);break;case"line":E=Math.cos(Ve)*De,P=Math.sin(Ve)*De,c.moveTo(d-E,m-P),c.lineTo(d+E,m+P);break;case"dash":c.moveTo(d,m),c.lineTo(d+Math.cos(Ve)*De,m+Math.sin(Ve)*De);break;case!1:c.closePath();break}c.fill(),a.borderWidth>0&&c.stroke()}}function ph(c,a,d){return d=d||.5,!a||c&&c.x>a.left-d&&c.x<a.right+d&&c.y>a.top-d&&c.y<a.bottom+d}function uS(c,a){c.save(),c.beginPath(),c.rect(a.left,a.top,a.right-a.left,a.bottom-a.top),c.clip()}function hS(c){c.restore()}function nz(c,a){a.translation&&c.translate(a.translation[0],a.translation[1]),wn(a.rotation)||c.rotate(a.rotation),a.color&&(c.fillStyle=a.color),a.textAlign&&(c.textAlign=a.textAlign),a.textBaseline&&(c.textBaseline=a.textBaseline)}function rz(c,a,d,m,x){if(x.strikethrough||x.underline){const T=c.measureText(m),E=a-T.actualBoundingBoxLeft,P=a+T.actualBoundingBoxRight,r=d-T.actualBoundingBoxAscent,B=d+T.actualBoundingBoxDescent,W=x.strikethrough?(r+B)/2:B;c.strokeStyle=c.fillStyle,c.beginPath(),c.lineWidth=x.decorationWidth||2,c.moveTo(E,W),c.lineTo(P,W),c.stroke()}}function sz(c,a){const d=c.fillStyle;c.fillStyle=a.color,c.fillRect(a.left,a.top,a.width,a.height),c.fillStyle=d}function kf(c,a,d,m,x,T={}){const E=jn(a)?a:[a],P=T.strokeWidth>0&&T.strokeColor!=="";let r,B;for(c.save(),c.font=x.string,nz(c,T),r=0;r<E.length;++r)B=E[r],T.backdrop&&sz(c,T.backdrop),P&&(T.strokeColor&&(c.strokeStyle=T.strokeColor),wn(T.strokeWidth)||(c.lineWidth=T.strokeWidth),c.strokeText(B,d,m,T.maxWidth)),c.fillText(B,d,m,T.maxWidth),rz(c,d,m,B,T),m+=Number(x.lineHeight);c.restore()}function V_(c,a){const{x:d,y:m,w:x,h:T,radius:E}=a;c.arc(d+E.topLeft,m+E.topLeft,E.topLeft,1.5*Jn,Jn,!0),c.lineTo(d,m+T-E.bottomLeft),c.arc(d+E.bottomLeft,m+T-E.bottomLeft,E.bottomLeft,Jn,Hr,!0),c.lineTo(d+x-E.bottomRight,m+T),c.arc(d+x-E.bottomRight,m+T-E.bottomRight,E.bottomRight,Hr,0,!0),c.lineTo(d+x,m+E.topRight),c.arc(d+x-E.topRight,m+E.topRight,E.topRight,0,-Hr,!0),c.lineTo(d+E.topLeft,m)}const oz=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,az=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function lz(c,a){const d=(""+c).match(oz);if(!d||d[1]==="normal")return a*1.2;switch(c=+d[2],d[3]){case"px":return c;case"%":c/=100;break}return a*c}const cz=c=>+c||0;function dS(c,a){const d={},m=an(a),x=m?Object.keys(a):a,T=an(c)?m?E=>Fn(c[E],c[a[E]]):E=>c[E]:()=>c;for(const E of x)d[E]=cz(T(E));return d}function fS(c){return dS(c,{top:"y",right:"x",bottom:"y",left:"x"})}function xh(c){return dS(c,["topLeft","topRight","bottomLeft","bottomRight"])}function Ss(c){const a=fS(c);return a.width=a.left+a.right,a.height=a.top+a.bottom,a}function Zr(c,a){c=c||{},a=a||Kn.font;let d=Fn(c.size,a.size);typeof d=="string"&&(d=parseInt(d,10));let m=Fn(c.style,a.style);m&&!(""+m).match(az)&&(console.warn('Invalid font style specified: "'+m+'"'),m=void 0);const x={family:Fn(c.family,a.family),lineHeight:lz(Fn(c.lineHeight,a.lineHeight),d),size:d,style:m,weight:Fn(c.weight,a.weight),string:""};return x.string=ez(x),x}function l_(c,a,d,m){let x,T,E;for(x=0,T=c.length;x<T;++x)if(E=c[x],E!==void 0&&E!==void 0)return E}function uz(c,a,d){const{min:m,max:x}=c,T=eS(a,(x-m)/2),E=(P,r)=>d&&P===0?0:P+r;return{min:E(m,-Math.abs(T)),max:E(x,T)}}function jc(c,a){return Object.assign(Object.create(c),a)}function Tx(c,a=[""],d,m,x=()=>c[0]){const T=d||c;typeof m>"u"&&(m=gS("_fallback",c));const E={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:c,_rootScopes:T,_fallback:m,_getTarget:x,override:P=>Tx([P,...c],a,T,m)};return new Proxy(E,{deleteProperty(P,r){return delete P[r],delete P._keys,delete c[0][r],!0},get(P,r){return mS(P,r,()=>yz(r,a,c,P))},getOwnPropertyDescriptor(P,r){return Reflect.getOwnPropertyDescriptor(P._scopes[0],r)},getPrototypeOf(){return Reflect.getPrototypeOf(c[0])},has(P,r){return Hw(P).includes(r)},ownKeys(P){return Hw(P)},set(P,r,B){const W=P._storage||(P._storage=x());return P[r]=W[r]=B,delete P._keys,!0}})}function bh(c,a,d,m){const x={_cacheable:!1,_proxy:c,_context:a,_subProxy:d,_stack:new Set,_descriptors:pS(c,m),setContext:T=>bh(c,T,d,m),override:T=>bh(c.override(T),a,d,m)};return new Proxy(x,{deleteProperty(T,E){return delete T[E],delete c[E],!0},get(T,E,P){return mS(T,E,()=>dz(T,E,P))},getOwnPropertyDescriptor(T,E){return T._descriptors.allKeys?Reflect.has(c,E)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(c,E)},getPrototypeOf(){return Reflect.getPrototypeOf(c)},has(T,E){return Reflect.has(c,E)},ownKeys(){return Reflect.ownKeys(c)},set(T,E,P){return c[E]=P,delete T[E],!0}})}function pS(c,a={scriptable:!0,indexable:!0}){const{_scriptable:d=a.scriptable,_indexable:m=a.indexable,_allKeys:x=a.allKeys}=c;return{allKeys:x,scriptable:d,indexable:m,isScriptable:_l(d)?d:()=>d,isIndexable:_l(m)?m:()=>m}}const hz=(c,a)=>c?c+vx(a):a,Mx=(c,a)=>an(a)&&c!=="adapters"&&(Object.getPrototypeOf(a)===null||a.constructor===Object);function mS(c,a,d){if(Object.prototype.hasOwnProperty.call(c,a)||a==="constructor")return c[a];const m=d();return c[a]=m,m}function dz(c,a,d){const{_proxy:m,_context:x,_subProxy:T,_descriptors:E}=c;let P=m[a];return _l(P)&&E.isScriptable(a)&&(P=fz(a,P,c,d)),jn(P)&&P.length&&(P=pz(a,P,c,E.isIndexable)),Mx(a,P)&&(P=bh(P,x,T&&T[a],E)),P}function fz(c,a,d,m){const{_proxy:x,_context:T,_subProxy:E,_stack:P}=d;if(P.has(c))throw new Error("Recursion detected: "+Array.from(P).join("->")+"->"+c);P.add(c);let r=a(T,E||m);return P.delete(c),Mx(c,r)&&(r=Sx(x._scopes,x,c,r)),r}function pz(c,a,d,m){const{_proxy:x,_context:T,_subProxy:E,_descriptors:P}=d;if(typeof T.index<"u"&&m(c))return a[T.index%a.length];if(an(a[0])){const r=a,B=x._scopes.filter(W=>W!==r);a=[];for(const W of r){const Z=Sx(B,x,c,W);a.push(bh(Z,T,E&&E[c],P))}}return a}function _S(c,a,d){return _l(c)?c(a,d):c}const mz=(c,a)=>c===!0?a:typeof c=="string"?ml(a,c):void 0;function _z(c,a,d,m,x){for(const T of a){const E=mz(d,T);if(E){c.add(E);const P=_S(E._fallback,d,x);if(typeof P<"u"&&P!==d&&P!==m)return P}else if(E===!1&&typeof m<"u"&&d!==m)return null}return!1}function Sx(c,a,d,m){const x=a._rootScopes,T=_S(a._fallback,d,m),E=[...c,...x],P=new Set;P.add(m);let r=Ww(P,E,d,T||d,m);return r===null||typeof T<"u"&&T!==d&&(r=Ww(P,E,T,r,m),r===null)?!1:Tx(Array.from(P),[""],x,T,()=>gz(a,d,m))}function Ww(c,a,d,m,x){for(;d;)d=_z(c,a,d,m,x);return d}function gz(c,a,d){const m=c._getTarget();a in m||(m[a]={});const x=m[a];return jn(x)&&an(d)?d:x||{}}function yz(c,a,d,m){let x;for(const T of a)if(x=gS(hz(T,c),d),typeof x<"u")return Mx(c,x)?Sx(d,m,c,x):x}function gS(c,a){for(const d of a){if(!d)continue;const m=d[c];if(typeof m<"u")return m}}function Hw(c){let a=c._keys;return a||(a=c._keys=xz(c._scopes)),a}function xz(c){const a=new Set;for(const d of c)for(const m of Object.keys(d).filter(x=>!x.startsWith("_")))a.add(m);return Array.from(a)}function vz(c,a,d,m){const{iScale:x}=c,{key:T="r"}=this._parsing,E=new Array(m);let P,r,B,W;for(P=0,r=m;P<r;++P)B=P+d,W=a[B],E[P]={r:x.parse(ml(W,T),B)};return E}function Ex(){return typeof window<"u"&&typeof document<"u"}function Ax(c){let a=c.parentNode;return a&&a.toString()==="[object ShadowRoot]"&&(a=a.host),a}function j_(c,a,d){let m;return typeof c=="string"?(m=parseInt(c,10),c.indexOf("%")!==-1&&(m=m/100*a.parentNode[d])):m=c,m}const rg=c=>c.ownerDocument.defaultView.getComputedStyle(c,null);function bz(c,a){return rg(c).getPropertyValue(a)}const wz=["top","right","bottom","left"];function Lc(c,a,d){const m={};d=d?"-"+d:"";for(let x=0;x<4;x++){const T=wz[x];m[T]=parseFloat(c[a+"-"+T+d])||0}return m.width=m.left+m.right,m.height=m.top+m.bottom,m}const Tz=(c,a,d)=>(c>0||a>0)&&(!d||!d.shadowRoot);function Mz(c,a){const d=c.touches,m=d&&d.length?d[0]:c,{offsetX:x,offsetY:T}=m;let E=!1,P,r;if(Tz(x,T,c.target))P=x,r=T;else{const B=a.getBoundingClientRect();P=m.clientX-B.left,r=m.clientY-B.top,E=!0}return{x:P,y:r,box:E}}function Ic(c,a){if("native"in c)return c;const{canvas:d,currentDevicePixelRatio:m}=a,x=rg(d),T=x.boxSizing==="border-box",E=Lc(x,"padding"),P=Lc(x,"border","width"),{x:r,y:B,box:W}=Mz(c,d),Z=E.left+(W&&P.left),ae=E.top+(W&&P.top);let{width:fe,height:Le}=a;return T&&(fe-=E.width+P.width,Le-=E.height+P.height),{x:Math.round((r-Z)/fe*d.width/m),y:Math.round((B-ae)/Le*d.height/m)}}function Sz(c,a,d){let m,x;if(a===void 0||d===void 0){const T=c&&Ax(c);if(!T)a=c.clientWidth,d=c.clientHeight;else{const E=T.getBoundingClientRect(),P=rg(T),r=Lc(P,"border","width"),B=Lc(P,"padding");a=E.width-B.width-r.width,d=E.height-B.height-r.height,m=j_(P.maxWidth,T,"clientWidth"),x=j_(P.maxHeight,T,"clientHeight")}}return{width:a,height:d,maxWidth:m||F_,maxHeight:x||F_}}const c_=c=>Math.round(c*10)/10;function Ez(c,a,d,m){const x=rg(c),T=Lc(x,"margin"),E=j_(x.maxWidth,c,"clientWidth")||F_,P=j_(x.maxHeight,c,"clientHeight")||F_,r=Sz(c,a,d);let{width:B,height:W}=r;if(x.boxSizing==="content-box"){const ae=Lc(x,"border","width"),fe=Lc(x,"padding");B-=fe.width+ae.width,W-=fe.height+ae.height}return B=Math.max(0,B-T.width),W=Math.max(0,m?B/m:W-T.height),B=c_(Math.min(B,E,r.maxWidth)),W=c_(Math.min(W,P,r.maxHeight)),B&&!W&&(W=c_(B/2)),(a!==void 0||d!==void 0)&&m&&r.height&&W>r.height&&(W=r.height,B=c_(Math.floor(W*m))),{width:B,height:W}}function Zw(c,a,d){const m=a||1,x=Math.floor(c.height*m),T=Math.floor(c.width*m);c.height=Math.floor(c.height),c.width=Math.floor(c.width);const E=c.canvas;return E.style&&(d||!E.style.height&&!E.style.width)&&(E.style.height=`${c.height}px`,E.style.width=`${c.width}px`),c.currentDevicePixelRatio!==m||E.height!==x||E.width!==T?(c.currentDevicePixelRatio=m,E.height=x,E.width=T,c.ctx.setTransform(m,0,0,m,0,0),!0):!1}const Az=function(){let c=!1;try{const a={get passive(){return c=!0,!1}};Ex()&&(window.addEventListener("test",null,a),window.removeEventListener("test",null,a))}catch{}return c}();function Qw(c,a){const d=bz(c,a),m=d&&d.match(/^(\d+)(\.\d+)?px$/);return m?+m[1]:void 0}const Iz=function(c,a){return{x(d){return c+c+a-d},setWidth(d){a=d},textAlign(d){return d==="center"?d:d==="right"?"left":"right"},xPlus(d,m){return d-m},leftForLtr(d,m){return d-m}}},Cz=function(){return{x(c){return c},setWidth(c){},textAlign(c){return c},xPlus(c,a){return c+a},leftForLtr(c,a){return c}}};function _0(c,a,d){return c?Iz(a,d):Cz()}function Pz(c,a){let d,m;(a==="ltr"||a==="rtl")&&(d=c.canvas.style,m=[d.getPropertyValue("direction"),d.getPropertyPriority("direction")],d.setProperty("direction",a,"important"),c.prevTextDirection=m)}function Dz(c,a){a!==void 0&&(delete c.prevTextDirection,c.canvas.style.setProperty("direction",a[0],a[1]))}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class Rz{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(a,d,m,x){const T=d.listeners[x],E=d.duration;T.forEach(P=>P({chart:a,initial:d.initial,numSteps:E,currentStep:Math.min(m-d.start,E)}))}_refresh(){this._request||(this._running=!0,this._request=sS.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(a=Date.now()){let d=0;this._charts.forEach((m,x)=>{if(!m.running||!m.items.length)return;const T=m.items;let E=T.length-1,P=!1,r;for(;E>=0;--E)r=T[E],r._active?(r._total>m.duration&&(m.duration=r._total),r.tick(a),P=!0):(T[E]=T[T.length-1],T.pop());P&&(x.draw(),this._notify(x,m,a,"progress")),T.length||(m.running=!1,this._notify(x,m,a,"complete"),m.initial=!1),d+=T.length}),this._lastDate=a,d===0&&(this._running=!1)}_getAnims(a){const d=this._charts;let m=d.get(a);return m||(m={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},d.set(a,m)),m}listen(a,d,m){this._getAnims(a).listeners[d].push(m)}add(a,d){!d||!d.length||this._getAnims(a).items.push(...d)}has(a){return this._getAnims(a).items.length>0}start(a){const d=this._charts.get(a);d&&(d.running=!0,d.start=Date.now(),d.duration=d.items.reduce((m,x)=>Math.max(m,x._duration),0),this._refresh())}running(a){if(!this._running)return!1;const d=this._charts.get(a);return!(!d||!d.running||!d.items.length)}stop(a){const d=this._charts.get(a);if(!d||!d.items.length)return;const m=d.items;let x=m.length-1;for(;x>=0;--x)m[x].cancel();d.items=[],this._notify(a,d,Date.now(),"complete")}remove(a){return this._charts.delete(a)}}var la=new Rz;const Xw="transparent",zz={boolean(c,a,d){return d>.5?a:c},color(c,a,d){const m=Uw(c||Xw),x=m.valid&&Uw(a||Xw);return x&&x.valid?x.mix(m,d).hexString():a},number(c,a,d){return c+(a-c)*d}};class Lz{constructor(a,d,m,x){const T=d[m];x=l_([a.to,x,T,a.from]);const E=l_([a.from,T,x]);this._active=!0,this._fn=a.fn||zz[a.type||typeof E],this._easing=Sf[a.easing]||Sf.linear,this._start=Math.floor(Date.now()+(a.delay||0)),this._duration=this._total=Math.floor(a.duration),this._loop=!!a.loop,this._target=d,this._prop=m,this._from=E,this._to=x,this._promises=void 0}active(){return this._active}update(a,d,m){if(this._active){this._notify(!1);const x=this._target[this._prop],T=m-this._start,E=this._duration-T;this._start=m,this._duration=Math.floor(Math.max(E,a.duration)),this._total+=T,this._loop=!!a.loop,this._to=l_([a.to,d,x,a.from]),this._from=l_([a.from,x,d])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(a){const d=a-this._start,m=this._duration,x=this._prop,T=this._from,E=this._loop,P=this._to;let r;if(this._active=T!==P&&(E||d<m),!this._active){this._target[x]=P,this._notify(!0);return}if(d<0){this._target[x]=T;return}r=d/m%2,r=E&&r>1?2-r:r,r=this._easing(Math.min(1,Math.max(0,r))),this._target[x]=this._fn(T,P,r)}wait(){const a=this._promises||(this._promises=[]);return new Promise((d,m)=>{a.push({res:d,rej:m})})}_notify(a){const d=a?"res":"rej",m=this._promises||[];for(let x=0;x<m.length;x++)m[x][d]()}}class yS{constructor(a,d){this._chart=a,this._properties=new Map,this.configure(d)}configure(a){if(!an(a))return;const d=Object.keys(Kn.animation),m=this._properties;Object.getOwnPropertyNames(a).forEach(x=>{const T=a[x];if(!an(T))return;const E={};for(const P of d)E[P]=T[P];(jn(T.properties)&&T.properties||[x]).forEach(P=>{(P===x||!m.has(P))&&m.set(P,E)})})}_animateOptions(a,d){const m=d.options,x=Oz(a,m);if(!x)return[];const T=this._createAnimations(x,m);return m.$shared&&kz(a.options.$animations,m).then(()=>{a.options=m},()=>{}),T}_createAnimations(a,d){const m=this._properties,x=[],T=a.$animations||(a.$animations={}),E=Object.keys(d),P=Date.now();let r;for(r=E.length-1;r>=0;--r){const B=E[r];if(B.charAt(0)==="$")continue;if(B==="options"){x.push(...this._animateOptions(a,d));continue}const W=d[B];let Z=T[B];const ae=m.get(B);if(Z)if(ae&&Z.active()){Z.update(ae,W,P);continue}else Z.cancel();if(!ae||!ae.duration){a[B]=W;continue}T[B]=Z=new Lz(ae,a,B,W),x.push(Z)}return x}update(a,d){if(this._properties.size===0){Object.assign(a,d);return}const m=this._createAnimations(a,d);if(m.length)return la.add(this._chart,m),!0}}function kz(c,a){const d=[],m=Object.keys(a);for(let x=0;x<m.length;x++){const T=c[m[x]];T&&T.active()&&d.push(T.wait())}return Promise.all(d)}function Oz(c,a){if(!a)return;let d=c.options;if(!d){c.options=a;return}return d.$shared&&(c.options=d=Object.assign({},d,{$shared:!1,$animations:{}})),d}function Yw(c,a){const d=c&&c.options||{},m=d.reverse,x=d.min===void 0?a:0,T=d.max===void 0?a:0;return{start:m?T:x,end:m?x:T}}function Fz(c,a,d){if(d===!1)return!1;const m=Yw(c,d),x=Yw(a,d);return{top:x.end,right:m.end,bottom:x.start,left:m.start}}function Bz(c){let a,d,m,x;return an(c)?(a=c.top,d=c.right,m=c.bottom,x=c.left):a=d=m=x=c,{top:a,right:d,bottom:m,left:x,disabled:c===!1}}function xS(c,a){const d=[],m=c._getSortedDatasetMetas(a);let x,T;for(x=0,T=m.length;x<T;++x)d.push(m[x].index);return d}function Kw(c,a,d,m={}){const x=c.keys,T=m.mode==="single";let E,P,r,B;if(a!==null){for(E=0,P=x.length;E<P;++E){if(r=+x[E],r===d){if(m.all)continue;break}B=c.values[r],br(B)&&(T||a===0||pl(a)===pl(B))&&(a+=B)}return a}}function Nz(c,a){const{iScale:d,vScale:m}=a,x=d.axis==="x"?"x":"y",T=m.axis==="x"?"x":"y",E=Object.keys(c),P=new Array(E.length);let r,B,W;for(r=0,B=E.length;r<B;++r)W=E[r],P[r]={[x]:W,[T]:c[W]};return P}function Jw(c,a){const d=c&&c.options.stacked;return d||d===void 0&&a.stack!==void 0}function Vz(c,a,d){return`${c.id}.${a.id}.${d.stack||d.type}`}function jz(c){const{min:a,max:d,minDefined:m,maxDefined:x}=c.getUserBounds();return{min:m?a:Number.NEGATIVE_INFINITY,max:x?d:Number.POSITIVE_INFINITY}}function Uz(c,a,d){const m=c[a]||(c[a]={});return m[d]||(m[d]={})}function eT(c,a,d,m){for(const x of a.getMatchingVisibleMetas(m).reverse()){const T=c[x.index];if(d&&T>0||!d&&T<0)return x.index}return null}function tT(c,a){const{chart:d,_cachedMeta:m}=c,x=d._stacks||(d._stacks={}),{iScale:T,vScale:E,index:P}=m,r=T.axis,B=E.axis,W=Vz(T,E,m),Z=a.length;let ae;for(let fe=0;fe<Z;++fe){const Le=a[fe],{[r]:De,[B]:Ve}=Le,Ye=Le._stacks||(Le._stacks={});ae=Ye[B]=Uz(x,W,De),ae[P]=Ve,ae._top=eT(ae,E,!0,m.type),ae._bottom=eT(ae,E,!1,m.type);const lt=ae._visualValues||(ae._visualValues={});lt[P]=Ve}}function g0(c,a){const d=c.scales;return Object.keys(d).filter(m=>d[m].axis===a).shift()}function Gz(c,a){return jc(c,{active:!1,dataset:void 0,datasetIndex:a,index:a,mode:"default",type:"dataset"})}function $z(c,a,d){return jc(c,{active:!1,dataIndex:a,parsed:void 0,raw:void 0,element:d,index:a,mode:"default",type:"data"})}function sf(c,a){const d=c.controller.index,m=c.vScale&&c.vScale.axis;if(m){a=a||c._parsed;for(const x of a){const T=x._stacks;if(!T||T[m]===void 0||T[m][d]===void 0)return;delete T[m][d],T[m]._visualValues!==void 0&&T[m]._visualValues[d]!==void 0&&delete T[m]._visualValues[d]}}}const y0=c=>c==="reset"||c==="none",iT=(c,a)=>a?c:Object.assign({},c),qz=(c,a,d)=>c&&!a.hidden&&a._stacked&&{keys:xS(d,!0),values:null};class kc{constructor(a,d){this.chart=a,this._ctx=a.ctx,this.index=d,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const a=this._cachedMeta;this.configure(),this.linkScales(),a._stacked=Jw(a.vScale,a),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(a){this.index!==a&&sf(this._cachedMeta),this.index=a}linkScales(){const a=this.chart,d=this._cachedMeta,m=this.getDataset(),x=(Z,ae,fe,Le)=>Z==="x"?ae:Z==="r"?Le:fe,T=d.xAxisID=Fn(m.xAxisID,g0(a,"x")),E=d.yAxisID=Fn(m.yAxisID,g0(a,"y")),P=d.rAxisID=Fn(m.rAxisID,g0(a,"r")),r=d.indexAxis,B=d.iAxisID=x(r,T,E,P),W=d.vAxisID=x(r,E,T,P);d.xScale=this.getScaleForId(T),d.yScale=this.getScaleForId(E),d.rScale=this.getScaleForId(P),d.iScale=this.getScaleForId(B),d.vScale=this.getScaleForId(W)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(a){return this.chart.scales[a]}_getOtherScale(a){const d=this._cachedMeta;return a===d.iScale?d.vScale:d.iScale}reset(){this._update("reset")}_destroy(){const a=this._cachedMeta;this._data&&Nw(this._data,this),a._stacked&&sf(a)}_dataCheck(){const a=this.getDataset(),d=a.data||(a.data=[]),m=this._data;if(an(d)){const x=this._cachedMeta;this._data=Nz(d,x)}else if(m!==d){if(m){Nw(m,this);const x=this._cachedMeta;sf(x),x._parsed=[]}d&&Object.isExtensible(d)&&$R(d,this),this._syncList=[],this._data=d}}addElements(){const a=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(a.dataset=new this.datasetElementType)}buildOrUpdateElements(a){const d=this._cachedMeta,m=this.getDataset();let x=!1;this._dataCheck();const T=d._stacked;d._stacked=Jw(d.vScale,d),d.stack!==m.stack&&(x=!0,sf(d),d.stack=m.stack),this._resyncElements(a),(x||T!==d._stacked)&&tT(this,d._parsed)}configure(){const a=this.chart.config,d=a.datasetScopeKeys(this._type),m=a.getOptionScopes(this.getDataset(),d,!0);this.options=a.createResolver(m,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(a,d){const{_cachedMeta:m,_data:x}=this,{iScale:T,_stacked:E}=m,P=T.axis;let r=a===0&&d===x.length?!0:m._sorted,B=a>0&&m._parsed[a-1],W,Z,ae;if(this._parsing===!1)m._parsed=x,m._sorted=!0,ae=x;else{jn(x[a])?ae=this.parseArrayData(m,x,a,d):an(x[a])?ae=this.parseObjectData(m,x,a,d):ae=this.parsePrimitiveData(m,x,a,d);const fe=()=>Z[P]===null||B&&Z[P]<B[P];for(W=0;W<d;++W)m._parsed[W+a]=Z=ae[W],r&&(fe()&&(r=!1),B=Z);m._sorted=r}E&&tT(this,ae)}parsePrimitiveData(a,d,m,x){const{iScale:T,vScale:E}=a,P=T.axis,r=E.axis,B=T.getLabels(),W=T===E,Z=new Array(x);let ae,fe,Le;for(ae=0,fe=x;ae<fe;++ae)Le=ae+m,Z[ae]={[P]:W||T.parse(B[Le],Le),[r]:E.parse(d[Le],Le)};return Z}parseArrayData(a,d,m,x){const{xScale:T,yScale:E}=a,P=new Array(x);let r,B,W,Z;for(r=0,B=x;r<B;++r)W=r+m,Z=d[W],P[r]={x:T.parse(Z[0],W),y:E.parse(Z[1],W)};return P}parseObjectData(a,d,m,x){const{xScale:T,yScale:E}=a,{xAxisKey:P="x",yAxisKey:r="y"}=this._parsing,B=new Array(x);let W,Z,ae,fe;for(W=0,Z=x;W<Z;++W)ae=W+m,fe=d[ae],B[W]={x:T.parse(ml(fe,P),ae),y:E.parse(ml(fe,r),ae)};return B}getParsed(a){return this._cachedMeta._parsed[a]}getDataElement(a){return this._cachedMeta.data[a]}applyStack(a,d,m){const x=this.chart,T=this._cachedMeta,E=d[a.axis],P={keys:xS(x,!0),values:d._stacks[a.axis]._visualValues};return Kw(P,E,T.index,{mode:m})}updateRangeFromParsed(a,d,m,x){const T=m[d.axis];let E=T===null?NaN:T;const P=x&&m._stacks[d.axis];x&&P&&(x.values=P,E=Kw(x,T,this._cachedMeta.index)),a.min=Math.min(a.min,E),a.max=Math.max(a.max,E)}getMinMax(a,d){const m=this._cachedMeta,x=m._parsed,T=m._sorted&&a===m.iScale,E=x.length,P=this._getOtherScale(a),r=qz(d,m,this.chart),B={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:W,max:Z}=jz(P);let ae,fe;function Le(){fe=x[ae];const De=fe[P.axis];return!br(fe[a.axis])||W>De||Z<De}for(ae=0;ae<E&&!(!Le()&&(this.updateRangeFromParsed(B,a,fe,r),T));++ae);if(T){for(ae=E-1;ae>=0;--ae)if(!Le()){this.updateRangeFromParsed(B,a,fe,r);break}}return B}getAllParsedValues(a){const d=this._cachedMeta._parsed,m=[];let x,T,E;for(x=0,T=d.length;x<T;++x)E=d[x][a.axis],br(E)&&m.push(E);return m}getMaxOverflow(){return!1}getLabelAndValue(a){const d=this._cachedMeta,m=d.iScale,x=d.vScale,T=this.getParsed(a);return{label:m?""+m.getLabelForValue(T[m.axis]):"",value:x?""+x.getLabelForValue(T[x.axis]):""}}_update(a){const d=this._cachedMeta;this.update(a||"default"),d._clip=Bz(Fn(this.options.clip,Fz(d.xScale,d.yScale,this.getMaxOverflow())))}update(a){}draw(){const a=this._ctx,d=this.chart,m=this._cachedMeta,x=m.data||[],T=d.chartArea,E=[],P=this._drawStart||0,r=this._drawCount||x.length-P,B=this.options.drawActiveElementsOnTop;let W;for(m.dataset&&m.dataset.draw(a,T,P,r),W=P;W<P+r;++W){const Z=x[W];Z.hidden||(Z.active&&B?E.push(Z):Z.draw(a,T))}for(W=0;W<E.length;++W)E[W].draw(a,T)}getStyle(a,d){const m=d?"active":"default";return a===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(m):this.resolveDataElementOptions(a||0,m)}getContext(a,d,m){const x=this.getDataset();let T;if(a>=0&&a<this._cachedMeta.data.length){const E=this._cachedMeta.data[a];T=E.$context||(E.$context=$z(this.getContext(),a,E)),T.parsed=this.getParsed(a),T.raw=x.data[a],T.index=T.dataIndex=a}else T=this.$context||(this.$context=Gz(this.chart.getContext(),this.index)),T.dataset=x,T.index=T.datasetIndex=this.index;return T.active=!!d,T.mode=m,T}resolveDatasetElementOptions(a){return this._resolveElementOptions(this.datasetElementType.id,a)}resolveDataElementOptions(a,d){return this._resolveElementOptions(this.dataElementType.id,d,a)}_resolveElementOptions(a,d="default",m){const x=d==="active",T=this._cachedDataOpts,E=a+"-"+d,P=T[E],r=this.enableOptionSharing&&Lf(m);if(P)return iT(P,r);const B=this.chart.config,W=B.datasetElementScopeKeys(this._type,a),Z=x?[`${a}Hover`,"hover",a,""]:[a,""],ae=B.getOptionScopes(this.getDataset(),W),fe=Object.keys(Kn.elements[a]),Le=()=>this.getContext(m,x,d),De=B.resolveNamedOptions(ae,fe,Le,Z);return De.$shared&&(De.$shared=r,T[E]=Object.freeze(iT(De,r))),De}_resolveAnimations(a,d,m){const x=this.chart,T=this._cachedDataOpts,E=`animation-${d}`,P=T[E];if(P)return P;let r;if(x.options.animation!==!1){const W=this.chart.config,Z=W.datasetAnimationScopeKeys(this._type,d),ae=W.getOptionScopes(this.getDataset(),Z);r=W.createResolver(ae,this.getContext(a,m,d))}const B=new yS(x,r&&r.animations);return r&&r._cacheable&&(T[E]=Object.freeze(B)),B}getSharedOptions(a){if(a.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},a))}includeOptions(a,d){return!d||y0(a)||this.chart._animationsDisabled}_getSharedOptions(a,d){const m=this.resolveDataElementOptions(a,d),x=this._sharedOptions,T=this.getSharedOptions(m),E=this.includeOptions(d,T)||T!==x;return this.updateSharedOptions(T,d,m),{sharedOptions:T,includeOptions:E}}updateElement(a,d,m,x){y0(x)?Object.assign(a,m):this._resolveAnimations(d,x).update(a,m)}updateSharedOptions(a,d,m){a&&!y0(d)&&this._resolveAnimations(void 0,d).update(a,m)}_setStyle(a,d,m,x){a.active=x;const T=this.getStyle(d,x);this._resolveAnimations(d,m,x).update(a,{options:!x&&this.getSharedOptions(T)||T})}removeHoverStyle(a,d,m){this._setStyle(a,m,"active",!1)}setHoverStyle(a,d,m){this._setStyle(a,m,"active",!0)}_removeDatasetHoverStyle(){const a=this._cachedMeta.dataset;a&&this._setStyle(a,void 0,"active",!1)}_setDatasetHoverStyle(){const a=this._cachedMeta.dataset;a&&this._setStyle(a,void 0,"active",!0)}_resyncElements(a){const d=this._data,m=this._cachedMeta.data;for(const[P,r,B]of this._syncList)this[P](r,B);this._syncList=[];const x=m.length,T=d.length,E=Math.min(T,x);E&&this.parse(0,E),T>x?this._insertElements(x,T-x,a):T<x&&this._removeElements(T,x-T)}_insertElements(a,d,m=!0){const x=this._cachedMeta,T=x.data,E=a+d;let P;const r=B=>{for(B.length+=d,P=B.length-1;P>=E;P--)B[P]=B[P-d]};for(r(T),P=a;P<E;++P)T[P]=new this.dataElementType;this._parsing&&r(x._parsed),this.parse(a,d),m&&this.updateElements(T,a,d,"reset")}updateElements(a,d,m,x){}_removeElements(a,d){const m=this._cachedMeta;if(this._parsing){const x=m._parsed.splice(a,d);m._stacked&&sf(m,x)}m.data.splice(a,d)}_sync(a){if(this._parsing)this._syncList.push(a);else{const[d,m,x]=a;this[d](m,x)}this.chart._dataChanges.push([this.index,...a])}_onDataPush(){const a=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-a,a])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(a,d){d&&this._sync(["_removeElements",a,d]);const m=arguments.length-2;m&&this._sync(["_insertElements",a,m])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Ii(kc,"defaults",{}),Ii(kc,"datasetElementType",null),Ii(kc,"dataElementType",null);function Wz(c,a){if(!c._cache.$bar){const d=c.getMatchingVisibleMetas(a);let m=[];for(let x=0,T=d.length;x<T;x++)m=m.concat(d[x].controller.getAllParsedValues(c));c._cache.$bar=rS(m.sort((x,T)=>x-T))}return c._cache.$bar}function Hz(c){const a=c.iScale,d=Wz(a,c.type);let m=a._length,x,T,E,P;const r=()=>{E===32767||E===-32768||(Lf(P)&&(m=Math.min(m,Math.abs(E-P)||m)),P=E)};for(x=0,T=d.length;x<T;++x)E=a.getPixelForValue(d[x]),r();for(P=void 0,x=0,T=a.ticks.length;x<T;++x)E=a.getPixelForTick(x),r();return m}function Zz(c,a,d,m){const x=d.barThickness;let T,E;return wn(x)?(T=a.min*d.categoryPercentage,E=d.barPercentage):(T=x*m,E=1),{chunk:T/m,ratio:E,start:a.pixels[c]-T/2}}function Qz(c,a,d,m){const x=a.pixels,T=x[c];let E=c>0?x[c-1]:null,P=c<x.length-1?x[c+1]:null;const r=d.categoryPercentage;E===null&&(E=T-(P===null?a.end-a.start:P-T)),P===null&&(P=T+T-E);const B=T-(T-Math.min(E,P))/2*r;return{chunk:Math.abs(P-E)/2*r/m,ratio:d.barPercentage,start:B}}function Xz(c,a,d,m){const x=d.parse(c[0],m),T=d.parse(c[1],m),E=Math.min(x,T),P=Math.max(x,T);let r=E,B=P;Math.abs(E)>Math.abs(P)&&(r=P,B=E),a[d.axis]=B,a._custom={barStart:r,barEnd:B,start:x,end:T,min:E,max:P}}function vS(c,a,d,m){return jn(c)?Xz(c,a,d,m):a[d.axis]=d.parse(c,m),a}function nT(c,a,d,m){const x=c.iScale,T=c.vScale,E=x.getLabels(),P=x===T,r=[];let B,W,Z,ae;for(B=d,W=d+m;B<W;++B)ae=a[B],Z={},Z[x.axis]=P||x.parse(E[B],B),r.push(vS(ae,Z,T,B));return r}function x0(c){return c&&c.barStart!==void 0&&c.barEnd!==void 0}function Yz(c,a,d){return c!==0?pl(c):(a.isHorizontal()?1:-1)*(a.min>=d?1:-1)}function Kz(c){let a,d,m,x,T;return c.horizontal?(a=c.base>c.x,d="left",m="right"):(a=c.base<c.y,d="bottom",m="top"),a?(x="end",T="start"):(x="start",T="end"),{start:d,end:m,reverse:a,top:x,bottom:T}}function Jz(c,a,d,m){let x=a.borderSkipped;const T={};if(!x){c.borderSkipped=T;return}if(x===!0){c.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:E,end:P,reverse:r,top:B,bottom:W}=Kz(c);x==="middle"&&d&&(c.enableBorderRadius=!0,(d._top||0)===m?x=B:(d._bottom||0)===m?x=W:(T[rT(W,E,P,r)]=!0,x=B)),T[rT(x,E,P,r)]=!0,c.borderSkipped=T}function rT(c,a,d,m){return m?(c=eL(c,a,d),c=sT(c,d,a)):c=sT(c,a,d),c}function eL(c,a,d){return c===a?d:c===d?a:c}function sT(c,a,d){return c==="start"?a:c==="end"?d:c}function tL(c,{inflateAmount:a},d){c.inflateAmount=a==="auto"?d===1?.33:0:a}class S_ extends kc{parsePrimitiveData(a,d,m,x){return nT(a,d,m,x)}parseArrayData(a,d,m,x){return nT(a,d,m,x)}parseObjectData(a,d,m,x){const{iScale:T,vScale:E}=a,{xAxisKey:P="x",yAxisKey:r="y"}=this._parsing,B=T.axis==="x"?P:r,W=E.axis==="x"?P:r,Z=[];let ae,fe,Le,De;for(ae=m,fe=m+x;ae<fe;++ae)De=d[ae],Le={},Le[T.axis]=T.parse(ml(De,B),ae),Z.push(vS(ml(De,W),Le,E,ae));return Z}updateRangeFromParsed(a,d,m,x){super.updateRangeFromParsed(a,d,m,x);const T=m._custom;T&&d===this._cachedMeta.vScale&&(a.min=Math.min(a.min,T.min),a.max=Math.max(a.max,T.max))}getMaxOverflow(){return 0}getLabelAndValue(a){const d=this._cachedMeta,{iScale:m,vScale:x}=d,T=this.getParsed(a),E=T._custom,P=x0(E)?"["+E.start+", "+E.end+"]":""+x.getLabelForValue(T[x.axis]);return{label:""+m.getLabelForValue(T[m.axis]),value:P}}initialize(){this.enableOptionSharing=!0,super.initialize();const a=this._cachedMeta;a.stack=this.getDataset().stack}update(a){const d=this._cachedMeta;this.updateElements(d.data,0,d.data.length,a)}updateElements(a,d,m,x){const T=x==="reset",{index:E,_cachedMeta:{vScale:P}}=this,r=P.getBasePixel(),B=P.isHorizontal(),W=this._getRuler(),{sharedOptions:Z,includeOptions:ae}=this._getSharedOptions(d,x);for(let fe=d;fe<d+m;fe++){const Le=this.getParsed(fe),De=T||wn(Le[P.axis])?{base:r,head:r}:this._calculateBarValuePixels(fe),Ve=this._calculateBarIndexPixels(fe,W),Ye=(Le._stacks||{})[P.axis],lt={horizontal:B,base:De.base,enableBorderRadius:!Ye||x0(Le._custom)||E===Ye._top||E===Ye._bottom,x:B?De.head:Ve.center,y:B?Ve.center:De.head,height:B?Ve.size:Math.abs(De.size),width:B?Math.abs(De.size):Ve.size};ae&&(lt.options=Z||this.resolveDataElementOptions(fe,a[fe].active?"active":x));const dt=lt.options||a[fe].options;Jz(lt,dt,Ye,E),tL(lt,dt,W.ratio),this.updateElement(a[fe],fe,lt,x)}}_getStacks(a,d){const{iScale:m}=this._cachedMeta,x=m.getMatchingVisibleMetas(this._type).filter(r=>r.controller.options.grouped),T=m.options.stacked,E=[],P=r=>{const B=r.controller.getParsed(d),W=B&&B[r.vScale.axis];if(wn(W)||isNaN(W))return!0};for(const r of x)if(!(d!==void 0&&P(r))&&((T===!1||E.indexOf(r.stack)===-1||T===void 0&&r.stack===void 0)&&E.push(r.stack),r.index===a))break;return E.length||E.push(void 0),E}_getStackCount(a){return this._getStacks(void 0,a).length}_getStackIndex(a,d,m){const x=this._getStacks(a,m),T=d!==void 0?x.indexOf(d):-1;return T===-1?x.length-1:T}_getRuler(){const a=this.options,d=this._cachedMeta,m=d.iScale,x=[];let T,E;for(T=0,E=d.data.length;T<E;++T)x.push(m.getPixelForValue(this.getParsed(T)[m.axis],T));const P=a.barThickness;return{min:P||Hz(d),pixels:x,start:m._startPixel,end:m._endPixel,stackCount:this._getStackCount(),scale:m,grouped:a.grouped,ratio:P?1:a.categoryPercentage*a.barPercentage}}_calculateBarValuePixels(a){const{_cachedMeta:{vScale:d,_stacked:m,index:x},options:{base:T,minBarLength:E}}=this,P=T||0,r=this.getParsed(a),B=r._custom,W=x0(B);let Z=r[d.axis],ae=0,fe=m?this.applyStack(d,r,m):Z,Le,De;fe!==Z&&(ae=fe-Z,fe=Z),W&&(Z=B.barStart,fe=B.barEnd-B.barStart,Z!==0&&pl(Z)!==pl(B.barEnd)&&(ae=0),ae+=Z);const Ve=!wn(T)&&!W?T:ae;let Ye=d.getPixelForValue(Ve);if(this.chart.getDataVisibility(a)?Le=d.getPixelForValue(ae+fe):Le=Ye,De=Le-Ye,Math.abs(De)<E){De=Yz(De,d,P)*E,Z===P&&(Ye-=De/2);const lt=d.getPixelForDecimal(0),dt=d.getPixelForDecimal(1),gt=Math.min(lt,dt),yt=Math.max(lt,dt);Ye=Math.max(Math.min(Ye,yt),gt),Le=Ye+De,m&&!W&&(r._stacks[d.axis]._visualValues[x]=d.getValueForPixel(Le)-d.getValueForPixel(Ye))}if(Ye===d.getPixelForValue(P)){const lt=pl(De)*d.getLineWidthForValue(P)/2;Ye+=lt,De-=lt}return{size:De,base:Ye,head:Le,center:Le+De/2}}_calculateBarIndexPixels(a,d){const m=d.scale,x=this.options,T=x.skipNull,E=Fn(x.maxBarThickness,1/0);let P,r;if(d.grouped){const B=T?this._getStackCount(a):d.stackCount,W=x.barThickness==="flex"?Qz(a,d,x,B):Zz(a,d,x,B),Z=this._getStackIndex(this.index,this._cachedMeta.stack,T?a:void 0);P=W.start+W.chunk*Z+W.chunk/2,r=Math.min(E,W.chunk*W.ratio)}else P=m.getPixelForValue(this.getParsed(a)[m.axis],a),r=Math.min(E,d.min*d.ratio);return{base:P-r/2,head:P+r/2,center:P,size:r}}draw(){const a=this._cachedMeta,d=a.vScale,m=a.data,x=m.length;let T=0;for(;T<x;++T)this.getParsed(T)[d.axis]!==null&&!m[T].hidden&&m[T].draw(this._ctx)}}Ii(S_,"id","bar"),Ii(S_,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Ii(S_,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});function iL(c,a,d){let m=1,x=1,T=0,E=0;if(a<os){const P=c,r=P+a,B=Math.cos(P),W=Math.sin(P),Z=Math.cos(r),ae=Math.sin(r),fe=(dt,gt,yt)=>V0(dt,P,r,!0)?1:Math.max(gt,gt*d,yt,yt*d),Le=(dt,gt,yt)=>V0(dt,P,r,!0)?-1:Math.min(gt,gt*d,yt,yt*d),De=fe(0,B,Z),Ve=fe(Hr,W,ae),Ye=Le(Jn,B,Z),lt=Le(Jn+Hr,W,ae);m=(De-Ye)/2,x=(Ve-lt)/2,T=-(De+Ye)/2,E=-(Ve+lt)/2}return{ratioX:m,ratioY:x,offsetX:T,offsetY:E}}class pf extends kc{constructor(a,d){super(a,d),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(a,d){const m=this.getDataset().data,x=this._cachedMeta;if(this._parsing===!1)x._parsed=m;else{let T=r=>+m[r];if(an(m[a])){const{key:r="value"}=this._parsing;T=B=>+ml(m[B],r)}let E,P;for(E=a,P=a+d;E<P;++E)x._parsed[E]=T(E)}}_getRotation(){return ao(this.options.rotation-90)}_getCircumference(){return ao(this.options.circumference)}_getRotationExtents(){let a=os,d=-os;for(let m=0;m<this.chart.data.datasets.length;++m)if(this.chart.isDatasetVisible(m)&&this.chart.getDatasetMeta(m).type===this._type){const x=this.chart.getDatasetMeta(m).controller,T=x._getRotation(),E=x._getCircumference();a=Math.min(a,T),d=Math.max(d,T+E)}return{rotation:a,circumference:d-a}}update(a){const d=this.chart,{chartArea:m}=d,x=this._cachedMeta,T=x.data,E=this.getMaxBorderWidth()+this.getMaxOffset(T)+this.options.spacing,P=Math.max((Math.min(m.width,m.height)-E)/2,0),r=Math.min(PR(this.options.cutout,P),1),B=this._getRingWeight(this.index),{circumference:W,rotation:Z}=this._getRotationExtents(),{ratioX:ae,ratioY:fe,offsetX:Le,offsetY:De}=iL(Z,W,r),Ve=(m.width-E)/ae,Ye=(m.height-E)/fe,lt=Math.max(Math.min(Ve,Ye)/2,0),dt=eS(this.options.radius,lt),gt=Math.max(dt*r,0),yt=(dt-gt)/this._getVisibleDatasetWeightTotal();this.offsetX=Le*dt,this.offsetY=De*dt,x.total=this.calculateTotal(),this.outerRadius=dt-yt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-yt*B,0),this.updateElements(T,0,T.length,a)}_circumference(a,d){const m=this.options,x=this._cachedMeta,T=this._getCircumference();return d&&m.animation.animateRotate||!this.chart.getDataVisibility(a)||x._parsed[a]===null||x.data[a].hidden?0:this.calculateCircumference(x._parsed[a]*T/os)}updateElements(a,d,m,x){const T=x==="reset",E=this.chart,P=E.chartArea,B=E.options.animation,W=(P.left+P.right)/2,Z=(P.top+P.bottom)/2,ae=T&&B.animateScale,fe=ae?0:this.innerRadius,Le=ae?0:this.outerRadius,{sharedOptions:De,includeOptions:Ve}=this._getSharedOptions(d,x);let Ye=this._getRotation(),lt;for(lt=0;lt<d;++lt)Ye+=this._circumference(lt,T);for(lt=d;lt<d+m;++lt){const dt=this._circumference(lt,T),gt=a[lt],yt={x:W+this.offsetX,y:Z+this.offsetY,startAngle:Ye,endAngle:Ye+dt,circumference:dt,outerRadius:Le,innerRadius:fe};Ve&&(yt.options=De||this.resolveDataElementOptions(lt,gt.active?"active":x)),Ye+=dt,this.updateElement(gt,lt,yt,x)}}calculateTotal(){const a=this._cachedMeta,d=a.data;let m=0,x;for(x=0;x<d.length;x++){const T=a._parsed[x];T!==null&&!isNaN(T)&&this.chart.getDataVisibility(x)&&!d[x].hidden&&(m+=Math.abs(T))}return m}calculateCircumference(a){const d=this._cachedMeta.total;return d>0&&!isNaN(a)?os*(Math.abs(a)/d):0}getLabelAndValue(a){const d=this._cachedMeta,m=this.chart,x=m.data.labels||[],T=Vf(d._parsed[a],m.options.locale);return{label:x[a]||"",value:T}}getMaxBorderWidth(a){let d=0;const m=this.chart;let x,T,E,P,r;if(!a){for(x=0,T=m.data.datasets.length;x<T;++x)if(m.isDatasetVisible(x)){E=m.getDatasetMeta(x),a=E.data,P=E.controller;break}}if(!a)return 0;for(x=0,T=a.length;x<T;++x)r=P.resolveDataElementOptions(x),r.borderAlign!=="inner"&&(d=Math.max(d,r.borderWidth||0,r.hoverBorderWidth||0));return d}getMaxOffset(a){let d=0;for(let m=0,x=a.length;m<x;++m){const T=this.resolveDataElementOptions(m);d=Math.max(d,T.offset||0,T.hoverOffset||0)}return d}_getRingWeightOffset(a){let d=0;for(let m=0;m<a;++m)this.chart.isDatasetVisible(m)&&(d+=this._getRingWeight(m));return d}_getRingWeight(a){return Math.max(Fn(this.chart.data.datasets[a].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Ii(pf,"id","doughnut"),Ii(pf,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Ii(pf,"descriptors",{_scriptable:a=>a!=="spacing",_indexable:a=>a!=="spacing"&&!a.startsWith("borderDash")&&!a.startsWith("hoverBorderDash")}),Ii(pf,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(a){const d=a.data;if(d.labels.length&&d.datasets.length){const{labels:{pointStyle:m,color:x}}=a.legend.options;return d.labels.map((T,E)=>{const r=a.getDatasetMeta(0).controller.getStyle(E);return{text:T,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:x,lineWidth:r.borderWidth,pointStyle:m,hidden:!a.getDataVisibility(E),index:E}})}return[]}},onClick(a,d,m){m.chart.toggleDataVisibility(d.index),m.chart.update()}}}});class E_ extends kc{constructor(a,d){super(a,d),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(a){const d=this._cachedMeta,m=this.chart,x=m.data.labels||[],T=Vf(d._parsed[a].r,m.options.locale);return{label:x[a]||"",value:T}}parseObjectData(a,d,m,x){return vz.bind(this)(a,d,m,x)}update(a){const d=this._cachedMeta.data;this._updateRadius(),this.updateElements(d,0,d.length,a)}getMinMax(){const a=this._cachedMeta,d={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return a.data.forEach((m,x)=>{const T=this.getParsed(x).r;!isNaN(T)&&this.chart.getDataVisibility(x)&&(T<d.min&&(d.min=T),T>d.max&&(d.max=T))}),d}_updateRadius(){const a=this.chart,d=a.chartArea,m=a.options,x=Math.min(d.right-d.left,d.bottom-d.top),T=Math.max(x/2,0),E=Math.max(m.cutoutPercentage?T/100*m.cutoutPercentage:1,0),P=(T-E)/a.getVisibleDatasetCount();this.outerRadius=T-P*this.index,this.innerRadius=this.outerRadius-P}updateElements(a,d,m,x){const T=x==="reset",E=this.chart,r=E.options.animation,B=this._cachedMeta.rScale,W=B.xCenter,Z=B.yCenter,ae=B.getIndexAngle(0)-.5*Jn;let fe=ae,Le;const De=360/this.countVisibleElements();for(Le=0;Le<d;++Le)fe+=this._computeAngle(Le,x,De);for(Le=d;Le<d+m;Le++){const Ve=a[Le];let Ye=fe,lt=fe+this._computeAngle(Le,x,De),dt=E.getDataVisibility(Le)?B.getDistanceFromCenterForValue(this.getParsed(Le).r):0;fe=lt,T&&(r.animateScale&&(dt=0),r.animateRotate&&(Ye=lt=ae));const gt={x:W,y:Z,innerRadius:0,outerRadius:dt,startAngle:Ye,endAngle:lt,options:this.resolveDataElementOptions(Le,Ve.active?"active":x)};this.updateElement(Ve,Le,gt,x)}}countVisibleElements(){const a=this._cachedMeta;let d=0;return a.data.forEach((m,x)=>{!isNaN(this.getParsed(x).r)&&this.chart.getDataVisibility(x)&&d++}),d}_computeAngle(a,d,m){return this.chart.getDataVisibility(a)?ao(this.resolveDataElementOptions(a,d).angle||m):0}}Ii(E_,"id","polarArea"),Ii(E_,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),Ii(E_,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(a){const d=a.data;if(d.labels.length&&d.datasets.length){const{labels:{pointStyle:m,color:x}}=a.legend.options;return d.labels.map((T,E)=>{const r=a.getDatasetMeta(0).controller.getStyle(E);return{text:T,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:x,lineWidth:r.borderWidth,pointStyle:m,hidden:!a.getDataVisibility(E),index:E}})}return[]}},onClick(a,d,m){m.chart.toggleDataVisibility(d.index),m.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});function Ec(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Ix{constructor(a){Ii(this,"options");this.options=a||{}}static override(a){Object.assign(Ix.prototype,a)}init(){}formats(){return Ec()}parse(){return Ec()}format(){return Ec()}add(){return Ec()}diff(){return Ec()}startOf(){return Ec()}endOf(){return Ec()}}var nL={_date:Ix};function rL(c,a,d,m){const{controller:x,data:T,_sorted:E}=c,P=x._cachedMeta.iScale;if(P&&a===P.axis&&a!=="r"&&E&&T.length){const r=P._reversePixels?UR:j0;if(m){if(x._sharedOptions){const B=T[0],W=typeof B.getRange=="function"&&B.getRange(a);if(W){const Z=r(T,a,d-W),ae=r(T,a,d+W);return{lo:Z.lo,hi:ae.hi}}}}else return r(T,a,d)}return{lo:0,hi:T.length-1}}function jf(c,a,d,m,x){const T=c.getSortedVisibleDatasetMetas(),E=d[a];for(let P=0,r=T.length;P<r;++P){const{index:B,data:W}=T[P],{lo:Z,hi:ae}=rL(T[P],a,E,x);for(let fe=Z;fe<=ae;++fe){const Le=W[fe];Le.skip||m(Le,B,fe)}}}function sL(c){const a=c.indexOf("x")!==-1,d=c.indexOf("y")!==-1;return function(m,x){const T=a?Math.abs(m.x-x.x):0,E=d?Math.abs(m.y-x.y):0;return Math.sqrt(Math.pow(T,2)+Math.pow(E,2))}}function v0(c,a,d,m,x){const T=[];return!x&&!c.isPointInArea(a)||jf(c,d,a,function(P,r,B){!x&&!ph(P,c.chartArea,0)||P.inRange(a.x,a.y,m)&&T.push({element:P,datasetIndex:r,index:B})},!0),T}function oL(c,a,d,m){let x=[];function T(E,P,r){const{startAngle:B,endAngle:W}=E.getProps(["startAngle","endAngle"],m),{angle:Z}=NR(E,{x:a.x,y:a.y});V0(Z,B,W)&&x.push({element:E,datasetIndex:P,index:r})}return jf(c,d,a,T),x}function aL(c,a,d,m,x,T){let E=[];const P=sL(d);let r=Number.POSITIVE_INFINITY;function B(W,Z,ae){const fe=W.inRange(a.x,a.y,x);if(m&&!fe)return;const Le=W.getCenterPoint(x);if(!(!!T||c.isPointInArea(Le))&&!fe)return;const Ve=P(a,Le);Ve<r?(E=[{element:W,datasetIndex:Z,index:ae}],r=Ve):Ve===r&&E.push({element:W,datasetIndex:Z,index:ae})}return jf(c,d,a,B),E}function b0(c,a,d,m,x,T){return!T&&!c.isPointInArea(a)?[]:d==="r"&&!m?oL(c,a,d,x):aL(c,a,d,m,x,T)}function oT(c,a,d,m,x){const T=[],E=d==="x"?"inXRange":"inYRange";let P=!1;return jf(c,d,a,(r,B,W)=>{r[E](a[d],x)&&(T.push({element:r,datasetIndex:B,index:W}),P=P||r.inRange(a.x,a.y,x))}),m&&!P?[]:T}var lL={evaluateInteractionItems:jf,modes:{index(c,a,d,m){const x=Ic(a,c),T=d.axis||"x",E=d.includeInvisible||!1,P=d.intersect?v0(c,x,T,m,E):b0(c,x,T,!1,m,E),r=[];return P.length?(c.getSortedVisibleDatasetMetas().forEach(B=>{const W=P[0].index,Z=B.data[W];Z&&!Z.skip&&r.push({element:Z,datasetIndex:B.index,index:W})}),r):[]},dataset(c,a,d,m){const x=Ic(a,c),T=d.axis||"xy",E=d.includeInvisible||!1;let P=d.intersect?v0(c,x,T,m,E):b0(c,x,T,!1,m,E);if(P.length>0){const r=P[0].datasetIndex,B=c.getDatasetMeta(r).data;P=[];for(let W=0;W<B.length;++W)P.push({element:B[W],datasetIndex:r,index:W})}return P},point(c,a,d,m){const x=Ic(a,c),T=d.axis||"xy",E=d.includeInvisible||!1;return v0(c,x,T,m,E)},nearest(c,a,d,m){const x=Ic(a,c),T=d.axis||"xy",E=d.includeInvisible||!1;return b0(c,x,T,d.intersect,m,E)},x(c,a,d,m){const x=Ic(a,c);return oT(c,x,"x",d.intersect,m)},y(c,a,d,m){const x=Ic(a,c);return oT(c,x,"y",d.intersect,m)}}};const bS=["left","top","right","bottom"];function of(c,a){return c.filter(d=>d.pos===a)}function aT(c,a){return c.filter(d=>bS.indexOf(d.pos)===-1&&d.box.axis===a)}function af(c,a){return c.sort((d,m)=>{const x=a?m:d,T=a?d:m;return x.weight===T.weight?x.index-T.index:x.weight-T.weight})}function cL(c){const a=[];let d,m,x,T,E,P;for(d=0,m=(c||[]).length;d<m;++d)x=c[d],{position:T,options:{stack:E,stackWeight:P=1}}=x,a.push({index:d,box:x,pos:T,horizontal:x.isHorizontal(),weight:x.weight,stack:E&&T+E,stackWeight:P});return a}function uL(c){const a={};for(const d of c){const{stack:m,pos:x,stackWeight:T}=d;if(!m||!bS.includes(x))continue;const E=a[m]||(a[m]={count:0,placed:0,weight:0,size:0});E.count++,E.weight+=T}return a}function hL(c,a){const d=uL(c),{vBoxMaxWidth:m,hBoxMaxHeight:x}=a;let T,E,P;for(T=0,E=c.length;T<E;++T){P=c[T];const{fullSize:r}=P.box,B=d[P.stack],W=B&&P.stackWeight/B.weight;P.horizontal?(P.width=W?W*m:r&&a.availableWidth,P.height=x):(P.width=m,P.height=W?W*x:r&&a.availableHeight)}return d}function dL(c){const a=cL(c),d=af(a.filter(B=>B.box.fullSize),!0),m=af(of(a,"left"),!0),x=af(of(a,"right")),T=af(of(a,"top"),!0),E=af(of(a,"bottom")),P=aT(a,"x"),r=aT(a,"y");return{fullSize:d,leftAndTop:m.concat(T),rightAndBottom:x.concat(r).concat(E).concat(P),chartArea:of(a,"chartArea"),vertical:m.concat(x).concat(r),horizontal:T.concat(E).concat(P)}}function lT(c,a,d,m){return Math.max(c[d],a[d])+Math.max(c[m],a[m])}function wS(c,a){c.top=Math.max(c.top,a.top),c.left=Math.max(c.left,a.left),c.bottom=Math.max(c.bottom,a.bottom),c.right=Math.max(c.right,a.right)}function fL(c,a,d,m){const{pos:x,box:T}=d,E=c.maxPadding;if(!an(x)){d.size&&(c[x]-=d.size);const Z=m[d.stack]||{size:0,count:1};Z.size=Math.max(Z.size,d.horizontal?T.height:T.width),d.size=Z.size/Z.count,c[x]+=d.size}T.getPadding&&wS(E,T.getPadding());const P=Math.max(0,a.outerWidth-lT(E,c,"left","right")),r=Math.max(0,a.outerHeight-lT(E,c,"top","bottom")),B=P!==c.w,W=r!==c.h;return c.w=P,c.h=r,d.horizontal?{same:B,other:W}:{same:W,other:B}}function pL(c){const a=c.maxPadding;function d(m){const x=Math.max(a[m]-c[m],0);return c[m]+=x,x}c.y+=d("top"),c.x+=d("left"),d("right"),d("bottom")}function mL(c,a){const d=a.maxPadding;function m(x){const T={left:0,top:0,right:0,bottom:0};return x.forEach(E=>{T[E]=Math.max(a[E],d[E])}),T}return m(c?["left","right"]:["top","bottom"])}function mf(c,a,d,m){const x=[];let T,E,P,r,B,W;for(T=0,E=c.length,B=0;T<E;++T){P=c[T],r=P.box,r.update(P.width||a.w,P.height||a.h,mL(P.horizontal,a));const{same:Z,other:ae}=fL(a,d,P,m);B|=Z&&x.length,W=W||ae,r.fullSize||x.push(P)}return B&&mf(x,a,d,m)||W}function u_(c,a,d,m,x){c.top=d,c.left=a,c.right=a+m,c.bottom=d+x,c.width=m,c.height=x}function cT(c,a,d,m){const x=d.padding;let{x:T,y:E}=a;for(const P of c){const r=P.box,B=m[P.stack]||{count:1,placed:0,weight:1},W=P.stackWeight/B.weight||1;if(P.horizontal){const Z=a.w*W,ae=B.size||r.height;Lf(B.start)&&(E=B.start),r.fullSize?u_(r,x.left,E,d.outerWidth-x.right-x.left,ae):u_(r,a.left+B.placed,E,Z,ae),B.start=E,B.placed+=Z,E=r.bottom}else{const Z=a.h*W,ae=B.size||r.width;Lf(B.start)&&(T=B.start),r.fullSize?u_(r,T,x.top,ae,d.outerHeight-x.bottom-x.top):u_(r,T,a.top+B.placed,ae,Z),B.start=T,B.placed+=Z,T=r.right}}a.x=T,a.y=E}var cl={addBox(c,a){c.boxes||(c.boxes=[]),a.fullSize=a.fullSize||!1,a.position=a.position||"top",a.weight=a.weight||0,a._layers=a._layers||function(){return[{z:0,draw(d){a.draw(d)}}]},c.boxes.push(a)},removeBox(c,a){const d=c.boxes?c.boxes.indexOf(a):-1;d!==-1&&c.boxes.splice(d,1)},configure(c,a,d){a.fullSize=d.fullSize,a.position=d.position,a.weight=d.weight},update(c,a,d,m){if(!c)return;const x=Ss(c.options.layout.padding),T=Math.max(a-x.width,0),E=Math.max(d-x.height,0),P=dL(c.boxes),r=P.vertical,B=P.horizontal;xn(c.boxes,De=>{typeof De.beforeLayout=="function"&&De.beforeLayout()});const W=r.reduce((De,Ve)=>Ve.box.options&&Ve.box.options.display===!1?De:De+1,0)||1,Z=Object.freeze({outerWidth:a,outerHeight:d,padding:x,availableWidth:T,availableHeight:E,vBoxMaxWidth:T/2/W,hBoxMaxHeight:E/2}),ae=Object.assign({},x);wS(ae,Ss(m));const fe=Object.assign({maxPadding:ae,w:T,h:E,x:x.left,y:x.top},x),Le=hL(r.concat(B),Z);mf(P.fullSize,fe,Z,Le),mf(r,fe,Z,Le),mf(B,fe,Z,Le)&&mf(r,fe,Z,Le),pL(fe),cT(P.leftAndTop,fe,Z,Le),fe.x+=fe.w,fe.y+=fe.h,cT(P.rightAndBottom,fe,Z,Le),c.chartArea={left:fe.left,top:fe.top,right:fe.left+fe.w,bottom:fe.top+fe.h,height:fe.h,width:fe.w},xn(P.chartArea,De=>{const Ve=De.box;Object.assign(Ve,c.chartArea),Ve.update(fe.w,fe.h,{left:0,top:0,right:0,bottom:0})})}};class TS{acquireContext(a,d){}releaseContext(a){return!1}addEventListener(a,d,m){}removeEventListener(a,d,m){}getDevicePixelRatio(){return 1}getMaximumSize(a,d,m,x){return d=Math.max(0,d||a.width),m=m||a.height,{width:d,height:Math.max(0,x?Math.floor(d/x):m)}}isAttached(a){return!0}updateConfig(a){}}class _L extends TS{acquireContext(a){return a&&a.getContext&&a.getContext("2d")||null}updateConfig(a){a.options.animation=!1}}const A_="$chartjs",gL={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},uT=c=>c===null||c==="";function yL(c,a){const d=c.style,m=c.getAttribute("height"),x=c.getAttribute("width");if(c[A_]={initial:{height:m,width:x,style:{display:d.display,height:d.height,width:d.width}}},d.display=d.display||"block",d.boxSizing=d.boxSizing||"border-box",uT(x)){const T=Qw(c,"width");T!==void 0&&(c.width=T)}if(uT(m))if(c.style.height==="")c.height=c.width/(a||2);else{const T=Qw(c,"height");T!==void 0&&(c.height=T)}return c}const MS=Az?{passive:!0}:!1;function xL(c,a,d){c&&c.addEventListener(a,d,MS)}function vL(c,a,d){c&&c.canvas&&c.canvas.removeEventListener(a,d,MS)}function bL(c,a){const d=gL[c.type]||c.type,{x:m,y:x}=Ic(c,a);return{type:d,chart:a,native:c,x:m!==void 0?m:null,y:x!==void 0?x:null}}function U_(c,a){for(const d of c)if(d===a||d.contains(a))return!0}function wL(c,a,d){const m=c.canvas,x=new MutationObserver(T=>{let E=!1;for(const P of T)E=E||U_(P.addedNodes,m),E=E&&!U_(P.removedNodes,m);E&&d()});return x.observe(document,{childList:!0,subtree:!0}),x}function TL(c,a,d){const m=c.canvas,x=new MutationObserver(T=>{let E=!1;for(const P of T)E=E||U_(P.removedNodes,m),E=E&&!U_(P.addedNodes,m);E&&d()});return x.observe(document,{childList:!0,subtree:!0}),x}const Of=new Map;let hT=0;function SS(){const c=window.devicePixelRatio;c!==hT&&(hT=c,Of.forEach((a,d)=>{d.currentDevicePixelRatio!==c&&a()}))}function ML(c,a){Of.size||window.addEventListener("resize",SS),Of.set(c,a)}function SL(c){Of.delete(c),Of.size||window.removeEventListener("resize",SS)}function EL(c,a,d){const m=c.canvas,x=m&&Ax(m);if(!x)return;const T=oS((P,r)=>{const B=x.clientWidth;d(P,r),B<x.clientWidth&&d()},window),E=new ResizeObserver(P=>{const r=P[0],B=r.contentRect.width,W=r.contentRect.height;B===0&&W===0||T(B,W)});return E.observe(x),ML(c,T),E}function w0(c,a,d){d&&d.disconnect(),a==="resize"&&SL(c)}function AL(c,a,d){const m=c.canvas,x=oS(T=>{c.ctx!==null&&d(bL(T,c))},c);return xL(m,a,x),x}class IL extends TS{acquireContext(a,d){const m=a&&a.getContext&&a.getContext("2d");return m&&m.canvas===a?(yL(a,d),m):null}releaseContext(a){const d=a.canvas;if(!d[A_])return!1;const m=d[A_].initial;["height","width"].forEach(T=>{const E=m[T];wn(E)?d.removeAttribute(T):d.setAttribute(T,E)});const x=m.style||{};return Object.keys(x).forEach(T=>{d.style[T]=x[T]}),d.width=d.width,delete d[A_],!0}addEventListener(a,d,m){this.removeEventListener(a,d);const x=a.$proxies||(a.$proxies={}),E={attach:wL,detach:TL,resize:EL}[d]||AL;x[d]=E(a,d,m)}removeEventListener(a,d){const m=a.$proxies||(a.$proxies={}),x=m[d];if(!x)return;({attach:w0,detach:w0,resize:w0}[d]||vL)(a,d,x),m[d]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(a,d,m,x){return Ez(a,d,m,x)}isAttached(a){const d=a&&Ax(a);return!!(d&&d.isConnected)}}function CL(c){return!Ex()||typeof OffscreenCanvas<"u"&&c instanceof OffscreenCanvas?_L:IL}var y_;let Uf=(y_=class{constructor(){Ii(this,"x");Ii(this,"y");Ii(this,"active",!1);Ii(this,"options");Ii(this,"$animations")}tooltipPosition(a){const{x:d,y:m}=this.getProps(["x","y"],a);return{x:d,y:m}}hasValue(){return B_(this.x)&&B_(this.y)}getProps(a,d){const m=this.$animations;if(!d||!m)return this;const x={};return a.forEach(T=>{x[T]=m[T]&&m[T].active()?m[T]._to:this[T]}),x}},Ii(y_,"defaults",{}),Ii(y_,"defaultRoutes"),y_);function PL(c,a){const d=c.options.ticks,m=DL(c),x=Math.min(d.maxTicksLimit||m,m),T=d.major.enabled?zL(a):[],E=T.length,P=T[0],r=T[E-1],B=[];if(E>x)return LL(a,B,T,E/x),B;const W=RL(T,a,x);if(E>0){let Z,ae;const fe=E>1?Math.round((r-P)/(E-1)):null;for(h_(a,B,W,wn(fe)?0:P-fe,P),Z=0,ae=E-1;Z<ae;Z++)h_(a,B,W,T[Z],T[Z+1]);return h_(a,B,W,r,wn(fe)?a.length:r+fe),B}return h_(a,B,W),B}function DL(c){const a=c.options.offset,d=c._tickSize(),m=c._length/d+(a?0:1),x=c._maxLength/d;return Math.floor(Math.min(m,x))}function RL(c,a,d){const m=kL(c),x=a.length/d;if(!m)return Math.max(x,1);const T=FR(m);for(let E=0,P=T.length-1;E<P;E++){const r=T[E];if(r>x)return r}return Math.max(x,1)}function zL(c){const a=[];let d,m;for(d=0,m=c.length;d<m;d++)c[d].major&&a.push(d);return a}function LL(c,a,d,m){let x=0,T=d[0],E;for(m=Math.ceil(m),E=0;E<c.length;E++)E===T&&(a.push(c[E]),x++,T=d[x*m])}function h_(c,a,d,m,x){const T=Fn(m,0),E=Math.min(Fn(x,c.length),c.length);let P=0,r,B,W;for(d=Math.ceil(d),x&&(r=x-m,d=r/Math.floor(r/d)),W=T;W<0;)P++,W=Math.round(T+P*d);for(B=Math.max(T,0);B<E;B++)B===W&&(a.push(c[B]),P++,W=Math.round(T+P*d))}function kL(c){const a=c.length;let d,m;if(a<2)return!1;for(m=c[0],d=1;d<a;++d)if(c[d]-c[d-1]!==m)return!1;return m}const OL=c=>c==="left"?"right":c==="right"?"left":c,dT=(c,a,d)=>a==="top"||a==="left"?c[a]+d:c[a]-d,fT=(c,a)=>Math.min(a||c,c);function pT(c,a){const d=[],m=c.length/a,x=c.length;let T=0;for(;T<x;T+=m)d.push(c[Math.floor(T)]);return d}function FL(c,a,d){const m=c.ticks.length,x=Math.min(a,m-1),T=c._startPixel,E=c._endPixel,P=1e-6;let r=c.getPixelForTick(x),B;if(!(d&&(m===1?B=Math.max(r-T,E-r):a===0?B=(c.getPixelForTick(1)-r)/2:B=(r-c.getPixelForTick(x-1))/2,r+=x<a?B:-B,r<T-P||r>E+P)))return r}function BL(c,a){xn(c,d=>{const m=d.gc,x=m.length/2;let T;if(x>a){for(T=0;T<x;++T)delete d.data[m[T]];m.splice(0,x)}})}function lf(c){return c.drawTicks?c.tickLength:0}function mT(c,a){if(!c.display)return 0;const d=Zr(c.font,a),m=Ss(c.padding);return(jn(c.text)?c.text.length:1)*d.lineHeight+m.height}function NL(c,a){return jc(c,{scale:a,type:"scale"})}function VL(c,a,d){return jc(c,{tick:d,index:a,type:"tick"})}function jL(c,a,d){let m=aS(c);return(d&&a!=="right"||!d&&a==="right")&&(m=OL(m)),m}function UL(c,a,d,m){const{top:x,left:T,bottom:E,right:P,chart:r}=c,{chartArea:B,scales:W}=r;let Z=0,ae,fe,Le;const De=E-x,Ve=P-T;if(c.isHorizontal()){if(fe=Mf(m,T,P),an(d)){const Ye=Object.keys(d)[0],lt=d[Ye];Le=W[Ye].getPixelForValue(lt)+De-a}else d==="center"?Le=(B.bottom+B.top)/2+De-a:Le=dT(c,d,a);ae=P-T}else{if(an(d)){const Ye=Object.keys(d)[0],lt=d[Ye];fe=W[Ye].getPixelForValue(lt)-Ve+a}else d==="center"?fe=(B.left+B.right)/2-Ve+a:fe=dT(c,d,a);Le=Mf(m,E,x),Z=d==="left"?-Hr:Hr}return{titleX:fe,titleY:Le,maxWidth:ae,rotation:Z}}class Uc extends Uf{constructor(a){super(),this.id=a.id,this.type=a.type,this.options=void 0,this.ctx=a.ctx,this.chart=a.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(a){this.options=a.setContext(this.getContext()),this.axis=a.axis,this._userMin=this.parse(a.min),this._userMax=this.parse(a.max),this._suggestedMin=this.parse(a.suggestedMin),this._suggestedMax=this.parse(a.suggestedMax)}parse(a,d){return a}getUserBounds(){let{_userMin:a,_userMax:d,_suggestedMin:m,_suggestedMax:x}=this;return a=Ts(a,Number.POSITIVE_INFINITY),d=Ts(d,Number.NEGATIVE_INFINITY),m=Ts(m,Number.POSITIVE_INFINITY),x=Ts(x,Number.NEGATIVE_INFINITY),{min:Ts(a,m),max:Ts(d,x),minDefined:br(a),maxDefined:br(d)}}getMinMax(a){let{min:d,max:m,minDefined:x,maxDefined:T}=this.getUserBounds(),E;if(x&&T)return{min:d,max:m};const P=this.getMatchingVisibleMetas();for(let r=0,B=P.length;r<B;++r)E=P[r].controller.getMinMax(this,a),x||(d=Math.min(d,E.min)),T||(m=Math.max(m,E.max));return d=T&&d>m?m:d,m=x&&d>m?d:m,{min:Ts(d,Ts(m,d)),max:Ts(m,Ts(d,m))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const a=this.chart.data;return this.options.labels||(this.isHorizontal()?a.xLabels:a.yLabels)||a.labels||[]}getLabelItems(a=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(a))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Zn(this.options.beforeUpdate,[this])}update(a,d,m){const{beginAtZero:x,grace:T,ticks:E}=this.options,P=E.sampleSize;this.beforeUpdate(),this.maxWidth=a,this.maxHeight=d,this._margins=m=Object.assign({left:0,right:0,top:0,bottom:0},m),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+m.left+m.right:this.height+m.top+m.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=uz(this,T,x),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const r=P<this.ticks.length;this._convertTicksToLabels(r?pT(this.ticks,P):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),E.display&&(E.autoSkip||E.source==="auto")&&(this.ticks=PL(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),r&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let a=this.options.reverse,d,m;this.isHorizontal()?(d=this.left,m=this.right):(d=this.top,m=this.bottom,a=!a),this._startPixel=d,this._endPixel=m,this._reversePixels=a,this._length=m-d,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Zn(this.options.afterUpdate,[this])}beforeSetDimensions(){Zn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Zn(this.options.afterSetDimensions,[this])}_callHooks(a){this.chart.notifyPlugins(a,this.getContext()),Zn(this.options[a],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Zn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(a){const d=this.options.ticks;let m,x,T;for(m=0,x=a.length;m<x;m++)T=a[m],T.label=Zn(d.callback,[T.value,m,a],this)}afterTickToLabelConversion(){Zn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Zn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const a=this.options,d=a.ticks,m=fT(this.ticks.length,a.ticks.maxTicksLimit),x=d.minRotation||0,T=d.maxRotation;let E=x,P,r,B;if(!this._isVisible()||!d.display||x>=T||m<=1||!this.isHorizontal()){this.labelRotation=x;return}const W=this._getLabelSizes(),Z=W.widest.width,ae=W.highest.height,fe=lo(this.chart.width-Z,0,this.maxWidth);P=a.offset?this.maxWidth/m:fe/(m-1),Z+6>P&&(P=fe/(m-(a.offset?.5:1)),r=this.maxHeight-lf(a.grid)-d.padding-mT(a.title,this.chart.options.font),B=Math.sqrt(Z*Z+ae*ae),E=bx(Math.min(Math.asin(lo((W.highest.height+6)/P,-1,1)),Math.asin(lo(r/B,-1,1))-Math.asin(lo(ae/B,-1,1)))),E=Math.max(x,Math.min(T,E))),this.labelRotation=E}afterCalculateLabelRotation(){Zn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Zn(this.options.beforeFit,[this])}fit(){const a={width:0,height:0},{chart:d,options:{ticks:m,title:x,grid:T}}=this,E=this._isVisible(),P=this.isHorizontal();if(E){const r=mT(x,d.options.font);if(P?(a.width=this.maxWidth,a.height=lf(T)+r):(a.height=this.maxHeight,a.width=lf(T)+r),m.display&&this.ticks.length){const{first:B,last:W,widest:Z,highest:ae}=this._getLabelSizes(),fe=m.padding*2,Le=ao(this.labelRotation),De=Math.cos(Le),Ve=Math.sin(Le);if(P){const Ye=m.mirror?0:Ve*Z.width+De*ae.height;a.height=Math.min(this.maxHeight,a.height+Ye+fe)}else{const Ye=m.mirror?0:De*Z.width+Ve*ae.height;a.width=Math.min(this.maxWidth,a.width+Ye+fe)}this._calculatePadding(B,W,Ve,De)}}this._handleMargins(),P?(this.width=this._length=d.width-this._margins.left-this._margins.right,this.height=a.height):(this.width=a.width,this.height=this._length=d.height-this._margins.top-this._margins.bottom)}_calculatePadding(a,d,m,x){const{ticks:{align:T,padding:E},position:P}=this.options,r=this.labelRotation!==0,B=P!=="top"&&this.axis==="x";if(this.isHorizontal()){const W=this.getPixelForTick(0)-this.left,Z=this.right-this.getPixelForTick(this.ticks.length-1);let ae=0,fe=0;r?B?(ae=x*a.width,fe=m*d.height):(ae=m*a.height,fe=x*d.width):T==="start"?fe=d.width:T==="end"?ae=a.width:T!=="inner"&&(ae=a.width/2,fe=d.width/2),this.paddingLeft=Math.max((ae-W+E)*this.width/(this.width-W),0),this.paddingRight=Math.max((fe-Z+E)*this.width/(this.width-Z),0)}else{let W=d.height/2,Z=a.height/2;T==="start"?(W=0,Z=a.height):T==="end"&&(W=d.height,Z=0),this.paddingTop=W+E,this.paddingBottom=Z+E}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Zn(this.options.afterFit,[this])}isHorizontal(){const{axis:a,position:d}=this.options;return d==="top"||d==="bottom"||a==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(a){this.beforeTickToLabelConversion(),this.generateTickLabels(a);let d,m;for(d=0,m=a.length;d<m;d++)wn(a[d].label)&&(a.splice(d,1),m--,d--);this.afterTickToLabelConversion()}_getLabelSizes(){let a=this._labelSizes;if(!a){const d=this.options.ticks.sampleSize;let m=this.ticks;d<m.length&&(m=pT(m,d)),this._labelSizes=a=this._computeLabelSizes(m,m.length,this.options.ticks.maxTicksLimit)}return a}_computeLabelSizes(a,d,m){const{ctx:x,_longestTextCache:T}=this,E=[],P=[],r=Math.floor(d/fT(d,m));let B=0,W=0,Z,ae,fe,Le,De,Ve,Ye,lt,dt,gt,yt;for(Z=0;Z<d;Z+=r){if(Le=a[Z].label,De=this._resolveTickFontOptions(Z),x.font=Ve=De.string,Ye=T[Ve]=T[Ve]||{data:{},gc:[]},lt=De.lineHeight,dt=gt=0,!wn(Le)&&!jn(Le))dt=N_(x,Ye.data,Ye.gc,dt,Le),gt=lt;else if(jn(Le))for(ae=0,fe=Le.length;ae<fe;++ae)yt=Le[ae],!wn(yt)&&!jn(yt)&&(dt=N_(x,Ye.data,Ye.gc,dt,yt),gt+=lt);E.push(dt),P.push(gt),B=Math.max(dt,B),W=Math.max(gt,W)}BL(T,d);const Ut=E.indexOf(B),Yt=P.indexOf(W),wi=Gi=>({width:E[Gi]||0,height:P[Gi]||0});return{first:wi(0),last:wi(d-1),widest:wi(Ut),highest:wi(Yt),widths:E,heights:P}}getLabelForValue(a){return a}getPixelForValue(a,d){return NaN}getValueForPixel(a){}getPixelForTick(a){const d=this.ticks;return a<0||a>d.length-1?null:this.getPixelForValue(d[a].value)}getPixelForDecimal(a){this._reversePixels&&(a=1-a);const d=this._startPixel+a*this._length;return jR(this._alignToPixels?Sc(this.chart,d,0):d)}getDecimalForPixel(a){const d=(a-this._startPixel)/this._length;return this._reversePixels?1-d:d}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:a,max:d}=this;return a<0&&d<0?d:a>0&&d>0?a:0}getContext(a){const d=this.ticks||[];if(a>=0&&a<d.length){const m=d[a];return m.$context||(m.$context=VL(this.getContext(),a,m))}return this.$context||(this.$context=NL(this.chart.getContext(),this))}_tickSize(){const a=this.options.ticks,d=ao(this.labelRotation),m=Math.abs(Math.cos(d)),x=Math.abs(Math.sin(d)),T=this._getLabelSizes(),E=a.autoSkipPadding||0,P=T?T.widest.width+E:0,r=T?T.highest.height+E:0;return this.isHorizontal()?r*m>P*x?P/m:r/x:r*x<P*m?r/m:P/x}_isVisible(){const a=this.options.display;return a!=="auto"?!!a:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(a){const d=this.axis,m=this.chart,x=this.options,{grid:T,position:E,border:P}=x,r=T.offset,B=this.isHorizontal(),Z=this.ticks.length+(r?1:0),ae=lf(T),fe=[],Le=P.setContext(this.getContext()),De=Le.display?Le.width:0,Ve=De/2,Ye=function(qt){return Sc(m,qt,De)};let lt,dt,gt,yt,Ut,Yt,wi,Gi,Qt,tn,Ui,Un;if(E==="top")lt=Ye(this.bottom),Yt=this.bottom-ae,Gi=lt-Ve,tn=Ye(a.top)+Ve,Un=a.bottom;else if(E==="bottom")lt=Ye(this.top),tn=a.top,Un=Ye(a.bottom)-Ve,Yt=lt+Ve,Gi=this.top+ae;else if(E==="left")lt=Ye(this.right),Ut=this.right-ae,wi=lt-Ve,Qt=Ye(a.left)+Ve,Ui=a.right;else if(E==="right")lt=Ye(this.left),Qt=a.left,Ui=Ye(a.right)-Ve,Ut=lt+Ve,wi=this.left+ae;else if(d==="x"){if(E==="center")lt=Ye((a.top+a.bottom)/2+.5);else if(an(E)){const qt=Object.keys(E)[0],Ci=E[qt];lt=Ye(this.chart.scales[qt].getPixelForValue(Ci))}tn=a.top,Un=a.bottom,Yt=lt+Ve,Gi=Yt+ae}else if(d==="y"){if(E==="center")lt=Ye((a.left+a.right)/2);else if(an(E)){const qt=Object.keys(E)[0],Ci=E[qt];lt=Ye(this.chart.scales[qt].getPixelForValue(Ci))}Ut=lt-Ve,wi=Ut-ae,Qt=a.left,Ui=a.right}const er=Fn(x.ticks.maxTicksLimit,Z),Ri=Math.max(1,Math.ceil(Z/er));for(dt=0;dt<Z;dt+=Ri){const qt=this.getContext(dt),Ci=T.setContext(qt),Ti=P.setContext(qt),Tn=Ci.lineWidth,tr=Ci.color,Gn=Ti.dash||[],Kt=Ti.dashOffset,wr=Ci.tickWidth,vn=Ci.tickColor,Cr=Ci.tickBorderDash||[],Mn=Ci.tickBorderDashOffset;gt=FL(this,dt,r),gt!==void 0&&(yt=Sc(m,gt,Tn),B?Ut=wi=Qt=Ui=yt:Yt=Gi=tn=Un=yt,fe.push({tx1:Ut,ty1:Yt,tx2:wi,ty2:Gi,x1:Qt,y1:tn,x2:Ui,y2:Un,width:Tn,color:tr,borderDash:Gn,borderDashOffset:Kt,tickWidth:wr,tickColor:vn,tickBorderDash:Cr,tickBorderDashOffset:Mn}))}return this._ticksLength=Z,this._borderValue=lt,fe}_computeLabelItems(a){const d=this.axis,m=this.options,{position:x,ticks:T}=m,E=this.isHorizontal(),P=this.ticks,{align:r,crossAlign:B,padding:W,mirror:Z}=T,ae=lf(m.grid),fe=ae+W,Le=Z?-W:fe,De=-ao(this.labelRotation),Ve=[];let Ye,lt,dt,gt,yt,Ut,Yt,wi,Gi,Qt,tn,Ui,Un="middle";if(x==="top")Ut=this.bottom-Le,Yt=this._getXAxisLabelAlignment();else if(x==="bottom")Ut=this.top+Le,Yt=this._getXAxisLabelAlignment();else if(x==="left"){const Ri=this._getYAxisLabelAlignment(ae);Yt=Ri.textAlign,yt=Ri.x}else if(x==="right"){const Ri=this._getYAxisLabelAlignment(ae);Yt=Ri.textAlign,yt=Ri.x}else if(d==="x"){if(x==="center")Ut=(a.top+a.bottom)/2+fe;else if(an(x)){const Ri=Object.keys(x)[0],qt=x[Ri];Ut=this.chart.scales[Ri].getPixelForValue(qt)+fe}Yt=this._getXAxisLabelAlignment()}else if(d==="y"){if(x==="center")yt=(a.left+a.right)/2-fe;else if(an(x)){const Ri=Object.keys(x)[0],qt=x[Ri];yt=this.chart.scales[Ri].getPixelForValue(qt)}Yt=this._getYAxisLabelAlignment(ae).textAlign}d==="y"&&(r==="start"?Un="top":r==="end"&&(Un="bottom"));const er=this._getLabelSizes();for(Ye=0,lt=P.length;Ye<lt;++Ye){dt=P[Ye],gt=dt.label;const Ri=T.setContext(this.getContext(Ye));wi=this.getPixelForTick(Ye)+T.labelOffset,Gi=this._resolveTickFontOptions(Ye),Qt=Gi.lineHeight,tn=jn(gt)?gt.length:1;const qt=tn/2,Ci=Ri.color,Ti=Ri.textStrokeColor,Tn=Ri.textStrokeWidth;let tr=Yt;E?(yt=wi,Yt==="inner"&&(Ye===lt-1?tr=this.options.reverse?"left":"right":Ye===0?tr=this.options.reverse?"right":"left":tr="center"),x==="top"?B==="near"||De!==0?Ui=-tn*Qt+Qt/2:B==="center"?Ui=-er.highest.height/2-qt*Qt+Qt:Ui=-er.highest.height+Qt/2:B==="near"||De!==0?Ui=Qt/2:B==="center"?Ui=er.highest.height/2-qt*Qt:Ui=er.highest.height-tn*Qt,Z&&(Ui*=-1),De!==0&&!Ri.showLabelBackdrop&&(yt+=Qt/2*Math.sin(De))):(Ut=wi,Ui=(1-tn)*Qt/2);let Gn;if(Ri.showLabelBackdrop){const Kt=Ss(Ri.backdropPadding),wr=er.heights[Ye],vn=er.widths[Ye];let Cr=Ui-Kt.top,Mn=0-Kt.left;switch(Un){case"middle":Cr-=wr/2;break;case"bottom":Cr-=wr;break}switch(Yt){case"center":Mn-=vn/2;break;case"right":Mn-=vn;break;case"inner":Ye===lt-1?Mn-=vn:Ye>0&&(Mn-=vn/2);break}Gn={left:Mn,top:Cr,width:vn+Kt.width,height:wr+Kt.height,color:Ri.backdropColor}}Ve.push({label:gt,font:Gi,textOffset:Ui,options:{rotation:De,color:Ci,strokeColor:Ti,strokeWidth:Tn,textAlign:tr,textBaseline:Un,translation:[yt,Ut],backdrop:Gn}})}return Ve}_getXAxisLabelAlignment(){const{position:a,ticks:d}=this.options;if(-ao(this.labelRotation))return a==="top"?"left":"right";let x="center";return d.align==="start"?x="left":d.align==="end"?x="right":d.align==="inner"&&(x="inner"),x}_getYAxisLabelAlignment(a){const{position:d,ticks:{crossAlign:m,mirror:x,padding:T}}=this.options,E=this._getLabelSizes(),P=a+T,r=E.widest.width;let B,W;return d==="left"?x?(W=this.right+T,m==="near"?B="left":m==="center"?(B="center",W+=r/2):(B="right",W+=r)):(W=this.right-P,m==="near"?B="right":m==="center"?(B="center",W-=r/2):(B="left",W=this.left)):d==="right"?x?(W=this.left+T,m==="near"?B="right":m==="center"?(B="center",W-=r/2):(B="left",W-=r)):(W=this.left+P,m==="near"?B="left":m==="center"?(B="center",W+=r/2):(B="right",W=this.right)):B="right",{textAlign:B,x:W}}_computeLabelArea(){if(this.options.ticks.mirror)return;const a=this.chart,d=this.options.position;if(d==="left"||d==="right")return{top:0,left:this.left,bottom:a.height,right:this.right};if(d==="top"||d==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:a.width}}drawBackground(){const{ctx:a,options:{backgroundColor:d},left:m,top:x,width:T,height:E}=this;d&&(a.save(),a.fillStyle=d,a.fillRect(m,x,T,E),a.restore())}getLineWidthForValue(a){const d=this.options.grid;if(!this._isVisible()||!d.display)return 0;const x=this.ticks.findIndex(T=>T.value===a);return x>=0?d.setContext(this.getContext(x)).lineWidth:0}drawGrid(a){const d=this.options.grid,m=this.ctx,x=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(a));let T,E;const P=(r,B,W)=>{!W.width||!W.color||(m.save(),m.lineWidth=W.width,m.strokeStyle=W.color,m.setLineDash(W.borderDash||[]),m.lineDashOffset=W.borderDashOffset,m.beginPath(),m.moveTo(r.x,r.y),m.lineTo(B.x,B.y),m.stroke(),m.restore())};if(d.display)for(T=0,E=x.length;T<E;++T){const r=x[T];d.drawOnChartArea&&P({x:r.x1,y:r.y1},{x:r.x2,y:r.y2},r),d.drawTicks&&P({x:r.tx1,y:r.ty1},{x:r.tx2,y:r.ty2},{color:r.tickColor,width:r.tickWidth,borderDash:r.tickBorderDash,borderDashOffset:r.tickBorderDashOffset})}}drawBorder(){const{chart:a,ctx:d,options:{border:m,grid:x}}=this,T=m.setContext(this.getContext()),E=m.display?T.width:0;if(!E)return;const P=x.setContext(this.getContext(0)).lineWidth,r=this._borderValue;let B,W,Z,ae;this.isHorizontal()?(B=Sc(a,this.left,E)-E/2,W=Sc(a,this.right,P)+P/2,Z=ae=r):(Z=Sc(a,this.top,E)-E/2,ae=Sc(a,this.bottom,P)+P/2,B=W=r),d.save(),d.lineWidth=T.width,d.strokeStyle=T.color,d.beginPath(),d.moveTo(B,Z),d.lineTo(W,ae),d.stroke(),d.restore()}drawLabels(a){if(!this.options.ticks.display)return;const m=this.ctx,x=this._computeLabelArea();x&&uS(m,x);const T=this.getLabelItems(a);for(const E of T){const P=E.options,r=E.font,B=E.label,W=E.textOffset;kf(m,B,0,W,r,P)}x&&hS(m)}drawTitle(){const{ctx:a,options:{position:d,title:m,reverse:x}}=this;if(!m.display)return;const T=Zr(m.font),E=Ss(m.padding),P=m.align;let r=T.lineHeight/2;d==="bottom"||d==="center"||an(d)?(r+=E.bottom,jn(m.text)&&(r+=T.lineHeight*(m.text.length-1))):r+=E.top;const{titleX:B,titleY:W,maxWidth:Z,rotation:ae}=UL(this,r,d,P);kf(a,m.text,0,0,T,{color:m.color,maxWidth:Z,rotation:ae,textAlign:jL(P,d,x),textBaseline:"middle",translation:[B,W]})}draw(a){this._isVisible()&&(this.drawBackground(),this.drawGrid(a),this.drawBorder(),this.drawTitle(),this.drawLabels(a))}_layers(){const a=this.options,d=a.ticks&&a.ticks.z||0,m=Fn(a.grid&&a.grid.z,-1),x=Fn(a.border&&a.border.z,0);return!this._isVisible()||this.draw!==Uc.prototype.draw?[{z:d,draw:T=>{this.draw(T)}}]:[{z:m,draw:T=>{this.drawBackground(),this.drawGrid(T),this.drawTitle()}},{z:x,draw:()=>{this.drawBorder()}},{z:d,draw:T=>{this.drawLabels(T)}}]}getMatchingVisibleMetas(a){const d=this.chart.getSortedVisibleDatasetMetas(),m=this.axis+"AxisID",x=[];let T,E;for(T=0,E=d.length;T<E;++T){const P=d[T];P[m]===this.id&&(!a||P.type===a)&&x.push(P)}return x}_resolveTickFontOptions(a){const d=this.options.ticks.setContext(this.getContext(a));return Zr(d.font)}_maxDigits(){const a=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/a}}class d_{constructor(a,d,m){this.type=a,this.scope=d,this.override=m,this.items=Object.create(null)}isForType(a){return Object.prototype.isPrototypeOf.call(this.type.prototype,a.prototype)}register(a){const d=Object.getPrototypeOf(a);let m;qL(d)&&(m=this.register(d));const x=this.items,T=a.id,E=this.scope+"."+T;if(!T)throw new Error("class does not have id: "+a);return T in x||(x[T]=a,GL(a,E,m),this.override&&Kn.override(a.id,a.overrides)),E}get(a){return this.items[a]}unregister(a){const d=this.items,m=a.id,x=this.scope;m in d&&delete d[m],x&&m in Kn[x]&&(delete Kn[x][m],this.override&&delete Bc[m])}}function GL(c,a,d){const m=zf(Object.create(null),[d?Kn.get(d):{},Kn.get(a),c.defaults]);Kn.set(a,m),c.defaultRoutes&&$L(a,c.defaultRoutes),c.descriptors&&Kn.describe(a,c.descriptors)}function $L(c,a){Object.keys(a).forEach(d=>{const m=d.split("."),x=m.pop(),T=[c].concat(m).join("."),E=a[d].split("."),P=E.pop(),r=E.join(".");Kn.route(T,x,r,P)})}function qL(c){return"id"in c&&"defaults"in c}class WL{constructor(){this.controllers=new d_(kc,"datasets",!0),this.elements=new d_(Uf,"elements"),this.plugins=new d_(Object,"plugins"),this.scales=new d_(Uc,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...a){this._each("register",a)}remove(...a){this._each("unregister",a)}addControllers(...a){this._each("register",a,this.controllers)}addElements(...a){this._each("register",a,this.elements)}addPlugins(...a){this._each("register",a,this.plugins)}addScales(...a){this._each("register",a,this.scales)}getController(a){return this._get(a,this.controllers,"controller")}getElement(a){return this._get(a,this.elements,"element")}getPlugin(a){return this._get(a,this.plugins,"plugin")}getScale(a){return this._get(a,this.scales,"scale")}removeControllers(...a){this._each("unregister",a,this.controllers)}removeElements(...a){this._each("unregister",a,this.elements)}removePlugins(...a){this._each("unregister",a,this.plugins)}removeScales(...a){this._each("unregister",a,this.scales)}_each(a,d,m){[...d].forEach(x=>{const T=m||this._getRegistryForType(x);m||T.isForType(x)||T===this.plugins&&x.id?this._exec(a,T,x):xn(x,E=>{const P=m||this._getRegistryForType(E);this._exec(a,P,E)})})}_exec(a,d,m){const x=vx(a);Zn(m["before"+x],[],m),d[a](m),Zn(m["after"+x],[],m)}_getRegistryForType(a){for(let d=0;d<this._typedRegistries.length;d++){const m=this._typedRegistries[d];if(m.isForType(a))return m}return this.plugins}_get(a,d,m){const x=d.get(a);if(x===void 0)throw new Error('"'+a+'" is not a registered '+m+".");return x}}var Io=new WL;class HL{constructor(){this._init=[]}notify(a,d,m,x){d==="beforeInit"&&(this._init=this._createDescriptors(a,!0),this._notify(this._init,a,"install"));const T=x?this._descriptors(a).filter(x):this._descriptors(a),E=this._notify(T,a,d,m);return d==="afterDestroy"&&(this._notify(T,a,"stop"),this._notify(this._init,a,"uninstall")),E}_notify(a,d,m,x){x=x||{};for(const T of a){const E=T.plugin,P=E[m],r=[d,x,T.options];if(Zn(P,r,E)===!1&&x.cancelable)return!1}return!0}invalidate(){wn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(a){if(this._cache)return this._cache;const d=this._cache=this._createDescriptors(a);return this._notifyStateChanges(a),d}_createDescriptors(a,d){const m=a&&a.config,x=Fn(m.options&&m.options.plugins,{}),T=ZL(m);return x===!1&&!d?[]:XL(a,T,x,d)}_notifyStateChanges(a){const d=this._oldCache||[],m=this._cache,x=(T,E)=>T.filter(P=>!E.some(r=>P.plugin.id===r.plugin.id));this._notify(x(d,m),a,"stop"),this._notify(x(m,d),a,"start")}}function ZL(c){const a={},d=[],m=Object.keys(Io.plugins.items);for(let T=0;T<m.length;T++)d.push(Io.getPlugin(m[T]));const x=c.plugins||[];for(let T=0;T<x.length;T++){const E=x[T];d.indexOf(E)===-1&&(d.push(E),a[E.id]=!0)}return{plugins:d,localIds:a}}function QL(c,a){return!a&&c===!1?null:c===!0?{}:c}function XL(c,{plugins:a,localIds:d},m,x){const T=[],E=c.getContext();for(const P of a){const r=P.id,B=QL(m[r],x);B!==null&&T.push({plugin:P,options:YL(c.config,{plugin:P,local:d[r]},B,E)})}return T}function YL(c,{plugin:a,local:d},m,x){const T=c.pluginScopeKeys(a),E=c.getOptionScopes(m,T);return d&&a.defaults&&E.push(a.defaults),c.createResolver(E,x,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function G0(c,a){const d=Kn.datasets[c]||{};return((a.datasets||{})[c]||{}).indexAxis||a.indexAxis||d.indexAxis||"x"}function KL(c,a){let d=c;return c==="_index_"?d=a:c==="_value_"&&(d=a==="x"?"y":"x"),d}function JL(c,a){return c===a?"_index_":"_value_"}function _T(c){if(c==="x"||c==="y"||c==="r")return c}function ek(c){if(c==="top"||c==="bottom")return"x";if(c==="left"||c==="right")return"y"}function $0(c,...a){if(_T(c))return c;for(const d of a){const m=d.axis||ek(d.position)||c.length>1&&_T(c[0].toLowerCase());if(m)return m}throw new Error(`Cannot determine type of '${c}' axis. Please provide 'axis' or 'position' option.`)}function gT(c,a,d){if(d[a+"AxisID"]===c)return{axis:a}}function tk(c,a){if(a.data&&a.data.datasets){const d=a.data.datasets.filter(m=>m.xAxisID===c||m.yAxisID===c);if(d.length)return gT(c,"x",d[0])||gT(c,"y",d[0])}return{}}function ik(c,a){const d=Bc[c.type]||{scales:{}},m=a.scales||{},x=G0(c.type,a),T=Object.create(null);return Object.keys(m).forEach(E=>{const P=m[E];if(!an(P))return console.error(`Invalid scale configuration for scale: ${E}`);if(P._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${E}`);const r=$0(E,P,tk(E,c),Kn.scales[P.type]),B=JL(r,x),W=d.scales||{};T[E]=Tf(Object.create(null),[{axis:r},P,W[r],W[B]])}),c.data.datasets.forEach(E=>{const P=E.type||c.type,r=E.indexAxis||G0(P,a),W=(Bc[P]||{}).scales||{};Object.keys(W).forEach(Z=>{const ae=KL(Z,r),fe=E[ae+"AxisID"]||ae;T[fe]=T[fe]||Object.create(null),Tf(T[fe],[{axis:ae},m[fe],W[Z]])})}),Object.keys(T).forEach(E=>{const P=T[E];Tf(P,[Kn.scales[P.type],Kn.scale])}),T}function ES(c){const a=c.options||(c.options={});a.plugins=Fn(a.plugins,{}),a.scales=ik(c,a)}function AS(c){return c=c||{},c.datasets=c.datasets||[],c.labels=c.labels||[],c}function nk(c){return c=c||{},c.data=AS(c.data),ES(c),c}const yT=new Map,IS=new Set;function f_(c,a){let d=yT.get(c);return d||(d=a(),yT.set(c,d),IS.add(d)),d}const cf=(c,a,d)=>{const m=ml(a,d);m!==void 0&&c.add(m)};class rk{constructor(a){this._config=nk(a),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(a){this._config.type=a}get data(){return this._config.data}set data(a){this._config.data=AS(a)}get options(){return this._config.options}set options(a){this._config.options=a}get plugins(){return this._config.plugins}update(){const a=this._config;this.clearCache(),ES(a)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(a){return f_(a,()=>[[`datasets.${a}`,""]])}datasetAnimationScopeKeys(a,d){return f_(`${a}.transition.${d}`,()=>[[`datasets.${a}.transitions.${d}`,`transitions.${d}`],[`datasets.${a}`,""]])}datasetElementScopeKeys(a,d){return f_(`${a}-${d}`,()=>[[`datasets.${a}.elements.${d}`,`datasets.${a}`,`elements.${d}`,""]])}pluginScopeKeys(a){const d=a.id,m=this.type;return f_(`${m}-plugin-${d}`,()=>[[`plugins.${d}`,...a.additionalOptionScopes||[]]])}_cachedScopes(a,d){const m=this._scopeCache;let x=m.get(a);return(!x||d)&&(x=new Map,m.set(a,x)),x}getOptionScopes(a,d,m){const{options:x,type:T}=this,E=this._cachedScopes(a,m),P=E.get(d);if(P)return P;const r=new Set;d.forEach(W=>{a&&(r.add(a),W.forEach(Z=>cf(r,a,Z))),W.forEach(Z=>cf(r,x,Z)),W.forEach(Z=>cf(r,Bc[T]||{},Z)),W.forEach(Z=>cf(r,Kn,Z)),W.forEach(Z=>cf(r,U0,Z))});const B=Array.from(r);return B.length===0&&B.push(Object.create(null)),IS.has(d)&&E.set(d,B),B}chartOptionScopes(){const{options:a,type:d}=this;return[a,Bc[d]||{},Kn.datasets[d]||{},{type:d},Kn,U0]}resolveNamedOptions(a,d,m,x=[""]){const T={$shared:!0},{resolver:E,subPrefixes:P}=xT(this._resolverCache,a,x);let r=E;if(ok(E,d)){T.$shared=!1,m=_l(m)?m():m;const B=this.createResolver(a,m,P);r=bh(E,m,B)}for(const B of d)T[B]=r[B];return T}createResolver(a,d,m=[""],x){const{resolver:T}=xT(this._resolverCache,a,m);return an(d)?bh(T,d,void 0,x):T}}function xT(c,a,d){let m=c.get(a);m||(m=new Map,c.set(a,m));const x=d.join();let T=m.get(x);return T||(T={resolver:Tx(a,d),subPrefixes:d.filter(P=>!P.toLowerCase().includes("hover"))},m.set(x,T)),T}const sk=c=>an(c)&&Object.getOwnPropertyNames(c).some(a=>_l(c[a]));function ok(c,a){const{isScriptable:d,isIndexable:m}=pS(c);for(const x of a){const T=d(x),E=m(x),P=(E||T)&&c[x];if(T&&(_l(P)||sk(P))||E&&jn(P))return!0}return!1}var ak="4.4.3";const lk=["top","bottom","left","right","chartArea"];function vT(c,a){return c==="top"||c==="bottom"||lk.indexOf(c)===-1&&a==="x"}function bT(c,a){return function(d,m){return d[c]===m[c]?d[a]-m[a]:d[c]-m[c]}}function wT(c){const a=c.chart,d=a.options.animation;a.notifyPlugins("afterRender"),Zn(d&&d.onComplete,[c],a)}function ck(c){const a=c.chart,d=a.options.animation;Zn(d&&d.onProgress,[c],a)}function CS(c){return Ex()&&typeof c=="string"?c=document.getElementById(c):c&&c.length&&(c=c[0]),c&&c.canvas&&(c=c.canvas),c}const I_={},TT=c=>{const a=CS(c);return Object.values(I_).filter(d=>d.canvas===a).pop()};function uk(c,a,d){const m=Object.keys(c);for(const x of m){const T=+x;if(T>=a){const E=c[x];delete c[x],(d>0||T>a)&&(c[T+d]=E)}}}function hk(c,a,d,m){return!d||c.type==="mouseout"?null:m?a:c}function p_(c,a,d){return c.options.clip?c[d]:a[d]}function dk(c,a){const{xScale:d,yScale:m}=c;return d&&m?{left:p_(d,a,"left"),right:p_(d,a,"right"),top:p_(m,a,"top"),bottom:p_(m,a,"bottom")}:a}var nl;let sg=(nl=class{static register(...a){Io.add(...a),MT()}static unregister(...a){Io.remove(...a),MT()}constructor(a,d){const m=this.config=new rk(d),x=CS(a),T=TT(x);if(T)throw new Error("Canvas is already in use. Chart with ID '"+T.id+"' must be destroyed before the canvas with ID '"+T.canvas.id+"' can be reused.");const E=m.createResolver(m.chartOptionScopes(),this.getContext());this.platform=new(m.platform||CL(x)),this.platform.updateConfig(m);const P=this.platform.acquireContext(x,E.aspectRatio),r=P&&P.canvas,B=r&&r.height,W=r&&r.width;if(this.id=CR(),this.ctx=P,this.canvas=r,this.width=W,this.height=B,this._options=E,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new HL,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=qR(Z=>this.update(Z),E.resizeDelay||0),this._dataChanges=[],I_[this.id]=this,!P||!r){console.error("Failed to create chart: can't acquire context from the given item");return}la.listen(this,"complete",wT),la.listen(this,"progress",ck),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:a,maintainAspectRatio:d},width:m,height:x,_aspectRatio:T}=this;return wn(a)?d&&T?T:x?m/x:null:a}get data(){return this.config.data}set data(a){this.config.data=a}get options(){return this._options}set options(a){this.config.options=a}get registry(){return Io}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Zw(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return $w(this.canvas,this.ctx),this}stop(){return la.stop(this),this}resize(a,d){la.running(this)?this._resizeBeforeDraw={width:a,height:d}:this._resize(a,d)}_resize(a,d){const m=this.options,x=this.canvas,T=m.maintainAspectRatio&&this.aspectRatio,E=this.platform.getMaximumSize(x,a,d,T),P=m.devicePixelRatio||this.platform.getDevicePixelRatio(),r=this.width?"resize":"attach";this.width=E.width,this.height=E.height,this._aspectRatio=this.aspectRatio,Zw(this,P,!0)&&(this.notifyPlugins("resize",{size:E}),Zn(m.onResize,[this,E],this),this.attached&&this._doResize(r)&&this.render())}ensureScalesHaveIDs(){const d=this.options.scales||{};xn(d,(m,x)=>{m.id=x})}buildOrUpdateScales(){const a=this.options,d=a.scales,m=this.scales,x=Object.keys(m).reduce((E,P)=>(E[P]=!1,E),{});let T=[];d&&(T=T.concat(Object.keys(d).map(E=>{const P=d[E],r=$0(E,P),B=r==="r",W=r==="x";return{options:P,dposition:B?"chartArea":W?"bottom":"left",dtype:B?"radialLinear":W?"category":"linear"}}))),xn(T,E=>{const P=E.options,r=P.id,B=$0(r,P),W=Fn(P.type,E.dtype);(P.position===void 0||vT(P.position,B)!==vT(E.dposition))&&(P.position=E.dposition),x[r]=!0;let Z=null;if(r in m&&m[r].type===W)Z=m[r];else{const ae=Io.getScale(W);Z=new ae({id:r,type:W,ctx:this.ctx,chart:this}),m[Z.id]=Z}Z.init(P,a)}),xn(x,(E,P)=>{E||delete m[P]}),xn(m,E=>{cl.configure(this,E,E.options),cl.addBox(this,E)})}_updateMetasets(){const a=this._metasets,d=this.data.datasets.length,m=a.length;if(a.sort((x,T)=>x.index-T.index),m>d){for(let x=d;x<m;++x)this._destroyDatasetMeta(x);a.splice(d,m-d)}this._sortedMetasets=a.slice(0).sort(bT("order","index"))}_removeUnreferencedMetasets(){const{_metasets:a,data:{datasets:d}}=this;a.length>d.length&&delete this._stacks,a.forEach((m,x)=>{d.filter(T=>T===m._dataset).length===0&&this._destroyDatasetMeta(x)})}buildOrUpdateControllers(){const a=[],d=this.data.datasets;let m,x;for(this._removeUnreferencedMetasets(),m=0,x=d.length;m<x;m++){const T=d[m];let E=this.getDatasetMeta(m);const P=T.type||this.config.type;if(E.type&&E.type!==P&&(this._destroyDatasetMeta(m),E=this.getDatasetMeta(m)),E.type=P,E.indexAxis=T.indexAxis||G0(P,this.options),E.order=T.order||0,E.index=m,E.label=""+T.label,E.visible=this.isDatasetVisible(m),E.controller)E.controller.updateIndex(m),E.controller.linkScales();else{const r=Io.getController(P),{datasetElementType:B,dataElementType:W}=Kn.datasets[P];Object.assign(r,{dataElementType:Io.getElement(W),datasetElementType:B&&Io.getElement(B)}),E.controller=new r(this,m),a.push(E.controller)}}return this._updateMetasets(),a}_resetElements(){xn(this.data.datasets,(a,d)=>{this.getDatasetMeta(d).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(a){const d=this.config;d.update();const m=this._options=d.createResolver(d.chartOptionScopes(),this.getContext()),x=this._animationsDisabled=!m.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:a,cancelable:!0})===!1)return;const T=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let E=0;for(let B=0,W=this.data.datasets.length;B<W;B++){const{controller:Z}=this.getDatasetMeta(B),ae=!x&&T.indexOf(Z)===-1;Z.buildOrUpdateElements(ae),E=Math.max(+Z.getMaxOverflow(),E)}E=this._minPadding=m.layout.autoPadding?E:0,this._updateLayout(E),x||xn(T,B=>{B.reset()}),this._updateDatasets(a),this.notifyPlugins("afterUpdate",{mode:a}),this._layers.sort(bT("z","_idx"));const{_active:P,_lastEvent:r}=this;r?this._eventHandler(r,!0):P.length&&this._updateHoverStyles(P,P,!0),this.render()}_updateScales(){xn(this.scales,a=>{cl.removeBox(this,a)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const a=this.options,d=new Set(Object.keys(this._listeners)),m=new Set(a.events);(!Lw(d,m)||!!this._responsiveListeners!==a.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:a}=this,d=this._getUniformDataChanges()||[];for(const{method:m,start:x,count:T}of d){const E=m==="_removeElements"?-T:T;uk(a,x,E)}}_getUniformDataChanges(){const a=this._dataChanges;if(!a||!a.length)return;this._dataChanges=[];const d=this.data.datasets.length,m=T=>new Set(a.filter(E=>E[0]===T).map((E,P)=>P+","+E.splice(1).join(","))),x=m(0);for(let T=1;T<d;T++)if(!Lw(x,m(T)))return;return Array.from(x).map(T=>T.split(",")).map(T=>({method:T[1],start:+T[2],count:+T[3]}))}_updateLayout(a){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;cl.update(this,this.width,this.height,a);const d=this.chartArea,m=d.width<=0||d.height<=0;this._layers=[],xn(this.boxes,x=>{m&&x.position==="chartArea"||(x.configure&&x.configure(),this._layers.push(...x._layers()))},this),this._layers.forEach((x,T)=>{x._idx=T}),this.notifyPlugins("afterLayout")}_updateDatasets(a){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:a,cancelable:!0})!==!1){for(let d=0,m=this.data.datasets.length;d<m;++d)this.getDatasetMeta(d).controller.configure();for(let d=0,m=this.data.datasets.length;d<m;++d)this._updateDataset(d,_l(a)?a({datasetIndex:d}):a);this.notifyPlugins("afterDatasetsUpdate",{mode:a})}}_updateDataset(a,d){const m=this.getDatasetMeta(a),x={meta:m,index:a,mode:d,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",x)!==!1&&(m.controller._update(d),x.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",x))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(la.has(this)?this.attached&&!la.running(this)&&la.start(this):(this.draw(),wT({chart:this})))}draw(){let a;if(this._resizeBeforeDraw){const{width:m,height:x}=this._resizeBeforeDraw;this._resize(m,x),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const d=this._layers;for(a=0;a<d.length&&d[a].z<=0;++a)d[a].draw(this.chartArea);for(this._drawDatasets();a<d.length;++a)d[a].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(a){const d=this._sortedMetasets,m=[];let x,T;for(x=0,T=d.length;x<T;++x){const E=d[x];(!a||E.visible)&&m.push(E)}return m}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const a=this.getSortedVisibleDatasetMetas();for(let d=a.length-1;d>=0;--d)this._drawDataset(a[d]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(a){const d=this.ctx,m=a._clip,x=!m.disabled,T=dk(a,this.chartArea),E={meta:a,index:a.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",E)!==!1&&(x&&uS(d,{left:m.left===!1?0:T.left-m.left,right:m.right===!1?this.width:T.right+m.right,top:m.top===!1?0:T.top-m.top,bottom:m.bottom===!1?this.height:T.bottom+m.bottom}),a.controller.draw(),x&&hS(d),E.cancelable=!1,this.notifyPlugins("afterDatasetDraw",E))}isPointInArea(a){return ph(a,this.chartArea,this._minPadding)}getElementsAtEventForMode(a,d,m,x){const T=lL.modes[d];return typeof T=="function"?T(this,a,m,x):[]}getDatasetMeta(a){const d=this.data.datasets[a],m=this._metasets;let x=m.filter(T=>T&&T._dataset===d).pop();return x||(x={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:d&&d.order||0,index:a,_dataset:d,_parsed:[],_sorted:!1},m.push(x)),x}getContext(){return this.$context||(this.$context=jc(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(a){const d=this.data.datasets[a];if(!d)return!1;const m=this.getDatasetMeta(a);return typeof m.hidden=="boolean"?!m.hidden:!d.hidden}setDatasetVisibility(a,d){const m=this.getDatasetMeta(a);m.hidden=!d}toggleDataVisibility(a){this._hiddenIndices[a]=!this._hiddenIndices[a]}getDataVisibility(a){return!this._hiddenIndices[a]}_updateVisibility(a,d,m){const x=m?"show":"hide",T=this.getDatasetMeta(a),E=T.controller._resolveAnimations(void 0,x);Lf(d)?(T.data[d].hidden=!m,this.update()):(this.setDatasetVisibility(a,m),E.update(T,{visible:m}),this.update(P=>P.datasetIndex===a?x:void 0))}hide(a,d){this._updateVisibility(a,d,!1)}show(a,d){this._updateVisibility(a,d,!0)}_destroyDatasetMeta(a){const d=this._metasets[a];d&&d.controller&&d.controller._destroy(),delete this._metasets[a]}_stop(){let a,d;for(this.stop(),la.remove(this),a=0,d=this.data.datasets.length;a<d;++a)this._destroyDatasetMeta(a)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:a,ctx:d}=this;this._stop(),this.config.clearCache(),a&&(this.unbindEvents(),$w(a,d),this.platform.releaseContext(d),this.canvas=null,this.ctx=null),delete I_[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...a){return this.canvas.toDataURL(...a)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const a=this._listeners,d=this.platform,m=(T,E)=>{d.addEventListener(this,T,E),a[T]=E},x=(T,E,P)=>{T.offsetX=E,T.offsetY=P,this._eventHandler(T)};xn(this.options.events,T=>m(T,x))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const a=this._responsiveListeners,d=this.platform,m=(r,B)=>{d.addEventListener(this,r,B),a[r]=B},x=(r,B)=>{a[r]&&(d.removeEventListener(this,r,B),delete a[r])},T=(r,B)=>{this.canvas&&this.resize(r,B)};let E;const P=()=>{x("attach",P),this.attached=!0,this.resize(),m("resize",T),m("detach",E)};E=()=>{this.attached=!1,x("resize",T),this._stop(),this._resize(0,0),m("attach",P)},d.isAttached(this.canvas)?P():E()}unbindEvents(){xn(this._listeners,(a,d)=>{this.platform.removeEventListener(this,d,a)}),this._listeners={},xn(this._responsiveListeners,(a,d)=>{this.platform.removeEventListener(this,d,a)}),this._responsiveListeners=void 0}updateHoverStyle(a,d,m){const x=m?"set":"remove";let T,E,P,r;for(d==="dataset"&&(T=this.getDatasetMeta(a[0].datasetIndex),T.controller["_"+x+"DatasetHoverStyle"]()),P=0,r=a.length;P<r;++P){E=a[P];const B=E&&this.getDatasetMeta(E.datasetIndex).controller;B&&B[x+"HoverStyle"](E.element,E.datasetIndex,E.index)}}getActiveElements(){return this._active||[]}setActiveElements(a){const d=this._active||[],m=a.map(({datasetIndex:T,index:E})=>{const P=this.getDatasetMeta(T);if(!P)throw new Error("No dataset found at index "+T);return{datasetIndex:T,element:P.data[E],index:E}});!k_(m,d)&&(this._active=m,this._lastEvent=null,this._updateHoverStyles(m,d))}notifyPlugins(a,d,m){return this._plugins.notify(this,a,d,m)}isPluginEnabled(a){return this._plugins._cache.filter(d=>d.plugin.id===a).length===1}_updateHoverStyles(a,d,m){const x=this.options.hover,T=(r,B)=>r.filter(W=>!B.some(Z=>W.datasetIndex===Z.datasetIndex&&W.index===Z.index)),E=T(d,a),P=m?a:T(a,d);E.length&&this.updateHoverStyle(E,x.mode,!1),P.length&&x.mode&&this.updateHoverStyle(P,x.mode,!0)}_eventHandler(a,d){const m={event:a,replay:d,cancelable:!0,inChartArea:this.isPointInArea(a)},x=E=>(E.options.events||this.options.events).includes(a.native.type);if(this.notifyPlugins("beforeEvent",m,x)===!1)return;const T=this._handleEvent(a,d,m.inChartArea);return m.cancelable=!1,this.notifyPlugins("afterEvent",m,x),(T||m.changed)&&this.render(),this}_handleEvent(a,d,m){const{_active:x=[],options:T}=this,E=d,P=this._getActiveElements(a,x,m,E),r=kR(a),B=hk(a,this._lastEvent,m,r);m&&(this._lastEvent=null,Zn(T.onHover,[a,P,this],this),r&&Zn(T.onClick,[a,P,this],this));const W=!k_(P,x);return(W||d)&&(this._active=P,this._updateHoverStyles(P,x,d)),this._lastEvent=B,W}_getActiveElements(a,d,m,x){if(a.type==="mouseout")return[];if(!m)return d;const T=this.options.hover;return this.getElementsAtEventForMode(a,T.mode,T,x)}},Ii(nl,"defaults",Kn),Ii(nl,"instances",I_),Ii(nl,"overrides",Bc),Ii(nl,"registry",Io),Ii(nl,"version",ak),Ii(nl,"getChart",TT),nl);function MT(){return xn(sg.instances,c=>c._plugins.invalidate())}function PS(c,a){const{x:d,y:m,base:x,width:T,height:E}=c.getProps(["x","y","base","width","height"],a);let P,r,B,W,Z;return c.horizontal?(Z=E/2,P=Math.min(d,x),r=Math.max(d,x),B=m-Z,W=m+Z):(Z=T/2,P=d-Z,r=d+Z,B=Math.min(m,x),W=Math.max(m,x)),{left:P,top:B,right:r,bottom:W}}function ul(c,a,d,m){return c?0:lo(a,d,m)}function fk(c,a,d){const m=c.options.borderWidth,x=c.borderSkipped,T=fS(m);return{t:ul(x.top,T.top,0,d),r:ul(x.right,T.right,0,a),b:ul(x.bottom,T.bottom,0,d),l:ul(x.left,T.left,0,a)}}function pk(c,a,d){const{enableBorderRadius:m}=c.getProps(["enableBorderRadius"]),x=c.options.borderRadius,T=xh(x),E=Math.min(a,d),P=c.borderSkipped,r=m||an(x);return{topLeft:ul(!r||P.top||P.left,T.topLeft,0,E),topRight:ul(!r||P.top||P.right,T.topRight,0,E),bottomLeft:ul(!r||P.bottom||P.left,T.bottomLeft,0,E),bottomRight:ul(!r||P.bottom||P.right,T.bottomRight,0,E)}}function mk(c){const a=PS(c),d=a.right-a.left,m=a.bottom-a.top,x=fk(c,d/2,m/2),T=pk(c,d/2,m/2);return{outer:{x:a.left,y:a.top,w:d,h:m,radius:T},inner:{x:a.left+x.l,y:a.top+x.t,w:d-x.l-x.r,h:m-x.t-x.b,radius:{topLeft:Math.max(0,T.topLeft-Math.max(x.t,x.l)),topRight:Math.max(0,T.topRight-Math.max(x.t,x.r)),bottomLeft:Math.max(0,T.bottomLeft-Math.max(x.b,x.l)),bottomRight:Math.max(0,T.bottomRight-Math.max(x.b,x.r))}}}}function T0(c,a,d,m){const x=a===null,T=d===null,P=c&&!(x&&T)&&PS(c,m);return P&&(x||Bw(a,P.left,P.right))&&(T||Bw(d,P.top,P.bottom))}function _k(c){return c.topLeft||c.topRight||c.bottomLeft||c.bottomRight}function gk(c,a){c.rect(a.x,a.y,a.w,a.h)}function M0(c,a,d={}){const m=c.x!==d.x?-a:0,x=c.y!==d.y?-a:0,T=(c.x+c.w!==d.x+d.w?a:0)-m,E=(c.y+c.h!==d.y+d.h?a:0)-x;return{x:c.x+m,y:c.y+x,w:c.w+T,h:c.h+E,radius:c.radius}}class C_ extends Uf{constructor(a){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,a&&Object.assign(this,a)}draw(a){const{inflateAmount:d,options:{borderColor:m,backgroundColor:x}}=this,{inner:T,outer:E}=mk(this),P=_k(E.radius)?V_:gk;a.save(),(E.w!==T.w||E.h!==T.h)&&(a.beginPath(),P(a,M0(E,d,T)),a.clip(),P(a,M0(T,-d,E)),a.fillStyle=m,a.fill("evenodd")),a.beginPath(),P(a,M0(T,d)),a.fillStyle=x,a.fill(),a.restore()}inRange(a,d,m){return T0(this,a,d,m)}inXRange(a,d){return T0(this,a,null,d)}inYRange(a,d){return T0(this,null,a,d)}getCenterPoint(a){const{x:d,y:m,base:x,horizontal:T}=this.getProps(["x","y","base","horizontal"],a);return{x:T?(d+x)/2:d,y:T?m:(m+x)/2}}getRange(a){return a==="x"?this.width/2:this.height/2}}Ii(C_,"id","bar"),Ii(C_,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Ii(C_,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const q0=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],ST=q0.map(c=>c.replace("rgb(","rgba(").replace(")",", 0.5)"));function DS(c){return q0[c%q0.length]}function RS(c){return ST[c%ST.length]}function yk(c,a){return c.borderColor=DS(a),c.backgroundColor=RS(a),++a}function xk(c,a){return c.backgroundColor=c.data.map(()=>DS(a++)),a}function vk(c,a){return c.backgroundColor=c.data.map(()=>RS(a++)),a}function bk(c){let a=0;return(d,m)=>{const x=c.getDatasetMeta(m).controller;x instanceof pf?a=xk(d,a):x instanceof E_?a=vk(d,a):x&&(a=yk(d,a))}}function ET(c){let a;for(a in c)if(c[a].borderColor||c[a].backgroundColor)return!0;return!1}function wk(c){return c&&(c.borderColor||c.backgroundColor)}var Tk={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(c,a,d){if(!d.enabled)return;const{data:{datasets:m},options:x}=c.config,{elements:T}=x;if(!d.forceOverride&&(ET(m)||wk(x)||T&&ET(T)))return;const E=bk(c);m.forEach(E)}};class zS extends Uf{constructor(a){super(),this.chart=a.chart,this.options=a.options,this.ctx=a.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(a,d){const m=this.options;if(this.left=0,this.top=0,!m.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=a,this.height=this.bottom=d;const x=jn(m.text)?m.text.length:1;this._padding=Ss(m.padding);const T=x*Zr(m.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=T:this.width=T}isHorizontal(){const a=this.options.position;return a==="top"||a==="bottom"}_drawArgs(a){const{top:d,left:m,bottom:x,right:T,options:E}=this,P=E.align;let r=0,B,W,Z;return this.isHorizontal()?(W=Mf(P,m,T),Z=d+a,B=T-m):(E.position==="left"?(W=m+a,Z=Mf(P,x,d),r=Jn*-.5):(W=T-a,Z=Mf(P,d,x),r=Jn*.5),B=x-d),{titleX:W,titleY:Z,maxWidth:B,rotation:r}}draw(){const a=this.ctx,d=this.options;if(!d.display)return;const m=Zr(d.font),T=m.lineHeight/2+this._padding.top,{titleX:E,titleY:P,maxWidth:r,rotation:B}=this._drawArgs(T);kf(a,d.text,0,0,m,{color:d.color,maxWidth:r,rotation:B,textAlign:aS(d.align),textBaseline:"middle",translation:[E,P]})}}function Mk(c,a){const d=new zS({ctx:c.ctx,options:a,chart:c});cl.configure(c,d,a),cl.addBox(c,d),c.titleBlock=d}var Sk={id:"title",_element:zS,start(c,a,d){Mk(c,d)},stop(c){const a=c.titleBlock;cl.removeBox(c,a),delete c.titleBlock},beforeUpdate(c,a,d){const m=c.titleBlock;cl.configure(c,m,d),m.options=d},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const _f={average(c){if(!c.length)return!1;let a,d,m=new Set,x=0,T=0;for(a=0,d=c.length;a<d;++a){const P=c[a].element;if(P&&P.hasValue()){const r=P.tooltipPosition();m.add(r.x),x+=r.y,++T}}return{x:[...m].reduce((P,r)=>P+r)/m.size,y:x/T}},nearest(c,a){if(!c.length)return!1;let d=a.x,m=a.y,x=Number.POSITIVE_INFINITY,T,E,P;for(T=0,E=c.length;T<E;++T){const r=c[T].element;if(r&&r.hasValue()){const B=r.getCenterPoint(),W=VR(a,B);W<x&&(x=W,P=r)}}if(P){const r=P.tooltipPosition();d=r.x,m=r.y}return{x:d,y:m}}};function Ao(c,a){return a&&(jn(a)?Array.prototype.push.apply(c,a):c.push(a)),c}function ca(c){return(typeof c=="string"||c instanceof String)&&c.indexOf(`
`)>-1?c.split(`
`):c}function Ek(c,a){const{element:d,datasetIndex:m,index:x}=a,T=c.getDatasetMeta(m).controller,{label:E,value:P}=T.getLabelAndValue(x);return{chart:c,label:E,parsed:T.getParsed(x),raw:c.data.datasets[m].data[x],formattedValue:P,dataset:T.getDataset(),dataIndex:x,datasetIndex:m,element:d}}function AT(c,a){const d=c.chart.ctx,{body:m,footer:x,title:T}=c,{boxWidth:E,boxHeight:P}=a,r=Zr(a.bodyFont),B=Zr(a.titleFont),W=Zr(a.footerFont),Z=T.length,ae=x.length,fe=m.length,Le=Ss(a.padding);let De=Le.height,Ve=0,Ye=m.reduce((gt,yt)=>gt+yt.before.length+yt.lines.length+yt.after.length,0);if(Ye+=c.beforeBody.length+c.afterBody.length,Z&&(De+=Z*B.lineHeight+(Z-1)*a.titleSpacing+a.titleMarginBottom),Ye){const gt=a.displayColors?Math.max(P,r.lineHeight):r.lineHeight;De+=fe*gt+(Ye-fe)*r.lineHeight+(Ye-1)*a.bodySpacing}ae&&(De+=a.footerMarginTop+ae*W.lineHeight+(ae-1)*a.footerSpacing);let lt=0;const dt=function(gt){Ve=Math.max(Ve,d.measureText(gt).width+lt)};return d.save(),d.font=B.string,xn(c.title,dt),d.font=r.string,xn(c.beforeBody.concat(c.afterBody),dt),lt=a.displayColors?E+2+a.boxPadding:0,xn(m,gt=>{xn(gt.before,dt),xn(gt.lines,dt),xn(gt.after,dt)}),lt=0,d.font=W.string,xn(c.footer,dt),d.restore(),Ve+=Le.width,{width:Ve,height:De}}function Ak(c,a){const{y:d,height:m}=a;return d<m/2?"top":d>c.height-m/2?"bottom":"center"}function Ik(c,a,d,m){const{x,width:T}=m,E=d.caretSize+d.caretPadding;if(c==="left"&&x+T+E>a.width||c==="right"&&x-T-E<0)return!0}function Ck(c,a,d,m){const{x,width:T}=d,{width:E,chartArea:{left:P,right:r}}=c;let B="center";return m==="center"?B=x<=(P+r)/2?"left":"right":x<=T/2?B="left":x>=E-T/2&&(B="right"),Ik(B,c,a,d)&&(B="center"),B}function IT(c,a,d){const m=d.yAlign||a.yAlign||Ak(c,d);return{xAlign:d.xAlign||a.xAlign||Ck(c,a,d,m),yAlign:m}}function Pk(c,a){let{x:d,width:m}=c;return a==="right"?d-=m:a==="center"&&(d-=m/2),d}function Dk(c,a,d){let{y:m,height:x}=c;return a==="top"?m+=d:a==="bottom"?m-=x+d:m-=x/2,m}function CT(c,a,d,m){const{caretSize:x,caretPadding:T,cornerRadius:E}=c,{xAlign:P,yAlign:r}=d,B=x+T,{topLeft:W,topRight:Z,bottomLeft:ae,bottomRight:fe}=xh(E);let Le=Pk(a,P);const De=Dk(a,r,B);return r==="center"?P==="left"?Le+=B:P==="right"&&(Le-=B):P==="left"?Le-=Math.max(W,ae)+x:P==="right"&&(Le+=Math.max(Z,fe)+x),{x:lo(Le,0,m.width-a.width),y:lo(De,0,m.height-a.height)}}function m_(c,a,d){const m=Ss(d.padding);return a==="center"?c.x+c.width/2:a==="right"?c.x+c.width-m.right:c.x+m.left}function PT(c){return Ao([],ca(c))}function Rk(c,a,d){return jc(c,{tooltip:a,tooltipItems:d,type:"tooltip"})}function DT(c,a){const d=a&&a.dataset&&a.dataset.tooltip&&a.dataset.tooltip.callbacks;return d?c.override(d):c}const LS={beforeTitle:aa,title(c){if(c.length>0){const a=c[0],d=a.chart.data.labels,m=d?d.length:0;if(this&&this.options&&this.options.mode==="dataset")return a.dataset.label||"";if(a.label)return a.label;if(m>0&&a.dataIndex<m)return d[a.dataIndex]}return""},afterTitle:aa,beforeBody:aa,beforeLabel:aa,label(c){if(this&&this.options&&this.options.mode==="dataset")return c.label+": "+c.formattedValue||c.formattedValue;let a=c.dataset.label||"";a&&(a+=": ");const d=c.formattedValue;return wn(d)||(a+=d),a},labelColor(c){const d=c.chart.getDatasetMeta(c.datasetIndex).controller.getStyle(c.dataIndex);return{borderColor:d.borderColor,backgroundColor:d.backgroundColor,borderWidth:d.borderWidth,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(c){const d=c.chart.getDatasetMeta(c.datasetIndex).controller.getStyle(c.dataIndex);return{pointStyle:d.pointStyle,rotation:d.rotation}},afterLabel:aa,afterBody:aa,beforeFooter:aa,footer:aa,afterFooter:aa};function is(c,a,d,m){const x=c[a].call(d,m);return typeof x>"u"?LS[a].call(d,m):x}class W0 extends Uf{constructor(a){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=a.chart,this.options=a.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(a){this.options=a,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const a=this._cachedAnimations;if(a)return a;const d=this.chart,m=this.options.setContext(this.getContext()),x=m.enabled&&d.options.animation&&m.animations,T=new yS(this.chart,x);return x._cacheable&&(this._cachedAnimations=Object.freeze(T)),T}getContext(){return this.$context||(this.$context=Rk(this.chart.getContext(),this,this._tooltipItems))}getTitle(a,d){const{callbacks:m}=d,x=is(m,"beforeTitle",this,a),T=is(m,"title",this,a),E=is(m,"afterTitle",this,a);let P=[];return P=Ao(P,ca(x)),P=Ao(P,ca(T)),P=Ao(P,ca(E)),P}getBeforeBody(a,d){return PT(is(d.callbacks,"beforeBody",this,a))}getBody(a,d){const{callbacks:m}=d,x=[];return xn(a,T=>{const E={before:[],lines:[],after:[]},P=DT(m,T);Ao(E.before,ca(is(P,"beforeLabel",this,T))),Ao(E.lines,is(P,"label",this,T)),Ao(E.after,ca(is(P,"afterLabel",this,T))),x.push(E)}),x}getAfterBody(a,d){return PT(is(d.callbacks,"afterBody",this,a))}getFooter(a,d){const{callbacks:m}=d,x=is(m,"beforeFooter",this,a),T=is(m,"footer",this,a),E=is(m,"afterFooter",this,a);let P=[];return P=Ao(P,ca(x)),P=Ao(P,ca(T)),P=Ao(P,ca(E)),P}_createItems(a){const d=this._active,m=this.chart.data,x=[],T=[],E=[];let P=[],r,B;for(r=0,B=d.length;r<B;++r)P.push(Ek(this.chart,d[r]));return a.filter&&(P=P.filter((W,Z,ae)=>a.filter(W,Z,ae,m))),a.itemSort&&(P=P.sort((W,Z)=>a.itemSort(W,Z,m))),xn(P,W=>{const Z=DT(a.callbacks,W);x.push(is(Z,"labelColor",this,W)),T.push(is(Z,"labelPointStyle",this,W)),E.push(is(Z,"labelTextColor",this,W))}),this.labelColors=x,this.labelPointStyles=T,this.labelTextColors=E,this.dataPoints=P,P}update(a,d){const m=this.options.setContext(this.getContext()),x=this._active;let T,E=[];if(!x.length)this.opacity!==0&&(T={opacity:0});else{const P=_f[m.position].call(this,x,this._eventPosition);E=this._createItems(m),this.title=this.getTitle(E,m),this.beforeBody=this.getBeforeBody(E,m),this.body=this.getBody(E,m),this.afterBody=this.getAfterBody(E,m),this.footer=this.getFooter(E,m);const r=this._size=AT(this,m),B=Object.assign({},P,r),W=IT(this.chart,m,B),Z=CT(m,B,W,this.chart);this.xAlign=W.xAlign,this.yAlign=W.yAlign,T={opacity:1,x:Z.x,y:Z.y,width:r.width,height:r.height,caretX:P.x,caretY:P.y}}this._tooltipItems=E,this.$context=void 0,T&&this._resolveAnimations().update(this,T),a&&m.external&&m.external.call(this,{chart:this.chart,tooltip:this,replay:d})}drawCaret(a,d,m,x){const T=this.getCaretPosition(a,m,x);d.lineTo(T.x1,T.y1),d.lineTo(T.x2,T.y2),d.lineTo(T.x3,T.y3)}getCaretPosition(a,d,m){const{xAlign:x,yAlign:T}=this,{caretSize:E,cornerRadius:P}=m,{topLeft:r,topRight:B,bottomLeft:W,bottomRight:Z}=xh(P),{x:ae,y:fe}=a,{width:Le,height:De}=d;let Ve,Ye,lt,dt,gt,yt;return T==="center"?(gt=fe+De/2,x==="left"?(Ve=ae,Ye=Ve-E,dt=gt+E,yt=gt-E):(Ve=ae+Le,Ye=Ve+E,dt=gt-E,yt=gt+E),lt=Ve):(x==="left"?Ye=ae+Math.max(r,W)+E:x==="right"?Ye=ae+Le-Math.max(B,Z)-E:Ye=this.caretX,T==="top"?(dt=fe,gt=dt-E,Ve=Ye-E,lt=Ye+E):(dt=fe+De,gt=dt+E,Ve=Ye+E,lt=Ye-E),yt=dt),{x1:Ve,x2:Ye,x3:lt,y1:dt,y2:gt,y3:yt}}drawTitle(a,d,m){const x=this.title,T=x.length;let E,P,r;if(T){const B=_0(m.rtl,this.x,this.width);for(a.x=m_(this,m.titleAlign,m),d.textAlign=B.textAlign(m.titleAlign),d.textBaseline="middle",E=Zr(m.titleFont),P=m.titleSpacing,d.fillStyle=m.titleColor,d.font=E.string,r=0;r<T;++r)d.fillText(x[r],B.x(a.x),a.y+E.lineHeight/2),a.y+=E.lineHeight+P,r+1===T&&(a.y+=m.titleMarginBottom-P)}}_drawColorBox(a,d,m,x,T){const E=this.labelColors[m],P=this.labelPointStyles[m],{boxHeight:r,boxWidth:B}=T,W=Zr(T.bodyFont),Z=m_(this,"left",T),ae=x.x(Z),fe=r<W.lineHeight?(W.lineHeight-r)/2:0,Le=d.y+fe;if(T.usePointStyle){const De={radius:Math.min(B,r)/2,pointStyle:P.pointStyle,rotation:P.rotation,borderWidth:1},Ve=x.leftForLtr(ae,B)+B/2,Ye=Le+r/2;a.strokeStyle=T.multiKeyBackground,a.fillStyle=T.multiKeyBackground,qw(a,De,Ve,Ye),a.strokeStyle=E.borderColor,a.fillStyle=E.backgroundColor,qw(a,De,Ve,Ye)}else{a.lineWidth=an(E.borderWidth)?Math.max(...Object.values(E.borderWidth)):E.borderWidth||1,a.strokeStyle=E.borderColor,a.setLineDash(E.borderDash||[]),a.lineDashOffset=E.borderDashOffset||0;const De=x.leftForLtr(ae,B),Ve=x.leftForLtr(x.xPlus(ae,1),B-2),Ye=xh(E.borderRadius);Object.values(Ye).some(lt=>lt!==0)?(a.beginPath(),a.fillStyle=T.multiKeyBackground,V_(a,{x:De,y:Le,w:B,h:r,radius:Ye}),a.fill(),a.stroke(),a.fillStyle=E.backgroundColor,a.beginPath(),V_(a,{x:Ve,y:Le+1,w:B-2,h:r-2,radius:Ye}),a.fill()):(a.fillStyle=T.multiKeyBackground,a.fillRect(De,Le,B,r),a.strokeRect(De,Le,B,r),a.fillStyle=E.backgroundColor,a.fillRect(Ve,Le+1,B-2,r-2))}a.fillStyle=this.labelTextColors[m]}drawBody(a,d,m){const{body:x}=this,{bodySpacing:T,bodyAlign:E,displayColors:P,boxHeight:r,boxWidth:B,boxPadding:W}=m,Z=Zr(m.bodyFont);let ae=Z.lineHeight,fe=0;const Le=_0(m.rtl,this.x,this.width),De=function(wi){d.fillText(wi,Le.x(a.x+fe),a.y+ae/2),a.y+=ae+T},Ve=Le.textAlign(E);let Ye,lt,dt,gt,yt,Ut,Yt;for(d.textAlign=E,d.textBaseline="middle",d.font=Z.string,a.x=m_(this,Ve,m),d.fillStyle=m.bodyColor,xn(this.beforeBody,De),fe=P&&Ve!=="right"?E==="center"?B/2+W:B+2+W:0,gt=0,Ut=x.length;gt<Ut;++gt){for(Ye=x[gt],lt=this.labelTextColors[gt],d.fillStyle=lt,xn(Ye.before,De),dt=Ye.lines,P&&dt.length&&(this._drawColorBox(d,a,gt,Le,m),ae=Math.max(Z.lineHeight,r)),yt=0,Yt=dt.length;yt<Yt;++yt)De(dt[yt]),ae=Z.lineHeight;xn(Ye.after,De)}fe=0,ae=Z.lineHeight,xn(this.afterBody,De),a.y-=T}drawFooter(a,d,m){const x=this.footer,T=x.length;let E,P;if(T){const r=_0(m.rtl,this.x,this.width);for(a.x=m_(this,m.footerAlign,m),a.y+=m.footerMarginTop,d.textAlign=r.textAlign(m.footerAlign),d.textBaseline="middle",E=Zr(m.footerFont),d.fillStyle=m.footerColor,d.font=E.string,P=0;P<T;++P)d.fillText(x[P],r.x(a.x),a.y+E.lineHeight/2),a.y+=E.lineHeight+m.footerSpacing}}drawBackground(a,d,m,x){const{xAlign:T,yAlign:E}=this,{x:P,y:r}=a,{width:B,height:W}=m,{topLeft:Z,topRight:ae,bottomLeft:fe,bottomRight:Le}=xh(x.cornerRadius);d.fillStyle=x.backgroundColor,d.strokeStyle=x.borderColor,d.lineWidth=x.borderWidth,d.beginPath(),d.moveTo(P+Z,r),E==="top"&&this.drawCaret(a,d,m,x),d.lineTo(P+B-ae,r),d.quadraticCurveTo(P+B,r,P+B,r+ae),E==="center"&&T==="right"&&this.drawCaret(a,d,m,x),d.lineTo(P+B,r+W-Le),d.quadraticCurveTo(P+B,r+W,P+B-Le,r+W),E==="bottom"&&this.drawCaret(a,d,m,x),d.lineTo(P+fe,r+W),d.quadraticCurveTo(P,r+W,P,r+W-fe),E==="center"&&T==="left"&&this.drawCaret(a,d,m,x),d.lineTo(P,r+Z),d.quadraticCurveTo(P,r,P+Z,r),d.closePath(),d.fill(),x.borderWidth>0&&d.stroke()}_updateAnimationTarget(a){const d=this.chart,m=this.$animations,x=m&&m.x,T=m&&m.y;if(x||T){const E=_f[a.position].call(this,this._active,this._eventPosition);if(!E)return;const P=this._size=AT(this,a),r=Object.assign({},E,this._size),B=IT(d,a,r),W=CT(a,r,B,d);(x._to!==W.x||T._to!==W.y)&&(this.xAlign=B.xAlign,this.yAlign=B.yAlign,this.width=P.width,this.height=P.height,this.caretX=E.x,this.caretY=E.y,this._resolveAnimations().update(this,W))}}_willRender(){return!!this.opacity}draw(a){const d=this.options.setContext(this.getContext());let m=this.opacity;if(!m)return;this._updateAnimationTarget(d);const x={width:this.width,height:this.height},T={x:this.x,y:this.y};m=Math.abs(m)<.001?0:m;const E=Ss(d.padding),P=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;d.enabled&&P&&(a.save(),a.globalAlpha=m,this.drawBackground(T,a,x,d),Pz(a,d.textDirection),T.y+=E.top,this.drawTitle(T,a,d),this.drawBody(T,a,d),this.drawFooter(T,a,d),Dz(a,d.textDirection),a.restore())}getActiveElements(){return this._active||[]}setActiveElements(a,d){const m=this._active,x=a.map(({datasetIndex:P,index:r})=>{const B=this.chart.getDatasetMeta(P);if(!B)throw new Error("Cannot find a dataset at index "+P);return{datasetIndex:P,element:B.data[r],index:r}}),T=!k_(m,x),E=this._positionChanged(x,d);(T||E)&&(this._active=x,this._eventPosition=d,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(a,d,m=!0){if(d&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const x=this.options,T=this._active||[],E=this._getActiveElements(a,T,d,m),P=this._positionChanged(E,a),r=d||!k_(E,T)||P;return r&&(this._active=E,(x.enabled||x.external)&&(this._eventPosition={x:a.x,y:a.y},this.update(!0,d))),r}_getActiveElements(a,d,m,x){const T=this.options;if(a.type==="mouseout")return[];if(!x)return d.filter(P=>this.chart.data.datasets[P.datasetIndex]&&this.chart.getDatasetMeta(P.datasetIndex).controller.getParsed(P.index)!==void 0);const E=this.chart.getElementsAtEventForMode(a,T.mode,T,m);return T.reverse&&E.reverse(),E}_positionChanged(a,d){const{caretX:m,caretY:x,options:T}=this,E=_f[T.position].call(this,a,d);return E!==!1&&(m!==E.x||x!==E.y)}}Ii(W0,"positioners",_f);var zk={id:"tooltip",_element:W0,positioners:_f,afterInit(c,a,d){d&&(c.tooltip=new W0({chart:c,options:d}))},beforeUpdate(c,a,d){c.tooltip&&c.tooltip.initialize(d)},reset(c,a,d){c.tooltip&&c.tooltip.initialize(d)},afterDraw(c){const a=c.tooltip;if(a&&a._willRender()){const d={tooltip:a};if(c.notifyPlugins("beforeTooltipDraw",{...d,cancelable:!0})===!1)return;a.draw(c.ctx),c.notifyPlugins("afterTooltipDraw",d)}},afterEvent(c,a){if(c.tooltip){const d=a.replay;c.tooltip.handleEvent(a.event,d,a.inChartArea)&&(a.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(c,a)=>a.bodyFont.size,boxWidth:(c,a)=>a.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:LS},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:c=>c!=="filter"&&c!=="itemSort"&&c!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Lk=(c,a,d,m)=>(typeof a=="string"?(d=c.push(a)-1,m.unshift({index:d,label:a})):isNaN(a)&&(d=null),d);function kk(c,a,d,m){const x=c.indexOf(a);if(x===-1)return Lk(c,a,d,m);const T=c.lastIndexOf(a);return x!==T?d:x}const Ok=(c,a)=>c===null?null:lo(Math.round(c),0,a);function RT(c){const a=this.getLabels();return c>=0&&c<a.length?a[c]:c}class H0 extends Uc{constructor(a){super(a),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(a){const d=this._addedLabels;if(d.length){const m=this.getLabels();for(const{index:x,label:T}of d)m[x]===T&&m.splice(x,1);this._addedLabels=[]}super.init(a)}parse(a,d){if(wn(a))return null;const m=this.getLabels();return d=isFinite(d)&&m[d]===a?d:kk(m,a,Fn(d,a),this._addedLabels),Ok(d,m.length-1)}determineDataLimits(){const{minDefined:a,maxDefined:d}=this.getUserBounds();let{min:m,max:x}=this.getMinMax(!0);this.options.bounds==="ticks"&&(a||(m=0),d||(x=this.getLabels().length-1)),this.min=m,this.max=x}buildTicks(){const a=this.min,d=this.max,m=this.options.offset,x=[];let T=this.getLabels();T=a===0&&d===T.length-1?T:T.slice(a,d+1),this._valueRange=Math.max(T.length-(m?0:1),1),this._startValue=this.min-(m?.5:0);for(let E=a;E<=d;E++)x.push({value:E});return x}getLabelForValue(a){return RT.call(this,a)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(a){return typeof a!="number"&&(a=this.parse(a)),a===null?NaN:this.getPixelForDecimal((a-this._startValue)/this._valueRange)}getPixelForTick(a){const d=this.ticks;return a<0||a>d.length-1?null:this.getPixelForValue(d[a].value)}getValueForPixel(a){return Math.round(this._startValue+this.getDecimalForPixel(a)*this._valueRange)}getBasePixel(){return this.bottom}}Ii(H0,"id","category"),Ii(H0,"defaults",{ticks:{callback:RT}});function Fk(c,a){const d=[],{bounds:x,step:T,min:E,max:P,precision:r,count:B,maxTicks:W,maxDigits:Z,includeBounds:ae}=c,fe=T||1,Le=W-1,{min:De,max:Ve}=a,Ye=!wn(E),lt=!wn(P),dt=!wn(B),gt=(Ve-De)/(Z+1);let yt=Ow((Ve-De)/Le/fe)*fe,Ut,Yt,wi,Gi;if(yt<1e-14&&!Ye&&!lt)return[{value:De},{value:Ve}];Gi=Math.ceil(Ve/yt)-Math.floor(De/yt),Gi>Le&&(yt=Ow(Gi*yt/Le/fe)*fe),wn(r)||(Ut=Math.pow(10,r),yt=Math.ceil(yt*Ut)/Ut),x==="ticks"?(Yt=Math.floor(De/yt)*yt,wi=Math.ceil(Ve/yt)*yt):(Yt=De,wi=Ve),Ye&&lt&&T&&BR((P-E)/T,yt/1e3)?(Gi=Math.round(Math.min((P-E)/yt,W)),yt=(P-E)/Gi,Yt=E,wi=P):dt?(Yt=Ye?E:Yt,wi=lt?P:wi,Gi=B-1,yt=(wi-Yt)/Gi):(Gi=(wi-Yt)/yt,M_(Gi,Math.round(Gi),yt/1e3)?Gi=Math.round(Gi):Gi=Math.ceil(Gi));const Qt=Math.max(Fw(yt),Fw(Yt));Ut=Math.pow(10,wn(r)?Qt:r),Yt=Math.round(Yt*Ut)/Ut,wi=Math.round(wi*Ut)/Ut;let tn=0;for(Ye&&(ae&&Yt!==E?(d.push({value:E}),Yt<E&&tn++,M_(Math.round((Yt+tn*yt)*Ut)/Ut,E,zT(E,gt,c))&&tn++):Yt<E&&tn++);tn<Gi;++tn){const Ui=Math.round((Yt+tn*yt)*Ut)/Ut;if(lt&&Ui>P)break;d.push({value:Ui})}return lt&&ae&&wi!==P?d.length&&M_(d[d.length-1].value,P,zT(P,gt,c))?d[d.length-1].value=P:d.push({value:P}):(!lt||wi===P)&&d.push({value:wi}),d}function zT(c,a,{horizontal:d,minRotation:m}){const x=ao(m),T=(d?Math.sin(x):Math.cos(x))||.001,E=.75*a*(""+c).length;return Math.min(a/T,E)}class G_ extends Uc{constructor(a){super(a),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(a,d){return wn(a)||(typeof a=="number"||a instanceof Number)&&!isFinite(+a)?null:+a}handleTickRangeOptions(){const{beginAtZero:a}=this.options,{minDefined:d,maxDefined:m}=this.getUserBounds();let{min:x,max:T}=this;const E=r=>x=d?x:r,P=r=>T=m?T:r;if(a){const r=pl(x),B=pl(T);r<0&&B<0?P(0):r>0&&B>0&&E(0)}if(x===T){let r=T===0?1:Math.abs(T*.05);P(T+r),a||E(x-r)}this.min=x,this.max=T}getTickLimit(){const a=this.options.ticks;let{maxTicksLimit:d,stepSize:m}=a,x;return m?(x=Math.ceil(this.max/m)-Math.floor(this.min/m)+1,x>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${m} would result generating up to ${x} ticks. Limiting to 1000.`),x=1e3)):(x=this.computeTickLimit(),d=d||11),d&&(x=Math.min(d,x)),x}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const a=this.options,d=a.ticks;let m=this.getTickLimit();m=Math.max(2,m);const x={maxTicks:m,bounds:a.bounds,min:a.min,max:a.max,precision:d.precision,step:d.stepSize,count:d.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:d.minRotation||0,includeBounds:d.includeBounds!==!1},T=this._range||this,E=Fk(x,T);return a.bounds==="ticks"&&iS(E,this,"value"),a.reverse?(E.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),E}configure(){const a=this.ticks;let d=this.min,m=this.max;if(super.configure(),this.options.offset&&a.length){const x=(m-d)/Math.max(a.length-1,1)/2;d-=x,m+=x}this._startValue=d,this._endValue=m,this._valueRange=m-d}getLabelForValue(a){return Vf(a,this.chart.options.locale,this.options.ticks.format)}}class Z0 extends G_{determineDataLimits(){const{min:a,max:d}=this.getMinMax(!0);this.min=br(a)?a:0,this.max=br(d)?d:1,this.handleTickRangeOptions()}computeTickLimit(){const a=this.isHorizontal(),d=a?this.width:this.height,m=ao(this.options.ticks.minRotation),x=(a?Math.sin(m):Math.cos(m))||.001,T=this._resolveTickFontOptions(0);return Math.ceil(d/Math.min(40,T.lineHeight/x))}getPixelForValue(a){return a===null?NaN:this.getPixelForDecimal((a-this._startValue)/this._valueRange)}getValueForPixel(a){return this._startValue+this.getDecimalForPixel(a)*this._valueRange}}Ii(Z0,"id","linear"),Ii(Z0,"defaults",{ticks:{callback:ng.formatters.numeric}});const Ff=c=>Math.floor(ll(c)),Ac=(c,a)=>Math.pow(10,Ff(c)+a);function LT(c){return c/Math.pow(10,Ff(c))===1}function kT(c,a,d){const m=Math.pow(10,d),x=Math.floor(c/m);return Math.ceil(a/m)-x}function Bk(c,a){const d=a-c;let m=Ff(d);for(;kT(c,a,m)>10;)m++;for(;kT(c,a,m)<10;)m--;return Math.min(m,Ff(c))}function Nk(c,{min:a,max:d}){a=Ts(c.min,a);const m=[],x=Ff(a);let T=Bk(a,d),E=T<0?Math.pow(10,Math.abs(T)):1;const P=Math.pow(10,T),r=x>T?Math.pow(10,x):0,B=Math.round((a-r)*E)/E,W=Math.floor((a-r)/P/10)*P*10;let Z=Math.floor((B-W)/Math.pow(10,T)),ae=Ts(c.min,Math.round((r+W+Z*Math.pow(10,T))*E)/E);for(;ae<d;)m.push({value:ae,major:LT(ae),significand:Z}),Z>=10?Z=Z<15?15:20:Z++,Z>=20&&(T++,Z=2,E=T>=0?1:E),ae=Math.round((r+W+Z*Math.pow(10,T))*E)/E;const fe=Ts(c.max,ae);return m.push({value:fe,major:LT(fe),significand:Z}),m}class OT extends Uc{constructor(a){super(a),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(a,d){const m=G_.prototype.parse.apply(this,[a,d]);if(m===0){this._zero=!0;return}return br(m)&&m>0?m:null}determineDataLimits(){const{min:a,max:d}=this.getMinMax(!0);this.min=br(a)?Math.max(0,a):null,this.max=br(d)?Math.max(0,d):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!br(this._userMin)&&(this.min=a===Ac(this.min,0)?Ac(this.min,-1):Ac(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:a,maxDefined:d}=this.getUserBounds();let m=this.min,x=this.max;const T=P=>m=a?m:P,E=P=>x=d?x:P;m===x&&(m<=0?(T(1),E(10)):(T(Ac(m,-1)),E(Ac(x,1)))),m<=0&&T(Ac(x,-1)),x<=0&&E(Ac(m,1)),this.min=m,this.max=x}buildTicks(){const a=this.options,d={min:this._userMin,max:this._userMax},m=Nk(d,this);return a.bounds==="ticks"&&iS(m,this,"value"),a.reverse?(m.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),m}getLabelForValue(a){return a===void 0?"0":Vf(a,this.chart.options.locale,this.options.ticks.format)}configure(){const a=this.min;super.configure(),this._startValue=ll(a),this._valueRange=ll(this.max)-ll(a)}getPixelForValue(a){return(a===void 0||a===0)&&(a=this.min),a===null||isNaN(a)?NaN:this.getPixelForDecimal(a===this.min?0:(ll(a)-this._startValue)/this._valueRange)}getValueForPixel(a){const d=this.getDecimalForPixel(a);return Math.pow(10,this._startValue+d*this._valueRange)}}Ii(OT,"id","logarithmic"),Ii(OT,"defaults",{ticks:{callback:ng.formatters.logarithmic,major:{enabled:!0}}});function Q0(c){const a=c.ticks;if(a.display&&c.display){const d=Ss(a.backdropPadding);return Fn(a.font&&a.font.size,Kn.font.size)+d.height}return 0}function Vk(c,a,d){return d=jn(d)?d:[d],{w:tz(c,a.string,d),h:d.length*a.lineHeight}}function FT(c,a,d,m,x){return c===m||c===x?{start:a-d/2,end:a+d/2}:c<m||c>x?{start:a-d,end:a}:{start:a,end:a+d}}function jk(c){const a={l:c.left+c._padding.left,r:c.right-c._padding.right,t:c.top+c._padding.top,b:c.bottom-c._padding.bottom},d=Object.assign({},a),m=[],x=[],T=c._pointLabels.length,E=c.options.pointLabels,P=E.centerPointLabels?Jn/T:0;for(let r=0;r<T;r++){const B=E.setContext(c.getPointLabelContext(r));x[r]=B.padding;const W=c.getPointPosition(r,c.drawingArea+x[r],P),Z=Zr(B.font),ae=Vk(c.ctx,Z,c._pointLabels[r]);m[r]=ae;const fe=Co(c.getIndexAngle(r)+P),Le=Math.round(bx(fe)),De=FT(Le,W.x,ae.w,0,180),Ve=FT(Le,W.y,ae.h,90,270);Uk(d,a,fe,De,Ve)}c.setCenterPoint(a.l-d.l,d.r-a.r,a.t-d.t,d.b-a.b),c._pointLabelItems=qk(c,m,x)}function Uk(c,a,d,m,x){const T=Math.abs(Math.sin(d)),E=Math.abs(Math.cos(d));let P=0,r=0;m.start<a.l?(P=(a.l-m.start)/T,c.l=Math.min(c.l,a.l-P)):m.end>a.r&&(P=(m.end-a.r)/T,c.r=Math.max(c.r,a.r+P)),x.start<a.t?(r=(a.t-x.start)/E,c.t=Math.min(c.t,a.t-r)):x.end>a.b&&(r=(x.end-a.b)/E,c.b=Math.max(c.b,a.b+r))}function Gk(c,a,d){const m=c.drawingArea,{extra:x,additionalAngle:T,padding:E,size:P}=d,r=c.getPointPosition(a,m+x+E,T),B=Math.round(bx(Co(r.angle+Hr))),W=Zk(r.y,P.h,B),Z=Wk(B),ae=Hk(r.x,P.w,Z);return{visible:!0,x:r.x,y:W,textAlign:Z,left:ae,top:W,right:ae+P.w,bottom:W+P.h}}function $k(c,a){if(!a)return!0;const{left:d,top:m,right:x,bottom:T}=c;return!(ph({x:d,y:m},a)||ph({x:d,y:T},a)||ph({x,y:m},a)||ph({x,y:T},a))}function qk(c,a,d){const m=[],x=c._pointLabels.length,T=c.options,{centerPointLabels:E,display:P}=T.pointLabels,r={extra:Q0(T)/2,additionalAngle:E?Jn/x:0};let B;for(let W=0;W<x;W++){r.padding=d[W],r.size=a[W];const Z=Gk(c,W,r);m.push(Z),P==="auto"&&(Z.visible=$k(Z,B),Z.visible&&(B=Z))}return m}function Wk(c){return c===0||c===180?"center":c<180?"left":"right"}function Hk(c,a,d){return d==="right"?c-=a:d==="center"&&(c-=a/2),c}function Zk(c,a,d){return d===90||d===270?c-=a/2:(d>270||d<90)&&(c-=a),c}function Qk(c,a,d){const{left:m,top:x,right:T,bottom:E}=d,{backdropColor:P}=a;if(!wn(P)){const r=xh(a.borderRadius),B=Ss(a.backdropPadding);c.fillStyle=P;const W=m-B.left,Z=x-B.top,ae=T-m+B.width,fe=E-x+B.height;Object.values(r).some(Le=>Le!==0)?(c.beginPath(),V_(c,{x:W,y:Z,w:ae,h:fe,radius:r}),c.fill()):c.fillRect(W,Z,ae,fe)}}function Xk(c,a){const{ctx:d,options:{pointLabels:m}}=c;for(let x=a-1;x>=0;x--){const T=c._pointLabelItems[x];if(!T.visible)continue;const E=m.setContext(c.getPointLabelContext(x));Qk(d,E,T);const P=Zr(E.font),{x:r,y:B,textAlign:W}=T;kf(d,c._pointLabels[x],r,B+P.lineHeight/2,P,{color:E.color,textAlign:W,textBaseline:"middle"})}}function kS(c,a,d,m){const{ctx:x}=c;if(d)x.arc(c.xCenter,c.yCenter,a,0,os);else{let T=c.getPointPosition(0,a);x.moveTo(T.x,T.y);for(let E=1;E<m;E++)T=c.getPointPosition(E,a),x.lineTo(T.x,T.y)}}function Yk(c,a,d,m,x){const T=c.ctx,E=a.circular,{color:P,lineWidth:r}=a;!E&&!m||!P||!r||d<0||(T.save(),T.strokeStyle=P,T.lineWidth=r,T.setLineDash(x.dash),T.lineDashOffset=x.dashOffset,T.beginPath(),kS(c,d,E,m),T.closePath(),T.stroke(),T.restore())}function Kk(c,a,d){return jc(c,{label:d,index:a,type:"pointLabel"})}class __ extends G_{constructor(a){super(a),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const a=this._padding=Ss(Q0(this.options)/2),d=this.width=this.maxWidth-a.width,m=this.height=this.maxHeight-a.height;this.xCenter=Math.floor(this.left+d/2+a.left),this.yCenter=Math.floor(this.top+m/2+a.top),this.drawingArea=Math.floor(Math.min(d,m)/2)}determineDataLimits(){const{min:a,max:d}=this.getMinMax(!1);this.min=br(a)&&!isNaN(a)?a:0,this.max=br(d)&&!isNaN(d)?d:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Q0(this.options))}generateTickLabels(a){G_.prototype.generateTickLabels.call(this,a),this._pointLabels=this.getLabels().map((d,m)=>{const x=Zn(this.options.pointLabels.callback,[d,m],this);return x||x===0?x:""}).filter((d,m)=>this.chart.getDataVisibility(m))}fit(){const a=this.options;a.display&&a.pointLabels.display?jk(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(a,d,m,x){this.xCenter+=Math.floor((a-d)/2),this.yCenter+=Math.floor((m-x)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(a,d,m,x))}getIndexAngle(a){const d=os/(this._pointLabels.length||1),m=this.options.startAngle||0;return Co(a*d+ao(m))}getDistanceFromCenterForValue(a){if(wn(a))return NaN;const d=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-a)*d:(a-this.min)*d}getValueForDistanceFromCenter(a){if(wn(a))return NaN;const d=a/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-d:this.min+d}getPointLabelContext(a){const d=this._pointLabels||[];if(a>=0&&a<d.length){const m=d[a];return Kk(this.getContext(),a,m)}}getPointPosition(a,d,m=0){const x=this.getIndexAngle(a)-Hr+m;return{x:Math.cos(x)*d+this.xCenter,y:Math.sin(x)*d+this.yCenter,angle:x}}getPointPositionForValue(a,d){return this.getPointPosition(a,this.getDistanceFromCenterForValue(d))}getBasePosition(a){return this.getPointPositionForValue(a||0,this.getBaseValue())}getPointLabelPosition(a){const{left:d,top:m,right:x,bottom:T}=this._pointLabelItems[a];return{left:d,top:m,right:x,bottom:T}}drawBackground(){const{backgroundColor:a,grid:{circular:d}}=this.options;if(a){const m=this.ctx;m.save(),m.beginPath(),kS(this,this.getDistanceFromCenterForValue(this._endValue),d,this._pointLabels.length),m.closePath(),m.fillStyle=a,m.fill(),m.restore()}}drawGrid(){const a=this.ctx,d=this.options,{angleLines:m,grid:x,border:T}=d,E=this._pointLabels.length;let P,r,B;if(d.pointLabels.display&&Xk(this,E),x.display&&this.ticks.forEach((W,Z)=>{if(Z!==0||Z===0&&this.min<0){r=this.getDistanceFromCenterForValue(W.value);const ae=this.getContext(Z),fe=x.setContext(ae),Le=T.setContext(ae);Yk(this,fe,r,E,Le)}}),m.display){for(a.save(),P=E-1;P>=0;P--){const W=m.setContext(this.getPointLabelContext(P)),{color:Z,lineWidth:ae}=W;!ae||!Z||(a.lineWidth=ae,a.strokeStyle=Z,a.setLineDash(W.borderDash),a.lineDashOffset=W.borderDashOffset,r=this.getDistanceFromCenterForValue(d.ticks.reverse?this.min:this.max),B=this.getPointPosition(P,r),a.beginPath(),a.moveTo(this.xCenter,this.yCenter),a.lineTo(B.x,B.y),a.stroke())}a.restore()}}drawBorder(){}drawLabels(){const a=this.ctx,d=this.options,m=d.ticks;if(!m.display)return;const x=this.getIndexAngle(0);let T,E;a.save(),a.translate(this.xCenter,this.yCenter),a.rotate(x),a.textAlign="center",a.textBaseline="middle",this.ticks.forEach((P,r)=>{if(r===0&&this.min>=0&&!d.reverse)return;const B=m.setContext(this.getContext(r)),W=Zr(B.font);if(T=this.getDistanceFromCenterForValue(this.ticks[r].value),B.showLabelBackdrop){a.font=W.string,E=a.measureText(P.label).width,a.fillStyle=B.backdropColor;const Z=Ss(B.backdropPadding);a.fillRect(-E/2-Z.left,-T-W.size/2-Z.top,E+Z.width,W.size+Z.height)}kf(a,P.label,0,-T,W,{color:B.color,strokeColor:B.textStrokeColor,strokeWidth:B.textStrokeWidth})}),a.restore()}drawTitle(){}}Ii(__,"id","radialLinear"),Ii(__,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:ng.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(a){return a},padding:5,centerPointLabels:!1}}),Ii(__,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Ii(__,"descriptors",{angleLines:{_fallback:"grid"}});const og={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},rs=Object.keys(og);function BT(c,a){return c-a}function NT(c,a){if(wn(a))return null;const d=c._adapter,{parser:m,round:x,isoWeekday:T}=c._parseOpts;let E=a;return typeof m=="function"&&(E=m(E)),br(E)||(E=typeof m=="string"?d.parse(E,m):d.parse(E)),E===null?null:(x&&(E=x==="week"&&(B_(T)||T===!0)?d.startOf(E,"isoWeek",T):d.startOf(E,x)),+E)}function VT(c,a,d,m){const x=rs.length;for(let T=rs.indexOf(c);T<x-1;++T){const E=og[rs[T]],P=E.steps?E.steps:Number.MAX_SAFE_INTEGER;if(E.common&&Math.ceil((d-a)/(P*E.size))<=m)return rs[T]}return rs[x-1]}function Jk(c,a,d,m,x){for(let T=rs.length-1;T>=rs.indexOf(d);T--){const E=rs[T];if(og[E].common&&c._adapter.diff(x,m,E)>=a-1)return E}return rs[d?rs.indexOf(d):0]}function e3(c){for(let a=rs.indexOf(c)+1,d=rs.length;a<d;++a)if(og[rs[a]].common)return rs[a]}function jT(c,a,d){if(!d)c[a]=!0;else if(d.length){const{lo:m,hi:x}=wx(d,a),T=d[m]>=a?d[m]:d[x];c[T]=!0}}function t3(c,a,d,m){const x=c._adapter,T=+x.startOf(a[0].value,m),E=a[a.length-1].value;let P,r;for(P=T;P<=E;P=+x.add(P,1,m))r=d[P],r>=0&&(a[r].major=!0);return a}function UT(c,a,d){const m=[],x={},T=a.length;let E,P;for(E=0;E<T;++E)P=a[E],x[P]=E,m.push({value:P,major:!1});return T===0||!d?m:t3(c,m,x,d)}class $_ extends Uc{constructor(a){super(a),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(a,d={}){const m=a.time||(a.time={}),x=this._adapter=new nL._date(a.adapters.date);x.init(d),Tf(m.displayFormats,x.formats()),this._parseOpts={parser:m.parser,round:m.round,isoWeekday:m.isoWeekday},super.init(a),this._normalized=d.normalized}parse(a,d){return a===void 0?null:NT(this,a)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const a=this.options,d=this._adapter,m=a.time.unit||"day";let{min:x,max:T,minDefined:E,maxDefined:P}=this.getUserBounds();function r(B){!E&&!isNaN(B.min)&&(x=Math.min(x,B.min)),!P&&!isNaN(B.max)&&(T=Math.max(T,B.max))}(!E||!P)&&(r(this._getLabelBounds()),(a.bounds!=="ticks"||a.ticks.source!=="labels")&&r(this.getMinMax(!1))),x=br(x)&&!isNaN(x)?x:+d.startOf(Date.now(),m),T=br(T)&&!isNaN(T)?T:+d.endOf(Date.now(),m)+1,this.min=Math.min(x,T-1),this.max=Math.max(x+1,T)}_getLabelBounds(){const a=this.getLabelTimestamps();let d=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY;return a.length&&(d=a[0],m=a[a.length-1]),{min:d,max:m}}buildTicks(){const a=this.options,d=a.time,m=a.ticks,x=m.source==="labels"?this.getLabelTimestamps():this._generate();a.bounds==="ticks"&&x.length&&(this.min=this._userMin||x[0],this.max=this._userMax||x[x.length-1]);const T=this.min,E=this.max,P=GR(x,T,E);return this._unit=d.unit||(m.autoSkip?VT(d.minUnit,this.min,this.max,this._getLabelCapacity(T)):Jk(this,P.length,d.minUnit,this.min,this.max)),this._majorUnit=!m.major.enabled||this._unit==="year"?void 0:e3(this._unit),this.initOffsets(x),a.reverse&&P.reverse(),UT(this,P,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(a=>+a.value))}initOffsets(a=[]){let d=0,m=0,x,T;this.options.offset&&a.length&&(x=this.getDecimalForValue(a[0]),a.length===1?d=1-x:d=(this.getDecimalForValue(a[1])-x)/2,T=this.getDecimalForValue(a[a.length-1]),a.length===1?m=T:m=(T-this.getDecimalForValue(a[a.length-2]))/2);const E=a.length<3?.5:.25;d=lo(d,0,E),m=lo(m,0,E),this._offsets={start:d,end:m,factor:1/(d+1+m)}}_generate(){const a=this._adapter,d=this.min,m=this.max,x=this.options,T=x.time,E=T.unit||VT(T.minUnit,d,m,this._getLabelCapacity(d)),P=Fn(x.ticks.stepSize,1),r=E==="week"?T.isoWeekday:!1,B=B_(r)||r===!0,W={};let Z=d,ae,fe;if(B&&(Z=+a.startOf(Z,"isoWeek",r)),Z=+a.startOf(Z,B?"day":E),a.diff(m,d,E)>1e5*P)throw new Error(d+" and "+m+" are too far apart with stepSize of "+P+" "+E);const Le=x.ticks.source==="data"&&this.getDataTimestamps();for(ae=Z,fe=0;ae<m;ae=+a.add(ae,P,E),fe++)jT(W,ae,Le);return(ae===m||x.bounds==="ticks"||fe===1)&&jT(W,ae,Le),Object.keys(W).sort(BT).map(De=>+De)}getLabelForValue(a){const d=this._adapter,m=this.options.time;return m.tooltipFormat?d.format(a,m.tooltipFormat):d.format(a,m.displayFormats.datetime)}format(a,d){const x=this.options.time.displayFormats,T=this._unit,E=d||x[T];return this._adapter.format(a,E)}_tickFormatFunction(a,d,m,x){const T=this.options,E=T.ticks.callback;if(E)return Zn(E,[a,d,m],this);const P=T.time.displayFormats,r=this._unit,B=this._majorUnit,W=r&&P[r],Z=B&&P[B],ae=m[d],fe=B&&Z&&ae&&ae.major;return this._adapter.format(a,x||(fe?Z:W))}generateTickLabels(a){let d,m,x;for(d=0,m=a.length;d<m;++d)x=a[d],x.label=this._tickFormatFunction(x.value,d,a)}getDecimalForValue(a){return a===null?NaN:(a-this.min)/(this.max-this.min)}getPixelForValue(a){const d=this._offsets,m=this.getDecimalForValue(a);return this.getPixelForDecimal((d.start+m)*d.factor)}getValueForPixel(a){const d=this._offsets,m=this.getDecimalForPixel(a)/d.factor-d.end;return this.min+m*(this.max-this.min)}_getLabelSize(a){const d=this.options.ticks,m=this.ctx.measureText(a).width,x=ao(this.isHorizontal()?d.maxRotation:d.minRotation),T=Math.cos(x),E=Math.sin(x),P=this._resolveTickFontOptions(0).size;return{w:m*T+P*E,h:m*E+P*T}}_getLabelCapacity(a){const d=this.options.time,m=d.displayFormats,x=m[d.unit]||m.millisecond,T=this._tickFormatFunction(a,0,UT(this,[a],this._majorUnit),x),E=this._getLabelSize(T),P=Math.floor(this.isHorizontal()?this.width/E.w:this.height/E.h)-1;return P>0?P:1}getDataTimestamps(){let a=this._cache.data||[],d,m;if(a.length)return a;const x=this.getMatchingVisibleMetas();if(this._normalized&&x.length)return this._cache.data=x[0].controller.getAllParsedValues(this);for(d=0,m=x.length;d<m;++d)a=a.concat(x[d].controller.getAllParsedValues(this));return this._cache.data=this.normalize(a)}getLabelTimestamps(){const a=this._cache.labels||[];let d,m;if(a.length)return a;const x=this.getLabels();for(d=0,m=x.length;d<m;++d)a.push(NT(this,x[d]));return this._cache.labels=this._normalized?a:this.normalize(a)}normalize(a){return rS(a.sort(BT))}}Ii($_,"id","time"),Ii($_,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function g_(c,a,d){let m=0,x=c.length-1,T,E,P,r;d?(a>=c[m].pos&&a<=c[x].pos&&({lo:m,hi:x}=j0(c,"pos",a)),{pos:T,time:P}=c[m],{pos:E,time:r}=c[x]):(a>=c[m].time&&a<=c[x].time&&({lo:m,hi:x}=j0(c,"time",a)),{time:T,pos:P}=c[m],{time:E,pos:r}=c[x]);const B=E-T;return B?P+(r-P)*(a-T)/B:P}class GT extends $_{constructor(a){super(a),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const a=this._getTimestampsForTable(),d=this._table=this.buildLookupTable(a);this._minPos=g_(d,this.min),this._tableRange=g_(d,this.max)-this._minPos,super.initOffsets(a)}buildLookupTable(a){const{min:d,max:m}=this,x=[],T=[];let E,P,r,B,W;for(E=0,P=a.length;E<P;++E)B=a[E],B>=d&&B<=m&&x.push(B);if(x.length<2)return[{time:d,pos:0},{time:m,pos:1}];for(E=0,P=x.length;E<P;++E)W=x[E+1],r=x[E-1],B=x[E],Math.round((W+r)/2)!==B&&T.push({time:B,pos:E/(P-1)});return T}_generate(){const a=this.min,d=this.max;let m=super.getDataTimestamps();return(!m.includes(a)||!m.length)&&m.splice(0,0,a),(!m.includes(d)||m.length===1)&&m.push(d),m.sort((x,T)=>x-T)}_getTimestampsForTable(){let a=this._cache.all||[];if(a.length)return a;const d=this.getDataTimestamps(),m=this.getLabelTimestamps();return d.length&&m.length?a=this.normalize(d.concat(m)):a=d.length?d:m,a=this._cache.all=a,a}getDecimalForValue(a){return(g_(this._table,a)-this._minPos)/this._tableRange}getValueForPixel(a){const d=this._offsets,m=this.getDecimalForPixel(a)/d.factor-d.end;return g_(this._table,m*this._tableRange+this._minPos,!0)}}Ii(GT,"id","timeseries"),Ii(GT,"defaults",$_.defaults);const OS={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},i3={ariaLabel:{type:String},ariaDescribedby:{type:String}},n3={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...OS,...i3},r3=qM[0]==="2"?(c,a)=>Object.assign(c,{attrs:a}):(c,a)=>Object.assign(c,a);function dh(c){return X_(c)?ln(c):c}function s3(c){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c;return X_(a)?new Proxy(c,{}):c}function o3(c,a){const d=c.options;d&&a&&Object.assign(d,a)}function FS(c,a){c.labels=a}function BS(c,a,d){const m=[];c.datasets=a.map(x=>{const T=c.datasets.find(E=>E[d]===x[d]);return!T||!x.data||m.includes(T)?{...x}:(m.push(T),Object.assign(T,x),T)})}function a3(c,a){const d={labels:[],datasets:[]};return FS(d,c.labels),BS(d,c.datasets,a),d}const l3=MM({props:n3,setup(c,a){let{expose:d,slots:m}=a;const x=uf(null),T=fM(null);d({chart:T});const E=()=>{if(!x.value)return;const{type:B,data:W,options:Z,plugins:ae,datasetIdKey:fe}=c,Le=a3(W,fe),De=s3(Le,W);T.value=new sg(x.value,{type:B,data:De,options:{...Z},plugins:ae})},P=()=>{const B=ln(T.value);B&&(c.destroyDelay>0?setTimeout(()=>{B.destroy(),T.value=null},c.destroyDelay):(B.destroy(),T.value=null))},r=B=>{B.update(c.updateMode)};return AM(E),fx(P),zc([()=>c.options,()=>c.data],(B,W)=>{let[Z,ae]=B,[fe,Le]=W;const De=ln(T.value);if(!De)return;let Ve=!1;if(Z){const Ye=dh(Z),lt=dh(fe);Ye&&Ye!==lt&&(o3(De,Ye),Ve=!0)}if(ae){const Ye=dh(ae.labels),lt=dh(Le.labels),dt=dh(ae.datasets),gt=dh(Le.datasets);Ye!==lt&&(FS(De.config.data,Ye),Ve=!0),dt&&dt!==gt&&(BS(De.config.data,dt,c.datasetIdKey),Ve=!0)}Ve&&gM(()=>{r(De)})},{deep:!0}),()=>B0("canvas",{role:"img",ariaLabel:c.ariaLabel,ariaDescribedby:c.ariaDescribedby,ref:x},[B0("p",{},[m.default?m.default():""])])}});function c3(c,a){return sg.register(a),MM({props:OS,setup(d,m){let{expose:x}=m;const T=fM(null),E=P=>{T.value=P==null?void 0:P.chart};return x({chart:T}),()=>B0(l3,r3({ref:E},{type:c,...d}))}})}const $T=c3("bar",S_),u3=Wr("hr",{style:{"margin-top":"1rem","margin-bottom":"1rem"}},null,-1),h3={style:{"text-transform":"uppercase"}},d3={style:{"margin-right":"0.75rem"}},f3={__name:"DataViz",setup(c){sg.register(Sk,zk,C_,H0,Z0,Tk);const{employees:a,residents:d}=Vn.formData,m=4.229+2.072*a+.139*d,x=-2.242+3.817*a+.181*d,T={labels:["Person Trips","Residents","Employees"],datasets:[{data:[m,d,a]}]},E={responsive:!0,indexAxis:"y",plugins:{title:{display:!0,text:"Person Trips AM"}}},P={labels:["Person Trips","Residents","Employees"],datasets:[{data:[x,d,a]}]},r={responsive:!0,indexAxis:"y",plugins:{title:{display:!0,text:"Person Trips PM"}}};return(B,W)=>(Ns(),zo(Ms,null,[u3,Wr("p",h3,gh(Do(Vn).formData.address),1),Wr("p",null,[Wr("span",d3,"Employees: "+gh(Do(Vn).formData.employees),1),Wr("span",null,"Residents: "+gh(Do(Vn).formData.residents),1)]),Qn(Do($T),{id:"chartAM",options:E,data:T}),Qn(Do($T),{id:"chartPM",options:r,data:P})],64))}},p3={key:0,id:"suggestions"},m3=["onClick"],_3={__name:"SideBar",setup(c){const a=uf(""),d=uf(""),m=uf([]),x=uf(0),T=async P=>{P.preventDefault();var r=new FormData(P.target);Vn.formData=Object.fromEntries(r),x.value+=1};zc(d,oR(async P=>{if(P){const B=await(await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/DOR_Parcel/FeatureServer/0/query?where=ADDR_SOURCE+LIKE+%27%25${encodeURI(P)}%25%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelEnvelopeIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&relationParam=&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&returnEnvelope=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&defaultSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token=`)).json();m.value=B.features}else console.log("hello",Object.keys(Vn.selectedFeature).length),Vn.selectedFeature={},m.value=[]},1e3)),zc(()=>Vn.selectedFeature,P=>{Object.keys(Vn.selectedFeature).length&&(d.value=P.properties.ADDR_STD)});const E=P=>{Vn.selectedFeature=P,Vn.map&&(Vn.map.removeFeatureState({source:"parcels"}),Vn.map.setFeatureState({source:"parcels",id:Vn.selectedFeature.id},{click:!0}))};return(P,r)=>(Ns(),zo(Ms,null,[Wr("h2",null,gh(a.value?a.value:"Create Scenario"),1),Wr("form",{onSubmit:T},[Wr("label",null,[df("Project Title "),Qn(n_,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=B=>a.value=B),placeholder:"Title",name:"title",required:""},null,8,["modelValue"])]),Wr("label",null,[df("Project Address "),Qn(n_,{modelValue:d.value,"onUpdate:modelValue":r[1]||(r[1]=B=>d.value=B),placeholder:"Address",name:"address",required:""},null,8,["modelValue"])]),Object.keys(Do(Vn).selectedFeature).length?c0("",!0):(Ns(),zo("div",p3,[(Ns(!0),zo(Ms,null,BP(m.value,B=>(Ns(),zo("div",{key:B.id,style:{padding:"0"}},[Wr("button",{class:"autocomp",type:"button",onClick:W=>E(B)},gh(B.properties.ADDR_STD),9,m3)]))),128))])),Object.keys(Do(Vn).selectedFeature).length?(Ns(),zo(Ms,{key:1},[Wr("label",null,[df("Number of Residents "),Qn(n_,{placeholder:"Residents",name:"residents",required:""})]),Wr("label",null,[df("Number of Employees "),Qn(n_,{placeholder:"Employees",name:"employees",required:""})]),Qn(sR,{text:"Generate Report"})],64)):c0("",!0)],32),Object.keys(Do(Vn).formData).length&&Object.keys(Do(Vn).selectedFeature).length?(Ns(),jM(f3,{key:x.value})):c0("",!0)],64))}},g3={id:"layout"},y3={id:"sidebar"},x3={__name:"App",setup(c){const a={lng:-71.224518,lat:42.213995,bearing:0,pitch:0,zoom:9};return(d,m)=>(Ns(),zo("div",g3,[Wr("div",y3,[Qn(_3)]),Qn(eR,{modelValue:a,"onUpdate:modelValue":m[0]||(m[0]=x=>a=x)})]))}},v3=qD(x3);v3.mount("#app");
