var LC=Object.defineProperty;var RC=(c,a,d)=>a in c?LC(c,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[a]=d;var Bi=(c,a,d)=>(RC(c,typeof a!="symbol"?a+"":a,d),d);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))m(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const E of T.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&m(E)}).observe(document,{childList:!0,subtree:!0});function d(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerPolicy&&(T.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?T.credentials="include":x.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function m(x){if(x.ep)return;x.ep=!0;const T=d(x);fetch(x.href,T)}})();/**
* @vue/shared v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function I0(c,a){const d=new Set(c.split(","));return m=>d.has(m)}const kn={},Wu=[],$s=()=>{},zC=()=>!1,C_=c=>c.charCodeAt(0)===111&&c.charCodeAt(1)===110&&(c.charCodeAt(2)>122||c.charCodeAt(2)<97),C0=c=>c.startsWith("onUpdate:"),br=Object.assign,P0=(c,a)=>{const d=c.indexOf(a);d>-1&&c.splice(d,1)},kC=Object.prototype.hasOwnProperty,dn=(c,a)=>kC.call(c,a),Li=Array.isArray,Zu=c=>P_(c)==="[object Map]",lM=c=>P_(c)==="[object Set]",Wi=c=>typeof c=="function",wr=c=>typeof c=="string",Fc=c=>typeof c=="symbol",Wn=c=>c!==null&&typeof c=="object",cM=c=>(Wn(c)||Wi(c))&&Wi(c.then)&&Wi(c.catch),uM=Object.prototype.toString,P_=c=>uM.call(c),OC=c=>P_(c).slice(8,-1),hM=c=>P_(c)==="[object Object]",D0=c=>wr(c)&&c!=="NaN"&&c[0]!=="-"&&""+parseInt(c,10)===c,gf=I0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),D_=c=>{const a=Object.create(null);return d=>a[d]||(a[d]=c(d))},FC=/-(\w)/g,zc=D_(c=>c.replace(FC,(a,d)=>d?d.toUpperCase():"")),BC=/\B([A-Z])/g,Bc=D_(c=>c.replace(BC,"-$1").toLowerCase()),dM=D_(c=>c.charAt(0).toUpperCase()+c.slice(1)),ky=D_(c=>c?`on${dM(c)}`:""),qo=(c,a)=>!Object.is(c,a),n_=(c,a)=>{for(let d=0;d<c.length;d++)c[d](a)},fM=(c,a,d,m=!1)=>{Object.defineProperty(c,a,{configurable:!0,enumerable:!1,writable:m,value:d})},n0=c=>{const a=parseFloat(c);return isNaN(a)?c:a};let pw;const pM=()=>pw||(pw=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function L0(c){if(Li(c)){const a={};for(let d=0;d<c.length;d++){const m=c[d],x=wr(m)?jC(m):L0(m);if(x)for(const T in x)a[T]=x[T]}return a}else if(wr(c)||Wn(c))return c}const NC=/;(?![^(]*\))/g,VC=/:([^]+)/,UC=/\/\*[^]*?\*\//g;function jC(c){const a={};return c.replace(UC,"").split(NC).forEach(d=>{if(d){const m=d.split(VC);m.length>1&&(a[m[0].trim()]=m[1].trim())}}),a}function R0(c){let a="";if(wr(c))a=c;else if(Li(c))for(let d=0;d<c.length;d++){const m=R0(c[d]);m&&(a+=m+" ")}else if(Wn(c))for(const d in c)c[d]&&(a+=d+" ");return a.trim()}const GC="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",$C=I0(GC);function mM(c){return!!c||c===""}const Xu=c=>wr(c)?c:c==null?"":Li(c)||Wn(c)&&(c.toString===uM||!Wi(c.toString))?JSON.stringify(c,_M,2):String(c),_M=(c,a)=>a&&a.__v_isRef?_M(c,a.value):Zu(a)?{[`Map(${a.size})`]:[...a.entries()].reduce((d,[m,x],T)=>(d[Oy(m,T)+" =>"]=x,d),{})}:lM(a)?{[`Set(${a.size})`]:[...a.values()].map(d=>Oy(d))}:Fc(a)?Oy(a):Wn(a)&&!Li(a)&&!hM(a)?String(a):a,Oy=(c,a="")=>{var d;return Fc(c)?`Symbol(${(d=c.description)!=null?d:a})`:c};/**
* @vue/reactivity v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let lo;class qC{constructor(a=!1){this.detached=a,this._active=!0,this.effects=[],this.cleanups=[],this.parent=lo,!a&&lo&&(this.index=(lo.scopes||(lo.scopes=[])).push(this)-1)}get active(){return this._active}run(a){if(this._active){const d=lo;try{return lo=this,a()}finally{lo=d}}}on(){lo=this}off(){lo=this.parent}stop(a){if(this._active){let d,m;for(d=0,m=this.effects.length;d<m;d++)this.effects[d].stop();for(d=0,m=this.cleanups.length;d<m;d++)this.cleanups[d]();if(this.scopes)for(d=0,m=this.scopes.length;d<m;d++)this.scopes[d].stop(!0);if(!this.detached&&this.parent&&!a){const x=this.parent.scopes.pop();x&&x!==this&&(this.parent.scopes[this.index]=x,x.index=this.index)}this.parent=void 0,this._active=!1}}}function HC(c,a=lo){a&&a.active&&a.effects.push(c)}function WC(){return lo}let Cc;class z0{constructor(a,d,m,x){this.fn=a,this.trigger=d,this.scheduler=m,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,HC(this,x)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,wl();for(let a=0;a<this._depsLength;a++){const d=this.deps[a];if(d.computed&&(ZC(d.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Tl()}return this._dirtyLevel>=4}set dirty(a){this._dirtyLevel=a?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let a=_l,d=Cc;try{return _l=!0,Cc=this,this._runnings++,mw(this),this.fn()}finally{_w(this),this._runnings--,Cc=d,_l=a}}stop(){this.active&&(mw(this),_w(this),this.onStop&&this.onStop(),this.active=!1)}}function ZC(c){return c.value}function mw(c){c._trackId++,c._depsLength=0}function _w(c){if(c.deps.length>c._depsLength){for(let a=c._depsLength;a<c.deps.length;a++)gM(c.deps[a],c);c.deps.length=c._depsLength}}function gM(c,a){const d=c.get(a);d!==void 0&&a._trackId!==d&&(c.delete(a),c.size===0&&c.cleanup())}let _l=!0,r0=0;const yM=[];function wl(){yM.push(_l),_l=!1}function Tl(){const c=yM.pop();_l=c===void 0?!0:c}function k0(){r0++}function O0(){for(r0--;!r0&&s0.length;)s0.shift()()}function xM(c,a,d){if(a.get(c)!==c._trackId){a.set(c,c._trackId);const m=c.deps[c._depsLength];m!==a?(m&&gM(m,c),c.deps[c._depsLength++]=a):c._depsLength++}}const s0=[];function vM(c,a,d){k0();for(const m of c.keys()){let x;m._dirtyLevel<a&&(x??(x=c.get(m)===m._trackId))&&(m._shouldSchedule||(m._shouldSchedule=m._dirtyLevel===0),m._dirtyLevel=a),m._shouldSchedule&&(x??(x=c.get(m)===m._trackId))&&(m.trigger(),(!m._runnings||m.allowRecurse)&&m._dirtyLevel!==2&&(m._shouldSchedule=!1,m.scheduler&&s0.push(m.scheduler)))}O0()}const bM=(c,a)=>{const d=new Map;return d.cleanup=c,d.computed=a,d},o0=new WeakMap,Pc=Symbol(""),a0=Symbol("");function gs(c,a,d){if(_l&&Cc){let m=o0.get(c);m||o0.set(c,m=new Map);let x=m.get(d);x||m.set(d,x=bM(()=>m.delete(d))),xM(Cc,x)}}function va(c,a,d,m,x,T){const E=o0.get(c);if(!E)return;let P=[];if(a==="clear")P=[...E.values()];else if(d==="length"&&Li(c)){const s=Number(m);E.forEach((B,q)=>{(q==="length"||!Fc(q)&&q>=s)&&P.push(B)})}else switch(d!==void 0&&P.push(E.get(d)),a){case"add":Li(c)?D0(d)&&P.push(E.get("length")):(P.push(E.get(Pc)),Zu(c)&&P.push(E.get(a0)));break;case"delete":Li(c)||(P.push(E.get(Pc)),Zu(c)&&P.push(E.get(a0)));break;case"set":Zu(c)&&P.push(E.get(Pc));break}k0();for(const s of P)s&&vM(s,4);O0()}const XC=I0("__proto__,__v_isRef,__isVue"),wM=new Set(Object.getOwnPropertyNames(Symbol).filter(c=>c!=="arguments"&&c!=="caller").map(c=>Symbol[c]).filter(Fc)),gw=YC();function YC(){const c={};return["includes","indexOf","lastIndexOf"].forEach(a=>{c[a]=function(...d){const m=pn(this);for(let T=0,E=this.length;T<E;T++)gs(m,"get",T+"");const x=m[a](...d);return x===-1||x===!1?m[a](...d.map(pn)):x}}),["push","pop","shift","unshift","splice"].forEach(a=>{c[a]=function(...d){wl(),k0();const m=pn(this)[a].apply(this,d);return O0(),Tl(),m}}),c}function KC(c){Fc(c)||(c=String(c));const a=pn(this);return gs(a,"has",c),a.hasOwnProperty(c)}class TM{constructor(a=!1,d=!1){this._isReadonly=a,this._isShallow=d}get(a,d,m){const x=this._isReadonly,T=this._isShallow;if(d==="__v_isReactive")return!x;if(d==="__v_isReadonly")return x;if(d==="__v_isShallow")return T;if(d==="__v_raw")return m===(x?T?uP:AM:T?EM:SM).get(a)||Object.getPrototypeOf(a)===Object.getPrototypeOf(m)?a:void 0;const E=Li(a);if(!x){if(E&&dn(gw,d))return Reflect.get(gw,d,m);if(d==="hasOwnProperty")return KC}const P=Reflect.get(a,d,m);return(Fc(d)?wM.has(d):XC(d))||(x||gs(a,"get",d),T)?P:ys(P)?E&&D0(d)?P:P.value:Wn(P)?x?IM(P):R_(P):P}}class MM extends TM{constructor(a=!1){super(!1,a)}set(a,d,m,x){let T=a[d];if(!this._isShallow){const s=Af(T);if(!p_(m)&&!Af(m)&&(T=pn(T),m=pn(m)),!Li(a)&&ys(T)&&!ys(m))return s?!1:(T.value=m,!0)}const E=Li(a)&&D0(d)?Number(d)<a.length:dn(a,d),P=Reflect.set(a,d,m,x);return a===pn(x)&&(E?qo(m,T)&&va(a,"set",d,m):va(a,"add",d,m)),P}deleteProperty(a,d){const m=dn(a,d);a[d];const x=Reflect.deleteProperty(a,d);return x&&m&&va(a,"delete",d,void 0),x}has(a,d){const m=Reflect.has(a,d);return(!Fc(d)||!wM.has(d))&&gs(a,"has",d),m}ownKeys(a){return gs(a,"iterate",Li(a)?"length":Pc),Reflect.ownKeys(a)}}class JC extends TM{constructor(a=!1){super(!0,a)}set(a,d){return!0}deleteProperty(a,d){return!0}}const QC=new MM,eP=new JC,tP=new MM(!0);const F0=c=>c,L_=c=>Reflect.getPrototypeOf(c);function km(c,a,d=!1,m=!1){c=c.__v_raw;const x=pn(c),T=pn(a);d||(qo(a,T)&&gs(x,"get",a),gs(x,"get",T));const{has:E}=L_(x),P=m?F0:d?V0:If;if(E.call(x,a))return P(c.get(a));if(E.call(x,T))return P(c.get(T));c!==x&&c.get(a)}function Om(c,a=!1){const d=this.__v_raw,m=pn(d),x=pn(c);return a||(qo(c,x)&&gs(m,"has",c),gs(m,"has",x)),c===x?d.has(c):d.has(c)||d.has(x)}function Fm(c,a=!1){return c=c.__v_raw,!a&&gs(pn(c),"iterate",Pc),Reflect.get(c,"size",c)}function yw(c){c=pn(c);const a=pn(this);return L_(a).has.call(a,c)||(a.add(c),va(a,"add",c,c)),this}function xw(c,a){a=pn(a);const d=pn(this),{has:m,get:x}=L_(d);let T=m.call(d,c);T||(c=pn(c),T=m.call(d,c));const E=x.call(d,c);return d.set(c,a),T?qo(a,E)&&va(d,"set",c,a):va(d,"add",c,a),this}function vw(c){const a=pn(this),{has:d,get:m}=L_(a);let x=d.call(a,c);x||(c=pn(c),x=d.call(a,c)),m&&m.call(a,c);const T=a.delete(c);return x&&va(a,"delete",c,void 0),T}function bw(){const c=pn(this),a=c.size!==0,d=c.clear();return a&&va(c,"clear",void 0,void 0),d}function Bm(c,a){return function(m,x){const T=this,E=T.__v_raw,P=pn(E),s=a?F0:c?V0:If;return!c&&gs(P,"iterate",Pc),E.forEach((B,q)=>m.call(x,s(B),s(q),T))}}function Nm(c,a,d){return function(...m){const x=this.__v_raw,T=pn(x),E=Zu(T),P=c==="entries"||c===Symbol.iterator&&E,s=c==="keys"&&E,B=x[c](...m),q=d?F0:a?V0:If;return!a&&gs(T,"iterate",s?a0:Pc),{next(){const{value:Z,done:ae}=B.next();return ae?{value:Z,done:ae}:{value:P?[q(Z[0]),q(Z[1])]:q(Z),done:ae}},[Symbol.iterator](){return this}}}}function al(c){return function(...a){return c==="delete"?!1:c==="clear"?void 0:this}}function iP(){const c={get(T){return km(this,T)},get size(){return Fm(this)},has:Om,add:yw,set:xw,delete:vw,clear:bw,forEach:Bm(!1,!1)},a={get(T){return km(this,T,!1,!0)},get size(){return Fm(this)},has:Om,add:yw,set:xw,delete:vw,clear:bw,forEach:Bm(!1,!0)},d={get(T){return km(this,T,!0)},get size(){return Fm(this,!0)},has(T){return Om.call(this,T,!0)},add:al("add"),set:al("set"),delete:al("delete"),clear:al("clear"),forEach:Bm(!0,!1)},m={get(T){return km(this,T,!0,!0)},get size(){return Fm(this,!0)},has(T){return Om.call(this,T,!0)},add:al("add"),set:al("set"),delete:al("delete"),clear:al("clear"),forEach:Bm(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(T=>{c[T]=Nm(T,!1,!1),d[T]=Nm(T,!0,!1),a[T]=Nm(T,!1,!0),m[T]=Nm(T,!0,!0)}),[c,d,a,m]}const[nP,rP,sP,oP]=iP();function B0(c,a){const d=a?c?oP:sP:c?rP:nP;return(m,x,T)=>x==="__v_isReactive"?!c:x==="__v_isReadonly"?c:x==="__v_raw"?m:Reflect.get(dn(d,x)&&x in m?d:m,x,T)}const aP={get:B0(!1,!1)},lP={get:B0(!1,!0)},cP={get:B0(!0,!1)};const SM=new WeakMap,EM=new WeakMap,AM=new WeakMap,uP=new WeakMap;function hP(c){switch(c){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function dP(c){return c.__v_skip||!Object.isExtensible(c)?0:hP(OC(c))}function R_(c){return Af(c)?c:N0(c,!1,QC,aP,SM)}function fP(c){return N0(c,!1,tP,lP,EM)}function IM(c){return N0(c,!0,eP,cP,AM)}function N0(c,a,d,m,x){if(!Wn(c)||c.__v_raw&&!(a&&c.__v_isReactive))return c;const T=x.get(c);if(T)return T;const E=dP(c);if(E===0)return c;const P=new Proxy(c,E===2?m:d);return x.set(c,P),P}function yf(c){return Af(c)?yf(c.__v_raw):!!(c&&c.__v_isReactive)}function Af(c){return!!(c&&c.__v_isReadonly)}function p_(c){return!!(c&&c.__v_isShallow)}function z_(c){return c?!!c.__v_raw:!1}function pn(c){const a=c&&c.__v_raw;return a?pn(a):c}function pP(c){return Object.isExtensible(c)&&fM(c,"__v_skip",!0),c}const If=c=>Wn(c)?R_(c):c,V0=c=>Wn(c)?IM(c):c;class CM{constructor(a,d,m,x){this.getter=a,this._setter=d,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new z0(()=>a(this._value),()=>xf(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!x,this.__v_isReadonly=m}get value(){const a=pn(this);return(!a._cacheable||a.effect.dirty)&&qo(a._value,a._value=a.effect.run())&&xf(a,4),U0(a),a.effect._dirtyLevel>=2&&xf(a,2),a._value}set value(a){this._setter(a)}get _dirty(){return this.effect.dirty}set _dirty(a){this.effect.dirty=a}}function mP(c,a,d=!1){let m,x;const T=Wi(c);return T?(m=c,x=$s):(m=c.get,x=c.set),new CM(m,x,T||!x,d)}function U0(c){var a;_l&&Cc&&(c=pn(c),xM(Cc,(a=c.dep)!=null?a:c.dep=bM(()=>c.dep=void 0,c instanceof CM?c:void 0)))}function xf(c,a=4,d){c=pn(c);const m=c.dep;m&&vM(m,a)}function ys(c){return!!(c&&c.__v_isRef===!0)}function uf(c){return DM(c,!1)}function PM(c){return DM(c,!0)}function DM(c,a){return ys(c)?c:new _P(c,a)}class _P{constructor(a,d){this.__v_isShallow=d,this.dep=void 0,this.__v_isRef=!0,this._rawValue=d?a:pn(a),this._value=d?a:If(a)}get value(){return U0(this),this._value}set value(a){const d=this.__v_isShallow||p_(a)||Af(a);a=d?a:pn(a),qo(a,this._rawValue)&&(this._rawValue=a,this._value=d?a:If(a),xf(this,4))}}function xa(c){return ys(c)?c.value:c}const gP={get:(c,a,d)=>xa(Reflect.get(c,a,d)),set:(c,a,d,m)=>{const x=c[a];return ys(x)&&!ys(d)?(x.value=d,!0):Reflect.set(c,a,d,m)}};function LM(c){return yf(c)?c:new Proxy(c,gP)}class yP{constructor(a){this.dep=void 0,this.__v_isRef=!0;const{get:d,set:m}=a(()=>U0(this),()=>xf(this));this._get=d,this._set=m}get value(){return this._get()}set value(a){this._set(a)}}function xP(c){return new yP(c)}/**
* @vue/runtime-core v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function gl(c,a,d,m){try{return m?c(...m):c()}catch(x){k_(x,a,d)}}function fo(c,a,d,m){if(Wi(c)){const x=gl(c,a,d,m);return x&&cM(x)&&x.catch(T=>{k_(T,a,d)}),x}if(Li(c)){const x=[];for(let T=0;T<c.length;T++)x.push(fo(c[T],a,d,m));return x}}function k_(c,a,d,m=!0){const x=a?a.vnode:null;if(a){let T=a.parent;const E=a.proxy,P=`https://vuejs.org/error-reference/#runtime-${d}`;for(;T;){const B=T.ec;if(B){for(let q=0;q<B.length;q++)if(B[q](c,E,P)===!1)return}T=T.parent}const s=a.appContext.config.errorHandler;if(s){wl(),gl(s,null,10,[c,E,P]),Tl();return}}vP(c,d,x,m)}function vP(c,a,d,m=!0){console.error(c)}let Cf=!1,l0=!1;const $r=[];let Go=0;const Yu=[];let cl=null,Ac=0;const RM=Promise.resolve();let j0=null;function zM(c){const a=j0||RM;return c?a.then(this?c.bind(this):c):a}function bP(c){let a=Go+1,d=$r.length;for(;a<d;){const m=a+d>>>1,x=$r[m],T=Pf(x);T<c||T===c&&x.pre?a=m+1:d=m}return a}function G0(c){(!$r.length||!$r.includes(c,Cf&&c.allowRecurse?Go+1:Go))&&(c.id==null?$r.push(c):$r.splice(bP(c.id),0,c),kM())}function kM(){!Cf&&!l0&&(l0=!0,j0=RM.then(FM))}function wP(c){const a=$r.indexOf(c);a>Go&&$r.splice(a,1)}function TP(c){Li(c)?Yu.push(...c):(!cl||!cl.includes(c,c.allowRecurse?Ac+1:Ac))&&Yu.push(c),kM()}function ww(c,a,d=Cf?Go+1:0){for(;d<$r.length;d++){const m=$r[d];if(m&&m.pre){if(c&&m.id!==c.uid)continue;$r.splice(d,1),d--,m()}}}function OM(c){if(Yu.length){const a=[...new Set(Yu)].sort((d,m)=>Pf(d)-Pf(m));if(Yu.length=0,cl){cl.push(...a);return}for(cl=a,Ac=0;Ac<cl.length;Ac++)cl[Ac]();cl=null,Ac=0}}const Pf=c=>c.id==null?1/0:c.id,MP=(c,a)=>{const d=Pf(c)-Pf(a);if(d===0){if(c.pre&&!a.pre)return-1;if(a.pre&&!c.pre)return 1}return d};function FM(c){l0=!1,Cf=!0,$r.sort(MP);try{for(Go=0;Go<$r.length;Go++){const a=$r[Go];a&&a.active!==!1&&gl(a,null,14)}}finally{Go=0,$r.length=0,OM(),Cf=!1,j0=null,($r.length||Yu.length)&&FM()}}function SP(c,a,...d){if(c.isUnmounted)return;const m=c.vnode.props||kn;let x=d;const T=a.startsWith("update:"),E=T&&a.slice(7);if(E&&E in m){const q=`${E==="modelValue"?"model":E}Modifiers`,{number:Z,trim:ae}=m[q]||kn;ae&&(x=d.map(ue=>wr(ue)?ue.trim():ue)),Z&&(x=d.map(n0))}let P,s=m[P=ky(a)]||m[P=ky(zc(a))];!s&&T&&(s=m[P=ky(Bc(a))]),s&&fo(s,c,6,x);const B=m[P+"Once"];if(B){if(!c.emitted)c.emitted={};else if(c.emitted[P])return;c.emitted[P]=!0,fo(B,c,6,x)}}function BM(c,a,d=!1){const m=a.emitsCache,x=m.get(c);if(x!==void 0)return x;const T=c.emits;let E={},P=!1;if(!Wi(c)){const s=B=>{const q=BM(B,a,!0);q&&(P=!0,br(E,q))};!d&&a.mixins.length&&a.mixins.forEach(s),c.extends&&s(c.extends),c.mixins&&c.mixins.forEach(s)}return!T&&!P?(Wn(c)&&m.set(c,null),null):(Li(T)?T.forEach(s=>E[s]=null):br(E,T),Wn(c)&&m.set(c,E),E)}function O_(c,a){return!c||!C_(a)?!1:(a=a.slice(2).replace(/Once$/,""),dn(c,a[0].toLowerCase()+a.slice(1))||dn(c,Bc(a))||dn(c,a))}let ms=null,NM=null;function m_(c){const a=ms;return ms=c,NM=c&&c.type.__scopeId||null,a}function EP(c,a=ms,d){if(!a||c._n)return c;const m=(...x)=>{m._d&&Dw(-1);const T=m_(a);let E;try{E=c(...x)}finally{m_(T),m._d&&Dw(1)}return E};return m._n=!0,m._c=!0,m._d=!0,m}function Fy(c){const{type:a,vnode:d,proxy:m,withProxy:x,propsOptions:[T],slots:E,attrs:P,emit:s,render:B,renderCache:q,props:Z,data:ae,setupState:ue,ctx:Le,inheritAttrs:Ae}=c,Oe=m_(c);let We,ct;try{if(d.shapeFlag&4){const Lt=x||m,Rt=Lt;We=jo(B.call(Rt,Lt,q,Z,ue,ae,Le)),ct=P}else{const Lt=a;We=jo(Lt.length>1?Lt(Z,{attrs:P,slots:E,emit:s}):Lt(Z,null)),ct=a.props?P:AP(P)}}catch(Lt){wf.length=0,k_(Lt,c,1),We=nr(kc)}let gt=We;if(ct&&Ae!==!1){const Lt=Object.keys(ct),{shapeFlag:Rt}=gt;Lt.length&&Rt&7&&(T&&Lt.some(C0)&&(ct=IP(ct,T)),gt=Ju(gt,ct,!1,!0))}return d.dirs&&(gt=Ju(gt,null,!1,!0),gt.dirs=gt.dirs?gt.dirs.concat(d.dirs):d.dirs),d.transition&&(gt.transition=d.transition),We=gt,m_(Oe),We}const AP=c=>{let a;for(const d in c)(d==="class"||d==="style"||C_(d))&&((a||(a={}))[d]=c[d]);return a},IP=(c,a)=>{const d={};for(const m in c)(!C0(m)||!(m.slice(9)in a))&&(d[m]=c[m]);return d};function CP(c,a,d){const{props:m,children:x,component:T}=c,{props:E,children:P,patchFlag:s}=a,B=T.emitsOptions;if(a.dirs||a.transition)return!0;if(d&&s>=0){if(s&1024)return!0;if(s&16)return m?Tw(m,E,B):!!E;if(s&8){const q=a.dynamicProps;for(let Z=0;Z<q.length;Z++){const ae=q[Z];if(E[ae]!==m[ae]&&!O_(B,ae))return!0}}}else return(x||P)&&(!P||!P.$stable)?!0:m===E?!1:m?E?Tw(m,E,B):!0:!!E;return!1}function Tw(c,a,d){const m=Object.keys(a);if(m.length!==Object.keys(c).length)return!0;for(let x=0;x<m.length;x++){const T=m[x];if(a[T]!==c[T]&&!O_(d,T))return!0}return!1}function PP({vnode:c,parent:a},d){for(;a;){const m=a.subTree;if(m.suspense&&m.suspense.activeBranch===c&&(m.el=c.el),m===c)(c=a.vnode).el=d,a=a.parent;else break}}const DP=Symbol.for("v-ndc"),LP=c=>c.__isSuspense;function RP(c,a){a&&a.pendingBranch?Li(c)?a.effects.push(...c):a.effects.push(c):TP(c)}const zP=Symbol.for("v-scx"),kP=()=>s_(zP);function OP(c,a){return $0(c,null,{flush:"sync"})}const Vm={};function Dc(c,a,d){return $0(c,a,d)}function $0(c,a,{immediate:d,deep:m,flush:x,once:T,onTrack:E,onTrigger:P}=kn){if(a&&T){const Wt=a;a=(...ui)=>{Wt(...ui),Rt()}}const s=qr,B=Wt=>m===!0?Wt:Ic(Wt,m===!1?1:void 0);let q,Z=!1,ae=!1;if(ys(c)?(q=()=>c.value,Z=p_(c)):yf(c)?(q=()=>B(c),Z=!0):Li(c)?(ae=!0,Z=c.some(Wt=>yf(Wt)||p_(Wt)),q=()=>c.map(Wt=>{if(ys(Wt))return Wt.value;if(yf(Wt))return B(Wt);if(Wi(Wt))return gl(Wt,s,2)})):Wi(c)?a?q=()=>gl(c,s,2):q=()=>(ue&&ue(),fo(c,s,3,[Le])):q=$s,a&&m){const Wt=q;q=()=>Ic(Wt())}let ue,Le=Wt=>{ue=gt.onStop=()=>{gl(Wt,s,4),ue=gt.onStop=void 0}},Ae;if(N_)if(Le=$s,a?d&&fo(a,s,3,[q(),ae?[]:void 0,Le]):q(),x==="sync"){const Wt=kP();Ae=Wt.__watcherHandles||(Wt.__watcherHandles=[])}else return $s;let Oe=ae?new Array(c.length).fill(Vm):Vm;const We=()=>{if(!(!gt.active||!gt.dirty))if(a){const Wt=gt.run();(m||Z||(ae?Wt.some((ui,bi)=>qo(ui,Oe[bi])):qo(Wt,Oe)))&&(ue&&ue(),fo(a,s,3,[Wt,Oe===Vm?void 0:ae&&Oe[0]===Vm?[]:Oe,Le]),Oe=Wt)}else gt.run()};We.allowRecurse=!!a;let ct;x==="sync"?ct=We:x==="post"?ct=()=>fs(We,s&&s.suspense):(We.pre=!0,s&&(We.id=s.uid),ct=()=>G0(We));const gt=new z0(q,$s,ct),Lt=WC(),Rt=()=>{gt.stop(),Lt&&P0(Lt.effects,gt)};return a?d?We():Oe=gt.run():x==="post"?fs(gt.run.bind(gt),s&&s.suspense):gt.run(),Ae&&Ae.push(Rt),Rt}function FP(c,a,d){const m=this.proxy,x=wr(c)?c.includes(".")?VM(m,c):()=>m[c]:c.bind(m,m);let T;Wi(a)?T=a:(T=a.handler,d=a);const E=Bf(this),P=$0(x,T.bind(m),d);return E(),P}function VM(c,a){const d=a.split(".");return()=>{let m=c;for(let x=0;x<d.length&&m;x++)m=m[d[x]];return m}}function Ic(c,a=1/0,d){if(a<=0||!Wn(c)||c.__v_skip||(d=d||new Set,d.has(c)))return c;if(d.add(c),a--,ys(c))Ic(c.value,a,d);else if(Li(c))for(let m=0;m<c.length;m++)Ic(c[m],a,d);else if(lM(c)||Zu(c))c.forEach(m=>{Ic(m,a,d)});else if(hM(c))for(const m in c)Ic(c[m],a,d);return c}function BP(c,a){if(ms===null)return c;const d=V_(ms)||ms.proxy,m=c.dirs||(c.dirs=[]);for(let x=0;x<a.length;x++){let[T,E,P,s=kn]=a[x];T&&(Wi(T)&&(T={mounted:T,updated:T}),T.deep&&Ic(E),m.push({dir:T,instance:d,value:E,oldValue:void 0,arg:P,modifiers:s}))}return c}function vc(c,a,d,m){const x=c.dirs,T=a&&a.dirs;for(let E=0;E<x.length;E++){const P=x[E];T&&(P.oldValue=T[E].value);let s=P.dir[m];s&&(wl(),fo(s,d,8,[c.el,P,c,a]),Tl())}}/*! #__NO_SIDE_EFFECTS__ */function UM(c,a){return Wi(c)?br({name:c.name},a,{setup:c}):c}const r_=c=>!!c.type.__asyncLoader,jM=c=>c.type.__isKeepAlive;function NP(c,a){GM(c,"a",a)}function VP(c,a){GM(c,"da",a)}function GM(c,a,d=qr){const m=c.__wdc||(c.__wdc=()=>{let x=d;for(;x;){if(x.isDeactivated)return;x=x.parent}return c()});if(F_(a,m,d),d){let x=d.parent;for(;x&&x.parent;)jM(x.parent.vnode)&&UP(m,a,d,x),x=x.parent}}function UP(c,a,d,m){const x=F_(a,c,m,!0);q0(()=>{P0(m[a],x)},d)}function F_(c,a,d=qr,m=!1){if(d){const x=d[c]||(d[c]=[]),T=a.__weh||(a.__weh=(...E)=>{if(d.isUnmounted)return;wl();const P=Bf(d),s=fo(a,d,c,E);return P(),Tl(),s});return m?x.unshift(T):x.push(T),T}}const ba=c=>(a,d=qr)=>(!N_||c==="sp")&&F_(c,(...m)=>a(...m),d),jP=ba("bm"),$M=ba("m"),GP=ba("bu"),$P=ba("u"),qP=ba("bum"),q0=ba("um"),HP=ba("sp"),WP=ba("rtg"),ZP=ba("rtc");function XP(c,a=qr){F_("ec",c,a)}function YP(c,a,d,m){let x;const T=d;if(Li(c)||wr(c)){x=new Array(c.length);for(let E=0,P=c.length;E<P;E++)x[E]=a(c[E],E,void 0,T)}else if(typeof c=="number"){x=new Array(c);for(let E=0;E<c;E++)x[E]=a(E+1,E,void 0,T)}else if(Wn(c))if(c[Symbol.iterator])x=Array.from(c,(E,P)=>a(E,P,void 0,T));else{const E=Object.keys(c);x=new Array(E.length);for(let P=0,s=E.length;P<s;P++){const B=E[P];x[P]=a(c[B],B,P,T)}}else x=[];return x}const c0=c=>c?oS(c)?V_(c)||c.proxy:c0(c.parent):null,vf=br(Object.create(null),{$:c=>c,$el:c=>c.vnode.el,$data:c=>c.data,$props:c=>c.props,$attrs:c=>c.attrs,$slots:c=>c.slots,$refs:c=>c.refs,$parent:c=>c0(c.parent),$root:c=>c0(c.root),$emit:c=>c.emit,$options:c=>H0(c),$forceUpdate:c=>c.f||(c.f=()=>{c.effect.dirty=!0,G0(c.update)}),$nextTick:c=>c.n||(c.n=zM.bind(c.proxy)),$watch:c=>FP.bind(c)}),By=(c,a)=>c!==kn&&!c.__isScriptSetup&&dn(c,a),KP={get({_:c},a){if(a==="__v_skip")return!0;const{ctx:d,setupState:m,data:x,props:T,accessCache:E,type:P,appContext:s}=c;let B;if(a[0]!=="$"){const ue=E[a];if(ue!==void 0)switch(ue){case 1:return m[a];case 2:return x[a];case 4:return d[a];case 3:return T[a]}else{if(By(m,a))return E[a]=1,m[a];if(x!==kn&&dn(x,a))return E[a]=2,x[a];if((B=c.propsOptions[0])&&dn(B,a))return E[a]=3,T[a];if(d!==kn&&dn(d,a))return E[a]=4,d[a];u0&&(E[a]=0)}}const q=vf[a];let Z,ae;if(q)return a==="$attrs"&&gs(c.attrs,"get",""),q(c);if((Z=P.__cssModules)&&(Z=Z[a]))return Z;if(d!==kn&&dn(d,a))return E[a]=4,d[a];if(ae=s.config.globalProperties,dn(ae,a))return ae[a]},set({_:c},a,d){const{data:m,setupState:x,ctx:T}=c;return By(x,a)?(x[a]=d,!0):m!==kn&&dn(m,a)?(m[a]=d,!0):dn(c.props,a)||a[0]==="$"&&a.slice(1)in c?!1:(T[a]=d,!0)},has({_:{data:c,setupState:a,accessCache:d,ctx:m,appContext:x,propsOptions:T}},E){let P;return!!d[E]||c!==kn&&dn(c,E)||By(a,E)||(P=T[0])&&dn(P,E)||dn(m,E)||dn(vf,E)||dn(x.config.globalProperties,E)},defineProperty(c,a,d){return d.get!=null?c._.accessCache[a]=0:dn(d,"value")&&this.set(c,a,d.value,null),Reflect.defineProperty(c,a,d)}};function __(c){return Li(c)?c.reduce((a,d)=>(a[d]=null,a),{}):c}function JP(c,a){return!c||!a?c||a:Li(c)&&Li(a)?c.concat(a):br({},__(c),__(a))}let u0=!0;function QP(c){const a=H0(c),d=c.proxy,m=c.ctx;u0=!1,a.beforeCreate&&Mw(a.beforeCreate,c,"bc");const{data:x,computed:T,methods:E,watch:P,provide:s,inject:B,created:q,beforeMount:Z,mounted:ae,beforeUpdate:ue,updated:Le,activated:Ae,deactivated:Oe,beforeDestroy:We,beforeUnmount:ct,destroyed:gt,unmounted:Lt,render:Rt,renderTracked:Wt,renderTriggered:ui,errorCaptured:bi,serverPrefetch:$e,expose:Ji,inheritAttrs:un,components:Zt,directives:sn,filters:xr}=a;if(B&&eD(B,m,null),E)for(const gi in E){const kt=E[gi];Wi(kt)&&(m[gi]=kt.bind(d))}if(x){const gi=x.call(d,d);Wn(gi)&&(c.data=R_(gi))}if(u0=!0,T)for(const gi in T){const kt=T[gi],rr=Wi(kt)?kt.bind(d,d):Wi(kt.get)?kt.get.bind(d,d):$s,Kn=!Wi(kt)&&Wi(kt.set)?kt.set.bind(d):$s,Rn=PD({get:rr,set:Kn});Object.defineProperty(m,gi,{enumerable:!0,configurable:!0,get:()=>Rn.value,set:Qi=>Rn.value=Qi})}if(P)for(const gi in P)qM(P[gi],m,d,gi);if(s){const gi=Wi(s)?s.call(d):s;Reflect.ownKeys(gi).forEach(kt=>{oD(kt,gi[kt])})}q&&Mw(q,c,"c");function Ri(gi,kt){Li(kt)?kt.forEach(rr=>gi(rr.bind(d))):kt&&gi(kt.bind(d))}if(Ri(jP,Z),Ri($M,ae),Ri(GP,ue),Ri($P,Le),Ri(NP,Ae),Ri(VP,Oe),Ri(XP,bi),Ri(ZP,Wt),Ri(WP,ui),Ri(qP,ct),Ri(q0,Lt),Ri(HP,$e),Li(Ji))if(Ji.length){const gi=c.exposed||(c.exposed={});Ji.forEach(kt=>{Object.defineProperty(gi,kt,{get:()=>d[kt],set:rr=>d[kt]=rr})})}else c.exposed||(c.exposed={});Rt&&c.render===$s&&(c.render=Rt),un!=null&&(c.inheritAttrs=un),Zt&&(c.components=Zt),sn&&(c.directives=sn)}function eD(c,a,d=$s){Li(c)&&(c=h0(c));for(const m in c){const x=c[m];let T;Wn(x)?"default"in x?T=s_(x.from||m,x.default,!0):T=s_(x.from||m):T=s_(x),ys(T)?Object.defineProperty(a,m,{enumerable:!0,configurable:!0,get:()=>T.value,set:E=>T.value=E}):a[m]=T}}function Mw(c,a,d){fo(Li(c)?c.map(m=>m.bind(a.proxy)):c.bind(a.proxy),a,d)}function qM(c,a,d,m){const x=m.includes(".")?VM(d,m):()=>d[m];if(wr(c)){const T=a[c];Wi(T)&&Dc(x,T)}else if(Wi(c))Dc(x,c.bind(d));else if(Wn(c))if(Li(c))c.forEach(T=>qM(T,a,d,m));else{const T=Wi(c.handler)?c.handler.bind(d):a[c.handler];Wi(T)&&Dc(x,T,c)}}function H0(c){const a=c.type,{mixins:d,extends:m}=a,{mixins:x,optionsCache:T,config:{optionMergeStrategies:E}}=c.appContext,P=T.get(a);let s;return P?s=P:!x.length&&!d&&!m?s=a:(s={},x.length&&x.forEach(B=>g_(s,B,E,!0)),g_(s,a,E)),Wn(a)&&T.set(a,s),s}function g_(c,a,d,m=!1){const{mixins:x,extends:T}=a;T&&g_(c,T,d,!0),x&&x.forEach(E=>g_(c,E,d,!0));for(const E in a)if(!(m&&E==="expose")){const P=tD[E]||d&&d[E];c[E]=P?P(c[E],a[E]):a[E]}return c}const tD={data:Sw,props:Ew,emits:Ew,methods:hf,computed:hf,beforeCreate:Jr,created:Jr,beforeMount:Jr,mounted:Jr,beforeUpdate:Jr,updated:Jr,beforeDestroy:Jr,beforeUnmount:Jr,destroyed:Jr,unmounted:Jr,activated:Jr,deactivated:Jr,errorCaptured:Jr,serverPrefetch:Jr,components:hf,directives:hf,watch:nD,provide:Sw,inject:iD};function Sw(c,a){return a?c?function(){return br(Wi(c)?c.call(this,this):c,Wi(a)?a.call(this,this):a)}:a:c}function iD(c,a){return hf(h0(c),h0(a))}function h0(c){if(Li(c)){const a={};for(let d=0;d<c.length;d++)a[c[d]]=c[d];return a}return c}function Jr(c,a){return c?[...new Set([].concat(c,a))]:a}function hf(c,a){return c?br(Object.create(null),c,a):a}function Ew(c,a){return c?Li(c)&&Li(a)?[...new Set([...c,...a])]:br(Object.create(null),__(c),__(a??{})):a}function nD(c,a){if(!c)return a;if(!a)return c;const d=br(Object.create(null),c);for(const m in a)d[m]=Jr(c[m],a[m]);return d}function HM(){return{app:null,config:{isNativeTag:zC,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let rD=0;function sD(c,a){return function(m,x=null){Wi(m)||(m=br({},m)),x!=null&&!Wn(x)&&(x=null);const T=HM(),E=new WeakSet;let P=!1;const s=T.app={_uid:rD++,_component:m,_props:x,_container:null,_context:T,_instance:null,version:lS,get config(){return T.config},set config(B){},use(B,...q){return E.has(B)||(B&&Wi(B.install)?(E.add(B),B.install(s,...q)):Wi(B)&&(E.add(B),B(s,...q))),s},mixin(B){return T.mixins.includes(B)||T.mixins.push(B),s},component(B,q){return q?(T.components[B]=q,s):T.components[B]},directive(B,q){return q?(T.directives[B]=q,s):T.directives[B]},mount(B,q,Z){if(!P){const ae=nr(m,x);return ae.appContext=T,Z===!0?Z="svg":Z===!1&&(Z=void 0),q&&a?a(ae,B):c(ae,B,Z),P=!0,s._container=B,B.__vue_app__=s,V_(ae.component)||ae.component.proxy}},unmount(){P&&(c(null,s._container),delete s._container.__vue_app__)},provide(B,q){return T.provides[B]=q,s},runWithContext(B){const q=bf;bf=s;try{return B()}finally{bf=q}}};return s}}let bf=null;function oD(c,a){if(qr){let d=qr.provides;const m=qr.parent&&qr.parent.provides;m===d&&(d=qr.provides=Object.create(m)),d[c]=a}}function s_(c,a,d=!1){const m=qr||ms;if(m||bf){const x=m?m.parent==null?m.vnode.appContext&&m.vnode.appContext.provides:m.parent.provides:bf._context.provides;if(x&&c in x)return x[c];if(arguments.length>1)return d&&Wi(a)?a.call(m&&m.proxy):a}}const WM={},ZM=()=>Object.create(WM),XM=c=>Object.getPrototypeOf(c)===WM;function aD(c,a,d,m=!1){const x={},T=ZM();c.propsDefaults=Object.create(null),YM(c,a,x,T);for(const E in c.propsOptions[0])E in x||(x[E]=void 0);d?c.props=m?x:fP(x):c.type.props?c.props=x:c.props=T,c.attrs=T}function lD(c,a,d,m){const{props:x,attrs:T,vnode:{patchFlag:E}}=c,P=pn(x),[s]=c.propsOptions;let B=!1;if((m||E>0)&&!(E&16)){if(E&8){const q=c.vnode.dynamicProps;for(let Z=0;Z<q.length;Z++){let ae=q[Z];if(O_(c.emitsOptions,ae))continue;const ue=a[ae];if(s)if(dn(T,ae))ue!==T[ae]&&(T[ae]=ue,B=!0);else{const Le=zc(ae);x[Le]=d0(s,P,Le,ue,c,!1)}else ue!==T[ae]&&(T[ae]=ue,B=!0)}}}else{YM(c,a,x,T)&&(B=!0);let q;for(const Z in P)(!a||!dn(a,Z)&&((q=Bc(Z))===Z||!dn(a,q)))&&(s?d&&(d[Z]!==void 0||d[q]!==void 0)&&(x[Z]=d0(s,P,Z,void 0,c,!0)):delete x[Z]);if(T!==P)for(const Z in T)(!a||!dn(a,Z))&&(delete T[Z],B=!0)}B&&va(c.attrs,"set","")}function YM(c,a,d,m){const[x,T]=c.propsOptions;let E=!1,P;if(a)for(let s in a){if(gf(s))continue;const B=a[s];let q;x&&dn(x,q=zc(s))?!T||!T.includes(q)?d[q]=B:(P||(P={}))[q]=B:O_(c.emitsOptions,s)||(!(s in m)||B!==m[s])&&(m[s]=B,E=!0)}if(T){const s=pn(d),B=P||kn;for(let q=0;q<T.length;q++){const Z=T[q];d[Z]=d0(x,s,Z,B[Z],c,!dn(B,Z))}}return E}function d0(c,a,d,m,x,T){const E=c[d];if(E!=null){const P=dn(E,"default");if(P&&m===void 0){const s=E.default;if(E.type!==Function&&!E.skipFactory&&Wi(s)){const{propsDefaults:B}=x;if(d in B)m=B[d];else{const q=Bf(x);m=B[d]=s.call(null,a),q()}}else m=s}E[0]&&(T&&!P?m=!1:E[1]&&(m===""||m===Bc(d))&&(m=!0))}return m}function KM(c,a,d=!1){const m=a.propsCache,x=m.get(c);if(x)return x;const T=c.props,E={},P=[];let s=!1;if(!Wi(c)){const q=Z=>{s=!0;const[ae,ue]=KM(Z,a,!0);br(E,ae),ue&&P.push(...ue)};!d&&a.mixins.length&&a.mixins.forEach(q),c.extends&&q(c.extends),c.mixins&&c.mixins.forEach(q)}if(!T&&!s)return Wn(c)&&m.set(c,Wu),Wu;if(Li(T))for(let q=0;q<T.length;q++){const Z=zc(T[q]);Aw(Z)&&(E[Z]=kn)}else if(T)for(const q in T){const Z=zc(q);if(Aw(Z)){const ae=T[q],ue=E[Z]=Li(ae)||Wi(ae)?{type:ae}:br({},ae);if(ue){const Le=Pw(Boolean,ue.type),Ae=Pw(String,ue.type);ue[0]=Le>-1,ue[1]=Ae<0||Le<Ae,(Le>-1||dn(ue,"default"))&&P.push(Z)}}}const B=[E,P];return Wn(c)&&m.set(c,B),B}function Aw(c){return c[0]!=="$"&&!gf(c)}function Iw(c){return c===null?"null":typeof c=="function"?c.name||"":typeof c=="object"&&c.constructor&&c.constructor.name||""}function Cw(c,a){return Iw(c)===Iw(a)}function Pw(c,a){return Li(a)?a.findIndex(d=>Cw(d,c)):Wi(a)&&Cw(a,c)?0:-1}const JM=c=>c[0]==="_"||c==="$stable",W0=c=>Li(c)?c.map(jo):[jo(c)],cD=(c,a,d)=>{if(a._n)return a;const m=EP((...x)=>W0(a(...x)),d);return m._c=!1,m},QM=(c,a,d)=>{const m=c._ctx;for(const x in c){if(JM(x))continue;const T=c[x];if(Wi(T))a[x]=cD(x,T,m);else if(T!=null){const E=W0(T);a[x]=()=>E}}},eS=(c,a)=>{const d=W0(a);c.slots.default=()=>d},uD=(c,a)=>{const d=c.slots=ZM();if(c.vnode.shapeFlag&32){const m=a._;m?(br(d,a),fM(d,"_",m,!0)):QM(a,d)}else a&&eS(c,a)},hD=(c,a,d)=>{const{vnode:m,slots:x}=c;let T=!0,E=kn;if(m.shapeFlag&32){const P=a._;P?d&&P===1?T=!1:(br(x,a),!d&&P===1&&delete x._):(T=!a.$stable,QM(a,x)),E=a}else a&&(eS(c,a),E={default:1});if(T)for(const P in x)!JM(P)&&E[P]==null&&delete x[P]};function f0(c,a,d,m,x=!1){if(Li(c)){c.forEach((ae,ue)=>f0(ae,a&&(Li(a)?a[ue]:a),d,m,x));return}if(r_(m)&&!x)return;const T=m.shapeFlag&4?V_(m.component)||m.component.proxy:m.el,E=x?null:T,{i:P,r:s}=c,B=a&&a.r,q=P.refs===kn?P.refs={}:P.refs,Z=P.setupState;if(B!=null&&B!==s&&(wr(B)?(q[B]=null,dn(Z,B)&&(Z[B]=null)):ys(B)&&(B.value=null)),Wi(s))gl(s,P,12,[E,q]);else{const ae=wr(s),ue=ys(s);if(ae||ue){const Le=()=>{if(c.f){const Ae=ae?dn(Z,s)?Z[s]:q[s]:s.value;x?Li(Ae)&&P0(Ae,T):Li(Ae)?Ae.includes(T)||Ae.push(T):ae?(q[s]=[T],dn(Z,s)&&(Z[s]=q[s])):(s.value=[T],c.k&&(q[c.k]=s.value))}else ae?(q[s]=E,dn(Z,s)&&(Z[s]=E)):ue&&(s.value=E,c.k&&(q[c.k]=E))};E?(Le.id=-1,fs(Le,d)):Le()}}}const fs=RP;function dD(c){return fD(c)}function fD(c,a){const d=pM();d.__VUE__=!0;const{insert:m,remove:x,patchProp:T,createElement:E,createText:P,createComment:s,setText:B,setElementText:q,parentNode:Z,nextSibling:ae,setScopeId:ue=$s,insertStaticContent:Le}=c,Ae=(ge,be,Xe,ft=null,ut=null,St=null,Vt=void 0,pt=null,Ot=!!be.dynamicChildren)=>{if(ge===be)return;ge&&!rf(ge,be)&&(ft=Os(ge),Qi(ge,ut,St,!0),ge=null),be.patchFlag===-2&&(Ot=!1,be.dynamicChildren=null);const{type:xt,ref:jt,shapeFlag:ii}=be;switch(xt){case B_:Oe(ge,be,Xe,ft);break;case kc:We(ge,be,Xe,ft);break;case Vy:ge==null&&ct(be,Xe,ft,Vt);break;case zs:Zt(ge,be,Xe,ft,ut,St,Vt,pt,Ot);break;default:ii&1?Rt(ge,be,Xe,ft,ut,St,Vt,pt,Ot):ii&6?sn(ge,be,Xe,ft,ut,St,Vt,pt,Ot):(ii&64||ii&128)&&xt.process(ge,be,Xe,ft,ut,St,Vt,pt,Ot,Fn)}jt!=null&&ut&&f0(jt,ge&&ge.ref,St,be||ge,!be)},Oe=(ge,be,Xe,ft)=>{if(ge==null)m(be.el=P(be.children),Xe,ft);else{const ut=be.el=ge.el;be.children!==ge.children&&B(ut,be.children)}},We=(ge,be,Xe,ft)=>{ge==null?m(be.el=s(be.children||""),Xe,ft):be.el=ge.el},ct=(ge,be,Xe,ft)=>{[ge.el,ge.anchor]=Le(ge.children,be,Xe,ft,ge.el,ge.anchor)},gt=({el:ge,anchor:be},Xe,ft)=>{let ut;for(;ge&&ge!==be;)ut=ae(ge),m(ge,Xe,ft),ge=ut;m(be,Xe,ft)},Lt=({el:ge,anchor:be})=>{let Xe;for(;ge&&ge!==be;)Xe=ae(ge),x(ge),ge=Xe;x(be)},Rt=(ge,be,Xe,ft,ut,St,Vt,pt,Ot)=>{be.type==="svg"?Vt="svg":be.type==="math"&&(Vt="mathml"),ge==null?Wt(be,Xe,ft,ut,St,Vt,pt,Ot):$e(ge,be,ut,St,Vt,pt,Ot)},Wt=(ge,be,Xe,ft,ut,St,Vt,pt)=>{let Ot,xt;const{props:jt,shapeFlag:ii,transition:Qt,dirs:Me}=ge;if(Ot=ge.el=E(ge.type,St,jt&&jt.is,jt),ii&8?q(Ot,ge.children):ii&16&&bi(ge.children,Ot,null,ft,ut,Ny(ge,St),Vt,pt),Me&&vc(ge,null,ft,"created"),ui(Ot,ge,ge.scopeId,Vt,ft),jt){for(const re in jt)re!=="value"&&!gf(re)&&T(Ot,re,null,jt[re],St,ge.children,ft,ut,On);"value"in jt&&T(Ot,"value",null,jt.value,St),(xt=jt.onVnodeBeforeMount)&&Bo(xt,ft,ge)}Me&&vc(ge,null,ft,"beforeMount");const X=pD(ut,Qt);X&&Qt.beforeEnter(Ot),m(Ot,be,Xe),((xt=jt&&jt.onVnodeMounted)||X||Me)&&fs(()=>{xt&&Bo(xt,ft,ge),X&&Qt.enter(Ot),Me&&vc(ge,null,ft,"mounted")},ut)},ui=(ge,be,Xe,ft,ut)=>{if(Xe&&ue(ge,Xe),ft)for(let St=0;St<ft.length;St++)ue(ge,ft[St]);if(ut){let St=ut.subTree;if(be===St){const Vt=ut.vnode;ui(ge,Vt,Vt.scopeId,Vt.slotScopeIds,ut.parent)}}},bi=(ge,be,Xe,ft,ut,St,Vt,pt,Ot=0)=>{for(let xt=Ot;xt<ge.length;xt++){const jt=ge[xt]=pt?ul(ge[xt]):jo(ge[xt]);Ae(null,jt,be,Xe,ft,ut,St,Vt,pt)}},$e=(ge,be,Xe,ft,ut,St,Vt)=>{const pt=be.el=ge.el;let{patchFlag:Ot,dynamicChildren:xt,dirs:jt}=be;Ot|=ge.patchFlag&16;const ii=ge.props||kn,Qt=be.props||kn;let Me;if(Xe&&bc(Xe,!1),(Me=Qt.onVnodeBeforeUpdate)&&Bo(Me,Xe,be,ge),jt&&vc(be,ge,Xe,"beforeUpdate"),Xe&&bc(Xe,!0),xt?Ji(ge.dynamicChildren,xt,pt,Xe,ft,Ny(be,ut),St):Vt||kt(ge,be,pt,null,Xe,ft,Ny(be,ut),St,!1),Ot>0){if(Ot&16)un(pt,be,ii,Qt,Xe,ft,ut);else if(Ot&2&&ii.class!==Qt.class&&T(pt,"class",null,Qt.class,ut),Ot&4&&T(pt,"style",ii.style,Qt.style,ut),Ot&8){const X=be.dynamicProps;for(let re=0;re<X.length;re++){const de=X[re],Pe=ii[de],Ne=Qt[de];(Ne!==Pe||de==="value")&&T(pt,de,Pe,Ne,ut,ge.children,Xe,ft,On)}}Ot&1&&ge.children!==be.children&&q(pt,be.children)}else!Vt&&xt==null&&un(pt,be,ii,Qt,Xe,ft,ut);((Me=Qt.onVnodeUpdated)||jt)&&fs(()=>{Me&&Bo(Me,Xe,be,ge),jt&&vc(be,ge,Xe,"updated")},ft)},Ji=(ge,be,Xe,ft,ut,St,Vt)=>{for(let pt=0;pt<be.length;pt++){const Ot=ge[pt],xt=be[pt],jt=Ot.el&&(Ot.type===zs||!rf(Ot,xt)||Ot.shapeFlag&70)?Z(Ot.el):Xe;Ae(Ot,xt,jt,null,ft,ut,St,Vt,!0)}},un=(ge,be,Xe,ft,ut,St,Vt)=>{if(Xe!==ft){if(Xe!==kn)for(const pt in Xe)!gf(pt)&&!(pt in ft)&&T(ge,pt,Xe[pt],null,Vt,be.children,ut,St,On);for(const pt in ft){if(gf(pt))continue;const Ot=ft[pt],xt=Xe[pt];Ot!==xt&&pt!=="value"&&T(ge,pt,xt,Ot,Vt,be.children,ut,St,On)}"value"in ft&&T(ge,"value",Xe.value,ft.value,Vt)}},Zt=(ge,be,Xe,ft,ut,St,Vt,pt,Ot)=>{const xt=be.el=ge?ge.el:P(""),jt=be.anchor=ge?ge.anchor:P("");let{patchFlag:ii,dynamicChildren:Qt,slotScopeIds:Me}=be;Me&&(pt=pt?pt.concat(Me):Me),ge==null?(m(xt,Xe,ft),m(jt,Xe,ft),bi(be.children||[],Xe,jt,ut,St,Vt,pt,Ot)):ii>0&&ii&64&&Qt&&ge.dynamicChildren?(Ji(ge.dynamicChildren,Qt,Xe,ut,St,Vt,pt),(be.key!=null||ut&&be===ut.subTree)&&tS(ge,be,!0)):kt(ge,be,Xe,jt,ut,St,Vt,pt,Ot)},sn=(ge,be,Xe,ft,ut,St,Vt,pt,Ot)=>{be.slotScopeIds=pt,ge==null?be.shapeFlag&512?ut.ctx.activate(be,Xe,ft,Vt,Ot):xr(be,Xe,ft,ut,St,Vt,Ot):Qe(ge,be,Ot)},xr=(ge,be,Xe,ft,ut,St,Vt)=>{const pt=ge.component=TD(ge,ft,ut);if(jM(ge)&&(pt.ctx.renderer=Fn),SD(pt),pt.asyncDep){if(ut&&ut.registerDep(pt,Ri),!ge.el){const Ot=pt.subTree=nr(kc);We(null,Ot,be,Xe)}}else Ri(pt,ge,be,Xe,ut,St,Vt)},Qe=(ge,be,Xe)=>{const ft=be.component=ge.component;if(CP(ge,be,Xe))if(ft.asyncDep&&!ft.asyncResolved){gi(ft,be,Xe);return}else ft.next=be,wP(ft.update),ft.effect.dirty=!0,ft.update();else be.el=ge.el,ft.vnode=be},Ri=(ge,be,Xe,ft,ut,St,Vt)=>{const pt=()=>{if(ge.isMounted){let{next:jt,bu:ii,u:Qt,parent:Me,vnode:X}=ge;{const Je=iS(ge);if(Je){jt&&(jt.el=X.el,gi(ge,jt,Vt)),Je.asyncDep.then(()=>{ge.isUnmounted||pt()});return}}let re=jt,de;bc(ge,!1),jt?(jt.el=X.el,gi(ge,jt,Vt)):jt=X,ii&&n_(ii),(de=jt.props&&jt.props.onVnodeBeforeUpdate)&&Bo(de,Me,jt,X),bc(ge,!0);const Pe=Fy(ge),Ne=ge.subTree;ge.subTree=Pe,Ae(Ne,Pe,Z(Ne.el),Os(Ne),ge,ut,St),jt.el=Pe.el,re===null&&PP(ge,Pe.el),Qt&&fs(Qt,ut),(de=jt.props&&jt.props.onVnodeUpdated)&&fs(()=>Bo(de,Me,jt,X),ut)}else{let jt;const{el:ii,props:Qt}=be,{bm:Me,m:X,parent:re}=ge,de=r_(be);if(bc(ge,!1),Me&&n_(Me),!de&&(jt=Qt&&Qt.onVnodeBeforeMount)&&Bo(jt,re,be),bc(ge,!0),ii&&Sr){const Pe=()=>{ge.subTree=Fy(ge),Sr(ii,ge.subTree,ge,ut,null)};de?be.type.__asyncLoader().then(()=>!ge.isUnmounted&&Pe()):Pe()}else{const Pe=ge.subTree=Fy(ge);Ae(null,Pe,Xe,ft,ge,ut,St),be.el=Pe.el}if(X&&fs(X,ut),!de&&(jt=Qt&&Qt.onVnodeMounted)){const Pe=be;fs(()=>Bo(jt,re,Pe),ut)}(be.shapeFlag&256||re&&r_(re.vnode)&&re.vnode.shapeFlag&256)&&ge.a&&fs(ge.a,ut),ge.isMounted=!0,be=Xe=ft=null}},Ot=ge.effect=new z0(pt,$s,()=>G0(xt),ge.scope),xt=ge.update=()=>{Ot.dirty&&Ot.run()};xt.id=ge.uid,bc(ge,!0),xt()},gi=(ge,be,Xe)=>{be.component=ge;const ft=ge.vnode.props;ge.vnode=be,ge.next=null,lD(ge,be.props,ft,Xe),hD(ge,be.children,Xe),wl(),ww(ge),Tl()},kt=(ge,be,Xe,ft,ut,St,Vt,pt,Ot=!1)=>{const xt=ge&&ge.children,jt=ge?ge.shapeFlag:0,ii=be.children,{patchFlag:Qt,shapeFlag:Me}=be;if(Qt>0){if(Qt&128){Kn(xt,ii,Xe,ft,ut,St,Vt,pt,Ot);return}else if(Qt&256){rr(xt,ii,Xe,ft,ut,St,Vt,pt,Ot);return}}Me&8?(jt&16&&On(xt,ut,St),ii!==xt&&q(Xe,ii)):jt&16?Me&16?Kn(xt,ii,Xe,ft,ut,St,Vt,pt,Ot):On(xt,ut,St,!0):(jt&8&&q(Xe,""),Me&16&&bi(ii,Xe,ft,ut,St,Vt,pt,Ot))},rr=(ge,be,Xe,ft,ut,St,Vt,pt,Ot)=>{ge=ge||Wu,be=be||Wu;const xt=ge.length,jt=be.length,ii=Math.min(xt,jt);let Qt;for(Qt=0;Qt<ii;Qt++){const Me=be[Qt]=Ot?ul(be[Qt]):jo(be[Qt]);Ae(ge[Qt],Me,Xe,null,ut,St,Vt,pt,Ot)}xt>jt?On(ge,ut,St,!0,!1,ii):bi(be,Xe,ft,ut,St,Vt,pt,Ot,ii)},Kn=(ge,be,Xe,ft,ut,St,Vt,pt,Ot)=>{let xt=0;const jt=be.length;let ii=ge.length-1,Qt=jt-1;for(;xt<=ii&&xt<=Qt;){const Me=ge[xt],X=be[xt]=Ot?ul(be[xt]):jo(be[xt]);if(rf(Me,X))Ae(Me,X,Xe,null,ut,St,Vt,pt,Ot);else break;xt++}for(;xt<=ii&&xt<=Qt;){const Me=ge[ii],X=be[Qt]=Ot?ul(be[Qt]):jo(be[Qt]);if(rf(Me,X))Ae(Me,X,Xe,null,ut,St,Vt,pt,Ot);else break;ii--,Qt--}if(xt>ii){if(xt<=Qt){const Me=Qt+1,X=Me<jt?be[Me].el:ft;for(;xt<=Qt;)Ae(null,be[xt]=Ot?ul(be[xt]):jo(be[xt]),Xe,X,ut,St,Vt,pt,Ot),xt++}}else if(xt>Qt)for(;xt<=ii;)Qi(ge[xt],ut,St,!0),xt++;else{const Me=xt,X=xt,re=new Map;for(xt=X;xt<=Qt;xt++){const ht=be[xt]=Ot?ul(be[xt]):jo(be[xt]);ht.key!=null&&re.set(ht.key,xt)}let de,Pe=0;const Ne=Qt-X+1;let Je=!1,Et=0;const Be=new Array(Ne);for(xt=0;xt<Ne;xt++)Be[xt]=0;for(xt=Me;xt<=ii;xt++){const ht=ge[xt];if(Pe>=Ne){Qi(ht,ut,St,!0);continue}let Tt;if(ht.key!=null)Tt=re.get(ht.key);else for(de=X;de<=Qt;de++)if(Be[de-X]===0&&rf(ht,be[de])){Tt=de;break}Tt===void 0?Qi(ht,ut,St,!0):(Be[Tt-X]=xt+1,Tt>=Et?Et=Tt:Je=!0,Ae(ht,be[Tt],Xe,null,ut,St,Vt,pt,Ot),Pe++)}const Ct=Je?mD(Be):Wu;for(de=Ct.length-1,xt=Ne-1;xt>=0;xt--){const ht=X+xt,Tt=be[ht],hi=ht+1<jt?be[ht+1].el:ft;Be[xt]===0?Ae(null,Tt,Xe,hi,ut,St,Vt,pt,Ot):Je&&(de<0||xt!==Ct[de]?Rn(Tt,Xe,hi,2):de--)}}},Rn=(ge,be,Xe,ft,ut=null)=>{const{el:St,type:Vt,transition:pt,children:Ot,shapeFlag:xt}=ge;if(xt&6){Rn(ge.component.subTree,be,Xe,ft);return}if(xt&128){ge.suspense.move(be,Xe,ft);return}if(xt&64){Vt.move(ge,be,Xe,Fn);return}if(Vt===zs){m(St,be,Xe);for(let ii=0;ii<Ot.length;ii++)Rn(Ot[ii],be,Xe,ft);m(ge.anchor,be,Xe);return}if(Vt===Vy){gt(ge,be,Xe);return}if(ft!==2&&xt&1&&pt)if(ft===0)pt.beforeEnter(St),m(St,be,Xe),fs(()=>pt.enter(St),ut);else{const{leave:ii,delayLeave:Qt,afterLeave:Me}=pt,X=()=>m(St,be,Xe),re=()=>{ii(St,()=>{X(),Me&&Me()})};Qt?Qt(St,X,re):re()}else m(St,be,Xe)},Qi=(ge,be,Xe,ft=!1,ut=!1)=>{const{type:St,props:Vt,ref:pt,children:Ot,dynamicChildren:xt,shapeFlag:jt,patchFlag:ii,dirs:Qt}=ge;if(pt!=null&&f0(pt,null,Xe,ge,!0),jt&256){be.ctx.deactivate(ge);return}const Me=jt&1&&Qt,X=!r_(ge);let re;if(X&&(re=Vt&&Vt.onVnodeBeforeUnmount)&&Bo(re,be,ge),jt&6)Hr(ge.component,Xe,ft);else{if(jt&128){ge.suspense.unmount(Xe,ft);return}Me&&vc(ge,null,be,"beforeUnmount"),jt&64?ge.type.remove(ge,be,Xe,ut,Fn,ft):xt&&(St!==zs||ii>0&&ii&64)?On(xt,be,Xe,!1,!0):(St===zs&&ii&384||!ut&&jt&16)&&On(Ot,be,Xe),ft&&Tr(ge)}(X&&(re=Vt&&Vt.onVnodeUnmounted)||Me)&&fs(()=>{re&&Bo(re,be,ge),Me&&vc(ge,null,be,"unmounted")},Xe)},Tr=ge=>{const{type:be,el:Xe,anchor:ft,transition:ut}=ge;if(be===zs){Mr(Xe,ft);return}if(be===Vy){Lt(ge);return}const St=()=>{x(Xe),ut&&!ut.persisted&&ut.afterLeave&&ut.afterLeave()};if(ge.shapeFlag&1&&ut&&!ut.persisted){const{leave:Vt,delayLeave:pt}=ut,Ot=()=>Vt(Xe,St);pt?pt(ge.el,St,Ot):Ot()}else St()},Mr=(ge,be)=>{let Xe;for(;ge!==be;)Xe=ae(ge),x(ge),ge=Xe;x(be)},Hr=(ge,be,Xe)=>{const{bum:ft,scope:ut,update:St,subTree:Vt,um:pt}=ge;ft&&n_(ft),ut.stop(),St&&(St.active=!1,Qi(Vt,ge,be,Xe)),pt&&fs(pt,be),fs(()=>{ge.isUnmounted=!0},be),be&&be.pendingBranch&&!be.isUnmounted&&ge.asyncDep&&!ge.asyncResolved&&ge.suspenseId===be.pendingId&&(be.deps--,be.deps===0&&be.resolve())},On=(ge,be,Xe,ft=!1,ut=!1,St=0)=>{for(let Vt=St;Vt<ge.length;Vt++)Qi(ge[Vt],be,Xe,ft,ut)},Os=ge=>ge.shapeFlag&6?Os(ge.component.subTree):ge.shapeFlag&128?ge.suspense.next():ae(ge.anchor||ge.el);let xs=!1;const is=(ge,be,Xe)=>{ge==null?be._vnode&&Qi(be._vnode,null,null,!0):Ae(be._vnode||null,ge,be,null,null,null,Xe),xs||(xs=!0,ww(),OM(),xs=!1),be._vnode=ge},Fn={p:Ae,um:Qi,m:Rn,r:Tr,mt:xr,mc:bi,pc:kt,pbc:Ji,n:Os,o:c};let Pr,Sr;return{render:is,hydrate:Pr,createApp:sD(is,Pr)}}function Ny({type:c,props:a},d){return d==="svg"&&c==="foreignObject"||d==="mathml"&&c==="annotation-xml"&&a&&a.encoding&&a.encoding.includes("html")?void 0:d}function bc({effect:c,update:a},d){c.allowRecurse=a.allowRecurse=d}function pD(c,a){return(!c||c&&!c.pendingBranch)&&a&&!a.persisted}function tS(c,a,d=!1){const m=c.children,x=a.children;if(Li(m)&&Li(x))for(let T=0;T<m.length;T++){const E=m[T];let P=x[T];P.shapeFlag&1&&!P.dynamicChildren&&((P.patchFlag<=0||P.patchFlag===32)&&(P=x[T]=ul(x[T]),P.el=E.el),d||tS(E,P)),P.type===B_&&(P.el=E.el)}}function mD(c){const a=c.slice(),d=[0];let m,x,T,E,P;const s=c.length;for(m=0;m<s;m++){const B=c[m];if(B!==0){if(x=d[d.length-1],c[x]<B){a[m]=x,d.push(m);continue}for(T=0,E=d.length-1;T<E;)P=T+E>>1,c[d[P]]<B?T=P+1:E=P;B<c[d[T]]&&(T>0&&(a[m]=d[T-1]),d[T]=m)}}for(T=d.length,E=d[T-1];T-- >0;)d[T]=E,E=a[E];return d}function iS(c){const a=c.subTree.component;if(a)return a.asyncDep&&!a.asyncResolved?a:iS(a)}const _D=c=>c.__isTeleport,zs=Symbol.for("v-fgt"),B_=Symbol.for("v-txt"),kc=Symbol.for("v-cmt"),Vy=Symbol.for("v-stc"),wf=[];let co=null;function Gs(c=!1){wf.push(co=c?null:[])}function gD(){wf.pop(),co=wf[wf.length-1]||null}let Df=1;function Dw(c){Df+=c}function nS(c){return c.dynamicChildren=Df>0?co||Wu:null,gD(),Df>0&&co&&co.push(c),c}function $o(c,a,d,m,x,T){return nS(Qr(c,a,d,m,x,T,!0))}function rS(c,a,d,m,x){return nS(nr(c,a,d,m,x,!0))}function p0(c){return c?c.__v_isVNode===!0:!1}function rf(c,a){return c.type===a.type&&c.key===a.key}const sS=({key:c})=>c??null,o_=({ref:c,ref_key:a,ref_for:d})=>(typeof c=="number"&&(c=""+c),c!=null?wr(c)||ys(c)||Wi(c)?{i:ms,r:c,k:a,f:!!d}:c:null);function Qr(c,a=null,d=null,m=0,x=null,T=c===zs?0:1,E=!1,P=!1){const s={__v_isVNode:!0,__v_skip:!0,type:c,props:a,key:a&&sS(a),ref:a&&o_(a),scopeId:NM,slotScopeIds:null,children:d,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:T,patchFlag:m,dynamicProps:x,dynamicChildren:null,appContext:null,ctx:ms};return P?(Z0(s,d),T&128&&c.normalize(s)):d&&(s.shapeFlag|=wr(d)?8:16),Df>0&&!E&&co&&(s.patchFlag>0||T&6)&&s.patchFlag!==32&&co.push(s),s}const nr=yD;function yD(c,a=null,d=null,m=0,x=null,T=!1){if((!c||c===DP)&&(c=kc),p0(c)){const P=Ju(c,a,!0);return d&&Z0(P,d),Df>0&&!T&&co&&(P.shapeFlag&6?co[co.indexOf(c)]=P:co.push(P)),P.patchFlag|=-2,P}if(CD(c)&&(c=c.__vccOpts),a){a=xD(a);let{class:P,style:s}=a;P&&!wr(P)&&(a.class=R0(P)),Wn(s)&&(z_(s)&&!Li(s)&&(s=br({},s)),a.style=L0(s))}const E=wr(c)?1:LP(c)?128:_D(c)?64:Wn(c)?4:Wi(c)?2:0;return Qr(c,a,d,m,x,E,T,!0)}function xD(c){return c?z_(c)||XM(c)?br({},c):c:null}function Ju(c,a,d=!1,m=!1){const{props:x,ref:T,patchFlag:E,children:P,transition:s}=c,B=a?vD(x||{},a):x,q={__v_isVNode:!0,__v_skip:!0,type:c.type,props:B,key:B&&sS(B),ref:a&&a.ref?d&&T?Li(T)?T.concat(o_(a)):[T,o_(a)]:o_(a):T,scopeId:c.scopeId,slotScopeIds:c.slotScopeIds,children:P,target:c.target,targetAnchor:c.targetAnchor,staticCount:c.staticCount,shapeFlag:c.shapeFlag,patchFlag:a&&c.type!==zs?E===-1?16:E|16:E,dynamicProps:c.dynamicProps,dynamicChildren:c.dynamicChildren,appContext:c.appContext,dirs:c.dirs,transition:s,component:c.component,suspense:c.suspense,ssContent:c.ssContent&&Ju(c.ssContent),ssFallback:c.ssFallback&&Ju(c.ssFallback),el:c.el,anchor:c.anchor,ctx:c.ctx,ce:c.ce};return s&&m&&(q.transition=s.clone(q)),q}function df(c=" ",a=0){return nr(B_,null,c,a)}function Uy(c="",a=!1){return a?(Gs(),rS(kc,null,c)):nr(kc,null,c)}function jo(c){return c==null||typeof c=="boolean"?nr(kc):Li(c)?nr(zs,null,c.slice()):typeof c=="object"?ul(c):nr(B_,null,String(c))}function ul(c){return c.el===null&&c.patchFlag!==-1||c.memo?c:Ju(c)}function Z0(c,a){let d=0;const{shapeFlag:m}=c;if(a==null)a=null;else if(Li(a))d=16;else if(typeof a=="object")if(m&65){const x=a.default;x&&(x._c&&(x._d=!1),Z0(c,x()),x._c&&(x._d=!0));return}else{d=32;const x=a._;!x&&!XM(a)?a._ctx=ms:x===3&&ms&&(ms.slots._===1?a._=1:(a._=2,c.patchFlag|=1024))}else Wi(a)?(a={default:a,_ctx:ms},d=32):(a=String(a),m&64?(d=16,a=[df(a)]):d=8);c.children=a,c.shapeFlag|=d}function vD(...c){const a={};for(let d=0;d<c.length;d++){const m=c[d];for(const x in m)if(x==="class")a.class!==m.class&&(a.class=R0([a.class,m.class]));else if(x==="style")a.style=L0([a.style,m.style]);else if(C_(x)){const T=a[x],E=m[x];E&&T!==E&&!(Li(T)&&T.includes(E))&&(a[x]=T?[].concat(T,E):E)}else x!==""&&(a[x]=m[x])}return a}function Bo(c,a,d,m=null){fo(c,a,7,[d,m])}const bD=HM();let wD=0;function TD(c,a,d){const m=c.type,x=(a?a.appContext:c.appContext)||bD,T={uid:wD++,vnode:c,type:m,parent:a,appContext:x,root:null,next:null,subTree:null,effect:null,update:null,scope:new qC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:a?a.provides:Object.create(x.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:KM(m,x),emitsOptions:BM(m,x),emit:null,emitted:null,propsDefaults:kn,inheritAttrs:m.inheritAttrs,ctx:kn,data:kn,props:kn,attrs:kn,slots:kn,refs:kn,setupState:kn,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:d,suspenseId:d?d.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return T.ctx={_:T},T.root=a?a.root:T,T.emit=SP.bind(null,T),c.ce&&c.ce(T),T}let qr=null;const MD=()=>qr||ms;let y_,m0;{const c=pM(),a=(d,m)=>{let x;return(x=c[d])||(x=c[d]=[]),x.push(m),T=>{x.length>1?x.forEach(E=>E(T)):x[0](T)}};y_=a("__VUE_INSTANCE_SETTERS__",d=>qr=d),m0=a("__VUE_SSR_SETTERS__",d=>N_=d)}const Bf=c=>{const a=qr;return y_(c),c.scope.on(),()=>{c.scope.off(),y_(a)}},Lw=()=>{qr&&qr.scope.off(),y_(null)};function oS(c){return c.vnode.shapeFlag&4}let N_=!1;function SD(c,a=!1){a&&m0(a);const{props:d,children:m}=c.vnode,x=oS(c);aD(c,d,x,a),uD(c,m);const T=x?ED(c,a):void 0;return a&&m0(!1),T}function ED(c,a){const d=c.type;c.accessCache=Object.create(null),c.proxy=new Proxy(c.ctx,KP);const{setup:m}=d;if(m){const x=c.setupContext=m.length>1?ID(c):null,T=Bf(c);wl();const E=gl(m,c,0,[c.props,x]);if(Tl(),T(),cM(E)){if(E.then(Lw,Lw),a)return E.then(P=>{Rw(c,P,a)}).catch(P=>{k_(P,c,0)});c.asyncDep=E}else Rw(c,E,a)}else aS(c,a)}function Rw(c,a,d){Wi(a)?c.type.__ssrInlineRender?c.ssrRender=a:c.render=a:Wn(a)&&(c.setupState=LM(a)),aS(c,d)}let zw;function aS(c,a,d){const m=c.type;if(!c.render){if(!a&&zw&&!m.render){const x=m.template||H0(c).template;if(x){const{isCustomElement:T,compilerOptions:E}=c.appContext.config,{delimiters:P,compilerOptions:s}=m,B=br(br({isCustomElement:T,delimiters:P},E),s);m.render=zw(x,B)}}c.render=m.render||$s}{const x=Bf(c);wl();try{QP(c)}finally{Tl(),x()}}}const AD={get(c,a){return gs(c,"get",""),c[a]}};function ID(c){const a=d=>{c.exposed=d||{}};return{attrs:new Proxy(c.attrs,AD),slots:c.slots,emit:c.emit,expose:a}}function V_(c){if(c.exposed)return c.exposeProxy||(c.exposeProxy=new Proxy(LM(pP(c.exposed)),{get(a,d){if(d in a)return a[d];if(d in vf)return vf[d](c)},has(a,d){return d in a||d in vf}}))}function CD(c){return Wi(c)&&"__vccOpts"in c}const PD=(c,a)=>mP(c,a,N_);function DD(c,a,d=kn){const m=MD(),x=zc(a),T=Bc(a),E=xP((s,B)=>{let q;return OP(()=>{const Z=c[a];qo(q,Z)&&(q=Z,B())}),{get(){return s(),d.get?d.get(q):q},set(Z){const ae=m.vnode.props;!(ae&&(a in ae||x in ae||T in ae)&&(`onUpdate:${a}`in ae||`onUpdate:${x}`in ae||`onUpdate:${T}`in ae))&&qo(Z,q)&&(q=Z,B()),m.emit(`update:${a}`,d.set?d.set(Z):Z)}}}),P="modelModifiers";return E[Symbol.iterator]=()=>{let s=0;return{next(){return s<2?{value:s++?c[P]||{}:E,done:!1}:{done:!0}}}},E}function _0(c,a,d){const m=arguments.length;return m===2?Wn(a)&&!Li(a)?p0(a)?nr(c,null,[a]):nr(c,a):nr(c,null,a):(m>3?d=Array.prototype.slice.call(arguments,2):m===3&&p0(d)&&(d=[d]),nr(c,a,d))}const lS="3.4.27";/**
* @vue/runtime-dom v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const LD="http://www.w3.org/2000/svg",RD="http://www.w3.org/1998/Math/MathML",hl=typeof document<"u"?document:null,kw=hl&&hl.createElement("template"),zD={insert:(c,a,d)=>{a.insertBefore(c,d||null)},remove:c=>{const a=c.parentNode;a&&a.removeChild(c)},createElement:(c,a,d,m)=>{const x=a==="svg"?hl.createElementNS(LD,c):a==="mathml"?hl.createElementNS(RD,c):hl.createElement(c,d?{is:d}:void 0);return c==="select"&&m&&m.multiple!=null&&x.setAttribute("multiple",m.multiple),x},createText:c=>hl.createTextNode(c),createComment:c=>hl.createComment(c),setText:(c,a)=>{c.nodeValue=a},setElementText:(c,a)=>{c.textContent=a},parentNode:c=>c.parentNode,nextSibling:c=>c.nextSibling,querySelector:c=>hl.querySelector(c),setScopeId(c,a){c.setAttribute(a,"")},insertStaticContent(c,a,d,m,x,T){const E=d?d.previousSibling:a.lastChild;if(x&&(x===T||x.nextSibling))for(;a.insertBefore(x.cloneNode(!0),d),!(x===T||!(x=x.nextSibling)););else{kw.innerHTML=m==="svg"?`<svg>${c}</svg>`:m==="mathml"?`<math>${c}</math>`:c;const P=kw.content;if(m==="svg"||m==="mathml"){const s=P.firstChild;for(;s.firstChild;)P.appendChild(s.firstChild);P.removeChild(s)}a.insertBefore(P,d)}return[E?E.nextSibling:a.firstChild,d?d.previousSibling:a.lastChild]}},kD=Symbol("_vtc");function OD(c,a,d){const m=c[kD];m&&(a=(a?[a,...m]:[...m]).join(" ")),a==null?c.removeAttribute("class"):d?c.setAttribute("class",a):c.className=a}const Ow=Symbol("_vod"),FD=Symbol("_vsh"),BD=Symbol(""),ND=/(^|;)\s*display\s*:/;function VD(c,a,d){const m=c.style,x=wr(d);let T=!1;if(d&&!x){if(a)if(wr(a))for(const E of a.split(";")){const P=E.slice(0,E.indexOf(":")).trim();d[P]==null&&a_(m,P,"")}else for(const E in a)d[E]==null&&a_(m,E,"");for(const E in d)E==="display"&&(T=!0),a_(m,E,d[E])}else if(x){if(a!==d){const E=m[BD];E&&(d+=";"+E),m.cssText=d,T=ND.test(d)}}else a&&c.removeAttribute("style");Ow in c&&(c[Ow]=T?m.display:"",c[FD]&&(m.display="none"))}const Fw=/\s*!important$/;function a_(c,a,d){if(Li(d))d.forEach(m=>a_(c,a,m));else if(d==null&&(d=""),a.startsWith("--"))c.setProperty(a,d);else{const m=UD(c,a);Fw.test(d)?c.setProperty(Bc(m),d.replace(Fw,""),"important"):c[m]=d}}const Bw=["Webkit","Moz","ms"],jy={};function UD(c,a){const d=jy[a];if(d)return d;let m=zc(a);if(m!=="filter"&&m in c)return jy[a]=m;m=dM(m);for(let x=0;x<Bw.length;x++){const T=Bw[x]+m;if(T in c)return jy[a]=T}return a}const Nw="http://www.w3.org/1999/xlink";function jD(c,a,d,m,x){if(m&&a.startsWith("xlink:"))d==null?c.removeAttributeNS(Nw,a.slice(6,a.length)):c.setAttributeNS(Nw,a,d);else{const T=$C(a);d==null||T&&!mM(d)?c.removeAttribute(a):c.setAttribute(a,T?"":d)}}function GD(c,a,d,m,x,T,E){if(a==="innerHTML"||a==="textContent"){m&&E(m,x,T),c[a]=d??"";return}const P=c.tagName;if(a==="value"&&P!=="PROGRESS"&&!P.includes("-")){const B=P==="OPTION"?c.getAttribute("value")||"":c.value,q=d??"";(B!==q||!("_value"in c))&&(c.value=q),d==null&&c.removeAttribute(a),c._value=d;return}let s=!1;if(d===""||d==null){const B=typeof c[a];B==="boolean"?d=mM(d):d==null&&B==="string"?(d="",s=!0):B==="number"&&(d=0,s=!0)}try{c[a]=d}catch{}s&&c.removeAttribute(a)}function qu(c,a,d,m){c.addEventListener(a,d,m)}function $D(c,a,d,m){c.removeEventListener(a,d,m)}const Vw=Symbol("_vei");function qD(c,a,d,m,x=null){const T=c[Vw]||(c[Vw]={}),E=T[a];if(m&&E)E.value=m;else{const[P,s]=HD(a);if(m){const B=T[a]=XD(m,x);qu(c,P,B,s)}else E&&($D(c,P,E,s),T[a]=void 0)}}const Uw=/(?:Once|Passive|Capture)$/;function HD(c){let a;if(Uw.test(c)){a={};let m;for(;m=c.match(Uw);)c=c.slice(0,c.length-m[0].length),a[m[0].toLowerCase()]=!0}return[c[2]===":"?c.slice(3):Bc(c.slice(2)),a]}let Gy=0;const WD=Promise.resolve(),ZD=()=>Gy||(WD.then(()=>Gy=0),Gy=Date.now());function XD(c,a){const d=m=>{if(!m._vts)m._vts=Date.now();else if(m._vts<=d.attached)return;fo(YD(m,d.value),a,5,[m])};return d.value=c,d.attached=ZD(),d}function YD(c,a){if(Li(a)){const d=c.stopImmediatePropagation;return c.stopImmediatePropagation=()=>{d.call(c),c._stopped=!0},a.map(m=>x=>!x._stopped&&m&&m(x))}else return a}const jw=c=>c.charCodeAt(0)===111&&c.charCodeAt(1)===110&&c.charCodeAt(2)>96&&c.charCodeAt(2)<123,KD=(c,a,d,m,x,T,E,P,s)=>{const B=x==="svg";a==="class"?OD(c,m,B):a==="style"?VD(c,d,m):C_(a)?C0(a)||qD(c,a,d,m,E):(a[0]==="."?(a=a.slice(1),!0):a[0]==="^"?(a=a.slice(1),!1):JD(c,a,m,B))?GD(c,a,m,T,E,P,s):(a==="true-value"?c._trueValue=m:a==="false-value"&&(c._falseValue=m),jD(c,a,m,B))};function JD(c,a,d,m){if(m)return!!(a==="innerHTML"||a==="textContent"||a in c&&jw(a)&&Wi(d));if(a==="spellcheck"||a==="draggable"||a==="translate"||a==="form"||a==="list"&&c.tagName==="INPUT"||a==="type"&&c.tagName==="TEXTAREA")return!1;if(a==="width"||a==="height"){const x=c.tagName;if(x==="IMG"||x==="VIDEO"||x==="CANVAS"||x==="SOURCE")return!1}return jw(a)&&wr(d)?!1:a in c}const Gw=c=>{const a=c.props["onUpdate:modelValue"]||!1;return Li(a)?d=>n_(a,d):a};function QD(c){c.target.composing=!0}function $w(c){const a=c.target;a.composing&&(a.composing=!1,a.dispatchEvent(new Event("input")))}const $y=Symbol("_assign"),eL={created(c,{modifiers:{lazy:a,trim:d,number:m}},x){c[$y]=Gw(x);const T=m||x.props&&x.props.type==="number";qu(c,a?"change":"input",E=>{if(E.target.composing)return;let P=c.value;d&&(P=P.trim()),T&&(P=n0(P)),c[$y](P)}),d&&qu(c,"change",()=>{c.value=c.value.trim()}),a||(qu(c,"compositionstart",QD),qu(c,"compositionend",$w),qu(c,"change",$w))},mounted(c,{value:a}){c.value=a??""},beforeUpdate(c,{value:a,modifiers:{lazy:d,trim:m,number:x}},T){if(c[$y]=Gw(T),c.composing)return;const E=(x||c.type==="number")&&!/^0\d/.test(c.value)?n0(c.value):c.value,P=a??"";E!==P&&(document.activeElement===c&&c.type!=="range"&&(d||m&&c.value.trim()===P)||(c.value=P))}},tL=br({patchProp:KD},zD);let qw;function iL(){return qw||(qw=dD(tL))}const nL=(...c)=>{const a=iL().createApp(...c),{mount:d}=a;return a.mount=m=>{const x=sL(m);if(!x)return;const T=a._component;!Wi(T)&&!T.render&&!T.template&&(T.template=x.innerHTML),x.innerHTML="";const E=d(x,!1,rL(x));return x instanceof Element&&(x.removeAttribute("v-cloak"),x.setAttribute("data-v-app","")),E},a};function rL(c){if(c instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&c instanceof MathMLElement)return"mathml"}function sL(c){return wr(c)?document.querySelector(c):c}var oL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aL(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var cS={exports:{}};(function(c,a){var d={};(function(m,x){c.exports=x()})(oL,function(){var m,x,T;function E(s,B){if(!m)m=B;else if(!x)x=B;else{var q="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+m+")(sharedChunk); ("+x+")(sharedChunk); self.onerror = null;",Z={};m(Z),T=B(Z),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(T.workerUrl=window.URL.createObjectURL(new Blob([q],{type:"text/javascript"})))}}E(["exports"],function(s){var B="3.3.0";let q;const Z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(q==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{q=d.API_URL_REGEX!=null?new RegExp(d.API_URL_REGEX):t}catch{q=t}}return q},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Z.API_URL)return null;try{const t=new URL(Z.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function ae(t){return Z.API_URL_REGEX.test(t)}function ue(t){return t.indexOf("mapbox:")===0}function Le(t){return Z.API_CDN_URL_REGEX.test(t)}function Ae(t){return Z.API_SPRITE_REGEX.test(t)}function Oe(t){return Z.API_STYLE_REGEX.test(t)&&!Ae(t)}const We={create:"create",load:"load",fullLoad:"fullLoad"};function ct(t){const e=t.name.split("?")[0];return Le(e)&&e.includes("mapbox-gl.js")?"javascript":Le(e)&&e.includes("mapbox-gl.css")?"css":function(i){return Z.API_FONTS_REGEX.test(i)}(e)?"fontRange":Ae(e)?"sprite":Oe(e)?"style":function(i){return Z.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function gt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Lt=Rt;function Rt(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}Rt.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var l=this.sampleCurveX(i)-t;if(Math.abs(l)<e)return i;var u=this.sampleCurveDerivativeX(i);if(Math.abs(u)<1e-6)break;i-=l/u}var p=0,g=1;for(i=t,r=0;r<20&&(l=this.sampleCurveX(i),!(Math.abs(l-t)<e));r++)t>l?p=i:g=i,i=.5*(g-p)+p;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Wt=gt(Lt),ui=bi;function bi(t,e){this.x=t,this.y=e}bi.prototype={clone:function(){return new bi(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),l=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},bi.convert=function(t){return t instanceof bi?t:Array.isArray(t)?new bi(t[0],t[1]):t};var $e=gt(ui);const Ji=Math.PI/180,un=180/Math.PI;function Zt(t){return t*Ji}function sn(t){return t*un}const xr=[[0,0],[1,0],[1,1],[0,1]];function Qe(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Ri(t,e,i,r){const l=new Wt(t,e,i,r);return function(u){return l.solve(u)}}const gi=Ri(.25,.1,.25,1);function kt(t,e,i){return Math.min(i,Math.max(e,t))}function rr(t,e,i){return(i=kt((i-t)/(e-t),0,1))*i*(3-2*i)}function Kn(t,e,i){const r=i-e,l=((t-e)%r+r)%r+e;return l===e?i:l}function Rn(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const l=new Array(t.length);let u=null;t.forEach((p,g)=>{e(p,(v,b)=>{v&&(u=v),l[g]=b,--r==0&&i(u,l)})})}function Qi(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}let Tr=1;function Mr(){return Tr++}function Hr(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function On(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Os(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function xs(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function is(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Fn(t,e,i){const r={};for(const l in t)r[l]=e.call(i||this,t[l],l,t);return r}function Pr(t,e,i){const r={};for(const l in t)e.call(i||this,t[l],l,t)&&(r[l]=t[l]);return r}function Sr(t){return Array.isArray(t)?t.map(Sr):typeof t=="object"&&t?Fn(t,Sr):t}const ge={};function be(t){ge[t]||(typeof console<"u"&&console.warn(t),ge[t]=!0)}function Xe(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function ft(t){let e=0;for(let i,r,l=0,u=t.length,p=u-1;l<u;p=l++)i=t[l],r=t[p],e+=(r.x-i.x)*(i.y+r.y);return e}function ut([t,e,i]){const r=Zt(e+90),l=Zt(i);return{x:t*Math.cos(r)*Math.sin(l),y:t*Math.sin(r)*Math.sin(l),z:t*Math.cos(l),azimuthal:e,polar:i}}function St(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Vt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,l,u)=>{const p=l||u;return e[r]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let pt,Ot,xt,jt,ii,Qt,Me=null;function X(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function re(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function de(t,e,i,r){for(;e<i;){const l=e+i>>1;t[l]<r?e=l+1:i=l}return e}function Pe(t,e,i,r){for(;e<i;){const l=e+i>>1;t[l]<=r?e=l+1:i=l}return e}function Ne(){return pt==null&&(pt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),pt}const Je={now:()=>jt!==void 0?jt:performance.now(),setNow(t){jt=t},restoreNow(){jt=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;ii||(ii=document.createElement("canvas"));const l=ii.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(i>ii.width||r>ii.height)&&(ii.width=i,ii.height=r),l.clearRect(-e,-e,i+2*e,r+2*e),l.drawImage(t,0,0,i,r),l.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(Ot||(Ot=document.createElement("a")),Ot.href=t,Ot.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(xt==null&&(xt=window.matchMedia("(prefers-reduced-motion: reduce)")),xt.matches)},hasCanvasFingerprintNoise(){if(Qt!==void 0)return Qt;if(!Ne())return Qt=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let l=0;l<t.width;++l)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(l,0,1,1);const r=e.getImageData(0,0,t.width,t.height);i=0;for(let l=0;l<r.data.length;++l)if(l%4!=3&&i++!==r.data[l])return Qt=!0,!0;return Qt=!1,!1}},Et="mapbox-tiles";let Be=500,Ct=50,ht,Tt;function hi(){try{return caches}catch{}}function Yi(){const t=hi();t&&!ht&&(ht=t.open(Et))}function mn(t){const e=t.indexOf("?");if(e<0)return t;const i=["language","worldview"],r=new URLSearchParams,l=new URLSearchParams(t.slice(e));for(const u of i){const p=l.get(u);p&&r.set(u,p)}return`${t.slice(0,e)}?${r.toString()}`}function Ki(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const r=new URLSearchParams(t.slice(i));for(const l in e)r.set(l,e[l]);return`${t.slice(0,i)}?${r.toString()}`}let qi=1/0;const Ui={supported:!1,testSupport:function(t){!Jn&&an&&(hn?Er(t):Zi=t)}};let Zi,an,Jn=!1,hn=!1;const Dr=typeof self<"u"?self:{};function Er(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,an),t.isContextLost())return;Ui.supported=!0}catch{}t.deleteTexture(e),Jn=!0}Dr.document&&(an=Dr.document.createElement("img"),an.onload=function(){Zi&&Er(Zi),Zi=null,hn=!0},an.onerror=function(){Jn=!0,Zi=null},an.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const kr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(kr);class Un extends Error{constructor(e,i,r){i===401&&ae(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Bn=St()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Fe=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Bn())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(r,l){const u=new AbortController,p=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Bn(),referrerPolicy:r.referrerPolicy,signal:u.signal});let g=!1,v=!1;const b=(M=p.url).indexOf("sku=")>0&&ae(M);var M;r.type==="json"&&p.headers.set("Accept","application/json");const A=(R,k,O)=>{if(v)return;if(R&&R.message!=="SecurityError"&&be(R.toString()),k&&O)return C(k);const V=Date.now();fetch(p).then(j=>{if(j.ok){const K=b?j.clone():null;return C(j,K,V)}return l(new Un(j.statusText,j.status,r.url))}).catch(j=>{j.name!=="AbortError"&&l(new Error(`${j.message} ${r.url}`))})},C=(R,k,O)=>{(r.type==="arrayBuffer"?R.arrayBuffer():r.type==="json"?R.json():R.text()).then(V=>{v||(k&&O&&function(j,K,ee){if(Yi(),!ht)return;const Q=Vt(K.headers.get("Cache-Control")||"");if(Q["no-store"])return;const oe={status:K.status,statusText:K.statusText,headers:new Headers};K.headers.forEach((me,xe)=>oe.headers.set(xe,me)),Q["max-age"]&&oe.headers.set("Expires",new Date(ee+1e3*Q["max-age"]).toUTCString());const se=oe.headers.get("Expires");if(!se||new Date(se).getTime()-ee<42e4)return;let he=mn(j.url);if(K.status===206){const me=j.headers.get("Range");if(!me)return;oe.status=200,he=Ki(he,{range:me})}(function(me,xe){if(Tt===void 0)try{new Response(new ReadableStream),Tt=!0}catch{Tt=!1}Tt?xe(me.body):me.blob().then(xe)})(K,me=>{const xe=new Response(me,oe);Yi(),ht&&ht.then(Ee=>Ee.put(he,xe)).catch(Ee=>be(Ee.message))})}(p,k,O),g=!0,l(null,V,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(V=>{v||l(new Error(V.message))})};return b?function(R,k){if(Yi(),!ht)return k(null);ht.then(O=>{let V=mn(R.url);const j=R.headers.get("Range");j&&(V=Ki(V,{range:j})),O.match(V).then(K=>{const ee=function(Q){if(!Q)return!1;const oe=new Date(Q.headers.get("Expires")||0),se=Vt(Q.headers.get("Cache-Control")||"");return oe>Date.now()&&!se["no-cache"]}(K);O.delete(V),ee&&O.put(V,K.clone()),k(null,K,ee)}).catch(k)}).catch(k)}(p,A):A(null,null),{cancel:()=>{v=!0,g||u.abort()}}}(t,e);if(St()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,l){const u=new XMLHttpRequest;u.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in r.headers)u.setRequestHeader(p,r.headers[p]);return r.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=r.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(r.type==="json")try{p=JSON.parse(u.response)}catch(g){return l(g)}l(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new Un(u.statusText,u.status,r.url))},u.send(r.body),{cancel:()=>u.abort()}}(t,e)},Ve=function(t,e){return Fe(Qi(t,{type:"arrayBuffer"}),e)};function et(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let nt,mt;nt=[],mt=0;const _t=function(t,e){if(Ui.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),mt>=Z.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return nt.push(u),u}mt++;let i=!1;const r=()=>{if(!i)for(i=!0,mt--;nt.length&&mt<Z.MAX_PARALLEL_IMAGE_REQUESTS;){const u=nt.shift(),{requestParameters:p,callback:g,cancelled:v}=u;v||(u.cancel=_t(p,g).cancel)}},l=Ve(t,(u,p,g,v)=>{r(),u?e(u):p&&(self.createImageBitmap?function(b,M){const A=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(A).then(C=>{M(null,C)}).catch(C=>{M(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(b,M)=>e(b,M,g,v)):function(b,M){const A=new Image;A.onload=()=>{M(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=at})},A.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(b)],{type:"image/png"});A.src=b.byteLength?URL.createObjectURL(C):at}(p,(b,M)=>e(b,M,g,v)))});return{cancel:()=>{l.cancel(),r()}}},st="01",vt="NO_ACCESS_TOKEN",lt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Kt(t){const e=t.match(lt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ti(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Nt="mapbox.eventData";function en(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class yn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=en(Z.ACCESS_TOKEN);let r="";return r=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(+("0x"+u)))):Z.ACCESS_TOKEN||"",e?`${Nt}.${e}:${r}`:`${Nt}:${r}`}fetchEventData(){const e=X("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const l=localStorage.getItem(i);l&&(this.eventData=JSON.parse(l));const u=localStorage.getItem(r);u&&(this.anonId=u)}catch{be("Unable to read from LocalStorage")}}saveEventData(){const e=X("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid"),l=this.anonId;if(e&&l)try{localStorage.setItem(r,l),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{be("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,l){if(!Z.EVENTS_URL)return;const u=Kt(Z.EVENTS_URL);u.params.push(`access_token=${l||Z.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},g=i?Qi(p,i):p,v={url:Ti(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=function(b,M){return Fe(Qi(b,{method:"POST"}),M)}(v,b=>{this.pendingRequest=null,r(b),this.saveEventData(),this.processRequests(l)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const on=new class extends yn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Z.EVENTS_URL&&Z.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ue(i)||ae(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=en(Z.ACCESS_TOKEN),i=e?e.u:Z.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;Os(this.anonId)||(this.anonId=Hr(),r=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(l),g=(l-this.eventData.lastSuccess)/864e5;r=r||g>=1||g<-1||u.getDate()!==p.getDate()}else r=!0;r?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:st,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=i)},t):this.processRequests()}},jn=on.postTurnstileEvent.bind(on),dr=new class extends yn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,Z.EVENTS_URL&&(i||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(vt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Os(this.anonId)||(this.anonId=Hr()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:st,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Ni=dr.postMapLoadEvent.bind(dr),Wr=new class extends yn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Z.EVENTS_URL&&(t||Z.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(l){const u=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),g=function(R){const k={};if(R){for(const O in R)if(O!=="other")for(const V of R[O]){const j=`${O}ResolveRangeMin`,K=`${O}ResolveRangeMax`,ee=`${O}RequestCount`,Q=`${O}RequestCachedCount`;k[j]=Math.min(k[j]||1/0,V.startTime),k[K]=Math.max(k[K]||-1/0,V.responseEnd);const oe=se=>{k[se]===void 0&&(k[se]=0),++k[se]};V.transferSize!==void 0&&V.transferSize===0&&oe(Q),oe(ee)}}return k}(function(R,k){const O={};if(R)for(const V of R){const j=k(V);O[j]===void 0&&(O[j]=[]),O[j].push(V)}return O}(u,ct)),v=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=b?b.effectiveType:void 0,A={counters:[],metadata:[],attributes:[]},C=(R,k,O)=>{O!=null&&R.push({name:k,value:O.toString()})};for(const R in g)C(A.counters,R,g[R]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(C(A.counters,"interactionRangeMin",l.interactionRange[0]),C(A.counters,"interactionRangeMax",l.interactionRange[1])),p)for(const R of Object.keys(We)){const k=We[R],O=p.find(V=>V.name===k);O&&C(A.counters,k,O.startTime)}return C(A.counters,"visibilityHidden",l.visibilityHidden),C(A.attributes,"style",function(R){if(R)for(const k of R){const O=k.name.split("?")[0];if(Oe(O)){const V=O.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(u)),C(A.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),C(A.attributes,"fogEnabled",l.fogEnabled?"true":"false"),C(A.attributes,"projection",l.projection),C(A.attributes,"zoom",l.zoom),C(A.metadata,"devicePixelRatio",v),C(A.metadata,"connectionEffectiveType",M),C(A.metadata,"navigatorUserAgent",navigator.userAgent),C(A.metadata,"screenWidth",window.screen.width),C(A.metadata,"screenHeight",window.screen.height),C(A.metadata,"windowWidth",window.innerWidth),C(A.metadata,"windowHeight",window.innerHeight),C(A.metadata,"mapWidth",l.width/v),C(A.metadata,"mapHeight",l.height/v),C(A.metadata,"webglRenderer",l.renderer),C(A.metadata,"webglVendor",l.vendor),C(A.metadata,"sdkVersion",B),C(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const l of r.metadata);for(const l of r.counters);for(const l of r.attributes);this.postEvent(e,r,()=>{},t)}},vs=Wr.postPerformanceEvent.bind(Wr),fr=new class extends yn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!Z.API_URL||!Z.SESSION_PATH)return;const l=Kt(Z.API_URL+Z.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${r||Z.ACCESS_TOKEN||""}`);const u={url:Ti(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,g){return Fe(Qi(p,{method:"GET"}),g)}(u,p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,Z.SESSION_PATH&&Z.API_URL&&(i||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(vt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Ml=fr.getSessionAPI.bind(fr),po=new Set;function wa(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function eh(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);r!==-1&&i[t].splice(r,1)}}class Ho{constructor(e,i={}){Qi(this,i),this.type=e}}class th extends Ho{constructor(e,i={}){super("error",Qi({error:e},i))}}class Ta{on(e,i){return this._listeners=this._listeners||{},wa(e,i,this._listeners),this}off(e,i){return eh(e,i,this._listeners),eh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},wa(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){typeof e=="string"&&(e=new Ho(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const l=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const g of l)g.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const g of u)eh(r,g,this._oneTimeListeners),g.call(this,e);const p=this._eventedParent;p&&(Qi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof th&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}s.y=void 0;var Gf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Uc(t){return(t=Math.round(t))<0?0:t>255?255:t}function ih(t){return Uc(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function jc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function nh(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{s.y={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Gf)return Gf[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),l=i.indexOf(")");if(r!==-1&&l+1===i.length){var u=i.substr(0,r),p=i.substr(r+1,l-(r+1)).split(","),g=1;switch(u){case"rgba":if(p.length!==4)return null;g=jc(p.pop());case"rgb":return p.length!==3?null:[ih(p[0]),ih(p[1]),ih(p[2]),g];case"hsla":if(p.length!==4)return null;g=jc(p.pop());case"hsl":if(p.length!==3)return null;var v=(parseFloat(p[0])%360+360)%360/360,b=jc(p[1]),M=jc(p[2]),A=M<=.5?M*(b+1):M+b-M*b,C=2*M-A;return[Uc(255*nh(C,A,v+1/3)),Uc(255*nh(C,A,v)),Uc(255*nh(C,A,v-1/3)),g];default:return null}}return null}}catch{}class Or{constructor(e,i,r,l=1){this.r=e,this.g=i,this.b=r,this.a=l}static parse(e){if(!e)return;if(e instanceof Or)return e;if(typeof e!="string")return;const i=s.y(e);return i?new Or(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${l})`}toArray(){const{r:e,g:i,b:r,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*i/l,255*r/l,l]}toArray01(){const{r:e,g:i,b:r,a:l}=this;return l===0?[0,0,0,0]:[e/l,i/l,r/l,l]}toArray01Scaled(e){const{r:i,g:r,b:l,a:u}=this;return u===0?[0,0,0]:[i/u*e,r/u*e,l/u*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a:l}=this;return[e,i,r,l]}toArray01Linear(){const{r:e,g:i,b:r,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(i/l,2.2),Math.pow(r/l,2.2),l]}}Or.black=new Or(0,0,0,1),Or.white=new Or(1,1,1,1),Or.transparent=new Or(0,0,0,0),Or.red=new Or(1,0,0,1),Or.blue=new Or(0,0,1,1);var Nn=Or;function Mi(t,e,i){return t*(1-i)+e*i}function $f(t,e,i){return t.map((r,l)=>Mi(r,e[l],i))}var Gc=Object.freeze({__proto__:null,array:$f,color:function(t,e,i){return new Nn(Mi(t.r,e.r,i),Mi(t.g,e.g,i),Mi(t.b,e.b,i),Mi(t.a,e.a,i))},number:Mi});function rh(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}class q_ extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Fs=q_;class sh{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,l]of i)this.bindings[r]=l}concat(e){return new sh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var H_=sh;const Ma={kind:"null"},wt={kind:"number"},ji={kind:"string"},Gi={kind:"boolean"},ns={kind:"color"},Sa={kind:"object"},Ci={kind:"value"},$c={kind:"collator"},Ea={kind:"formatted"},Sl={kind:"resolvedImage"};function Fr(t,e){return{kind:"array",itemType:t,N:e}}function zn(t){if(t.kind==="array"){const e=zn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const qt=[Ma,wt,ji,Gi,ns,Ea,Sa,Fr(Ci),Sl];function Wo(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Wo(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of qt)if(!Wo(i,e))return null}}return`Expected ${zn(t)} but found ${zn(e)} instead.`}function ei(t,e){return e.some(i=>i.kind===t.kind)}function mo(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class mi{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Aa{constructor(e,i,r,l,u){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=l,this.textColor=u}}class pr{constructor(e){this.sections=e}static fromString(e){return new pr([new Aa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof pr?e:pr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class Ht{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Ht({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function qf(t,e,i,r){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Nn||t instanceof mi||t instanceof pr||t instanceof Ht)return!0;if(Array.isArray(t)){for(const e of t)if(!Zo(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Zo(t[e]))return!1;return!0}return!1}function Gn(t){if(t===null)return Ma;if(typeof t=="string")return ji;if(typeof t=="boolean")return Gi;if(typeof t=="number")return wt;if(t instanceof Nn)return ns;if(t instanceof mi)return $c;if(t instanceof pr)return Ea;if(t instanceof Ht)return Sl;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const l=Gn(r);if(i){if(i===l)continue;i=Ci;break}i=l}return Fr(i||Ci,e)}return Sa}function rs(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Nn||t instanceof pr||t instanceof Ht?t.toString():JSON.stringify(t)}class _o{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Zo(e[1]))return i.error("invalid value");const r=e[1];let l=Gn(r);const u=i.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new _o(l,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Nn?["rgba"].concat(this.value.toArray()):this.value instanceof pr?this.value.serialize():this.value}}var qs=_o,$n=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const oh={string:ji,number:wt,boolean:Gi,object:Sa};class ah{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,l=1;const u=e[0];if(u==="array"){let g,v;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in oh)||b==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=oh[b],l++}else g=Ci;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}r=Fr(g,v)}else r=oh[u];const p=[];for(;l<e.length;l++){const g=i.parse(e[l],l,Ci);if(!g)return null;p.push(g)}return new ah(r,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!Wo(this.type,Gn(r)))return r;if(i===this.args.length-1)throw new $n(`Expected value to be of type ${zn(this.type)}, but found ${zn(Gn(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){i.push(r.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&i.push(l)}}return i.concat(this.args.map(r=>r.serialize()))}}var Hs=ah;class Ia{constructor(e){this.type=Ea,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return i.error("First argument must be an image or text section.");const l=[];let u=!1;for(let p=1;p<=e.length-1;++p){const g=e[p];if(u&&typeof g=="object"&&!Array.isArray(g)){u=!1;let v=null;if(g["font-scale"]&&(v=i.parse(g["font-scale"],1,wt),!v))return null;let b=null;if(g["text-font"]&&(b=i.parse(g["text-font"],1,Fr(ji)),!b))return null;let M=null;if(g["text-color"]&&(M=i.parse(g["text-color"],1,ns),!M))return null;const A=l[l.length-1];A.scale=v,A.font=b,A.textColor=M}else{const v=i.parse(e[p],1,Ci);if(!v)return null;const b=v.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new Ia(l)}evaluate(e){return new pr(this.sections.map(i=>{const r=i.content.evaluate(e);return Gn(r)===Sl?new Aa("",r,null,null,null):new Aa(rs(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class Xo{constructor(e,i){this.type=Sl,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const r=i.parse(e[1],1,ji);if(!r)return i.error("No image name provided.");if(e.length===2)return new Xo(r);const l=i.parse(e[2],1,ji);return l?new Xo(r,l):i.error("Secondary image variant is not a string.")}evaluate(e){const i=Ht.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ca(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const bs={"to-boolean":Gi,"to-color":ns,"to-number":wt,"to-string":ji};class qc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0],l=[];let u=Ma;if(r==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);u=Fr(i.expectedType.itemType,p)}else{if(!(p>0&&Zo(e[1][0])))return null;u=Fr(Gn(e[1][0]),p)}for(let g=0;g<p;g++){const v=e[1][g];let b;if(Ca(v)==="array")b=i.parse(v,void 0,u.itemType);else{const M=Ca(v);if(M!==u.itemType.kind)return i.error(`Expected ${u.itemType.kind} but found ${M}.`);b=i.registry.literal.parse(["literal",v===void 0?null:v],i)}if(!b)return null;l.push(b)}}else{if((r==="to-boolean"||r==="to-string")&&e.length!==2)return i.error("Expected one argument.");u=bs[r];for(let p=1;p<e.length;p++){const g=i.parse(e[p],p,Ci);if(!g)return null;l.push(g)}}return new qc(u,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,r;for(const l of this.args){if(i=l.evaluate(e),r=null,i instanceof Nn)return i;if(typeof i=="string"){const u=e.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:qf(i[0],i[1],i[2],i[3]),!r))return new Nn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new $n(r||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const r of this.args){if(i=r.evaluate(e),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new $n(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?pr.fromString(rs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ht.fromString(rs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):rs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ia([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xo(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ws=qc;const El=["Unknown","Point","LineString","Polygon"];var Hf=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?El[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Nn.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Yo{constructor(e,i,r,l,u){this.name=e,this.type=i,this._evaluate=r,this.args=l,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const i=Yo.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],l=Yo.definitions[r];if(!l)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=[];let v=null,b=-1;for(const[M,A]of p){if(Array.isArray(M)&&M.length!==e.length-1)continue;g.push(M),b++,v=new Qf(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const C=[];let R=!1;for(let k=1;k<e.length;k++){const O=e[k],V=Array.isArray(M)?M[k-1]:M.type,j=v.parse(O,1+C.length,V);if(!j){R=!0;break}C.push(j)}if(!R)if(Array.isArray(M)&&M.length!==C.length)v.error(`Expected ${M.length} arguments, but found ${C.length} instead.`);else{for(let k=0;k<C.length;k++){const O=Array.isArray(M)?M[k]:M.type,V=C[k];v.concat(k+1).checkSubtype(O,V.type)}if(v.errors.length===0)return new Yo(r,u,A,C,b)}}if(g.length===1)i.errors.push(...v.errors);else{const M=(g.length?g:p.map(([C])=>C)).map(Wf).join(" | "),A=[];for(let C=1;C<e.length;C++){const R=i.parse(e[C],1+A.length);if(!R)return null;A.push(zn(R.type))}i.error(`Expected arguments of type ${M}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){Yo.definitions=i;for(const r in i)e[r]=Yo}}function Wf(t){return Array.isArray(t)?`(${t.map(zn).join(", ")})`:`(${zn(t.type)}...)`}var Ei=Yo;class Al{constructor(e,i,r){this.type=$c,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return i.error("Collator options argument must be an object.");const l=i.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,Gi);if(!l)return null;const u=i.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,Gi);if(!u)return null;let p=null;return r.locale&&(p=i.parse(r.locale,1,ji),!p)?null:new Al(l,u,p)}evaluate(e){return new mi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var lh={exports:{}};lh.exports=function(){function t(r,l,u,p,g){for(;p>u;){if(p-u>600){var v=p-u+1,b=l-u+1,M=Math.log(v),A=.5*Math.exp(2*M/3),C=.5*Math.sqrt(M*A*(v-A)/v)*(b-v/2<0?-1:1);t(r,l,Math.max(u,Math.floor(l-b*A/v+C)),Math.min(p,Math.floor(l+(v-b)*A/v+C)),g)}var R=r[l],k=u,O=p;for(e(r,u,l),g(r[p],R)>0&&e(r,u,p);k<O;){for(e(r,k,O),k++,O--;g(r[k],R)<0;)k++;for(;g(r[O],R)>0;)O--}g(r[u],R)===0?e(r,u,O):e(r,++O,p),O<=l&&(u=O+1),l<=O&&(p=O-1)}}function e(r,l,u){var p=r[l];r[l]=r[u],r[u]=p}function i(r,l){return r<l?-1:r>l?1:0}return function(r,l,u,p,g){t(r,l,u||0,p||r.length-1,g||i)}}();var W_=gt(lh.exports);function Z_(t){let e=0;for(let i,r,l=0,u=t.length,p=u-1;l<u;p=l++)i=t[l],r=t[p],e+=(r.x-i.x)*(i.y+r.y);return e}function go(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function yo(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Hc(t,e,i){const r=t[0]-e[0],l=t[1]-e[1],u=t[0]-i[0],p=t[1]-i[1];return r*p-u*l==0&&r*u<=0&&l*p<=0}function Pa(t,e,i=!1){let r=!1;for(let g=0,v=e.length;g<v;g++){const b=e[g];for(let M=0,A=b.length,C=A-1;M<A;C=M++){const R=b[C],k=b[M];if(Hc(t,R,k))return i;(u=R)[1]>(l=t)[1]!=(p=k)[1]>l[1]&&l[0]<(p[0]-u[0])*(l[1]-u[1])/(p[1]-u[1])+u[0]&&(r=!r)}}var l,u,p;return r}function ch(t,e,i,r){const l=r[0]-i[0],u=r[1]-i[1],p=(t[0]-i[0])*u-l*(t[1]-i[1]),g=(e[0]-i[0])*u-l*(e[1]-i[1]);return p>0&&g<0||p<0&&g>0}function Zs(t,e,i,r){return(l=[r[0]-i[0],r[1]-i[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-l[1]*u[0]!=0&&!(!ch(t,e,i,r)||!ch(i,r,t,e));var l,u}const xo=8192;function Il(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(i*l*xo),Math.round(r*l*xo)]}function uh(t,e){for(let i=0;i<e.length;i++)if(Pa(t,e[i]))return!0;return!1}function hh(t,e,i){for(const r of i)for(let l=0,u=r.length,p=u-1;l<u;p=l++)if(Zs(t,e,r[p],r[l]))return!0;return!1}function ss(t,e){for(let i=0;i<t.length;++i)if(!Pa(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(hh(t[i],t[i+1],e))return!1;return!0}function Zf(t,e){for(let i=0;i<e.length;i++)if(ss(t,e[i]))return!0;return!1}function dh(t,e,i){const r=[];for(let l=0;l<t.length;l++){const u=[];for(let p=0;p<t[l].length;p++){const g=Il(t[l][p],i);go(e,g),u.push(g)}r.push(u)}return r}function fh(t,e,i){const r=[];for(let l=0;l<t.length;l++){const u=dh(t[l],e,i);r.push(u)}return r}function ph(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const l=.5*r;let u=t[0]-i[0]>l?-r:i[0]-t[0]>l?r:0;u===0&&(u=t[0]-i[2]>l?-r:i[2]-t[0]>l?r:0),t[0]+=u}go(e,t)}function mh(t,e,i,r){const l=Math.pow(2,r.z)*xo,u=[r.x*xo,r.y*xo],p=[];if(!t)return p;for(const g of t)for(const v of g){const b=[v.x+u[0],v.y+u[1]];ph(b,e,i,l),p.push(b)}return p}function _h(t,e,i,r){const l=Math.pow(2,r.z)*xo,u=[r.x*xo,r.y*xo],p=[];if(!t)return p;for(const v of t){const b=[];for(const M of v){const A=[M.x+u[0],M.y+u[1]];go(e,A),b.push(A)}p.push(b)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of p)for(const b of v)ph(b,e,i,l)}var g;return p}class Da{constructor(e,i){this.type=Gi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Zo(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let l=0;l<r.features.length;++l){const u=r.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Da(r,r.features[l].geometry)}else if(r.type==="Feature"){const l=r.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Da(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Da(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,r){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(r.type==="Polygon"){const g=dh(r.coordinates,u,p),v=mh(i.geometry(),l,u,p);if(!yo(l,u))return!1;for(const b of v)if(!Pa(b,g))return!1}if(r.type==="MultiPolygon"){const g=fh(r.coordinates,u,p),v=mh(i.geometry(),l,u,p);if(!yo(l,u))return!1;for(const b of v)if(!uh(b,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,r){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(r.type==="Polygon"){const g=dh(r.coordinates,u,p),v=_h(i.geometry(),l,u,p);if(!yo(l,u))return!1;for(const b of v)if(!ss(b,g))return!1}if(r.type==="MultiPolygon"){const g=fh(r.coordinates,u,p),v=_h(i.geometry(),l,u,p);if(!yo(l,u))return!1;for(const b of v)if(!Zf(b,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Wc=Da,Cl={exports:{}};Cl.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),r=Math.PI/180,l=function(b,M){if(b===void 0)throw new Error("No latitude given.");if(M&&!t[M])throw new Error("Unknown unit "+M+". Use one of: "+Object.keys(t).join(", "));var A=6378.137*r*(M?t[M]:1),C=Math.cos(b*r),R=1/(1-i*(1-C*C)),k=Math.sqrt(R);this.kx=A*k*C,this.ky=A*k*R*(1-i)},u={units:{configurable:!0}};function p(b,M){return b[0]===M[0]&&b[1]===M[1]}function g(b,M,A){var C=v(M[0]-b[0]);return[b[0]+C*A,b[1]+(M[1]-b[1])*A]}function v(b){for(;b<-180;)b+=360;for(;b>180;)b-=360;return b}return l.fromTile=function(b,M,A){var C=Math.PI*(1-2*(b+.5)/Math.pow(2,M)),R=Math.atan(.5*(Math.exp(C)-Math.exp(-C)))/r;return new l(R,A)},u.units.get=function(){return t},l.prototype.distance=function(b,M){var A=v(b[0]-M[0])*this.kx,C=(b[1]-M[1])*this.ky;return Math.sqrt(A*A+C*C)},l.prototype.bearing=function(b,M){var A=v(M[0]-b[0])*this.kx;return Math.atan2(A,(M[1]-b[1])*this.ky)/r},l.prototype.destination=function(b,M,A){var C=A*r;return this.offset(b,Math.sin(C)*M,Math.cos(C)*M)},l.prototype.offset=function(b,M,A){return[b[0]+M/this.kx,b[1]+A/this.ky]},l.prototype.lineDistance=function(b){for(var M=0,A=0;A<b.length-1;A++)M+=this.distance(b[A],b[A+1]);return M},l.prototype.area=function(b){for(var M=0,A=0;A<b.length;A++)for(var C=b[A],R=0,k=C.length,O=k-1;R<k;O=R++)M+=v(C[R][0]-C[O][0])*(C[R][1]+C[O][1])*(A?-1:1);return Math.abs(M)/2*this.kx*this.ky},l.prototype.along=function(b,M){var A=0;if(M<=0)return b[0];for(var C=0;C<b.length-1;C++){var R=b[C],k=b[C+1],O=this.distance(R,k);if((A+=O)>M)return g(R,k,(M-(A-O))/O)}return b[b.length-1]},l.prototype.pointToSegmentDistance=function(b,M,A){var C=M[0],R=M[1],k=v(A[0]-C)*this.kx,O=(A[1]-R)*this.ky,V=0;return k===0&&O===0||((V=(v(b[0]-C)*this.kx*k+(b[1]-R)*this.ky*O)/(k*k+O*O))>1?(C=A[0],R=A[1]):V>0&&(C+=k/this.kx*V,R+=O/this.ky*V)),k=v(b[0]-C)*this.kx,O=(b[1]-R)*this.ky,Math.sqrt(k*k+O*O)},l.prototype.pointOnLine=function(b,M){for(var A,C,R,k,O=1/0,V=0;V<b.length-1;V++){var j=b[V][0],K=b[V][1],ee=v(b[V+1][0]-j)*this.kx,Q=(b[V+1][1]-K)*this.ky,oe=0;ee===0&&Q===0||((oe=(v(M[0]-j)*this.kx*ee+(M[1]-K)*this.ky*Q)/(ee*ee+Q*Q))>1?(j=b[V+1][0],K=b[V+1][1]):oe>0&&(j+=ee/this.kx*oe,K+=Q/this.ky*oe));var se=(ee=v(M[0]-j)*this.kx)*ee+(Q=(M[1]-K)*this.ky)*Q;se<O&&(O=se,A=j,C=K,R=V,k=oe)}return{point:[A,C],index:R,t:Math.max(0,Math.min(1,k))}},l.prototype.lineSlice=function(b,M,A){var C=this.pointOnLine(A,b),R=this.pointOnLine(A,M);if(C.index>R.index||C.index===R.index&&C.t>R.t){var k=C;C=R,R=k}var O=[C.point],V=C.index+1,j=R.index;!p(A[V],O[0])&&V<=j&&O.push(A[V]);for(var K=V+1;K<=j;K++)O.push(A[K]);return p(A[j],R.point)||O.push(R.point),O},l.prototype.lineSliceAlong=function(b,M,A){for(var C=0,R=[],k=0;k<A.length-1;k++){var O=A[k],V=A[k+1],j=this.distance(O,V);if((C+=j)>b&&R.length===0&&R.push(g(O,V,(b-(C-j))/j)),C>=M)return R.push(g(O,V,(M-(C-j))/j)),R;C>b&&R.push(V)}return R},l.prototype.bufferPoint=function(b,M){var A=M/this.ky,C=M/this.kx;return[b[0]-C,b[1]-A,b[0]+C,b[1]+A]},l.prototype.bufferBBox=function(b,M){var A=M/this.ky,C=M/this.kx;return[b[0]-C,b[1]-A,b[2]+C,b[3]+A]},l.prototype.insideBBox=function(b,M){return v(b[0]-M[0])>=0&&v(b[0]-M[2])<=0&&b[1]>=M[1]&&b[1]<=M[3]},Object.defineProperties(l,u),l}();var vo=gt(Cl.exports),gh={exports:{}};gh.exports=function(){var t=function(i,r){if(i===void 0&&(i=[]),r===void 0&&(r=e),this.data=i,this.length=this.data.length,this.compare=r,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function e(i,r){return i<r?-1:i>r?1:0}return t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var r=this.data,l=this.compare,u=r[i];i>0;){var p=i-1>>1,g=r[p];if(l(u,g)>=0)break;r[i]=g,i=p}r[i]=u},t.prototype._down=function(i){for(var r=this.data,l=this.compare,u=this.length>>1,p=r[i];i<u;){var g=1+(i<<1),v=r[g],b=g+1;if(b<this.length&&l(r[b],v)<0&&(g=b,v=r[b]),l(v,p)>=0)break;r[i]=v,i=g}r[i]=p},t}();var os=gt(gh.exports),yt=8192;function Zc(t,e){return e.dist-t.dist}const yh=100,Pl=50;function xh(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function bo(t){return t[1]-t[0]+1}function ws(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function vh(t,e){if(t[0]>t[1])return[null,null];const i=bo(t);if(e){if(i===2)return[t,null];const r=Math.floor(i/2);return[[t[0],t[0]+r],[t[0]+r,t[1]]]}{if(i===1)return[t,null];const r=Math.floor(i/2)-1;return[[t[0],t[0]+r],[t[0]+r+1,t[1]]]}}function Ko(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!ws(e,t.length))return i;for(let r=e[0];r<=e[1];++r)go(i,t[r]);return i}function Xc(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let r=0;r<t[i].length;++r)go(e,t[i][r]);return e}function Jo(t,e,i){if(xh(t)||xh(e))return NaN;let r=0,l=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(l=t[1]-e[3]),t[3]<e[1]&&(l=e[1]-t[3]),i.distance([0,0],[r,l])}function bh(t){return 360*t-180}function X_(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function La(t,e){const i=Math.pow(2,e.z),r=(t.y/yt+e.y)/i;return[bh((t.x/yt+e.x)/i),X_(r)]}function Y_(t,e){const i=[];for(let r=0;r<t.length;++r)i.push(La(t[r],e));return i}function Xf(t,e,i){const r=i.pointOnLine(e,t).point;return i.distance(t,r)}function Yf(t,e,i,r,l){const u=i.slice(r[0],r[1]+1);let p=1/0;for(let g=e[0];g<=e[1];++g)if((p=Math.min(p,Xf(t[g],u,l)))===0)return 0;return p}function wh(t,e,i,r,l){const u=Math.min(l.pointToSegmentDistance(t,i,r),l.pointToSegmentDistance(e,i,r)),p=Math.min(l.pointToSegmentDistance(i,t,e),l.pointToSegmentDistance(r,t,e));return Math.min(u,p)}function K_(t,e,i,r,l){if(!ws(e,t.length)||!ws(r,i.length))return NaN;let u=1/0;for(let p=e[0];p<e[1];++p)for(let g=r[0];g<r[1];++g){if(Zs(t[p],t[p+1],i[g],i[g+1]))return 0;u=Math.min(u,wh(t[p],t[p+1],i[g],i[g+1],l))}return u}function J_(t,e,i,r,l){if(!ws(e,t.length)||!ws(r,i.length))return NaN;let u=1/0;for(let p=e[0];p<=e[1];++p)for(let g=r[0];g<=r[1];++g)if((u=Math.min(u,l.distance(t[p],i[g])))===0)return u;return u}function Q_(t,e,i){if(Pa(t,e,!0))return 0;let r=1/0;for(const l of e){const u=l.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[u-1]&&(r=Math.min(r,i.pointToSegmentDistance(t,l[u-1],l[0])))===0||(r=Math.min(r,Xf(t,l,i)))===0)return r}return r}function Kf(t,e,i,r){if(!ws(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if(Pa(t[u],i,!0))return 0;let l=1/0;for(let u=e[0];u<e[1];++u)for(const p of i)for(let g=0,v=p.length,b=v-1;g<v;b=g++){if(Zs(t[u],t[u+1],p[b],p[g]))return 0;l=Math.min(l,wh(t[u],t[u+1],p[b],p[g],r))}return l}function Dl(t,e){for(const i of t)for(let r=0;r<=i.length-1;++r)if(Pa(i[r],e,!0))return!0;return!1}function eg(t,e,i,r=1/0){const l=Xc(t),u=Xc(e);if(r!==1/0&&Jo(l,u,i)>=r)return r;if(yo(l,u)){if(Dl(t,e))return 0}else if(Dl(e,t))return 0;let p=r;for(const g of t)for(let v=0,b=g.length,M=b-1;v<b;M=v++)for(const A of e)for(let C=0,R=A.length,k=R-1;C<R;k=C++){if(Zs(g[M],g[v],A[k],A[C]))return 0;p=Math.min(p,wh(g[M],g[v],A[k],A[C],i))}return p}function Yc(t,e,i,r,l,u,p){if(u===null||p===null)return;const g=Jo(Ko(r,u),Ko(l,p),i);g<e&&t.push({dist:g,range1:u,range2:p})}function Th(t,e,i,r,l=1/0){let u=Math.min(r.distance(t[0],i[0][0]),l);if(u===0)return u;const p=new os([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Zc),g=e?Pl:yh,v=Xc(i);for(;p.length;){const b=p.pop();if(b.dist>=u)continue;const M=b.range1;if(bo(M)<=g){if(!ws(M,t.length))return NaN;if(e){const A=Kf(t,M,i,r);if((u=Math.min(u,A))===0)return u}else for(let A=M[0];A<=M[1];++A){const C=Q_(t[A],i,r);if((u=Math.min(u,C))===0)return u}}else{const A=vh(M,e);if(A[0]!==null){const C=Jo(Ko(t,A[0]),v,r);C<u&&p.push({dist:C,range1:A[0],range2:[0,0]})}if(A[1]!==null){const C=Jo(Ko(t,A[1]),v,r);C<u&&p.push({dist:C,range1:A[1],range2:[0,0]})}}}return u}function Jf(t,e,i,r,l,u=1/0){let p=Math.min(u,l.distance(t[0],i[0]));if(p===0)return p;const g=new os([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Zc),v=e?Pl:yh,b=r?Pl:yh;for(;g.length;){const M=g.pop();if(M.dist>=p)continue;const A=M.range1,C=M.range2;if(bo(A)<=v&&bo(C)<=b){if(!ws(A,t.length)||!ws(C,i.length))return NaN;if(e&&r?p=Math.min(p,K_(t,A,i,C,l)):e||r?e&&!r?p=Math.min(p,Yf(i,C,t,A,l)):!e&&r&&(p=Math.min(p,Yf(t,A,i,C,l))):p=Math.min(p,J_(t,A,i,C,l)),p===0)return p}else{const R=vh(A,e),k=vh(C,r);Yc(g,p,l,t,i,R[0],k[0]),Yc(g,p,l,t,i,R[0],k[1]),Yc(g,p,l,t,i,R[1],k[0]),Yc(g,p,l,t,i,R[1],k[1])}}return p}function Mh(t,e,i,r,l=1/0){let u=l;const p=Ko(t,[0,t.length-1]);for(const g of i)if(!(u!==1/0&&Jo(p,Ko(g,[0,g.length-1]),r)>=u)&&(u=Math.min(u,Jf(t,e,g,!0,r,u)),u===0))return u;return u}function Kc(t,e,i,r,l=1/0){let u=l;const p=Ko(t,[0,t.length-1]);for(const g of i){if(u!==1/0&&Jo(p,Xc(g),r)>=u)continue;const v=Th(t,e,g,r,u);if(isNaN(v))return v;if((u=Math.min(u,v))===0)return u}return u}function Sh(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Qo{constructor(e,i){this.type=wt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Zo(e[1])){const r=e[1];if(r.type==="FeatureCollection"){for(let l=0;l<r.features.length;++l)if(Sh(r.features[l].geometry.type))return new Qo(r,r.features[l].geometry)}else if(r.type==="Feature"){if(Sh(r.geometry.type))return new Qo(r,r.geometry)}else if(Sh(r.type))return new Qo(r,r)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),r=e.canonicalID();if(i!=null&&r!=null){if(e.geometryType()==="Point")return function(l,u,p){const g=[];for(const b of l)for(const M of b)g.push(La(M,u));const v=new vo(g[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Jf(g,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v):p.type==="MultiLineString"?Mh(g,!1,p.coordinates,v):p.type==="Polygon"||p.type==="MultiPolygon"?Kc(g,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,v):null}(i,r,this.geometries);if(e.geometryType()==="LineString")return function(l,u,p){const g=[];for(const b of l){const M=[];for(const A of b)M.push(La(A,u));g.push(M)}const v=new vo(g[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Mh(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",g,v);if(p.type==="MultiLineString"){let b=1/0;for(let M=0;M<p.coordinates.length;M++){const A=Mh(p.coordinates[M],!0,g,v,b);if(isNaN(A))return A;if((b=Math.min(b,A))===0)return b}return b}if(p.type==="Polygon"||p.type==="MultiPolygon"){let b=1/0;for(let M=0;M<g.length;M++){const A=Kc(g[M],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,v,b);if(isNaN(A))return A;if((b=Math.min(b,A))===0)return b}return b}return null}(i,r,this.geometries);if(e.geometryType()==="Polygon")return function(l,u,p){const g=[];for(const b of function(M,A){const C=M.length;if(C<=1)return[M];const R=[];let k,O;for(let V=0;V<C;V++){const j=Z_(M[V]);j!==0&&(M[V].area=Math.abs(j),O===void 0&&(O=j<0),O===j<0?(k&&R.push(k),k=[M[V]]):k.push(M[V]))}return k&&R.push(k),R}(l)){const M=[];for(let A=0;A<b.length;++A)M.push(Y_(b[A],u));g.push(M)}const v=new vo(g[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Kc(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",g,v);if(p.type==="MultiLineString"){let b=1/0;for(let M=0;M<p.coordinates.length;M++){const A=Kc(p.coordinates[M],!0,g,v,b);if(isNaN(A))return A;if((b=Math.min(b,A))===0)return b}return b}return p.type==="Polygon"||p.type==="MultiPolygon"?function(b,M,A){let C=1/0;for(const R of b)for(const k of M){const O=eg(R,k,A,C);if(isNaN(O))return O;if((C=Math.min(C,O))===0)return C}return C}(p.type==="Polygon"?[p.coordinates]:p.coordinates,g,v):null}(i,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Jc=Qo;function Ll(t,e){switch(t){case"string":return rs(e);case"number":return+e;case"boolean":return!!e;case"color":return Nn.parse(e);case"formatted":return pr.fromString(rs(e));case"resolvedImage":return Ht.fromString(rs(e))}return e}function Eh(t,e,i,r){return r!==void 0&&(t=r*Math.round(t/r)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class Rl{constructor(e,i,r){this.type=e,this.key=i,this.scope=r}static parse(e,i){let r=i.expectedType;if(r==null&&(r=Ci),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const l=i.parse(e[1],1);if(!(l instanceof qs))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const u=i.parse(e[2],2);return u instanceof qs?new Rl(r,rs(l.value),rs(u.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Rl(r,rs(l.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),r=e.getConfig(i);if(!r)return null;const{type:l,value:u,values:p,minValue:g,maxValue:v,stepValue:b}=r,M=r.default.evaluate(e);let A=M;if(u){const C=e.scope;e.scope=(C||"").split("").slice(1).join(""),A=u.evaluate(e),e.scope=C}return l&&(A=Ll(l,A)),A===void 0||g===void 0&&v===void 0&&b===void 0||(typeof A=="number"?A=Eh(A,g,v,b):Array.isArray(A)&&(A=A.map(C=>typeof C=="number"?Eh(C,g,v,b):C))),u!==void 0&&A!==void 0&&p&&!p.includes(A)&&(A=M,l&&(A=Ll(l,A))),(l&&l!==this.type||A!==void 0&&Gn(A)!==this.type)&&(A=Ll(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var Ra=Rl;function za(t){if(t instanceof Ei&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Wc||t instanceof Jc)return!1;let e=!0;return t.eachChild(i=>{e&&!za(i)&&(e=!1)}),e}function zl(t){if(t instanceof Ei&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!zl(i)&&(e=!1)}),e}function kl(t){if(t instanceof Ra)return!1;let e=!0;return t.eachChild(i=>{e&&!kl(i)&&(e=!1)}),e}function mr(t,e){if(t instanceof Ei&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!mr(r,e)&&(i=!1)}),i}class wo{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new wo(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Lr=wo;class Ah{constructor(e,i=[],r,l=new H_,u=[],p,g){this.registry=e,this.path=i,this.key=i.map(v=>`[${v}]`).join(""),this.scope=l,this.errors=u,this.expectedType=r,this._scope=p,this.options=g}parse(e,i,r,l,u={}){return i||r?this.concat(i,r,l)._parse(e,u):this._parse(e,u)}_parse(e,i){function r(l,u,p){return p==="assert"?new Hs(u,[l]):p==="coerce"?new Ws(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let u=l.parse(e,this);if(!u)return null;if(this.expectedType){const p=this.expectedType,g=u.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||g.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(p,g))return null}else u=r(u,p,i.typeAnnotation||"coerce");else u=r(u,p,i.typeAnnotation||"assert")}if(!(u instanceof qs)&&u.type.kind!=="resolvedImage"&&Ih(u)){const p=new Hf(this._scope,this.options);try{u=new qs(u.type,u.evaluate(p))}catch(g){return this.error(g.message),null}}return u}return Ws.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const l=typeof e=="number"?this.path.concat(e):this.path,u=r?this.scope.concat(r):this.scope;return new Ah(this.registry,l,i||null,u,this.errors,this._scope,this.options)}error(e,...i){const r=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new Fs(r,e))}checkSubtype(e,i){const r=Wo(e,i);return r&&this.error(r),r}}var Qf=Ah;function Ih(t){if(t instanceof Lr)return Ih(t.boundExpression);if(t instanceof Ei&&t.name==="error"||t instanceof Al||t instanceof Wc||t instanceof Jc||t instanceof Ra)return!1;const e=t instanceof Ws||t instanceof Hs;let i=!0;return t.eachChild(r=>{i=e?i&&Ih(r):i&&r instanceof qs}),!!i&&za(t)&&mr(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ea(t,e){const i=t.length-1;let r,l,u=0,p=i,g=0;for(;u<=p;)if(g=Math.floor((u+p)/2),r=t[g],l=t[g+1],r<=e){if(g===i||e<l)return g;u=g+1}else{if(!(r>e))throw new $n("Input is not a number.");p=g-1}return 0}class Qc{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[l,u]of r)this.labels.push(l),this.outputs.push(u)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,wt);if(!r)return null;const l=[];let u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let p=1;p<e.length;p+=2){const g=p===1?-1/0:e[p],v=e[p+1],b=p,M=p+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const A=i.parse(v,M,u);if(!A)return null;u=u||A.type,l.push([g,A])}return new Qc(u,r,l)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return r[0].evaluate(e);const u=i.length;return l>=i[u-1]?r[u-1].evaluate(e):r[ea(i,l)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Ol=Qc;const ep=.95047,To=1.08883,tp=4/29,ka=6/29,Ch=3*ka*ka,ip=ka*ka*ka,tg=Math.PI/180,Ts=180/Math.PI;function eu(t){return t>ip?Math.pow(t,1/3):t/Ch+tp}function tu(t){return t>ka?t*t*t:Ch*(t-tp)}function iu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function nu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ph(t){const e=nu(t.r),i=nu(t.g),r=nu(t.b),l=eu((.4124564*e+.3575761*i+.1804375*r)/ep),u=eu((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-eu((.0193339*e+.119192*i+.9503041*r)/To)),alpha:t.a}}function Dh(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*tu(e),i=ep*tu(i),r=To*tu(r),new Nn(iu(3.2404542*i-1.5371385*e-.4985314*r),iu(-.969266*i+1.8760108*e+.041556*r),iu(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function np(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Oa={forward:Ph,reverse:Dh,interpolate:function(t,e,i){return{l:Mi(t.l,e.l,i),a:Mi(t.a,e.a,i),b:Mi(t.b,e.b,i),alpha:Mi(t.alpha,e.alpha,i)}}},Fa={forward:function(t){const{l:e,a:i,b:r}=Ph(t),l=Math.atan2(r,i)*Ts;return{h:l<0?l+360:l,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*tg,i=t.c;return Dh({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:np(t.h,e.h,i),c:Mi(t.c,e.c,i),l:Mi(t.l,e.l,i),alpha:Mi(t.alpha,e.alpha,i)}}};var Lh=Object.freeze({__proto__:null,hcl:Fa,lab:Oa});class Fl{constructor(e,i,r,l,u){this.type=e,this.operator=i,this.interpolation=r,this.input=l,this.labels=[],this.outputs=[];for(const[p,g]of u)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,i,r,l){let u=0;if(e.name==="exponential")u=Ba(i,e.base,r,l);else if(e.name==="linear")u=Ba(i,1,r,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new Wt(p[0],p[1],p[2],p[3]).solve(Ba(i,1,r,l))}return u}static parse(e,i){let[r,l,u,...p]=e;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const b=l[1];if(typeof b!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const b=l.slice(1);if(b.length!==4||b.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,wt),!u)return null;const g=[];let v=null;r==="interpolate-hcl"||r==="interpolate-lab"?v=ns:i.expectedType&&i.expectedType.kind!=="value"&&(v=i.expectedType);for(let b=0;b<p.length;b+=2){const M=p[b],A=p[b+1],C=b+3,R=b+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(g.length&&g[g.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const k=i.parse(A,R,v);if(!k)return null;v=v||k.type,g.push([M,k])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Fl(v,r,l,u,g):i.error(`Type ${zn(v)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return r[0].evaluate(e);const u=i.length;if(l>=i[u-1])return r[u-1].evaluate(e);const p=ea(i,l),g=Fl.interpolationFactor(this.interpolation,l,i[p],i[p+1]),v=r[p].evaluate(e),b=r[p+1].evaluate(e);return this.operator==="interpolate"?Gc[this.type.kind.toLowerCase()](v,b,g):this.operator==="interpolate-hcl"?Fa.reverse(Fa.interpolate(Fa.forward(v),Fa.forward(b),g)):Oa.reverse(Oa.interpolate(Oa.forward(v),Oa.forward(b),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function Ba(t,e,i,r){const l=r-i,u=t-i;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}var Zr=Fl;class Na{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const l=i.expectedType;l&&l.kind!=="value"&&(r=l);const u=[];for(const g of e.slice(1)){const v=i.parse(g,1+u.length,r,void 0,{typeAnnotation:"omit"});if(!v)return null;r=r||v.type,u.push(v)}const p=l&&u.some(g=>Wo(l,g.type));return new Na(p?Ci:r,u)}evaluate(e){let i,r=null,l=0;for(const u of this.args){if(l++,r=u.evaluate(e),r&&r instanceof Ht&&!r.available&&(i||(i=r),r=null,l===this.args.length))return i;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Rh=Na;class ru{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);const g=i.parse(e[u+1],u+1);if(!g)return null;r.push([p,g])}const l=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return l?new ru(r,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var zh=ru;class Mo{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,wt),l=i.parse(e[2],2,Fr(i.expectedType||Ci));return r&&l?new Mo(l.type.itemType,r,l):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new $n(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new $n(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new $n(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Pi=Mo;class kh{constructor(e,i){this.type=Gi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Ci),l=i.parse(e[2],2,Ci);return r&&l?ei(r.type,[Gi,ji,wt,Ma,Ci])?new kh(r,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${zn(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!mo(i,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${zn(Gn(i))} instead.`);if(!mo(r,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${zn(Gn(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ig=kh;class su{constructor(e,i,r){this.type=wt,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Ci),l=i.parse(e[2],2,Ci);if(!r||!l)return null;if(!ei(r.type,[Gi,ji,wt,Ma,Ci]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${zn(r.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,wt);return u?new su(r,l,u):null}return new su(r,l)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!mo(i,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${zn(Gn(i))} instead.`);if(!mo(r,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${zn(Gn(r))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return r.indexOf(i,l)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var rp=su;class Oh{constructor(e,i,r,l,u,p){this.inputType=e,this.type=i,this.input=r,this.cases=l,this.outputs=u,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const u={},p=[];for(let b=2;b<e.length-1;b+=2){let M=e[b];const A=e[b+1];Array.isArray(M)||(M=[M]);const C=i.concat(b);if(M.length===0)return C.error("Expected at least one branch label.");for(const k of M){if(typeof k!="number"&&typeof k!="string")return C.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return C.error("Numeric branch labels must be integer values.");if(r){if(C.checkSubtype(r,Gn(k)))return null}else r=Gn(k);if(u[String(k)]!==void 0)return C.error("Branch labels must be unique.");u[String(k)]=p.length}const R=i.parse(A,b,l);if(!R)return null;l=l||R.type,p.push(R)}const g=i.parse(e[1],1,Ci);if(!g)return null;const v=i.parse(e[e.length-1],e.length-1,l);return v?g.type.kind!=="value"&&i.concat(1).checkSubtype(r,g.type)?null:new Oh(r,l,g,u,p,v):null}evaluate(e){const i=this.input.evaluate(e);return(Gn(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],l={};for(const p of i){const g=l[this.cases[p]];g===void 0?(l[this.cases[p]]=r.length,r.push([this.cases[p],[p]])):r[g][1].push(p)}const u=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,g]of r)e.push(g.length===1?u(g[0]):g.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var sp=Oh;class ou{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const g=i.parse(e[p],p,Gi);if(!g)return null;const v=i.parse(e[p+1],p+1,r);if(!v)return null;l.push([g,v]),r=r||v.type}const u=i.parse(e[e.length-1],e.length-1,r);return u?new ou(r,l,u):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var op=ou;class Bl{constructor(e,i,r,l){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Ci),l=i.parse(e[2],2,wt);if(!r||!l)return null;if(!ei(r.type,[Fr(Ci),ji,Ci]))return i.error(`Expected first argument to be of type array or string, but found ${zn(r.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,wt);return u?new Bl(r.type,r,l,u):null}return new Bl(r.type,r,l)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!mo(i,["string","array"]))throw new $n(`Expected first argument to be of type array or string, but found ${zn(Gn(i))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return i.slice(r,l)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Va=Bl;function Fh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Bh(t,e,i,r){return r.compare(e,i)===0}function Ua(t,e,i){const r=t!=="=="&&t!=="!=";return class uS{constructor(u,p,g){this.type=Gi,this.lhs=u,this.rhs=p,this.collator=g,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const g=u[0];let v=p.parse(u[1],1,Ci);if(!v)return null;if(!Fh(g,v.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${zn(v.type)}'.`);let b=p.parse(u[2],2,Ci);if(!b)return null;if(!Fh(g,b.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${zn(b.type)}'.`);if(v.type.kind!==b.type.kind&&v.type.kind!=="value"&&b.type.kind!=="value")return p.error(`Cannot compare types '${zn(v.type)}' and '${zn(b.type)}'.`);r&&(v.type.kind==="value"&&b.type.kind!=="value"?v=new Hs(b.type,[v]):v.type.kind!=="value"&&b.type.kind==="value"&&(b=new Hs(v.type,[b])));let M=null;if(u.length===4){if(v.type.kind!=="string"&&b.type.kind!=="string"&&v.type.kind!=="value"&&b.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(u[3],3,$c),!M)return null}return new uS(v,b,M)}evaluate(u){const p=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(r&&this.hasUntypedArgument){const v=Gn(p),b=Gn(g);if(v.kind!==b.kind||v.kind!=="string"&&v.kind!=="number")throw new $n(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${v.kind}, ${b.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const v=Gn(p),b=Gn(g);if(v.kind!=="string"||b.kind!=="string")return e(u,p,g)}return this.collator?i(u,p,g,this.collator.evaluate(u)):e(u,p,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[t];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const Nh=Ua("==",function(t,e,i){return e===i},Bh),Vh=Ua("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!Bh(0,e,i,r)}),ng=Ua("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),rg=Ua(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),ap=Ua("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),sg=Ua(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class Uh{constructor(e,i,r,l,u,p){this.type=ji,this.number=e,this.locale=i,this.currency=r,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const r=i.parse(e[1],1,wt);if(!r)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=i.parse(l.locale,1,ji),!u))return null;let p=null;if(l.currency&&(p=i.parse(l.currency,1,ji),!p))return null;let g=null;if(l.unit&&(g=i.parse(l.unit,1,ji),!g))return null;let v=null;if(l["min-fraction-digits"]&&(v=i.parse(l["min-fraction-digits"],1,wt),!v))return null;let b=null;return l["max-fraction-digits"]&&(b=i.parse(l["max-fraction-digits"],1,wt),!b)?null:new Uh(r,u,p,g,v,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class jh{constructor(e){this.type=wt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${zn(r.type)} instead.`):new jh(r):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new $n(`Expected value to be of type string or array, but found ${zn(Gn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function lp(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Gh={"==":Nh,"!=":Vh,">":rg,"<":ng,">=":sg,"<=":ap,array:Hs,at:Pi,boolean:Hs,case:op,coalesce:Rh,collator:Al,format:Ia,image:Xo,in:ig,"index-of":rp,interpolate:Zr,"interpolate-hcl":Zr,"interpolate-lab":Zr,length:jh,let:zh,literal:qs,match:sp,number:Hs,"number-format":Uh,object:Hs,slice:Va,step:Ol,string:Hs,"to-boolean":Ws,"to-color":Ws,"to-number":Ws,"to-string":Ws,var:Lr,within:Wc,distance:Jc,config:Ra};function $h(t,[e,i,r,l]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const u=l?l.evaluate(t):1,p=qf(e,i,r,u);if(p)throw new $n(p);return new Nn(e/255*u,i/255*u,r/255*u,u)}function cp(t,[e,i,r,l]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const u=l?l.evaluate(t):1,p=function(b,M,A,C){return typeof b=="number"&&b>=0&&b<=360?typeof M=="number"&&M>=0&&M<=100&&typeof A=="number"&&A>=0&&A<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[b,M,A,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[b,M,A,C]:[b,M,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[b,M,A,C]:[b,M,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,r,u);if(p)throw new $n(p);const g=`hsla(${e}, ${i}%, ${r}%, ${u})`,v=Nn.parse(g);if(!v)throw new $n(`Failed to parse HSLA color: ${g}`);return v}function qh(t,e){return t in e}function Hh(t,e){const i=e[t];return i===void 0?null:i}function ta(t){return{type:t}}Ei.register(Gh,{error:[{kind:"error"},[ji],(t,[e])=>{throw new $n(e.evaluate(t))}],typeof:[ji,[Ci],(t,[e])=>zn(Gn(e.evaluate(t)))],"to-rgba":[Fr(wt,4),[ns],(t,[e])=>e.evaluate(t).toArray()],rgb:[ns,[wt,wt,wt],$h],rgba:[ns,[wt,wt,wt,wt],$h],hsl:[ns,[wt,wt,wt],cp],hsla:[ns,[wt,wt,wt,wt],cp],has:{type:Gi,overloads:[[[ji],(t,[e])=>qh(e.evaluate(t),t.properties())],[[ji,Sa],(t,[e,i])=>qh(e.evaluate(t),i.evaluate(t))]]},get:{type:Ci,overloads:[[[ji],(t,[e])=>Hh(e.evaluate(t),t.properties())],[[ji,Sa],(t,[e,i])=>Hh(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ci,[ji],(t,[e])=>Hh(e.evaluate(t),t.featureState||{})],properties:[Sa,[],t=>t.properties()],"geometry-type":[ji,[],t=>t.geometryType()],id:[Ci,[],t=>t.id()],zoom:[wt,[],t=>t.globals.zoom],pitch:[wt,[],t=>t.globals.pitch||0],"distance-from-center":[wt,[],t=>t.distanceFromCenter()],"measure-light":[wt,[ji],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[wt,[],t=>t.globals.heatmapDensity||0],"line-progress":[wt,[],t=>t.globals.lineProgress||0],"raster-value":[wt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[wt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[wt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ci,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[wt,ta(wt),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[wt,ta(wt),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:wt,overloads:[[[wt,wt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[wt],(t,[e])=>-e.evaluate(t)]]},"/":[wt,[wt,wt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[wt,[wt,wt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[wt,[],()=>Math.LN2],pi:[wt,[],()=>Math.PI],e:[wt,[],()=>Math.E],"^":[wt,[wt,wt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[wt,[wt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[wt,[wt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[wt,[wt],(t,[e])=>Math.log(e.evaluate(t))],log2:[wt,[wt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[wt,[wt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[wt,[wt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[wt,[wt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[wt,[wt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[wt,[wt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[wt,[wt],(t,[e])=>Math.atan(e.evaluate(t))],min:[wt,ta(wt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[wt,ta(wt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[wt,[wt],(t,[e])=>Math.abs(e.evaluate(t))],round:[wt,[wt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[wt,[wt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[wt,[wt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Gi,[ji,Ci],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Gi,[Ci],(t,[e])=>t.id()===e.value],"filter-type-==":[Gi,[ji],(t,[e])=>t.geometryType()===e.value],"filter-<":[Gi,[ji,Ci],(t,[e,i])=>{const r=t.properties()[e.value],l=i.value;return typeof r==typeof l&&r<l}],"filter-id-<":[Gi,[Ci],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[Gi,[ji,Ci],(t,[e,i])=>{const r=t.properties()[e.value],l=i.value;return typeof r==typeof l&&r>l}],"filter-id->":[Gi,[Ci],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[Gi,[ji,Ci],(t,[e,i])=>{const r=t.properties()[e.value],l=i.value;return typeof r==typeof l&&r<=l}],"filter-id-<=":[Gi,[Ci],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[Gi,[ji,Ci],(t,[e,i])=>{const r=t.properties()[e.value],l=i.value;return typeof r==typeof l&&r>=l}],"filter-id->=":[Gi,[Ci],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[Gi,[Ci],(t,[e])=>e.value in t.properties()],"filter-has-id":[Gi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Gi,[Fr(ji)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Gi,[Fr(Ci)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Gi,[ji,Fr(Ci)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Gi,[ji,Fr(Ci)],(t,[e,i])=>function(r,l,u,p){for(;u<=p;){const g=u+p>>1;if(l[g]===r)return!0;l[g]>r?p=g-1:u=g+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Gi,overloads:[[[Gi,Gi],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[ta(Gi),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Gi,overloads:[[[Gi,Gi],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[ta(Gi),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Gi,[Gi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Gi,[ji],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ji,[ji],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ji,[ji],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ji,ta(Ci),(t,e)=>e.map(i=>rs(i.evaluate(t))).join("")],"resolved-locale":[ji,[$c],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[wt,[wt,wt,Ci],(t,e)=>{const[i,r,l]=e.map(p=>p.evaluate(t));if(i>r||i===r)return i;let u;if(typeof l=="string")u=function(p){let g=0;if(p.length===0)return g;for(let v=0;v<p.length;v++)g=(g<<5)-g+p.charCodeAt(v),g|=0;return g}(l);else{if(typeof l!="number")throw new $n(`Invalid seed input: ${l}`);u=l}return i+lp(u)()*(r-i)}]});var ja=Gh;function Wh(t){return{result:"success",value:t}}function ia(t){return{result:"error",value:t}}function up(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function au(t){return t["property-type"]==="data-driven"}function Zh(t){return up(t.expression,"measure-light")}function hp(t){return up(t.expression,"zoom")}function Xh(t){return!!t.expression&&t.expression.interpolated}function lu(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function dp(t){return t}function Yh(t,e){const i=e.type==="color",r=t.stops&&typeof t.stops[0][0]=="object",l=r||!(r||t.property!==void 0),u=t.type||(Xh(e)?"exponential":"interval");if(i&&((t=rh({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],Nn.parse(b[1])])),t.default=Nn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Lh[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,g,v;if(u==="exponential")p=fp;else if(u==="interval")p=ag;else if(u==="categorical"){p=og,g=Object.create(null);for(const b of t.stops)g[b[0]]=b[1];v=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=pp}if(r){const b={},M=[];for(let R=0;R<t.stops.length;R++){const k=t.stops[R],O=k[0].zoom;b[O]===void 0&&(b[O]={zoom:O,type:t.type,property:t.property,default:t.default,stops:[]},M.push(O)),b[O].stops.push([k[0].value,k[1]])}const A=[];for(const R of M)A.push([b[R].zoom,Yh(b[R],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:Zr.interpolationFactor.bind(void 0,C),zoomStops:A.map(R=>R[0]),evaluate:({zoom:R},k)=>fp({stops:A,base:t.base},e,R).evaluate(R,k)}}if(l){const b=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Zr.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(M=>M[0]),evaluate:({zoom:M})=>p(t,e,M,g,v)}}return{kind:"source",evaluate(b,M){const A=M&&M.properties?M.properties[t.property]:void 0;return A===void 0?Nl(t.default,e.default):p(t,e,A,g,v)}}}function Nl(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function og(t,e,i,r,l){return Nl(typeof i===l?r[i]:void 0,t.default,e.default)}function ag(t,e,i){if(Ca(i)!=="number")return Nl(t.default,e.default);const r=t.stops.length;if(r===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const l=ea(t.stops.map(u=>u[0]),i);return t.stops[l][1]}function fp(t,e,i){const r=t.base!==void 0?t.base:1;if(Ca(i)!=="number")return Nl(t.default,e.default);const l=t.stops.length;if(l===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[l-1][0])return t.stops[l-1][1];const u=ea(t.stops.map(M=>M[0]),i),p=function(M,A,C,R){const k=R-C,O=M-C;return k===0?0:A===1?O/k:(Math.pow(A,O)-1)/(Math.pow(A,k)-1)}(i,r,t.stops[u][0],t.stops[u+1][0]),g=t.stops[u][1],v=t.stops[u+1][1];let b=Gc[e.type]||dp;if(t.colorSpace&&t.colorSpace!=="rgb"){const M=Lh[t.colorSpace];b=(A,C)=>M.reverse(M.interpolate(M.forward(A),M.forward(C),p))}return typeof g.evaluate=="function"?{evaluate(...M){const A=g.evaluate.apply(void 0,M),C=v.evaluate.apply(void 0,M);if(A!==void 0&&C!==void 0)return b(A,C,p)}}:b(g,v,p)}function pp(t,e,i){return e.type==="color"?i=Nn.parse(i):e.type==="formatted"?i=pr.fromString(i.toString()):e.type==="resolvedImage"?i=Ht.fromString(i.toString()):Ca(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Nl(i,t.default,e.default)}class cu{constructor(e,i,r,l){this.expression=e,this._warningHistory={},this._evaluator=new Hf(r,l),this._defaultValue=i?function(u){return u.type==="color"&&(lu(u.default)||Array.isArray(u.default))?new Nn(0,0,0,0):u.type==="color"?Nn.parse(u.default)||null:u.default===void 0?null:u.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,r,l,u,p,g,v){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,l,u,p,g,v){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new $n(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Vl(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in ja}function uu(t,e,i,r){const l=new Qf(ja,[],e?function(p){const g={color:ns,string:ji,number:wt,enum:ji,boolean:Gi,formatted:Ea,resolvedImage:Sl};return p.type==="array"?Fr(g[p.value]||Ci,p.length):g[p.type]}(e):void 0,void 0,void 0,i,r),u=l.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Wh(new cu(u,e,i,r)):ia(l.errors)}class Kh{constructor(e,i,r){this.kind=e,this._styleExpression=i,this.isLightConstant=r,this.isStateDependent=e!=="constant"&&!zl(i.expression),this.isConfigDependent=!kl(i.expression)}evaluateWithoutErrorHandling(e,i,r,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,l,u,p)}evaluate(e,i,r,l,u,p){return this._styleExpression.evaluate(e,i,r,l,u,p)}}class Ul{constructor(e,i,r,l,u){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!zl(i.expression),this.isLightConstant=u,this.isConfigDependent=!kl(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,i,r,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,l,u,p)}evaluate(e,i,r,l,u,p){return this._styleExpression.evaluate(e,i,r,l,u,p)}interpolationFactor(e,i,r){return this.interpolationType?Zr.interpolationFactor(this.interpolationType,e,i,r):0}}function hu(t,e,i,r){if((t=uu(t,e,i,r)).result==="error")return t;const l=t.value.expression,u=za(l);if(!u&&!au(e))return ia([new Fs("","data expressions not supported")]);const p=mr(l,["zoom","pitch","distance-from-center"]);if(!p&&!hp(e))return ia([new Fs("","zoom expressions not supported")]);const g=mr(l,["measure-light"]);if(!g&&!Zh(e))return ia([new Fs("","measure-light expression not supported")]);const v=e.expression&&e.expression.relaxZoomRestriction,b=Gl(l);return b||p||v?b instanceof Fs?ia([b]):b instanceof Zr&&!Xh(e)?ia([new Fs("",'"interpolate" expressions cannot be used with this property')]):Wh(b?new Ul(u?"camera":"composite",t.value,b.labels,b instanceof Zr?b.interpolation:void 0,g):new Kh(u?"constant":"source",t.value,g)):ia([new Fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class jl{constructor(e,i){this._parameters=e,this._specification=i,rh(this,Yh(this._parameters,this._specification))}static deserialize(e){return new jl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Gl(t){let e=null;if(t instanceof zh)e=Gl(t.result);else if(t instanceof Rh){for(const i of t.args)if(e=Gl(i),e)break}else(t instanceof Ol||t instanceof Zr)&&t.input instanceof Ei&&t.input.name==="zoom"&&(e=t);return e instanceof Fs||t.eachChild(i=>{const r=Gl(i);r instanceof Fs?e=r:e&&r&&e!==r&&(e=new Fs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var lg=Ss,Ms=3;function Ss(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(i=l[2]);for(var u=0;u<this.d*this.d;u++){var p=l[Ms+u],g=l[Ms+u+1];r.push(p===g?null:l.subarray(p,g))}var v=l[Ms+r.length+1];this.keys=l.subarray(l[Ms+r.length],v),this.bboxes=l.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var b=0;b<this.d*this.d;b++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var M=i/e*t;this.min=-M,this.max=t+M}Ss.prototype.insert=function(t,e,i,r,l){this._forEachCell(e,i,r,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(l)},Ss.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ss.prototype._insertCell=function(t,e,i,r,l,u){this.cells[l].push(u)},Ss.prototype.query=function(t,e,i,r,l){var u=this.min,p=this.max;if(t<=u&&e<=u&&p<=i&&p<=r&&!l)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,i,r,this._queryCell,g,{},l),g},Ss.prototype._queryCell=function(t,e,i,r,l,u,p,g){var v=this.cells[l];if(v!==null)for(var b=this.keys,M=this.bboxes,A=0;A<v.length;A++){var C=v[A];if(p[C]===void 0){var R=4*C;(g?g(M[R+0],M[R+1],M[R+2],M[R+3]):t<=M[R+2]&&e<=M[R+3]&&i>=M[R+0]&&r>=M[R+1])?(p[C]=!0,u.push(b[C])):p[C]=!1}}},Ss.prototype._forEachCell=function(t,e,i,r,l,u,p,g){for(var v=this._convertToCellCoord(t),b=this._convertToCellCoord(e),M=this._convertToCellCoord(i),A=this._convertToCellCoord(r),C=v;C<=M;C++)for(var R=b;R<=A;R++){var k=this.d*R+C;if((!g||g(this._convertFromCellCoord(C),this._convertFromCellCoord(R),this._convertFromCellCoord(C+1),this._convertFromCellCoord(R+1)))&&l.call(this,t,e,i,r,k,u,p,g))return}},Ss.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ss.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ss.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Ms+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var l=new Int32Array(e+i+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,p=0;p<t.length;p++){var g=t[p];l[Ms+p]=u,l.set(g,u),u+=g.length}return l[Ms+t.length]=u,l.set(this.keys,u),l[Ms+t.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};var Xs=gt(lg);const $l={};function Mt(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),$l[e]={klass:t,omit:i.omit||[]}}Mt(Object,"Object"),Xs.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},Xs.deserialize=function(t){return new Xs(t.buffer)},Object.defineProperty(Xs,"name",{value:"Grid"}),Mt(Xs,"Grid"),Mt(Nn,"Color"),Mt(Error,"Error"),Mt(pr,"Formatted"),Mt(Aa,"FormattedSection"),Mt(Un,"AJAXError"),Mt(Ht,"ResolvedImage"),Mt(jl,"StylePropertyFunction"),Mt(cu,"StyleExpression",{omit:["_evaluator"]}),Mt(Ul,"ZoomDependentExpression"),Mt(Kh,"ZoomConstantExpression"),Mt(Ei,"CompoundExpression",{omit:["_evaluate"]});for(const t in ja)$l[ja[t]._classRegistryKey]||Mt(ja[t],`Expression${t}`);function mp(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function du(t){return self.ImageBitmap&&t instanceof ImageBitmap}function So(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(mp(t)||du(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(So(r,e));return i}if(t instanceof Map){const i={$name:"Map"};for(const[r,l]of t.entries())i[r]=So(l);return i}if(typeof t=="object"){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const l=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const u in t)t.hasOwnProperty(u)&&($l[r].omit.indexOf(u)>=0||(l[u]=So(t[u],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}throw new Error("can't serialize object of type "+typeof t)}function na(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||mp(t)||du(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(na);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const l=new Map;for(const u of Object.keys(t))u!=="$name"&&l.set(u,na(t[u]));return l}const{klass:i}=$l[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const l of Object.keys(t))l!=="$name"&&(r[l]=na(t[l]));return r}throw new Error("can't deserialize object of type "+typeof t)}const Dt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Eo(t){for(const e of t)if(Jh(e.charCodeAt(0)))return!0;return!1}function cg(t){for(const e of t)if(!ug(e.charCodeAt(0)))return!1;return!0}function ug(t){return!(Dt.Arabic(t)||Dt["Arabic Supplement"](t)||Dt["Arabic Extended-A"](t)||Dt["Arabic Presentation Forms-A"](t)||Dt["Arabic Presentation Forms-B"](t))}function Jh(t){return!(t!==746&&t!==747&&(t<4352||!(Dt["Bopomofo Extended"](t)||Dt.Bopomofo(t)||Dt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Dt["CJK Compatibility Ideographs"](t)||Dt["CJK Compatibility"](t)||Dt["CJK Radicals Supplement"](t)||Dt["CJK Strokes"](t)||!(!Dt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Dt["CJK Unified Ideographs Extension A"](t)||Dt["CJK Unified Ideographs"](t)||Dt["Enclosed CJK Letters and Months"](t)||Dt["Hangul Compatibility Jamo"](t)||Dt["Hangul Jamo Extended-A"](t)||Dt["Hangul Jamo Extended-B"](t)||Dt["Hangul Jamo"](t)||Dt["Hangul Syllables"](t)||Dt.Hiragana(t)||Dt["Ideographic Description Characters"](t)||Dt.Kanbun(t)||Dt["Kangxi Radicals"](t)||Dt["Katakana Phonetic Extensions"](t)||Dt.Katakana(t)&&t!==12540||!(!Dt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Dt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Dt["Unified Canadian Aboriginal Syllabics"](t)||Dt["Unified Canadian Aboriginal Syllabics Extended"](t)||Dt["Vertical Forms"](t)||Dt["Yijing Hexagram Symbols"](t)||Dt["Yi Syllables"](t)||Dt["Yi Radicals"](t))))}function _p(t){return!(Jh(t)||function(e){return!!(Dt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Dt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Dt["Letterlike Symbols"](e)||Dt["Number Forms"](e)||Dt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Dt["Control Pictures"](e)&&e!==9251||Dt["Optical Character Recognition"](e)||Dt["Enclosed Alphanumerics"](e)||Dt["Geometric Shapes"](e)||Dt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Dt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Dt["CJK Symbols and Punctuation"](e)||Dt.Katakana(e)||Dt["Private Use Area"](e)||Dt["CJK Compatibility Forms"](e)||Dt["Small Form Variants"](e)||Dt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function gp(t){return t>=1424&&t<=2303||Dt["Arabic Presentation Forms-A"](t)||Dt["Arabic Presentation Forms-B"](t)}function yp(t,e){return!(!e&&gp(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Dt.Khmer(t))}function Qh(t){for(const e of t)if(gp(e.charCodeAt(0)))return!0;return!1}const ed="deferred",td="loading",id="loaded";let nd=null,Br="unavailable",Ao=null;const xp=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Br="error"),nd&&nd(t)};function rd(){sd.fire(new Ho("pluginStateChange",{pluginStatus:Br,pluginURL:Ao}))}const sd=new Ta,Io=function(){return Br},od=function(){if(Br!==ed||!Ao)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Br=td,rd(),Ao&&Ve({url:Ao},t=>{t?xp(t):(Br=id,rd())})},Xr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Br===id||Xr.applyArabicShaping!=null,isLoading:()=>Br===td,setState(t){Br=t.pluginStatus,Ao=t.pluginURL},isParsed:()=>Xr.applyArabicShaping!=null&&Xr.processBidirectionalText!=null&&Xr.processStyledBidirectionalText!=null,getPluginURL:()=>Ao};class bn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,r){for(const l of i)if(!yp(l.charCodeAt(0),r))return!1;return!0}(e,Xr.isLoaded())}}class fu{constructor(e,i,r,l){this.property=e,this.value=i,this.expression=function(u,p,g,v){if(lu(u))return new jl(u,p);if(Vl(u)||Array.isArray(u)&&u.length>0){const b=hu(u,p,g,v);if(b.result==="error")throw new Error(b.value.map(M=>`${M.key}: ${M.message}`).join(", "));return b.value}{let b=u;return typeof u=="string"&&p.type==="color"&&(b=Nn.parse(u)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(i===void 0?e.specification.default:i,e.specification,r,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class ad{constructor(e,i,r){this.property=e,this.value=new fu(e,void 0,i,r)}transitioned(e,i){return new ld(this.property,this.value,i,Qi({},e.transition,this.transition),e.now)}untransitioned(){return new ld(this.property,this.value,null,{},0)}}class Ys{constructor(e,i,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=r,this.isConfigDependent=!1}getValue(e){return Sr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ad(this._values[e].property,this._scope,this._options)),this._values[e].value=new fu(this._values[e].property,i===null?void 0:Sr(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const r=this._properties.properties;if(e)for(const l in e){const u=e[l];if(is(l,"-transition")){const p=l.slice(0,-11);r[p]&&this.setTransition(p,u)}else r[l]&&this.setValue(l,u)}}getTransition(e){return Sr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ad(this._values[e].property)),this._values[e].transition=Sr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r);const l=this.getTransition(i);l!==void 0&&(e[`${i}-transition`]=l)}return e}transitioned(e,i){const r=new ra(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].transitioned(e,i._values[l]);return r}untransitioned(){const e=new ra(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ld{constructor(e,i,r,l,u){const p=l.delay||0,g=l.duration||0;u=u||0,this.property=e,this.value=i,this.begin=u+p,this.end=this.begin+g,e.specification.transition&&(l.delay||l.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const l=e.now||0,u=this.value.possiblyEvaluate(e,i,r),p=this.prior;if(p){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return p.possiblyEvaluate(e,i,r);{const g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,r),u,Qe(g))}}return u}}class ra{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const l=new ql(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,i,r);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class hg{constructor(e,i,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=r,this.isConfigDependent=!1}getValue(e){return Sr(this._values[e].value)}setValue(e,i){this._values[e]=new fu(this._values[e].property,i===null?void 0:Sr(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const l=new ql(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,i,r);return l}}class Ga{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,r,l){return this.property.evaluate(this.value,this.parameters,e,i,r,l)}}class ql{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class rt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const l=Gc[this.specification.type];return l?l(e,i,r):e}}class Gt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,l){return new Ga(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},r,l)}:e.expression,i)}interpolate(e,i,r){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ga(this,{kind:"constant",value:void 0},e.parameters);const l=Gc[this.specification.type];return l?new Ga(this,{kind:"constant",value:l(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,l,u,p){return e.kind==="constant"?e.value:e.evaluate(i,r,l,u,p)}}class sa{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,l){return!!e.expression.evaluate(i,null,{},r,l)}interpolate(){return!1}}class wn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new bn(0,{});for(const r in e){const l=e[r];l.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new fu(l,void 0),p=this.defaultTransitionablePropertyValues[r]=new ad(l);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate(i)}}}function Hl(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Wl(t){if(Array.isArray(t))return t.map(Wl);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Wl(t[i]);return e}return Hl(t)}Mt(Gt,"DataDrivenProperty"),Mt(rt,"DataConstantProperty"),Mt(sa,"ColorRampProperty");var Te=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function cd(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!cd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Yr(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};cd(t)||(t=Zl(t));const i=t;let r=!0;try{r=function(b){if(!$a(b))return b;let M=Wl(b);return ud(M),M=vp(M),M}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const l=Te[`filter_${e}`],u=uu(r,l);let p=null;if(u.result==="error")throw new Error(u.value.map(b=>`${b.key}: ${b.message}`).join(", "));p=(b,M,A)=>u.value.evaluate(b,M,{},A);let g=null,v=null;if(r!==i){const b=uu(i,l);if(b.result==="error")throw new Error(b.value.map(M=>`${M.key}: ${M.message}`).join(", "));g=(M,A,C,R,k)=>b.value.evaluate(M,A,{},C,void 0,void 0,R,k),v=!za(b.value.expression)}return{filter:p,dynamicFilter:g||void 0,needGeometry:bp(r),needFeature:!!v}}function vp(t){if(!Array.isArray(t))return t;const e=function(i){if(dg.has(i[0])){for(let r=1;r<i.length;r++)if($a(i[r]))return!0}return i}(t);return e===!0?e:e.map(i=>vp(i))}function ud(t){let e=!1;const i=[];if(t[0]==="case"){for(let r=1;r<t.length-1;r+=2)e=e||$a(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||$a(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||$a(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)ud(t[r])}function $a(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if($a(t[i]))return!0;return!1}const dg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fg(t,e){return t<e?-1:t>e?1:0}function bp(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(bp(t[e]))return!0;return!1}function Zl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Xl(t[1],t[2],"=="):e==="!="?Yl(Xl(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Xl(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Zl))):e==="all"?["all"].concat(t.slice(1).map(Zl)):e==="none"?["all"].concat(t.slice(1).map(Zl).map(Yl)):e==="in"?hd(t[1],t.slice(2)):e==="!in"?Yl(hd(t[1],t.slice(2))):e==="has"?wp(t[1]):e!=="!has"||Yl(wp(t[1]));var i}function Xl(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function hd(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(fg)]]:["filter-in-small",t,["literal",e]]}}function wp(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Yl(t){return["!",t]}const pu="";function dd(t,e){return e?`${t}${pu}${e}`:t}const Kl="-transition";class Nr extends Ta{constructor(e,i,r,l){if(super(),this.id=e.id,this.fqid=dd(this.id,r),this.type=e.type,this.scope=r,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new hg(i.layout,this.scope,l),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Ys(i.paint,this.scope,l);for(const u in e.paint)this.setPaintProperty(u,e.paint[u]);for(const u in e.layout)this.setLayoutProperty(u,e.layout[u]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ql(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,i),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return is(e,Kl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const r=this._transitionablePaint,l=r._properties.properties;if(is(e,Kl)){const A=e.slice(0,-11);return l[A]&&r.setTransition(A,i||void 0),!1}if(!l[e])return!1;const u=r._values[e],p=u.value.isDataDriven(),g=u.value;r.setValue(e,i),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const v=r._values[e].value,b=v.isDataDriven(),M=is(e,"pattern")||e==="line-dasharray";return b||p||M||this._handleOverridablePaintPropertyUpdate(e,g,v)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Pr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ga&&au(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const pg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class mu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _n{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Hi(t,e=1){let i=0,r=0;return{members:t.map(l=>{const u=pg[l.type].BYTES_PER_ELEMENT,p=i=Jl(i,Math.max(e,u)),g=l.components||1;return r=Math.max(r,u),i+=u*g,{name:l.name,type:l.type,components:g,offset:p}}),size:Jl(i,Math.max(r,e)),alignment:e}}function Jl(t,e){return Math.ceil(t/e)*e}class Es extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const l=2*e;return this.int16[l+0]=i,this.int16[l+1]=r,e}}Es.prototype.bytesPerElement=4,Mt(Es,"StructArrayLayout2i4");class Rr extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,r)}emplace(e,i,r,l){const u=3*e;return this.int16[u+0]=i,this.int16[u+1]=r,this.int16[u+2]=l,e}}Rr.prototype.bytesPerElement=6,Mt(Rr,"StructArrayLayout3i6");class Ks extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,l)}emplace(e,i,r,l,u){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=r,this.int16[p+2]=l,this.int16[p+3]=u,e}}Ks.prototype.bytesPerElement=8,Mt(Ks,"StructArrayLayout4i8");class fd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,l,u)}emplace(e,i,r,l,u,p){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=p,e}}fd.prototype.bytesPerElement=10,Mt(fd,"StructArrayLayout5i10");class pd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,r,l,u,p,g)}emplace(e,i,r,l,u,p,g,v){const b=6*e,M=12*e,A=3*e;return this.int16[b+0]=i,this.int16[b+1]=r,this.uint8[M+4]=l,this.uint8[M+5]=u,this.uint8[M+6]=p,this.uint8[M+7]=g,this.float32[A+2]=v,e}}pd.prototype.bytesPerElement=12,Mt(pd,"StructArrayLayout2i4ub1f12");class Co extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,l)}emplace(e,i,r,l,u){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=l,this.float32[p+3]=u,e}}Co.prototype.bytesPerElement=16,Mt(Co,"StructArrayLayout4f16");class Po extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,l,u)}emplace(e,i,r,l,u,p){const g=6*e,v=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=r,this.uint16[g+2]=l,this.uint16[g+3]=u,this.float32[v+2]=p,e}}Po.prototype.bytesPerElement=12,Mt(Po,"StructArrayLayout4ui1f12");class qa extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,l)}emplace(e,i,r,l,u){const p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=r,this.uint16[p+2]=l,this.uint16[p+3]=u,e}}qa.prototype.bytesPerElement=8,Mt(qa,"StructArrayLayout4ui8");class _u extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,l,u,p)}emplace(e,i,r,l,u,p,g){const v=6*e;return this.int16[v+0]=i,this.int16[v+1]=r,this.int16[v+2]=l,this.int16[v+3]=u,this.int16[v+4]=p,this.int16[v+5]=g,e}}_u.prototype.bytesPerElement=12,Mt(_u,"StructArrayLayout6i12");class Ql extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g,v,b,M,A,C){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,r,l,u,p,g,v,b,M,A,C)}emplace(e,i,r,l,u,p,g,v,b,M,A,C,R){const k=12*e;return this.int16[k+0]=i,this.int16[k+1]=r,this.int16[k+2]=l,this.int16[k+3]=u,this.uint16[k+4]=p,this.uint16[k+5]=g,this.uint16[k+6]=v,this.uint16[k+7]=b,this.int16[k+8]=M,this.int16[k+9]=A,this.int16[k+10]=C,this.int16[k+11]=R,e}}Ql.prototype.bytesPerElement=24,Mt(Ql,"StructArrayLayout4i4ui4i24");class md extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,l,u,p)}emplace(e,i,r,l,u,p,g){const v=10*e,b=5*e;return this.int16[v+0]=i,this.int16[v+1]=r,this.int16[v+2]=l,this.float32[b+2]=u,this.float32[b+3]=p,this.float32[b+4]=g,e}}md.prototype.bytesPerElement=20,Mt(md,"StructArrayLayout3i3f20");class _d extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}_d.prototype.bytesPerElement=4,Mt(_d,"StructArrayLayout1ul4");class Bs extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const l=2*e;return this.uint16[l+0]=i,this.uint16[l+1]=r,e}}Bs.prototype.bytesPerElement=4,Mt(Bs,"StructArrayLayout2ui4");class gd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g,v,b,M,A,C,R){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,r,l,u,p,g,v,b,M,A,C,R)}emplace(e,i,r,l,u,p,g,v,b,M,A,C,R,k){const O=20*e,V=10*e;return this.int16[O+0]=i,this.int16[O+1]=r,this.int16[O+2]=l,this.int16[O+3]=u,this.int16[O+4]=p,this.float32[V+3]=g,this.float32[V+4]=v,this.float32[V+5]=b,this.float32[V+6]=M,this.int16[O+14]=A,this.uint32[V+8]=C,this.uint16[O+18]=R,this.uint16[O+19]=k,e}}gd.prototype.bytesPerElement=40,Mt(gd,"StructArrayLayout5i4f1i1ul2ui40");class ec extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,r,l,u,p,g)}emplace(e,i,r,l,u,p,g,v){const b=8*e;return this.int16[b+0]=i,this.int16[b+1]=r,this.int16[b+2]=l,this.int16[b+4]=u,this.int16[b+5]=p,this.int16[b+6]=g,this.int16[b+7]=v,e}}ec.prototype.bytesPerElement=16,Mt(ec,"StructArrayLayout3i2i2i16");class gu extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,l,u)}emplace(e,i,r,l,u,p){const g=4*e,v=8*e;return this.float32[g+0]=i,this.float32[g+1]=r,this.float32[g+2]=l,this.int16[v+6]=u,this.int16[v+7]=p,e}}gu.prototype.bytesPerElement=16,Mt(gu,"StructArrayLayout2f1f2i16");class yd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,l)}emplace(e,i,r,l,u){const p=12*e,g=3*e;return this.uint8[p+0]=i,this.uint8[p+1]=r,this.float32[g+1]=l,this.float32[g+2]=u,e}}yd.prototype.bytesPerElement=12,Mt(yd,"StructArrayLayout2ub2f12");class Qn extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,r)}emplace(e,i,r,l){const u=3*e;return this.uint16[u+0]=i,this.uint16[u+1]=r,this.uint16[u+2]=l,e}}Qn.prototype.bytesPerElement=6,Mt(Qn,"StructArrayLayout3ui6");class Ha extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V,j,K,ee,Q,oe){const se=this.length;return this.resize(se+1),this.emplace(se,e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V,j,K,ee,Q,oe)}emplace(e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V,j,K,ee,Q,oe,se){const he=30*e,me=15*e,xe=60*e;return this.int16[he+0]=i,this.int16[he+1]=r,this.int16[he+2]=l,this.float32[me+2]=u,this.float32[me+3]=p,this.uint16[he+8]=g,this.uint16[he+9]=v,this.uint32[me+5]=b,this.uint32[me+6]=M,this.uint32[me+7]=A,this.uint16[he+16]=C,this.uint16[he+17]=R,this.uint16[he+18]=k,this.float32[me+10]=O,this.float32[me+11]=V,this.uint8[xe+48]=j,this.uint8[xe+49]=K,this.uint8[xe+50]=ee,this.uint32[me+13]=Q,this.int16[he+28]=oe,this.uint8[xe+58]=se,e}}Ha.prototype.bytesPerElement=60,Mt(Ha,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class yu extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V,j,K,ee,Q,oe,se,he,me,xe,Ee,ve,ke,Ge,Re,je,Ce){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V,j,K,ee,Q,oe,se,he,me,xe,Ee,ve,ke,Ge,Re,je,Ce)}emplace(e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V,j,K,ee,Q,oe,se,he,me,xe,Ee,ve,ke,Ge,Re,je,Ce,Ue){const ot=20*e,qe=40*e,It=80*e;return this.float32[ot+0]=i,this.float32[ot+1]=r,this.int16[qe+4]=l,this.int16[qe+5]=u,this.int16[qe+6]=p,this.int16[qe+7]=g,this.int16[qe+8]=v,this.int16[qe+9]=b,this.int16[qe+10]=M,this.int16[qe+11]=A,this.int16[qe+12]=C,this.uint16[qe+13]=R,this.uint16[qe+14]=k,this.uint16[qe+15]=O,this.uint16[qe+16]=V,this.uint16[qe+17]=j,this.uint16[qe+18]=K,this.uint16[qe+19]=ee,this.uint16[qe+20]=Q,this.uint16[qe+21]=oe,this.uint16[qe+22]=se,this.uint16[qe+23]=he,this.uint16[qe+24]=me,this.uint16[qe+25]=xe,this.uint16[qe+26]=Ee,this.uint16[qe+27]=ve,this.uint32[ot+14]=ke,this.float32[ot+15]=Ge,this.float32[ot+16]=Re,this.float32[ot+17]=je,this.float32[ot+18]=Ce,this.uint8[It+76]=Ue,e}}yu.prototype.bytesPerElement=80,Mt(yu,"StructArrayLayout2f9i15ui1ul4f1ub80");class tc extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}tc.prototype.bytesPerElement=4,Mt(tc,"StructArrayLayout1f4");class Do extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,l,u)}emplace(e,i,r,l,u,p){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=r,this.float32[g+2]=l,this.float32[g+3]=u,this.float32[g+4]=p,e}}Do.prototype.bytesPerElement=20,Mt(Do,"StructArrayLayout5f20");class xd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,r,l,u,p,g)}emplace(e,i,r,l,u,p,g,v){const b=7*e;return this.float32[b+0]=i,this.float32[b+1]=r,this.float32[b+2]=l,this.float32[b+3]=u,this.float32[b+4]=p,this.float32[b+5]=g,this.float32[b+6]=v,e}}xd.prototype.bytesPerElement=28,Mt(xd,"StructArrayLayout7f28");class ic extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,l)}emplace(e,i,r,l,u){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=r,this.uint16[p+3]=l,this.uint16[p+4]=u,e}}ic.prototype.bytesPerElement=12,Mt(ic,"StructArrayLayout1ul3ui12");class vd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}vd.prototype.bytesPerElement=2,Mt(vd,"StructArrayLayout1ui2");class oa extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,r)}emplace(e,i,r,l){const u=3*e;return this.float32[u+0]=i,this.float32[u+1]=r,this.float32[u+2]=l,e}}oa.prototype.bytesPerElement=12,Mt(oa,"StructArrayLayout3f12");class nc extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const l=2*e;return this.float32[l+0]=i,this.float32[l+1]=r,e}}nc.prototype.bytesPerElement=8,Mt(nc,"StructArrayLayout2f8");class bd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V)}emplace(e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V,j){const K=16*e;return this.float32[K+0]=i,this.float32[K+1]=r,this.float32[K+2]=l,this.float32[K+3]=u,this.float32[K+4]=p,this.float32[K+5]=g,this.float32[K+6]=v,this.float32[K+7]=b,this.float32[K+8]=M,this.float32[K+9]=A,this.float32[K+10]=C,this.float32[K+11]=R,this.float32[K+12]=k,this.float32[K+13]=O,this.float32[K+14]=V,this.float32[K+15]=j,e}}bd.prototype.bytesPerElement=64,Mt(bd,"StructArrayLayout16f64");class rc extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,r,l,u,p,g)}emplace(e,i,r,l,u,p,g,v){const b=10*e,M=5*e;return this.uint16[b+0]=i,this.uint16[b+1]=r,this.uint16[b+2]=l,this.uint16[b+3]=u,this.float32[M+2]=p,this.float32[M+3]=g,this.float32[M+4]=v,e}}rc.prototype.bytesPerElement=20,Mt(rc,"StructArrayLayout4ui3f20");class wd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}wd.prototype.bytesPerElement=1,Mt(wd,"StructArrayLayout1ub1");class Tp extends mu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Tp.prototype.size=40;class Mp extends gd{get(e){return new Tp(this,e)}}Mt(Mp,"CollisionBoxArray");class Sp extends mu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Sp.prototype.size=60;class Ep extends Ha{get(e){return new Sp(this,e)}}Mt(Ep,"PlacedSymbolArray");class Ap extends mu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Ap.prototype.size=80;class Ip extends yu{get(e){return new Ap(this,e)}}Mt(Ip,"SymbolInstanceArray");class Cp extends tc{getoffsetX(e){return this.float32[1*e+0]}}Mt(Cp,"GlyphOffsetArray");class sc extends Es{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Mt(sc,"SymbolLineVertexArray");class Pp extends mu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Pp.prototype.size=12;class Dp extends ic{get(e){return new Pp(this,e)}}Mt(Dp,"FeatureIndexArray");class oc extends Bs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Mt(oc,"FillExtrusionCentroidArray");const mg=Hi([{name:"a_pos",components:2,type:"Int16"}],4),Lp=Hi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Cn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,r,l){let u=this.segments[this.segments.length-1];return e>Cn.MAX_VERTEX_ARRAY_LENGTH&&be(`Max vertices per segment is ${Cn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Cn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:i,primitiveOffset:r,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}prepareSegment(e,i,r,l){return this._prepareSegment(e,i.length,r.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,l){return new Cn([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:l,vaos:{},sortKey:0}])}}function Td(t,e){return 256*(t=kt(Math.floor(t),0,255))+kt(Math.floor(e),0,255)}Cn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mt(Cn,"SegmentVector");const Rp=Hi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),zp=Hi([{name:"a_dash",components:4,type:"Uint16"}]);var ac={exports:{}},xu={exports:{}};(function(t){t.exports=function(e,i){var r,l,u,p,g,v,b,M;for(l=e.length-(r=3&e.length),u=i,g=3432918353,v=461845907,M=0;M<l;)b=255&e.charCodeAt(M)|(255&e.charCodeAt(++M))<<8|(255&e.charCodeAt(++M))<<16|(255&e.charCodeAt(++M))<<24,++M,u=27492+(65535&(p=5*(65535&(u=(u^=b=(65535&(b=(b=(65535&b)*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&e.charCodeAt(M+2))<<16;case 2:b^=(255&e.charCodeAt(M+1))<<8;case 1:u^=b=(65535&(b=(b=(65535&(b^=255&e.charCodeAt(M)))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}})(xu);var Md=xu.exports,kp={exports:{}};(function(t){t.exports=function(e,i){for(var r,l=e.length,u=i^l,p=0;l>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),l-=4,++p;switch(l){case 3:u^=(255&e.charCodeAt(p+2))<<16;case 2:u^=(255&e.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}})(kp);var Op=Md,Fp=kp.exports;ac.exports=Op,ac.exports.murmur3=Op,ac.exports.murmur2=Fp;var Sd=gt(ac.exports);class lc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,r,l){this.ids.push(Bp(e)),this.positions.push(i,r,l)}eachPosition(e,i){const r=Bp(e);let l=0,u=this.ids.length-1;for(;l<u;){const p=l+u>>1;this.ids[p]>=r?u=p:l=p+1}for(;this.ids[l]===r;)i(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,i){const r=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Ed(r,l,0,r.length-1),i&&(i.add(r.buffer),i.add(l.buffer)),{ids:r,positions:l}}static deserialize(e){const i=new lc;let r;i.ids=e.ids,i.positions=e.positions;for(const l of i.ids)l!==r&&i.uniqueIds.push(l),r=l;return i.indexed=!0,i}}function Bp(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Sd(String(t))}function Ed(t,e,i,r){for(;i<r;){const l=t[i+r>>1];let u=i-1,p=r+1;for(;;){do u++;while(t[u]<l);do p--;while(t[p]>l);if(u>=p)break;vu(t,u,p),vu(e,3*u,3*p),vu(e,3*u+1,3*p+1),vu(e,3*u+2,3*p+2)}p-i<r-p?(Ed(t,e,i,p),i=p+1):(Ed(t,e,p+1,r),r=p)}}function vu(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}Mt(lc,"FeaturePositionMap");class Js{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class bu extends Js{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class Ar extends Js{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Lo extends Js{constructor(e){super(e),this.current=[0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class Np extends Js{constructor(e){super(e),this.current=[0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class h extends Js{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class n extends Js{constructor(e){super(e),this.current=Nn.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const o=new Float32Array(16);class f extends Js{constructor(e){super(e),this.current=o}set(e,i,r){if(this.fetchUniformLocation(e,i)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let l=1;l<16;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const _=new Float32Array(9),y=new Float32Array(4);class w extends Js{constructor(e){super(e),this.current=y}set(e,i,r){if(this.fetchUniformLocation(e,i)){for(let l=0;l<4;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}}function S(t){return[Td(255*t.r,255*t.g),Td(255*t.b,255*t.a)]}class I{constructor(e,i,r){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=r}setUniform(e,i,r,l,u){i.set(e,u,l.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new n(e):new Ar(e)}}class D{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,r,l,u){const p=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;p&&i.set(e,u,p)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new h(e):new Ar(e)}}class L{constructor(e,i,r,l){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(u=>({name:`a_${u}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,i,r,l,u,p,g){const v=this.paintVertexArray.length,b=this.expression.evaluate(new bn(0,{brightness:p}),i,{},u,l,g);this.paintVertexArray.resize(e),this._setPaintValue(v,e,b)}updatePaintArray(e,i,r,l,u,p,g){const v=this.expression.evaluate({zoom:0,brightness:g},r,l,void 0,u);this._setPaintValue(e,i,v)}_setPaintValue(e,i,r){if(this.type==="color"){const l=S(r);for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class z{constructor(e,i,r,l,u,p){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=r,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,r,l,u,p,g){const v=this.expression.evaluate(new bn(this.zoom,{brightness:p}),i,{},u,l,g),b=this.expression.evaluate(new bn(this.zoom+1,{brightness:p}),i,{},u,l,g),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,v,b)}updatePaintArray(e,i,r,l,u,p,g){const v=this.expression.evaluate({zoom:this.zoom,brightness:g},r,l,void 0,u),b=this.expression.evaluate({zoom:this.zoom+1,brightness:g},r,l,void 0,u);this._setPaintValue(e,i,v,b)}_setPaintValue(e,i,r,l){if(this.type==="color"){const u=S(r),p=S(l);for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,u[0],u[1],p[0],p[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,r,l);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,l,u){const p=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,g=kt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);i.set(e,u,g)}getBinding(e,i){return new Ar(e)}}class F{constructor(e,i,r,l,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(r==="array"?zp:Rp).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new l}populatePaintArray(e,i,r){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,l,u,p,g){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],p)}_setPaintValues(e,i,r,l){if(!l||!r)return;const u=l[r];if(!u)return;const{tl:p,br:g,pixelRatio:v}=u;for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,p[0],p[1],g[0],g[1],v)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class N{constructor(e,i,r=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){const p=e.paint.get(u);if(!r(u)||!(p instanceof Ga&&au(p.property.specification)))continue;const g=H(u,e.type),v=p.value,b=p.property.specification.type,M=!!p.property.useIntegerZoom,A=u==="line-dasharray"||u.endsWith("pattern"),C=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||C)if(v.kind==="source"||C||A){const R=te(u,b,"source");this.binders[u]=A?new F(v,g,b,R,e.id):new L(v,g,b,R),l.push(`/a_${u}`)}else{const R=te(u,b,"composite");this.binders[u]=new z(v,g,b,M,i,R),l.push(`/z_${u}`)}else this.binders[u]=A?new D(v.value,g):new I(v.value,g,b),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof L||i instanceof z?i.maxValue:0}populatePaintArrays(e,i,r,l,u,p,g){for(const v in this.binders){const b=this.binders[v];(b instanceof L||b instanceof z||b instanceof F)&&b.populatePaintArray(e,i,r,l,u,p,g)}}setConstantPatternPositions(e){for(const i in this.binders){const r=this.binders[i];r instanceof D&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,i,r,l,u,p,g,v){let b=!1;const M=Object.keys(e),A=M.length!==0,C=A?M:i.uniqueIds;for(const R in this.binders){const k=this.binders[R];if((k instanceof L||k instanceof z||k instanceof F)&&(k.expression.isStateDependent===!0||k.expression.isLightConstant===!1)){const O=u.paint.get(R);k.expression=O.value;for(const V of C){const j=e[V.toString()];i.eachPosition(V,(K,ee,Q)=>{const oe=l.feature(K);k.updatePaintArray(ee,Q,oe,j,p,g,v)})}if(!A)for(const V of r.uniqueIds){const j=e[V.toString()];r.eachPosition(V,(K,ee,Q)=>{const oe=l.feature(K);k.updatePaintArray(ee,Q,oe,j,p,g,v)})}b=!0}}return b}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof I||r instanceof D)&&e.push(...r.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof L||r instanceof z||r instanceof F)for(let l=0;l<r.paintVertexAttributes.length;l++)e.push(r.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof I||r instanceof D||r instanceof z)for(const l of r.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof I||l instanceof D||l instanceof z)for(const u of l.uniformNames)i.push({name:u,property:r,binding:l.getBinding(e,u)})}return i}setUniforms(e,i,r,l,u){for(const{name:p,property:g,binding:v}of r)this.binders[g].setUniform(e,v,u,l.get(g),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof L||i instanceof z||i instanceof F)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof L||r instanceof z||r instanceof F)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof L||i instanceof z||i instanceof F)&&i.destroy()}}}class ${constructor(e,i,r=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new N(l,i,r);this.needsUpload=!1,this._featureMap=new lc,this._featureMapWithoutIds=new lc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,r,l,u,p,g,v){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,i,l,u,p,g,v);i.id!==void 0?this._featureMap.add(i.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,l,u,p){for(const g of r)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,g,l,u,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const G={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function H(t,e){return G[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const U={"line-pattern":{source:Po,composite:Po},"fill-pattern":{source:Po,composite:Po},"fill-extrusion-pattern":{source:Po,composite:Po},"line-dasharray":{source:qa,composite:qa}},Y={color:{source:nc,composite:Co},number:{source:tc,composite:nc}};function te(t,e,i){const r=U[t];return r&&r[i]||Y[e][i]}Mt(I,"ConstantBinder"),Mt(D,"PatternConstantBinder"),Mt(L,"SourceExpressionBinder"),Mt(F,"PatternCompositeBinder"),Mt(z,"CompositeExpressionBinder"),Mt(N,"ProgramConfiguration",{omit:["_buffers"]}),Mt($,"ProgramConfigurationSet");const J=yt/Math.PI/2,ie=5,W=6,ne=16383,le=64,ce=[le,32,16],pe=-J,Se=J;function _e(t,e,i,r=J){return i=Zt(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function ze(t,e,i){return _e(Math.cos(Zt(t)),Math.sin(Zt(t)),e,i)}const De=63710088e-1,He=2*Math.PI*De;class ye{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ye(Kn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,l=e.lat*i,u=Math.sin(r)*Math.sin(l)+Math.cos(r)*Math.cos(l)*Math.cos((e.lng-this.lng)*i);return De*Math.acos(Math.min(u,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new Ie({lng:this.lng-r,lat:this.lat-i},{lng:this.lng+r,lat:this.lat+i})}toEcef(e){return ze(this.lat,this.lng,J+e*J/De)}static convert(e){if(e instanceof ye)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ye(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ye(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ie{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ye?new ye(e.lng,e.lat):ye.convert(e),this}setSouthWest(e){return this._sw=e instanceof ye?new ye(e.lng,e.lat):ye.convert(e),this}extend(e){const i=this._sw,r=this._ne;let l,u;if(e instanceof ye)l=e,u=e;else{if(!(e instanceof Ie))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ie.convert(e)):this.extend(ye.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ye.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return i||r?(i.lng=Math.min(l.lng,i.lng),i.lat=Math.min(l.lat,i.lat),r.lng=Math.max(u.lng,r.lng),r.lat=Math.max(u.lat,r.lat)):(this._sw=new ye(l.lng,l.lat),this._ne=new ye(u.lng,u.lat)),this}getCenter(){return new ye((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ye(this.getWest(),this.getNorth())}getSouthEast(){return new ye(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=ye.convert(e);let l=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&l}static convert(e){return!e||e instanceof Ie?e:new Ie(e)}}var fe={};(function(t,e){(function(i){function r(u,p,g){var v=l(256*u,256*(p=Math.pow(2,g)-p-1),g),b=l(256*(u+1),256*(p+1),g);return v[0]+","+v[1]+","+b[0]+","+b[1]}function l(u,p,g){var v=2*Math.PI*6378137/256/Math.pow(2,g);return[u*v-2*Math.PI*6378137/2,p*v-2*Math.PI*6378137/2]}i.getURL=function(u,p,g,v,b,M){return M=M||{},u+"?"+["bbox="+r(g,v,b),"format="+(M.format||"image/png"),"service="+(M.service||"WMS"),"version="+(M.version||"1.1.1"),"request="+(M.request||"GetMap"),"srs="+(M.srs||"EPSG:3857"),"width="+(M.width||256),"height="+(M.height||256),"layers="+p].join("&")},i.getTileBBox=r,i.getMercCoords=l,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,fe);var we=fe;class Ze{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=dt(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=we.getTileBBox(this.x,this.y,this.z),l=function(u,p,g){let v,b="";for(let M=u;M>0;M--)v=1<<M-1,b+=(p&v?1:0)+(g&v?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class it{constructor(e,i){this.wrap=e,this.canonical=i,this.key=dt(e,i.z,i.z,i.x,i.y)}}class tt{constructor(e,i,r,l,u){this.overscaledZ=e,this.wrap=i,this.canonical=new Ze(r,+l,+u),this.key=i===0&&e===r?this.canonical.key:dt(i,e,r,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new tt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new tt(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return dt(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return dt(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new tt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,l=2*this.canonical.y;return[new tt(i,this.wrap,i,r,l),new tt(i,this.wrap,i,r+1,l),new tt(i,this.wrap,i,r,l+1),new tt(i,this.wrap,i,r+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new tt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new tt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new it(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function dt(t,e,i,r,l){const u=1<<Math.min(i,22);let p=u*(l%u)+r%u;return t&&i<22&&(p+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}const Pt=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new tt(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new tt(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new tt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new tt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Mt(Ze,"CanonicalTileID"),Mt(tt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ut=0,zt=25.5;function Bt(t){return He*Math.cos(t*Math.PI/180)}function li(t){return(180+t)/360}function Jt(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ri(t,e){return t/Bt(e)}function ni(t){return 360*t-180}function Ai(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function rn(t,e){return t*Bt(Ai(e))}const yi=85.051129;function Tn(t){return Math.cos(Zt(kt(t,-yi,yi)))}function xi(t,e){const i=kt(e,Ut,zt),r=Math.pow(2,i);return Tn(t)*He/(512*r)}function zi(t){return 1/Math.cos(t*Math.PI/180)}function vi(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/yt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/yt/(1<<t.z)}class Di{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=ye.convert(e);return new Di(li(r.lng),Jt(r.lat),ri(i,r.lat))}toLngLat(){return new ye(ni(this.x),Ai(this.y))}toAltitude(){return rn(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/He*zi(Ai(this.y))}}function ln(t,e,i,r,l,u,p,g,v){const b=(e+r)/2,M=(i+l)/2,A=new $e(b,M);g(A),function(C,R,k,O,V,j){const K=k-V,ee=O-j;return Math.abs((O-R)*K-(k-C)*ee)/Math.hypot(K,ee)}(A.x,A.y,u.x,u.y,p.x,p.y)>=v?(ln(t,e,i,b,M,u,A,g,v),ln(t,b,M,r,l,A,p,g,v)):t.push(p)}function Vi(t,e,i){let r=t[0],l=r.x,u=r.y;e(r);const p=[r];for(let g=1;g<t.length;g++){const v=t[g],{x:b,y:M}=v;e(v),ln(p,l,u,b,M,r,v,e,i),l=b,u=M,r=v}return p}function er(t,e,i,r){if(r(e,i)){const l=e.add(i)._mult(.5);er(t,e,l,r),er(t,l,i,r)}else t.push(i)}function _r(t,e){let i=t[0];const r=[i];for(let l=1;l<t.length;l++){const u=t[l];er(r,i,u,e),i=u}return r}const Vr=Math.pow(2,14)-1,Ns=-Vr-1;function Ur(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=kt(i,Ns,Vr),t.y=kt(r,Ns,Vr),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&be("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function tr(t,e,i){const r=t.loadGeometry(),l=t.extent,u=yt/l;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:g,x:v,y:b,projection:M}=i,A=C=>{const R=ni((e.x+C.x/l)/p),k=Ai((e.y+C.y/l)/p),O=M.project(R,k);C.x=(O.x*g-v)*l,C.y=(O.y*g-b)*l};for(let C=0;C<r.length;C++)if(t.type!==1)r[C]=Vi(r[C],A,1);else{const R=[];for(const k of r[C])k.x<0||k.x>=l||k.y<0||k.y>=l||(A(k),R.push(k));r[C]=R}}for(const p of r)for(const g of p)Ur(g,u);return r}function qn(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?tr(t):[]}}function Ir(t,e,i,r,l){t.emplaceBack(2*e+(r+1)/2,2*i+(l+1)/2)}function zr(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class jr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Es,this.indexArray=new Qn,this.segments=new Cn,this.programConfigurations=new $(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,l){const u=this.layers[0],p=[];let g=null;u.type==="circle"&&(g=u.layout.get("circle-sort-key"));for(const{feature:b,id:M,index:A,sourceLayerIndex:C}of e){const R=this.layers[0]._featureFilter.needGeometry,k=qn(b,R);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),k,r))continue;const O=g?g.evaluate(k,{},r):void 0,V={id:M,properties:b.properties,type:b.type,sourceLayerIndex:C,index:A,geometry:R?k.geometry:tr(b,r,l),patterns:{},sortKey:O};p.push(V)}g&&p.sort((b,M)=>b.sortKey-M.sortKey);let v=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new _u,v=l.projection);for(const b of p){const{geometry:M,index:A,sourceLayerIndex:C}=b,R=e[A].feature;this.addFeature(b,M,A,i.availableImages,r,v,i.brightness),i.featureIndex.insert(R,M,A,C,this.index)}}update(e,i,r,l,u){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,r,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Lp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,l,u,p,g){for(const v of i)for(const b of v){const M=b.x,A=b.y;if(M<0||M>=yt||A<0||A>=yt)continue;if(p){const k=p.projectTilePoint(M,A,u),O=p.upVector(u,M,A),V=this.globeExtVertexArray;zr(V,k,O),zr(V,k,O),zr(V,k,O),zr(V,k,O)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=C.vertexLength;Ir(this.layoutVertexArray,M,A,-1,-1),Ir(this.layoutVertexArray,M,A,1,-1),Ir(this.layoutVertexArray,M,A,1,1),Ir(this.layoutVertexArray,M,A,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},l,u,g)}}function Vs(t,e){for(let i=0;i<t.length;i++)if(Qs(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Qs(t,e[i]))return!0;return!!uc(t,e)}function Ro(t,e,i){return!!Qs(t,e)||!!hc(e,t,i)}function aa(t,e){if(t.length===1)return wu(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let l=0;l<r.length;l++)if(Qs(t,r[l]))return!0}for(let i=0;i<t.length;i++)if(wu(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(uc(t,e[i]))return!0;return!1}function cc(t,e,i){if(t.length>1){if(uc(t,e))return!0;for(let r=0;r<e.length;r++)if(hc(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(hc(t[r],e,i))return!0;return!1}function uc(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],l=t[i+1];for(let u=0;u<e.length-1;u++)if(Ad(r,l,e[u],e[u+1]))return!0}return!1}function Ad(t,e,i,r){return Xe(t,i,r)!==Xe(e,i,r)&&Xe(t,e,i)!==Xe(t,e,r)}function hc(t,e,i){const r=i*i;if(e.length===1)return t.distSqr(e[0])<r;for(let l=1;l<e.length;l++)if(Wa(t,e[l-1],e[l])<r)return!0;return!1}function Wa(t,e,i){const r=e.distSqr(i);if(r===0)return t.distSqr(e);const l=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(l<0?e:l>1?i:i.sub(e)._mult(l)._add(e))}function wu(t,e){let i,r,l,u=!1;for(let p=0;p<t.length;p++){i=t[p];for(let g=0,v=i.length-1;g<i.length;v=g++)r=i[g],l=i[v],r.y>e.y!=l.y>e.y&&e.x<(l.x-r.x)*(e.y-r.y)/(l.y-r.y)+r.x&&(u=!u)}return u}function Qs(t,e){let i=!1;for(let r=0,l=t.length-1;r<t.length;l=r++){const u=t[r],p=t[l];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(i=!i)}return i}function ax(t,e,i,r,l){for(const p of t)if(e<=p.x&&i<=p.y&&r>=p.x&&l>=p.y)return!0;const u=[new $e(e,i),new $e(e,l),new $e(r,l),new $e(r,i)];if(t.length>2){for(const p of u)if(Qs(t,p))return!0}for(let p=0;p<t.length-1;p++)if(iE(t[p],t[p+1],u))return!0;return!1}function iE(t,e,i){const r=i[0],l=i[2];if(t.x<r.x&&e.x<r.x||t.x>l.x&&e.x>l.x||t.y<r.y&&e.y<r.y||t.y>l.y&&e.y>l.y)return!1;const u=Xe(t,e,i[0]);return u!==Xe(t,e,i[1])||u!==Xe(t,e,i[2])||u!==Xe(t,e,i[3])}function Tu(t,e,i,r,l,u){let p=e.y-t.y,g=t.x-e.x;if(u=u||0){const v=p*p+g*g;if(v===0)return!0;const b=Math.sqrt(v);p/=b,g/=b}return!((i.x-t.x)*p+(i.y-t.y)*g-u<0||(r.x-t.x)*p+(r.y-t.y)*g-u<0||(l.x-t.x)*p+(l.y-t.y)*g-u<0)}function _g(t,e,i,r,l,u,p){return!(Tu(t,e,r,l,u,p)||Tu(e,i,r,l,u,p)||Tu(i,t,r,l,u,p)||Tu(r,l,t,e,i,p)||Tu(l,u,t,e,i,p)||Tu(u,r,t,e,i,p))}function Mu(t,e,i){const r=e.paint.get(t).value;return r.kind==="constant"?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Vp(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function lx(t,e,i,r,l){if(!e[0]&&!e[1])return t;const u=$e.convert(e)._mult(l);i==="viewport"&&u._rotate(-r);const p=[];for(let g=0;g<t.length;g++)p.push(t[g].sub(u));return p}function cx(t,e,i,r){const l=$e.convert(t)._mult(r);return e==="viewport"&&l._rotate(-i),l}Mt(jr,"CircleBucket",{omit:["layers"]});const nE=new wn({"circle-sort-key":new Gt(Te.layout_circle["circle-sort-key"]),visibility:new rt(Te.layout_circle.visibility)});var rE={paint:new wn({"circle-radius":new Gt(Te.paint_circle["circle-radius"]),"circle-color":new Gt(Te.paint_circle["circle-color"]),"circle-blur":new Gt(Te.paint_circle["circle-blur"]),"circle-opacity":new Gt(Te.paint_circle["circle-opacity"]),"circle-translate":new rt(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new rt(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rt(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rt(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(Te.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new rt(Te.paint_circle["circle-emissive-strength"])}),layout:nE},sr={},or={};Object.defineProperty(or,"__esModule",{value:!0}),or.setMatrixArrayType=function(t){or.ARRAY_TYPE=hx=t},or.toRadian=function(t){return t*oE},or.equals=function(t,e){return Math.abs(t-e)<=ux*Math.max(1,Math.abs(t),Math.abs(e))},or.RANDOM=or.ARRAY_TYPE=or.EPSILON=void 0;var ux=1e-6;or.EPSILON=ux;var hx=typeof Float32Array<"u"?Float32Array:Array;or.ARRAY_TYPE=hx;var sE=Math.random;or.RANDOM=sE;var oE=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Mn={};function gg(t){return gg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gg(t)}Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.create=function(){var t=new Za.ARRAY_TYPE(4);return Za.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Mn.clone=function(t){var e=new Za.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Mn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Mn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Mn.fromValues=function(t,e,i,r){var l=new Za.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=i,l[3]=r,l},Mn.set=function(t,e,i,r,l){return t[0]=e,t[1]=i,t[2]=r,t[3]=l,t},Mn.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Mn.invert=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=i*u-l*r;return p?(t[0]=u*(p=1/p),t[1]=-r*p,t[2]=-l*p,t[3]=i*p,t):null},Mn.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Mn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Mn.multiply=fx,Mn.rotate=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=Math.sin(i),v=Math.cos(i);return t[0]=r*v+u*g,t[1]=l*v+p*g,t[2]=r*-g+u*v,t[3]=l*-g+p*v,t},Mn.scale=function(t,e,i){var r=e[1],l=e[2],u=e[3],p=i[0],g=i[1];return t[0]=e[0]*p,t[1]=r*p,t[2]=l*g,t[3]=u*g,t},Mn.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},Mn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Mn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Mn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Mn.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},Mn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Mn.subtract=px,Mn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Mn.equals=function(t,e){var i=t[0],r=t[1],l=t[2],u=t[3],p=e[0],g=e[1],v=e[2],b=e[3];return Math.abs(i-p)<=Za.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-g)<=Za.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(l-v)<=Za.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-b)<=Za.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))},Mn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Mn.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},Mn.sub=Mn.mul=void 0;var Za=function(t,e){if(t&&t.__esModule)return t;if(t===null||gg(t)!=="object"&&typeof t!="function")return{default:t};var i=dx(void 0);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}(or);function dx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(dx=function(r){return r?i:e})(t)}function fx(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=i[0],v=i[1],b=i[2],M=i[3];return t[0]=r*g+u*v,t[1]=l*g+p*v,t[2]=r*b+u*M,t[3]=l*b+p*M,t}function px(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Mn.mul=fx,Mn.sub=px;var En={};function yg(t){return yg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yg(t)}Object.defineProperty(En,"__esModule",{value:!0}),En.create=function(){var t=new zo.ARRAY_TYPE(6);return zo.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},En.clone=function(t){var e=new zo.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},En.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},En.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},En.fromValues=function(t,e,i,r,l,u){var p=new zo.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=i,p[3]=r,p[4]=l,p[5]=u,p},En.set=function(t,e,i,r,l,u,p){return t[0]=e,t[1]=i,t[2]=r,t[3]=l,t[4]=u,t[5]=p,t},En.invert=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=i*u-r*l;return v?(t[0]=u*(v=1/v),t[1]=-r*v,t[2]=-l*v,t[3]=i*v,t[4]=(l*g-u*p)*v,t[5]=(r*p-i*g)*v,t):null},En.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},En.multiply=_x,En.rotate=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],b=Math.sin(i),M=Math.cos(i);return t[0]=r*M+u*b,t[1]=l*M+p*b,t[2]=r*-b+u*M,t[3]=l*-b+p*M,t[4]=g,t[5]=v,t},En.scale=function(t,e,i){var r=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=i[0],b=i[1];return t[0]=e[0]*v,t[1]=r*v,t[2]=l*b,t[3]=u*b,t[4]=p,t[5]=g,t},En.translate=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],b=i[0],M=i[1];return t[0]=r,t[1]=l,t[2]=u,t[3]=p,t[4]=r*b+u*M+g,t[5]=l*b+p*M+v,t},En.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t},En.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},En.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},En.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},En.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},En.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},En.subtract=gx,En.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},En.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},En.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},En.equals=function(t,e){var i=t[0],r=t[1],l=t[2],u=t[3],p=t[4],g=t[5],v=e[0],b=e[1],M=e[2],A=e[3],C=e[4],R=e[5];return Math.abs(i-v)<=zo.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-b)<=zo.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(l-M)<=zo.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(u-A)<=zo.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(p-C)<=zo.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-R)<=zo.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))},En.sub=En.mul=void 0;var zo=function(t,e){if(t&&t.__esModule)return t;if(t===null||yg(t)!=="object"&&typeof t!="function")return{default:t};var i=mx(void 0);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}(or);function mx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(mx=function(r){return r?i:e})(t)}function _x(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],b=i[0],M=i[1],A=i[2],C=i[3],R=i[4],k=i[5];return t[0]=r*b+u*M,t[1]=l*b+p*M,t[2]=r*A+u*C,t[3]=l*A+p*C,t[4]=r*R+u*k+g,t[5]=l*R+p*k+v,t}function gx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}En.mul=_x,En.sub=gx;var tn={};function xg(t){return xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xg(t)}Object.defineProperty(tn,"__esModule",{value:!0}),tn.create=function(){var t=new As.ARRAY_TYPE(9);return As.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},tn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},tn.clone=function(t){var e=new As.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},tn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},tn.fromValues=function(t,e,i,r,l,u,p,g,v){var b=new As.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=i,b[3]=r,b[4]=l,b[5]=u,b[6]=p,b[7]=g,b[8]=v,b},tn.set=function(t,e,i,r,l,u,p,g,v,b){return t[0]=e,t[1]=i,t[2]=r,t[3]=l,t[4]=u,t[5]=p,t[6]=g,t[7]=v,t[8]=b,t},tn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},tn.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},tn.invert=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],b=e[7],M=e[8],A=M*p-g*b,C=-M*u+g*v,R=b*u-p*v,k=i*A+r*C+l*R;return k?(t[0]=A*(k=1/k),t[1]=(-M*r+l*b)*k,t[2]=(g*r-l*p)*k,t[3]=C*k,t[4]=(M*i-l*v)*k,t[5]=(-g*i+l*u)*k,t[6]=R*k,t[7]=(-b*i+r*v)*k,t[8]=(p*i-r*u)*k,t):null},tn.adjoint=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],b=e[7],M=e[8];return t[0]=p*M-g*b,t[1]=l*b-r*M,t[2]=r*g-l*p,t[3]=g*v-u*M,t[4]=i*M-l*v,t[5]=l*u-i*g,t[6]=u*b-p*v,t[7]=r*v-i*b,t[8]=i*p-r*u,t},tn.determinant=function(t){var e=t[3],i=t[4],r=t[5],l=t[6],u=t[7],p=t[8];return t[0]*(p*i-r*u)+t[1]*(-p*e+r*l)+t[2]*(u*e-i*l)},tn.multiply=xx,tn.translate=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=e[8],C=i[0],R=i[1];return t[0]=r,t[1]=l,t[2]=u,t[3]=p,t[4]=g,t[5]=v,t[6]=C*r+R*p+b,t[7]=C*l+R*g+M,t[8]=C*u+R*v+A,t},tn.rotate=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=e[8],C=Math.sin(i),R=Math.cos(i);return t[0]=R*r+C*p,t[1]=R*l+C*g,t[2]=R*u+C*v,t[3]=R*p-C*r,t[4]=R*g-C*l,t[5]=R*v-C*u,t[6]=b,t[7]=M,t[8]=A,t},tn.scale=function(t,e,i){var r=i[0],l=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=l*e[3],t[4]=l*e[4],t[5]=l*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},tn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},tn.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},tn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},tn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},tn.fromQuat=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=i+i,g=r+r,v=l+l,b=i*p,M=r*p,A=r*g,C=l*p,R=l*g,k=l*v,O=u*p,V=u*g,j=u*v;return t[0]=1-A-k,t[3]=M-j,t[6]=C+V,t[1]=M+j,t[4]=1-b-k,t[7]=R-O,t[2]=C-V,t[5]=R+O,t[8]=1-b-A,t},tn.normalFromMat4=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],b=e[7],M=e[8],A=e[9],C=e[10],R=e[11],k=e[12],O=e[13],V=e[14],j=e[15],K=i*g-r*p,ee=i*v-l*p,Q=i*b-u*p,oe=r*v-l*g,se=r*b-u*g,he=l*b-u*v,me=M*O-A*k,xe=M*V-C*k,Ee=M*j-R*k,ve=A*V-C*O,ke=A*j-R*O,Ge=C*j-R*V,Re=K*Ge-ee*ke+Q*ve+oe*Ee-se*xe+he*me;return Re?(t[0]=(g*Ge-v*ke+b*ve)*(Re=1/Re),t[1]=(v*Ee-p*Ge-b*xe)*Re,t[2]=(p*ke-g*Ee+b*me)*Re,t[3]=(l*ke-r*Ge-u*ve)*Re,t[4]=(i*Ge-l*Ee+u*xe)*Re,t[5]=(r*Ee-i*ke-u*me)*Re,t[6]=(O*he-V*se+j*oe)*Re,t[7]=(V*Q-k*he-j*ee)*Re,t[8]=(k*se-O*Q+j*K)*Re,t):null},tn.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},tn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},tn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},tn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},tn.subtract=vx,tn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},tn.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t},tn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},tn.equals=function(t,e){var i=t[0],r=t[1],l=t[2],u=t[3],p=t[4],g=t[5],v=t[6],b=t[7],M=t[8],A=e[0],C=e[1],R=e[2],k=e[3],O=e[4],V=e[5],j=e[6],K=e[7],ee=e[8];return Math.abs(i-A)<=As.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(r-C)<=As.EPSILON*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(l-R)<=As.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(u-k)<=As.EPSILON*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(p-O)<=As.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(g-V)<=As.EPSILON*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(v-j)<=As.EPSILON*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(b-K)<=As.EPSILON*Math.max(1,Math.abs(b),Math.abs(K))&&Math.abs(M-ee)<=As.EPSILON*Math.max(1,Math.abs(M),Math.abs(ee))},tn.sub=tn.mul=void 0;var As=function(t,e){if(t&&t.__esModule)return t;if(t===null||xg(t)!=="object"&&typeof t!="function")return{default:t};var i=yx(void 0);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}(or);function yx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(yx=function(r){return r?i:e})(t)}function xx(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=e[8],C=i[0],R=i[1],k=i[2],O=i[3],V=i[4],j=i[5],K=i[6],ee=i[7],Q=i[8];return t[0]=C*r+R*p+k*b,t[1]=C*l+R*g+k*M,t[2]=C*u+R*v+k*A,t[3]=O*r+V*p+j*b,t[4]=O*l+V*g+j*M,t[5]=O*u+V*v+j*A,t[6]=K*r+ee*p+Q*b,t[7]=K*l+ee*g+Q*M,t[8]=K*u+ee*v+Q*A,t}function vx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}tn.mul=xx,tn.sub=vx;var di={};function vg(t){return vg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vg(t)}Object.defineProperty(di,"__esModule",{value:!0}),di.create=function(){var t=new Ln.ARRAY_TYPE(16);return Ln.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},di.clone=function(t){var e=new Ln.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},di.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},di.fromValues=function(t,e,i,r,l,u,p,g,v,b,M,A,C,R,k,O){var V=new Ln.ARRAY_TYPE(16);return V[0]=t,V[1]=e,V[2]=i,V[3]=r,V[4]=l,V[5]=u,V[6]=p,V[7]=g,V[8]=v,V[9]=b,V[10]=M,V[11]=A,V[12]=C,V[13]=R,V[14]=k,V[15]=O,V},di.set=function(t,e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V){return t[0]=e,t[1]=i,t[2]=r,t[3]=l,t[4]=u,t[5]=p,t[6]=g,t[7]=v,t[8]=b,t[9]=M,t[10]=A,t[11]=C,t[12]=R,t[13]=k,t[14]=O,t[15]=V,t},di.identity=wx,di.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],l=e[3],u=e[6],p=e[7],g=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=u,t[11]=e[14],t[12]=l,t[13]=p,t[14]=g}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},di.invert=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],b=e[7],M=e[8],A=e[9],C=e[10],R=e[11],k=e[12],O=e[13],V=e[14],j=e[15],K=i*g-r*p,ee=i*v-l*p,Q=i*b-u*p,oe=r*v-l*g,se=r*b-u*g,he=l*b-u*v,me=M*O-A*k,xe=M*V-C*k,Ee=M*j-R*k,ve=A*V-C*O,ke=A*j-R*O,Ge=C*j-R*V,Re=K*Ge-ee*ke+Q*ve+oe*Ee-se*xe+he*me;return Re?(t[0]=(g*Ge-v*ke+b*ve)*(Re=1/Re),t[1]=(l*ke-r*Ge-u*ve)*Re,t[2]=(O*he-V*se+j*oe)*Re,t[3]=(C*se-A*he-R*oe)*Re,t[4]=(v*Ee-p*Ge-b*xe)*Re,t[5]=(i*Ge-l*Ee+u*xe)*Re,t[6]=(V*Q-k*he-j*ee)*Re,t[7]=(M*he-C*Q+R*ee)*Re,t[8]=(p*ke-g*Ee+b*me)*Re,t[9]=(r*Ee-i*ke-u*me)*Re,t[10]=(k*se-O*Q+j*K)*Re,t[11]=(A*Q-M*se-R*K)*Re,t[12]=(g*xe-p*ve-v*me)*Re,t[13]=(i*ve-r*xe+l*me)*Re,t[14]=(O*ee-k*oe-V*K)*Re,t[15]=(M*oe-A*ee+C*K)*Re,t):null},di.adjoint=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=e[4],g=e[5],v=e[6],b=e[7],M=e[8],A=e[9],C=e[10],R=e[11],k=e[12],O=e[13],V=e[14],j=e[15];return t[0]=g*(C*j-R*V)-A*(v*j-b*V)+O*(v*R-b*C),t[1]=-(r*(C*j-R*V)-A*(l*j-u*V)+O*(l*R-u*C)),t[2]=r*(v*j-b*V)-g*(l*j-u*V)+O*(l*b-u*v),t[3]=-(r*(v*R-b*C)-g*(l*R-u*C)+A*(l*b-u*v)),t[4]=-(p*(C*j-R*V)-M*(v*j-b*V)+k*(v*R-b*C)),t[5]=i*(C*j-R*V)-M*(l*j-u*V)+k*(l*R-u*C),t[6]=-(i*(v*j-b*V)-p*(l*j-u*V)+k*(l*b-u*v)),t[7]=i*(v*R-b*C)-p*(l*R-u*C)+M*(l*b-u*v),t[8]=p*(A*j-R*O)-M*(g*j-b*O)+k*(g*R-b*A),t[9]=-(i*(A*j-R*O)-M*(r*j-u*O)+k*(r*R-u*A)),t[10]=i*(g*j-b*O)-p*(r*j-u*O)+k*(r*b-u*g),t[11]=-(i*(g*R-b*A)-p*(r*R-u*A)+M*(r*b-u*g)),t[12]=-(p*(A*V-C*O)-M*(g*V-v*O)+k*(g*C-v*A)),t[13]=i*(A*V-C*O)-M*(r*V-l*O)+k*(r*C-l*A),t[14]=-(i*(g*V-v*O)-p*(r*V-l*O)+k*(r*v-l*g)),t[15]=i*(g*C-v*A)-p*(r*C-l*A)+M*(r*v-l*g),t},di.determinant=function(t){var e=t[0],i=t[1],r=t[2],l=t[3],u=t[4],p=t[5],g=t[6],v=t[7],b=t[8],M=t[9],A=t[10],C=t[11],R=t[12],k=t[13],O=t[14],V=t[15];return(e*p-i*u)*(A*V-C*O)-(e*g-r*u)*(M*V-C*k)+(e*v-l*u)*(M*O-A*k)+(i*g-r*p)*(b*V-C*R)-(i*v-l*p)*(b*O-A*R)+(r*v-l*g)*(b*k-M*R)},di.multiply=Tx,di.translate=function(t,e,i){var r,l,u,p,g,v,b,M,A,C,R,k,O=i[0],V=i[1],j=i[2];return e===t?(t[12]=e[0]*O+e[4]*V+e[8]*j+e[12],t[13]=e[1]*O+e[5]*V+e[9]*j+e[13],t[14]=e[2]*O+e[6]*V+e[10]*j+e[14],t[15]=e[3]*O+e[7]*V+e[11]*j+e[15]):(l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=e[8],C=e[9],R=e[10],k=e[11],t[0]=r=e[0],t[1]=l,t[2]=u,t[3]=p,t[4]=g,t[5]=v,t[6]=b,t[7]=M,t[8]=A,t[9]=C,t[10]=R,t[11]=k,t[12]=r*O+g*V+A*j+e[12],t[13]=l*O+v*V+C*j+e[13],t[14]=u*O+b*V+R*j+e[14],t[15]=p*O+M*V+k*j+e[15]),t},di.scale=function(t,e,i){var r=i[0],l=i[1],u=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},di.rotate=function(t,e,i,r){var l,u,p,g,v,b,M,A,C,R,k,O,V,j,K,ee,Q,oe,se,he,me,xe,Ee,ve,ke=r[0],Ge=r[1],Re=r[2],je=Math.hypot(ke,Ge,Re);return je<Ln.EPSILON?null:(ke*=je=1/je,Ge*=je,Re*=je,l=Math.sin(i),u=Math.cos(i),v=e[1],b=e[2],M=e[3],C=e[5],R=e[6],k=e[7],V=e[9],j=e[10],K=e[11],ee=ke*ke*(p=1-u)+u,se=ke*Ge*p-Re*l,he=Ge*Ge*p+u,me=Re*Ge*p+ke*l,xe=ke*Re*p+Ge*l,Ee=Ge*Re*p-ke*l,ve=Re*Re*p+u,t[0]=(g=e[0])*ee+(A=e[4])*(Q=Ge*ke*p+Re*l)+(O=e[8])*(oe=Re*ke*p-Ge*l),t[1]=v*ee+C*Q+V*oe,t[2]=b*ee+R*Q+j*oe,t[3]=M*ee+k*Q+K*oe,t[4]=g*se+A*he+O*me,t[5]=v*se+C*he+V*me,t[6]=b*se+R*he+j*me,t[7]=M*se+k*he+K*me,t[8]=g*xe+A*Ee+O*ve,t[9]=v*xe+C*Ee+V*ve,t[10]=b*xe+R*Ee+j*ve,t[11]=M*xe+k*Ee+K*ve,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},di.rotateX=function(t,e,i){var r=Math.sin(i),l=Math.cos(i),u=e[4],p=e[5],g=e[6],v=e[7],b=e[8],M=e[9],A=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*l+b*r,t[5]=p*l+M*r,t[6]=g*l+A*r,t[7]=v*l+C*r,t[8]=b*l-u*r,t[9]=M*l-p*r,t[10]=A*l-g*r,t[11]=C*l-v*r,t},di.rotateY=function(t,e,i){var r=Math.sin(i),l=Math.cos(i),u=e[0],p=e[1],g=e[2],v=e[3],b=e[8],M=e[9],A=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l-b*r,t[1]=p*l-M*r,t[2]=g*l-A*r,t[3]=v*l-C*r,t[8]=u*r+b*l,t[9]=p*r+M*l,t[10]=g*r+A*l,t[11]=v*r+C*l,t},di.rotateZ=function(t,e,i){var r=Math.sin(i),l=Math.cos(i),u=e[0],p=e[1],g=e[2],v=e[3],b=e[4],M=e[5],A=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l+b*r,t[1]=p*l+M*r,t[2]=g*l+A*r,t[3]=v*l+C*r,t[4]=b*l-u*r,t[5]=M*l-p*r,t[6]=A*l-g*r,t[7]=C*l-v*r,t},di.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},di.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},di.fromRotation=function(t,e,i){var r,l,u,p=i[0],g=i[1],v=i[2],b=Math.hypot(p,g,v);return b<Ln.EPSILON?null:(p*=b=1/b,g*=b,v*=b,r=Math.sin(e),l=Math.cos(e),t[0]=p*p*(u=1-l)+l,t[1]=g*p*u+v*r,t[2]=v*p*u-g*r,t[3]=0,t[4]=p*g*u-v*r,t[5]=g*g*u+l,t[6]=v*g*u+p*r,t[7]=0,t[8]=p*v*u+g*r,t[9]=g*v*u-p*r,t[10]=v*v*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},di.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},di.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},di.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},di.fromRotationTranslation=Mx,di.fromQuat2=function(t,e){var i=new Ln.ARRAY_TYPE(3),r=-e[0],l=-e[1],u=-e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=r*r+l*l+u*u+p*p;return A>0?(i[0]=2*(g*p+M*r+v*u-b*l)/A,i[1]=2*(v*p+M*l+b*r-g*u)/A,i[2]=2*(b*p+M*u+g*l-v*r)/A):(i[0]=2*(g*p+M*r+v*u-b*l),i[1]=2*(v*p+M*l+b*r-g*u),i[2]=2*(b*p+M*u+g*l-v*r)),Mx(t,e,i),t},di.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},di.getScaling=Sx,di.getRotation=function(t,e){var i=new Ln.ARRAY_TYPE(3);Sx(i,e);var r=1/i[0],l=1/i[1],u=1/i[2],p=e[0]*r,g=e[1]*l,v=e[2]*u,b=e[4]*r,M=e[5]*l,A=e[6]*u,C=e[8]*r,R=e[9]*l,k=e[10]*u,O=p+M+k,V=0;return O>0?(V=2*Math.sqrt(O+1),t[3]=.25*V,t[0]=(A-R)/V,t[1]=(C-v)/V,t[2]=(g-b)/V):p>M&&p>k?(V=2*Math.sqrt(1+p-M-k),t[3]=(A-R)/V,t[0]=.25*V,t[1]=(g+b)/V,t[2]=(C+v)/V):M>k?(V=2*Math.sqrt(1+M-p-k),t[3]=(C-v)/V,t[0]=(g+b)/V,t[1]=.25*V,t[2]=(A+R)/V):(V=2*Math.sqrt(1+k-p-M),t[3]=(g-b)/V,t[0]=(C+v)/V,t[1]=(A+R)/V,t[2]=.25*V),t},di.fromRotationTranslationScale=function(t,e,i,r){var l=e[0],u=e[1],p=e[2],g=e[3],v=l+l,b=u+u,M=p+p,A=l*v,C=l*b,R=l*M,k=u*b,O=u*M,V=p*M,j=g*v,K=g*b,ee=g*M,Q=r[0],oe=r[1],se=r[2];return t[0]=(1-(k+V))*Q,t[1]=(C+ee)*Q,t[2]=(R-K)*Q,t[3]=0,t[4]=(C-ee)*oe,t[5]=(1-(A+V))*oe,t[6]=(O+j)*oe,t[7]=0,t[8]=(R+K)*se,t[9]=(O-j)*se,t[10]=(1-(A+k))*se,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},di.fromRotationTranslationScaleOrigin=function(t,e,i,r,l){var u=e[0],p=e[1],g=e[2],v=e[3],b=u+u,M=p+p,A=g+g,C=u*b,R=u*M,k=u*A,O=p*M,V=p*A,j=g*A,K=v*b,ee=v*M,Q=v*A,oe=r[0],se=r[1],he=r[2],me=l[0],xe=l[1],Ee=l[2],ve=(1-(O+j))*oe,ke=(R+Q)*oe,Ge=(k-ee)*oe,Re=(R-Q)*se,je=(1-(C+j))*se,Ce=(V+K)*se,Ue=(k+ee)*he,ot=(V-K)*he,qe=(1-(C+O))*he;return t[0]=ve,t[1]=ke,t[2]=Ge,t[3]=0,t[4]=Re,t[5]=je,t[6]=Ce,t[7]=0,t[8]=Ue,t[9]=ot,t[10]=qe,t[11]=0,t[12]=i[0]+me-(ve*me+Re*xe+Ue*Ee),t[13]=i[1]+xe-(ke*me+je*xe+ot*Ee),t[14]=i[2]+Ee-(Ge*me+Ce*xe+qe*Ee),t[15]=1,t},di.fromQuat=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=i+i,g=r+r,v=l+l,b=i*p,M=r*p,A=r*g,C=l*p,R=l*g,k=l*v,O=u*p,V=u*g,j=u*v;return t[0]=1-A-k,t[1]=M+j,t[2]=C-V,t[3]=0,t[4]=M-j,t[5]=1-b-k,t[6]=R+O,t[7]=0,t[8]=C+V,t[9]=R-O,t[10]=1-b-A,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},di.frustum=function(t,e,i,r,l,u,p){var g=1/(i-e),v=1/(l-r),b=1/(u-p);return t[0]=2*u*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*v,t[6]=0,t[7]=0,t[8]=(i+e)*g,t[9]=(l+r)*v,t[10]=(p+u)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*u*2*b,t[15]=0,t},di.perspectiveNO=Ex,di.perspectiveZO=function(t,e,i,r,l){var u,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=l*(u=1/(r-l)),t[14]=l*r*u):(t[10]=-1,t[14]=-r),t},di.perspectiveFromFieldOfView=function(t,e,i,r){var l=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),g=Math.tan(e.rightDegrees*Math.PI/180),v=2/(p+g),b=2/(l+u);return t[0]=v,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(p-g)*v*.5,t[9]=(l-u)*b*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t},di.orthoNO=Ax,di.orthoZO=function(t,e,i,r,l,u,p){var g=1/(e-i),v=1/(r-l),b=1/(u-p);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+i)*g,t[13]=(l+r)*v,t[14]=u*b,t[15]=1,t},di.lookAt=function(t,e,i,r){var l,u,p,g,v,b,M,A,C,R,k=e[0],O=e[1],V=e[2],j=r[0],K=r[1],ee=r[2],Q=i[0],oe=i[1],se=i[2];return Math.abs(k-Q)<Ln.EPSILON&&Math.abs(O-oe)<Ln.EPSILON&&Math.abs(V-se)<Ln.EPSILON?wx(t):(M=k-Q,A=O-oe,C=V-se,l=K*(C*=R=1/Math.hypot(M,A,C))-ee*(A*=R),u=ee*(M*=R)-j*C,p=j*A-K*M,(R=Math.hypot(l,u,p))?(l*=R=1/R,u*=R,p*=R):(l=0,u=0,p=0),g=A*p-C*u,v=C*l-M*p,b=M*u-A*l,(R=Math.hypot(g,v,b))?(g*=R=1/R,v*=R,b*=R):(g=0,v=0,b=0),t[0]=l,t[1]=g,t[2]=M,t[3]=0,t[4]=u,t[5]=v,t[6]=A,t[7]=0,t[8]=p,t[9]=b,t[10]=C,t[11]=0,t[12]=-(l*k+u*O+p*V),t[13]=-(g*k+v*O+b*V),t[14]=-(M*k+A*O+C*V),t[15]=1,t)},di.targetTo=function(t,e,i,r){var l=e[0],u=e[1],p=e[2],g=r[0],v=r[1],b=r[2],M=l-i[0],A=u-i[1],C=p-i[2],R=M*M+A*A+C*C;R>0&&(M*=R=1/Math.sqrt(R),A*=R,C*=R);var k=v*C-b*A,O=b*M-g*C,V=g*A-v*M;return(R=k*k+O*O+V*V)>0&&(k*=R=1/Math.sqrt(R),O*=R,V*=R),t[0]=k,t[1]=O,t[2]=V,t[3]=0,t[4]=A*V-C*O,t[5]=C*k-M*V,t[6]=M*O-A*k,t[7]=0,t[8]=M,t[9]=A,t[10]=C,t[11]=0,t[12]=l,t[13]=u,t[14]=p,t[15]=1,t},di.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},di.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},di.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},di.subtract=Ix,di.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},di.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t},di.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},di.equals=function(t,e){var i=t[0],r=t[1],l=t[2],u=t[3],p=t[4],g=t[5],v=t[6],b=t[7],M=t[8],A=t[9],C=t[10],R=t[11],k=t[12],O=t[13],V=t[14],j=t[15],K=e[0],ee=e[1],Q=e[2],oe=e[3],se=e[4],he=e[5],me=e[6],xe=e[7],Ee=e[8],ve=e[9],ke=e[10],Ge=e[11],Re=e[12],je=e[13],Ce=e[14],Ue=e[15];return Math.abs(i-K)<=Ln.EPSILON*Math.max(1,Math.abs(i),Math.abs(K))&&Math.abs(r-ee)<=Ln.EPSILON*Math.max(1,Math.abs(r),Math.abs(ee))&&Math.abs(l-Q)<=Ln.EPSILON*Math.max(1,Math.abs(l),Math.abs(Q))&&Math.abs(u-oe)<=Ln.EPSILON*Math.max(1,Math.abs(u),Math.abs(oe))&&Math.abs(p-se)<=Ln.EPSILON*Math.max(1,Math.abs(p),Math.abs(se))&&Math.abs(g-he)<=Ln.EPSILON*Math.max(1,Math.abs(g),Math.abs(he))&&Math.abs(v-me)<=Ln.EPSILON*Math.max(1,Math.abs(v),Math.abs(me))&&Math.abs(b-xe)<=Ln.EPSILON*Math.max(1,Math.abs(b),Math.abs(xe))&&Math.abs(M-Ee)<=Ln.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ee))&&Math.abs(A-ve)<=Ln.EPSILON*Math.max(1,Math.abs(A),Math.abs(ve))&&Math.abs(C-ke)<=Ln.EPSILON*Math.max(1,Math.abs(C),Math.abs(ke))&&Math.abs(R-Ge)<=Ln.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ge))&&Math.abs(k-Re)<=Ln.EPSILON*Math.max(1,Math.abs(k),Math.abs(Re))&&Math.abs(O-je)<=Ln.EPSILON*Math.max(1,Math.abs(O),Math.abs(je))&&Math.abs(V-Ce)<=Ln.EPSILON*Math.max(1,Math.abs(V),Math.abs(Ce))&&Math.abs(j-Ue)<=Ln.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ue))},di.sub=di.mul=di.ortho=di.perspective=void 0;var Ln=function(t,e){if(t&&t.__esModule)return t;if(t===null||vg(t)!=="object"&&typeof t!="function")return{default:t};var i=bx(void 0);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}(or);function bx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(bx=function(r){return r?i:e})(t)}function wx(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Tx(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=e[8],C=e[9],R=e[10],k=e[11],O=e[12],V=e[13],j=e[14],K=e[15],ee=i[0],Q=i[1],oe=i[2],se=i[3];return t[0]=ee*r+Q*g+oe*A+se*O,t[1]=ee*l+Q*v+oe*C+se*V,t[2]=ee*u+Q*b+oe*R+se*j,t[3]=ee*p+Q*M+oe*k+se*K,t[4]=(ee=i[4])*r+(Q=i[5])*g+(oe=i[6])*A+(se=i[7])*O,t[5]=ee*l+Q*v+oe*C+se*V,t[6]=ee*u+Q*b+oe*R+se*j,t[7]=ee*p+Q*M+oe*k+se*K,t[8]=(ee=i[8])*r+(Q=i[9])*g+(oe=i[10])*A+(se=i[11])*O,t[9]=ee*l+Q*v+oe*C+se*V,t[10]=ee*u+Q*b+oe*R+se*j,t[11]=ee*p+Q*M+oe*k+se*K,t[12]=(ee=i[12])*r+(Q=i[13])*g+(oe=i[14])*A+(se=i[15])*O,t[13]=ee*l+Q*v+oe*C+se*V,t[14]=ee*u+Q*b+oe*R+se*j,t[15]=ee*p+Q*M+oe*k+se*K,t}function Mx(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=r+r,v=l+l,b=u+u,M=r*g,A=r*v,C=r*b,R=l*v,k=l*b,O=u*b,V=p*g,j=p*v,K=p*b;return t[0]=1-(R+O),t[1]=A+K,t[2]=C-j,t[3]=0,t[4]=A-K,t[5]=1-(M+O),t[6]=k+V,t[7]=0,t[8]=C+j,t[9]=k-V,t[10]=1-(M+R),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Sx(t,e){var i=e[4],r=e[5],l=e[6],u=e[8],p=e[9],g=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,r,l),t[2]=Math.hypot(u,p,g),t}function Ex(t,e,i,r,l){var u,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+r)*(u=1/(r-l)),t[14]=2*l*r*u):(t[10]=-1,t[14]=-2*r),t}function Ax(t,e,i,r,l,u,p){var g=1/(e-i),v=1/(r-l),b=1/(u-p);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+i)*g,t[13]=(l+r)*v,t[14]=(p+u)*b,t[15]=1,t}function Ix(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}di.perspective=Ex,di.ortho=Ax,di.mul=Tx,di.sub=Ix;var oi={},ci={};function bg(t){return bg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bg(t)}Object.defineProperty(ci,"__esModule",{value:!0}),ci.create=Px,ci.clone=function(t){var e=new la.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},ci.length=Dx,ci.fromValues=function(t,e,i){var r=new la.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=i,r},ci.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},ci.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},ci.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},ci.subtract=Lx,ci.multiply=Rx,ci.divide=zx,ci.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},ci.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},ci.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},ci.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},ci.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},ci.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},ci.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},ci.distance=kx,ci.squaredDistance=Ox,ci.squaredLength=Fx,ci.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},ci.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},ci.normalize=function(t,e){var i=e[0],r=e[1],l=e[2],u=i*i+r*r+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},ci.dot=Bx,ci.cross=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=i[0],g=i[1],v=i[2];return t[0]=l*v-u*g,t[1]=u*p-r*v,t[2]=r*g-l*p,t},ci.lerp=function(t,e,i,r){var l=e[0],u=e[1],p=e[2];return t[0]=l+r*(i[0]-l),t[1]=u+r*(i[1]-u),t[2]=p+r*(i[2]-p),t},ci.hermite=function(t,e,i,r,l,u){var p=u*u,g=p*(2*u-3)+1,v=p*(u-2)+u,b=p*(u-1),M=p*(3-2*u);return t[0]=e[0]*g+i[0]*v+r[0]*b+l[0]*M,t[1]=e[1]*g+i[1]*v+r[1]*b+l[1]*M,t[2]=e[2]*g+i[2]*v+r[2]*b+l[2]*M,t},ci.bezier=function(t,e,i,r,l,u){var p=1-u,g=p*p,v=u*u,b=g*p,M=3*u*g,A=3*v*p,C=v*u;return t[0]=e[0]*b+i[0]*M+r[0]*A+l[0]*C,t[1]=e[1]*b+i[1]*M+r[1]*A+l[1]*C,t[2]=e[2]*b+i[2]*M+r[2]*A+l[2]*C,t},ci.random=function(t,e){e=e||1;var i=2*la.RANDOM()*Math.PI,r=2*la.RANDOM()-1,l=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*l,t[1]=Math.sin(i)*l,t[2]=r*e,t},ci.transformMat4=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=i[3]*r+i[7]*l+i[11]*u+i[15];return t[0]=(i[0]*r+i[4]*l+i[8]*u+i[12])/(p=p||1),t[1]=(i[1]*r+i[5]*l+i[9]*u+i[13])/p,t[2]=(i[2]*r+i[6]*l+i[10]*u+i[14])/p,t},ci.transformMat3=function(t,e,i){var r=e[0],l=e[1],u=e[2];return t[0]=r*i[0]+l*i[3]+u*i[6],t[1]=r*i[1]+l*i[4]+u*i[7],t[2]=r*i[2]+l*i[5]+u*i[8],t},ci.transformQuat=function(t,e,i){var r=i[0],l=i[1],u=i[2],p=e[0],g=e[1],v=e[2],b=l*v-u*g,M=u*p-r*v,A=r*g-l*p,C=l*A-u*M,R=u*b-r*A,k=r*M-l*b,O=2*i[3];return M*=O,A*=O,R*=2,k*=2,t[0]=p+(b*=O)+(C*=2),t[1]=g+M+R,t[2]=v+A+k,t},ci.rotateX=function(t,e,i,r){var l=[],u=[];return l[0]=e[0]-i[0],l[1]=e[1]-i[1],l[2]=e[2]-i[2],u[0]=l[0],u[1]=l[1]*Math.cos(r)-l[2]*Math.sin(r),u[2]=l[1]*Math.sin(r)+l[2]*Math.cos(r),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t},ci.rotateY=function(t,e,i,r){var l=[],u=[];return l[0]=e[0]-i[0],l[1]=e[1]-i[1],l[2]=e[2]-i[2],u[0]=l[2]*Math.sin(r)+l[0]*Math.cos(r),u[1]=l[1],u[2]=l[2]*Math.cos(r)-l[0]*Math.sin(r),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t},ci.rotateZ=function(t,e,i,r){var l=[],u=[];return l[0]=e[0]-i[0],l[1]=e[1]-i[1],l[2]=e[2]-i[2],u[0]=l[0]*Math.cos(r)-l[1]*Math.sin(r),u[1]=l[0]*Math.sin(r)+l[1]*Math.cos(r),u[2]=l[2],t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t},ci.angle=function(t,e){var i=t[0],r=t[1],l=t[2],u=e[0],p=e[1],g=e[2],v=Math.sqrt(i*i+r*r+l*l)*Math.sqrt(u*u+p*p+g*g),b=v&&Bx(t,e)/v;return Math.acos(Math.min(Math.max(b,-1),1))},ci.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},ci.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},ci.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},ci.equals=function(t,e){var i=t[0],r=t[1],l=t[2],u=e[0],p=e[1],g=e[2];return Math.abs(i-u)<=la.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-p)<=la.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(l-g)<=la.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))},ci.forEach=ci.sqrLen=ci.len=ci.sqrDist=ci.dist=ci.div=ci.mul=ci.sub=void 0;var la=function(t,e){if(t&&t.__esModule)return t;if(t===null||bg(t)!=="object"&&typeof t!="function")return{default:t};var i=Cx(void 0);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}(or);function Cx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Cx=function(r){return r?i:e})(t)}function Px(){var t=new la.ARRAY_TYPE(3);return la.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Dx(t){return Math.hypot(t[0],t[1],t[2])}function Lx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Rx(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function zx(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function kx(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Ox(t,e){var i=e[0]-t[0],r=e[1]-t[1],l=e[2]-t[2];return i*i+r*r+l*l}function Fx(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Bx(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}ci.sub=Lx,ci.mul=Rx,ci.div=zx,ci.dist=kx,ci.sqrDist=Ox,ci.len=Dx,ci.sqrLen=Fx;var ca,aE=(ca=Px(),function(t,e,i,r,l,u){var p,g;for(e||(e=3),i||(i=0),g=r?Math.min(r*e+i,t.length):t.length,p=i;p<g;p+=e)ca[0]=t[p],ca[1]=t[p+1],ca[2]=t[p+2],l(ca,ca,u),t[p]=ca[0],t[p+1]=ca[1],t[p+2]=ca[2];return t});ci.forEach=aE;var wi={};function wg(t){return wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wg(t)}Object.defineProperty(wi,"__esModule",{value:!0}),wi.create=Vx,wi.clone=function(t){var e=new Us.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},wi.fromValues=function(t,e,i,r){var l=new Us.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=i,l[3]=r,l},wi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},wi.set=function(t,e,i,r,l){return t[0]=e,t[1]=i,t[2]=r,t[3]=l,t},wi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},wi.subtract=Ux,wi.multiply=jx,wi.divide=Gx,wi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},wi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},wi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},wi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},wi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},wi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},wi.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},wi.distance=$x,wi.squaredDistance=qx,wi.length=Hx,wi.squaredLength=Wx,wi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},wi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},wi.normalize=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=i*i+r*r+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=i*p,t[1]=r*p,t[2]=l*p,t[3]=u*p,t},wi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},wi.cross=function(t,e,i,r){var l=i[0]*r[1]-i[1]*r[0],u=i[0]*r[2]-i[2]*r[0],p=i[0]*r[3]-i[3]*r[0],g=i[1]*r[2]-i[2]*r[1],v=i[1]*r[3]-i[3]*r[1],b=i[2]*r[3]-i[3]*r[2],M=e[0],A=e[1],C=e[2],R=e[3];return t[0]=A*b-C*v+R*g,t[1]=-M*b+C*p-R*u,t[2]=M*v-A*p+R*l,t[3]=-M*g+A*u-C*l,t},wi.lerp=function(t,e,i,r){var l=e[0],u=e[1],p=e[2],g=e[3];return t[0]=l+r*(i[0]-l),t[1]=u+r*(i[1]-u),t[2]=p+r*(i[2]-p),t[3]=g+r*(i[3]-g),t},wi.random=function(t,e){var i,r,l,u,p,g;e=e||1;do p=(i=2*Us.RANDOM()-1)*i+(r=2*Us.RANDOM()-1)*r;while(p>=1);do g=(l=2*Us.RANDOM()-1)*l+(u=2*Us.RANDOM()-1)*u;while(g>=1);var v=Math.sqrt((1-p)/g);return t[0]=e*i,t[1]=e*r,t[2]=e*l*v,t[3]=e*u*v,t},wi.transformMat4=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3];return t[0]=i[0]*r+i[4]*l+i[8]*u+i[12]*p,t[1]=i[1]*r+i[5]*l+i[9]*u+i[13]*p,t[2]=i[2]*r+i[6]*l+i[10]*u+i[14]*p,t[3]=i[3]*r+i[7]*l+i[11]*u+i[15]*p,t},wi.transformQuat=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=i[0],g=i[1],v=i[2],b=i[3],M=b*r+g*u-v*l,A=b*l+v*r-p*u,C=b*u+p*l-g*r,R=-p*r-g*l-v*u;return t[0]=M*b+R*-p+A*-v-C*-g,t[1]=A*b+R*-g+C*-p-M*-v,t[2]=C*b+R*-v+M*-g-A*-p,t[3]=e[3],t},wi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},wi.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},wi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},wi.equals=function(t,e){var i=t[0],r=t[1],l=t[2],u=t[3],p=e[0],g=e[1],v=e[2],b=e[3];return Math.abs(i-p)<=Us.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-g)<=Us.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(l-v)<=Us.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-b)<=Us.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))},wi.forEach=wi.sqrLen=wi.len=wi.sqrDist=wi.dist=wi.div=wi.mul=wi.sub=void 0;var Us=function(t,e){if(t&&t.__esModule)return t;if(t===null||wg(t)!=="object"&&typeof t!="function")return{default:t};var i=Nx(void 0);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}(or);function Nx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Nx=function(r){return r?i:e})(t)}function Vx(){var t=new Us.ARRAY_TYPE(4);return Us.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ux(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function jx(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function Gx(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function $x(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function qx(t,e){var i=e[0]-t[0],r=e[1]-t[1],l=e[2]-t[2],u=e[3]-t[3];return i*i+r*r+l*l+u*u}function Hx(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Wx(t){var e=t[0],i=t[1],r=t[2],l=t[3];return e*e+i*i+r*r+l*l}wi.sub=Ux,wi.mul=jx,wi.div=Gx,wi.dist=$x,wi.sqrDist=qx,wi.len=Hx,wi.sqrLen=Wx;var lE=function(){var t=Vx();return function(e,i,r,l,u,p){var g,v;for(i||(i=4),r||(r=0),v=l?Math.min(l*i+r,e.length):e.length,g=r;g<v;g+=i)t[0]=e[g],t[1]=e[g+1],t[2]=e[g+2],t[3]=e[g+3],u(t,t,p),e[g]=t[0],e[g+1]=t[1],e[g+2]=t[2],e[g+3]=t[3];return e}}();function Tg(t){return Tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tg(t)}wi.forEach=lE,Object.defineProperty(oi,"__esModule",{value:!0}),oi.create=Mg,oi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},oi.setAxisAngle=Xx,oi.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>dc.EPSILON?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i},oi.getAngle=function(t,e){var i=tv(t,e);return Math.acos(2*i*i-1)},oi.multiply=Yx,oi.rotateX=function(t,e,i){i*=.5;var r=e[0],l=e[1],u=e[2],p=e[3],g=Math.sin(i),v=Math.cos(i);return t[0]=r*v+p*g,t[1]=l*v+u*g,t[2]=u*v-l*g,t[3]=p*v-r*g,t},oi.rotateY=function(t,e,i){i*=.5;var r=e[0],l=e[1],u=e[2],p=e[3],g=Math.sin(i),v=Math.cos(i);return t[0]=r*v-u*g,t[1]=l*v+p*g,t[2]=u*v+r*g,t[3]=p*v-l*g,t},oi.rotateZ=function(t,e,i){i*=.5;var r=e[0],l=e[1],u=e[2],p=e[3],g=Math.sin(i),v=Math.cos(i);return t[0]=r*v+l*g,t[1]=l*v-r*g,t[2]=u*v+p*g,t[3]=p*v-u*g,t},oi.calculateW=function(t,e){var i=e[0],r=e[1],l=e[2];return t[0]=i,t[1]=r,t[2]=l,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-l*l)),t},oi.exp=Kx,oi.ln=Jx,oi.pow=function(t,e,i){return Jx(t,e),ev(t,t,i),Kx(t,t),t},oi.slerp=jp,oi.random=function(t){var e=dc.RANDOM(),i=dc.RANDOM(),r=dc.RANDOM(),l=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=l*Math.sin(2*Math.PI*i),t[1]=l*Math.cos(2*Math.PI*i),t[2]=u*Math.sin(2*Math.PI*r),t[3]=u*Math.cos(2*Math.PI*r),t},oi.invert=function(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=i*i+r*r+l*l+u*u,g=p?1/p:0;return t[0]=-i*g,t[1]=-r*g,t[2]=-l*g,t[3]=u*g,t},oi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},oi.fromMat3=Qx,oi.fromEuler=function(t,e,i,r){var l=.5*Math.PI/180;e*=l,i*=l,r*=l;var u=Math.sin(e),p=Math.cos(e),g=Math.sin(i),v=Math.cos(i),b=Math.sin(r),M=Math.cos(r);return t[0]=u*v*M-p*g*b,t[1]=p*g*M+u*v*b,t[2]=p*v*b-u*g*M,t[3]=p*v*M+u*g*b,t},oi.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},oi.setAxes=oi.sqlerp=oi.rotationTo=oi.equals=oi.exactEquals=oi.normalize=oi.sqrLen=oi.squaredLength=oi.len=oi.length=oi.lerp=oi.dot=oi.scale=oi.mul=oi.add=oi.set=oi.copy=oi.fromValues=oi.clone=void 0;var dc=Up(or),cE=Up(tn),ua=Up(ci),Is=Up(wi);function Zx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Zx=function(r){return r?i:e})(t)}function Up(t,e){if(t&&t.__esModule)return t;if(t===null||Tg(t)!=="object"&&typeof t!="function")return{default:t};var i=Zx(e);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function Mg(){var t=new dc.ARRAY_TYPE(4);return dc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Xx(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function Yx(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=i[0],v=i[1],b=i[2],M=i[3];return t[0]=r*M+p*g+l*b-u*v,t[1]=l*M+p*v+u*g-r*b,t[2]=u*M+p*b+r*v-l*g,t[3]=p*M-r*g-l*v-u*b,t}function Kx(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=Math.sqrt(i*i+r*r+l*l),g=Math.exp(u),v=p>0?g*Math.sin(p)/p:0;return t[0]=i*v,t[1]=r*v,t[2]=l*v,t[3]=g*Math.cos(p),t}function Jx(t,e){var i=e[0],r=e[1],l=e[2],u=e[3],p=Math.sqrt(i*i+r*r+l*l),g=p>0?Math.atan2(p,u)/p:0;return t[0]=i*g,t[1]=r*g,t[2]=l*g,t[3]=.5*Math.log(i*i+r*r+l*l+u*u),t}function jp(t,e,i,r){var l,u,p,g,v,b=e[0],M=e[1],A=e[2],C=e[3],R=i[0],k=i[1],O=i[2],V=i[3];return(u=b*R+M*k+A*O+C*V)<0&&(u=-u,R=-R,k=-k,O=-O,V=-V),1-u>dc.EPSILON?(l=Math.acos(u),p=Math.sin(l),g=Math.sin((1-r)*l)/p,v=Math.sin(r*l)/p):(g=1-r,v=r),t[0]=g*b+v*R,t[1]=g*M+v*k,t[2]=g*A+v*O,t[3]=g*C+v*V,t}function Qx(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var l=0;e[4]>e[0]&&(l=1),e[8]>e[3*l+l]&&(l=2);var u=(l+1)%3,p=(l+2)%3;i=Math.sqrt(e[3*l+l]-e[3*u+u]-e[3*p+p]+1),t[l]=.5*i,t[3]=(e[3*u+p]-e[3*p+u])*(i=.5/i),t[u]=(e[3*u+l]+e[3*l+u])*i,t[p]=(e[3*p+l]+e[3*l+p])*i}return t}oi.clone=Is.clone,oi.fromValues=Is.fromValues,oi.copy=Is.copy,oi.set=Is.set,oi.add=Is.add,oi.mul=Yx;var ev=Is.scale;oi.scale=ev;var tv=Is.dot;oi.dot=tv,oi.lerp=Is.lerp;var iv=Is.length;oi.length=iv,oi.len=iv;var nv=Is.squaredLength;oi.squaredLength=nv,oi.sqrLen=nv;var Sg=Is.normalize;oi.normalize=Sg,oi.exactEquals=Is.exactEquals,oi.equals=Is.equals;var eo,rv,sv,uE=(eo=ua.create(),rv=ua.fromValues(1,0,0),sv=ua.fromValues(0,1,0),function(t,e,i){var r=ua.dot(e,i);return r<-.999999?(ua.cross(eo,rv,e),ua.len(eo)<1e-6&&ua.cross(eo,sv,e),ua.normalize(eo,eo),Xx(t,eo,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ua.cross(eo,e,i),t[0]=eo[0],t[1]=eo[1],t[2]=eo[2],t[3]=1+r,Sg(t,t))});oi.rotationTo=uE;var Eg,Ag,hE=(Eg=Mg(),Ag=Mg(),function(t,e,i,r,l,u){return jp(Eg,e,l,u),jp(Ag,i,r,u),jp(t,Eg,Ag,2*u*(1-u)),t});oi.sqlerp=hE;var to,dE=(to=cE.create(),function(t,e,i,r){return to[0]=i[0],to[3]=i[1],to[6]=i[2],to[1]=r[0],to[4]=r[1],to[7]=r[2],to[2]=-e[0],to[5]=-e[1],to[8]=-e[2],Sg(t,Qx(t,to))});oi.setAxes=dE;var Ii={};function Ig(t){return Ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ig(t)}Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.create=function(){var t=new Kr.ARRAY_TYPE(8);return Kr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Ii.clone=function(t){var e=new Kr.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Ii.fromValues=function(t,e,i,r,l,u,p,g){var v=new Kr.ARRAY_TYPE(8);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=l,v[5]=u,v[6]=p,v[7]=g,v},Ii.fromRotationTranslationValues=function(t,e,i,r,l,u,p){var g=new Kr.ARRAY_TYPE(8);g[0]=t,g[1]=e,g[2]=i,g[3]=r;var v=.5*l,b=.5*u,M=.5*p;return g[4]=v*r+b*i-M*e,g[5]=b*r+M*t-v*i,g[6]=M*r+v*e-b*t,g[7]=-v*t-b*e-M*i,g},Ii.fromRotationTranslation=lv,Ii.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Ii.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ii.fromMat4=function(t,e){var i=ha.create();ov.getRotation(i,e);var r=new Kr.ARRAY_TYPE(3);return ov.getTranslation(r,e),lv(t,i,r),t},Ii.copy=cv,Ii.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ii.set=function(t,e,i,r,l,u,p,g,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=l,t[4]=u,t[5]=p,t[6]=g,t[7]=v,t},Ii.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Ii.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Ii.getTranslation=function(t,e){var i=e[4],r=e[5],l=e[6],u=e[7],p=-e[0],g=-e[1],v=-e[2],b=e[3];return t[0]=2*(i*b+u*p+r*v-l*g),t[1]=2*(r*b+u*g+l*p-i*v),t[2]=2*(l*b+u*v+i*g-r*p),t},Ii.translate=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=.5*i[0],v=.5*i[1],b=.5*i[2],M=e[4],A=e[5],C=e[6],R=e[7];return t[0]=r,t[1]=l,t[2]=u,t[3]=p,t[4]=p*g+l*b-u*v+M,t[5]=p*v+u*g-r*b+A,t[6]=p*b+r*v-l*g+C,t[7]=-r*g-l*v-u*b+R,t},Ii.rotateX=function(t,e,i){var r=-e[0],l=-e[1],u=-e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=g*p+M*r+v*u-b*l,C=v*p+M*l+b*r-g*u,R=b*p+M*u+g*l-v*r,k=M*p-g*r-v*l-b*u;return ha.rotateX(t,e,i),t[4]=A*(p=t[3])+k*(r=t[0])+C*(u=t[2])-R*(l=t[1]),t[5]=C*p+k*l+R*r-A*u,t[6]=R*p+k*u+A*l-C*r,t[7]=k*p-A*r-C*l-R*u,t},Ii.rotateY=function(t,e,i){var r=-e[0],l=-e[1],u=-e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=g*p+M*r+v*u-b*l,C=v*p+M*l+b*r-g*u,R=b*p+M*u+g*l-v*r,k=M*p-g*r-v*l-b*u;return ha.rotateY(t,e,i),t[4]=A*(p=t[3])+k*(r=t[0])+C*(u=t[2])-R*(l=t[1]),t[5]=C*p+k*l+R*r-A*u,t[6]=R*p+k*u+A*l-C*r,t[7]=k*p-A*r-C*l-R*u,t},Ii.rotateZ=function(t,e,i){var r=-e[0],l=-e[1],u=-e[2],p=e[3],g=e[4],v=e[5],b=e[6],M=e[7],A=g*p+M*r+v*u-b*l,C=v*p+M*l+b*r-g*u,R=b*p+M*u+g*l-v*r,k=M*p-g*r-v*l-b*u;return ha.rotateZ(t,e,i),t[4]=A*(p=t[3])+k*(r=t[0])+C*(u=t[2])-R*(l=t[1]),t[5]=C*p+k*l+R*r-A*u,t[6]=R*p+k*u+A*l-C*r,t[7]=k*p-A*r-C*l-R*u,t},Ii.rotateByQuatAppend=function(t,e,i){var r=i[0],l=i[1],u=i[2],p=i[3],g=e[0],v=e[1],b=e[2],M=e[3];return t[0]=g*p+M*r+v*u-b*l,t[1]=v*p+M*l+b*r-g*u,t[2]=b*p+M*u+g*l-v*r,t[3]=M*p-g*r-v*l-b*u,t[4]=(g=e[4])*p+(M=e[7])*r+(v=e[5])*u-(b=e[6])*l,t[5]=v*p+M*l+b*r-g*u,t[6]=b*p+M*u+g*l-v*r,t[7]=M*p-g*r-v*l-b*u,t},Ii.rotateByQuatPrepend=function(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=i[0],v=i[1],b=i[2],M=i[3];return t[0]=r*M+p*g+l*b-u*v,t[1]=l*M+p*v+u*g-r*b,t[2]=u*M+p*b+r*v-l*g,t[3]=p*M-r*g-l*v-u*b,t[4]=r*(M=i[7])+p*(g=i[4])+l*(b=i[6])-u*(v=i[5]),t[5]=l*M+p*v+u*g-r*b,t[6]=u*M+p*b+r*v-l*g,t[7]=p*M-r*g-l*v-u*b,t},Ii.rotateAroundAxis=function(t,e,i,r){if(Math.abs(r)<Kr.EPSILON)return cv(t,e);var l=Math.hypot(i[0],i[1],i[2]);r*=.5;var u=Math.sin(r),p=u*i[0]/l,g=u*i[1]/l,v=u*i[2]/l,b=Math.cos(r),M=e[0],A=e[1],C=e[2],R=e[3];t[0]=M*b+R*p+A*v-C*g,t[1]=A*b+R*g+C*p-M*v,t[2]=C*b+R*v+M*g-A*p,t[3]=R*b-M*p-A*g-C*v;var k=e[4],O=e[5],V=e[6],j=e[7];return t[4]=k*b+j*p+O*v-V*g,t[5]=O*b+j*g+V*p-k*v,t[6]=V*b+j*v+k*g-O*p,t[7]=j*b-k*p-O*g-V*v,t},Ii.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Ii.multiply=uv,Ii.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Ii.lerp=function(t,e,i,r){var l=1-r;return hv(e,i)<0&&(r=-r),t[0]=e[0]*l+i[0]*r,t[1]=e[1]*l+i[1]*r,t[2]=e[2]*l+i[2]*r,t[3]=e[3]*l+i[3]*r,t[4]=e[4]*l+i[4]*r,t[5]=e[5]*l+i[5]*r,t[6]=e[6]*l+i[6]*r,t[7]=e[7]*l+i[7]*r,t},Ii.invert=function(t,e){var i=Gp(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Ii.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Ii.normalize=function(t,e){var i=Gp(e);if(i>0){i=Math.sqrt(i);var r=e[0]/i,l=e[1]/i,u=e[2]/i,p=e[3]/i,g=e[4],v=e[5],b=e[6],M=e[7],A=r*g+l*v+u*b+p*M;t[0]=r,t[1]=l,t[2]=u,t[3]=p,t[4]=(g-r*A)/i,t[5]=(v-l*A)/i,t[6]=(b-u*A)/i,t[7]=(M-p*A)/i}return t},Ii.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Ii.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Ii.equals=function(t,e){var i=t[0],r=t[1],l=t[2],u=t[3],p=t[4],g=t[5],v=t[6],b=t[7],M=e[0],A=e[1],C=e[2],R=e[3],k=e[4],O=e[5],V=e[6],j=e[7];return Math.abs(i-M)<=Kr.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(r-A)<=Kr.EPSILON*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(l-C)<=Kr.EPSILON*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(u-R)<=Kr.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(p-k)<=Kr.EPSILON*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(g-O)<=Kr.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(v-V)<=Kr.EPSILON*Math.max(1,Math.abs(v),Math.abs(V))&&Math.abs(b-j)<=Kr.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))},Ii.sqrLen=Ii.squaredLength=Ii.len=Ii.length=Ii.dot=Ii.mul=Ii.setReal=Ii.getReal=void 0;var Kr=Cg(or),ha=Cg(oi),ov=Cg(di);function av(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(av=function(r){return r?i:e})(t)}function Cg(t,e){if(t&&t.__esModule)return t;if(t===null||Ig(t)!=="object"&&typeof t!="function")return{default:t};var i=av(e);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function lv(t,e,i){var r=.5*i[0],l=.5*i[1],u=.5*i[2],p=e[0],g=e[1],v=e[2],b=e[3];return t[0]=p,t[1]=g,t[2]=v,t[3]=b,t[4]=r*b+l*v-u*g,t[5]=l*b+u*p-r*v,t[6]=u*b+r*g-l*p,t[7]=-r*p-l*g-u*v,t}function cv(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function uv(t,e,i){var r=e[0],l=e[1],u=e[2],p=e[3],g=i[4],v=i[5],b=i[6],M=i[7],A=e[4],C=e[5],R=e[6],k=e[7],O=i[0],V=i[1],j=i[2],K=i[3];return t[0]=r*K+p*O+l*j-u*V,t[1]=l*K+p*V+u*O-r*j,t[2]=u*K+p*j+r*V-l*O,t[3]=p*K-r*O-l*V-u*j,t[4]=r*M+p*g+l*b-u*v+A*K+k*O+C*j-R*V,t[5]=l*M+p*v+u*g-r*b+C*K+k*V+R*O-A*j,t[6]=u*M+p*b+r*v-l*g+R*K+k*j+A*V-C*O,t[7]=p*M-r*g-l*v-u*b+k*K-A*O-C*V-R*j,t}Ii.getReal=ha.copy,Ii.setReal=ha.copy,Ii.mul=uv;var hv=ha.dot;Ii.dot=hv;var dv=ha.length;Ii.length=dv,Ii.len=dv;var Gp=ha.squaredLength;Ii.squaredLength=Gp,Ii.sqrLen=Gp;var _i={};function Pg(t){return Pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pg(t)}Object.defineProperty(_i,"__esModule",{value:!0}),_i.create=pv,_i.clone=function(t){var e=new fc.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},_i.fromValues=function(t,e){var i=new fc.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},_i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},_i.set=function(t,e,i){return t[0]=e,t[1]=i,t},_i.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},_i.subtract=mv,_i.multiply=_v,_i.divide=gv,_i.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},_i.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},_i.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},_i.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},_i.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},_i.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},_i.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},_i.distance=yv,_i.squaredDistance=xv,_i.length=vv,_i.squaredLength=bv,_i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},_i.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},_i.normalize=function(t,e){var i=e[0],r=e[1],l=i*i+r*r;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t},_i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},_i.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},_i.lerp=function(t,e,i,r){var l=e[0],u=e[1];return t[0]=l+r*(i[0]-l),t[1]=u+r*(i[1]-u),t},_i.random=function(t,e){e=e||1;var i=2*fc.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},_i.transformMat2=function(t,e,i){var r=e[0],l=e[1];return t[0]=i[0]*r+i[2]*l,t[1]=i[1]*r+i[3]*l,t},_i.transformMat2d=function(t,e,i){var r=e[0],l=e[1];return t[0]=i[0]*r+i[2]*l+i[4],t[1]=i[1]*r+i[3]*l+i[5],t},_i.transformMat3=function(t,e,i){var r=e[0],l=e[1];return t[0]=i[0]*r+i[3]*l+i[6],t[1]=i[1]*r+i[4]*l+i[7],t},_i.transformMat4=function(t,e,i){var r=e[0],l=e[1];return t[0]=i[0]*r+i[4]*l+i[12],t[1]=i[1]*r+i[5]*l+i[13],t},_i.rotate=function(t,e,i,r){var l=e[0]-i[0],u=e[1]-i[1],p=Math.sin(r),g=Math.cos(r);return t[0]=l*g-u*p+i[0],t[1]=l*p+u*g+i[1],t},_i.angle=function(t,e){var i=t[0],r=t[1],l=e[0],u=e[1],p=Math.sqrt(i*i+r*r)*Math.sqrt(l*l+u*u);return Math.acos(Math.min(Math.max(p&&(i*l+r*u)/p,-1),1))},_i.zero=function(t){return t[0]=0,t[1]=0,t},_i.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},_i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},_i.equals=function(t,e){var i=t[0],r=t[1],l=e[0],u=e[1];return Math.abs(i-l)<=fc.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-u)<=fc.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))},_i.forEach=_i.sqrLen=_i.sqrDist=_i.dist=_i.div=_i.mul=_i.sub=_i.len=void 0;var fc=function(t,e){if(t&&t.__esModule)return t;if(t===null||Pg(t)!=="object"&&typeof t!="function")return{default:t};var i=fv(void 0);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}(or);function fv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(fv=function(r){return r?i:e})(t)}function pv(){var t=new fc.ARRAY_TYPE(2);return fc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function mv(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function _v(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function gv(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function yv(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function xv(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function vv(t){return Math.hypot(t[0],t[1])}function bv(t){var e=t[0],i=t[1];return e*e+i*i}_i.len=vv,_i.sub=mv,_i.mul=_v,_i.div=gv,_i.dist=yv,_i.sqrDist=xv,_i.sqrLen=bv;var fE=function(){var t=pv();return function(e,i,r,l,u,p){var g,v;for(i||(i=2),r||(r=0),v=l?Math.min(l*i+r,e.length):e.length,g=r;g<v;g+=i)t[0]=e[g],t[1]=e[g+1],u(t,t,p),e[g]=t[0],e[g+1]=t[1];return e}}();function Dg(t){return Dg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dg(t)}_i.forEach=fE,Object.defineProperty(sr,"__esModule",{value:!0}),s.a7=sr.vec4=s.N=sr.vec3=sr.vec2=sr.quat2=s.bi=sr.quat=s.a6=sr.mat4=s.co=sr.mat3=sr.mat2d=s.b4=sr.mat2=sr.glMatrix=void 0;var pE=ko(or);sr.glMatrix=pE;var mE=ko(Mn);s.b4=sr.mat2=mE;var _E=ko(En);sr.mat2d=_E;var gE=ko(tn);s.co=sr.mat3=gE;var yE=ko(di);s.a6=sr.mat4=yE;var xE=ko(oi);s.bi=sr.quat=xE;var vE=ko(Ii);sr.quat2=vE;var bE=ko(_i);sr.vec2=bE;var wE=ko(ci);s.N=sr.vec3=wE;var TE=ko(wi);function wv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(wv=function(r){return r?i:e})(t)}function ko(t,e){if(t&&t.__esModule)return t;if(t===null||Dg(t)!=="object"&&typeof t!="function")return{default:t};var i=wv(e);if(i&&i.has(t))return i.get(t);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=l?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}s.a7=sr.vec4=TE;class Lg{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const l=s.N.dot(i,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/l;return r[0]=this.pos[0]+this.dir[0]*u,r[1]=this.pos[1]+this.dir[1]*u,r[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,i,r){if(s.N.equals(this.pos,e)||i===0)return r[0]=r[1]=r[2]=0,!1;const[l,u,p]=this.dir,g=this.pos[0]-e[0],v=this.pos[1]-e[1],b=this.pos[2]-e[2],M=l*l+u*u+p*p,A=2*(g*l+v*u+b*p),C=A*A-4*M*(g*g+v*v+b*b-i*i);if(C<0){const R=Math.max(-A/2,0),k=g+l*R,O=v+u*R,V=b+p*R,j=Math.hypot(k,O,V);return r[0]=k*i/j,r[1]=O*i/j,r[2]=V*i/j,!1}{const R=(-A-Math.sqrt(C))/(2*M);if(R<0){const k=Math.hypot(g,v,b);return r[0]=g*i/k,r[1]=v*i/k,r[2]=b*i/k,!1}return r[0]=g+l*R,r[1]=v+u*R,r[2]=b+p*R,!0}}}class Rg{constructor(e,i,r,l,u){this.TL=e,this.TR=i,this.BR=r,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,i,r){const l=[-1,1,1],u=[1,1,1],p=[1,-1,1],g=[-1,-1,1],v=s.N.transformMat4(l,l,e),b=s.N.transformMat4(u,u,e),M=s.N.transformMat4(p,p,e),A=s.N.transformMat4(g,g,e);return new Rg(v,b,M,A,i/r)}}function Id(t,e,i){let r=1/0,l=-1/0;const u=[];for(const p of t){s.N.sub(u,p,e);const g=s.N.dot(u,i);r=Math.min(r,g),l=Math.max(l,g)}return[r,l]}function Tv(t,e){let i=!0;for(let r=0;r<t.planes.length;r++){const l=t.planes[r];let u=0;for(let p=0;p<e.length;p++)u+=s.N.dot(l,e[p])+l[3]>=0;if(u===0)return 0;u!==e.length&&(i=!1)}return i?2:1}function Mv(t,e){for(const i of t.projections){const r=Id(e,t.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function Sv(t,e){let i=0;const r=[0,0,0,0];for(let l=0;l<t.length;l++)r[0]=t[l][0],r[1]=t[l][1],r[2]=t[l][2],r[3]=1,s.a7.dot(r,e)>=0&&i++;return i}class zg{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=An.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.N.sub([],this.points[2],this.points[3]),s.N.sub([],this.points[0],this.points[3]),s.N.sub([],this.points[4],this.points[0]),s.N.sub([],this.points[5],this.points[1]),s.N.sub([],this.points[6],this.points[2]),s.N.sub([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const l=[0,-r[2],r[1]],u=[r[2],0,-r[0]];this.projections.push({axis:l,projection:Id(this.points,this.points[0],l)}),this.projections.push({axis:u,projection:Id(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,i,r,l){const u=Math.pow(2,r),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const M=s.a7.transformMat4([],b,e),A=1/M[3]/i*u;return s.a7.mul(M,M,[A,A,l?1/M[3]:A,A])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const M=s.N.sub([],p[b[0]],p[b[1]]),A=s.N.sub([],p[b[2]],p[b[1]]),C=s.N.normalize([],s.N.cross([],M,A)),R=-s.N.dot(C,p[b[1]]);return C.concat(R)}),v=[];for(let b=0;b<p.length;b++)v.push([p[b][0],p[b][1],p[b][2]]);return new zg(v,g)}intersectsPrecise(e,i,r){for(let l=0;l<i.length;l++)if(!Sv(e,i[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!Sv(e,this.planes[l]))return 0;for(const l of r)for(const u of this.frustumEdges){const p=s.N.cross([],l,u),g=s.N.length(p);if(g===0)continue;s.N.scale(p,p,1/g);const v=Id(this.points,this.points[0],p),b=Id(e,this.points[0],p);if(v[0]>b[1]||b[0]>v[1])return 0}return 1}}class An{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const l of e)s.N.min(i,i,l),s.N.max(r,r,l);return new An(i,r)}static fromTileIdAndHeight(e,i,r){const l=1<<e.canonical.z,u=e.canonical.x,p=e.canonical.y;return new An([u/l,p/l,i],[(u+1)/l,(p+1)/l,r])}static applyTransform(e,i){const r=e.getCorners();for(let l=0;l<r.length;++l)s.N.transformMat4(r[l],r[l],i);return An.fromPoints(r)}static projectAabbCorners(e,i){const r=e.getCorners();for(let l=0;l<r.length;++l)s.N.transformMat4(r[l],r[l],i);return r}constructor(e,i){this.min=e,this.max=i,this.center=s.N.scale([],s.N.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=s.N.clone(this.min),l=s.N.clone(this.max);for(let u=0;u<i.length;u++)r[u]=i[u]?this.min[u]:this.center[u],l[u]=i[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new An(r,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Tv(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Tv(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Mv(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Mv(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Mt(An,"Aabb");const ME=Hi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$p}=ME,SE=Hi([{name:"a_pos_3",components:3,type:"Int16"}]);var Ev=Hi([{name:"a_pos",type:"Int16",components:2}]);function qp(t){return t*J/De}const EE=[new An([pe,pe,pe],[Se,Se,Se]),new An([pe,pe,pe],[0,0,Se]),new An([0,pe,pe],[Se,0,Se]),new An([pe,0,pe],[0,Se,Se]),new An([0,0,pe],[Se,Se,Se])];function Av(t,e,i,r=!0){const l=s.N.scale([],t._camera.position,t.worldSize),u=[e,i,1,1];s.a7.transformMat4(u,u,t.pixelMatrixInverse),s.a7.scale(u,u,1/u[3]);const p=s.N.sub([],u,l),g=s.N.normalize([],p),v=t.globeMatrix,b=[v[12],v[13],v[14]],M=s.N.sub([],b,l),A=s.N.length(M),C=s.N.normalize([],M),R=t.worldSize/(2*Math.PI),k=s.N.dot(C,g),O=Math.asin(R/A);if(O<Math.acos(k)){if(!r)return null;const ve=[],ke=[];s.N.scale(ve,g,A/k),s.N.normalize(ke,s.N.sub(ke,ve,M)),s.N.normalize(g,s.N.add(g,M,s.N.scale(g,ke,Math.tan(O)*A)))}const V=[];new Lg(l,g).closestPointOnSphere(b,R,V);const j=s.N.normalize([],re(v,0)),K=s.N.normalize([],re(v,1)),ee=s.N.normalize([],re(v,2)),Q=s.N.dot(j,V),oe=s.N.dot(K,V),se=s.N.dot(ee,V),he=sn(Math.asin(-oe/R));let me=sn(Math.atan2(Q,se));me=t.center.lng+function(ve,ke){const Ge=(ke-ve+180)%360-180;return Ge<-180?Ge+360:Ge}(t.center.lng,me);const xe=li(me),Ee=kt(Jt(he),0,1);return new Di(xe,Ee)}class AE{constructor(e,i,r){this.a=s.N.sub([],e,r),this.b=s.N.sub([],i,r),this.center=r;const l=s.N.normalize([],this.a),u=s.N.normalize([],this.b);this.angle=Math.acos(s.N.dot(l,u))}}function kg(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,l,u,p){const g=Math.sin(u);return r*(Math.sin((1-p)*u)/g)+l*(Math.sin(p*u)/g)}(t.a[e],t.b[e],t.angle,kt(i,0,1))+t.center[e]}function Oo(t){if(t.z<=1)return EE[t.z+2*t.y+t.x];const e=Og(Hp(t));return An.fromPoints(e)}function da(t,e,i){return s.N.scale(t,t,1-i),s.N.scaleAndAdd(t,t,e,i)}function Iv(t,e,i){for(const r of t)s.N.transformMat4(r,r,e),s.N.scale(r,r,i)}function Cv(t,e,i,r){const l=e/t.worldSize,u=t.globeMatrix;if(i.z<=1){const xe=Oo(i).getCorners();return Iv(xe,u,l),An.fromPoints(xe)}const p=Hp(i,r),g=Og(p,J+qp(t._tileCoverLift));Iv(g,u,l);const v=Number.MAX_VALUE,b=[-v,-v,-v],M=[v,v,v];if(p.contains(t.center)){for(const ve of g)s.N.min(M,M,ve),s.N.max(b,b,ve);b[2]=0;const xe=t.point,Ee=[xe.x*l,xe.y*l,0];return s.N.min(M,M,Ee),s.N.max(b,b,Ee),new An(M,b)}if(t._tileCoverLift>0){for(const xe of g)s.N.min(M,M,xe),s.N.max(b,b,xe);return new An(M,b)}const A=[u[12]*l,u[13]*l,u[14]*l],C=p.getCenter(),R=kt(t.center.lat,-yi,yi),k=kt(C.lat,-yi,yi),O=li(t.center.lng),V=Jt(R);let j=O-li(C.lng);const K=V-Jt(k);j>.5?j-=1:j<-.5&&(j+=1);let ee=0;if(Math.abs(j)>Math.abs(K))ee=j>=0?1:3;else{ee=K>=0?0:2;const xe=[u[4]*l,u[5]*l,u[6]*l],Ee=-Math.sin(Zt(K>=0?p.getSouth():p.getNorth()))*J;s.N.scaleAndAdd(A,A,xe,Ee)}const Q=g[ee],oe=g[(ee+1)%4],se=new AE(Q,oe,A),he=[kg(se,0)||Q[0],kg(se,1)||Q[1],kg(se,2)||Q[2]],me=Xa(t.zoom);if(me>0){const xe=function({x:ve,y:ke,z:Ge},Re,je,Ce,Ue){const ot=1/(1<<Ge);let qe=ve*ot,It=qe+ot,bt=ke*ot,Ye=bt+ot,Xt=0;const Ft=(qe+It)/2-Ce;return Ft>.5?Xt=-1:Ft<-.5&&(Xt=1),qe=((qe+Xt)*Re-(Ce*=Re))*je+Ce,It=((It+Xt)*Re-Ce)*je+Ce,bt=(bt*Re-(Ue*=Re))*je+Ue,Ye=(Ye*Re-Ue)*je+Ue,[[qe,Ye,0],[It,Ye,0],[It,bt,0],[qe,bt,0]]}(i,e,t._pixelsPerMercatorPixel,O,V);for(let ve=0;ve<g.length;ve++)da(g[ve],xe[ve],me);const Ee=s.N.add([],xe[ee],xe[(ee+1)%4]);s.N.scale(Ee,Ee,.5),da(he,Ee,me)}for(const xe of g)s.N.min(M,M,xe),s.N.max(b,b,xe);return M[2]=Math.min(Q[2],oe[2]),s.N.min(M,M,he),s.N.max(b,b,he),new An(M,b)}function Hp({x:t,y:e,z:i},r=!1){const l=1/(1<<i),u=new ye(ni(t*l),e===(1<<i)-1&&r?-90:Ai((e+1)*l)),p=new ye(ni((t+1)*l),e===0&&r?90:Ai(e*l));return new Ie(u,p)}function Og(t,e=J){const i=Zt(t.getNorth()),r=Zt(t.getSouth()),l=Math.cos(i),u=Math.cos(r),p=Math.sin(i),g=Math.sin(r),v=t.getWest(),b=t.getEast();return[_e(u,g,v,e),_e(u,g,b,e),_e(l,p,b,e),_e(l,p,v,e)]}function Cd(t,e,i,r){const l=1<<i.z,u=(t/yt+i.x)/l;return ze(Ai((e/yt+i.y)/l),ni(u),r)}function Wp({min:t,max:e}){return ne/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Pv=new Float64Array(16);function Zp(t){const e=Wp(t),i=s.a6.fromScaling(Pv,[e,e,e]);return s.a6.translate(i,i,s.N.negate([],t.min))}function Fg(t){const e=s.a6.fromTranslation(Pv,t.min),i=1/Wp(t);return s.a6.scale(e,e,[i,i,i])}function Bg(t){const e=yt/(2*Math.PI);return t/(2*Math.PI)/e}function Dv(t,e){return yt/(512*Math.pow(2,t))*Wp(Oo(e))}function Lv(t,e,i,r,l){const u=Bg(i),p=[t,e,-i/(2*Math.PI)],g=s.a6.identity(new Float64Array(16));return s.a6.translate(g,g,p),s.a6.scale(g,g,[u,u,u]),s.a6.rotateX(g,g,Zt(-l)),s.a6.rotateY(g,g,Zt(-r)),g}function Xa(t){return rr(ie,W,t)}function Rv(t,e){const i=ze(e.lat,e.lng),r=function(u){const p=ze(u._center.lat,u._center.lng),g=s.N.fromValues(0,1,0);let v=s.N.cross([],g,p);const b=s.a6.fromRotation([],-u.angle,p);v=s.N.transformMat4(v,v,b),s.a6.fromRotation(b,-u._pitch,v);const M=s.N.normalize([],p);return s.N.scale(M,M,qp(u.cameraToCenterDistance/u.pixelsPerMeter)),s.N.transformMat4(M,M,b),s.N.add([],p,M)}(t),l=s.N.subtract([],r,i);return s.N.angle(l,i)}function Ng(t,e){return Rv(t,e)>Math.PI/2*1.01}const zv=Zt(85),IE=Math.cos(zv),CE=Math.sin(zv),PE=s.a6.create(),kv=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ov(t,e,i,r,l,u,p,g,v){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(v*=t.pixelToTileUnitsFactor);const b=t.tileID.canonical,M=i.projection.upVectorScale(b,i.center.lat,i.worldSize).metersToTile;for(const A of e)for(const C of A){const R=C.add(g),k=l&&i.elevation?i.elevation.exaggeration()*l.getElevationAt(R.x,R.y,!0):0,O=i.projection.projectTilePoint(R.x,R.y,b);if(k>0){const ee=i.projection.upVector(b,R.x,R.y);O.x+=ee[0]*M*k,O.y+=ee[1]*M*k,O.z+=ee[2]*M*k}const V=u?R:DE(O.x,O.y,O.z,r),j=u?t.tilespaceRays.map(ee=>RE(ee,k)):t.queryGeometry.screenGeometry,K=s.a7.transformMat4([],[O.x,O.y,O.z,1],r);if(!p&&u?v*=K[3]/i.cameraToCenterDistance:p&&!u&&(v*=i.cameraToCenterDistance/K[3]),u){const ee=Ai((C.y/yt+b.y)/(1<<b.z));v/=i.projection.pixelsPerMeter(ee,1)/ri(1,ee)}if(Ro(j,V,v))return!0}return!1}function DE(t,e,i,r){const l=s.a7.transformMat4([],[t,e,i,1],r);return new $e(l[0]/l[3],l[1]/l[3])}const Fv=s.N.fromValues(0,0,0),LE=s.N.fromValues(0,0,1);function RE(t,e){const i=s.N.create();return Fv[2]=e,t.intersectsPlane(Fv,LE,i),new $e(i[0],i[1])}class Bv extends jr{}function Nv(t,{width:e,height:i},r,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*i*r)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=l,t}function Vv(t,e,i){const{width:r,height:l}=e;r===t.width&&l===t.height||(Vg(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,l)},i),t.width=r,t.height=l,t.data=e.data)}function Vg(t,e,i,r,l,u,p){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||i.x>t.width-l.width||i.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||r.x>e.width-l.width||r.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const g=t.data,v=e.data,b=u===4&&p;for(let M=0;M<l.height;M++){const A=((i.y+M)*t.width+i.x)*u,C=((r.y+M)*e.width+r.x)*u;if(b)for(let R=0;R<l.width;R++){const k=A+R*u+3,O=C+R*u;v[O+0]=255,v[O+1]=255,v[O+2]=255,v[O+3]=g[k]}else for(let R=0;R<l.width*u;R++)v[C+R]=g[A+R]}return e}Mt(Bv,"HeatmapBucket",{omit:["layers"]});class Ya{constructor(e,i){Nv(this,e,1,i)}resize(e){Vv(this,new Ya(e),1)}clone(){return new Ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,l,u){Vg(e,i,r,l,u,1)}}class Cs{constructor(e,i){Nv(this,e,4,i)}resize(e){Vv(this,new Cs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,l,u,p){Vg(e,i,r,l,u,4,p)}}class Uv{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}Mt(Ya,"AlphaImage"),Mt(Cs,"RGBAImage");const zE=new wn({visibility:new rt(Te.layout_heatmap.visibility)});var kE={paint:new wn({"heatmap-radius":new Gt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rt(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new sa(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rt(Te.paint_heatmap["heatmap-opacity"])}),layout:zE};function Pd(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,l=t.image||new Cs({width:i,height:r}),u=(p,g,v)=>{e[t.evaluationKey]=v;const b=t.expression.evaluate(e);b&&(l.data[p+g+0]=Math.floor(255*b.r/b.a),l.data[p+g+1]=Math.floor(255*b.g/b.a),l.data[p+g+2]=Math.floor(255*b.b/b.a),l.data[p+g+3]=Math.floor(255*b.a))};if(t.clips)for(let p=0,g=0;p<r;++p,g+=4*i)for(let v=0,b=0;v<i;v++,b+=4){const M=v/(i-1),{start:A,end:C}=t.clips[p];u(g,b,A*(1-M)+C*M)}else for(let p=0,g=0;p<i;p++,g+=4)u(0,g,p/(i-1));return l}const OE=new wn({visibility:new rt(Te.layout_hillshade.visibility)});var FE={paint:new wn({"hillshade-illumination-direction":new rt(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new rt(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rt(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rt(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rt(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rt(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new rt(Te.paint_hillshade["hillshade-emissive-strength"])}),layout:OE};const BE=Hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:NE}=BE;var Ug={exports:{}};function Xp(t,e,i){i=i||2;var r,l,u,p,g,v,b,M=e&&e.length,A=M?e[0]*i:t.length,C=jv(t,0,A,i,!0),R=[];if(!C||C.next===C.prev)return R;if(M&&(C=function(O,V,j,K){var ee,Q,oe,se=[];for(ee=0,Q=V.length;ee<Q;ee++)(oe=jv(O,V[ee]*K,ee<Q-1?V[ee+1]*K:O.length,K,!1))===oe.next&&(oe.steiner=!0),se.push(WE(oe));for(se.sort($E),ee=0;ee<se.length;ee++)j=qE(se[ee],j);return j}(t,e,C,i)),t.length>80*i){r=u=t[0],l=p=t[1];for(var k=i;k<A;k+=i)(g=t[k])<r&&(r=g),(v=t[k+1])<l&&(l=v),g>u&&(u=g),v>p&&(p=v);b=(b=Math.max(u-r,p-l))!==0?32767/b:0}return Dd(C,R,i,r,l,b,0),R}function jv(t,e,i,r,l){var u,p;if(l===$g(t,e,i,r)>0)for(u=e;u<i;u+=r)p=qv(u,t[u],t[u+1],p);else for(u=i-r;u>=e;u-=r)p=qv(u,t[u],t[u+1],p);return p&&Yp(p,p.next)&&(Rd(p),p=p.next),p}function pc(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!Yp(r,r.next)&&Zn(r.prev,r,r.next)!==0)r=r.next;else{if(Rd(r),(r=e=r.prev)===r.next)break;i=!0}while(i||r!==e);return e}function Dd(t,e,i,r,l,u,p){if(t){!p&&u&&function(M,A,C,R){var k=M;do k.z===0&&(k.z=jg(k.x,k.y,A,C,R)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==M);k.prevZ.nextZ=null,k.prevZ=null,function(O){var V,j,K,ee,Q,oe,se,he,me=1;do{for(j=O,O=null,Q=null,oe=0;j;){for(oe++,K=j,se=0,V=0;V<me&&(se++,K=K.nextZ);V++);for(he=me;se>0||he>0&&K;)se!==0&&(he===0||!K||j.z<=K.z)?(ee=j,j=j.nextZ,se--):(ee=K,K=K.nextZ,he--),Q?Q.nextZ=ee:O=ee,ee.prevZ=Q,Q=ee;j=K}Q.nextZ=null,me*=2}while(oe>1)}(k)}(t,r,l,u);for(var g,v,b=t;t.prev!==t.next;)if(g=t.prev,v=t.next,u?UE(t,r,l,u):VE(t))e.push(g.i/i|0),e.push(t.i/i|0),e.push(v.i/i|0),Rd(t),t=v.next,b=v.next;else if((t=v)===b){p?p===1?Dd(t=jE(pc(t),e,i),e,i,r,l,u,2):p===2&&GE(t,e,i,r,l,u):Dd(pc(t),e,i,r,l,u,1);break}}}function VE(t){var e=t.prev,i=t,r=t.next;if(Zn(e,i,r)>=0)return!1;for(var l=e.x,u=i.x,p=r.x,g=e.y,v=i.y,b=r.y,M=l<u?l<p?l:p:u<p?u:p,A=g<v?g<b?g:b:v<b?v:b,C=l>u?l>p?l:p:u>p?u:p,R=g>v?g>b?g:b:v>b?v:b,k=r.next;k!==e;){if(k.x>=M&&k.x<=C&&k.y>=A&&k.y<=R&&Su(l,g,u,v,p,b,k.x,k.y)&&Zn(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function UE(t,e,i,r){var l=t.prev,u=t,p=t.next;if(Zn(l,u,p)>=0)return!1;for(var g=l.x,v=u.x,b=p.x,M=l.y,A=u.y,C=p.y,R=g<v?g<b?g:b:v<b?v:b,k=M<A?M<C?M:C:A<C?A:C,O=g>v?g>b?g:b:v>b?v:b,V=M>A?M>C?M:C:A>C?A:C,j=jg(R,k,e,i,r),K=jg(O,V,e,i,r),ee=t.prevZ,Q=t.nextZ;ee&&ee.z>=j&&Q&&Q.z<=K;){if(ee.x>=R&&ee.x<=O&&ee.y>=k&&ee.y<=V&&ee!==l&&ee!==p&&Su(g,M,v,A,b,C,ee.x,ee.y)&&Zn(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,Q.x>=R&&Q.x<=O&&Q.y>=k&&Q.y<=V&&Q!==l&&Q!==p&&Su(g,M,v,A,b,C,Q.x,Q.y)&&Zn(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;ee&&ee.z>=j;){if(ee.x>=R&&ee.x<=O&&ee.y>=k&&ee.y<=V&&ee!==l&&ee!==p&&Su(g,M,v,A,b,C,ee.x,ee.y)&&Zn(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;Q&&Q.z<=K;){if(Q.x>=R&&Q.x<=O&&Q.y>=k&&Q.y<=V&&Q!==l&&Q!==p&&Su(g,M,v,A,b,C,Q.x,Q.y)&&Zn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function jE(t,e,i){var r=t;do{var l=r.prev,u=r.next.next;!Yp(l,u)&&Gv(l,r,r.next,u)&&Ld(l,u)&&Ld(u,l)&&(e.push(l.i/i|0),e.push(r.i/i|0),e.push(u.i/i|0),Rd(r),Rd(r.next),r=t=u),r=r.next}while(r!==t);return pc(r)}function GE(t,e,i,r,l,u){var p=t;do{for(var g=p.next.next;g!==p.prev;){if(p.i!==g.i&&ZE(p,g)){var v=$v(p,g);return p=pc(p,p.next),v=pc(v,v.next),Dd(p,e,i,r,l,u,0),void Dd(v,e,i,r,l,u,0)}g=g.next}p=p.next}while(p!==t)}function $E(t,e){return t.x-e.x}function qE(t,e){var i=function(l,u){var p,g=u,v=l.x,b=l.y,M=-1/0;do{if(b<=g.y&&b>=g.next.y&&g.next.y!==g.y){var A=g.x+(b-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(A<=v&&A>M&&(M=A,p=g.x<g.next.x?g:g.next,A===v))return p}g=g.next}while(g!==u);if(!p)return null;var C,R=p,k=p.x,O=p.y,V=1/0;g=p;do v>=g.x&&g.x>=k&&v!==g.x&&Su(b<O?v:M,b,k,O,b<O?M:v,b,g.x,g.y)&&(C=Math.abs(b-g.y)/(v-g.x),Ld(g,l)&&(C<V||C===V&&(g.x>p.x||g.x===p.x&&HE(p,g)))&&(p=g,V=C)),g=g.next;while(g!==R);return p}(t,e);if(!i)return e;var r=$v(i,t);return pc(r,r.next),pc(i,i.next)}function HE(t,e){return Zn(t.prev,t,e.prev)<0&&Zn(e.next,t,t.next)<0}function jg(t,e,i,r,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function WE(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Su(t,e,i,r,l,u,p,g){return(l-p)*(e-g)>=(t-p)*(u-g)&&(t-p)*(r-g)>=(i-p)*(e-g)&&(i-p)*(u-g)>=(l-p)*(r-g)}function ZE(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==r.i&&l.next.i!==r.i&&Gv(l,l.next,i,r))return!0;l=l.next}while(l!==i);return!1}(t,e)&&(Ld(t,e)&&Ld(e,t)&&function(i,r){var l=i,u=!1,p=(i.x+r.x)/2,g=(i.y+r.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&p<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==i);return u}(t,e)&&(Zn(t.prev,t,e.prev)||Zn(t,e.prev,e))||Yp(t,e)&&Zn(t.prev,t,t.next)>0&&Zn(e.prev,e,e.next)>0)}function Zn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Yp(t,e){return t.x===e.x&&t.y===e.y}function Gv(t,e,i,r){var l=Jp(Zn(t,e,i)),u=Jp(Zn(t,e,r)),p=Jp(Zn(i,r,t)),g=Jp(Zn(i,r,e));return l!==u&&p!==g||!(l!==0||!Kp(t,i,e))||!(u!==0||!Kp(t,r,e))||!(p!==0||!Kp(i,t,r))||!(g!==0||!Kp(i,e,r))}function Kp(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Jp(t){return t>0?1:t<0?-1:0}function Ld(t,e){return Zn(t.prev,t,t.next)<0?Zn(t,e,t.next)>=0&&Zn(t,t.prev,e)>=0:Zn(t,e,t.prev)<0||Zn(t,t.next,e)<0}function $v(t,e){var i=new Gg(t.i,t.x,t.y),r=new Gg(e.i,e.x,e.y),l=t.next,u=e.prev;return t.next=e,e.prev=t,i.next=l,l.prev=i,r.next=i,i.prev=r,u.next=r,r.prev=u,r}function qv(t,e,i,r){var l=new Gg(t,e,i);return r?(l.next=r.next,l.prev=r,r.next.prev=l,r.next=l):(l.prev=l,l.next=l),l}function Rd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Gg(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $g(t,e,i,r){for(var l=0,u=e,p=i-r;u<i;u+=r)l+=(t[p]-t[u])*(t[u+1]+t[p+1]),p=u;return l}Ug.exports=Xp,Ug.exports.default=Xp,Xp.deviation=function(t,e,i,r){var l=e&&e.length,u=Math.abs($g(t,0,l?e[0]*i:t.length,i));if(l)for(var p=0,g=e.length;p<g;p++)u-=Math.abs($g(t,e[p]*i,p<g-1?e[p+1]*i:t.length,i));var v=0;for(p=0;p<r.length;p+=3){var b=r[p]*i,M=r[p+1]*i,A=r[p+2]*i;v+=Math.abs((t[b]-t[A])*(t[M+1]-t[b+1])-(t[b]-t[M])*(t[A+1]-t[b+1]))}return u===0&&v===0?0:Math.abs((v-u)/u)},Xp.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,l=0;l<t.length;l++){for(var u=0;u<t[l].length;u++)for(var p=0;p<e;p++)i.vertices.push(t[l][u][p]);l>0&&i.holes.push(r+=t[l-1].length)}return i};var Qp=gt(Ug.exports);function qg(t,e){const i=t.length;if(i<=1)return[t];const r=[];let l,u;for(let p=0;p<i;p++){const g=ft(t[p]);g!==0&&(t[p].area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(l&&r.push(l),l=[t[p]]):l.push(t[p]))}if(l&&r.push(l),e>1)for(let p=0;p<r.length;p++)r[p].length<=e||(W_(r[p],e,1,r[p].length-1,XE),r[p]=r[p].slice(0,e));return r}function XE(t,e){return e.area-t.area}function Hg(t,e,i){const r=i.patternDependencies;let l=!1;for(const u of e){const p=u.paint.get(`${t}-pattern`);p.isConstant()||(l=!0);const g=p.constantOr(null);g&&(l=!0,r[g]=!0)}return l}function Wg(t,e,i,r,l){const u=l.patternDependencies;for(const p of e){const g=p.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:r},i,{},l.availableImages);v=v&&v.name?v.name:v,u[v]=!0,i.patterns[p.id]=v}}return i}class Zg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Es,this.indexArray=new Qn,this.indexArray2=new Bs,this.programConfigurations=new $(e.layers,e.zoom),this.segments=new Cn,this.segments2=new Cn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,l){this.hasPattern=Hg("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:g,id:v,index:b,sourceLayerIndex:M}of e){const A=this.layers[0]._featureFilter.needGeometry,C=qn(g,A);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),C,r))continue;const R=u?u.evaluate(C,{},r,i.availableImages):void 0,k={id:v,properties:g.properties,type:g.type,sourceLayerIndex:M,index:b,geometry:A?C.geometry:tr(g,r,l),patterns:{},sortKey:R};p.push(k)}u&&p.sort((g,v)=>g.sortKey-v.sortKey);for(const g of p){const{geometry:v,index:b,sourceLayerIndex:M}=g;if(this.hasPattern){const A=Wg("fill",this.layers,g,this.zoom,i);this.patternFeatures.push(A)}else this.addFeature(g,v,b,r,{},i.availableImages,i.brightness);i.featureIndex.insert(e[b].feature,v,b,M,this.index)}}update(e,i,r,l,u){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,r,l,u)}addFeatures(e,i,r,l,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,r,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,l,u,p=[],g){for(const v of qg(i,500)){let b=0;for(const O of v)b+=O.length;const M=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),A=M.vertexLength,C=[],R=[];for(const O of v){if(O.length===0)continue;O!==v[0]&&R.push(C.length/2);const V=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),j=V.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(j+O.length-1,j),C.push(O[0].x),C.push(O[0].y);for(let K=1;K<O.length;K++)this.layoutVertexArray.emplaceBack(O[K].x,O[K].y),this.indexArray2.emplaceBack(j+K-1,j+K),C.push(O[K].x),C.push(O[K].y);V.vertexLength+=O.length,V.primitiveLength+=O.length}const k=Qp(C,R);for(let O=0;O<k.length;O+=3)this.indexArray.emplaceBack(A+k[O],A+k[O+1],A+k[O+2]);M.vertexLength+=b,M.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,l,g)}}Mt(Zg,"FillBucket",{omit:["layers","patternFeatures"]});const YE=new wn({"fill-sort-key":new Gt(Te.layout_fill["fill-sort-key"]),visibility:new rt(Te.layout_fill.visibility)});var KE={paint:new wn({"fill-antialias":new rt(Te.paint_fill["fill-antialias"]),"fill-opacity":new Gt(Te.paint_fill["fill-opacity"]),"fill-color":new Gt(Te.paint_fill["fill-color"]),"fill-outline-color":new Gt(Te.paint_fill["fill-outline-color"]),"fill-translate":new rt(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new rt(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gt(Te.paint_fill["fill-pattern"]),"fill-emissive-strength":new rt(Te.paint_fill["fill-emissive-strength"])}),layout:YE};const JE=Hi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),QE=Hi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),eA=Hi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),tA=Hi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),iA=Hi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:nA}=JE;var em={},rA=ui,Hv=Eu;function Eu(t,e,i,r,l){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=l,t.readFields(sA,this,e)}function sA(t,e,i){t==1?e.id=i.readVarint():t==2?function(r,l){for(var u=r.readVarint()+r.pos;r.pos<u;){var p=l._keys[r.readVarint()],g=l._values[r.readVarint()];l.properties[p]=g}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function oA(t){for(var e,i,r=0,l=0,u=t.length,p=u-1;l<u;p=l++)r+=((i=t[p]).x-(e=t[l]).x)*(e.y+i.y);return r}Eu.types=["Unknown","Point","LineString","Polygon"],Eu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,l=0,u=0,p=0,g=[];t.pos<i;){if(l<=0){var v=t.readVarint();r=7&v,l=v>>3}if(l--,r===1||r===2)u+=t.readSVarint(),p+=t.readSVarint(),r===1&&(e&&g.push(e),e=[]),e.push(new rA(u,p));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&g.push(e),g},Eu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,l=0,u=0,p=1/0,g=-1/0,v=1/0,b=-1/0;t.pos<e;){if(r<=0){var M=t.readVarint();i=7&M,r=M>>3}if(r--,i===1||i===2)(l+=t.readSVarint())<p&&(p=l),l>g&&(g=l),(u+=t.readSVarint())<v&&(v=u),u>b&&(b=u);else if(i!==7)throw new Error("unknown command "+i)}return[p,v,g,b]},Eu.prototype.toGeoJSON=function(t,e,i){var r,l,u=this.extent*Math.pow(2,i),p=this.extent*t,g=this.extent*e,v=this.loadGeometry(),b=Eu.types[this.type];function M(R){for(var k=0;k<R.length;k++){var O=R[k];R[k]=[360*(O.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+g)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(r=0;r<v.length;r++)A[r]=v[r][0];M(v=A);break;case 2:for(r=0;r<v.length;r++)M(v[r]);break;case 3:for(v=function(R){var k=R.length;if(k<=1)return[R];for(var O,V,j=[],K=0;K<k;K++){var ee=oA(R[K]);ee!==0&&(V===void 0&&(V=ee<0),V===ee<0?(O&&j.push(O),O=[R[K]]):O.push(R[K]))}return O&&j.push(O),j}(v),r=0;r<v.length;r++)for(l=0;l<v[r].length;l++)M(v[r][l])}v.length===1?v=v[0]:b="Multi"+b;var C={type:"Feature",geometry:{type:b,coordinates:v},properties:this.properties};return"id"in this&&(C.id=this.id),C};var aA=Hv,Wv=Zv;function Zv(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(lA,this,e),this.length=this._features.length}function lA(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(r){for(var l=null,u=r.readVarint()+r.pos;r.pos<u;){var p=r.readVarint()>>3;l=p===1?r.readString():p===2?r.readFloat():p===3?r.readDouble():p===4?r.readVarint64():p===5?r.readVarint():p===6?r.readSVarint():p===7?r.readBoolean():null}return l}(i))}Zv.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new aA(this._pbf,e,this.extent,this._keys,this._values)};var cA=Wv;function uA(t,e,i){if(t===3){var r=new cA(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var Xg=em.VectorTile=function(t,e){this.layers=t.readFields(uA,{},e)},tm=em.VectorTileFeature=Hv;function im(t,e,i,r){const l=[],u=r===0?(p,g,v,b,M,A)=>{p.push(new $e(A,v+(A-g)/(b-g)*(M-v)))}:(p,g,v,b,M,A)=>{p.push(new $e(g+(A-v)/(M-v)*(b-g),A))};for(const p of t){const g=[];for(const v of p){if(v.length<=2)continue;const b=[];for(let C=0;C<v.length-1;C++){const R=v[C].x,k=v[C].y,O=v[C+1].x,V=v[C+1].y,j=r===0?R:k,K=r===0?O:V;j<e?K>e&&u(b,R,k,O,V,e):j>i?K<i&&u(b,R,k,O,V,i):b.push(v[C]),K<e&&j>=e&&u(b,R,k,O,V,e),K>i&&j<=i&&u(b,R,k,O,V,i)}let M=v[v.length-1];const A=r===0?M.x:M.y;A>=e&&A<=i&&b.push(M),b.length&&(M=b[b.length-1],b[0].x===M.x&&b[0].y===M.y||b.push(b[0]),g.push(b))}g.length&&l.push(g)}return l}function nm(t,e){return t.x-e.x||t.y-e.y}function Xv(t,e){return nm(t.min,e.min)===0&&nm(t.max,e.max)===0}function Yv(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Kv(t,e,i){const r=1/yt,l=1/(1<<i.canonical.z),u=(e.x*r+i.canonical.x)*l+i.wrap,p=(e.y*r+i.canonical.y)*l;return{min:new $e((t.x*r+i.canonical.x)*l+i.wrap,(t.y*r+i.canonical.y)*l),max:new $e(u,p)}}function hA(t,e,i){const r=1<<i.canonical.z,l=((e.x-i.wrap)*r-i.canonical.x)*yt,u=(e.y*r-i.canonical.y)*yt;return{min:new $e(((t.x-i.wrap)*r-i.canonical.x)*yt,(t.y*r-i.canonical.y)*yt),max:new $e(l,u)}}function Jv(t,e,i,r,l,u,p){const g=t.indices,v=t.vertices,b=[];for(let M=r;M<r+l;M+=3){const A=e[i[M+0]+u],C=e[i[M+1]+u],R=e[i[M+2]+u],k=Math.min(A.x,C.x,R.x),O=Math.max(A.x,C.x,R.x),V=Math.min(A.y,C.y,R.y),j=Math.max(A.y,C.y,R.y);b.length=0,t.grid.query(new $e(k,V),new $e(O,j),b);for(let K=0;K<b.length;K++){const ee=b[K];if(_g(v[g[3*ee+0]],v[g[3*ee+1]],v[g[3*ee+2]],A,C,R,p))return!0}}return!1}function Qv(t,e,i,r){if(!t||!i)return!1;let l=t.vertices;if(!e.canonical.equals(r.canonical)||e.wrap!==r.wrap){if(i.vertices.length<t.vertices.length)return Qv(i,r,t,e);const u=e.canonical,p=r.canonical,g=Math.pow(2,p.z-u.z);l=t.vertices.map(v=>new $e(v.x*u.x*yt*g-p.x*yt,v.y*u.y*yt*g-p.y*yt))}return Jv(i,l,t.indices,0,t.indices.length,0,0)}em.VectorTileLayer=Wv;class eb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function tb(t,e,i,r){let l=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(r[p])<1e-15){if(i[p]<t[p]||i[p]>e[p])return null}else{const g=1/r[p];let v=(t[p]-i[p])*g,b=(e[p]-i[p])*g;if(v>b){const M=v;v=b,b=M}if(v>l&&(l=v),b<u&&(u=b),l>u)return null}return l}function ib(t,e,i,r,l,u,p,g,v,b,M){const A=r-t,C=l-e,R=u-i,k=p-t,O=g-e,V=v-i,j=M[1]*V-M[2]*O,K=M[2]*k-M[0]*V,ee=M[0]*O-M[1]*k,Q=A*j+C*K+R*ee;if(Math.abs(Q)<1e-15)return null;const oe=1/Q,se=b[0]-t,he=b[1]-e,me=b[2]-i,xe=(se*j+he*K+me*ee)*oe;if(xe<0||xe>1)return null;const Ee=he*R-me*C,ve=me*A-se*R,ke=se*C-he*A,Ge=(M[0]*Ee+M[1]*ve+M[2]*ke)*oe;return Ge<0||xe+Ge>1?null:(k*Ee+O*ve+V*ke)*oe}function nb(t,e,i){return(t-e)/(i-e)}function rb(t,e,i,r,l,u,p,g,v){const b=1<<i,M=u-r,A=p-l,C=(t+1)/b*M+r,R=(e+0)/b*A+l,k=(e+1)/b*A+l;g[0]=(t+0)/b*M+r,g[1]=R,v[0]=C,v[1]=k}class sb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(u){const p=Math.ceil(Math.log2(u.dim/8)),g=[];let v=Math.ceil(Math.pow(2,p));const b=1/v,M=(R,k,O,V,j)=>{const K=V?1:0,ee=(R+1)*O-K,Q=k*O,oe=(k+1)*O-K;j[0]=R*O,j[1]=Q,j[2]=ee,j[3]=oe};let A=new eb(v);const C=[];for(let R=0;R<v*v;R++){M(R%v,Math.floor(R/v),b,!1,C);const k=Ka(C[0],C[1],u),O=Ka(C[2],C[1],u),V=Ka(C[2],C[3],u),j=Ka(C[0],C[3],u);A.minimums.push(Math.min(k,O,V,j)),A.maximums.push(Math.max(k,O,V,j)),A.leaves.push(1)}for(g.push(A),v/=2;v>=1;v/=2){const R=g[g.length-1];A=new eb(v);for(let k=0;k<v*v;k++){M(k%v,Math.floor(k/v),2,!0,C);const O=R.getElevation(C[0],C[1]),V=R.getElevation(C[2],C[1]),j=R.getElevation(C[2],C[3]),K=R.getElevation(C[0],C[3]),ee=R.isLeaf(C[0],C[1]),Q=R.isLeaf(C[2],C[1]),oe=R.isLeaf(C[2],C[3]),se=R.isLeaf(C[0],C[3]),he=Math.min(O.min,V.min,j.min,K.min),me=Math.max(O.max,V.max,j.max,K.max),xe=ee&&Q&&oe&&se;A.maximums.push(me),A.minimums.push(he),A.leaves.push(me-he<=5&&xe?1:0)}g.push(A)}return g}(this.dem),r=i.length-1,l=i[r];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,l,u,p,g=1){return tb([e,i,-100],[r,l,this.maximums[0]*g],u,p)}raycast(e,i,r,l,u,p,g=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,i,r,l,u,p,g);if(v==null)return null;const b=[],M=[],A=[],C=[],R=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:k,t:O,nodex:V,nodey:j,depth:K}=R.pop();if(this.leaves[k]){rb(V,j,K,e,i,r,l,A,C);const Q=1<<K,oe=(V+0)/Q,se=(V+1)/Q,he=(j+0)/Q,me=(j+1)/Q,xe=Ka(oe,he,this.dem)*g,Ee=Ka(se,he,this.dem)*g,ve=Ka(se,me,this.dem)*g,ke=Ka(oe,me,this.dem)*g,Ge=ib(A[0],A[1],xe,C[0],A[1],Ee,C[0],C[1],ve,u,p),Re=ib(C[0],C[1],ve,A[0],C[1],ke,A[0],A[1],xe,u,p),je=Math.min(Ge!==null?Ge:Number.MAX_VALUE,Re!==null?Re:Number.MAX_VALUE);if(je!==Number.MAX_VALUE)return je;{const Ce=s.N.scaleAndAdd([],u,p,O);if(ob(xe,Ee,ke,ve,nb(Ce[0],A[0],C[0]),nb(Ce[1],A[1],C[1]))>=Ce[2])return O}continue}let ee=0;for(let Q=0;Q<this._siblingOffset.length;Q++){rb((V<<1)+this._siblingOffset[Q][0],(j<<1)+this._siblingOffset[Q][1],K+1,e,i,r,l,A,C),A[2]=-100,C[2]=this.maximums[this.childOffsets[k]+Q]*g;const oe=tb(A,C,u,p);if(oe!=null){const se=oe;b[Q]=se;let he=!1;for(let me=0;me<ee&&!he;me++)se>=b[M[me]]&&(M.splice(me,0,Q),he=!0);he||(M[ee]=Q),ee++}}for(let Q=0;Q<ee;Q++){const oe=M[Q];R.push({idx:this.childOffsets[k]+oe,t:b[oe],nodex:(V<<1)+this._siblingOffset[oe][0],nodey:(j<<1)+this._siblingOffset[oe][1],depth:K+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,l,u){if(e[l].isLeaf(i,r)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=l-1,g=e[p];let v=0,b=0;for(let M=0;M<this._siblingOffset.length;M++){const A=2*i+this._siblingOffset[M][0],C=2*r+this._siblingOffset[M][1],R=g.getElevation(A,C),k=g.isLeaf(A,C),O=this._addNode(R.min,R.max,k);k&&(v|=1<<M),b||(b=O)}for(let M=0;M<this._siblingOffset.length;M++)v&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*r+this._siblingOffset[M][1],p,b+M)}}function ob(t,e,i,r,l,u){return Mi(Mi(t,i,u),Mi(e,r,u),l)}function Ka(t,e,i){const r=i.dim,l=kt(t*r-.5,0,r-1),u=kt(e*r-.5,0,r-1),p=Math.floor(l),g=Math.floor(u),v=Math.min(p+1,r-1),b=Math.min(g+1,r-1);return ob(i.get(p,g),i.get(v,g),i.get(p,b),i.get(v,b),l-p,u-g)}const dA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function fA(t,e,i){return(256*t*256+256*e+i)/10-1e4}function pA(t,e,i){return 256*t+e+i/256-32768}class rm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,l=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return be(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const u=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let v=0;v<u;v++)p[this._idx(-1,v)]=p[this._idx(0,v)],p[this._idx(u,v)]=p[this._idx(u-1,v)],p[this._idx(v,-1)]=p[this._idx(v,0)],p[this._idx(v,u)]=p[this._idx(v,u-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(u,-1)]=p[this._idx(u-1,0)],p[this._idx(-1,u)]=p[this._idx(0,u-1)],p[this._idx(u,u)]=p[this._idx(u-1,u-1)]}const g=r==="terrarium"?pA:fA;for(let v=0;v<p.length;++v){const b=4*v;this.floatView[v]=g(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=Je.now()}_buildQuadTree(){this._tree=new sb(this)}get(e,i,r=!1){r&&(e=kt(e,-1,this.dim),i=kt(i,-1,this.dim));const l=this._idx(e,i);return this.floatView[l]}set(e,i,r){const l=this._idx(e,i),u=this.floatView[l];return this.floatView[l]=r,r-u}static getUnpackVector(e){return dA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const r=[0,0,0,0],l=rm.getUnpackVector(i);let u=Math.floor((e+l[3])/l[2]);return r[2]=u%256,u=Math.floor(u/256),r[1]=u%256,u=Math.floor(u/256),r[0]=u,r}getPixels(){return new Uv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,u=i*this.dim+this.dim,p=r*this.dim,g=r*this.dim+this.dim;switch(i){case-1:l=u-1;break;case 1:u=l+1}switch(r){case-1:p=g-1;break;case 1:g=p+1}const v=-i*this.dim,b=-r*this.dim;for(let M=p;M<g;M++)for(let A=l;A<u;A++){const C=4*this._idx(A,M),R=4*this._idx(A+v,M+b);this.pixels[C+0]=e.pixels[R+0],this.pixels[C+1]=e.pixels[R+1],this.pixels[C+2]=e.pixels[R+2],this.pixels[C+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Mt(rm,"DEMData"),Mt(sb,"DemMinMaxQuadTree",{omit:["dem"]});class Au{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const l=r||e.findDEMTileFor(i);if(!l||!l.dem)return;const u=l.dem,p=l.tileID,g=1<<i.canonical.z-p.canonical.z;return new Au(l,u.dim/yt/g,[(i.canonical.x/g-p.canonical.x)*u.dim,(i.canonical.y/g-p.canonical.y)*u.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(r);return new $e(l,u)}getElevationAt(e,i,r,l){const u=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],g=Math.floor(u),v=Math.floor(p),b=this._dem;return l=!!l,r?Mi(Mi(b.get(g,v,l),b.get(g,v+1,l),p-v),Mi(b.get(g+1,v,l),b.get(g+1,v+1,l),p-v),u-g):b.get(g,v,l)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ri(1,e)*this._dem.stride}}const mA=tm.types,_A=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],gA=["fill-extrusion-flood-light-ground-radius"],yA=Math.pow(2,13),xA=Math.pow(2,15)-1,ab=new $e(0,1),Ja=2147483648;function zd(t,e,i,r,l,u,p,g){t.emplaceBack((e<<1)+p,(i<<1)+u,(Math.floor(r*yA)<<1)+l,Math.round(g))}function sm(t,e,i,r,l,u){t.emplaceBack(e.x,e.y,(i.x<<1)+r,(i.y<<1)+l,u)}function kd(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class lb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cb{constructor(){this.centroidXY=new $e(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new $e(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new $e(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new $e(this.max.x-this.min.x,this.max.y-this.min.y)}}class ub{constructor(){this.acc=new $e(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,r){this.accCount++,this.acc._add(i);let l=!!this.borders;i.x<e.min.x?(e.min.x=i.x,l=!0):i.x>e.max.x&&(e.max.x=i.x,l=!0),i.y<e.min.y?(e.min.y=i.y,l=!0):i.y>e.max.y&&(e.max.y=i.y,l=!0),((i.x===0||i.x===yt)&&i.x===r.x)!=((i.y===0||i.y===yt)&&i.y===r.y)&&this.processBorderOverlap(i,r),l&&this.checkBorderIntersection(i,r)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Mi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>yt!=e.x>yt&&this.addBorderIntersection(1,Mi(i.y,e.y,(yt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Mi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>yt!=e.y>yt&&this.addBorderIntersection(3,Mi(i.x,e.x,(yt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){return this.accCount===0?new $e(0,0):new $e(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function hb(t,e){const i=t.add(e)._unit(),r=kt(t.x*i.x+t.y*i.y,-1,1);var l,u,p;return l=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(l)))/4*xA*((u=t).x*(p=e).y-u.y*p.x<0?-1:1)}const vA=[t=>t.x<0,t=>t.x>yt,t=>t.y<0,t=>t.y>yt];function bA(t,e,i,r){const l=[4];if(r===0)return l;i._mult(r);const u=t.sub(i),p=e.sub(i),g=[t,e,u,p];for(let v=0;v<4;v++)for(const b of g)if(vA[v](b)){l.push(v);break}return l}class db{constructor(e){this.vertexArray=new fd,this.indexArray=new Qn,this.programConfigurations=new $(e.layers,e.zoom,i=>gA.includes(i)),this._segments=new Cn,this.hiddenByLandmarkVertexArray=new wd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Cn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,r,l=!1){const u=e.length;if(u>2){let p=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let v;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const b=e[0],M=e[1];v=hb(b.sub(e[u-1])._perp()._unit(),M.sub(b)._perp()._unit())}for(let b=0;b<u;b++){const M=b===u-1?0:b+1,A=e[b],C=e[M],R=e[M===u-1?0:M+1],k=C.sub(A)._perp()._unit(),O=hb(k,R.sub(C)._perp()._unit()),V=v,j=O;if(Yg(A,C,i)||l&&mb(A,i)&&mb(C,i)){v=O;continue}const K=g.vertexLength;sm(this.vertexArray,A,C,1,1,V),sm(this.vertexArray,A,C,1,0,V),sm(this.vertexArray,A,C,0,1,j),sm(this.vertexArray,A,C,0,0,j),g.vertexLength+=4;const ee=bA(A,C,k,r);for(const Q of ee)this._segmentToGroundQuads[p].push({id:K,region:Q}),this._segmentToRegionTriCounts[p][Q]+=2,g.primitiveLength+=2;v=O}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let r=0;r<i;r++)this._segmentToGroundQuads[r].sort((l,u)=>l.region-u.region);for(let r=0;r<i;r++){const l=this._segmentToGroundQuads[r],u=e[r],p=this._segmentToRegionTriCounts[r];p.reduce((v,b)=>v+b,0);let g=0;for(let v=0;v<=4;v++){const b=p[v];if(b!==0){let M=this.regionSegments[v];M||(M=this.regionSegments[v]=new Cn);const A={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+g,vertexLength:u.vertexLength,primitiveLength:b};M.get().push(A)}g+=b}for(let v=0;v<l.length;v++){const b=l[v].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,r,l,u,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,r,l,u,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,QE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,r,l,u,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,r,l,u,p)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const r=e.flags&Ja?1:0;for(let l=e.groundVertexArrayOffset;l<i;++l)this.hiddenByLandmarkVertexArray.emplace(l,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,tA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class om{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Qn,this.footprintVertices=new Es,this.footprintSegments=[],this.layoutVertexArray=new Ks,this.centroidVertexArray=new oc,this.indexArray=new Qn,this.programConfigurations=new $(e.layers,e.zoom,i=>_A.includes(i)),this.segments=new Cn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new db(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,r,l){this.features=[],this.hasPattern=Hg("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=vi(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:p,index:g,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,M=qn(u,b);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),M,r))continue;const A={id:p,sourceLayerIndex:v,index:g,geometry:b?M.geometry:tr(u,r,l),properties:u.properties,type:u.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(Wg("fill-extrusion",this.layers,A,this.zoom,i)):this.addFeature(A,A.geometry,g,r,{},i.availableImages,l,i.brightness),i.featureIndex.insert(u,A.geometry,g,v,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,r,l,u,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,i,r,l,u,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,r,l,u){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const g=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,g,r,l,u),this.groundEffect.update(e,i,g,r,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,iA.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,eA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,l,u,p,g,v){const b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,M=[new $e(0,0),new $e(yt,yt)],A=g.projection,C=A.name==="globe",R=mA[e.type]==="Polygon",k=new ub;k.centroidDataIndex=this.centroidData.length;const O=new cb,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);O.height=j,O.vertexArrayOffset=this.layoutVertexArray.length,O.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _u);const K=qg(i,500);for(let me=K.length-1;me>=0;me--){const xe=K[me];(xe.length===0||(ee=xe[0]).every(Ee=>Ee.x<=0)||ee.every(Ee=>Ee.x>=yt)||ee.every(Ee=>Ee.y<=0)||ee.every(Ee=>Ee.y>=yt))&&K.splice(me,1)}var ee;let Q;if(C)Q=xb(K,M,l);else{Q=[];for(const me of K)Q.push({polygon:me,bounds:M})}const oe=R?this.edgeRadius:0,se=oe>0&&this.zoom<17,he=(me,xe)=>{if(me.length===0)return!1;const Ee=me[me.length-1];return xe.x===Ee.x&&xe.y===Ee.y};for(const{polygon:me,bounds:xe}of Q){let Ee=0,ve=0;for(const je of me)R&&!je[0].equals(je[je.length-1])&&je.push(je[0]),ve+=R?je.length-1:je.length;const ke=this.segments.prepareSegment((R?5:4)*ve,this.layoutVertexArray,this.indexArray);O.footprintSegIdx<0&&(O.footprintSegIdx=this.footprintSegments.length),O.polygonSegIdx<0&&(O.polygonSegIdx=this.polygonSegments.length);const Ge={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Re=new lb;if(Re.vertexOffset=this.footprintVertices.length,Re.indexOffset=3*this.footprintIndices.length,Re.ringIndices=[],R){const je=[],Ce=[];Ee=ke.vertexLength;for(let ot=0;ot<me.length;ot++){const qe=me[ot];qe.length&&ot!==0&&Ce.push(je.length/2);const It=[];let bt,Ye;bt=qe[1].sub(qe[0])._perp()._unit(),Re.ringIndices.push(qe.length-1);for(let Xt=1;Xt<qe.length;Xt++){const Ft=qe[Xt],At=qe[Xt===qe.length-1?1:Xt+1],Ke=Ft.clone();if(oe){Ye=At.sub(Ft)._perp()._unit();const $t=bt.add(Ye)._unit(),fi=oe*Math.min(4,1/(bt.x*$t.x+bt.y*$t.y));Ke.x+=fi*$t.x,Ke.y+=fi*$t.y,Ke.x=Math.round(Ke.x),Ke.y=Math.round(Ke.y),bt=Ye}!V||oe!==0&&!se||he(It,Ke)||It.push(Ke),zd(this.layoutVertexArray,Ke.x,Ke.y,0,0,1,1,0),ke.vertexLength++,this.footprintVertices.emplaceBack(Ft.x,Ft.y),je.push(Ft.x,Ft.y),C&&kd(this.layoutVertexExtArray,A.projectTilePoint(Ke.x,Ke.y,l),A.upVector(l,Ke.x,Ke.y))}V&&(oe===0||se)&&(It.length!==0&&he(It,It[0])&&It.pop(),this.groundEffect.addData(It,xe,b))}const Ue=Qp(je,Ce);for(let ot=0;ot<Ue.length;ot+=3)this.footprintIndices.emplaceBack(Re.vertexOffset+Ue[ot+0],Re.vertexOffset+Ue[ot+1],Re.vertexOffset+Ue[ot+2]),this.indexArray.emplaceBack(Ee+Ue[ot],Ee+Ue[ot+2],Ee+Ue[ot+1]),ke.primitiveLength++;Re.indexCount+=Ue.length,Re.vertexCount+=this.footprintVertices.length-Re.vertexOffset}for(let je=0;je<me.length;je++){const Ce=me[je];k.startRing(O,Ce[0]);let Ue=Ce.length>4&&_b(Ce[Ce.length-2],Ce[0],Ce[1]),ot=oe?wA(Ce[Ce.length-2],Ce[0],Ce[1],oe):0;const qe=[];let It,bt,Ye;bt=Ce[1].sub(Ce[0])._perp()._unit();let Xt=!0;for(let Ft=1,At=0;Ft<Ce.length;Ft++){let Ke=Ce[Ft-1],$t=Ce[Ft];const fi=Ce[Ft===Ce.length-1?1:Ft+1];if(k.appendEdge(O,$t,Ke),Yg($t,Ke,xe)){oe&&(bt=fi.sub($t)._perp()._unit(),Xt=!Xt);continue}const Yt=$t.sub(Ke)._perp(),pi=Yt.x/(Math.abs(Yt.x)+Math.abs(Yt.y)),ti=Yt.y>0?1:0,Si=Ke.dist($t);if(At+Si>32768&&(At=0),oe){Ye=fi.sub($t)._perp()._unit();let Fi=pb(Ke,$t,fi,fb(bt,Ye),oe);isNaN(Fi)&&(Fi=0);const $i=$t.sub(Ke)._unit();Ke=Ke.add($i.mult(ot))._round(),$t=$t.add($i.mult(-Fi))._round(),ot=Fi,bt=Ye,V&&this.zoom>=17&&(he(qe,Ke)||qe.push(Ke),he(qe,$t)||qe.push($t))}const si=ke.vertexLength,nn=Ce.length>4&&_b(Ke,$t,fi);let ki=gb(At,Ue,Xt);if(zd(this.layoutVertexArray,Ke.x,Ke.y,pi,ti,0,0,ki),zd(this.layoutVertexArray,Ke.x,Ke.y,pi,ti,0,1,ki),At+=Si,ki=gb(At,nn,!Xt),Ue=nn,zd(this.layoutVertexArray,$t.x,$t.y,pi,ti,0,0,ki),zd(this.layoutVertexArray,$t.x,$t.y,pi,ti,0,1,ki),ke.vertexLength+=4,this.indexArray.emplaceBack(si+0,si+1,si+2),this.indexArray.emplaceBack(si+1,si+3,si+2),ke.primitiveLength+=2,oe){const Fi=Ee+(Ft===1?Ce.length-2:Ft-2),$i=Ft===1?Ee:Fi+1;if(this.indexArray.emplaceBack(si+1,Fi,si+3),this.indexArray.emplaceBack(Fi,$i,si+3),ke.primitiveLength+=2,It===void 0&&(It=si),!Yg(fi,Ce[Ft],xe)){const Oi=Ft===Ce.length-1?It:ke.vertexLength;this.indexArray.emplaceBack(si+2,si+3,Oi),this.indexArray.emplaceBack(si+3,Oi+1,Oi),this.indexArray.emplaceBack(si+3,$i,Oi+1),ke.primitiveLength+=3}Xt=!Xt}if(C){const Fi=this.layoutVertexExtArray,$i=A.projectTilePoint(Ke.x,Ke.y,l),Oi=A.projectTilePoint($t.x,$t.y,l),vn=A.upVector(l,Ke.x,Ke.y),Xi=A.upVector(l,$t.x,$t.y);kd(Fi,$i,vn),kd(Fi,$i,vn),kd(Fi,Oi,Xi),kd(Fi,Oi,Xi)}}R&&(Ee+=Ce.length-1),V&&oe&&this.zoom>=17&&(qe.length!==0&&he(qe,qe[0])&&qe.pop(),this.groundEffect.addData(qe,xe,b,oe>0))}this.footprintSegments.push(Re),Ge.triangleCount=this.indexArray.length-Ge.triangleArrayOffset,this.polygonSegments.push(Ge),++O.footprintSegLen,++O.polygonSegLen}if(O.vertexCount=this.layoutVertexArray.length-O.vertexArrayOffset,O.groundVertexCount=this.groundEffect.vertexArray.length-O.groundVertexArrayOffset,O.vertexCount!==0){if(O.centroidXY=k.borders?ab:this.encodeCentroid(k,O),this.centroidData.push(O),k.borders){this.featuresOnBorder.push(k);const me=this.featuresOnBorder.length-1;for(let xe=0;xe<k.borders.length;xe++)k.borders[xe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[xe].push(me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,l,v),this.groundEffect.addPaintPropertiesData(e,r,u,p,l,v),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const v=this.centroidData[g],b=+(v.min.y+v.max.y>yt),M=2*b+(+(v.min.x+v.max.x>yt)^b);for(let A=0;A<v.polygonSegLen;A++){const C=v.polygonSegIdx+A;e.push({centroidIdx:g,subtile:M,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const i=new Qn;e.sort((g,v)=>g.triangleSegmentIdx===v.triangleSegmentIdx?g.subtile-v.subtile:g.triangleSegmentIdx-v.triangleSegmentIdx);let r=0,l=0,u=0;for(const g of e){if(g.triangleSegmentIdx!==r)break;u++}const p=e.length;for(;l!==e.length;){r=e[l].triangleSegmentIdx;let g=0,v=l,b=l;for(let M=v;M<u&&e[M].subtile===g;M++)b++;for(;v!==u;){const M=e[v];g=M.subtile;const A=this.centroidData[M.centroidIdx].min.clone(),C=this.centroidData[M.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=v;k<b;k++){const O=e[k],V=this.polygonSegments[O.polygonSegmentIdx],j=this.centroidData[O.centroidIdx].min,K=this.centroidData[O.centroidIdx].max,ee=this.indexArray.uint16;for(let Q=V.triangleArrayOffset;Q<V.triangleArrayOffset+V.triangleCount;Q++)i.emplaceBack(ee[3*Q],ee[3*Q+1],ee[3*Q+2]);R.primitiveLength+=V.triangleCount,A.x=Math.min(A.x,j.x),A.y=Math.min(A.y,j.y),C.x=Math.max(C.x,K.x),C.y=Math.max(C.y,K.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:A,max:C}),v=b;for(let k=v;k<u&&e[k].subtile===e[v].subtile;k++)b++}l=u;for(let M=l;M<p&&e[M].triangleSegmentIdx===e[l].triangleSegmentIdx;M++)u++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,r){let l=0,u=0;const p=1<<e.canonical.z;if(i){const O=i.getMinMaxForTile(e);O&&(l=O.min,u=O.max)}u+=this.maxHeight;const g=e.toUnwrapped();let v;const b=[g.canonical.x/p+g.wrap,g.canonical.y/p],M=[(g.canonical.x+1)/p+g.wrap,(g.canonical.y+1)/p],A=new Cn,C=(O,V,j)=>[O[0]*(1-j[0])+V[0]*j[0],O[1]*(1-j[1])+V[1]*j[1]],R=[],k=[];for(const O of this.triangleSubSegments){R[0]=O.min.x/yt,R[1]=O.min.y/yt,k[0]=O.max.x/yt,k[1]=O.max.y/yt;const V=C(b,M,R),j=C(b,M,k);if(new An([V[0],V[1],l],[j[0],j[1],u]).intersectsPrecise(r)===0){v&&(A.segments.push(v),v=void 0);continue}const K=O.segment;v&&v.vertexOffset!==K.vertexOffset&&(A.segments.push(v),v=void 0),v?(v.vertexLength+=K.vertexLength,v.primitiveLength+=K.primitiveLength):v={vertexOffset:K.vertexOffset,primitiveLength:K.primitiveLength,vertexLength:K.vertexLength,primitiveOffset:K.primitiveOffset,sortKey:void 0,vaos:{}}}return v&&A.segments.push(v),A}encodeCentroid(e,i){const r=e.centroid(),l=i.span(),u=Math.min(7,Math.round(l.x*this.tileToMeter/10)),p=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new $e(kt(r.x,1,yt-1)<<3|u,kt(r.y,1,yt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new $e(0,0);const i=e.borders,r=Number.MAX_VALUE;if(i[0][0]!==r||i[1][0]!==r){const l=i[0][0]!==r?0:1;return new $e(6|(i[0][0]!==r?0:65528),(i[l][0]+i[l][1])/2<<3|6)}{const l=i[2][0]!==r?2:3;return new $e((i[l][0]+i[l][1])/2<<3|6,6|(i[2][0]!==r?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Ja,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,l=e.flags&Ja?ab:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==l.y||u!==l.x){for(let p=i;p<r;++p)this.centroidVertexArray.emplace(p,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(u,p){if(u.length!==p.length)return!1;for(let g=0;g<u.length;g++)if(u[g].sourceId!==p[g].sourceId||!Xv(u[g],p[g]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const u of this.centroidData)u.flags&=2147483647;const l=[];for(const u of this.activeReplacements){const p=Math.pow(2,u.footprintTileId.canonical.z-e.canonical.z);for(const g of this.centroidData)if(!(g.flags&Ja||u.min.x>g.max.x||g.min.x>u.max.x||u.min.y>g.max.y||g.min.y>u.max.y))for(let v=0;v<g.footprintSegLen;v++){const b=this.footprintSegments[g.footprintSegIdx+v];if(l.length=0,TA(this.footprintVertices,b.vertexOffset,b.vertexCount,u.footprintTileId.canonical,e.canonical,l),Jv(u.footprint,l,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-p)){g.flags|=Ja;break}}}for(const u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,r){let l=!1;for(let u=0;u<r.footprintSegLen;u++){const p=this.footprintSegments[r.footprintSegIdx+u];let g=0;for(const v of p.ringIndices){for(let b=g,M=v+g-1;b<v+g;M=b++){const A=this.footprintVertices.int16[2*(b+p.vertexOffset)+0],C=this.footprintVertices.int16[2*(b+p.vertexOffset)+1],R=this.footprintVertices.int16[2*(M+p.vertexOffset)+1];C>i!=R>i&&e<(this.footprintVertices.int16[2*(M+p.vertexOffset)+0]-A)*(i-C)/(R-C)+A&&(l=!l)}g=v}}return l}getHeightAtTileCoord(e,i){let r=Number.NEGATIVE_INFINITY,l=!0;const u=4*(e+yt)*yt+(i+yt);if(this.partLookup.hasOwnProperty(u)){const p=this.partLookup[u];return p?{height:p.height,hidden:!!(p.flags&Ja)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||this.footprintContainsPoint(e,i,p)&&p&&p.height>r&&(r=p.height,this.partLookup[u]=p,l=!!(p.flags&Ja));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:l};this.partLookup[u]=void 0}}function fb(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function wA(t,e,i,r){const l=e.sub(t)._perp()._unit(),u=i.sub(e)._perp()._unit();return pb(t,e,i,fb(l,u),r)}function pb(t,e,i,r,l){const u=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,l*u/r)}function Yg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function mb(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function _b(t,e,i){if(t.x<0||t.x>=yt||e.x<0||e.x>=yt||i.x<0||i.x>=yt)return!1;const r=i.sub(e),l=r.perp(),u=t.sub(e);return(r.x*u.x+r.y*u.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function gb(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function yb(){const t=Math.PI/32,e=Math.tan(t),i=De;return i*Math.sqrt(1+2*e*e)-i}function xb(t,e,i){const r=1<<i.z,l=ni(i.x/r),u=ni((i.x+1)/r),p=Ai(i.y/r),g=Ai((i.y+1)/r);return function(v,b,M,A,C=0,R){const k=[];if(!v.length||!M||!A)return k;const O=(se,he)=>{for(const me of se)k.push({polygon:me,bounds:he})},V=Math.ceil(Math.log2(M)),j=Math.ceil(Math.log2(A)),K=V-j,ee=[];for(let se=0;se<Math.abs(K);se++)ee.push(K>0?0:1);for(let se=0;se<Math.min(V,j);se++)ee.push(0),ee.push(1);let Q=v;if(Q=im(Q,b[0].y-C,b[1].y+C,1),Q=im(Q,b[0].x-C,b[1].x+C,0),!Q.length)return k;const oe=[];for(ee.length?oe.push({polygons:Q,bounds:b,depth:0}):O(Q,b);oe.length;){const se=oe.pop(),he=se.depth,me=ee[he],xe=se.bounds[0],Ee=se.bounds[1],ve=me===0?xe.x:xe.y,ke=me===0?Ee.x:Ee.y,Ge=R?R(me,ve,ke):.5*(ve+ke),Re=im(se.polygons,ve-C,Ge+C,me),je=im(se.polygons,Ge-C,ke+C,me);if(Re.length){const Ce=[xe,new $e(me===0?Ge:Ee.x,me===1?Ge:Ee.y)];ee.length>he+1?oe.push({polygons:Re,bounds:Ce,depth:he+1}):O(Re,Ce)}if(je.length){const Ce=[new $e(me===0?Ge:xe.x,me===1?Ge:xe.y),Ee];ee.length>he+1?oe.push({polygons:je,bounds:Ce,depth:he+1}):O(je,Ce)}}return k}(t,e,Math.ceil((u-l)/11.25),Math.ceil((p-g)/11.25),1,(v,b,M)=>{if(v===0)return .5*(b+M);{const A=Ai((i.y+b/yt)/r);return(Jt(.5*(Ai((i.y+M/yt)/r)+A))*r-i.y)*yt}})}function TA(t,e,i,r,l,u){const p=Math.pow(2,r.z-l.z);for(let g=0;g<i;g++){let v=t.int16[2*(g+e)+0],b=t.int16[2*(g+e)+1];v=(v+l.x*yt)*p-r.x*yt,b=(b+l.y*yt)*p-r.y*yt,u.push(new $e(v,b))}}Mt(om,"FillExtrusionBucket",{omit:["layers","features"]}),Mt(cb,"PartData"),Mt(lb,"FootprintSegment"),Mt(ub,"BorderCentroidData"),Mt(db,"GroundEffect");const MA=new wn({visibility:new rt(Te["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new rt(Te["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var SA={paint:new wn({"fill-extrusion-opacity":new rt(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rt(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rt(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gt(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rt(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new rt(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new rt(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new rt(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new rt(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new rt(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new rt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new rt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new rt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new rt(Te["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new rt(Te["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new rt(Te["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new rt(Te["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:MA};class Iu extends $e{constructor(e,i,r){super(e,i),this.z=r}}function Od(t,e){return t.x*e.x+t.y*e.y}function vb(t,e){if(t.length===1){let i=0;const r=e[i++];let l;for(;!l||r.equals(l);)if(l=e[i++],!l)return 1/0;for(;i<e.length;i++){const u=e[i],p=t[0],g=l.sub(r),v=u.sub(r),b=p.sub(r),M=Od(g,g),A=Od(g,v),C=Od(v,v),R=Od(b,g),k=Od(b,v),O=M*C-A*A,V=(C*R-A*k)/O,j=(M*k-A*R)/O,K=r.z*(1-V-j)+l.z*V+u.z*j;if(isFinite(K))return K}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function bb(t,e,i,r,l,u,p,g){const v=p*l.getElevationAt(t,e,!0,!0),b=u[0]!==0,M=b?u[1]===0?p*(u[0]/7-450):p*function(A,C,R){const k=Math.floor(C[0]/8),O=Math.floor(C[1]/8),V=10*(C[0]-8*k),j=10*(C[1]-8*O),K=A.getElevationAt(k,O,!0,!0),ee=A.getMeterToDEM(R),Q=Math.floor(.5*(V*ee-1)),oe=Math.floor(.5*(j*ee-1)),se=A.tileCoordToPixel(k,O),he=2*Q+1,me=2*oe+1,xe=function(je,Ce,Ue,ot,qe){return[je.getElevationAtPixel(Ce,Ue,!0),je.getElevationAtPixel(Ce+qe,Ue,!0),je.getElevationAtPixel(Ce,Ue+qe,!0),je.getElevationAtPixel(Ce+ot,Ue+qe,!0)]}(A,se.x-Q,se.y-oe,he,me),Ee=Math.abs(xe[0]-xe[1]),ve=Math.abs(xe[2]-xe[3]),ke=Math.abs(xe[0]-xe[2])+Math.abs(xe[1]-xe[3]),Ge=Math.min(.25,.5*ee*(Ee+ve)/he),Re=Math.min(.25,.5*ee*ke/me);return K+Math.max(Ge*V,Re*j)}(l,u,g):v;return{base:v+(i===0)?-1:i,top:b?Math.max(M+r,v+i+2):v+r}}const EA=Hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:AA}=EA,IA=Hi([{name:"a_packed",components:4,type:"Float32"}]),{members:CA}=IA;class wb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Ya({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=On(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const l=[];let u=e.length%2==1?-e[e.length-1]*r:0,p=e[0]*r,g=!0;l.push({left:u,right:p,isDash:g,zeroLength:e[0]===0});let v=e[0];for(let b=1;b<e.length;b++){g=!g;const M=e[b];u=v*r,v+=M,p=v*r,l.push({left:u,right:p,isDash:g,zeroLength:M===0})}return l}addRoundDash(e,i,r){const l=i/2;for(let u=-r;u<=r;u++){const p=this.width*(this.nextRow+r+u);let g=0,v=e[g];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++g]);const M=Math.abs(b-v.left),A=Math.abs(b-v.right),C=Math.min(M,A);let R;const k=u/r*(l+1);if(v.isDash){const O=l-Math.abs(k);R=Math.sqrt(C*C+O*O)}else R=l-Math.sqrt(C*C+k*k);this.image.data[p+b]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let v=e.length-1;v>=0;--v){const b=e[v],M=e[v+1];b.zeroLength?e.splice(v,1):M&&M.isDash===b.isDash&&(M.left=b.left,e.splice(v,1))}const r=e[0],l=e[e.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const u=this.width*this.nextRow;let p=0,g=e[p];for(let v=0;v<this.width;v++){v/g.right>1&&(g=e[++p]);const b=Math.abs(v-g.left),M=Math.abs(v-g.right),A=Math.min(b,M);this.image.data[u+v]=Math.max(0,Math.min(255,(g.isDash?A:-A)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const l=i==="round",u=l?7:0,p=2*u+1;if(this.nextRow+p>this.height)return be("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let M=0;M<e.length;M++)e[M]<0&&(be("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),g+=e[M];if(g!==0){const M=this.width/g,A=this.getDashRanges(e,this.width,M);l?this.addRoundDash(A,M,u):this.addRegularDash(A,i==="square"?.5*M:0)}const v=this.nextRow+u;this.nextRow+=p;const b={tl:[v,u],br:[g,0]};return this.positions[r]=b,b}}Mt(wb,"LineAtlas");const PA=tm.types,DA=Math.cos(Math.PI/180*37.5);class Kg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new pd,this.layoutVertexArray2=new Co,this.indexArray=new Qn,this.programConfigurations=new $(e.layers,e.zoom),this.segments=new Cn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,l){this.hasPattern=Hg("line",this.layers,i);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:M,id:A,index:C,sourceLayerIndex:R}of e){const k=this.layers[0]._featureFilter.needGeometry,O=qn(M,k);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),O,r))continue;const V=u?u.evaluate(O,{},r):void 0,j={id:A,properties:M.properties,type:M.type,sourceLayerIndex:R,index:C,geometry:k?O.geometry:tr(M,r,l),patterns:{},sortKey:V};p.push(j)}u&&p.sort((M,A)=>M.sortKey-A.sortKey);const{lineAtlas:g,featureIndex:v}=i,b=this.addConstantDashes(g);for(const M of p){const{geometry:A,index:C,sourceLayerIndex:R}=M;if(b&&this.addFeatureDashes(M,g),this.hasPattern){const k=Wg("line",this.layers,M,this.zoom,i);this.patternFeatures.push(k)}else this.addFeature(M,A,C,r,g.positions,i.availableImages,i.brightness);v.insert(e[C].feature,A,C,R,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const l=r.paint.get("line-dasharray").value,u=r.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")i=!0;else{const p=u.value,g=l.value;if(!g)continue;e.addDash(g,p)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let g,v;if(u.kind==="constant"){if(g=u.value,!g)continue}else g=u.evaluate({zoom:r},e);v=p.kind==="constant"?p.value:p.evaluate({zoom:r},e),i.addDash(g,v),e.patterns[l.id]=i.getKey(g,v)}}update(e,i,r,l,u){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,r,l,u)}addFeatures(e,i,r,l,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,r,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,CA)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,AA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,l,u,p,g){const v=this.layers[0].layout,b=v.get("line-join").evaluate(e,{}),M=v.get("line-cap").evaluate(e,{}),A=v.get("line-miter-limit"),C=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of i)this.addLine(R,e,b,M,A,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,l,g)}addLine(e,i,r,l,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let j=0;j<e.length-1;j++)this.totalDistance+=e[j].dist(e[j+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=PA[i.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let b=0;for(;b<v-1&&e[b].equals(e[b+1]);)b++;if(v<(g?3:2))return;r==="bevel"&&(u=1.05);const M=this.overscaling<=16?15*yt/(512*this.overscaling):0,A=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let C,R,k,O,V;this.e1=this.e2=-1,g&&(C=e[v-2],V=e[b].sub(C)._unit()._perp());for(let j=b;j<v;j++){if(k=j===v-1?g?e[b+1]:void 0:e[j+1],k&&e[j].equals(k))continue;V&&(O=V),C&&(R=C),C=e[j],V=k?k.sub(C)._unit()._perp():O,O=O||V;let K=O.add(V);K.x===0&&K.y===0||K._unit();const ee=O.x*V.x+O.y*V.y,Q=K.x*V.x+K.y*V.y,oe=Q!==0?1/Q:1/0,se=2*Math.sqrt(2-2*Q),he=Q<DA&&R&&k,me=O.x*V.y-O.y*V.x>0;if(he&&j>b){const ve=C.dist(R);if(ve>2*M){const ke=C.sub(C.sub(R)._mult(M/ve)._round());this.updateDistance(R,ke),this.addCurrentVertex(ke,O,0,0,A),R=ke}}const xe=R&&k;let Ee=xe?r:g?"butt":l;if(xe&&Ee==="round"&&(oe<p?Ee="miter":oe<=2&&(Ee="fakeround")),Ee==="miter"&&oe>u&&(Ee="bevel"),Ee==="bevel"&&(oe>2&&(Ee="flipbevel"),oe<u&&(Ee="miter")),R&&this.updateDistance(R,C),Ee==="miter")K._mult(oe),this.addCurrentVertex(C,K,0,0,A);else if(Ee==="flipbevel"){if(oe>100)K=V.mult(-1);else{const ve=oe*O.add(V).mag()/O.sub(V).mag();K._perp()._mult(ve*(me?-1:1))}this.addCurrentVertex(C,K,0,0,A),this.addCurrentVertex(C,K.mult(-1),0,0,A)}else if(Ee==="bevel"||Ee==="fakeround"){const ve=-Math.sqrt(oe*oe-1),ke=me?ve:0,Ge=me?0:ve;if(R&&this.addCurrentVertex(C,O,ke,Ge,A),Ee==="fakeround"){const Re=Math.round(180*se/Math.PI/20);for(let je=1;je<Re;je++){let Ce=je/Re;if(Ce!==.5){const ot=Ce-.5;Ce+=Ce*ot*(Ce-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*ot*ot+(.848013+ee*(.215638*ee-1.06021)))}const Ue=V.sub(O)._mult(Ce)._add(O)._unit()._mult(me?-1:1);this.addHalfVertex(C,Ue.x,Ue.y,!1,me,0,A)}}k&&this.addCurrentVertex(C,V,-ke,-Ge,A)}else if(Ee==="butt")this.addCurrentVertex(C,K,0,0,A);else if(Ee==="square"){const ve=R?1:-1;R||this.addCurrentVertex(C,K,ve,ve,A),this.addCurrentVertex(C,K,0,0,A),R&&this.addCurrentVertex(C,K,ve,ve,A)}else Ee==="round"&&(R&&(this.addCurrentVertex(C,O,0,0,A),this.addCurrentVertex(C,O,1,1,A,!0)),k&&(this.addCurrentVertex(C,V,-1,-1,A,!0),this.addCurrentVertex(C,V,0,0,A)));if(he&&j<v-1){const ve=C.dist(k);if(ve>2*M){const ke=C.add(k.sub(C)._mult(M/ve)._round());this.updateDistance(C,ke),this.addCurrentVertex(ke,V,0,0,A),C=ke}}}}addCurrentVertex(e,i,r,l,u,p=!1){const g=i.y*l-i.x,v=-i.y-i.x*l;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,p,!1,r,u),this.addHalfVertex(e,g,v,p,!0,-l,u)}addHalfVertex({x:e,y:i},r,l,u,p,g,v){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(i<<1)+(p?1:0),Math.round(63*r)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),v.primitiveLength++),p?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Mt(Kg,"LineBucket",{omit:["layers","patternFeatures"]});const LA=new wn({"line-cap":new Gt(Te.layout_line["line-cap"]),"line-join":new Gt(Te.layout_line["line-join"]),"line-miter-limit":new rt(Te.layout_line["line-miter-limit"]),"line-round-limit":new rt(Te.layout_line["line-round-limit"]),"line-sort-key":new Gt(Te.layout_line["line-sort-key"]),visibility:new rt(Te.layout_line.visibility)});var Tb={paint:new wn({"line-opacity":new Gt(Te.paint_line["line-opacity"]),"line-color":new Gt(Te.paint_line["line-color"]),"line-translate":new rt(Te.paint_line["line-translate"]),"line-translate-anchor":new rt(Te.paint_line["line-translate-anchor"]),"line-width":new Gt(Te.paint_line["line-width"]),"line-gap-width":new Gt(Te.paint_line["line-gap-width"]),"line-offset":new Gt(Te.paint_line["line-offset"]),"line-blur":new Gt(Te.paint_line["line-blur"]),"line-dasharray":new Gt(Te.paint_line["line-dasharray"]),"line-pattern":new Gt(Te.paint_line["line-pattern"]),"line-gradient":new sa(Te.paint_line["line-gradient"]),"line-trim-offset":new rt(Te.paint_line["line-trim-offset"]),"line-emissive-strength":new rt(Te.paint_line["line-emissive-strength"]),"line-border-width":new Gt(Te.paint_line["line-border-width"]),"line-border-color":new Gt(Te.paint_line["line-border-color"])}),layout:LA};function Mb(t,e,i){return e*(yt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function Sb(t,e){return 1/Mb(t,1,e.tileZoom)}function Eb(t,e,i,r){return t.translatePosMatrix(r||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Ab=t=>{const e=[];Ib(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function Ib(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const Cb=new class extends Gt{possiblyEvaluate(t,e){return e=new bn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=Qi({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(Tb.paint.properties["line-width"].specification);function Pb(t,e){return e>0?e+2*t:t}Cb.useIntegerZoom=!0;const RA=Hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),zA=Hi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),kA=Hi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const OA=Hi([{name:"a_z_offset",components:1,type:"Float32"}],4),FA=Hi([{name:"a_texb",components:2,type:"Uint16"}]),BA=Hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),NA=Hi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Db=Hi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),VA=Hi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Hi([{name:"triangle",components:3,type:"Uint16"}]),Hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Hi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Hi([{type:"Float32",name:"offsetX"}]),Hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var vr=24;const io=128;function Jg(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new bn(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:l}=i;let u=0;for(;u<r.length&&r[u]<=t;)u++;u=Math.max(0,u-1);let p=u;for(;p<r.length&&r[p]<t+1;)p++;p=Math.min(r.length-1,p);const g=r[u],v=r[p];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:g,maxZoom:v,minSize:i.evaluate(new bn(g)),maxSize:i.evaluate(new bn(v)),interpolationType:l}}}function am(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:l}){return t.kind==="source"?r/io:t.kind==="composite"?Mi(r/io,l/io,i):e}function Cu(t,e){let i=0,r=0;if(t.kind==="constant")r=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:p}=t,g=l?kt(Zr.interpolationFactor(l,e,u,p),0,1):0;t.kind==="camera"?r=Mi(t.minSize,t.maxSize,g):i=g}return{uSizeT:i,uSize:r}}var UA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:io,evaluateSizeForFeature:am,evaluateSizeForZoom:Cu,getSizeData:Jg});function jA(t,e,i){return t.sections.forEach(r=>{r.text=function(l,u,p){const g=u.layout.get("text-transform").evaluate(p,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),Xr.applyArabicShaping&&(l=Xr.applyArabicShaping(l)),l}(r.text,e,i)}),t}const Fd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function GA(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function $A(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}var qA={read:function(t,e,i,r,l){var u,p,g=8*l-r-1,v=(1<<g)-1,b=v>>1,M=-7,A=i?l-1:0,C=i?-1:1,R=t[e+A];for(A+=C,u=R&(1<<-M)-1,R>>=-M,M+=g;M>0;u=256*u+t[e+A],A+=C,M-=8);for(p=u&(1<<-M)-1,u>>=-M,M+=r;M>0;p=256*p+t[e+A],A+=C,M-=8);if(u===0)u=1-b;else{if(u===v)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,r),u-=b}return(R?-1:1)*p*Math.pow(2,u-r)},write:function(t,e,i,r,l,u){var p,g,v,b=8*u-l-1,M=(1<<b)-1,A=M>>1,C=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=r?0:u-1,k=r?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,p=M):(p=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-p))<1&&(p--,v*=2),(e+=p+A>=1?C/v:C*Math.pow(2,1-A))*v>=2&&(p++,v/=2),p+A>=M?(g=0,p=M):p+A>=1?(g=(e*v-1)*Math.pow(2,l),p+=A):(g=e*Math.pow(2,A-1)*Math.pow(2,l),p=0));l>=8;t[i+R]=255&g,R+=k,g/=256,l-=8);for(p=p<<l|g,b+=l;b>0;t[i+R]=255&p,R+=k,p/=256,b-=8);t[i+R-k]|=128*O}},Lb=xn,lm=qA;function xn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}xn.Varint=0,xn.Fixed64=1,xn.Bytes=2,xn.Fixed32=5;var Qg=4294967296,Rb=1/Qg,zb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fa(t){return t.type===xn.Bytes?t.readVarint()+t.pos:t.pos+1}function Pu(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function kb(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var l=i.pos-1;l>=t;l--)i.buf[l+r]=i.buf[l]}function HA(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function WA(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function ZA(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function XA(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function YA(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function KA(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function JA(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function QA(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function eI(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function cm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Du(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Ob(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}xn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),l=r>>3,u=this.pos;this.type=7&r,t(l,e,this),this.pos===u&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=cm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ob(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=cm(this.buf,this.pos)+cm(this.buf,this.pos+4)*Qg;return this.pos+=8,t},readSFixed64:function(){var t=cm(this.buf,this.pos)+Ob(this.buf,this.pos+4)*Qg;return this.pos+=8,t},readFloat:function(){var t=lm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=lm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(l,u,p){var g,v,b=p.buf;if(g=(112&(v=b[p.pos++]))>>4,v<128||(g|=(127&(v=b[p.pos++]))<<3,v<128)||(g|=(127&(v=b[p.pos++]))<<10,v<128)||(g|=(127&(v=b[p.pos++]))<<17,v<128)||(g|=(127&(v=b[p.pos++]))<<24,v<128)||(g|=(1&(v=b[p.pos++]))<<31,v<128))return Pu(l,g,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&zb?function(i,r,l){return zb.decode(i.subarray(r,l))}(this.buf,e,t):function(i,r,l){for(var u="",p=r;p<l;){var g,v,b,M=i[p],A=null,C=M>239?4:M>223?3:M>191?2:1;if(p+C>l)break;C===1?M<128&&(A=M):C===2?(192&(g=i[p+1]))==128&&(A=(31&M)<<6|63&g)<=127&&(A=null):C===3?(v=i[p+2],(192&(g=i[p+1]))==128&&(192&v)==128&&((A=(15&M)<<12|(63&g)<<6|63&v)<=2047||A>=55296&&A<=57343)&&(A=null)):C===4&&(v=i[p+2],b=i[p+3],(192&(g=i[p+1]))==128&&(192&v)==128&&(192&b)==128&&((A=(15&M)<<18|(63&g)<<12|(63&v)<<6|63&b)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,C=1):A>65535&&(A-=65536,u+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),u+=String.fromCharCode(A),p+=C}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==xn.Bytes)return t.push(this.readVarint(e));var i=fa(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==xn.Bytes)return t.push(this.readSVarint());var e=fa(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==xn.Bytes)return t.push(this.readBoolean());var e=fa(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==xn.Bytes)return t.push(this.readFloat());var e=fa(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==xn.Bytes)return t.push(this.readDouble());var e=fa(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==xn.Bytes)return t.push(this.readFixed32());var e=fa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==xn.Bytes)return t.push(this.readSFixed32());var e=fa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==xn.Bytes)return t.push(this.readFixed64());var e=fa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==xn.Bytes)return t.push(this.readSFixed64());var e=fa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===xn.Varint)for(;this.buf[this.pos++]>127;);else if(e===xn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===xn.Fixed32)this.pos+=4;else{if(e!==xn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Du(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Du(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Du(this.buf,-1&t,this.pos),Du(this.buf,Math.floor(t*Rb),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Du(this.buf,-1&t,this.pos),Du(this.buf,Math.floor(t*Rb),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,l;if(e>=0?(r=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(u,p,g){g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,g.buf[g.pos]=127&(u>>>=7)}(r,0,i),function(u,p){var g=(7&u)<<4;p.buf[p.pos++]|=g|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(l,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,l,u){for(var p,g,v=0;v<l.length;v++){if((p=l.charCodeAt(v))>55295&&p<57344){if(!g){p>56319||v+1===l.length?(r[u++]=239,r[u++]=191,r[u++]=189):g=p;continue}if(p<56320){r[u++]=239,r[u++]=191,r[u++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(r[u++]=239,r[u++]=191,r[u++]=189,g=null);p<128?r[u++]=p:(p<2048?r[u++]=p>>6|192:(p<65536?r[u++]=p>>12|224:(r[u++]=p>>18|240,r[u++]=p>>12&63|128),r[u++]=p>>6&63|128),r[u++]=63&p|128)}return u}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&kb(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),lm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),lm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&kb(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,xn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,HA,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,WA,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,YA,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ZA,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,XA,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,KA,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,JA,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,QA,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,eI,e)},writeBytesField:function(t,e){this.writeTag(t,xn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,xn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,xn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,xn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,xn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,xn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,xn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,xn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,xn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,xn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Lu=gt(Lb);const ey=3;function tI(t,e,i){e.glyphs=[],t===1&&i.readMessage(iI,e)}function iI(t,e,i){if(t===3){const{id:r,bitmap:l,width:u,height:p,left:g,top:v,advance:b}=i.readMessage(nI,{});e.glyphs.push({id:r,bitmap:new Ya({width:u+2*ey,height:p+2*ey},l),metrics:{width:u,height:p,left:g,top:v,advance:b}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function nI(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const Fb=ey,Ps={horizontal:1,vertical:2,horizontalOnly:3};class Bd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new Bd;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new Bd;return i.imageName=e,i}}class Ru{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new Ru;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?r.addImageSection(u):r.addTextSection(u,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,r){let l="";for(let u=0;u<i.length;u++){const p=i.charCodeAt(u+1)||null,g=i.charCodeAt(u-1)||null;l+=!r&&(p&&_p(p)&&!Fd[i[u+1]]||g&&_p(g)&&!Fd[i[u-1]])||!Fd[i[u]]?i[u]:Fd[i[u]]}return l}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&um[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&um[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new Ru;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Bd.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void be("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(Bd.forImage(i)),this.sectionIndex.push(this.sections.length-1)):be("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ty(t,e,i,r,l,u,p,g,v,b,M,A,C,R,k){const O=Ru.fromFeature(t,l);A===Ps.vertical&&O.verticalizePunctuation(C);let V=[];const j=function(se,he,me,xe,Ee,ve){if(!se)return[];const ke=[],Ge=function(Ue,ot,qe,It,bt,Ye){let Xt=0;for(let Ft=0;Ft<Ue.length();Ft++){const At=Ue.getSection(Ft);Xt+=Bb(Ue.getCodePoint(Ft),At,It,bt,ot,Ye)}return Xt/Math.max(1,Math.ceil(Xt/qe))}(se,he,me,xe,Ee,ve),Re=se.text.indexOf("")>=0;let je=0;for(let Ue=0;Ue<se.length();Ue++){const ot=se.getSection(Ue),qe=se.getCodePoint(Ue);if(um[qe]||(je+=Bb(qe,ot,xe,Ee,he,ve)),Ue<se.length()-1){const It=!((Ce=qe)<11904||!(Dt["Bopomofo Extended"](Ce)||Dt.Bopomofo(Ce)||Dt["CJK Compatibility Forms"](Ce)||Dt["CJK Compatibility Ideographs"](Ce)||Dt["CJK Compatibility"](Ce)||Dt["CJK Radicals Supplement"](Ce)||Dt["CJK Strokes"](Ce)||Dt["CJK Symbols and Punctuation"](Ce)||Dt["CJK Unified Ideographs Extension A"](Ce)||Dt["CJK Unified Ideographs"](Ce)||Dt["Enclosed CJK Letters and Months"](Ce)||Dt["Halfwidth and Fullwidth Forms"](Ce)||Dt.Hiragana(Ce)||Dt["Ideographic Description Characters"](Ce)||Dt["Kangxi Radicals"](Ce)||Dt["Katakana Phonetic Extensions"](Ce)||Dt.Katakana(Ce)||Dt["Vertical Forms"](Ce)||Dt["Yi Radicals"](Ce)||Dt["Yi Syllables"](Ce)));(rI[qe]||It||ot.imageName)&&ke.push(Vb(Ue+1,je,Ge,ke,sI(qe,se.getCodePoint(Ue+1),It&&Re),!1))}}var Ce;return Ub(Vb(se.length(),je,Ge,ke,0,!0))}(O,b,u,e,r,R),{processBidirectionalText:K,processStyledBidirectionalText:ee}=Xr;if(K&&O.sections.length===1){const se=K(O.toString(),j);for(const he of se){const me=new Ru;me.text=he,me.sections=O.sections;for(let xe=0;xe<he.length;xe++)me.sectionIndex.push(0);V.push(me)}}else if(ee){const se=ee(O.text,O.sectionIndex,j);for(const he of se){const me=new Ru;me.text=he[0],me.sectionIndex=he[1],me.sections=O.sections,V.push(me)}}else V=function(se,he){const me=[],xe=se.text;let Ee=0;for(const ve of he)me.push(se.substring(Ee,ve)),Ee=ve;return Ee<xe.length&&me.push(se.substring(Ee,xe.length)),me}(O,j);const Q=[],oe={positionedLines:Q,text:O.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,he,me,xe,Ee,ve,ke,Ge,Re,je,Ce,Ue){let ot=0,qe=0,It=0;const bt=Ge==="right"?1:Ge==="left"?0:.5;let Ye=!1;for(const fi of Ee){const Yt=fi.getSections();for(const pi of Yt){if(pi.imageName)continue;const ti=he[pi.fontStack];if(ti&&(Ye=ti.ascender!==void 0&&ti.descender!==void 0,!Ye))break}if(!Ye)break}let Xt=0;for(const fi of Ee){fi.trim();const Yt=fi.getMaxScale(),pi=(Yt-1)*vr,ti={positionedGlyphs:[],lineOffset:0};se.positionedLines[Xt]=ti;const Si=ti.positionedGlyphs;let si=0;if(!fi.length()){qe+=ve,++Xt;continue}let nn=0,ki=0;for(let $i=0;$i<fi.length();$i++){const Oi=fi.getSection($i),vn=fi.getSectionIndex($i),Xi=fi.getCodePoint($i);let Pn=Oi.scale,Xn=null,gr=null,gn=null,Sn=vr,ar=0;const lr=!(Re===Ps.horizontal||!Ce&&!Jh(Xi)||Ce&&(um[Xi]||(Ft=Xi,Dt.Arabic(Ft)||Dt["Arabic Supplement"](Ft)||Dt["Arabic Extended-A"](Ft)||Dt["Arabic Presentation Forms-A"](Ft)||Dt["Arabic Presentation Forms-B"](Ft))));if(Oi.imageName){const cr=xe[Oi.imageName];if(!cr)continue;gn=Oi.imageName,se.iconsInText=se.iconsInText||!0,gr=cr.paddedRect;const cn=cr.displaySize;Pn=Pn*vr/Ue,Xn={width:cn[0],height:cn[1],left:0,top:-Fb,advance:lr?cn[1]:cn[0],localGlyph:!1},ar=Ye?-Xn.height*Pn:Yt*vr-17-cn[1]*Pn,Sn=Xn.advance;const ls=(lr?cn[0]:cn[1])*Pn-vr*Yt;ls>0&&ls>si&&(si=ls)}else{const cr=me[Oi.fontStack];if(!cr)continue;cr[Xi]&&(gr=cr[Xi]);const cn=he[Oi.fontStack];if(!cn)continue;const ls=cn.glyphs[Xi];if(!ls)continue;if(Xn=ls.metrics,Sn=Xi!==8203?vr:0,Ye){const sl=cn.ascender!==void 0?Math.abs(cn.ascender):0,Gr=cn.descender!==void 0?Math.abs(cn.descender):0,cs=(sl+Gr)*Pn;nn<cs&&(nn=cs,ki=(sl-Gr)/2*Pn),ar=-sl*Pn}else ar=(Yt-Pn)*vr-17}lr?(se.verticalizable=!0,Si.push({glyph:Xi,imageName:gn,x:ot,y:qe+ar,vertical:lr,scale:Pn,localGlyph:Xn.localGlyph,fontStack:Oi.fontStack,sectionIndex:vn,metrics:Xn,rect:gr}),ot+=Sn*Pn+je):(Si.push({glyph:Xi,imageName:gn,x:ot,y:qe+ar,vertical:lr,scale:Pn,localGlyph:Xn.localGlyph,fontStack:Oi.fontStack,sectionIndex:vn,metrics:Xn,rect:gr}),ot+=Xn.advance*Pn+je)}Si.length!==0&&(It=Math.max(ot-je,It),Ye?jb(Si,bt,si,ki,ve*Yt/2):jb(Si,bt,si,0,ve/2)),ot=0;const Fi=ve*Yt+si;ti.lineOffset=Math.max(si,pi),qe+=Fi,++Xt}var Ft;const At=qe,{horizontalAlign:Ke,verticalAlign:$t}=iy(ke);(function(fi,Yt,pi,ti,Si,si){const nn=(Yt-pi)*Si,ki=-si*ti;for(const Fi of fi)for(const $i of Fi.positionedGlyphs)$i.x+=nn,$i.y+=ki})(se.positionedLines,bt,Ke,$t,It,At),se.top+=-$t*At,se.bottom=se.top+At,se.left+=-Ke*It,se.right=se.left+It,se.hasBaseline=Ye}(oe,e,i,r,V,p,g,v,A,b,C,k),!function(se){for(const he of se)if(he.positionedGlyphs.length!==0)return!1;return!0}(Q)&&oe}const um={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Bb(t,e,i,r,l,u){if(e.imageName){const p=r[e.imageName];return p?p.displaySize[0]*e.scale*vr/u+l:0}{const p=i[e.fontStack],g=p&&p.glyphs[t];return g?g.metrics.advance*e.scale+l:0}}function Nb(t,e,i,r){const l=Math.pow(t-e,2);return r?t<e?l/2:2*l:l+Math.abs(i)*i}function sI(t,e,i){let r=0;return t===10&&(r-=1e4),i&&(r+=150),t!==40&&t!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function Vb(t,e,i,r,l,u){let p=null,g=Nb(e,i,l,u);for(const v of r){const b=Nb(e-v.x,i,l,u)+v.badness;b<=g&&(p=v,g=b)}return{index:t,x:e,priorBreak:p,badness:g}}function Ub(t){return t?Ub(t.priorBreak).concat(t.index):[]}function iy(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function jb(t,e,i,r,l){if(!(e||i||r||l))return;const u=t.length-1,p=t[u],g=(p.x+p.metrics.advance*p.scale)*e;for(let v=0;v<=u;v++)t[v].x-=g,t[v].y+=i+r+l}function oI(t,e,i,r){const{horizontalAlign:l,verticalAlign:u}=iy(r),p=i[0]-t.displaySize[0]*l,g=i[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:g,bottom:g+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function Gb(t,e,i,r,l,u){const p=t.imagePrimary;let g;if(p.content){const V=p.content,j=p.pixelRatio||1;g=[V[0]/j,V[1]/j,p.displaySize[0]-V[2]/j,p.displaySize[1]-V[3]/j]}const v=e.left*u,b=e.right*u;let M,A,C,R;i==="width"||i==="both"?(R=l[0]+v-r[3],A=l[0]+b+r[1]):(R=l[0]+(v+b-p.displaySize[0])/2,A=R+p.displaySize[0]);const k=e.top*u,O=e.bottom*u;return i==="height"||i==="both"?(M=l[1]+k-r[0],C=l[1]+O+r[2]):(M=l[1]+(k+O-p.displaySize[1])/2,C=M+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:M,right:A,bottom:C,left:R,collisionPadding:g}}class pa extends $e{constructor(e,i,r,l,u){super(e,i),this.angle=l,this.z=r,u!==void 0&&(this.segment=u)}clone(){return new pa(this.x,this.y,this.z,this.angle,this.segment)}}function $b(t,e,i,r,l){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,g=0;for(;g>-i/2;){if(p--,p<0)return!1;g-=t[p].dist(u),u=t[p]}g+=t[p].dist(t[p+1]),p++;const v=[];let b=0;for(;g<i/2;){const M=t[p],A=t[p+1];if(!A)return!1;let C=t[p-1].angleTo(M)-M.angleTo(A);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:C}),b+=C;g-v[0].distance>r;)b-=v.shift().angleDelta;if(b>l)return!1;p++,g+=M.dist(A)}return!0}function qb(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Hb(t,e,i){return t?.6*e*i:0}function Wb(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function aI(t,e,i,r,l,u){const p=Hb(i,l,u),g=Wb(i,r)*u;let v=0;const b=qb(t)/2;for(let M=0;M<t.length-1;M++){const A=t[M],C=t[M+1],R=A.dist(C);if(v+R>b){const k=(b-v)/R,O=Mi(A.x,C.x,k),V=Mi(A.y,C.y,k),j=new pa(O,V,0,C.angleTo(A),M);return!p||$b(t,j,g,p,e)?j:void 0}v+=R}}function lI(t,e,i,r,l,u,p,g,v){const b=Hb(r,u,p),M=Wb(r,l),A=M*p,C=t[0].x===0||t[0].x===v||t[0].y===0||t[0].y===v;return e-A<e/4&&(e=A+e/4),Zb(t,C?e/2*g%e:(M/2+2*u)*p*g%e,e,b,i,A,C,!1,v)}function Zb(t,e,i,r,l,u,p,g,v){const b=u/2,M=qb(t);let A=0,C=e-i,R=[];for(let k=0;k<t.length-1;k++){const O=t[k],V=t[k+1],j=O.dist(V),K=V.angleTo(O);for(;C+i<A+j;){C+=i;const ee=(C-A)/j,Q=Mi(O.x,V.x,ee),oe=Mi(O.y,V.y,ee);if(Q>=0&&Q<v&&oe>=0&&oe<v&&C-b>=0&&C+b<=M){const se=new pa(Q,oe,0,K,k);r&&!$b(t,se,u,r,l)||R.push(se)}}A+=j}return g||R.length||p||(R=Zb(t,A/2,i,r,l,u,p,!0,v)),R}function Xb(t,e,i,r,l){const u=[];for(let p=0;p<t.length;p++){const g=t[p];let v;for(let b=0;b<g.length-1;b++){let M=g[b],A=g[b+1];M.x<e&&A.x<e||(M.x<e?M=new $e(e,M.y+(e-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x<e&&(A=new $e(e,M.y+(e-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y<i&&A.y<i||(M.y<i?M=new $e(M.x+(i-M.y)/(A.y-M.y)*(A.x-M.x),i)._round():A.y<i&&(A=new $e(M.x+(i-M.y)/(A.y-M.y)*(A.x-M.x),i)._round()),M.x>=r&&A.x>=r||(M.x>=r?M=new $e(r,M.y+(r-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x>=r&&(A=new $e(r,M.y+(r-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y>=l&&A.y>=l||(M.y>=l?M=new $e(M.x+(l-M.y)/(A.y-M.y)*(A.x-M.x),l)._round():A.y>=l&&(A=new $e(M.x+(l-M.y)/(A.y-M.y)*(A.x-M.x),l)._round()),v&&M.equals(v[v.length-1])||(v=[M],u.push(v)),v.push(A)))))}}return u}function Yb(t){let e=0,i=0;for(const p of t)e+=p.w*p.h,i=Math.max(i,p.w);t.sort((p,g)=>g.h-p.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let l=0,u=0;for(const p of t)for(let g=r.length-1;g>=0;g--){const v=r[g];if(!(p.w>v.w||p.h>v.h)){if(p.x=v.x,p.y=v.y,u=Math.max(u,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===v.w&&p.h===v.h){const b=r.pop();g<r.length&&(r[g]=b)}else p.h===v.h?(v.x+=p.w,v.w-=p.w):p.w===v.w?(v.y+=p.h,v.h-=p.h):(r.push({x:v.x+p.w,y:v.y,w:v.w-p.w,h:p.h}),v.y+=p.h,v.h-=p.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}Mt(pa,"Anchor");const as=1;class ny{constructor(e,{pixelRatio:i,version:r,stretchX:l,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=l,this.stretchY=u,this.content=p,this.version=r}get tl(){return[this.paddedRect.x+as,this.paddedRect.y+as]}get br(){return[this.paddedRect.x+this.paddedRect.w-as,this.paddedRect.y+this.paddedRect.h-as]}get displaySize(){return[(this.paddedRect.w-2*as)/this.pixelRatio,(this.paddedRect.h-2*as)/this.pixelRatio]}}class Kb{constructor(e,i){const r={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,r,u),this.addImages(i,l,u);const{w:p,h:g}=Yb(u),v=new Cs({width:p||1,height:g||1});for(const b in e){const M=e[b],A=r[b].paddedRect;Cs.copy(M.data,v,{x:0,y:0},{x:A.x+as,y:A.y+as},M.data,M.sdf)}for(const b in i){const M=i[b],A=l[b].paddedRect,C=A.x+as,R=A.y+as,k=M.data.width,O=M.data.height;Cs.copy(M.data,v,{x:0,y:0},{x:C,y:R},M.data),Cs.copy(M.data,v,{x:0,y:O-1},{x:C,y:R-1},{width:k,height:1}),Cs.copy(M.data,v,{x:0,y:0},{x:C,y:R+O},{width:k,height:1}),Cs.copy(M.data,v,{x:k-1,y:0},{x:C-1,y:R},{width:1,height:O}),Cs.copy(M.data,v,{x:0,y:0},{x:C+k,y:R},{width:1,height:O})}this.image=v,this.iconPositions=r,this.patternPositions=l}addImages(e,i,r){for(const l in e){const u=e[l],p={x:0,y:0,w:u.data.width+2*as,h:u.data.height+2*as};r.push(p),i[l]=new ny(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,i,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const l in e.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[l],e.getImage(l,r),i),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l,r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[l,u]=e.tl,p=!!Object.keys(this.patternPositions).length;r.update(i.data,{useMipmap:p},{x:l,y:u})}}Mt(ny,"ImagePosition"),Mt(Kb,"ImageAtlas");const Nd=1e20;function Jb(t,e,i,r,l,u,p,g,v){for(let b=e;b<e+r;b++)Qb(t,i*u+b,u,l,p,g,v);for(let b=i;b<i+l;b++)Qb(t,b*u+e,1,r,p,g,v)}function Qb(t,e,i,r,l,u,p){u[0]=0,p[0]=-Nd,p[1]=Nd,l[0]=t[e];for(let g=1,v=0,b=0;g<r;g++){l[g]=t[e+g*i];const M=g*g;do{const A=u[v];b=(l[g]-l[A]+M-A*A)/(g-A)/2}while(b<=p[v]&&--v>-1);v++,u[v]=g,p[v]=b,p[v+1]=Nd}for(let g=0,v=0;g<r;g++){for(;p[v+1]<g;)v++;const b=u[v],M=g-b;t[e+g*i]=l[b]+M*M}}const no=2,ry={none:0,ideographs:1,all:2};class zu{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,r){const l=[],u=this.urls[i]||Z.GLYPHS_URL;for(const p in e)for(const g of e[p])l.push({stack:p,id:g});Rn(l,({stack:p,id:g},v)=>{let b=this.entries[p];b||(b=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=b.glyphs[g];if(M!==void 0)return void v(null,{stack:p,id:g,glyph:M});if(M=this._tinySDF(b,p,g),M)return b.glyphs[g]=M,void v(null,{stack:p,id:g,glyph:M});const A=Math.floor(g/256);if(256*A>65535)return void v(new Error("glyphs > 65535 not supported"));if(b.ranges[A])return void v(null,{stack:p,id:g,glyph:M});let C=b.requests[A];C||(C=b.requests[A]=[],zu.loadGlyphRange(p,A,u,this.requestManager,(R,k)=>{if(k){b.ascender=k.ascender,b.descender=k.descender;for(const O in k.glyphs)this._doesCharSupportLocalGlyph(+O)||(b.glyphs[+O]=k.glyphs[+O]);b.ranges[A]=!0}for(const O of C)O(R,k);delete b.requests[A]})),C.push((R,k)=>{R?v(R):k&&v(null,{stack:p,id:g,glyph:k.glyphs[g]||null})})},(p,g)=>{if(p)r(p);else if(g){const v={};for(const{stack:b,id:M,glyph:A}of g)v[b]===void 0&&(v[b]={}),v[b].glyphs===void 0&&(v[b].glyphs={}),v[b].glyphs[M]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;r(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ry.none&&(this.localGlyphMode===ry.all?!!this.localFontFamily:!!this.localFontFamily&&(Dt["CJK Unified Ideographs"](e)||Dt["Hangul Syllables"](e)||Dt.Hiragana(e)||Dt.Katakana(e)||Dt["CJK Symbols and Punctuation"](e)||Dt["CJK Unified Ideographs Extension A"](e)||Dt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,r){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(r))return;let u=e.tinySDF;if(!u){let O="400";/bold/i.test(i)?O="900":/medium/i.test(i)?O="500":/light/i.test(i)&&(O="200"),u=e.tinySDF=new zu.TinySDF({fontFamily:l,fontWeight:O,fontSize:24*no,buffer:3*no,radius:8*no}),u.fontWeight=O}if(this.localGlyphs[u.fontWeight][r])return this.localGlyphs[u.fontWeight][r];const p=String.fromCodePoint(r),{data:g,width:v,height:b,glyphWidth:M,glyphHeight:A,glyphLeft:C,glyphTop:R,glyphAdvance:k}=u.draw(p);return this.localGlyphs[u.fontWeight][r]={id:r,bitmap:new Ya({width:v,height:b},g),metrics:{width:M/no,height:A/no,left:C/no,top:R/no-27,advance:k/no,localGlyph:!0}}}}zu.loadGlyphRange=function(t,e,i,r,l){const u=256*e,p=u+255,g=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${u}-${p}`),kr.Glyphs);Ve(g,(v,b)=>{if(v)l(v);else if(b){const M={},A=function(C){return new Lu(C).readFields(tI,{})}(b);for(const C of A.glyphs)M[C.id]=C;l(null,{glyphs:M,ascender:A.ascender,descender:A.descender})}})},zu.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const g=this.size=t+4*e,v=this._createCanvas(g),b=this.ctx=v.getContext("2d",{willReadFrequently:!0});b.font=`${p} ${u} ${t}px ${l}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(t),p=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-l))),v=Math.min(this.size-this.buffer,p+Math.ceil(r)),b=g+2*this.buffer,M=v+2*this.buffer,A=Math.max(b*M,0),C=new Uint8ClampedArray(A),R={data:C,width:b,height:M,glyphWidth:g,glyphHeight:v,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(g===0||v===0)return R;const{ctx:k,buffer:O,gridInner:V,gridOuter:j}=this;k.clearRect(O,O,g,v),k.fillText(t,O,O+p);const K=k.getImageData(O,O,g,v);j.fill(Nd,0,A),V.fill(0,0,A);for(let ee=0;ee<v;ee++)for(let Q=0;Q<g;Q++){const oe=K.data[4*(ee*g+Q)+3]/255;if(oe===0)continue;const se=(ee+O)*b+Q+O;if(oe===1)j[se]=0,V[se]=Nd;else{const he=.5-oe;j[se]=he>0?he*he:0,V[se]=he<0?he*he:0}}Jb(j,0,0,b,M,b,this.f,this.v,this.z),Jb(V,O,O,g,v,b,this.f,this.v,this.z);for(let ee=0;ee<A;ee++){const Q=Math.sqrt(j[ee])-Math.sqrt(V[ee]);C[ee]=Math.round(255-255*(Q/this.radius+this.cutoff))}return R}};const Qa=as;function e1(t,e,i,r){const l=[],u=t.imagePrimary,p=u.pixelRatio,g=u.paddedRect.w-2*Qa,v=u.paddedRect.h-2*Qa,b=t.right-t.left,M=t.bottom-t.top,A=u.stretchX||[[0,g]],C=u.stretchY||[[0,v]],R=(ve,ke)=>ve+ke[1]-ke[0],k=A.reduce(R,0),O=C.reduce(R,0),V=g-k,j=v-O;let K=0,ee=k,Q=0,oe=O,se=0,he=V,me=0,xe=j;if(u.content&&r){const ve=u.content;K=hm(A,0,ve[0]),Q=hm(C,0,ve[1]),ee=hm(A,ve[0],ve[2]),oe=hm(C,ve[1],ve[3]),se=ve[0]-K,me=ve[1]-Q,he=ve[2]-ve[0]-ee,xe=ve[3]-ve[1]-oe}const Ee=(ve,ke,Ge,Re)=>{const je=dm(ve.stretch-K,ee,b,t.left),Ce=fm(ve.fixed-se,he,ve.stretch,k),Ue=dm(ke.stretch-Q,oe,M,t.top),ot=fm(ke.fixed-me,xe,ke.stretch,O),qe=dm(Ge.stretch-K,ee,b,t.left),It=fm(Ge.fixed-se,he,Ge.stretch,k),bt=dm(Re.stretch-Q,oe,M,t.top),Ye=fm(Re.fixed-me,xe,Re.stretch,O),Xt=new $e(je,Ue),Ft=new $e(qe,Ue),At=new $e(qe,bt),Ke=new $e(je,bt),$t=new $e(Ce/p,ot/p),fi=new $e(It/p,Ye/p),Yt=e*Math.PI/180;if(Yt){const ki=Math.sin(Yt),Fi=Math.cos(Yt),$i=[Fi,-ki,ki,Fi];Xt._matMult($i),Ft._matMult($i),Ke._matMult($i),At._matMult($i)}const pi=ve.stretch+ve.fixed,ti=Ge.stretch+Ge.fixed,Si=ke.stretch+ke.fixed,si=Re.stretch+Re.fixed,nn=t.imageSecondary;return{tl:Xt,tr:Ft,bl:Ke,br:At,texPrimary:{x:u.paddedRect.x+Qa+pi,y:u.paddedRect.y+Qa+Si,w:ti-pi,h:si-Si},texSecondary:nn?{x:nn.paddedRect.x+Qa+pi,y:nn.paddedRect.y+Qa+Si,w:ti-pi,h:si-Si}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$t,pixelOffsetBR:fi,minFontScaleX:he/p/b,minFontScaleY:xe/p/M,isSDF:i}};if(r&&(u.stretchX||u.stretchY)){const ve=t1(A,V,k),ke=t1(C,j,O);for(let Ge=0;Ge<ve.length-1;Ge++){const Re=ve[Ge],je=ve[Ge+1];for(let Ce=0;Ce<ke.length-1;Ce++)l.push(Ee(Re,ke[Ce],je,ke[Ce+1]))}}else l.push(Ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:v+1}));return l}function hm(t,e,i){let r=0;for(const l of t)r+=Math.max(e,Math.min(i,l[1]))-Math.max(e,Math.min(i,l[0]));return r}function t1(t,e,i){const r=[{fixed:-Qa,stretch:0}];for(const[l,u]of t){const p=r[r.length-1];r.push({fixed:l-p.stretch,stretch:p.stretch}),r.push({fixed:l-p.stretch,stretch:p.stretch+(u-l)})}return r.push({fixed:e+Qa,stretch:i}),r}function dm(t,e,i,r){return t/e*i+r}function fm(t,e,i,r){return t-e*i/r}function cI(t,e,i,r){const l=e+t.positionedLines[r].lineOffset;return r===0?i+l/2:i+(l+(e+t.positionedLines[r-1].lineOffset))/2}function uI(t,e=1,i=!1){let r=1/0,l=1/0,u=-1/0,p=-1/0;const g=t[0];for(let R=0;R<g.length;R++){const k=g[R];(!R||k.x<r)&&(r=k.x),(!R||k.y<l)&&(l=k.y),(!R||k.x>u)&&(u=k.x),(!R||k.y>p)&&(p=k.y)}const v=Math.min(u-r,p-l);let b=v/2;const M=new os([],hI);if(v===0)return new $e(r,l);for(let R=r;R<u;R+=v)for(let k=l;k<p;k+=v)M.push(new ku(R+b,k+b,b,t));let A=function(R){let k=0,O=0,V=0;const j=R[0];for(let K=0,ee=j.length,Q=ee-1;K<ee;Q=K++){const oe=j[K],se=j[Q],he=oe.x*se.y-se.x*oe.y;O+=(oe.x+se.x)*he,V+=(oe.y+se.y)*he,k+=3*he}return new ku(O/k,V/k,0,R)}(t),C=M.length;for(;M.length;){const R=M.pop();(R.d>A.d||!A.d)&&(A=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,C)),R.max-A.d<=e||(b=R.h/2,M.push(new ku(R.p.x-b,R.p.y-b,b,t)),M.push(new ku(R.p.x+b,R.p.y-b,b,t)),M.push(new ku(R.p.x-b,R.p.y+b,b,t)),M.push(new ku(R.p.x+b,R.p.y+b,b,t)),C+=4)}return i&&(console.log(`num probes: ${C}`),console.log(`best distance: ${A.d}`)),A.p}function hI(t,e){return e.max-t.max}class ku{constructor(e,i,r,l){this.p=new $e(e,i),this.h=r,this.d=function(u,p){let g=!1,v=1/0;for(let b=0;b<p.length;b++){const M=p[b];for(let A=0,C=M.length,R=C-1;A<C;R=A++){const k=M[A],O=M[R];k.y>u.y!=O.y>u.y&&u.x<(O.x-k.x)*(u.y-k.y)/(O.y-k.y)+k.x&&(g=!g),v=Math.min(v,Wa(u,k,O))}}return(g?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const sy=Number.POSITIVE_INFINITY,dI=Math.sqrt(2);function i1(t,[e,i]){let r=0,l=0;if(i===sy){e<0&&(e=0);const u=e/dI;switch(t){case"top-right":case"top-left":l=u-7;break;case"bottom-right":case"bottom-left":l=7-u;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(t){case"top-right":case"bottom-right":r=-u;break;case"top-left":case"bottom-left":r=u;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":l=i-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-i}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,l]}function oy(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fI(t,e,i,r,l,u,p,g,v,b,M,A,C,R,k){let O=u.textMaxSize.evaluate(e,{},A);O===void 0&&(O=p);const V=t.layers[0].layout,j=V.get("icon-offset").evaluate(e,{},A),K=r1(i.horizontal)||i.vertical,ee=C.name==="globe",Q=vr,oe=p/Q,se=t.tilePixelRatio*O/Q,he=(je=t.overscaling,t.zoom>18&&je>2&&(je>>=1),Math.max(yt/(512*je),1)*V.get("symbol-spacing")),me=V.get("text-padding")*t.tilePixelRatio,xe=V.get("icon-padding")*t.tilePixelRatio,Ee=Zt(V.get("text-max-angle")),ve=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",ke=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Ge=V.get("symbol-placement"),Re=he/2;var je;const Ce=V.get("icon-text-fit").evaluate(e,{},A),Ue=V.get("icon-text-fit-padding").evaluate(e,{},A),ot=Ce!=="none";let qe;t.hasAnyIconTextFit===!1&&ot&&(t.hasAnyIconTextFit=!0),r&&ot&&(t.allowVerticalPlacement&&i.vertical&&(qe=Gb(r,i.vertical,Ce,Ue,j,oe)),K&&(r=Gb(r,K,Ce,Ue,j,oe)));const It=(bt,Ye,Xt)=>{if(Ye.x<0||Ye.x>=yt||Ye.y<0||Ye.y>=yt)return;let Ft=null;if(ee){const{x:At,y:Ke,z:$t}=C.projectTilePoint(Ye.x,Ye.y,Xt);Ft={anchor:new pa(At,Ke,$t,0,void 0),up:C.upVector(Xt,Ye.x,Ye.y)}}(function(At,Ke,$t,fi,Yt,pi,ti,Si,si,nn,ki,Fi,$i,Oi,vn,Xi,Pn,Xn,gr,gn,Sn,ar,lr,cr,cn,ls,sl){const Gr=At.addToLineVertexArray(Ke,fi);let cs,Ls,nf,zm,sw,ow,aw,lw=0,cw=0,uw=0,hw=0,Cy=-1,Py=-1;const Fo={};let dw=Sd("");const yc=$t?$t.anchor:Ke,Dy=si.layout.get("icon-text-fit").evaluate(Sn,{},cn)!=="none";let Ly=0,Ry=0;if(si._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ly,Ry]=si.layout.get("text-offset").evaluate(Sn,{},cn).map(us=>us*vr):(Ly=si.layout.get("text-radial-offset").evaluate(Sn,{},cn)*vr,Ry=sy),At.allowVerticalPlacement&&Yt.vertical){const us=Yt.vertical;if(vn)ow=ay(us),Si&&(aw=ay(Si));else{const hs=si.layout.get("text-rotate").evaluate(Sn,{},cn)+90;nf=pm(nn,yc,Ke,ki,Fi,$i,us,Oi,hs,Xi),Si&&(zm=pm(nn,yc,Ke,ki,Fi,$i,Si,Xn,hs))}}if(pi){const us=si.layout.get("icon-rotate").evaluate(Sn,{},cn),hs=e1(pi,us,lr,Dy),ju=Si?e1(Si,us,lr,Dy):void 0;Ls=pm(nn,yc,Ke,ki,Fi,$i,pi,Xn,us),lw=4*hs.length;const fw=At.iconSizeData;let xc=null;fw.kind==="source"?(xc=[io*si.layout.get("icon-size").evaluate(Sn,{},cn)],xc[0]>el&&be(`${At.layerIds[0]}: Value for "icon-size" is >= ${Vd}. Reduce your "icon-size".`)):fw.kind==="composite"&&(xc=[io*ar.compositeIconSizes[0].evaluate(Sn,{},cn),io*ar.compositeIconSizes[1].evaluate(Sn,{},cn)],(xc[0]>el||xc[1]>el)&&be(`${At.layerIds[0]}: Value for "icon-size" is >= ${Vd}. Reduce your "icon-size".`)),At.addSymbols(At.icon,hs,xc,gn,gr,Sn,!1,$t,Ke,Gr.lineStartIndex,Gr.lineLength,-1,cr,cn,ls,sl),Cy=At.icon.placedSymbolArray.length-1,ju&&(cw=4*ju.length,At.addSymbols(At.icon,ju,xc,gn,gr,Sn,Ps.vertical,$t,Ke,Gr.lineStartIndex,Gr.lineLength,-1,cr,cn,ls,sl),Py=At.icon.placedSymbolArray.length-1)}for(const us in Yt.horizontal){const hs=Yt.horizontal[us];cs||(dw=Sd(hs.text),vn?sw=ay(hs):cs=pm(nn,yc,Ke,ki,Fi,$i,hs,Oi,si.layout.get("text-rotate").evaluate(Sn,{},cn),Xi));const ju=hs.positionedLines.length===1;if(uw+=n1(At,$t,Ke,hs,ti,si,vn,Sn,Xi,Gr,Yt.vertical?Ps.horizontal:Ps.horizontalOnly,ju?Object.keys(Yt.horizontal):[us],Fo,Cy,ar,cr,cn,ls),ju)break}Yt.vertical&&(hw+=n1(At,$t,Ke,Yt.vertical,ti,si,vn,Sn,Xi,Gr,Ps.vertical,["vertical"],Fo,Py,ar,cr,cn,ls));let ol=-1;const zy=(us,hs)=>us?Math.max(us,hs):hs;ol=zy(sw,ol),ol=zy(ow,ol),ol=zy(aw,ol);const DC=ol>-1?1:0;At.glyphOffsetArray.length>=65535&&be("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sn.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,Sn.sortKey),At.symbolInstances.emplaceBack(Ke.x,Ke.y,yc.x,yc.y,yc.z,Fo.right>=0?Fo.right:-1,Fo.center>=0?Fo.center:-1,Fo.left>=0?Fo.left:-1,Fo.vertical>=0?Fo.vertical:-1,Cy,Py,dw,cs!==void 0?cs:At.collisionBoxArray.length,cs!==void 0?cs+1:At.collisionBoxArray.length,nf!==void 0?nf:At.collisionBoxArray.length,nf!==void 0?nf+1:At.collisionBoxArray.length,Ls!==void 0?Ls:At.collisionBoxArray.length,Ls!==void 0?Ls+1:At.collisionBoxArray.length,zm||At.collisionBoxArray.length,zm?zm+1:At.collisionBoxArray.length,ki,uw,hw,lw,cw,DC,0,Ly,Ry,ol,0,Dy?1:0)})(t,Ye,Ft,bt,i,r,l,qe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,me,ve,v,0,xe,ke,j,e,u,b,M,A,R,k)};if(Ge==="line")for(const bt of Xb(e.geometry,0,0,yt,yt)){const Ye=lI(bt,he,Ee,i.vertical||K,r,Q,se,t.overscaling,yt);for(const Xt of Ye)K&&pI(t,K.text,Re,Xt)||It(bt,Xt,A)}else if(Ge==="line-center"){for(const bt of e.geometry)if(bt.length>1){const Ye=aI(bt,Ee,i.vertical||K,r,Q,se);Ye&&It(bt,Ye,A)}}else if(e.type==="Polygon")for(const bt of qg(e.geometry,0)){const Ye=uI(bt,16);It(bt[0],new pa(Ye.x,Ye.y,0,0,void 0),A)}else if(e.type==="LineString")for(const bt of e.geometry)It(bt,new pa(bt[0].x,bt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const bt of e.geometry)for(const Ye of bt)It([Ye],new pa(Ye.x,Ye.y,0,0,void 0),A)}const Vd=255,el=Vd*io;function n1(t,e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V,j){const K=function(oe,se,he,me,xe,Ee,ve,ke){const Ge=[];if(se.positionedLines.length===0)return Ge;const Re=me.layout.get("text-rotate").evaluate(Ee,{})*Math.PI/180,je=function(It){const bt=It[0],Ye=It[1],Xt=bt*Ye;return Xt>0?[bt,-Ye]:Xt<0?[-bt,Ye]:bt===0?[Ye,bt]:[Ye,-bt]}(he);let Ce=Math.abs(se.top-se.bottom);for(const It of se.positionedLines)Ce-=It.lineOffset;const Ue=se.positionedLines.length,ot=Ce/Ue;let qe=se.top-he[1];for(let It=0;It<Ue;++It){const bt=se.positionedLines[It];qe=cI(se,ot,qe,It);for(const Ye of bt.positionedGlyphs){if(!Ye.rect)continue;const Xt=Ye.rect||{};let Ft=Fb+1,At=!0,Ke=1,$t=0;if(Ye.imageName){const gn=ve[Ye.imageName];if(!gn)continue;if(gn.sdf){be("SDF images are not supported in formatted text and will be ignored.");continue}At=!1,Ke=gn.pixelRatio,Ft=as/Ke}const fi=(xe||ke)&&Ye.vertical,Yt=Ye.metrics.advance*Ye.scale/2,pi=Ye.metrics,ti=Ye.rect;if(ti===null)continue;ke&&se.verticalizable&&($t=Ye.imageName?Yt-Ye.metrics.width*Ye.scale/2:0);const Si=xe?[Ye.x+Yt,Ye.y]:[0,0];let si=[0,0],nn=[0,0],ki=!1;xe||(fi?(nn=[Ye.x+Yt+je[0],Ye.y+je[1]-$t],ki=!0):si=[Ye.x+Yt+he[0],Ye.y+he[1]-$t]);const Fi=ti.w*Ye.scale/(Ke*(Ye.localGlyph?no:1)),$i=ti.h*Ye.scale/(Ke*(Ye.localGlyph?no:1));let Oi,vn,Xi,Pn;if(fi){const gn=Ye.y-qe,Sn=new $e(-Yt,Yt-gn),ar=-Math.PI/2,lr=new $e(...nn);Oi=new $e(-Yt+si[0],si[1]),Oi._rotateAround(ar,Sn)._add(lr),Oi.x+=-gn+Yt,Oi.y-=(pi.left-Ft)*Ye.scale;const cr=Ye.imageName?pi.advance*Ye.scale:vr*Ye.scale,cn=String.fromCodePoint(Ye.glyph);GA(cn)?Oi.x+=(1-Ft)*Ye.scale:$A(cn)?Oi.x+=cr-pi.height*Ye.scale+(-Ft-1)*Ye.scale:Oi.x+=Ye.imageName||pi.width+2*Ft===ti.w&&pi.height+2*Ft===ti.h?(cr-$i)/2:(cr-(pi.height+2*Ft)*Ye.scale)/2,vn=new $e(Oi.x,Oi.y-Fi),Xi=new $e(Oi.x+$i,Oi.y),Pn=new $e(Oi.x+$i,Oi.y-Fi)}else{const gn=(pi.left-Ft)*Ye.scale-Yt+si[0],Sn=(-pi.top-Ft)*Ye.scale+si[1],ar=gn+Fi,lr=Sn+$i;Oi=new $e(gn,Sn),vn=new $e(ar,Sn),Xi=new $e(gn,lr),Pn=new $e(ar,lr)}if(Re){let gn;gn=xe?new $e(0,0):ki?new $e(je[0],je[1]):new $e(he[0],he[1]),Oi._rotateAround(Re,gn),vn._rotateAround(Re,gn),Xi._rotateAround(Re,gn),Pn._rotateAround(Re,gn)}const Xn=new $e(0,0),gr=new $e(0,0);Ge.push({tl:Oi,tr:vn,bl:Xi,br:Pn,texPrimary:Xt,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:Si,sectionIndex:Ye.sectionIndex,isSDF:At,pixelOffsetTL:Xn,pixelOffsetBR:gr,minFontScaleX:0,minFontScaleY:0})}}return Ge}(0,r,v,u,p,g,l,t.allowVerticalPlacement),ee=t.textSizeData;let Q=null;ee.kind==="source"?(Q=[io*u.layout.get("text-size").evaluate(g,{},V)],Q[0]>el&&be(`${t.layerIds[0]}: Value for "text-size" is >= ${Vd}. Reduce your "text-size".`)):ee.kind==="composite"&&(Q=[io*k.compositeTextSizes[0].evaluate(g,{},V),io*k.compositeTextSizes[1].evaluate(g,{},V)],(Q[0]>el||Q[1]>el)&&be(`${t.layerIds[0]}: Value for "text-size" is >= ${Vd}. Reduce your "text-size".`)),t.addSymbols(t.text,K,Q,v,p,g,M,e,i,b.lineStartIndex,b.lineLength,R,O,V,j,!1);for(const oe of A)C[oe]=t.text.placedSymbolArray.length-1;return 4*K.length}function r1(t){for(const e in t)return t[e];return null}function pm(t,e,i,r,l,u,p,g,v,b){let M=p.top,A=p.bottom,C=p.left,R=p.right;const k=p.collisionPadding;if(k&&(C-=k[0],M-=k[1],R+=k[2],A+=k[3]),v){const O=new $e(C,M),V=new $e(R,M),j=new $e(C,A),K=new $e(R,A),ee=Zt(v);let Q=new $e(0,0);b&&(Q=new $e(b[0],b[1])),O._rotateAround(ee,Q),V._rotateAround(ee,Q),j._rotateAround(ee,Q),K._rotateAround(ee,Q),C=Math.min(O.x,V.x,j.x,K.x),R=Math.max(O.x,V.x,j.x,K.x),M=Math.min(O.y,V.y,j.y,K.y),A=Math.max(O.y,V.y,j.y,K.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,C,M,R,A,g,r,l,u),t.length-1}function ay(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function pI(t,e,i,r){const l=t.compareText;if(e in l){const u=l[e];for(let p=u.length-1;p>=0;p--)if(r.dist(u[p])<i)return!0}else l[e]=[];return l[e].push(r),!1}function s1(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),u=Math.sin(i)*l/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),p=Math.sin(t._pitch)*u+l;return Math.min(1.01*p,l*(1/t._horizonShift))}function Ud(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,l=(t.x+1)*i,u=t.y*i,p=(t.y+1)*i,g=ni(r),v=ni(l),b=Ai(u),M=Ai(p),A=e.project(g,b),C=e.project(v,b),R=e.project(v,M),k=e.project(g,M);let O=Math.min(A.x,C.x,R.x,k.x),V=Math.min(A.y,C.y,R.y,k.y),j=Math.max(A.x,C.x,R.x,k.x),K=Math.max(A.y,C.y,R.y,k.y);const ee=i/16;function Q(se,he,me,xe,Ee,ve){const ke=(me+Ee)/2,Ge=(xe+ve)/2,Re=e.project(ni(ke),Ai(Ge)),je=Math.max(0,O-Re.x,V-Re.y,Re.x-j,Re.y-K);O=Math.min(O,Re.x),j=Math.max(j,Re.x),V=Math.min(V,Re.y),K=Math.max(K,Re.y),je>ee&&(Q(se,Re,me,xe,ke,Ge),Q(Re,he,ke,Ge,Ee,ve))}Q(A,C,r,u,l,u),Q(C,R,l,u,l,p),Q(R,k,l,p,r,p),Q(k,A,r,p,r,u),O-=ee,V-=ee,j+=ee,K+=ee;const oe=1/Math.max(j-O,K-V);return{scale:oe,x:O*oe,y:V*oe,x2:j*oe,y2:K*oe,projection:e}}function o1(t,{x:e,y:i},r=0){return new $e(((e-r)*t.scale-t.x)*yt,(i*t.scale-t.y)*yt)}const mI=s.a6.identity(new Float32Array(16));class tl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ye(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return ri(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return s1(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,l){const u=e.horizonLineFromTop(!1),p=new $e(i,Math.max(u,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}pointCoordinate3D(e,i,r){const l=new $e(i,r);if(e.elevation)return e.elevation.pointCoordinate(l);{const u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return mI}createTileMatrix(e,i,r){let l,u,p;const g=r.canonical,v=s.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=Ud(g,this);l=1,u=b.x+r.wrap*b.scale,p=b.y,s.a6.scale(v,v,[l/b.scale,l/b.scale,e.pixelsPerMeter/i])}else l=i/e.zoomScale(g.z),u=(g.x+Math.pow(2,g.z)*r.wrap)*l,p=g.y*l;return s.a6.translate(v,v,[u,p,0]),s.a6.scale(v,v,[l/yt,l/yt,1]),v}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class _I extends tl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Zt(i));this.n=(l+Math.sin(Zt(r)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:l,r0:u}=this,p=Zt(e-this.center[0]),g=Zt(i),v=Math.sqrt(l-2*r*Math.sin(g))/r;return{x:v*Math.sin(p*r),y:v*Math.cos(p*r)-u,z:0}}unproject(e,i){const{n:r,c:l,r0:u}=this,p=u+i;let g=Math.atan2(e,Math.abs(p))*Math.sign(p);p*r<0&&(g-=Math.PI*Math.sign(e)*Math.sign(p));const v=Zt(this.center[0])*r;g=Kn(g,-Math.PI-v,Math.PI-v);const b=kt(sn(g/r)+this.center[0],-180,180),M=Math.asin(kt((l-(e*e+p*p)*r*r)/(2*r),-1,1)),A=kt(sn(M),-yi,yi);return new ye(b,A)}}const jd=1.340264,Gd=-.081106,$d=893e-6,qd=.003796,mm=Math.sqrt(3)/2;class gI extends tl{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(mm*Math.sin(i)),l=r*r,u=l*l*l;return{x:.5*(e*Math.cos(r)/(mm*(jd+3*Gd*l+u*(7*$d+9*qd*l)))/Math.PI+.5),y:1-.5*(r*(jd+Gd*l+u*($d+qd*l))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,l=r*r,u=l*l*l;for(let M,A,C,R=0;R<12&&(A=r*(jd+Gd*l+u*($d+qd*l))-i,C=jd+3*Gd*l+u*(7*$d+9*qd*l),M=A/C,r=kt(r-M,-Math.PI/3,Math.PI/3),l=r*r,u=l*l*l,!(Math.abs(M)<1e-12));++R);const p=mm*e*(jd+3*Gd*l+u*(7*$d+9*qd*l))/Math.cos(r),g=Math.asin(Math.sin(r)/mm),v=kt(180*p/Math.PI,-180,180),b=kt(180*g/Math.PI,-yi,yi);return new ye(v,b)}}class yI extends tl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),l=kt(360*(.5-i),-yi,yi);return new ye(r,l)}}const Ou=Math.PI/2;function _m(t){return Math.tan((Ou+t)/2)}class xI extends tl{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let l=Zt(i),u=Zt(r);this.southernCenter=l+u<0,this.southernCenter&&(l=-l,u=-u);const p=Math.cos(l),g=_m(l);this.n=l===u?Math.sin(l):Math.log(p/Math.cos(u))/Math.log(_m(u)/g),this.f=p*Math.pow(_m(l),this.n)/this.n}project(e,i){i=Zt(i),this.southernCenter&&(i=-i),e=Zt(e-this.center[0]);const r=1e-6,{n:l,f:u}=this;u>0?i<-Ou+r&&(i=-Ou+r):i>Ou-r&&(i=Ou-r);const p=u/Math.pow(_m(i),l);let g=p*Math.sin(l*e),v=u-p*Math.cos(l*e);return g=.5*(g/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:g,y:this.southernCenter?v:1-v,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:l}=this,u=l-i,p=Math.sign(u),g=Math.sign(r)*Math.sqrt(e*e+u*u);let v=Math.atan2(e,Math.abs(u))*p;u*r<0&&(v-=Math.PI*Math.sign(e)*p);const b=kt(sn(v/r)+this.center[0],-180,180),M=kt(sn(2*Math.atan(Math.pow(l/g,1/r))-Ou),-yi,yi);return new ye(b,this.southernCenter?-M:M)}}class a1 extends tl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:li(e),y:Jt(i),z:0}}unproject(e,i){const r=ni(e),l=Ai(i);return new ye(r,l)}}const l1=Zt(yi);class vI extends tl{project(e,i){const r=(i=Zt(i))*i,l=r*r;return{x:.5*((e=Zt(e))*(.8707-.131979*r+l*(l*(.003971*r-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+l*(.028874*r-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,l=25,u=0,p=r*r;do{p=r*r;const b=p*p;u=(r*(1.007226+p*(.015085+b*(.028874*p-.044475-.005916*b)))-i)/(1.007226+p*(.045255+b*(.259866*p-.311325-.005916*11*b))),r=kt(r-u,-l1,l1)}while(Math.abs(u)>1e-6&&--l>0);p=r*r;const g=kt(sn(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=sn(r);return new ye(g,v)}}const c1=Zt(yi);class bI extends tl{project(e,i){i=Zt(i),e=Zt(e);const r=Math.cos(i),l=2/Math.PI,u=Math.acos(r*Math.cos(e/2)),p=Math.sin(u)/u,g=.5*(e*l+2*r*Math.sin(e/2)/p)||0,v=.5*(i+Math.sin(i)/p)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,l=i=(2*(1-i)-1)*Math.PI,u=25;const p=1e-6;let g=0,v=0;do{const b=Math.cos(l),M=Math.sin(l),A=2*M*b,C=M*M,R=b*b,k=Math.cos(r/2),O=Math.sin(r/2),V=2*k*O,j=O*O,K=1-R*k*k,ee=K?1/K:0,Q=K?Math.acos(b*k)*Math.sqrt(1/K):0,oe=.5*(2*Q*b*O+2*r/Math.PI)-e,se=.5*(Q*M+l)-i,he=.5*ee*(R*j+Q*b*k*C)+1/Math.PI,me=ee*(V*A/4-Q*M*O),xe=.125*ee*(A*O-Q*M*R*V),Ee=.5*ee*(C*k+Q*j*b)+.5,ve=me*xe-Ee*he;g=(se*me-oe*Ee)/ve,v=(oe*xe-se*he)/ve,r=kt(r-g,-Math.PI,Math.PI),l=kt(l-v,-c1,c1)}while((Math.abs(g)>p||Math.abs(v)>p)&&--u>0);return new ye(sn(r),sn(l))}}class u1 extends tl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Zt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:l}=this;return{x:Zt(e)*l*r+.5,y:-Math.sin(Zt(i))/l*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:l}=this,u=-(i-.5)/r,p=kt(sn((e-.5)/r)/l,-180,180),g=Math.asin(kt(u*l,-1,1)),v=kt(sn(g),-yi,yi);return new ye(p,v)}}class wI extends a1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){const l=Cd(e,i,r),u=Zp(Oo(r));return s.N.transformMat4(l,l,u),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,i){const r=ze(i.lat,i.lng),l=s.N.normalize([],r),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,p=ri(1,0)*yt*u;s.N.scaleAndAdd(r,r,l,p);const g=s.a6.identity(new Float64Array(16));return s.a6.multiply(g,e.pixelMatrix,e.globeMatrix),s.N.transformMat4(r,r,g),new $e(r[0],r[1])}pixelsPerMeter(e,i){return ri(1,0)*i}pixelSpaceConversion(e,i,r){const l=ri(1,e)*i,u=Mi(ri(1,45)*i,l,r);return this.pixelsPerMeter(e,i)/u}createTileMatrix(e,i,r){const l=Fg(Oo(r.canonical));return s.a6.multiply(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,i){const{center:r}=e,l=Zp(Oo(i));return s.a6.rotateY(l,l,Zt(r.lng)),s.a6.rotateX(l,l,Zt(r.lat)),s.a6.scale(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,i,r,l){return Av(e,i,r,!0)||new Di(0,0)}pointCoordinate3D(e,i,r){const l=this.pointCoordinate(e,i,r,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,i){return!Av(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(l,u){const p=l.cameraToCenterDistance,g=l._centerAltitude*u,v=l._camera,b=l._camera.forward(),M=s.N.add([],s.N.scale([],b,-p),[0,0,g]),A=l.worldSize/(2*Math.PI),C=[0,0,-A],R=l.width/l.height,k=Math.tan(l.fovAboveCenter),O=s.N.scale([],v.up(),k),V=s.N.scale([],v.right(),k*R),j=s.N.normalize([],s.N.add([],s.N.add([],b,O),V)),K=[];let ee;if(new Lg(M,j).closestPointOnSphere(C,A,K)){const Q=s.N.add([],K,C),oe=s.N.sub([],Q,M);ee=Math.cos(l.fovAboveCenter)*s.N.length(oe)}else{const Q=s.N.sub([],M,C),oe=s.N.sub([],C,M);s.N.normalize(oe,oe);const se=s.N.length(Q)-A;ee=Math.sqrt(se*(se+2*A));const he=Math.acos(ee/(A+se))-Math.acos(s.N.dot(b,oe));ee*=Math.cos(he)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Xa(e.zoom);if(r>0){const l=s1(e,ri(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Mi(i,l+u*(1-Math.cos(p)),Math.pow(r,10))}return i}upVector(e,i,r){return Cd(i,r,e,1)}upVectorScale(e){return{metersToTile:qp(Wp(Oo(e)))}}}function h1(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new a1(t);case"equirectangular":return new yI(t);case"naturalEarth":return new vI(t);case"equalEarth":return new gI(t);case"winkelTripel":return new bI(t);case"albers":return i?new u1(t):new _I(t);case"lambertConformalConic":return i?new u1(t):new xI(t);case"globe":return new wI(t)}throw new Error(`Invalid projection name: ${t.name}`)}const TI=tm.types,MI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gm(t,e,i,r,l,u,p,g,v,b,M,A,C){const R=g?Math.min(el,Math.round(g[0])):0,k=g?Math.min(el,Math.round(g[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*l),u,p,(R<<1)+(v?1:0),k,16*b,16*M,256*A,256*C)}function ym(t,e,i){t.emplaceBack(e,i)}function xm(t,e,i,r,l,u,p){t.emplaceBack(e,i,r,l,u,p)}function vm(t,e,i,r,l){t.emplaceBack(e,i,r,l),t.emplaceBack(e,i,r,l),t.emplaceBack(e,i,r,l),t.emplaceBack(e,i,r,l)}function SI(t){for(const e of t.sections)if(Qh(e.text))return!0;return!1}class ly{constructor(e){this.layoutVertexArray=new Ql,this.indexArray=new Qn,this.programConfigurations=e,this.segments=new Cn,this.dynamicLayoutVertexArray=new Co,this.opacityVertexArray=new _d,this.placedSymbolArray=new Ep,this.iconTransitioningVertexArray=new Bs,this.globeExtVertexArray=new md,this.zOffsetVertexArray=new tc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,r,l,u){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,RA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kA.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,MI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,FA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,zA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,OA.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Mt(ly,"SymbolBuffers");class cy{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new Cn,this.collisionVertexArray=new yd,this.collisionVertexArrayExt=new Co}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,BA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,NA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Mt(cy,"CollisionBuffers");class bm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.a6.identity([]),this.placementViewportMatrix=s.a6.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jg(this.zoom,i["text-size"]),this.iconSizeData=Jg(this.zoom,i["icon-size"]);const r=this.layers[0].layout,l=r.get("symbol-sort-key"),u=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(p=>Ps[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new ly(new $(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ly(new $(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Cp,this.lineVertexArray=new sc,this.symbolInstances=new Ip}calculateGlyphDependencies(e,i,r,l,u){for(let p=0;p<e.length;p++){const g=e.codePointAt(p);if(g===void 0)break;if(i[g]=!0,l&&u&&g<=65535){const v=Fd[e.charAt(p)];v&&(i[v.charCodeAt(0)]=!0)}}}populate(e,i,r,l){const u=this.layers[0],p=u.layout,g=this.projection.name==="globe",v=p.get("text-font"),b=p.get("text-field"),M=p.get("icon-image"),A=(b.value.kind!=="constant"||b.value.value instanceof pr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),C=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,R=p.get("symbol-sort-key");if(this.features=[],!A&&!C)return;const k=i.iconDependencies,O=i.glyphDependencies,V=i.availableImages,j=new bn(this.zoom);for(const{feature:K,id:ee,index:Q,sourceLayerIndex:oe}of e){const se=u._featureFilter.needGeometry,he=qn(K,se);if(!u._featureFilter.filter(j,he,r))continue;if(se||(he.geometry=tr(K,r,l)),g&&K.type!==1&&r.z<=5){const ve=he.geometry,ke=.98078528056,Ge=(Re,je)=>{const Ce=Cd(Re.x,Re.y,r,1),Ue=Cd(je.x,je.y,r,1);return s.N.dot(Ce,Ue)<ke};for(let Re=0;Re<ve.length;Re++)ve[Re]=_r(ve[Re],Ge)}let me,xe;if(A){const ve=u.getValueAndResolveTokens("text-field",he,r,V),ke=pr.factory(ve);SI(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||Io()==="unavailable"||this.hasRTLText&&Xr.isParsed())&&(me=jA(ke,u,he))}if(C){const ve=u.getValueAndResolveTokens("icon-image",he,r,V);xe=ve instanceof Ht?ve:Ht.fromString(ve)}if(!me&&!xe)continue;const Ee=this.sortFeaturesByKey?R.evaluate(he,{},r):void 0;if(this.features.push({id:ee,text:me,icon:xe,index:Q,sourceLayerIndex:oe,geometry:he.geometry,properties:K.properties,type:TI[K.type],sortKey:Ee}),xe&&(k[xe.namePrimary]=!0,xe.nameSecondary&&(k[xe.nameSecondary]=!0)),me){const ve=v.evaluate(he,{},r).join(","),ke=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ps.vertical)>=0;for(const Ge of me.sections)if(Ge.image)k[Ge.image.namePrimary]=!0;else{const Re=Eo(me.toString()),je=Ge.fontStack||ve,Ce=O[je]=O[je]||{};this.calculateGlyphDependencies(Ge.text,Ce,ke,this.allowVerticalPlacement,Re)}}}p.get("symbol-placement")==="line"&&(this.features=function(K){const ee={},Q={},oe=[];let se=0;function he(ve){oe.push(K[ve]),se++}function me(ve,ke,Ge){const Re=Q[ve];return delete Q[ve],Q[ke]=Re,oe[Re].geometry[0].pop(),oe[Re].geometry[0]=oe[Re].geometry[0].concat(Ge[0]),Re}function xe(ve,ke,Ge){const Re=ee[ke];return delete ee[ke],ee[ve]=Re,oe[Re].geometry[0].shift(),oe[Re].geometry[0]=Ge[0].concat(oe[Re].geometry[0]),Re}function Ee(ve,ke,Ge){const Re=Ge?ke[0][ke[0].length-1]:ke[0][0];return`${ve}:${Re.x}:${Re.y}`}for(let ve=0;ve<K.length;ve++){const ke=K[ve],Ge=ke.geometry,Re=ke.text?ke.text.toString():null;if(!Re){he(ve);continue}const je=Ee(Re,Ge),Ce=Ee(Re,Ge,!0);if(je in Q&&Ce in ee&&Q[je]!==ee[Ce]){const Ue=xe(je,Ce,Ge),ot=me(je,Ce,oe[Ue].geometry);delete ee[je],delete Q[Ce],Q[Ee(Re,oe[ot].geometry,!0)]=ot,oe[Ue].geometry=null}else je in Q?me(je,Ce,Ge):Ce in ee?xe(je,Ce,Ge):(he(ve),ee[je]=se-1,Q[Ce]=se-1)}return oe.filter(ve=>ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ee)=>K.sortKey-ee.sortKey)}update(e,i,r,l,u){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const g=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,g,r,l,u),this.icon.programConfigurations.updatePaintArrays(e,i,g,r,l,u)}updateZOffset(){const e=(u,p,g)=>{r+=p,r>u.length&&u.resize(r);for(let v=-p;v<0;v++)u.emplace(v+r,g)},i=(u,p,g)=>{l+=p,l>u.length&&u.resize(l);for(let v=-p;v<0;v++)u.emplace(v+l,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,l=0;for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:v,numIconVertices:b}=p,M=p.zOffset,A=b>0;if((g>0||v>0)&&(e(this.text.zOffsetVertexArray,g,M),e(this.text.zOffsetVertexArray,v,M)),A){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:R}=p;C>=0&&i(this.icon.zOffsetVertexArray,b,M),R>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=h1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:u}of i)this.lineVertexArray.emplaceBack(l,u);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,l,u,p,g,v,b,M,A,C,R,k,O,V){const j=e.indexArray,K=e.layoutVertexArray,ee=e.globeExtVertexArray,Q=e.segments.prepareSegment(4*i.length,K,j,this.canOverlap?p.sortKey:void 0),oe=this.glyphOffsetArray.length,se=Q.vertexLength,he=this.allowVerticalPlacement&&g===Ps.vertical?Math.PI/2:0,me=p.text&&p.text.sections;for(let Ee=0;Ee<i.length;Ee++){const{tl:ve,tr:ke,bl:Ge,br:Re,texPrimary:je,texSecondary:Ce,pixelOffsetTL:Ue,pixelOffsetBR:ot,minFontScaleX:qe,minFontScaleY:It,glyphOffset:bt,isSDF:Ye,sectionIndex:Xt}=i[Ee],Ft=Q.vertexLength,At=bt[1];if(gm(K,b.x,b.y,ve.x,At+ve.y,je.x,je.y,r,Ye,Ue.x,Ue.y,qe,It),gm(K,b.x,b.y,ke.x,At+ke.y,je.x+je.w,je.y,r,Ye,ot.x,Ue.y,qe,It),gm(K,b.x,b.y,Ge.x,At+Ge.y,je.x,je.y+je.h,r,Ye,Ue.x,ot.y,qe,It),gm(K,b.x,b.y,Re.x,At+Re.y,je.x+je.w,je.y+je.h,r,Ye,ot.x,ot.y,qe,It),v){const{x:Ke,y:$t,z:fi}=v.anchor,[Yt,pi,ti]=v.up;xm(ee,Ke,$t,fi,Yt,pi,ti),xm(ee,Ke,$t,fi,Yt,pi,ti),xm(ee,Ke,$t,fi,Yt,pi,ti),xm(ee,Ke,$t,fi,Yt,pi,ti),vm(e.dynamicLayoutVertexArray,Ke,$t,fi,he)}else vm(e.dynamicLayoutVertexArray,b.x,b.y,b.z,he);if(V){const Ke=Ce||je;ym(e.iconTransitioningVertexArray,Ke.x,Ke.y),ym(e.iconTransitioningVertexArray,Ke.x+Ke.w,Ke.y),ym(e.iconTransitioningVertexArray,Ke.x,Ke.y+Ke.h),ym(e.iconTransitioningVertexArray,Ke.x+Ke.w,Ke.y+Ke.h)}j.emplaceBack(Ft,Ft+1,Ft+2),j.emplaceBack(Ft+1,Ft+2,Ft+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bt[0]),Ee!==i.length-1&&Xt===i[Ee+1].sectionIndex||e.programConfigurations.populatePaintArrays(K.length,p,p.index,{},R,k,O,me&&me[Xt])}const xe=v?v.anchor:b;e.placedSymbolArray.emplaceBack(xe.x,xe.y,xe.z,b.x,b.y,oe,this.glyphOffsetArray.length-oe,se,M,A,b.segment,r?r[0]:0,r?r[1]:0,l[0],l[1],g,0,!1,0,C,0)}_commitLayoutVertex(e,i,r,l,u,p,g){e.emplaceBack(i,r,l,u,p,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,r,l,u,p,g){const v=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),b=v.vertexLength,M=g.tileAnchorX,A=g.tileAnchorY;for(let R=0;R<4;R++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(r.layoutVertexArray,l,u,p,M,A,new $e(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,l,u,p,M,A,new $e(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,l,u,p,M,A,new $e(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,l,u,p,M,A,new $e(e.x1,e.y2)),v.vertexLength+=4;const C=r.indexArray;C.emplaceBack(b,b+1),C.emplaceBack(b+1,b+2),C.emplaceBack(b+2,b+3),C.emplaceBack(b+3,b),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,l,u,p){for(let g=l;g<u;g++){const v=r.get(g),b=this.getSymbolInstanceTextSize(e,p,i,g);this._addCollisionDebugVertices(v,b,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,r,l,u,p){for(let g=l;g<u;g++){const v=r.get(g),b=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(v,b,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cy(ec,Db.members,Bs),this.iconCollisionBox=new cy(ec,Db.members,Bs);const r=Cu(this.iconSizeData,e),l=Cu(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,i,r,l){const u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:l),p=am(this.textSizeData,e,u)/vr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,r){const l=this.icon.placedSymbolArray.get(r),u=am(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,i,r,l){e.emplaceBack(i,-r,-r,l),e.emplaceBack(i,r,-r,l),e.emplaceBack(i,r,r,l),e.emplaceBack(i,-r,r,l)}_updateTextDebugCollisionBoxes(e,i,r,l,u,p){for(let g=l;g<u;g++){const v=r.get(g),b=this.getSymbolInstanceTextSize(e,p,i,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,v.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,r,l,u,p){for(let g=l;g<u;g++){const v=r.get(g),b=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,v.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Cu(this.iconSizeData,e),l=Cu(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(r,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(r,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,l,u,p,g,v,b){const M={};if(i<r){const{x1:A,y1:C,x2:R,y2:k,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q,featureIndex:oe}=e.get(i);M.textBox={x1:A,y1:C,x2:R,y2:k,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q},M.textFeatureIndex=oe}if(l<u){const{x1:A,y1:C,x2:R,y2:k,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q,featureIndex:oe}=e.get(l);M.verticalTextBox={x1:A,y1:C,x2:R,y2:k,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q},M.verticalTextFeatureIndex=oe}if(p<g){const{x1:A,y1:C,x2:R,y2:k,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q,featureIndex:oe}=e.get(p);M.iconBox={x1:A,y1:C,x2:R,y2:k,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q},M.iconFeatureIndex=oe}if(v<b){const{x1:A,y1:C,x2:R,y2:k,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q,featureIndex:oe}=e.get(v);M.verticalIconBox={x1:A,y1:C,x2:R,y2:k,padding:O,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:Q},M.verticalIconFeatureIndex=oe}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),l=r.vertexStartIndex+4*r.numGlyphs;for(let u=r.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),l=[],u=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);const v=this.symbolInstances.get(g);l.push(0|Math.round(i*v.tileAnchorX+r*v.tileAnchorY)),u.push(v.featureIndex)}return p.sort((g,v)=>l[g]-l[v]||u[v]-u[g]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:b}=r;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&p!==l&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Mt(bm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),bm.addDynamicAttributes=vm;const EI=new wn({"symbol-placement":new rt(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new rt(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rt(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rt(Te.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new rt(Te.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new rt(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new rt(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new rt(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rt(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(Te.layout_symbol["icon-size"]),"icon-text-fit":new Gt(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(Te.layout_symbol["icon-image"]),"icon-rotate":new Gt(Te.layout_symbol["icon-rotate"]),"icon-padding":new rt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new rt(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Gt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rt(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rt(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rt(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(Te.layout_symbol["text-field"]),"text-font":new Gt(Te.layout_symbol["text-font"]),"text-size":new Gt(Te.layout_symbol["text-size"]),"text-max-width":new Gt(Te.layout_symbol["text-max-width"]),"text-line-height":new Gt(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Gt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rt(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new Gt(Te.layout_symbol["text-anchor"]),"text-max-angle":new rt(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new rt(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(Te.layout_symbol["text-rotate"]),"text-padding":new rt(Te.layout_symbol["text-padding"]),"text-keep-upright":new rt(Te.layout_symbol["text-keep-upright"]),"text-transform":new Gt(Te.layout_symbol["text-transform"]),"text-offset":new Gt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new rt(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new rt(Te.layout_symbol["text-ignore-placement"]),"text-optional":new rt(Te.layout_symbol["text-optional"]),visibility:new rt(Te.layout_symbol.visibility)});var uy={paint:new wn({"icon-opacity":new Gt(Te.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Gt(Te.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gt(Te.paint_symbol["text-emissive-strength"]),"icon-color":new Gt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Gt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new rt(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new rt(Te.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Gt(Te.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gt(Te.paint_symbol["text-opacity"]),"text-color":new Gt(Te.paint_symbol["text-color"],{runtimeType:ns,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Gt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(Te.paint_symbol["text-halo-blur"]),"text-translate":new rt(Te.paint_symbol["text-translate"]),"text-translate-anchor":new rt(Te.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new rt(Te.paint_symbol["icon-color-saturation"])}),layout:EI};class d1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ma,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mt(d1,"FormatSectionOverride",{omit:["defaultValue"]});class wm extends Nr{constructor(e,i,r){super(e,uy,i,r)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const l=[];for(const u of r)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,l){const u=this.layout.get(e).evaluate(i,{},r,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Vl(p.value)||!u?u:function(g,v){return v.replace(/{([^{}]+)}/g,(b,M)=>M in g?String(g[M]):"")}(i.properties,u)}createBucket(e){return new bm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of uy.paint.overridableProperties){if(!wm.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new d1(i),l=new cu(r,i.property.specification,this.scope,this.options);let u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new Kh("source",l):new Ul("composite",l,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ga(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&wm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),l=uy.paint.properties[i];let u=!1;const p=g=>{for(const v of g)if(l.overrides&&l.overrides.hasOverride(v))return void(u=!0)};if(r.value.kind==="constant"&&r.value.value instanceof pr)p(r.value.value.sections);else if(r.value.kind==="source"){const g=b=>{u||(b instanceof qs&&Gn(b.value)===Ea?p(b.value.sections):b instanceof Ia?p(b.sections):b.eachChild(g))},v=r.value;v._styleExpression&&g(v._styleExpression.expression)}return u}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,r=[];return e&&r.push("symbolIcon"),i&&r.push("symbolSDF"),r}getDefaultProgramParams(e,i){return{config:new N(this,i),overrideFog:!1}}}const AI=new wn({visibility:new rt(Te.layout_background.visibility)});var II={paint:new wn({"background-color":new rt(Te.paint_background["background-color"]),"background-pattern":new rt(Te.paint_background["background-pattern"]),"background-opacity":new rt(Te.paint_background["background-opacity"]),"background-emissive-strength":new rt(Te.paint_background["background-emissive-strength"])}),layout:AI};const CI=new wn({visibility:new rt(Te.layout_raster.visibility)});var PI={paint:new wn({"raster-opacity":new rt(Te.paint_raster["raster-opacity"]),"raster-color":new sa(Te.paint_raster["raster-color"]),"raster-color-mix":new rt(Te.paint_raster["raster-color-mix"]),"raster-color-range":new rt(Te.paint_raster["raster-color-range"]),"raster-hue-rotate":new rt(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rt(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rt(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new rt(Te.paint_raster["raster-saturation"]),"raster-contrast":new rt(Te.paint_raster["raster-contrast"]),"raster-resampling":new rt(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new rt(Te.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new rt(Te.paint_raster["raster-emissive-strength"]),"raster-array-band":new rt(Te.paint_raster["raster-array-band"]),"raster-elevation":new rt(Te.paint_raster["raster-elevation"])}),layout:CI},hy=Hi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class dy{constructor(e,i,r,l){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,l)}update(e,i,r){const{width:l,height:u}=e,{context:p}=this,{gl:g}=p;if(g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!i||i.premultiply!==!1)),r||this.size&&this.size[0]===l&&this.size[1]===u){const{x:v,y:b}=r||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)g.texSubImage2D(g.TEXTURE_2D,0,v,b,g.RGBA,g.UNSIGNED_BYTE,e);else{let M=this.format,A=g.UNSIGNED_BYTE;this.format===g.R32F&&(M=g.RED,A=g.FLOAT),g.texSubImage2D(g.TEXTURE_2D,0,v,b,l,u,M,A,e.data)}}else if(this.size=[l,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let v=this.format;this.format===g.R8&&(v=g.RED),g.texImage2D(g.TEXTURE_2D,0,this.format,v,g.UNSIGNED_BYTE,e)}else{let v=this.format,b=this.format,M=g.UNSIGNED_BYTE;this.format===g.DEPTH_COMPONENT&&(v=g.DEPTH_COMPONENT16,M=g.UNSIGNED_SHORT),this.format===g.R8&&(b=g.RED),this.format===g.R32F&&(M=g.FLOAT,b=g.RED),g.texImage2D(g.TEXTURE_2D,0,v,l,u,0,b,M,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i,r=!1){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!r?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,r,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),this.wrapS=r),l!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Tm{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:r}=this,{gl:l}=r;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Mm(t,e,i,r,l,u,p,g){const v=[t,e,1,i,r,1,l,u,1],b=[p,g,1],M=s.co.adjoint([],v),[A,C,R]=s.N.transformMat3(b,b,M);return s.co.multiply(v,v,[A,0,0,0,C,0,0,0,R])}function f1(t,e,i,r,l,u,p,g){const v=function(b,M,A,C,R,k,O,V){const j=Mm(0,0,1,0,1,1,0,1),K=Mm(b,M,A,C,R,k,O,V),ee=s.co.adjoint([],j);return s.co.multiply(K,K,ee)}(t,e,i,r,l,u,p,g);return[v[2]/v[8]/yt,v[5]/v[8]/yt]}function Sm(t){return[t[0],Math.min(Math.max(t[1],-yi),yi)]}class p1 extends Ta{constructor(e,i,r,l){super(),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Ho("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=_t(this.map._requestManager.transformRequest(this.url,kr.Image),(r,l)=>{this._imageRequest=null,this._loaded=!0,r?this.fire(new th(r)):l&&(this.image=l instanceof HTMLImageElement?Je.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Tm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ho("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Tm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],r=e[0][1];for(const u of e)u[1]>r&&(r=u[1]),u[1]<i&&(i=u[1]);const l=(r+i)/2;if(l>yi?this.onNorthPole=!0:l<-yi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(Di.fromLngLat);this.tileID=function(p){let g=1/0,v=1/0,b=-1/0,M=-1/0;for(const O of p)g=Math.min(g,O.x),v=Math.min(v,O.y),b=Math.max(b,O.x),M=Math.max(M,O.y);const A=Math.max(b-g,M-v),C=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),R=Math.pow(2,C);let k=Math.floor((g+b)/2*R);return k>1&&(k-=1),new Ze(C,k,Math.floor((v+M)/2*R))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ho("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const j in this.tiles){const K=this.tiles[j];K.state!=="loaded"&&(K.state="loaded",K.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Ud(new Ze(0,0,0),this.map.transform.projection),r=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const K=j[1].x-j[0].x,ee=j[1].y-j[0].y,Q=j[2].x-j[1].x,oe=j[2].y-j[1].y,se=j[3].x-j[2].x,he=j[3].y-j[2].y,me=j[0].x-j[3].x,xe=j[0].y-j[3].y,Ee=K*oe-Q*ee,ve=Q*he-se*oe,ke=se*xe-me*he,Ge=me*ee-K*xe;return Ee>0&&ve>0&&ke>0&&Ge>0||Ee<0&&ve<0&&ke<0&&Ge<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=Ud(this.tileID,this.map.transform.projection),[u,p,g,v]=this.coordinates.map(j=>{const K=l.projection.project(j[0],j[1]);return o1(l,K)._round()});this.perspectiveTransform=f1(u.x,u.y,p.x,p.y,g.x,g.y,v.x,v.y);const b=this._boundsArray=new Ks;b.emplaceBack(u.x,u.y,0,0),b.emplaceBack(p.x,p.y,yt,0),b.emplaceBack(v.x,v.y,0,yt),b.emplaceBack(g.x,g.y,yt,yt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,hy.members),this.boundsSegments=Cn.simpleSegment(0,0,4,2);const M=[],A=[Sm((C=this.coordinates)[0]),Sm(C[1]),Sm(C[2]),Sm(C[3])];var C;const[R,k,O,V]=function(j){let K=j[0][0],ee=K,Q=j[0][1],oe=Q;for(let se=1;se<j.length;se++)j[se][0]<K?K=j[se][0]:j[se][0]>ee&&(ee=j[se][0]),j[se][1]<Q?Q=j[se][1]:j[se][1]>oe&&(oe=j[se][1]);return[K,Q,ee-K,oe-Q]}(A);{const j=new Ks,[K,ee,Q,oe]=function(Ue){let ot=Ue[0].x,qe=ot,It=Ue[0].y,bt=It;for(let Ye=1;Ye<Ue.length;Ye++)Ue[Ye].x<ot?ot=Ue[Ye].x:Ue[Ye].x>qe&&(qe=Ue[Ye].x),Ue[Ye].y<It?It=Ue[Ye].y:Ue[Ye].y>bt&&(bt=Ue[Ye].y);return[ot,It,qe-ot,bt-It]}(r),se=Ue=>[(Ue.x-K)/Q,(Ue.y-ee)/oe],[he,me,xe,Ee]=r.map(se),ve=function(Ue,ot,qe,It,bt,Ye,Xt,Ft){const At=Mm(0,0,1,0,1,1,0,1),Ke=Mm(Ue,ot,qe,It,bt,Ye,Xt,Ft),$t=s.co.adjoint([],Ke);return s.co.multiply(At,At,$t)}(he[0],he[1],me[0],me[1],xe[0],xe[1],Ee[0],Ee[1]);this.elevatedGlobePerspectiveTransform=f1(he[0],he[1],me[0],me[1],xe[0],xe[1],Ee[0],Ee[1]);const ke=(Ue,ot)=>{M.push(Ue.lng);const qe=Math.round((Ue.lng-R)/O*yt),It=Math.round((Ue.lat-k)/V*yt),bt=se(ot),Ye=s.N.transformMat3([],[bt[0],bt[1],1],ve),Xt=Math.round(Ye[0]/Ye[2]*yt),Ft=Math.round(Ye[1]/Ye[2]*yt);j.emplaceBack(qe,It,Xt,Ft)},Ge=r[3].x-r[0].x,Re=r[3].y-r[0].y,je=r[2].x-r[1].x,Ce=r[2].y-r[1].y;for(let Ue=0;Ue<65;Ue++){const ot=Ue/64,qe=[r[0].x+ot*Ge,r[0].y+ot*Re],It=[r[1].x+ot*je,r[1].y+ot*Ce],bt=It[0]-qe[0],Ye=It[1]-qe[1];for(let Xt=0;Xt<65;Xt++){const Ft=Xt/64,At={x:qe[0]+bt*Ft,y:qe[1]+Ye*Ft,z:0};ke(i.projection.unproject(At.x,At.y),At)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,hy.members)}{this.maxLongitudeTriangleSize=0;let j=[],K=new Qn;const ee=(Q,oe,se)=>{K.emplaceBack(Q,oe,se);const he=M[Q],me=M[oe],xe=M[se],Ee=Math.min(Math.min(he,me),xe),ve=Math.max(Math.max(he,me),xe)-Ee;ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ve),j.push(Ee+ve/2)};for(let Q=0;Q<64;Q++)for(let oe=0;oe<64;oe++){const se=65*Q+oe,he=se+1,me=se+65,xe=me+1;ee(se,me,he),ee(he,me,xe)}[j,K]=function(Q,oe){const se=Array.from({length:Q.length},(xe,Ee)=>Ee);se.sort((xe,Ee)=>Q[xe]-Q[Ee]);const he=[],me=new Qn;for(let xe=0;xe<se.length;xe++){const Ee=se[xe];he.push(Q[Ee]);const ve=3*Ee,ke=ve+1;me.emplaceBack(oe.uint16[ve],oe.uint16[ke],oe.uint16[ke+1])}return[he,me]}(j,K),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(K)}this.elevatedGlobeSegments=Cn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/yt,0,V/yt,0,0,k,R,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,r=i.gl;!this._dirty||this.texture instanceof Tm||(this.texture?this.texture.update(this.image):(this.texture=new dy(i,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let l=((M,A)=>M+360*Math.round((A-M)/360))(e+180,r[0]);const u=new Cn,p=(M,A)=>{u.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:i.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},g=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-l)<=g){const M=Pe(r,0,r.length,l+g);return M===r.length||p(M,de(r,M+1,r.length,l+360-g)-M),u}l<r[0]&&(l+=360);const v=de(r,0,r.length,l-g);if(v===r.length)return p(0,r.length),u;p(0,v-0);const b=Pe(r,v+1,r.length,l+g);return b!==r.length&&p(b,r.length-b),u}}const DI=(Math.pow(256,2)-1)/16907520;class m1 extends Nr{constructor(e,i,r){super(e,PI,i,r),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof p1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[r,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(l)||r===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=Pd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,l])}}const LI=new wn({visibility:new rt(Te["layout_raster-particle"].visibility)});var RI={paint:new wn({"raster-particle-array-band":new rt(Te["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new rt(Te["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new sa(Te["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new rt(Te["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new rt(Te["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new rt(Te["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new rt(Te["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:LI};class _1 extends Nr{constructor(e,i,r){super(e,RI,i,r),this._updateColorRamp(),this.onRemove=l=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&l.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=Je.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Pd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Je.now()}}class zI extends Nr{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const kI=new wn({visibility:new rt(Te.layout_sky.visibility)});var OI={paint:new wn({"sky-type":new rt(Te.paint_sky["sky-type"]),"sky-atmosphere-sun":new rt(Te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new rt(Te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new rt(Te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new rt(Te.paint_sky["sky-gradient-radius"]),"sky-gradient":new sa(Te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new rt(Te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new rt(Te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new rt(Te.paint_sky["sky-opacity"])}),layout:kI};function fy(t,e,i){const r=[0,0,1],l=s.bi.identity([]);return s.bi.rotateY(l,l,i?-Zt(t)+Math.PI:Zt(t)),s.bi.rotateX(l,l,-Zt(e)),s.N.transformQuat(r,r,l),s.N.normalize(r,r)}var FI={paint:new wn({})};function g1(t,e){const i=Em(t.projection,t.zoom,t.width,t.height),r=function(u,p,g,v,b){const M=new ye(g.lng-180*il,g.lat),A=new ye(g.lng+180*il,g.lat),C=u.project(M.lng,M.lat),R=u.project(A.lng,A.lat),k=-Math.atan2(R.y-C.y,R.x-C.x),O=Di.fromLngLat(g);O.y=kt(O.y,-1+il,1-il);const V=O.toLngLat(),j=u.project(V.lng,V.lat),K=Di.fromLngLat(V);K.x+=il;const ee=K.toLngLat(),Q=u.project(ee.lng,ee.lat),oe=v1(Q.x-j.x,Q.y-j.y,k),se=Di.fromLngLat(V);se.y+=il;const he=se.toLngLat(),me=u.project(he.lng,he.lat),xe=v1(me.x-j.x,me.y-j.y,k),Ee=Math.abs(oe.x)/Math.abs(xe.y),ve=s.a6.identity([]);s.a6.rotateZ(ve,ve,-k*(1-(b?0:v)));const ke=s.a6.identity([]);return s.a6.scale(ke,ke,[1,1-(1-Ee)*v,1]),ke[4]=-xe.x/xe.y*v,s.a6.rotateZ(ke,ke,k),s.a6.multiply(ke,ve,ke),ke}(t.projection,0,t.center,i,e),l=y1(t);return s.a6.scale(r,r,[l,l,1]),r}function y1(t){const e=t.projection,i=Em(t.projection,t.zoom,t.width,t.height),r=x1(e,t.center),l=x1(e,ye.convert(e.center));return Math.pow(2,r*i+(1-i)*l)}function Em(t,e,i,r,l=1/0){const u=t.range;if(!u)return 0;const p=Math.min(l,Math.max(i,r)),g=Math.log(p/1024)/Math.LN2;return rr(u[0]+g,u[1]+g,e)}const il=1/4e4;function x1(t,e){const i=kt(e.lat,-yi,yi),r=new ye(e.lng-180*il,i),l=new ye(e.lng+180*il,i),u=t.project(r.lng,i),p=t.project(l.lng,i),g=Di.fromLngLat(r),v=Di.fromLngLat(l),b=p.x-u.x,M=p.y-u.y,A=v.x-g.x,C=v.y-g.y,R=Math.sqrt((A*A+C*C)/(b*b+M*M));return Math.log(R)/Math.LN2}function v1(t,e,i){const r=Math.cos(i),l=Math.sin(i);return{x:t*r-e*l,y:t*l+e*r}}function b1(t,e,i){s.a6.identity(t),s.a6.rotateZ(t,t,Zt(e[2])),s.a6.rotateX(t,t,Zt(e[0])),s.a6.rotateY(t,t,Zt(e[1])),s.a6.scale(t,t,i),s.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Am(t,e,i,r,l,u,p,g){const v=[i[0]-e[0],i[1]-e[1],0],b=[r[0]-e[0],r[1]-e[1],0];if(s.N.length(v)<1e-12||s.N.length(b)<1e-12)return s.bi.identity(t);const M=s.N.cross([],v,b);s.N.normalize(M,M),s.N.subtract(b,r,e),v[2]=(u-l)*g,b[2]=(p-l)*g;const A=v;return s.N.cross(A,v,b),s.N.normalize(A,A),s.bi.rotationTo(t,M,A)}function py(t,e,i=!1){const r=Xa(e.zoom),l=function(u,p,g){const v=p.worldSize,b=[u[12],u[13],u[14]],M=Ai(b[1]/v),A=ni(b[0]/v),C=s.a6.identity([]),R=ri(1,M)*v,k=ri(1,0)*v*xi(M,p.zoom),O=1/Bg(v);let V=k*O;if(g){const Q=Em(p.projection,p.zoom,p.width,p.height,1024);V=O*p.projection.pixelSpaceConversion(p.center.lat,v,Q)}const j=ze(M,A);s.N.add(j,j,s.N.scale([],s.N.normalize([],j),R*V*b[2]));const K=function(Q){const oe=[Q[0],Q[1],Q[2]];let se=[0,1,0];const he=s.N.cross([],se,oe);return s.N.cross(se,oe,he),s.N.squaredLength(se)===0&&(se=[0,1,0],s.N.cross(he,oe,se)),s.N.normalize(he,he),s.N.normalize(se,se),s.N.normalize(oe,oe),[he[0],he[1],he[2],0,se[0],se[1],se[2],0,oe[0],oe[1],oe[2],0,Q[0],Q[1],Q[2],1]}(j);s.a6.scale(C,C,[V,V,V*R]),s.a6.translate(C,C,[-b[0],-b[1],-b[2]]);const ee=s.a6.multiply([],p.globeMatrix,K);return s.a6.multiply(ee,ee,C),s.a6.multiply(ee,ee,u),ee}(t,e,i);if(r>0){const u=function(p,g){const v=g.worldSize,b=ri(1,0)*v*xi(g.center.lat,g.zoom)/Bg(v),M=ri(1,g.center.lat)*v,A=s.a6.identity([]);return s.a6.rotateY(A,A,Zt(g.center.lng)),s.a6.rotateX(A,A,Zt(g.center.lat)),s.a6.translate(A,A,[0,0,J]),s.a6.scale(A,A,[b,b,b*M]),s.a6.translate(A,A,[g.point.x-.5*v,g.point.y-.5*v,0]),s.a6.multiply(A,A,p),s.a6.multiply(A,g.globeMatrix,A)}(t,e);return function(p,g,v){const b=(k,O,V)=>{const j=s.N.length(k),K=s.N.length(O),ee=da(k,O,V);return s.N.scale(ee,ee,1/s.N.length(ee)*Mi(j,K,V))},M=b([p[0],p[1],p[2]],[g[0],g[1],g[2]],v),A=b([p[4],p[5],p[6]],[g[4],g[5],g[6]],v),C=b([p[8],p[9],p[10]],[g[8],g[9],g[10]],v),R=da([p[12],p[13],p[14]],[g[12],g[13],g[14]],v);return[M[0],M[1],M[2],0,A[0],A[1],A[2],0,C[0],C[1],C[2],0,R[0],R[1],R[2],1]}(l,u,r)}return l}function w1(t,e,i,r){const l=An.projectAabbCorners(r,i);let u=Number.MAX_VALUE,p=-1;for(let b=0;b<l.length;++b){const M=l[b];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<u&&(p=b,u=M[2])}const g=b=>new $e(l[b][0],l[b][1]);let v;switch(p){case 0:case 6:v=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:v=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:v=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:v=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(Vs(t,v))return u}const BI=Hi([{name:"a_pos_3f",components:3,type:"Float32"}]),NI=Hi([{name:"a_color_3f",components:3,type:"Float32"}]),VI=Hi([{name:"a_color_4f",components:4,type:"Float32"}]),UI=Hi([{name:"a_uv_2f",components:2,type:"Float32"}]),jI=Hi([{name:"a_normal_3f",components:3,type:"Float32"}]),GI=Hi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),$I=Hi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class T1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class M1{constructor(){this.instancedDataArray=new bd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class my{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,r,l){this.tileToMeter=vi(r);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:g,index:v,sourceLayerIndex:b}of e){const M=qn(p,u);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),M,r))continue;const A={id:g,sourceLayerIndex:b,index:v,geometry:u?M.geometry:tr(p,r,l),properties:p.properties,type:p.type,patterns:{}},C=this.addFeature(A,A.geometry,M);C&&i.featureIndex.insert(p,A.geometry,v,b,this.index,this.instancesPerModel[C].instancedDataArray.length,yt/32)}this.lookup=null}update(e,i,r,l){for(const u in this.instancesPerModel){const p=this.instancesPerModel[u];for(const g in e)p.idToFeaturesIndex.hasOwnProperty(g)&&this.evaluate(p.features[p.idToFeaturesIndex[g]],e[g],p,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];for(const l of r.features){const u=this.layers[0],p=l.feature,g=this.canonical,v=u.paint.get("model-rotation").evaluate(p,{},g),b=u.paint.get("model-scale").evaluate(p,{},g),M=u.paint.get("model-translation").evaluate(p,{},g);s.N.exactEquals(l.rotation,v)&&s.N.exactEquals(l.scale,b)&&s.N.exactEquals(l.translation,M)||(this.evaluate(l,l.featureStates,r,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];r.instancedDataArray.length<0||r.instancedDataArray.length===0||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,GI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,r){const l=this.layers[0],u=l.layout.get("model-id").evaluate(r,{},this.canonical);if(!u)return be(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new M1);const p=this.instancesPerModel[u],g=p.instancedDataArray,v=new T1(r,g.length);for(const b of i)for(const M of b){if(M.x<0||M.x>=yt||M.y<0||M.y>=yt)continue;const A=(this.lookupDim-1)/yt,C=this.lookupDim*(M.y*A|0)+M.x*A|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const R=g.length;g.resize(R+1),p.instancesEvaluatedElevation.push(0),g.float32[16*R]=M.x,g.float32[16*R+1]=M.y}return v.instancedDataCount=p.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(v),this.evaluate(v,{},p,!1)),u}evaluate(e,i,r,l){const u=this.layers[0],p=e.feature,g=this.canonical,v=e.rotation=u.paint.get("model-rotation").evaluate(p,i,g),b=e.scale=u.paint.get("model-scale").evaluate(p,i,g),M=e.translation=u.paint.get("model-translation").evaluate(p,i,g),A=u.paint.get("model-color").evaluate(p,i,g);A.a=u.paint.get("model-color-mix-intensity").evaluate(p,i,g);const C=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),b1(C,v,b);const R=Math.round(100*A.a)+A.b/1.05;for(let k=0;k<e.instancedDataCount;++k){const O=e.instancedDataOffset+k,V=16*O,j=r.instancedDataArray.float32;let K=0;l&&(K=j[V+6]-r.instancesEvaluatedElevation[O]);const ee=0|j[V+1];j[V]=(0|j[V])+A.r/1.05,j[V+1]=ee+A.g/1.05,j[V+2]=R,j[V+3]=1/(g.z>10?this.tileToMeter:vi(g,ee)),j[V+4]=M[0],j[V+5]=M[1],j[V+6]=M[2]+K,j[V+7]=C[0],j[V+8]=C[1],j[V+9]=C[2],j[V+10]=C[4],j[V+11]=C[5],j[V+12]=C[6],j[V+13]=C[8],j[V+14]=C[9],j[V+15]=C[10],r.instancesEvaluatedElevation[O]=M[2]}}}Mt(my,"ModelBucket",{omit:["layers"]}),Mt(M1,"PerModelAttributes"),Mt(T1,"ModelFeature");const qI=new wn({visibility:new rt(Te.layout_model.visibility),"model-id":new Gt(Te.layout_model["model-id"])});var HI={paint:new wn({"model-opacity":new rt(Te.paint_model["model-opacity"]),"model-rotation":new Gt(Te.paint_model["model-rotation"]),"model-scale":new Gt(Te.paint_model["model-scale"]),"model-translation":new Gt(Te.paint_model["model-translation"]),"model-color":new Gt(Te.paint_model["model-color"]),"model-color-mix-intensity":new Gt(Te.paint_model["model-color-mix-intensity"]),"model-type":new rt(Te.paint_model["model-type"]),"model-cast-shadows":new rt(Te.paint_model["model-cast-shadows"]),"model-receive-shadows":new rt(Te.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new rt(Te.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gt(Te.paint_model["model-emissive-strength"]),"model-roughness":new Gt(Te.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gt(Te.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new rt(Te.paint_model["model-cutoff-fade-range"])}),layout:qI};const mc=64,Fu={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function S1(t,e,i,r,l,u,p,g,v,b=!1){const M=i.zoom,A=i.project(r),C=xi(r.lat,M),R=1/C;s.a6.identity(t),s.a6.translate(t,t,[A.x+p[0]*R,A.y+p[1]*R,p[2]]);let k=1,O=1;const V=i.worldSize;if(b){if(i.projection.name==="mercator"){let Q=0;i.elevation&&(Q=i.elevation.getAtPointOrZero(new Di(A.x/V,A.y/V),0));const oe=s.a7.transformMat4([],[A.x,A.y,Q,1],i.projMatrix)[3]/i.cameraToCenterDistance;k=oe,O=oe*xi(i.center.lat,M)}else if(i.projection.name==="globe"){const Q=py(t,i),oe=s.a6.multiply([],i.projMatrix,Q),se=[0,0,0,1];s.a7.transformMat4(se,se,oe);const he=se[3]/i.cameraToCenterDistance,me=Xa(M),xe=i.projection.pixelsPerMeter(r.lat,V)*xi(r.lat,M),Ee=i.projection.pixelsPerMeter(i.center.lat,V)*xi(i.center.lat,M);k=he/Mi(xe,Tn(i.center.lat),me),O=he*C/xe,k*=Ee,O*=Ee}}else k=R;s.a6.scale(t,t,[k,k,O]);const j=[...t],K=e.orientation,ee=[];if(b1(ee,[K[0]+l[0],K[1]+l[1],K[2]+l[2]],u),s.a6.multiply(t,j,ee),g&&i.elevation){let Q=0;const oe=[];if(v&&i.elevation){Q=function(me,xe,Ee,ve,ke){const Ge=xe.elevation;if(!Ge)return 0;const Re=An.projectAabbCorners(Ee,ve),je=ri(1,ke.lat)*xe.worldSize,Ce=function($t,fi){const Yt=[0,0,1],pi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ti of pi){const Si=$t[ti.corners[0]],si=$t[ti.corners[1]],nn=$t[ti.corners[2]],ki=[si[0]-Si[0],si[1]-Si[1],fi*(si[2]-Si[2])],Fi=s.N.cross(ki,ki,[nn[0]-Si[0],nn[1]-Si[1],fi*(nn[2]-Si[2])]);s.N.normalize(Fi,Fi),ti.dotProductWithUp=s.N.dot(Fi,Yt)}return pi.sort((ti,Si)=>ti.dotProductWithUp-Si.dotProductWithUp),pi[0].corners}(Re,je),Ue=Re[Ce[0]],ot=Re[Ce[1]],qe=Re[Ce[2]],It=Re[Ce[3]],bt=Ge.getAtPointOrZero(new Di(Ue[0]/xe.worldSize,Ue[1]/xe.worldSize),0),Ye=Ge.getAtPointOrZero(new Di(ot[0]/xe.worldSize,ot[1]/xe.worldSize),0),Xt=Ge.getAtPointOrZero(new Di(qe[0]/xe.worldSize,qe[1]/xe.worldSize),0),Ft=Ge.getAtPointOrZero(new Di(It[0]/xe.worldSize,It[1]/xe.worldSize),0),At=(bt+Ft)/2,Ke=(Ye+Xt)/2;return At>Ke?Ye<Xt?Am(me,ot,It,Ue,Ye,Ft,bt,je):Am(me,qe,Ue,It,Xt,bt,Ft,je):bt<Ft?Am(me,Ue,ot,qe,bt,Ye,Xt,je):Am(me,It,qe,ot,Ft,Xt,Ye,je),Math.max(At,Ke)}(oe,i,e.aabb,t,r);const se=s.a6.fromQuat([],oe),he=s.a6.multiply([],se,ee);s.a6.multiply(t,j,he)}else Q=i.elevation.getAtPointOrZero(new Di(A.x/V,A.y/V),0);Q!==0&&(t[14]+=Q)}}function Hd(t,e,i=!1){t.uploaded||(t.gfxTexture=new dy(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function WI(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,BI.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,jI.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,UI.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?NI:VI).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,$I.members,!0)),t.segments=Cn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const r=t.material;r.pbrMetallicRoughness.baseColorTexture&&Hd(r.pbrMetallicRoughness.baseColorTexture,e),r.pbrMetallicRoughness.metallicRoughnessTexture&&Hd(r.pbrMetallicRoughness.metallicRoughnessTexture,e),r.normalTexture&&Hd(r.normalTexture,e),r.occlusionTexture&&Hd(r.occlusionTexture,e,i),r.emissionTexture&&Hd(r.emissionTexture,e)}function _y(t,e,i){if(t.meshes)for(const r of t.meshes)WI(r,e,i);if(t.children)for(const r of t.children)_y(r,e,i)}function Im(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Im(e)}function gy(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)gy(i)}class ZI{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class XI{constructor(){this.tasks={},this.taskQueue=[],xs(["process"],this),this.invoker=new ZI(this.process),this.nextId=0}add(e,i){const r=this.nextId++,l=function({type:u,isSymbolTile:p,zoom:g}){return g=g||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-g:u==="maybePrepare"&&p?400-g:500:200-g:100-g}(i);if(l===0){St();try{e()}finally{}return null}return this.tasks[r]={fn:e,metadata:i,priority:l,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){St();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<i&&(i=u.priority,e=l)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class E1{constructor(e,i,r){this.target=e,this.parent=i,this.mapId=r,this.callbacks={},this.cancelCallbacks={},xs(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new XI}send(e,i,r,l,u=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=p,this.callbacks[g]=r);const v=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!r,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:So(i,v)},v),{cancel:()=>{r&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const i=e.data,r=i.id;if(r&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const l=this.cancelCallbacks[r];delete this.cancelCallbacks[r],l&&l.cancel()}else if(i.mustQueue||St()){const l=this.callbacks[r],u=this.scheduler.add(()=>this.processTask(r,i),l&&l.metadata||{type:"message"});u&&(this.cancelCallbacks[r]=u)}else this.processTask(r,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const r=this.callbacks[e];delete this.callbacks[e],r&&(i.error?r(na(i.error)):r(null,na(i.data)))}else{const r=new Set,l=i.hasCallback?(p,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?So(p):null,data:So(g,r)},r)}:p=>{},u=na(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,u,l);else if(this.parent.getWorkerSource){const p=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,p[0],u.source,u.scope)[p[1]](u,l)}else l(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Bu{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Mr();const r=this.workerPool.acquire(this.id);for(let l=0;l<r.length;l++){const u=new Bu.Actor(r[l],i,this.id);u.name=`Worker ${l}`,this.actors.push(u)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,r){Rn(this.actors,(l,u)=>{l.send(e,i,u)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Bu.Actor=E1;var Wd={workerUrl:"",workerClass:null,workerParams:void 0};function YI(){return Wd.workerClass!=null?new Wd.workerClass:new self.Worker(Wd.workerUrl,Wd.workerParams)}const yy="mapboxgl_preloaded_worker_pool";class Zd{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Zd.workerCount;)this.workers.push(new YI);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yy]}numActive(){return Object.keys(this.active).length}}let Xd;function Cm(){return Xd||(Xd=new Zd),Xd}Zd.workerCount=2;let Pm,xy,ro,Nu,vy,Vu=null;function A1(){return St()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:xy||Z.DRACO_URL}function I1(){if(St()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Nu)return Nu;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Nu=WebAssembly.validate(t)?Z.MESHOPT_SIMD_URL:Z.MESHOPT_URL,Nu}const Dm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},KI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Yd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function C1(t,e,i){const r=i.json.bufferViews.length,l=i.buffers.length;e.bufferView=r,i.json.bufferViews[r]={buffer:l,byteLength:t.byteLength},i.buffers[l]=t}const by="KHR_draco_mesh_compression";function JI(t,e){const i=t.extensions&&t.extensions[by];if(!i)return;const r=new ro.Decoder,l=R1(e,i.bufferView),u=new ro.Mesh;if(!r.DecodeArrayToMesh(l,l.byteLength,u))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[t.indices],g=Dm[p.componentType],v=p.count*g.BYTES_PER_ELEMENT,b=ro._malloc(v);g===Uint16Array?r.GetTrianglesUInt16Array(u,v,b):r.GetTrianglesUInt32Array(u,v,b),C1(ro.memory.buffer.slice(b,b+v),p,e),ro._free(b);for(const M of Object.keys(i.attributes)){const A=r.GetAttributeByUniqueId(u,i.attributes[M]),C=e.json.accessors[t.attributes[M]],R=KI[C.componentType],k=C.count*Yd[C.type]*Dm[C.componentType].BYTES_PER_ELEMENT,O=ro._malloc(k);r.GetAttributeDataArrayForAllPoints(u,A,ro[R],k,O),C1(ro.memory.buffer.slice(O,O+k),C,e),ro._free(O)}r.destroy(),u.destroy(),delete t.extensions[by]}const Lm="EXT_meshopt_compression";function QI(t,e){if(!t.extensions||!t.extensions[Lm])return;const i=t.extensions[Lm],r=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),l=new Uint8Array(i.count*i.byteStride);vy.decodeGltfBuffer(l,i.count,i.byteStride,r,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=l.buffer,delete t.extensions[Lm]}const P1=1179937895,D1=new TextDecoder("utf8");function L1(t,e){return new URL(t,e).href}function eC(t,e,i,r){return fetch(L1(t.uri,r)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[i]=l})}function R1(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function tC(t,e,i,r){if(t.uri){const l=L1(t.uri,r);return fetch(l).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[i]=u})}if(t.bufferView!==void 0){const l=R1(e,t.bufferView),u=new Blob([l],{type:t.mimeType});return createImageBitmap(u).then(p=>{e.images[i]=p})}}function z1(t,e=0,i){const r={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===P1){const M=new Uint32Array(t,e);let A=2;const C=(M[A++]>>2)-3,R=M[A++]>>2;if(A++,r.json=JSON.parse(D1.decode(M.subarray(A,A+R))),A+=R,A<C){const k=M[A++];A++;const O=e+(A<<2);r.buffers[0]=t.slice(O,O+k)}}else r.json=JSON.parse(D1.decode(new Uint8Array(t,e)));const{buffers:l,images:u,meshes:p,extensionsUsed:g,bufferViews:v}=r.json;let b=Promise.resolve();if(l){const M=[];for(let A=0;A<l.length;A++){const C=l[A];C.uri?M.push(eC(C,r,A,i)):r.buffers[A]||(r.buffers[A]=null)}b=Promise.all(M)}return b.then(()=>{const M=[],A=g&&g.includes(by),C=g&&g.includes(Lm);if(A&&M.push(function(){if(!ro)return Pm||(Pm=function(R){let k,O=null;function V(){k=new Uint8Array(O.buffer)}function j(){throw new Error("Unexpected Draco error.")}const K={a:{a:j,d:function(ee,Q,oe){return k.copyWithin(ee,Q,Q+oe)},c:function(ee){const Q=k.length,oe=Math.max(ee>>>0,Math.ceil(1.2*Q)),se=Math.ceil((oe-Q)/65536);try{return O.grow(se),V(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,K):R.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,K))).then(ee=>{const{Rb:Q,Qb:oe,P:se,T:he,X:me,Ja:xe,La:Ee,Qa:ve,Va:ke,Wa:Ge,eb:Re,jb:je,f:Ce,e:Ue,yb:ot,zb:qe,Ab:It,Bb:bt,Db:Ye,Gb:Xt}=ee.instance.exports;O=Ue;const Ft=(()=>{let At=0,Ke=0,$t=0,fi=0;return Yt=>{$t&&(Q(fi),Q(At),Ke+=$t,$t=At=0),At||(Ke+=128,At=oe(Ke));const pi=Yt.length+7&-8;let ti=At;pi>=Ke&&($t=pi,ti=fi=oe(pi));for(let Si=0;Si<Yt.length;Si++)k[ti+Si]=Yt[Si];return ti}})();return V(),Ce(),{memory:Ue,_free:Q,_malloc:oe,Mesh:class{constructor(){this.ptr=se()}destroy(){he(this.ptr)}},Decoder:class{constructor(){this.ptr=xe()}destroy(){je(this.ptr)}DecodeArrayToMesh(At,Ke,$t){const fi=Ft(At),Yt=Ee(this.ptr,fi,Ke,$t.ptr);return!!me(Yt)}GetAttributeByUniqueId(At,Ke){return{ptr:ve(this.ptr,At.ptr,Ke)}}GetTrianglesUInt16Array(At,Ke,$t){ke(this.ptr,At.ptr,Ke,$t)}GetTrianglesUInt32Array(At,Ke,$t){Ge(this.ptr,At.ptr,Ke,$t)}GetAttributeDataArrayForAllPoints(At,Ke,$t,fi,Yt){Re(this.ptr,At.ptr,Ke.ptr,$t,fi,Yt)}},DT_INT8:ot(),DT_UINT8:qe(),DT_INT16:It(),DT_UINT16:bt(),DT_UINT32:Ye(),DT_FLOAT32:Xt()}})}(fetch(A1())),Pm.then(R=>{ro=R,Pm=void 0}))}()),C&&M.push(function(){if(vy)return;const R=function(k){let O;const V=WebAssembly.instantiateStreaming(k,{}).then(ee=>{O=ee.instance,O.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},K={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(ee,Q,oe,se,he,me){(function(xe,Ee,ve,ke,Ge,Re,je){const Ce=xe.exports.sbrk,Ue=ke+3&-4,ot=Ce(Ue*Ge),qe=Ce(Re.length),It=new Uint8Array(xe.exports.memory.buffer);It.set(Re,qe);const bt=Ee(ot,ke,Ge,qe,Re.length);if(bt===0&&je&&je(ot,Ue,Ge),ve.set(It.subarray(ot,ot+ke*Ge)),Ce(ot-Ce(0)),bt!==0)throw new Error(`Malformed buffer data: ${bt}`)})(O,O.exports[K[he]],ee,Q,oe,se,O.exports[j[me]])}}}(fetch(I1()));return R.ready.then(()=>{vy=R})}()),u)for(let R=0;R<u.length;R++)M.push(tC(u[R],r,R,i));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(A&&p)for(const{primitives:R}of p)for(const k of R)JI(k,r);if(C&&p&&v)for(const R of v)QI(R,r);return r})})}class k1{constructor(e,i,r){if(this.triangleCount=i.length/3,this.min=new $e(0,0),this.max=new $e(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||r===0)return;const l=e.map(M=>M.x),u=e.map(M=>M.y);this.min=new $e(Math.min(...l),Math.min(...u)),this.max=new $e(Math.max(...l),Math.max(...u));const p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);const g=Math.max(p.x,p.y)/r;this.cellsX=Math.max(1,Math.ceil(p.x/g)),this.cellsY=Math.max(1,Math.ceil(p.y/g)),this.xScale=1/g,this.yScale=1/g;const v=[];for(let M=0;M<this.triangleCount;M++){const A=e[i[3*M+0]].sub(this.min),C=e[i[3*M+1]].sub(this.min),R=e[i[3*M+2]].sub(this.min),k=nl(Math.floor(Math.min(A.x,C.x,R.x)),this.xScale,this.cellsX),O=nl(Math.floor(Math.max(A.x,C.x,R.x)),this.xScale,this.cellsX),V=nl(Math.floor(Math.min(A.y,C.y,R.y)),this.yScale,this.cellsY),j=nl(Math.floor(Math.max(A.y,C.y,R.y)),this.yScale,this.cellsY),K=new $e(0,0),ee=new $e(0,0),Q=new $e(0,0),oe=new $e(0,0);for(let se=V;se<=j;++se){K.y=ee.y=se*g,Q.y=oe.y=(se+1)*g;for(let he=k;he<=O;++he)K.x=Q.x=he*g,ee.x=oe.x=(he+1)*g,(_g(A,C,R,K,ee,oe)||_g(A,C,R,K,oe,Q))&&v.push({cellIdx:se*this.cellsX+he,triIdx:M})}}if(v.length===0)return;v.sort((M,A)=>M.cellIdx-A.cellIdx||M.triIdx-A.triIdx);let b=0;for(;b<v.length;){const M=v[b].cellIdx,A={start:this.payload.length,len:0};for(;b<v.length&&v[b].cellIdx===M;)++A.len,this.payload.push(v[b++].triIdx);this.cells[M]=A}}query(e,i,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let v=0;v<this.lookup.length;v++)this.lookup[v]=0;const l=nl(e.x-this.min.x,this.xScale,this.cellsX),u=nl(i.x-this.min.x,this.xScale,this.cellsX),p=nl(e.y-this.min.y,this.yScale,this.cellsY),g=nl(i.y-this.min.y,this.yScale,this.cellsY);for(let v=p;v<=g;v++)for(let b=l;b<=u;b++){const M=this.cells[v*this.cellsX+b];if(M)for(let A=0;A<M.len;A++){const C=this.payload[M.start+A],R=Math.floor(C/8),k=1<<C%8;if(!(this.lookup[R]&k)&&(this.lookup[R]|=k,r.push(C),r.length===this.triangleCount))return}}}}function nl(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function _c(t,e){const i=t.json.bufferViews[e.bufferView],r=Dm[e.componentType];return new r(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Yd[e.type]*r.BYTES_PER_ELEMENT?i.byteStride/r.BYTES_PER_ELEMENT:Yd[e.type]))}function wy(t,e,i,r){const l=Dm[e.componentType],u=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),p=t.json.bufferViews[e.bufferView],g=p.byteStride?p.byteStride/l.BYTES_PER_ELEMENT:Yd[e.type],v=i.float32,b=v.length/i.capacity;for(let M=0,A=0;M<e.count*g;M+=g,A+=b)for(let C=0;C<b;C++)v[A+C]=r[M+C]*u;i._trim()}function iC(t,e,i){const r=t.indices,l=t.attributes,u={};u.indexArray=new Qn;const p=e.json.accessors[r],g=p.count/3;u.indexArray.reserve(g);const v=_c(e,p);for(let C=0;C<g;C++)u.indexArray.emplaceBack(v[3*C],v[3*C+1],v[3*C+2]);u.indexArray._trim(),u.vertexArray=new oa;const b=e.json.accessors[l.POSITION];u.vertexArray.reserve(b.count);const M=_c(e,b);for(let C=0;C<b.count;C++)u.vertexArray.emplaceBack(M[3*C],M[3*C+1],M[3*C+2]);if(u.vertexArray._trim(),u.aabb=new An(b.min,b.max),u.centroid=function(C,R){const k=[0,0,0],O=C.length;if(O>0){for(let V=0;V<O;V++){const j=3*C[V];k[0]+=R[j],k[1]+=R[j+1],k[2]+=R[j+2]}k[0]/=O,k[1]/=O,k[2]/=O}return k}(v,M),l.COLOR_0!==void 0){const C=e.json.accessors[l.COLOR_0],R=Yd[C.type],k=_c(e,C);u.colorArray=R===3?new oa:new Co,u.colorArray.resize(C.count),wy(e,C,u.colorArray,k)}if(l.NORMAL!==void 0){u.normalArray=new oa;const C=e.json.accessors[l.NORMAL];u.normalArray.resize(C.count);const R=_c(e,C);wy(e,C,u.normalArray,R)}if(l.TEXCOORD_0!==void 0&&i.length>0){u.texcoordArray=new nc;const C=e.json.accessors[l.TEXCOORD_0];u.texcoordArray.resize(C.count);const R=_c(e,C);wy(e,C,u.texcoordArray,R)}if(l._FEATURE_ID_RGBA4444!==void 0){const C=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=_c(e,C))}l._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(_c(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const A=t.material;return u.material=function(C,R){const{emissiveFactor:k=[0,0,0],alphaMode:O="OPAQUE",alphaCutoff:V=.5,normalTexture:j,occlusionTexture:K,emissiveTexture:ee,doubleSided:Q}=C,{baseColorFactor:oe=[1,1,1,1],metallicFactor:se=1,roughnessFactor:he=1,baseColorTexture:me,metallicRoughnessTexture:xe}=C.pbrMetallicRoughness||{},Ee=K?R[K.index]:void 0;if(K&&K.extensions&&K.extensions.KHR_texture_transform&&Ee){const ve=K.extensions.KHR_texture_transform;Ee.offsetScale=[ve.offset[0],ve.offset[1],ve.scale[0],ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Nn(...oe),metallicFactor:se,roughnessFactor:he,baseColorTexture:me?R[me.index]:void 0,metallicRoughnessTexture:xe?R[xe.index]:void 0},doubleSided:Q,emissiveFactor:k,alphaMode:O,alphaCutoff:V,normalTexture:j?R[j.index]:void 0,occlusionTexture:Ee,emissionTexture:ee?R[ee.index]:void 0,defined:C.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},i),u}function O1(t,e,i){const{matrix:r,rotation:l,translation:u,scale:p,mesh:g,extras:v,children:b}=t,M={};if(M.matrix=r||s.a6.fromRotationTranslationScale([],l||[0,0,0,1],u||[0,0,0],p||[1,1,1]),g!==void 0){M.meshes=i[g];const A=M.anchor=[0,0];for(const C of M.meshes){const{min:R,max:k}=C.aabb;A[0]+=R[0]+k[0],A[1]+=R[1]+k[1]}A[0]=Math.floor(A[0]/M.meshes.length/2),A[1]=Math.floor(A[1]/M.meshes.length/2)}if(v&&(v.id&&(M.id=v.id),v.lights&&(M.lights=function(A){if(!A.length)return[];const C=function(j){const K=atob(j),ee=new Uint8Array(K.length);for(let Q=0;Q<K.length;Q++)ee[Q]=K.codePointAt(Q);return ee}(A),R=[],k=C.length/24,O=new Uint16Array(C.buffer),V=new Float32Array(C.buffer);for(let j=0;j<k;j++){const K=O[2*j*6]/30,ee=O[2*j*6+1]/30,Q=O[2*j*6+10]/100,oe=V[6*j+1],se=V[6*j+2],he=V[6*j+3],me=V[6*j+4],xe=he-oe,Ee=me-se,ve=Math.hypot(xe,Ee);R.push({pos:[oe+.5*xe,se+.5*Ee,ee],normal:[Ee/ve,-xe/ve,0],width:ve,height:K,depth:Q,points:[oe,se,he,me]})}return R}(v.lights))),b){const A=[];for(const C of b)A.push(O1(e.json.nodes[C],e,i));M.children=A}return M}function nC(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let p=1;p<t.vertices.length;++p){const g=t.vertices[p];e.x=Math.min(e.x,g.x),e.y=Math.min(e.y,g.y),i.x=Math.max(i.x,g.x),i.y=Math.max(i.y,g.y)}const r=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),l=Math.max(8,r),u=new k1(t.vertices,t.indices,l);return{vertices:t.vertices,indices:t.indices,grid:u,min:e,max:i}}function rC(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const r=[];for(const p of i){if(!Array.isArray(p)||p.length!==2)continue;const g=p[0],v=p[1];typeof g=="number"&&typeof v=="number"&&r.push(new $e(g,v))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let l=0;for(let p=0;p<r.length;p++){const g=r[p],v=r[(p+1)%r.length],b=r[(p+2)%r.length];l+=(g.x-v.x)*(b.y-v.y)-(b.x-v.x)*(g.y-v.y)}l>0&&r.reverse();const u=Qp(r.flatMap(p=>[p.x,p.y]),[]);return u.length===0?null:{vertices:r,indices:u}}function sC(t){const e=[],i=[];let r=0;for(const l of t){r=e.length;const u=l.vertexArray.float32,p=l.indexArray.uint16;for(let g=0;g<l.vertexArray.length;g++)e.push(new $e(u[3*g+0],u[3*g+1]));for(let g=0;g<3*l.indexArray.length;g++)i.push(p[g]+r)}if(i.length%3!=0)return null;for(let l=0;l<i.length;l+=3){const u=e[i[l+0]],p=e[i[l+1]],g=e[i[l+2]];(u.x-p.x)*(g.y-p.y)-(g.x-p.x)*(u.y-p.y)>0&&([i[l+1],i[l+2]]=[i[l+2],i[l+1]])}return{vertices:e,indices:i}}function F1(t){const e=function(v,b){const M=[],A=WebGL2RenderingContext;if(v.json.textures)for(const C of v.json.textures){const R={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};C.sampler!==void 0&&Object.assign(R,v.json.samplers[C.sampler]),M.push({image:b[C.source],sampler:R,uploaded:!1})}return M}(t,t.images),i=function(v,b){const M=[];for(const A of v.json.meshes){const C=[];for(const R of A.primitives)C.push(iC(R,v,b));M.push(C)}return M}(t,e),{scenes:r,scene:l,nodes:u}=t.json,p=r?r[l||0].nodes:u,g=[];for(const v of p)g.push(O1(u[v],t,i));return function(v,b,M){const A={},C=new Set;for(let R=0;R<v.length;R++){const k=M[b[R]];if(!k.extras)continue;const O=k.extras["mapbox:footprint:version"],V=k.extras["mapbox:footprint:id"];(O||V)&&C.add(R),O==="1.0.0"&&V&&(A[V]=R)}for(let R=0;R<v.length;R++){if(C.has(R))continue;const k=v[R],O=M[b[R]];if(!O.extras)continue;let V=null;k.id in A&&(V=sC(v[A[k.id]].meshes)),V||(V=rC(O)),V&&(k.footprint=nC(V))}if(C.size>0){const R=Array.from(C.values()).sort((k,O)=>k-O);for(let k=R.length-1;k>=0;k--)v.splice(R[k],1)}}(g,p,t.json.nodes),g}function oC(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,r=t.aabb.min[1]-1,l=mc/(t.aabb.max[0]-i+2),u=mc/(t.aabb.max[1]-r+2);for(let p=0;p<e.length;p+=3){const g=e[p+2],v=(e[p+0]-i)*l|0,b=(e[p+1]-r)*u|0;g>t.heightmap[b*mc+v]&&(t.heightmap[b*mc+v]=g)}}function aC(t,e){const i={};i.indexArray=new Qn,i.indexArray.reserve(4*t.length),i.vertexArray=new oa,i.vertexArray.reserve(10*t.length),i.colorArray=new Co,i.vertexArray.reserve(10*t.length);let r=0;for(const p of t){const g=Math.min(10,Math.max(4,1.3*p.height))*e,v=[-p.normal[1],p.normal[0],0],b=Math.min(.29,.1*p.width/p.depth),M=p.width-2*p.depth*e*(b+.01),A=s.N.scaleAndAdd([],p.pos,v,M/2),C=s.N.scaleAndAdd([],p.pos,v,-M/2),R=[A[0],A[1],A[2]+p.height],k=[C[0],C[1],C[2]+p.height],O=s.N.scaleAndAdd([],p.normal,v,b);s.N.scale(O,O,g);const V=s.N.scaleAndAdd([],p.normal,v,-b);s.N.scale(V,V,g),s.N.add(O,A,O),s.N.add(V,C,V),A[2]+=.1,C[2]+=.1,i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]);const j=M/g/2;i.colorArray.emplaceBack(-j-b,-1,j,.8),i.colorArray.emplaceBack(j+b,-1,j,.8),i.colorArray.emplaceBack(-j,0,j,1.3),i.colorArray.emplaceBack(j,0,j,1.3),i.colorArray.emplaceBack(j+b,-.8,j,.7),i.colorArray.emplaceBack(j+b,-.8,j,.7),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(j+b,-1.2,j,.8),i.colorArray.emplaceBack(j+b,-1.2,j,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const l={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Nn.white,l.pbrMetallicRoughness=u,i.material=l,i.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Mt(k1,"TriangleGridIndex");class B1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const lC=["tile","layer","source","sourceLayer","state"];class N1{constructor(e,i,r,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of lC)this[i]!==void 0&&(e[i]=this[i]);return e}}class V1{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Xs(yt,16,0),this.featureIndexArray=new Dp,this.promoteId=i,this.is3DTile=!1}insert(e,i,r,l,u,p=0,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,l,u,p);const b=this.grid;for(let M=0;M<i.length;M++){const A=i[M],C=[1/0,1/0,-1/0,-1/0];for(let R=0;R<A.length;R++){const k=A[R];C[0]=Math.min(C[0],k.x),C[1]=Math.min(C[1],k.y),C[2]=Math.max(C[2],k.x),C[3]=Math.max(C[3],k.y)}g!==0&&(C[0]-=g,C[1]-=g,C[2]+=g,C[3]+=g),C[0]<yt&&C[1]<yt&&C[2]>=0&&C[3]>=0&&b.insert(v,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Xg(new Lu(this.rawTileData)).layers,this.sourceLayerCoder=new B1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,l){this.loadVTLayers();const u=e.params||{},p=Yr(u.filter),g=e.tileResult,v=e.transform,b=g.bufferedTilespaceBounds,M=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(k,O,V,j)=>ax(g.bufferedTilespaceGeometry,k,O,V,j));M.sort(cC);let A=null;v.elevation&&M.length>0&&(A=Au.create(v.elevation,this.tileID));const C={};let R;for(let k=0;k<M.length;k++){const O=M[k];if(O===R)continue;R=O;const V=this.featureIndexArray.get(O);let j=null;if(this.is3DTile){const K=this.bucketLayerIDs[0][0],ee=i[K];if(ee.type!=="model")continue;const{queryFeature:Q,intersectionZ:oe}=ee.queryIntersectsMatchingFeature(g,V.featureIndex,p,v);Q&&this.appendToResult(C,K,V.featureIndex,Q,oe)}else this.loadMatchingFeature(C,V,p,u.layers,u.availableImages,i,r,l,(K,ee,Q,oe=0)=>(j||(j=tr(K,this.tileID.canonical,e.tileTransform)),ee.queryIntersectsFeature(g,K,Q,j,this.z,e.transform,e.pixelPosMatrix,A,oe)))}return C}loadMatchingFeature(e,i,r,l,u,p,g,v,b){const{featureIndex:M,bucketIndex:A,sourceLayerIndex:C,layoutVertexArrayOffset:R}=i,k=this.bucketLayerIDs[A];if(l&&!function(K,ee){for(let Q=0;Q<K.length;Q++)if(ee.indexOf(K[Q])>=0)return!0;return!1}(l,k))return;const O=this.sourceLayerCoder.decode(C),V=this.vtLayers[O].feature(M);if(r.needGeometry){const K=qn(V,!0);if(!r.filter(new bn(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!r.filter(new bn(this.tileID.overscaledZ),V))return;const j=this.getId(V,O);for(let K=0;K<k.length;K++){const ee=k[K];if(l&&l.indexOf(ee)<0)continue;const Q=p[ee];if(!Q)continue;let oe={};j!==void 0&&v&&(oe=v.getState(Q.sourceLayer||"_geojsonTileLayer",j));const se=!b||b(V,Q,oe,R);if(!se)continue;const he=new N1(V,this.z,this.x,this.y,j),me=Qi({},g[ee]);me.paint=U1(me.paint,Q.paint,V,oe,u),me.layout=U1(me.layout,Q.layout,V,oe,u),he.layer=me,this.appendToResult(e,ee,M,he,se)}}appendToResult(e,i,r,l,u){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:r,feature:l,intersectionZ:u})}lookupSymbolFeatures(e,i,r,l,u,p,g,v){const b={};this.loadVTLayers();const M=Yr(u);for(const A of e)this.loadMatchingFeature(b,{bucketIndex:r,sourceLayerIndex:l,featureIndex:A,layoutVertexArrayOffset:0},M,p,g,v,i);return b}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(r),u=this.vtFeatures[l];if(u[i])return u[i];const p=this.vtLayers[l].feature(i);return u[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];l!=null&&(r=e.properties[l]),typeof r=="boolean"&&(r=Number(r))}return r}}function U1(t,e,i,r,l){return Fn(t,(u,p)=>{const g=e instanceof ql?e.get(p):null;return g&&g.evaluate?g.evaluate(i,r,l):g})}function cC(t,e){return e-t}Mt(V1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Ty=new Float32Array(262144),gc=new Uint8Array(262144);function j1(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,j1(i));return e}function G1(t,e,i){if(t.meshes)for(const r of t.meshes)r.aabb.min[0]!==1/0&&i.insert(e,r.aabb.min[0],r.aabb.min[1],r.aabb.max[0],r.aabb.max[1]);if(t.children)for(const r of t.children)G1(r,e,i)}const $1=["","wall","door","roof","window","lamp","logo"];class q1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:j1(e)}}}getLocalBounds(){if(!this.node.meshes)return new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==e&&i.encapsulate(r.aabb),e++;this.aabb=i}return this.aabb}}class Rm{constructor(e,i,r,l,u,p){this.id=i,this.modelTraits|=Fu.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=Fu.HasMapboxMeshFeatures),l&&(this.modelTraits|=Fu.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const g of e)this.nodesInfo.push(new q1(g)),G1(g,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const r of i){const l=r.node;this.uploaded?this.updatePbrBuffer(l):_y(l,e,!0)}for(const r of i)Im(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),i=!0);return i}needsReEvaluation(e,i,r){const l=e.transform.projectionOptions,u=e.style.getBrightness(),p=this.brightness!==u;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||Kd(r.paint.get("model-color").value,p)||Kd(r.paint.get("model-color-mix-intensity").value,p)||Kd(r.paint.get("model-roughness").value,p)||Kd(r.paint.get("model-emissive-strength").value,p)||Kd(r.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=l,this.brightness=u,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),l=this.id.canonical;for(const u of r){const p=u.feature;u.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},l)}}evaluate(e){const i=this.getNodesInfo();for(const r of i){if(!r.node.meshes)continue;const l=r.feature,u=r.node.meshes&&r.node.meshes[0].featureData,p=r.evaluatedColor[2],g=r.evaluatedRMEA[2],v=this.id.canonical;if(r.hasTranslucentParts=!1,u){for(let b=0;b<$1.length;b++){const M=$1[b];M.length&&(l.properties.part=M);const A=e.paint.get("model-color").evaluate(l,{},v),C=e.paint.get("model-color-mix-intensity").evaluate(l,{},v);r.evaluatedColor[b]=[A.r,A.g,A.b,C],r.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(l,{},v),r.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(l,{},v),r.evaluatedRMEA[b][3]=A.a,r.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},v),!r.hasTranslucentParts&&A.a<1&&(r.hasTranslucentParts=!0)}delete l.properties.part,hC(r,p!==r.evaluatedColor[2]||g!==r.evaluatedRMEA[2],this.modelTraits)}else r.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,{},v);r.evaluatedScale=e.paint.get("model-scale").evaluate(l,{},v),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,r,l){const u=e.findDEMTileFor(r);if(u&&(u.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const p=Au.create(e,r,u);if(!p)return;this.modelTraits&Fu.HasMapboxMeshFeatures&&this.updateDEM(e,p,r,l);for(const g of this.getNodesInfo()){const v=g.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;const b=v.footprint.vertices;let M=p.getElevationAt(b[0].x,b[0].y,!0,!0);for(let A=1;A<b.length;A++)M=Math.min(M,p.getElevationAt(b[A].x,b[A].y,!0,!0));v.elevation=M}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,r,l){let u=i._dem._modifiedForSources[l];if(u===void 0&&(i._dem._modifiedForSources[l]=[],u=i._dem._modifiedForSources[l]),u.includes(r.canonical))return;const p=i._dem.dim;u.push(r.canonical);let g=!1;for(const v of this.getNodesInfo()){const b=v.node;if(!b.footprint||!b.footprint.grid)continue;const M=b.footprint.grid,A=i.tileCoordToPixel(M.min.x,M.min.y),C=i.tileCoordToPixel(M.max.x,M.max.y),R=Math.min(Math.min(p-C.y,A.x),Math.min(A.y,p-C.x));if(R<0)continue;const k=kt(R,2,5);let O=Math.max(0,A.x-k),V=Math.max(0,A.y-k),j=Math.min(C.x+k,p-1),K=Math.min(C.y+k,p-1);for(let se=V;se<=K;++se)for(let he=O;he<=j;++he)gc[se*p+he]=255;let ee=0,Q=0;for(let se=0;se<M.cellsY;++se)for(let he=0;he<M.cellsX;++he){if(!M.cells[se*M.cellsX+he])continue;const me=i.tileCoordToPixel(M.min.x+he/M.xScale,M.min.y+se/M.yScale),xe=i.tileCoordToPixel(M.min.x+(he+1)/M.xScale,M.min.y+(se+1)/M.yScale);for(let Ee=me.y;Ee<=Math.min(xe.y+1,p-1);++Ee)for(let ve=me.x;ve<=Math.min(xe.x+1,p-1);++ve)gc[Ee*p+ve]===255&&(gc[Ee*p+ve]=0,ee+=i.getElevationAtPixel(ve,Ee),Q++)}const oe=ee/Q;O=Math.max(1,A.x-k),V=Math.max(1,A.y-k),j=Math.min(C.x+k,p-2),K=Math.min(C.y+k,p-2),g=!0;for(let se=V;se<=K;++se)for(let he=O;he<=j;++he)gc[se*p+he]===0&&(Ty[se*p+he]=i._dem.set(he,se,oe));for(let se=1;se<k;++se){O=Math.max(1,A.x-se),V=Math.max(1,A.y-se),j=Math.min(C.x+se,p-2),K=Math.min(C.y+se,p-2);for(let he=V;he<=K;++he)for(let me=O;me<=j;++me){const xe=he*p+me;if(gc[xe]===255){let Ee=0,ve=0,ke=-1,Ge=-1;for(let Re=-1;Re<=1;++Re)for(let je=-1;je<=1;++je){const Ce=(he+Re)*p+me+je;if(gc[Ce]>=se)continue;const Ue=Ty[Ce],ot=Math.abs(Ue);ot>ve&&(Ee=Ue,ve=ot,ke=je,Ge=Re)}if(ve>.1){const Re=1-(se+.5*Math.abs(ke*Ge))/k;let je=i._dem.get(me,he)+Ee*Re;const Ce=i._dem.get(me+ke,he+Ge),Ue=i._dem.get(me-ke,he-Ge,!0);(je-Ce)*(je-Ue)>0&&(je=(Ce+Ue)/2),Ty[xe]=i._dem.set(me,he,je),gc[xe]=se}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Je.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Im(i.node),gy(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const p=l[u].node;l[u].hiddenByReplacement=!!p.footprint&&!r.find(g=>g.footprint===p.footprint)}}getHeightAtTileCoord(e,i){const r=this.getNodesInfo(),l=[];for(let u=0;u<this.nodesInfo.length;u++){const p=r[u],g=p.node.meshes[0];if(e<g.aabb.min[0]||i<g.aabb.min[1]||e>g.aabb.max[0]||i>g.aabb.max[1])continue;const v=(e-g.aabb.min[0])/(g.aabb.max[0]-g.aabb.min[0])*mc|0,b=Math.min(63,(i-g.aabb.min[1])/(g.aabb.max[1]-g.aabb.min[1])*mc|0)*mc+Math.min(63,v);if(!(g.heightmap[b]<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:g.heightmap[b],maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new $e(e,i),new $e(e,i),l),l.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function Kd(t,e){return!t.isLightConstant&&e}function uC(t,e,i,r,l,u,p,g){let v=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(v=Mi(v,255*i[0],i[3]),b=Mi(b,255*i[1],i[3]),M=Mi(M,255*i[2],i[3]));const A=v<<8|b,C=M<<8|Math.floor(255*r[3]),R=function(se){const he=kt(se,0,2);return Math.min(Math.round(.5*he*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],k=kt(l[0],0,1),O=kt(l[1],0,1),V=kt(l[2],0,1),j=kt(l[3],0,1);let K,ee,Q,oe;if(k!==O&&p!==u&&O!==k){const se=p-u;ee=1/(se*(O-k)),Q=-(u+se*k)/(se*(O-k));const he=kt(l[4],-1,1);oe=Math.pow(10,he),K=255*V<<8|255*j}else K=65535,ee=0,Q=1,oe=1;if(t.emplaceBack(A,C,R,K,ee,Q,oe),g){const se=g.length;g.clear();for(let he=0;he<se;he++)g.emplaceBack(A,C,R,K,ee,Q,oe)}}function hC(t,e,i){const r=t.node;let l=0;const u=i&Fu.HasMeshoptCompression;for(const p of r.meshes){if(r.lights&&r.lightMeshIndex===l||!p.featureData)continue;p.featureArray=new rc,p.featureArray.reserve(p.featureData.length);let g=e;for(const v of p.featureData){const b=u?65535&v:v>>16&65535,M=u?v>>16&65535:65535&v,A=(15&M)<8?15&M:0,C=t.evaluatedRMEA[A],R=t.evaluatedColor[A],k=t.emissionHeightBasedParams[A];let O;if(g&&A===2&&r.lights&&(O=new rc,O.resize(10*r.lights.length)),uC(p.featureArray,b,R,C,k,p.aabb.min[2],p.aabb.max[2],O),O&&g){g=!1;const V=r.meshes[r.lightMeshIndex];V.featureArray=O,V.featureArray._trim()}}p.featureArray._trim(),l++}}function H1(t,e,i,r){const l=1<<t.z;e.lat=Ai((r/yt+t.y)/l),e.lng=ni((i/yt+t.x)/l)}Mt(Rm,"Tiled3dModelBucket",{omit:["layers"]}),Mt(q1,"Tiled3dModelFeature");const dC={circle:class extends Nr{constructor(t,e,i){super(t,rE,e,i)}createBucket(t){return new jr(t)}queryRadius(t){const e=t;return Mu("circle-radius",this,e)+Mu("circle-stroke-width",this,e)+Vp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,l,u,p,g){const v=cx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ov(t,r,u,p,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=kv(this);return{config:new N(this,e),defines:i,overrideFog:!1}}},heatmap:class extends Nr{createBucket(t){return new Bv(t)}constructor(t,e,i){super(t,kE,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Mu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,l,u,p,g){const v=this.paint.get("heatmap-radius").evaluate(e,i);return Ov(t,r,u,p,g,!0,!0,new $e(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new N(this,e),overrideFog:!1}:{}}},hillshade:class extends Nr{constructor(t,e,i){super(t,FE,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Nr{constructor(t,e,i){super(t,KE,e,i)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new N(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Zg(t)}queryRadius(){return Vp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,l,u){return!t.queryGeometry.isAboveHorizon&&aa(lx(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Nr{constructor(t,e,i){super(t,SA,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new om(t)}queryRadius(){return Vp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,r,l,u,p,g,v){const b=cx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),A=this.paint.get("fill-extrusion-base").evaluate(e,i),C=[0,0],R=g&&u.elevation,k=u.elevation?u.elevation.exaggeration():1,O=t.tile.getBucket(this);if(R&&O instanceof om){const Q=O.centroidVertexArray,oe=v+1;oe<Q.length&&(C[0]=Q.geta_centroid_pos0(oe),C[1]=Q.geta_centroid_pos1(oe))}if(C[0]===0&&C[1]===1)return!1;u.projection.name==="globe"&&(r=xb([r],[new $e(0,0),new $e(yt,yt)],t.tileID.canonical).map(Q=>Q.polygon).flat());const V=R?g:null,[j,K]=function(Q,oe,se,he,me,xe,Ee,ve,ke,Ge,Re){return Q.projection.name==="globe"?function(je,Ce,Ue,ot,qe,It,bt,Ye,Xt,Ft,At){const Ke=[],$t=[],fi=je.projection.upVectorScale(At,je.center.lat,je.worldSize).metersToTile,Yt=[0,0,0,1],pi=[0,0,0,1],ti=(si,nn,ki,Fi)=>{si[0]=nn,si[1]=ki,si[2]=Fi,si[3]=1},Si=yb();Ue>0&&(Ue+=Si),ot+=Si;for(const si of Ce){const nn=[],ki=[];for(const Fi of si){const $i=Fi.x+qe.x,Oi=Fi.y+qe.y,vn=je.projection.projectTilePoint($i,Oi,At),Xi=je.projection.upVector(At,Fi.x,Fi.y);let Pn=Ue,Xn=ot;if(bt){const gr=bb($i,Oi,Ue,ot,bt,Ye,Xt,Ft);Pn+=gr.base,Xn+=gr.top}Ue!==0?ti(Yt,vn.x+Xi[0]*fi*Pn,vn.y+Xi[1]*fi*Pn,vn.z+Xi[2]*fi*Pn):ti(Yt,vn.x,vn.y,vn.z),ti(pi,vn.x+Xi[0]*fi*Xn,vn.y+Xi[1]*fi*Xn,vn.z+Xi[2]*fi*Xn),s.N.transformMat4(Yt,Yt,It),s.N.transformMat4(pi,pi,It),nn.push(new Iu(Yt[0],Yt[1],Yt[2])),ki.push(new Iu(pi[0],pi[1],pi[2]))}Ke.push(nn),$t.push(ki)}return[Ke,$t]}(Q,oe,se,he,me,xe,Ee,ve,ke,Ge,Re):Ee?function(je,Ce,Ue,ot,qe,It,bt,Ye,Xt){const Ft=[],At=[],Ke=[0,0,0,1];for(const $t of je){const fi=[],Yt=[];for(const pi of $t){const ti=pi.x+ot.x,Si=pi.y+ot.y,si=bb(ti,Si,Ce,Ue,It,bt,Ye,Xt);Ke[0]=ti,Ke[1]=Si,Ke[2]=si.base,Ke[3]=1,s.a7.transformMat4(Ke,Ke,qe),Ke[3]=Math.max(Ke[3],1e-5);const nn=new Iu(Ke[0]/Ke[3],Ke[1]/Ke[3],Ke[2]/Ke[3]);Ke[0]=ti,Ke[1]=Si,Ke[2]=si.top,Ke[3]=1,s.a7.transformMat4(Ke,Ke,qe),Ke[3]=Math.max(Ke[3],1e-5);const ki=new Iu(Ke[0]/Ke[3],Ke[1]/Ke[3],Ke[2]/Ke[3]);fi.push(nn),Yt.push(ki)}Ft.push(fi),At.push(Yt)}return[Ft,At]}(oe,se,he,me,xe,Ee,ve,ke,Ge):function(je,Ce,Ue,ot,qe){const It=[],bt=[],Ye=qe[8]*Ce,Xt=qe[9]*Ce,Ft=qe[10]*Ce,At=qe[11]*Ce,Ke=qe[8]*Ue,$t=qe[9]*Ue,fi=qe[10]*Ue,Yt=qe[11]*Ue;for(const pi of je){const ti=[],Si=[];for(const si of pi){const nn=si.x+ot.x,ki=si.y+ot.y,Fi=qe[0]*nn+qe[4]*ki+qe[12],$i=qe[1]*nn+qe[5]*ki+qe[13],Oi=qe[2]*nn+qe[6]*ki+qe[14],vn=qe[3]*nn+qe[7]*ki+qe[15],Xi=Fi+Ye,Pn=$i+Xt,Xn=Oi+Ft,gr=Math.max(vn+At,1e-5),gn=Fi+Ke,Sn=$i+$t,ar=Oi+fi,lr=Math.max(vn+Yt,1e-5);ti.push(new Iu(Xi/gr,Pn/gr,Xn/gr)),Si.push(new Iu(gn/lr,Sn/lr,ar/lr))}It.push(ti),bt.push(Si)}return[It,bt]}(oe,se,he,me,xe)}(u,r,A,M,b,p,V,C,k,u.center.lat,t.tileID.canonical),ee=t.queryGeometry;return function(Q,oe,se){let he=1/0;aa(se,oe)&&(he=vb(se,oe[0]));for(let me=0;me<oe.length;me++){const xe=oe[me],Ee=Q[me];for(let ve=0;ve<xe.length-1;ve++){const ke=xe[ve],Ge=[ke,xe[ve+1],Ee[ve+1],Ee[ve],ke];Vs(se,Ge)&&(he=Math.min(he,vb(se,Ge)))}}return he!==1/0&&he}(j,K,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends Nr{constructor(t,e,i){super(t,Tb,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ol,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Cb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Kg(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=Ab(this);return{config:new N(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=Pb(Mu("line-width",this,e),Mu("line-gap-width",this,e)),r=Mu("line-offset",this,e);return i/2+Math.abs(r)+Vp(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,l,u){if(t.queryGeometry.isAboveHorizon)return!1;const p=lx(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*Pb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),v=this.paint.get("line-offset").evaluate(e,i);return v&&(r=function(b,M){const A=[],C=new $e(0,0);for(let R=0;R<b.length;R++){const k=b[R],O=[];for(let V=0;V<k.length;V++){const j=k[V],K=k[V+1],ee=V===0?C:j.sub(k[V-1])._unit()._perp(),Q=V===k.length-1?C:K.sub(j)._unit()._perp(),oe=ee._add(Q)._unit();oe._mult(1/(oe.x*Q.x+oe.y*Q.y)),O.push(oe._mult(M)._add(j))}A.push(O)}return A}(r,v*t.pixelToTileUnitsFactor)),function(b,M,A){for(let C=0;C<M.length;C++){const R=M[C];if(b.length>=3){for(let k=0;k<R.length;k++)if(Qs(b,R[k]))return!0}if(cc(b,R,A))return!0}return!1}(p,r,g)}isTileClipped(){return!0}},symbol:wm,background:class extends Nr{constructor(t,e,i){super(t,II,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:m1,"raster-particle":_1,sky:class extends Nr{constructor(t,e,i){super(t,OI,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Pd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),l=!r,u=t.style.light,p=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&be("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?fy(p.azimuthal,90-p.polar,e):fy(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return fy(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Nr{constructor(t,e,i){super(t,FI,e)}},model:class extends Nr{constructor(t,e,i){super(t,HI,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new my(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Rm?yt-1:0}queryIntersectsFeature(t,e,i,r,l,u){if(!this.modelManager)return!1;const p=this.modelManager,g=t.tile.getBucket(this);if(!(g&&g instanceof my))return!1;const v=g;for(const b in v.instancesPerModel){const M=v.instancesPerModel[b];if(M.idToFeaturesIndex.hasOwnProperty(e.id)){const A=M.features[M.idToFeaturesIndex[e.id]],C=p.getModel(b,this.scope);if(!C)return!1;let R=s.a6.create();const k=new ye(0,0),O=v.canonical;let V=Number.MAX_VALUE;for(let j=0;j<A.instancedDataCount;++j){const K=16*(A.instancedDataOffset+j),ee=M.instancedDataArray.float32,Q=[ee[K+4],ee[K+5],ee[K+6]];H1(O,k,ee[K],0|ee[K+1]),S1(R,C,u,k,A.rotation,A.scale,Q,!1,!1,!1),u.projection.name==="globe"&&(R=py(R,u));const oe=s.a6.multiply([],u.projMatrix,R),se=t.queryGeometry,he=w1(se.isPointQuery()?se.screenBounds:se.screenGeometry,u,oe,C.aabb);he!=null&&(V=Math.min(he,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ul}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,r){const l=t.tile,u=l.getBucket(this);let p=null,g=Number.MAX_VALUE;if(!(u&&u instanceof Rm))return{queryFeature:p,intersectionZ:g};const v=u.getNodesInfo()[e];if(v.hiddenByReplacement||!v.node.meshes||!i.filter(new bn(l.tileID.overscaledZ),v.feature,l.tileID.canonical))return{queryFeature:p,intersectionZ:g};const b=v.node,M=r.calculatePosMatrix(l.tileID.toUnwrapped(),r.worldSize),A=v.evaluatedScale;let C=0;r.elevation&&b.elevation&&(C=b.elevation*r.elevation.exaggeration()),s.a6.translate(M,M,[(b.anchor?b.anchor[0]:0)*(A[0]-1),(b.anchor?b.anchor[1]:0)*(A[1]-1),C]),s.a6.scale(M,M,A),s.a6.multiply(M,M,b.matrix);const R=t.queryGeometry,k=R.isPointQuery()?R.screenBounds:R.screenGeometry,O=function(j){const K=s.a6.multiply([],M,j.matrix),ee=s.a6.multiply(K,r.expandedFarZProjMatrix,K);for(let Q=0;Q<j.meshes.length;++Q){const oe=j.meshes[Q];if(Q===j.lightMeshIndex)continue;const se=w1(k,r,ee,oe.aabb);se!=null&&(g=Math.min(se,g))}if(j.children)for(const Q of j.children)O(Q)};if(O(b),g===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:g};const V=new ye(0,0);return H1(l.tileID.canonical,V,v.node.anchor[0],v.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[V.lng,V.lat]},properties:v.feature.properties,id:v.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:g}}}},ai={read:function(t,e){return t.readFields(ai._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(ai.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};ai.Filter.read=function(t,e){return t.readFields(ai.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},ai.Filter._readField=function(t,e,i){t===1?(e.delta_filter=ai.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=ai.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=ai.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=ai.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},ai.Filter.Delta={},ai.Filter.Delta.read=function(t,e){return t.readFields(ai.Filter.Delta._readField,{block_size:0},e)},ai.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},ai.Filter.Zigzag={},ai.Filter.Zigzag.read=function(t,e){return t.readFields(ai.Filter.Zigzag._readField,{},e)},ai.Filter.Zigzag._readField=function(t,e,i){},ai.Filter.BitShuffle={},ai.Filter.BitShuffle.read=function(t,e){return t.readFields(ai.Filter.BitShuffle._readField,{},e)},ai.Filter.BitShuffle._readField=function(t,e,i){},ai.Filter.ByteShuffle={},ai.Filter.ByteShuffle.read=function(t,e){return t.readFields(ai.Filter.ByteShuffle._readField,{},e)},ai.Filter.ByteShuffle._readField=function(t,e,i){},ai.Codec={},ai.Codec.read=function(t,e){return t.readFields(ai.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},ai.Codec._readField=function(t,e,i){t===1?(e.gzip_data=ai.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=ai.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=ai.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=ai.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},ai.Codec.GzipData={},ai.Codec.GzipData.read=function(t,e){return t.readFields(ai.Codec.GzipData._readField,{},e)},ai.Codec.GzipData._readField=function(t,e,i){},ai.Codec.JpegImage={},ai.Codec.JpegImage.read=function(t,e){return t.readFields(ai.Codec.JpegImage._readField,{},e)},ai.Codec.JpegImage._readField=function(t,e,i){},ai.Codec.WebpImage={},ai.Codec.WebpImage.read=function(t,e){return t.readFields(ai.Codec.WebpImage._readField,{},e)},ai.Codec.WebpImage._readField=function(t,e,i){},ai.Codec.PngImage={},ai.Codec.PngImage.read=function(t,e){return t.readFields(ai.Codec.PngImage._readField,{},e)},ai.Codec.PngImage._readField=function(t,e,i){},ai.DataIndexEntry={},ai.DataIndexEntry.read=function(t,e){return t.readFields(ai.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},ai.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(ai.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=ai.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},ai.Layer={},ai.Layer.read=function(t,e){return t.readFields(ai.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},ai.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(ai.DataIndexEntry.read(i,i.readVarint()+i.pos))};const so={read:function(t,e){return t.readFields(so._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=so.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=so.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};so.Uint32Values.read=function(t,e){return t.readFields(so.Uint32Values._readField,{values:[]},e)},so.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(r){if(r.type!==2)throw new Error(`Unsupported pbf type "${r.type}"`);const l=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(r),u=r.pos;return r.pos=l,function(p){r.pos=u;let g=0;for(;r.pos<l;){const v=r.readVarint();p[g++]=v}return p}}(i))},so.Fixed32Values={},so.Fixed32Values.read=function(t,e){return t.readFields(so.Fixed32Values._readField,{values:[]},e)},so.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.5
 */class fC{constructor(e=0,i=0,r=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=r,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){const i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){const r=this.items[e];this.ttl>0&&r.expiry<=Date.now()?this.delete(e):(i=r.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){const e=[];let i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,r=!1,l=this.resetTtl){let u;if(r||this.has(e)){if(u=this.items[e],u.value=i,r===!1&&l&&(u.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==u){const p=this.last,g=u.next,v=u.prev;this.first===u&&(this.first=u.next),u.next=null,u.prev=this.last,p.next=u,v!==null&&(v.next=g),g!==null&&(g.prev=v)}}else this.max>0&&this.size===this.max&&this.evict(!0),u=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=u:this.last.next=u;return this.last=u,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function pC(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let r=2;r>=1;r--){const l=r===1?1:0,u=r===2?1:0;for(let p=0;p<e[0];p++){const g=e[1]*p;for(let v=l;v<e[1];v++){const b=e[2]*(v+g);for(let M=u;M<e[2];M++){const A=e[3]*(M+b);for(let C=0;C<e[3];C++){const R=A+C;t[R]+=t[R-i]}}}}i*=e[r]}return t}function mC(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function _C(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){const r=t[i],l=t[i+1];t[i]=(240&r)>>4|(61440&r)>>8|(240&l)<<4|61440&l,t[i+1]=15&r|(3840&r)>>4|(15&l)<<8|(3840&l)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){const r=t[i],l=t[i+1],u=t[i+2],p=t[i+3];t[i+0]=(192&r)>>6|(192&l)>>4|(192&u)>>2|192&p,t[i+1]=(48&r)>>4|(48&l)>>2|48&u|(48&p)<<2,t[i+2]=(12&r)>>2|12&l|(12&u)<<2|(12&p)<<4,t[i+3]=3&r|(3&l)<<2|(3&u)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class rl extends Error{constructor(e){super(e),this.name="MRTError"}}var Ds=Uint8Array,Jd=Uint16Array,gC=Int32Array,W1=new Ds([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Z1=new Ds([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yC=new Ds([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),X1=function(t,e){for(var i=new Jd(31),r=0;r<31;++r)i[r]=e+=1<<t[r-1];var l=new gC(i[30]);for(r=1;r<30;++r)for(var u=i[r];u<i[r+1];++u)l[u]=u-i[r]<<5|r;return{b:i,r:l}},Y1=X1(W1,2),K1=Y1.b,xC=Y1.r;K1[28]=258,xC[258]=28;for(var vC=X1(Z1,0).b,J1=new Jd(32768),Vn=0;Vn<32768;++Vn){var Uu=(43690&Vn)>>1|(21845&Vn)<<1;J1[Vn]=((65280&(Uu=(61680&(Uu=(52428&Uu)>>2|(13107&Uu)<<2))>>4|(3855&Uu)<<4))>>8|(255&Uu)<<8)>>1}var Qd=function(t,e,i){for(var r=t.length,l=0,u=new Jd(e);l<r;++l)t[l]&&++u[t[l]-1];var p,g=new Jd(e);for(l=1;l<e;++l)g[l]=g[l-1]+u[l-1]<<1;{p=new Jd(1<<e);var v=15-e;for(l=0;l<r;++l)if(t[l])for(var b=l<<4|t[l],M=e-t[l],A=g[t[l]-1]++<<M,C=A|(1<<M)-1;A<=C;++A)p[J1[A]>>v]=b}return p},ef=new Ds(288);for(Vn=0;Vn<144;++Vn)ef[Vn]=8;for(Vn=144;Vn<256;++Vn)ef[Vn]=9;for(Vn=256;Vn<280;++Vn)ef[Vn]=7;for(Vn=280;Vn<288;++Vn)ef[Vn]=8;var Q1=new Ds(32);for(Vn=0;Vn<32;++Vn)Q1[Vn]=5;var bC=Qd(ef,9),wC=Qd(Q1,5),My=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},oo=function(t,e,i){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&i},Sy=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},TC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ao=function(t,e,i){var r=new Error(e||TC[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,ao),!i)throw r;return r},MC=new Ds(0),SC=typeof TextDecoder<"u"&&new TextDecoder;try{SC.decode(MC,{stream:!0})}catch{}const EC={gzip_data:"gzip"},AC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},IC={uint32:1,uint16:2,uint8:4},CC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class ew{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const i=new Uint8Array(e),r=new DataView(e);if(i[0]!==13)throw new rl("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),r=this.getHeaderLength(e);if(i.length<r)throw new rl(`Expected header with length >= ${r} but got buffer of length ${i.length}`);const l=new Lu(i.subarray(0,r)),u=ai.read(l);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new rl(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new PC(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],r=this.getLayer(e.layerName);for(let l=0;l<r.dataIndex.length;l++){const u=r.dataIndex[l],p=u.first_byte-e.firstByte,g=u.last_byte+1-e.firstByte;if(l<e.firstBlock||l>e.lastBlock||r._blocksInProgress.has(l))continue;const v={layerName:r.name,firstByte:p,lastByte:g,pixelFormat:r.pixelFormat,blockIndex:l,blockShape:[u.bands.length].concat(r.bandShape),buffer:r.buffer,codec:u.codec.codec,filters:u.filters.map(b=>b.filter)};r._blocksInProgress.add(l),i.push(v)}return new tw(i,()=>{i.forEach(l=>r._blocksInProgress.delete(l.blockIndex))},(l,u)=>{if(i.forEach(p=>r._blocksInProgress.delete(p.blockIndex)),l)throw l;u.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class PC{constructor({version:e,name:i,units:r,tilesize:l,pixel_format:u,buffer:p,data_index:g},v){if(this.version=e,this.version!==1)throw new rl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=r,this.tileSize=l,this.buffer=p,this.pixelFormat=AC[u],this.dataIndex=g,this.bandShape=[l+2*p,l+2*p,IC[this.pixelFormat]],this._decodedBlocks=function(b=1e3,M=0,A=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(M)||M<0)throw new TypeError("Invalid ttl value");if(typeof A!="boolean")throw new TypeError("Invalid resetTtl value");return new fC(b,M,A)}(v?v.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[r,l]of this.dataIndex.entries()){for(const[u,p]of l.bands.entries())if(p===e)return{bandIndex:i+u,blockIndex:r,blockBandIndex:u};i+=l.bands.length}break;case"number":for(const[r,l]of this.dataIndex.entries()){if(e>=i&&e<i+l.bands.length)return{bandIndex:e,blockIndex:r,blockBandIndex:e-i};i+=l.bands.length}break;default:throw new rl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new rl(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,r=-1/0,l=1/0,u=-1/0;for(const p of e){const{blockIndex:g}=this.getBlockForBand(p);if(g<0)throw new rl(`Invalid band: ${JSON.stringify(p)}`);const v=this.dataIndex[g];l=Math.min(l,g),u=Math.max(u,g),i=Math.min(i,v.first_byte),r=Math.max(r,v.last_byte)}return{layerName:this.name,firstByte:i,lastByte:r,firstBlock:l,lastBlock:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:r}=this.getBlockForBand(e),l=this._decodedBlocks.get(i.toString());if(!l)throw new rl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[i],p=this.bandShape.reduce((b,M)=>b*M,1),g=r*p,v=l.subarray(g,g+p);return{data:v,bytes:new Uint8Array(v.buffer).subarray(v.byteOffset,v.byteOffset+v.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:u.offset,scale:u.scale}}}class tw{constructor(e,i,r){this.tasks=e,this._onCancel=i,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}ew.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{const{layerName:r,firstByte:l,lastByte:u,pixelFormat:p,blockShape:g,blockIndex:v,filters:b,codec:M}=i,A=new Uint8Array(t).subarray(l,u+1),C=new Uint32Array(g[0]*g[1]*g[2]);let R;if(M!=="gzip_data")throw new Error(`Unhandled codec: ${M}`);return R=function(k,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((ee=function(se){se[0]==31&&se[1]==139&&se[2]==8||ao(6,"invalid gzip data");var he=se[3],me=10;4&he&&(me+=2+(se[10]|se[11]<<8));for(var xe=(he>>3&1)+(he>>4&1);xe>0;xe-=!se[me++]);return me+(2&he)}(K=k))+8>K.length&&ao(6,"invalid gzip data"),function(se,he,me,xe){var Ee=se.length;if(!Ee||he.f&&!he.l)return me||new Ds(0);var ve=!me,ke=ve||he.i!=2,Ge=he.i;ve&&(me=new Ds(3*Ee));var Re=function(Gr){var cs=me.length;if(Gr>cs){var Ls=new Ds(Math.max(2*cs,Gr));Ls.set(me),me=Ls}},je=he.f||0,Ce=he.p||0,Ue=he.b||0,ot=he.l,qe=he.d,It=he.m,bt=he.n,Ye=8*Ee;do{if(!ot){je=oo(se,Ce,1);var Xt=oo(se,Ce+1,3);if(Ce+=3,!Xt){var Ft=se[(ki=4+((Ce+7)/8|0))-4]|se[ki-3]<<8,At=ki+Ft;if(At>Ee){Ge&&ao(0);break}ke&&Re(Ue+Ft),me.set(se.subarray(ki,At),Ue),he.b=Ue+=Ft,he.p=Ce=8*At,he.f=je;continue}if(Xt==1)ot=bC,qe=wC,It=9,bt=5;else if(Xt==2){var Ke=oo(se,Ce,31)+257,$t=oo(se,Ce+10,15)+4,fi=Ke+oo(se,Ce+5,31)+1;Ce+=14;for(var Yt=new Ds(fi),pi=new Ds(19),ti=0;ti<$t;++ti)pi[yC[ti]]=oo(se,Ce+3*ti,7);Ce+=3*$t;var Si=My(pi),si=(1<<Si)-1,nn=Qd(pi,Si);for(ti=0;ti<fi;){var ki,Fi=nn[oo(se,Ce,si)];if(Ce+=15&Fi,(ki=Fi>>4)<16)Yt[ti++]=ki;else{var $i=0,Oi=0;for(ki==16?(Oi=3+oo(se,Ce,3),Ce+=2,$i=Yt[ti-1]):ki==17?(Oi=3+oo(se,Ce,7),Ce+=3):ki==18&&(Oi=11+oo(se,Ce,127),Ce+=7);Oi--;)Yt[ti++]=$i}}var vn=Yt.subarray(0,Ke),Xi=Yt.subarray(Ke);It=My(vn),bt=My(Xi),ot=Qd(vn,It),qe=Qd(Xi,bt)}else ao(1);if(Ce>Ye){Ge&&ao(0);break}}ke&&Re(Ue+131072);for(var Pn=(1<<It)-1,Xn=(1<<bt)-1,gr=Ce;;gr=Ce){var gn=($i=ot[Sy(se,Ce)&Pn])>>4;if((Ce+=15&$i)>Ye){Ge&&ao(0);break}if($i||ao(2),gn<256)me[Ue++]=gn;else{if(gn==256){gr=Ce,ot=null;break}var Sn=gn-254;gn>264&&(Sn=oo(se,Ce,(1<<(cr=W1[ti=gn-257]))-1)+K1[ti],Ce+=cr);var ar=qe[Sy(se,Ce)&Xn],lr=ar>>4;if(ar||ao(3),Ce+=15&ar,Xi=vC[lr],lr>3){var cr=Z1[lr];Xi+=Sy(se,Ce)&(1<<cr)-1,Ce+=cr}if(Ce>Ye){Ge&&ao(0);break}ke&&Re(Ue+131072);var cn=Ue+Sn;if(Ue<Xi){var ls=0-Xi,sl=Math.min(Xi,cn);for(ls+Ue<0&&ao(3);Ue<sl;++Ue)me[Ue]=xe[ls+Ue]}for(;Ue<cn;++Ue)me[Ue]=me[Ue-Xi]}}he.l=ot,he.p=gr,he.b=Ue,he.f=je,ot&&(je=1,he.m=It,he.d=qe,he.n=bt)}while(!je);return Ue!=me.length&&ve?function(Gr,cs,Ls){return(Ls==null||Ls>Gr.length)&&(Ls=Gr.length),new Ds(Gr.subarray(cs,Ls))}(me,0,Ue):me.subarray(0,Ue)}(K.subarray(ee,-8),{i:2},new Ds(((V=K)[(j=V.length)-4]|V[j-3]<<8|V[j-2]<<16|V[j-1]<<24)>>>0),void 0)));var V,j,K,ee;const Q=EC[O];if(!Q)throw new Error(`Unhandled codec: ${O}`);const oe=new globalThis.DecompressionStream(Q);return new Response(new Blob([k]).stream().pipeThrough(oe)).arrayBuffer().then(se=>new Uint8Array(se))}(A,M).then(k=>{const O=so.read(new Lu(k));if(O.values==="uint32_values")return O.uint32_values.readValuesInto(C),new CC[p](C.buffer);throw new Error(`Unhandled numeric data "${O.values}"`)}),R.then(k=>{for(let O=b.length-1;O>=0;O--)switch(b[O]){case"delta_filter":pC(k,g);break;case"zigzag_filter":mC(k);break;case"bitshuffle_filter":_C(k,p);break;default:throw new Error(`Unhandled filter "${b[O]}"`)}return{layerName:r,blockIndex:v,data:k}}).catch(k=>{throw k})}))},Mt(tw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const iw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ey{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,r]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=r>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const u=iw[15&r];if(!u)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Ey(g,p,u,e)}constructor(e,i=64,r=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=iw.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-g%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${r}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+g+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=i,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Ay(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:g}=this,v=[0,u.length-1,0],b=[];for(;v.length;){const M=v.pop()||0,A=v.pop()||0,C=v.pop()||0;if(A-C<=g){for(let V=C;V<=A;V++){const j=p[2*V],K=p[2*V+1];j>=e&&j<=r&&K>=i&&K<=l&&b.push(u[V])}continue}const R=C+A>>1,k=p[2*R],O=p[2*R+1];k>=e&&k<=r&&O>=i&&O<=l&&b.push(u[R]),(M===0?e<=k:i<=O)&&(v.push(C),v.push(R-1),v.push(1-M)),(M===0?r>=k:l>=O)&&(v.push(R+1),v.push(A),v.push(1-M))}return b}within(e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:u,nodeSize:p}=this,g=[0,l.length-1,0],v=[],b=r*r;for(;g.length;){const M=g.pop()||0,A=g.pop()||0,C=g.pop()||0;if(A-C<=p){for(let V=C;V<=A;V++)rw(u[2*V],u[2*V+1],e,i)<=b&&v.push(l[V]);continue}const R=C+A>>1,k=u[2*R],O=u[2*R+1];rw(k,O,e,i)<=b&&v.push(l[R]),(M===0?e-r<=k:i-r<=O)&&(g.push(C),g.push(R-1),g.push(1-M)),(M===0?e+r>=k:i+r>=O)&&(g.push(R+1),g.push(A),g.push(1-M))}return v}}function Ay(t,e,i,r,l,u){if(l-r<=i)return;const p=r+l>>1;nw(t,e,p,r,l,u),Ay(t,e,i,r,p-1,1-u),Ay(t,e,i,p+1,l,1-u)}function nw(t,e,i,r,l,u){for(;l>r;){if(l-r>600){const b=l-r+1,M=i-r+1,A=Math.log(b),C=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*C*(b-C)/b)*(M-b/2<0?-1:1);nw(t,e,i,Math.max(r,Math.floor(i-M*C/b+R)),Math.min(l,Math.floor(i+(b-M)*C/b+R)),u)}const p=e[2*i+u];let g=r,v=l;for(tf(t,e,r,i),e[2*l+u]>p&&tf(t,e,r,l);g<v;){for(tf(t,e,g,v),g++,v--;e[2*g+u]<p;)g++;for(;e[2*v+u]>p;)v--}e[2*r+u]===p?tf(t,e,r,v):(v++,tf(t,e,v,l)),v<=i&&(r=v+1),i<=v&&(l=v-1)}}function tf(t,e,i,r){Iy(t,i,r),Iy(e,2*i,2*r),Iy(e,2*i+1,2*r+1)}function Iy(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function rw(t,e,i,r){const l=t-i,u=e-r;return l*l+u*u}s.$=o1,s.A=lu,s.B=Zh,s.C=Ei,s.D=Te,s.E=Ta,s.F=wn,s.G=rt,s.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ut(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Mi(t.x,e.x,i),y:Mi(t.y,e.y,i),z:Mi(t.z,e.z,i),azimuthal:Mi(t.azimuthal,e.azimuthal,i),polar:Mi(t.polar,e.polar,i)}}},s.I=ny,s.J=Ys,s.K=bn,s.L=Di,s.M=class{constructor(t,e,i,r){this.id=t,this.position=e!=null?new ye(e[0],e[1]):new ye(0,0),this.orientation=i??[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(s.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(const i of t.meshes){const r=An.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(r)}if(t.children)for(const i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){const t=s.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,r,l,u,p=!1){S1(this.matrix,this,t.transform,this.position,e,i,r,l,u,p)}upload(t){if(!this.uploaded){for(const e of this.nodes)_y(e,t);for(const e of this.nodes)Im(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)gy(t)}},s.O=rr,s.P=$e,s.Q=ql,s.R=kr,s.S=Xa,s.T=dy,s.U=Mi,s.V=yt,s.W=$f,s.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,r]){const l=ut([1,i,r]);return{x:l.x,y:l.y,z:l.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Mi(t.x,e.x,i),y:Mi(t.y,e.y,i),z:Mi(t.z,e.z,i)}}},s.Y=function(t,e,i=0,r=!0){const l=new $e(i,i),u=t.sub(l),p=e.add(l),g=[u,new $e(p.x,u.y),p,new $e(u.x,p.y)];return r&&g.push(u.clone()),g},s.Z=Ul,s._=function(t,e){const i=[];for(let r=0;r<t.length;r++){const l=Kn(r-1,-1,t.length-1),u=Kn(r+1,-1,t.length-1),p=t[r],g=t[u],v=t[l].sub(p).unit(),b=g.sub(p).unit(),M=b.angleWithSep(v.x,v.y),A=v.add(b).unit().mult(-1*e/Math.sin(M/2));i.push(p.add(A))}return i},s.a=th,s.a$=function(t){const e=[];for(const i in t)e.push(t[i]);return e},s.a0=ax,s.a1=function(t,e,i=0){return s.N.fromValues(((e.x-i)*t.scale-t.x)*yt,(e.y*t.scale-t.y)*yt,rn(e.z,e.y))},s.a2=Lg,s.a3=Mb,s.a4=function(t){let e=1/0,i=1/0,r=-1/0,l=-1/0;for(const u of t)e=Math.min(e,u.x),i=Math.min(i,u.y),r=Math.max(r,u.x),l=Math.max(l,u.y);return{min:new $e(e,i),max:new $e(r,l)}},s.a5=li,s.a8=Qs,s.a9=Vi,s.aA=lp,s.aB=Cn,s.aC=Mr,s.aD=Mp,s.aE=bm,s.aF=function(){Xr.isLoading()||Xr.isLoaded()||Io()!=="deferred"||od()},s.aG=Yr,s.aH=qn,s.aI=N1,s.aJ=Vt,s.aK=Kg,s.aL=Zg,s.aM=tr,s.aN=Es,s.aO=vd,s.aP=Ev,s.aQ=Qp,s.aR=hy,s.aS=function(t,e){const i=Xa(e.zoom);if(i===0)return Oo(t);const r=Hp(t),l=Og(r),u=li(r.getWest())*e.worldSize,p=li(r.getEast())*e.worldSize,g=Jt(r.getNorth())*e.worldSize,v=Jt(r.getSouth())*e.worldSize,b=[u,g,0],M=[p,g,0],A=[u,v,0],C=[p,v,0],R=s.a6.invert([],e.globeMatrix);return s.N.transformMat4(b,b,R),s.N.transformMat4(M,M,R),s.N.transformMat4(A,A,R),s.N.transformMat4(C,C,R),l[0]=da(l[0],A,i),l[1]=da(l[1],C,i),l[2]=da(l[2],M,i),l[3]=da(l[3],b,i),An.fromPoints(l)},s.aT=Zp,s.aU=Cd,s.aV=da,s.aW=Rr,s.aX=SE,s.aY=xs,s.aZ=ew,s.a_=Ve,s.aa=kt,s.ab=J,s.ac=function(t,e){const i={};for(let r=0;r<e.length;r++){const l=e[r];l in t&&(i[l]=t[l])}return i},s.ad=Ie,s.ae=Jt,s.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,r){const l=this.entries[t]=this.entries[t]||{callbacks:[]};if(l.result){const[u,p]=l.result;return this.scheduler?this.scheduler.add(()=>{r(u,p)},e):r(u,p),()=>{}}return l.callbacks.push(r),l.cancel||(l.cancel=i((u,p)=>{l.result=[u,p];for(const g of l.callbacks)this.scheduler?this.scheduler.add(()=>{g(u,p)},e):g(u,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(u=>u!==r),l.callbacks.length||(l.cancel(),delete this.entries[t]))}}},s.ag=dd,s.ah=function(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},l=>{const u=Ve(t.request,(p,g,v,b)=>{p?l(p):g&&l(null,{vectorTile:i?void 0:new Xg(new Lu(g)),rawData:g,cacheControl:v,expires:b})});return()=>{u.cancel(),l()}},e)},s.ai=function(t){qi++,qi>Ct&&(t.getActor().send("enforceCacheSizeLimit",Be),qi=0)},s.aj=jn,s.ak=Ne,s.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.am=tt,s.an=m1,s.ao=_1,s.ap=p1,s.aq=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<t.length;r++){const l=document.createElement("source");et(t[r])||(i.crossOrigin="Anonymous"),l.src=t[r],i.appendChild(l)}return{cancel:()=>{}}},s.ar=Tm,s.as=Ud,s.at=ni,s.au=Ai,s.av=Ks,s.aw=Qn,s.ax=Nn,s.ay=Hi,s.az=oa,s.b=Ho,s.b$=xp,s.b0=function(t,e){const i=[];for(const r in t)r in e||i.push(r);return i},s.b1=Rn,s.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.b3=function(t,e){const{x:i,y:r}=t.point,l=Lv(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return s.a6.multiply(l,l,Fg(Oo(e)))},s.b5=Cu,s.b6=Ps,s.b7=am,s.b8=function(t,e,i,r,l){const u=5*e+2;t.float32[u+0]=i,t.float32[u+1]=r,t.float32[u+2]=l},s.b9=vm,s.bA=Em,s.bB=g1,s.bC=function(t){const e=g1(t,!0);return s.b4.invert([],[e[0],e[1],e[4],e[5]])},s.bD=Rg,s.bE=function(t){const{x:e,y:i}=t.point,{lng:r,lat:l}=t._center;return Lv(e,i,t.worldSize,r,l)},s.bF=sn,s.bG=ie,s.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return xr[e]},s.bI=45,s.bJ=Bt,s.bK=f,s.bL=Lo,s.bM=Np,s.bN=Ar,s.bO=bu,s.bP=h,s.bQ=function(t,e,i){const r=Math.sqrt(t*t+e*e+i*i),l=r>0?Math.acos(i/r)*un:0;let u=t!==0||e!==0?Math.atan2(-e,-t)*un+90:0;return u<0&&(u+=360),[r,u,l]},s.bR=vi,s.bS=An,s.bT=ut,s.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},s.bV=function(t){return t({pluginStatus:Br,pluginURL:Ao}),sd.on("pluginStateChange",t),t},s.bW=Bu,s.bX=Cm,s.bY=zu,s.bZ=ry,s.b_=Bn,s.ba=Xb,s.bb=Vs,s.bc=vr,s.bd=i1,s.be=oy,s.bf=iy,s.bg=Ey,s.bh=Kn,s.bj=Zt,s.bk=re,s.bl=ri,s.bm=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},s.bn=ye,s.bo=h1,s.bp=it,s.bq=zg,s.br=y1,s.bs=Ze,s.bt=Cv,s.bu=function(t,e,i,r,l,u,p,g,v){if(v.name==="globe")return Cv(t,e,new Ze(i,r,l),!1);const b=Ud({z:i,x:r,y:l},v);return new An([(u+b.x/b.scale)*e,e*(b.y/b.scale),p],[(u+b.x2/b.scale)*e,e*(b.y2/b.scale),g])},s.bv=function(t,e,i){let r=0;for(let l=0;l<2;++l){const u=i?i[l]:0;t[l]>u&&(r+=(t[l]-u)*(t[l]-u)),e[l]<u&&(r+=(u-e[l])*(u-e[l]))}return r},s.bw=yi,s.bx=W,s.by=function(t){const e=s.a6.identity(new Float64Array(16));s.a6.multiply(e,t.pixelMatrix,t.globeMatrix);const i=[0,pe,0],r=[0,Se,0];return s.N.transformMat4(i,i,e),s.N.transformMat4(r,r,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Ng(t,new ye(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Ng(t,new ye(t.center.lat,-90))]},s.bz=function(t,e){const{scale:i}=t.tileTransform,r=i*yt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return s.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[r,r])},s.c=F1,s.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.c0=ue,s.c1=Sr,s.c2=function(t,e,i){return t.type==="custom"?new zI(t,e):new dC[t.type](t,e,i)},s.c3=function(t){const e=t.indexOf(pu);return e>=0?t.slice(0,e):t},s.c4=function(t){return t.indexOf(pu)>=0},s.c5=function(t){const e=t.indexOf(pu);return e>=0?t.slice(e+1):""},s.c6=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.c7=Pr,s.c8=sd,s.c9=Fe,s.cA=Ab,s.cB=(t,e,i,r,l,u)=>{const p=t.transform;return{u_matrix:Eb(t,e,i,r),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:Sb(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u}},s.cC=(t,e,i,r,l,u,p)=>{const g=t.transform,v=g.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:Eb(t,e,i,r),u_pixels_to_tile_units:v,u_device_pixel_ratio:u,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:Ib(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Sb(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:i.paint.get("line-emissive-strength")}},s.cD=On,s.cE=Pd,s.cF=yb,s.cG=Pt,s.cH=om,s.cI=Ja,s.cJ=450,s.cK=7,s.cL=DI,s.cM=256,s.cN=Fg,s.cO=Do,s.cP=xd,s.cQ=function(t,e,i,r,l){return kt((t-e)/(i-e)*(l-r)+r,r,l)},s.cR=xi,s.cS=py,s.cT=[1,1,1],s.cU=Au,s.cV=Fu,s.cW=Bs,s.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=Kv(new $e(0,0),new $e(yt,yt),t),i=[];for(const r of this._activeRegions){if(r.hiddenByOverlap||!Yv(e,r))continue;const l=hA(r.min,r.max,t);i.push({min:l.min,max:l.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const r of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(r).buckets[e.layer];if(l)for(const u of l.getNodesInfo()){const p=u.node;p.footprint&&i.push({footprint:p.footprint,id:r.toUnwrapped()})}}return i}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const i of e){if(!i.footprint)continue;const r=Kv(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:r.min,max:r.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||nm(e.min,i.min)||nm(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){const r=this._activeRegions[e],l=this._prevRegions[i];t=r.priority!==l.priority||!Xv(r,l),++e,++i}}if(t){++this._updateTime;const e=i=>{const r=this._activeRegions;if(i>=r.length)return i;const l=r[i].priority;for(;i<r.length&&r[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,r=e(i);for(;i!==r;){let l=i;const u=i;for(;l!==r;){const p=this._activeRegions[l];p.hiddenByOverlap=!1;for(let g=0;g<u;g++){const v=this._activeRegions[g];if(!v.hiddenByOverlap&&Yv(p,v)&&(p.hiddenByOverlap=Qv(p.footprint,p.tileId,v.footprint,v.tileId),p.hiddenByOverlap))break}++l}i=r,r=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},s.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new Es,r=new Qn,l=[],u=t+1+2,p=e[0]+1,g=e[0]+1+(1+e.length),v=(b,M,A)=>{let C=b===u-1?b-2:b===0?b:b-1;return C+=A?24575:0,[C,M]};for(let b=0;b<u;++b)i.emplaceBack(...v(b,0,!0));for(let b=0;b<p;++b)for(let M=0;M<u;++M)i.emplaceBack(...v(M,b,(M===0||M===u-1)&&!0));for(let b=0;b<e.length;++b){const M=e[b];for(let A=0;A<u;++A)i.emplaceBack(...v(A,M,!0))}for(let b=0;b<e.length;++b){const M=r.length,A=e[b]+1+2,C=new Qn;for(let O=0;O<A-1;O++){const V=O===A-2,j=V?u*(g-e.length+b-O):u;for(let K=0;K<u-1;K++){const ee=O*u+K;O===0||V||K===0||K===u-2?(C.emplaceBack(ee+1,ee,ee+j),C.emplaceBack(ee+j,ee+j+1,ee+1)):(r.emplaceBack(ee+1,ee,ee+j),r.emplaceBack(ee+j,ee+j+1,ee+1))}}const R=Cn.simpleSegment(0,M,i.length,r.length-M);for(let O=0;O<C.uint16.length;O+=3)r.emplaceBack(C.uint16[O],C.uint16[O+1],C.uint16[O+2]);const k=Cn.simpleSegment(0,M,i.length,r.length-M);l.push({withoutSkirts:R,withSkirts:k})}return{vertices:i,indices:r,segments:l}}_createGrid(t){const e=this._fillGridMeshWithLods(le,ce);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Ev.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Qn;for(let p=0;p<=le;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Do,r=new Do,l=new Do,u=new Do;this._poleSegments=[];for(let p=0,g=0;p<ie;p++){const v=360/(1<<p);i.emplaceBack(0,-J,0,.5,0),r.emplaceBack(0,-J,0,.5,1),l.emplaceBack(0,-J,0,.5,.5),u.emplaceBack(0,-J,0,.5,.5);for(let b=0;b<=le;b++){let M=b/le,A=0;const C=Mi(0,v,M),[R,k,O]=_e(IE,CE,C,J);i.emplaceBack(R,k,O,M,A),r.emplaceBack(R,k,O,M,1-A);const V=Zt(C);M=.5+.5*Math.sin(V),A=.5+.5*Math.cos(V),l.emplaceBack(R,k,O,M,A),u.emplaceBack(R,k,O,M,1-A)}this._poleSegments.push(Cn.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,$p,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,$p,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,$p,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,$p,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},s.cZ=function(t){return po.has(t)},s.c_=Ri,s.ca=n,s.cb=class extends Js{constructor(t){super(t),this.current=_}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.cc=Qe,s.cd=function(t,e,i){const r=Xa(i.zoom),l=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return r===0&&!l&&!u},s.ce=function(t){const e=t.pixelsPerMeter,i=e/ri(1,t.center.lat),r=s.a6.identity(new Float64Array(16));return s.a6.translate(r,r,[t.point.x,t.point.y,0]),s.a6.scale(r,r,[i,i,e]),Float32Array.from(r)},s.cf=Hp,s.cg=function(t){const e=yi-5;t=kt(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Zt(t))),3);return Math.round(i*(ce.length-1))},s.ch=function(t,e,i,r){const l=e.getNorth(),u=e.getSouth(),p=e.getWest(),g=e.getEast(),v=1<<t.z,b=g-p,M=l-u,A=b/le,C=-M/ce[i],R=[0,A,0,C,0,0,l,p,0];if(t.z>0){const k=180/r;s.co.multiply(R,R,[k/b+1,0,0,0,k/M+1,0,-.5*k/A,.5*k/C,1])}return R[2]=v,R[5]=t.x,R[8]=t.y,R},s.ci=Oo,s.cj=function(t,e,i){const r=s.a6.identity(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return s.a6.rotateY(r,i.globeMatrix,l),Float32Array.from(r)},s.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,l=Math.floor(t.x),u=Math.floor((t.x-l)*r),p=Math.floor(t.y*r),g=this.findDEMTileFor(new tt(i,l,i,u,p));return!(!g||!g.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const l=r.getSource().maxzoom,u=1<<l,p=Math.floor(t.x),g=t.x-p,v=new tt(l,p,l,Math.floor(g*u),Math.floor(t.y*u)),b=this.findDEMTileFor(v);if(!b||!b.dem)return e;const M=b.dem,A=1<<b.tileID.canonical.z,C=(g*A-b.tileID.canonical.x)*M.dim,R=(t.y*A-b.tileID.canonical.y)*M.dim,k=Math.floor(C),O=Math.floor(R);return(i?this.exaggeration():1)*Mi(Mi(M.get(k,O),M.get(k,O+1),R-O),Mi(M.get(k+1,O),M.get(k+1,O+1),R-O),C-k)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new Di(t.wrap+(t.canonical.x+e/yt)/r,(t.canonical.y+i/yt)/r))}getAtTileOffsetFunc(t,e,i,r){return l=>{const u=this.getAtTileOffset(t,l.x,l.y),p=r.upVector(t.canonical,l.x,l.y),g=r.upVectorScale(t.canonical,e,i).metersToTile;return s.N.scale(p,p,u*g),p}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const l=Au.create(this,t,r);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,l=1<<t.canonical.z-r.canonical.z;let u=t.canonical.x/l-r.canonical.x,p=t.canonical.y/l-r.canonical.y,g=0;for(let v=0;v<t.canonical.z-r.canonical.z&&!i.leaves[g];v++){u*=2,p*=2;const b=2*Math.floor(p)+Math.floor(u);g=i.childOffsets[g]+b,u%=1,p%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const l of t){const u=this.getMinMaxForTile(l.tileID);u&&(i=Math.min(i,u.min),r=Math.max(r,u.max),e=!0)}return e?{min:i,max:r}:null}},s.cl=qp,s.cm=Uv,s.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},s.cp=Dv,s.cq=256,s.cr=function(t,e){const i=[0,0,0],r=Zp(Oo(e.canonical));return s.N.transformMat4(i,i,r),s.N.transformMat4(i,i,t),i},s.cs=t=>({u_camera_to_center_distance:new Ar(t),u_extrude_scale:new w(t),u_device_pixel_ratio:new Ar(t),u_matrix:new f(t),u_inv_rot_matrix:new f(t),u_merc_center:new Lo(t),u_tile_id:new Np(t),u_zoom_transition:new Ar(t),u_up_dir:new Np(t),u_emissive_strength:new Ar(t)}),s.ct=t=>({u_matrix:new f(t),u_pixels_to_tile_units:new w(t),u_device_pixel_ratio:new Ar(t),u_units_to_pixels:new Lo(t),u_dash_image:new bu(t),u_gradient_image:new bu(t),u_image_height:new Ar(t),u_texsize:new Lo(t),u_tile_units_to_pixels:new Ar(t),u_alpha_discard_threshold:new Ar(t),u_trim_offset:new Lo(t),u_emissive_strength:new Ar(t)}),s.cu=t=>({u_matrix:new f(t),u_texsize:new Lo(t),u_pixels_to_tile_units:new w(t),u_device_pixel_ratio:new Ar(t),u_image:new bu(t),u_units_to_pixels:new Lo(t),u_tile_units_to_pixels:new Ar(t),u_alpha_discard_threshold:new Ar(t),u_trim_offset:new Lo(t)}),s.cv=gu,s.cw=VA,s.cx=UA,s.cy=kv,s.cz=(t,e,i,r,l,u)=>{const p=t.transform,g=p.projection.name==="globe";let v;if(u.paint.get("circle-pitch-alignment")==="map")if(g){const M=Dv(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;v=Float32Array.from([M,0,0,M])}else v=p.calculatePixelsToTileUnitsMatrix(i);else v=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Je.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:PE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(g){b.u_inv_rot_matrix=r,b.u_merc_center=l,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=Xa(p.zoom);const M=l[0]*yt,A=l[1]*yt;b.u_up_dir=p.projection.upVector(new Ze(0,0,0),M,A)}return b},s.d=_t,s.d0=gi,s.d1=zi,s.d2=ze,s.d3=function([t,e,i]){const r=Math.hypot(t,e,i),l=Math.atan2(t,i),u=.5*Math.PI-Math.acos(-e/r);return new ye(sn(l),sn(u))},s.d4=De,s.d5=Z,s.d6=Ng,s.d7=Rv,s.d8=function(t){const e=[0,0,0],i=s.a6.identity(new Float64Array(16));return s.a6.multiply(i,t.pixelMatrix,t.globeMatrix),s.N.transformMat4(e,e,i),new $e(e[0],e[1])},s.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(Me==null){const r=i.navigator?i.navigator.userAgent:null;Me=!!i.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Me}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dA=no,s.dB=B1,s.dC=V1,s.dD=wb,s.dE=Fn,s.dF=Kb,s.dG=function(t,e,i,r,l,u,p,g,v,b,M){t.createArrays(),t.tilePixelRatio=yt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:K}=t.textSizeData;R.compositeTextSizes=[C["text-size"].possiblyEvaluate(new bn(j),g),C["text-size"].possiblyEvaluate(new bn(K),g)]}if(t.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:K}=t.iconSizeData;R.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new bn(j),g),C["icon-size"].possiblyEvaluate(new bn(K),g)]}R.layoutTextSize=C["text-size"].possiblyEvaluate(new bn(v+1),g),R.layoutIconSize=C["icon-size"].possiblyEvaluate(new bn(v+1),g),R.textMaxSize=C["text-size"].possiblyEvaluate(new bn(18),g);const k=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",O=A.get("text-size");let V=!1;for(const j of t.features)if(j.icon&&j.icon.nameSecondary){V=!0;break}for(const j of t.features){const K=A.get("text-font").evaluate(j,{},g).join(","),ee=O.evaluate(j,{},g),Q=R.layoutTextSize.evaluate(j,{},g),oe=(R.layoutIconSize.evaluate(j,{},g),{horizontal:{},vertical:void 0}),se=j.text;let he,me=[0,0];if(se){const ve=se.toString(),ke=A.get("text-letter-spacing").evaluate(j,{},g)*vr,Ge=A.get("text-line-height").evaluate(j,{},g)*vr,Re=cg(ve)?ke:0,je=A.get("text-anchor").evaluate(j,{},g),Ce=A.get("text-variable-anchor");if(!Ce){const bt=A.get("text-radial-offset").evaluate(j,{},g);me=bt?i1(je,[bt*vr,sy]):A.get("text-offset").evaluate(j,{},g).map(Ye=>Ye*vr)}let Ue=k?"center":A.get("text-justify").evaluate(j,{},g);const ot=A.get("symbol-placement")==="point",qe=ot?A.get("text-max-width").evaluate(j,{},g)*vr:1/0,It=bt=>{t.allowVerticalPlacement&&Eo(ve)&&(oe.vertical=ty(se,e,i,l,K,qe,Ge,je,bt,Re,me,Ps.vertical,!0,Q,ee))};if(!k&&Ce){const bt=Ue==="auto"?Ce.map(Xt=>oy(Xt)):[Ue];let Ye=!1;for(let Xt=0;Xt<bt.length;Xt++){const Ft=bt[Xt];if(!oe.horizontal[Ft])if(Ye)oe.horizontal[Ft]=oe.horizontal[0];else{const At=ty(se,e,i,l,K,qe,Ge,"center",Ft,Re,me,Ps.horizontal,!1,Q,ee);At&&(oe.horizontal[Ft]=At,Ye=At.positionedLines.length===1)}}It("left")}else{if(Ue==="auto"&&(Ue=oy(je)),ot||A.get("text-writing-mode").indexOf("horizontal")>=0||!Eo(ve)){const bt=ty(se,e,i,l,K,qe,Ge,je,Ue,Re,me,Ps.horizontal,!1,Q,ee);bt&&(oe.horizontal[Ue]=bt)}It(ot?"left":Ue)}}let xe=!1;if(j.icon&&j.icon.namePrimary){const ve=r[j.icon.namePrimary];ve&&(he=oI(l[j.icon.namePrimary],j.icon.nameSecondary?l[j.icon.nameSecondary]:void 0,A.get("icon-offset").evaluate(j,{},g),A.get("icon-anchor").evaluate(j,{},g)),xe=ve.sdf,t.sdfIcons===void 0?t.sdfIcons=ve.sdf:t.sdfIcons!==ve.sdf&&be("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ve.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ee=r1(oe.horizontal)||oe.vertical;t.iconsInText||(t.iconsInText=!!Ee&&Ee.iconsInText),(Ee||he)&&fI(t,j,oe,he,r,R,Q,0,me,xe,p,g,b,M,V)}u&&t.generateCollisionDebugBuffers(v,t.collisionBoxArray)},s.dH=Xg,s.dI=Lu,s.dJ=rm,s.dK=gt,s.dL=tm,s.dM=em,s.dN=ui,s.dO=Lb,s.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==P1){const i=new Uint32Array(t,0,7),[,,r,l,u,p]=i;e=i.byteLength+l+u+p+u,(r!==t.byteLength||e>=t.byteLength)&&be("Invalid b3dm header information.")}return z1(t,e)},s.dQ=function(t,e){const i=F1(t);for(const r of i){for(const l of r.meshes)oC(l);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(aC(r.lights,e)))}return i},s.dR=Rm,s.dS=E1,s.dT=Xr,s.dU=function(t){Yi(),ht&&ht.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},s.da=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",st,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ue(t))return t;const i=Kt(t);return i.params.push(`sdk=js-${B}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ue(t))return t;const i=Kt(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!ue(t))return t;const i=Kt(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!ue(t))return t;const l=Kt(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),i&&l.params.push(`language=${i}`),r&&l.params.push(`worldview=${r}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const l=Kt(t);return ue(t)?(l.path=`/styles/v1${l.path}/sprite${e}${i}`,this._makeAPIURL(l,this._customAccessToken||r)):(l.path+=`${e}${i}`,Ti(l))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ue(t))return t;const r=Kt(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&r.authority!=="raster"&&i===512?"@2x":""}${Ui.supported?".webp":"$1"}`),r.authority==="raster"?r.path=`/${Z.RASTER_URL_PREFIX}${r.path}`:r.authority==="rasterarrays"?r.path=`/${Z.RASTERARRAYS_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${Z.TILE_URL_VERSION}${r.path}`);const l=this._customAccessToken||function(u){for(const p of u){const g=p.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(r.params)||Z.ACCESS_TOKEN;return Z.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,l)}canonicalizeTileURL(t,e){const i=Kt(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${Z.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?r+=`rasterarrays/${i.path.replace(`/${Z.RASTERARRAYS_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${Z.TILE_URL_VERSION}/`,"")}`;let l=i.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(r+=`?${l.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&ue(e),r=[];for(const l of t.tiles||[])ae(l)?r.push(this.canonicalizeTileURL(l,i)):r.push(l);return r}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Kt(Z.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,t.protocol==="http"){const l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(r.path!=="/"&&(t.path=`${r.path}${t.path}`),!Z.REQUIRE_ACCESS_TOKEN)return Ti(t);if(e=e||Z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ti(t)}},s.db=function(t,e){e?po.add(t):po.delete(t)},s.dc=Ui,s.dd=vs,s.de=Ml,s.df=vt,s.dg=Ni,s.dh=function(t){po.delete(t)},s.di=fr,s.dj=dr,s.dk=B,s.dl=function(t,e){Be=t,Ct=e},s.dm=function(t,e,i=!1){if(Br===ed||Br===td||Br===id)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ao=Je.resolveURL(t),Br=ed,nd=e,rd(),i||od()},s.dn=Io,s.dp=function(){Cm().acquire(yy)},s.dq=function(){const t=Xd;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(yy),Xd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dr=Zd,s.ds=function(t){const e=hi();if(!e)return;const i=e.delete(Et);t&&i.catch(t).then(()=>t())},s.dt=Wd,s.du=A1,s.dv=function(t){xy=Je.resolveURL(t),Vu||(Vu=new Bu(Cm(),new Ta)),Vu.broadcast("setDracoUrl",xy)},s.dw=I1,s.dx=function(t){Nu=Je.resolveURL(t),Vu||(Vu=new Bu(Cm(),new Ta)),Vu.broadcast("setMeshoptUrl",Nu)},s.dy=Mt,s.dz=Ya,s.e=Qi,s.f=Je,s.g=function(t,e){return Fe(Qi(t,{type:"json"}),e)},s.h=Cs,s.i=Ca,s.j=rh,s.k=au,s.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>z1(e,0,t))},s.m=hp,s.n=Vl,s.o=Wl,s.p=Yb,s.q=hu,s.r=uu,s.s=Xh,s.t=zl,s.u=Hl,s.v=mr,s.w=be,s.x=za,s.z=cd}),E(["./shared"],function(s){function B(Me){const X=Me?Me.url.toString():void 0;return X?performance.getEntriesByName(X):[]}function q(Me){if(typeof Me=="number"||typeof Me=="boolean"||typeof Me=="string"||Me==null)return JSON.stringify(Me);if(Array.isArray(Me)){let re="[";for(const de of Me)re+=`${q(de)},`;return`${re}]`}let X="{";for(const re of Object.keys(Me).sort())X+=`${re}:${q(Me[re])},`;return`${X}}`}function Z(Me){let X="";for(const re of s.b2)X+=`/${q(Me[re])}`;return X}class ae{constructor(X){this.keyCache={},this._layers={},this._layerConfigs={},X&&this.replace(X)}replace(X,re){this._layerConfigs={},this._layers={},this.update(X,[],re)}update(X,re,de){this._options=de;for(const Ne of X)this._layerConfigs[Ne.id]=Ne,(this._layers[Ne.id]=s.c2(Ne,this.scope,this._options)).compileFilter(),this.keyCache[Ne.id]&&delete this.keyCache[Ne.id];for(const Ne of re)delete this.keyCache[Ne],delete this._layerConfigs[Ne],delete this._layers[Ne];this.familiesBySource={};const Pe=function(Ne,Je){const Et={};for(let Ct=0;Ct<Ne.length;Ct++){const ht=Je&&Je[Ne[Ct].id]||Z(Ne[Ct]);Je&&(Je[Ne[Ct].id]=ht);let Tt=Et[ht];Tt||(Tt=Et[ht]=[]),Tt.push(Ne[Ct])}const Be=[];for(const Ct in Et)Be.push(Et[Ct]);return Be}(s.a$(this._layerConfigs),this.keyCache);for(const Ne of Pe){const Je=Ne.map(hi=>this._layers[hi.id]),Et=Je[0];if(Et.visibility==="none")continue;const Be=Et.source||"";let Ct=this.familiesBySource[Be];Ct||(Ct=this.familiesBySource[Be]={});const ht=Et.sourceLayer||"_geojsonTileLayer";let Tt=Ct[ht];Tt||(Tt=Ct[ht]=[]),Tt.push(Je)}}}const ue=1*s.dA;class Le{constructor(X){const re={},de=[];for(const Et in X){const Be=X[Et],Ct=re[Et]={};for(const ht in Be.glyphs){const Tt=Be.glyphs[+ht];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const hi=Tt.metrics.localGlyph?ue:1,Yi={x:0,y:0,w:Tt.bitmap.width+2*hi,h:Tt.bitmap.height+2*hi};de.push(Yi),Ct[ht]=Yi}}const{w:Pe,h:Ne}=s.p(de),Je=new s.dz({width:Pe||1,height:Ne||1});for(const Et in X){const Be=X[Et];for(const Ct in Be.glyphs){const ht=Be.glyphs[+Ct];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const Tt=re[Et][Ct],hi=ht.metrics.localGlyph?ue:1;s.dz.copy(ht.bitmap,Je,{x:0,y:0},{x:Tt.x+hi,y:Tt.y+hi},ht.bitmap)}}this.image=Je,this.positions=re}}s.dy(Le,"GlyphAtlas");class Ae{constructor(X){this.tileID=new s.am(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.scope=X.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.promoteId=X.promoteId,this.isSymbolTile=X.isSymbolTile,this.tileTransform=s.as(X.tileID.canonical,X.projection),this.projection=X.projection,this.brightness=X.brightness,this.extraShadowCaster=!!X.extraShadowCaster}parse(X,re,de,Pe,Ne){this.status="parsing",this.data=X,this.collisionBoxArray=new s.aD;const Je=new s.dB(Object.keys(X.layers).sort()),Et=new s.dC(this.tileID,this.promoteId);Et.bucketLayerIDs=[];const Be={},Ct=new s.dD(256,256),ht={featureIndex:Et,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ct,availableImages:de,brightness:this.brightness},Tt=re.familiesBySource[this.source];for(const Zi in Tt){const an=X.layers[Zi];if(!an)continue;let Jn=!1,hn=!1,Dr=!1;for(const Un of Tt[Zi])Un[0].type==="symbol"?Jn=!0:hn=!0,Un[0].is3D()&&Un[0].type!=="model"&&(Dr=!0);if(this.extraShadowCaster&&!Dr||this.isSymbolTile===!0&&!Jn||this.isSymbolTile===!1&&!hn)continue;an.version===1&&s.w(`Vector tile source "${this.source}" layer "${Zi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Er=Je.encode(Zi),kr=[];for(let Un=0;Un<an.length;Un++){const Bn=an.feature(Un),Fe=Et.getId(Bn,Zi);kr.push({feature:Bn,id:Fe,index:Un,sourceLayerIndex:Er})}for(const Un of Tt[Zi]){const Bn=Un[0];(!this.extraShadowCaster||Bn.is3D()&&Bn.type!=="model")&&(this.isSymbolTile!==void 0&&Bn.type==="symbol"!==this.isSymbolTile||Bn.minzoom&&this.zoom<Math.floor(Bn.minzoom)||Bn.maxzoom&&this.zoom>=Bn.maxzoom||Bn.visibility!=="none"&&(Oe(Un,this.zoom,ht.brightness,de),(Be[Bn.id]=Bn.createBucket({index:Et.bucketLayerIDs.length,layers:Un,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Er,sourceID:this.source,projection:this.projection.spec})).populate(kr,ht,this.tileID.canonical,this.tileTransform),Et.bucketLayerIDs.push(Un.map(Fe=>Fe.id))))}}let hi,Yi,mn,Ki;Ct.trim();const qi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ui=()=>{if(hi)return this.status="done",Ne(hi);if(this.extraShadowCaster)this.status="done",Ne(null,{buckets:s.a$(Be).filter(Zi=>!Zi.isEmpty()),featureIndex:Et,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ht.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yi&&mn&&Ki){const Zi=new Le(Yi),an=new s.dF(mn,Ki);for(const Jn in Be){const hn=Be[Jn];hn instanceof s.aE?(Oe(hn.layers,this.zoom,ht.brightness,de),s.dG(hn,Yi,Zi.positions,mn,an.iconPositions,this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):hn.hasPattern&&(hn instanceof s.aK||hn instanceof s.aL||hn instanceof s.cH)&&(Oe(hn.layers,this.zoom,ht.brightness,de),hn.addFeatures(ht,this.tileID.canonical,an.patternPositions,de,this.tileTransform,this.brightness))}this.status="done",Ne(null,{buckets:s.a$(Be).filter(Jn=>!Jn.isEmpty()),featureIndex:Et,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zi.image,lineAtlas:Ct,imageAtlas:an,brightness:ht.brightness})}};if(!this.extraShadowCaster){const Zi=s.dE(ht.glyphDependencies,hn=>Object.keys(hn).map(Number));Object.keys(Zi).length?Pe.send("getGlyphs",{uid:this.uid,stacks:Zi,scope:this.scope},(hn,Dr)=>{hi||(hi=hn,Yi=Dr,Ui())},void 0,!1,qi):Yi={};const an=Object.keys(ht.iconDependencies);an.length?Pe.send("getImages",{icons:an,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(hn,Dr)=>{hi||(hi=hn,mn=Dr,Ui())},void 0,!1,qi):mn={};const Jn=Object.keys(ht.patternDependencies);Jn.length?Pe.send("getImages",{icons:Jn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(hn,Dr)=>{hi||(hi=hn,Ki=Dr,Ui())},void 0,!1,qi):Ki={}}Ui()}}function Oe(Me,X,re,de){const Pe=new s.K(X,{brightness:re});for(const Ne of Me)Ne.recalculate(Pe,de)}class We extends s.E{constructor(X,re,de,Pe,Ne,Je){super(),this.actor=X,this.layerIndex=re,this.availableImages=de,this.loadVectorData=Ne||s.ah,this.loading={},this.loaded={},this.deduped=new s.af(X.scheduler),this.isSpriteLoaded=Pe,this.scheduler=X.scheduler,this.brightness=Je}loadTile(X,re){const de=X.uid,Pe=X&&X.request,Ne=Pe&&Pe.collectResourceTiming,Je=this.loading[de]=new Ae(X);Je.abort=this.loadVectorData(X,(Et,Be)=>{const Ct=!this.loading[de];if(delete this.loading[de],Ct||Et||!Be)return Je.status="done",Ct||(this.loaded[de]=Je),re(Et);const ht=Be.rawData,Tt={};Be.expires&&(Tt.expires=Be.expires),Be.cacheControl&&(Tt.cacheControl=Be.cacheControl),Je.vectorTile=Be.vectorTile||new s.dH(new s.dI(ht));const hi=()=>{Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,(Yi,mn)=>{if(Yi||!mn)return re(Yi);const Ki={};if(Ne){const qi=B(Pe);qi.length>0&&(Ki.resourceTiming=JSON.parse(JSON.stringify(qi)))}re(null,s.e({rawTileData:ht.slice(0)},mn,Tt,Ki))})};this.isSpriteLoaded?hi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(hi,{type:"parseTile",isSymbolTile:X.isSymbolTile,zoom:X.tileZoom}):hi()}),this.loaded=this.loaded||{},this.loaded[de]=Je})}reloadTile(X,re){const de=this.loaded,Pe=X.uid,Ne=this;if(de&&de[Pe]){const Je=de[Pe];Je.showCollisionBoxes=X.showCollisionBoxes,Je.projection=X.projection,Je.brightness=X.brightness,Je.tileTransform=s.as(X.tileID.canonical,X.projection),Je.extraShadowCaster=X.extraShadowCaster;const Et=(Be,Ct)=>{const ht=Je.reloadCallback;ht&&(delete Je.reloadCallback,Je.parse(Je.vectorTile,Ne.layerIndex,this.availableImages,Ne.actor,ht)),re(Be,Ct)};Je.status==="parsing"?Je.reloadCallback=Et:Je.status==="done"&&(Je.vectorTile?Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,Et):Et())}else re(null,void 0)}abortTile(X,re){const de=X.uid,Pe=this.loading[de];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[de]),re()}removeTile(X,re){const de=this.loaded,Pe=X.uid;de&&de[Pe]&&delete de[Pe],re()}}class ct{loadTile(X,re){const{uid:de,encoding:Pe,rawImageData:Ne,padding:Je}=X,Et=ImageBitmap&&Ne instanceof ImageBitmap?this.getImageData(Ne,Je):Ne;re(null,new s.dJ(de,Et,Pe,Je<1))}getImageData(X,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const de=this.offscreenCanvasContext.getImageData(-re,-re,X.width+2*re,X.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}class gt{decodeRasterArray({task:X,buffer:re},de){s.aZ.performDecoding(re,X).then(Pe=>{de(null,Pe)},Pe=>{de(Pe)})}}function Lt(Me,X){if(Me.length!==0){Rt(Me[0],X);for(var re=1;re<Me.length;re++)Rt(Me[re],!X)}}function Rt(Me,X){for(var re=0,de=0,Pe=0,Ne=Me.length,Je=Ne-1;Pe<Ne;Je=Pe++){var Et=(Me[Pe][0]-Me[Je][0])*(Me[Je][1]+Me[Pe][1]),Be=re+Et;de+=Math.abs(re)>=Math.abs(Et)?re-Be+Et:Et-Be+re,re=Be}re+de>=0!=!!X&&Me.reverse()}var Wt=s.dK(function Me(X,re){var de,Pe=X&&X.type;if(Pe==="FeatureCollection")for(de=0;de<X.features.length;de++)Me(X.features[de],re);else if(Pe==="GeometryCollection")for(de=0;de<X.geometries.length;de++)Me(X.geometries[de],re);else if(Pe==="Feature")Me(X.geometry,re);else if(Pe==="Polygon")Lt(X.coordinates,re);else if(Pe==="MultiPolygon")for(de=0;de<X.coordinates.length;de++)Lt(X.coordinates[de],re);return X});const ui=s.dL.prototype.toGeoJSON;let bi=class{constructor(Me){this._feature=Me,this.extent=s.V,this.type=Me.type,this.properties=Me.tags,"id"in Me&&!isNaN(Me.id)&&(this.id=parseInt(Me.id,10))}loadGeometry(){if(this._feature.type===1){const Me=[];for(const X of this._feature.geometry)Me.push([new s.P(X[0],X[1])]);return Me}{const Me=[];for(const X of this._feature.geometry){const re=[];for(const de of X)re.push(new s.P(de[0],de[1]));Me.push(re)}return Me}}toGeoJSON(Me,X,re){return ui.call(this,Me,X,re)}},$e=class{constructor(Me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.V,this.length=Me.length,this._features=Me}feature(Me){return new bi(this._features[Me])}};var Ji={exports:{}},un=s.dN,Zt=s.dM.VectorTileFeature,sn=xr;function xr(Me,X){this.options=X||{},this.features=Me,this.length=Me.length}function Qe(Me,X){this.id=typeof Me.id=="number"?Me.id:void 0,this.type=Me.type,this.rawGeometry=Me.type===1?[Me.geometry]:Me.geometry,this.properties=Me.tags,this.extent=X||4096}xr.prototype.feature=function(Me){return new Qe(this.features[Me],this.options.extent)},Qe.prototype.loadGeometry=function(){var Me=this.rawGeometry;this.geometry=[];for(var X=0;X<Me.length;X++){for(var re=Me[X],de=[],Pe=0;Pe<re.length;Pe++)de.push(new un(re[Pe][0],re[Pe][1]));this.geometry.push(de)}return this.geometry},Qe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Me=this.geometry,X=1/0,re=-1/0,de=1/0,Pe=-1/0,Ne=0;Ne<Me.length;Ne++)for(var Je=Me[Ne],Et=0;Et<Je.length;Et++){var Be=Je[Et];X=Math.min(X,Be.x),re=Math.max(re,Be.x),de=Math.min(de,Be.y),Pe=Math.max(Pe,Be.y)}return[X,de,re,Pe]},Qe.prototype.toGeoJSON=Zt.prototype.toGeoJSON;var Ri=s.dO,gi=sn;function kt(Me){var X=new Ri;return function(re,de){for(var Pe in re.layers)de.writeMessage(3,rr,re.layers[Pe])}(Me,X),X.finish()}function rr(Me,X){var re;X.writeVarintField(15,Me.version||1),X.writeStringField(1,Me.name||""),X.writeVarintField(5,Me.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<Me.length;re++)de.feature=Me.feature(re),X.writeMessage(2,Kn,de);var Pe=de.keys;for(re=0;re<Pe.length;re++)X.writeStringField(3,Pe[re]);var Ne=de.values;for(re=0;re<Ne.length;re++)X.writeMessage(4,Hr,Ne[re])}function Kn(Me,X){var re=Me.feature;re.id!==void 0&&X.writeVarintField(1,re.id),X.writeMessage(2,Rn,Me),X.writeVarintField(3,re.type),X.writeMessage(4,Mr,re)}function Rn(Me,X){var re=Me.feature,de=Me.keys,Pe=Me.values,Ne=Me.keycache,Je=Me.valuecache;for(var Et in re.properties){var Be=re.properties[Et],Ct=Ne[Et];if(Be!==null){Ct===void 0&&(de.push(Et),Ne[Et]=Ct=de.length-1),X.writeVarint(Ct);var ht=typeof Be;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(Be=JSON.stringify(Be));var Tt=ht+":"+Be,hi=Je[Tt];hi===void 0&&(Pe.push(Be),Je[Tt]=hi=Pe.length-1),X.writeVarint(hi)}}}function Qi(Me,X){return(X<<3)+(7&Me)}function Tr(Me){return Me<<1^Me>>31}function Mr(Me,X){for(var re=Me.loadGeometry(),de=Me.type,Pe=0,Ne=0,Je=re.length,Et=0;Et<Je;Et++){var Be=re[Et],Ct=1;de===1&&(Ct=Be.length),X.writeVarint(Qi(1,Ct));for(var ht=de===3?Be.length-1:Be.length,Tt=0;Tt<ht;Tt++){Tt===1&&de!==1&&X.writeVarint(Qi(2,ht-1));var hi=Be[Tt].x-Pe,Yi=Be[Tt].y-Ne;X.writeVarint(Tr(hi)),X.writeVarint(Tr(Yi)),Pe+=hi,Ne+=Yi}de===3&&X.writeVarint(Qi(7,1))}}function Hr(Me,X){var re=typeof Me;re==="string"?X.writeStringField(1,Me):re==="boolean"?X.writeBooleanField(7,Me):re==="number"&&(Me%1!=0?X.writeDoubleField(3,Me):Me<0?X.writeSVarintField(6,Me):X.writeVarintField(5,Me))}Ji.exports=kt,Ji.exports.fromVectorTileJs=kt,Ji.exports.fromGeojsonVt=function(Me,X){X=X||{};var re={};for(var de in Me)re[de]=new gi(Me[de].features,X),re[de].name=de,re[de].version=X.version,re[de].extent=X.extent;return kt({layers:re})},Ji.exports.GeoJSONWrapper=gi;var On=s.dK(Ji.exports);const Os={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Me=>Me},xs=Math.fround||(is=new Float32Array(1),Me=>(is[0]=+Me,is[0]));var is;const Fn=3,Pr=5,Sr=6;class ge{constructor(X){this.options=Object.assign(Object.create(Os),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:re,minZoom:de,maxZoom:Pe}=this.options;re&&console.time("total time");const Ne=`prepare ${X.length} points`;re&&console.time(Ne),this.points=X;const Je=[];for(let Be=0;Be<X.length;Be++){const Ct=X[Be];if(!Ct.geometry)continue;const[ht,Tt]=Ct.geometry.coordinates,hi=xs(ft(ht)),Yi=xs(ut(Tt));Je.push(hi,Yi,1/0,Be,-1,1),this.options.reduce&&Je.push(0)}let Et=this.trees[Pe+1]=this._createTree(Je);re&&console.timeEnd(Ne);for(let Be=Pe;Be>=de;Be--){const Ct=+Date.now();Et=this.trees[Be]=this._createTree(this._cluster(Et,Be)),re&&console.log("z%d: %d clusters in %dms",Be,Et.numItems,+Date.now()-Ct)}return re&&console.timeEnd("total time"),this}getClusters(X,re){let de=((X[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,X[1]));let Ne=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Je=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)de=-180,Ne=180;else if(de>Ne){const Tt=this.getClusters([de,Pe,180,Je],re),hi=this.getClusters([-180,Pe,Ne,Je],re);return Tt.concat(hi)}const Et=this.trees[this._limitZoom(re)],Be=Et.range(ft(de),ut(Je),ft(Ne),ut(Pe)),Ct=Et.data,ht=[];for(const Tt of Be){const hi=this.stride*Tt;ht.push(Ct[hi+Pr]>1?be(Ct,hi,this.clusterProps):this.points[Ct[hi+Fn]])}return ht}getChildren(X){const re=this._getOriginId(X),de=this._getOriginZoom(X),Pe="No cluster with the specified id.",Ne=this.trees[de];if(!Ne)throw new Error(Pe);const Je=Ne.data;if(re*this.stride>=Je.length)throw new Error(Pe);const Et=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Be=Ne.within(Je[re*this.stride],Je[re*this.stride+1],Et),Ct=[];for(const ht of Be){const Tt=ht*this.stride;Je[Tt+4]===X&&Ct.push(Je[Tt+Pr]>1?be(Je,Tt,this.clusterProps):this.points[Je[Tt+Fn]])}if(Ct.length===0)throw new Error(Pe);return Ct}getLeaves(X,re,de){const Pe=[];return this._appendLeaves(Pe,X,re=re||10,de=de||0,0),Pe}getTile(X,re,de){const Pe=this.trees[this._limitZoom(X)],Ne=Math.pow(2,X),{extent:Je,radius:Et}=this.options,Be=Et/Je,Ct=(de-Be)/Ne,ht=(de+1+Be)/Ne,Tt={features:[]};return this._addTileFeatures(Pe.range((re-Be)/Ne,Ct,(re+1+Be)/Ne,ht),Pe.data,re,de,Ne,Tt),re===0&&this._addTileFeatures(Pe.range(1-Be/Ne,Ct,1,ht),Pe.data,Ne,de,Ne,Tt),re===Ne-1&&this._addTileFeatures(Pe.range(0,Ct,Be/Ne,ht),Pe.data,-1,de,Ne,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(X){let re=this._getOriginZoom(X)-1;for(;re<=this.options.maxZoom;){const de=this.getChildren(X);if(re++,de.length!==1)break;X=de[0].properties.cluster_id}return re}_appendLeaves(X,re,de,Pe,Ne){const Je=this.getChildren(re);for(const Et of Je){const Be=Et.properties;if(Be&&Be.cluster?Ne+Be.point_count<=Pe?Ne+=Be.point_count:Ne=this._appendLeaves(X,Be.cluster_id,de,Pe,Ne):Ne<Pe?Ne++:X.push(Et),X.length===de)break}return Ne}_createTree(X){const re=new s.bg(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<X.length;de+=this.stride)re.add(X[de],X[de+1]);return re.finish(),re.data=X,re}_addTileFeatures(X,re,de,Pe,Ne,Je){for(const Et of X){const Be=Et*this.stride,Ct=re[Be+Pr]>1;let ht,Tt,hi;if(Ct)ht=Xe(re,Be,this.clusterProps),Tt=re[Be],hi=re[Be+1];else{const Ki=this.points[re[Be+Fn]];ht=Ki.properties;const[qi,Ui]=Ki.geometry.coordinates;Tt=ft(qi),hi=ut(Ui)}const Yi={type:1,geometry:[[Math.round(this.options.extent*(Tt*Ne-de)),Math.round(this.options.extent*(hi*Ne-Pe))]],tags:ht};let mn;mn=Ct||this.options.generateId?re[Be+Fn]:this.points[re[Be+Fn]].id,mn!==void 0&&(Yi.id=mn),Je.features.push(Yi)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,re){const{radius:de,extent:Pe,reduce:Ne,minPoints:Je}=this.options,Et=de/(Pe*Math.pow(2,re)),Be=X.data,Ct=[],ht=this.stride;for(let Tt=0;Tt<Be.length;Tt+=ht){if(Be[Tt+2]<=re)continue;Be[Tt+2]=re;const hi=Be[Tt],Yi=Be[Tt+1],mn=X.within(Be[Tt],Be[Tt+1],Et),Ki=Be[Tt+Pr];let qi=Ki;for(const Ui of mn){const Zi=Ui*ht;Be[Zi+2]>re&&(qi+=Be[Zi+Pr])}if(qi>Ki&&qi>=Je){let Ui,Zi=hi*Ki,an=Yi*Ki,Jn=-1;const hn=(Tt/ht<<5)+(re+1)+this.points.length;for(const Dr of mn){const Er=Dr*ht;if(Be[Er+2]<=re)continue;Be[Er+2]=re;const kr=Be[Er+Pr];Zi+=Be[Er]*kr,an+=Be[Er+1]*kr,Be[Er+4]=hn,Ne&&(Ui||(Ui=this._map(Be,Tt,!0),Jn=this.clusterProps.length,this.clusterProps.push(Ui)),Ne(Ui,this._map(Be,Er)))}Be[Tt+4]=hn,Ct.push(Zi/qi,an/qi,1/0,hn,-1,qi),Ne&&Ct.push(Jn)}else{for(let Ui=0;Ui<ht;Ui++)Ct.push(Be[Tt+Ui]);if(qi>1)for(const Ui of mn){const Zi=Ui*ht;if(!(Be[Zi+2]<=re)){Be[Zi+2]=re;for(let an=0;an<ht;an++)Ct.push(Be[Zi+an])}}}}return Ct}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,re,de){if(X[re+Pr]>1){const Je=this.clusterProps[X[re+Sr]];return de?Object.assign({},Je):Je}const Pe=this.points[X[re+Fn]].properties,Ne=this.options.map(Pe);return de&&Ne===Pe?Object.assign({},Ne):Ne}}function be(Me,X,re){return{type:"Feature",id:Me[X+Fn],properties:Xe(Me,X,re),geometry:{type:"Point",coordinates:[(de=Me[X],360*(de-.5)),St(Me[X+1])]}};var de}function Xe(Me,X,re){const de=Me[X+Pr],Pe=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Ne=Me[X+Sr],Je=Ne===-1?{}:Object.assign({},re[Ne]);return Object.assign(Je,{cluster:!0,cluster_id:Me[X+Fn],point_count:de,point_count_abbreviated:Pe})}function ft(Me){return Me/360+.5}function ut(Me){const X=Math.sin(Me*Math.PI/180),re=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return re<0?0:re>1?1:re}function St(Me){const X=(180-360*Me)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}var Vt={exports:{}};Vt.exports=function(){function Me(Fe,Ve,et,at){for(var nt,mt=at,_t=et-Ve>>1,st=et-Ve,vt=Fe[Ve],lt=Fe[Ve+1],Kt=Fe[et],Ti=Fe[et+1],Nt=Ve+3;Nt<et;Nt+=3){var en=X(Fe[Nt],Fe[Nt+1],vt,lt,Kt,Ti);if(en>mt)nt=Nt,mt=en;else if(en===mt){var yn=Math.abs(Nt-_t);yn<st&&(nt=Nt,st=yn)}}mt>at&&(nt-Ve>3&&Me(Fe,Ve,nt,at),Fe[nt+2]=mt,et-nt>3&&Me(Fe,nt,et,at))}function X(Fe,Ve,et,at,nt,mt){var _t=nt-et,st=mt-at;if(_t!==0||st!==0){var vt=((Fe-et)*_t+(Ve-at)*st)/(_t*_t+st*st);vt>1?(et=nt,at=mt):vt>0&&(et+=_t*vt,at+=st*vt)}return(_t=Fe-et)*_t+(st=Ve-at)*st}function re(Fe,Ve,et,at){var nt={id:Fe===void 0?null:Fe,type:Ve,geometry:et,tags:at,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(mt){var _t=mt.geometry,st=mt.type;if(st==="Point"||st==="MultiPoint"||st==="LineString")de(mt,_t);else if(st==="Polygon"||st==="MultiLineString")for(var vt=0;vt<_t.length;vt++)de(mt,_t[vt]);else if(st==="MultiPolygon")for(vt=0;vt<_t.length;vt++)for(var lt=0;lt<_t[vt].length;lt++)de(mt,_t[vt][lt])}(nt),nt}function de(Fe,Ve){for(var et=0;et<Ve.length;et+=3)Fe.minX=Math.min(Fe.minX,Ve[et]),Fe.minY=Math.min(Fe.minY,Ve[et+1]),Fe.maxX=Math.max(Fe.maxX,Ve[et]),Fe.maxY=Math.max(Fe.maxY,Ve[et+1])}function Pe(Fe,Ve,et,at){if(Ve.geometry){var nt=Ve.geometry.coordinates,mt=Ve.geometry.type,_t=Math.pow(et.tolerance/((1<<et.maxZoom)*et.extent),2),st=[],vt=Ve.id;if(et.promoteId?vt=Ve.properties[et.promoteId]:et.generateId&&(vt=at||0),mt==="Point")Ne(nt,st);else if(mt==="MultiPoint")for(var lt=0;lt<nt.length;lt++)Ne(nt[lt],st);else if(mt==="LineString")Je(nt,st,_t,!1);else if(mt==="MultiLineString"){if(et.lineMetrics){for(lt=0;lt<nt.length;lt++)Je(nt[lt],st=[],_t,!1),Fe.push(re(vt,"LineString",st,Ve.properties));return}Et(nt,st,_t,!1)}else if(mt==="Polygon")Et(nt,st,_t,!0);else{if(mt!=="MultiPolygon"){if(mt==="GeometryCollection"){for(lt=0;lt<Ve.geometry.geometries.length;lt++)Pe(Fe,{id:vt,geometry:Ve.geometry.geometries[lt],properties:Ve.properties},et,at);return}throw new Error("Input data is not a valid GeoJSON object.")}for(lt=0;lt<nt.length;lt++){var Kt=[];Et(nt[lt],Kt,_t,!0),st.push(Kt)}}Fe.push(re(vt,mt,st,Ve.properties))}}function Ne(Fe,Ve){Ve.push(Be(Fe[0])),Ve.push(Ct(Fe[1])),Ve.push(0)}function Je(Fe,Ve,et,at){for(var nt,mt,_t=0,st=0;st<Fe.length;st++){var vt=Be(Fe[st][0]),lt=Ct(Fe[st][1]);Ve.push(vt),Ve.push(lt),Ve.push(0),st>0&&(_t+=at?(nt*lt-vt*mt)/2:Math.sqrt(Math.pow(vt-nt,2)+Math.pow(lt-mt,2))),nt=vt,mt=lt}var Kt=Ve.length-3;Ve[2]=1,Me(Ve,0,Kt,et),Ve[Kt+2]=1,Ve.size=Math.abs(_t),Ve.start=0,Ve.end=Ve.size}function Et(Fe,Ve,et,at){for(var nt=0;nt<Fe.length;nt++){var mt=[];Je(Fe[nt],mt,et,at),Ve.push(mt)}}function Be(Fe){return Fe/360+.5}function Ct(Fe){var Ve=Math.sin(Fe*Math.PI/180),et=.5-.25*Math.log((1+Ve)/(1-Ve))/Math.PI;return et<0?0:et>1?1:et}function ht(Fe,Ve,et,at,nt,mt,_t,st){if(at/=Ve,mt>=(et/=Ve)&&_t<at)return Fe;if(_t<et||mt>=at)return null;for(var vt=[],lt=0;lt<Fe.length;lt++){var Kt=Fe[lt],Ti=Kt.geometry,Nt=Kt.type,en=nt===0?Kt.minX:Kt.minY,yn=nt===0?Kt.maxX:Kt.maxY;if(en>=et&&yn<at)vt.push(Kt);else if(!(yn<et||en>=at)){var on=[];if(Nt==="Point"||Nt==="MultiPoint")Tt(Ti,on,et,at,nt);else if(Nt==="LineString")hi(Ti,on,et,at,nt,!1,st.lineMetrics);else if(Nt==="MultiLineString")mn(Ti,on,et,at,nt,!1);else if(Nt==="Polygon")mn(Ti,on,et,at,nt,!0);else if(Nt==="MultiPolygon")for(var jn=0;jn<Ti.length;jn++){var dr=[];mn(Ti[jn],dr,et,at,nt,!0),dr.length&&on.push(dr)}if(on.length){if(st.lineMetrics&&Nt==="LineString"){for(jn=0;jn<on.length;jn++)vt.push(re(Kt.id,Nt,on[jn],Kt.tags));continue}Nt!=="LineString"&&Nt!=="MultiLineString"||(on.length===1?(Nt="LineString",on=on[0]):Nt="MultiLineString"),Nt!=="Point"&&Nt!=="MultiPoint"||(Nt=on.length===3?"Point":"MultiPoint"),vt.push(re(Kt.id,Nt,on,Kt.tags))}}}return vt.length?vt:null}function Tt(Fe,Ve,et,at,nt){for(var mt=0;mt<Fe.length;mt+=3){var _t=Fe[mt+nt];_t>=et&&_t<=at&&(Ve.push(Fe[mt]),Ve.push(Fe[mt+1]),Ve.push(Fe[mt+2]))}}function hi(Fe,Ve,et,at,nt,mt,_t){for(var st,vt,lt=Yi(Fe),Kt=nt===0?qi:Ui,Ti=Fe.start,Nt=0;Nt<Fe.length-3;Nt+=3){var en=Fe[Nt],yn=Fe[Nt+1],on=Fe[Nt+2],jn=Fe[Nt+3],dr=Fe[Nt+4],Ni=nt===0?en:yn,Wr=nt===0?jn:dr,vs=!1;_t&&(st=Math.sqrt(Math.pow(en-jn,2)+Math.pow(yn-dr,2))),Ni<et?Wr>et&&(vt=Kt(lt,en,yn,jn,dr,et),_t&&(lt.start=Ti+st*vt)):Ni>at?Wr<at&&(vt=Kt(lt,en,yn,jn,dr,at),_t&&(lt.start=Ti+st*vt)):Ki(lt,en,yn,on),Wr<et&&Ni>=et&&(vt=Kt(lt,en,yn,jn,dr,et),vs=!0),Wr>at&&Ni<=at&&(vt=Kt(lt,en,yn,jn,dr,at),vs=!0),!mt&&vs&&(_t&&(lt.end=Ti+st*vt),Ve.push(lt),lt=Yi(Fe)),_t&&(Ti+=st)}var fr=Fe.length-3;en=Fe[fr],yn=Fe[fr+1],on=Fe[fr+2],(Ni=nt===0?en:yn)>=et&&Ni<=at&&Ki(lt,en,yn,on),fr=lt.length-3,mt&&fr>=3&&(lt[fr]!==lt[0]||lt[fr+1]!==lt[1])&&Ki(lt,lt[0],lt[1],lt[2]),lt.length&&Ve.push(lt)}function Yi(Fe){var Ve=[];return Ve.size=Fe.size,Ve.start=Fe.start,Ve.end=Fe.end,Ve}function mn(Fe,Ve,et,at,nt,mt){for(var _t=0;_t<Fe.length;_t++)hi(Fe[_t],Ve,et,at,nt,mt,!1)}function Ki(Fe,Ve,et,at){Fe.push(Ve),Fe.push(et),Fe.push(at)}function qi(Fe,Ve,et,at,nt,mt){var _t=(mt-Ve)/(at-Ve);return Fe.push(mt),Fe.push(et+(nt-et)*_t),Fe.push(1),_t}function Ui(Fe,Ve,et,at,nt,mt){var _t=(mt-et)/(nt-et);return Fe.push(Ve+(at-Ve)*_t),Fe.push(mt),Fe.push(1),_t}function Zi(Fe,Ve){for(var et=[],at=0;at<Fe.length;at++){var nt,mt=Fe[at],_t=mt.type;if(_t==="Point"||_t==="MultiPoint"||_t==="LineString")nt=an(mt.geometry,Ve);else if(_t==="MultiLineString"||_t==="Polygon"){nt=[];for(var st=0;st<mt.geometry.length;st++)nt.push(an(mt.geometry[st],Ve))}else if(_t==="MultiPolygon")for(nt=[],st=0;st<mt.geometry.length;st++){for(var vt=[],lt=0;lt<mt.geometry[st].length;lt++)vt.push(an(mt.geometry[st][lt],Ve));nt.push(vt)}et.push(re(mt.id,_t,nt,mt.tags))}return et}function an(Fe,Ve){var et=[];et.size=Fe.size,Fe.start!==void 0&&(et.start=Fe.start,et.end=Fe.end);for(var at=0;at<Fe.length;at+=3)et.push(Fe[at]+Ve,Fe[at+1],Fe[at+2]);return et}function Jn(Fe,Ve){if(Fe.transformed)return Fe;var et,at,nt,mt=1<<Fe.z,_t=Fe.x,st=Fe.y;for(et=0;et<Fe.features.length;et++){var vt=Fe.features[et],lt=vt.geometry,Kt=vt.type;if(vt.geometry=[],Kt===1)for(at=0;at<lt.length;at+=2)vt.geometry.push(hn(lt[at],lt[at+1],Ve,mt,_t,st));else for(at=0;at<lt.length;at++){var Ti=[];for(nt=0;nt<lt[at].length;nt+=2)Ti.push(hn(lt[at][nt],lt[at][nt+1],Ve,mt,_t,st));vt.geometry.push(Ti)}}return Fe.transformed=!0,Fe}function hn(Fe,Ve,et,at,nt,mt){return[Math.round(et*(Fe*at-nt)),Math.round(et*(Ve*at-mt))]}function Dr(Fe,Ve,et,at,nt){for(var mt=Ve===nt.maxZoom?0:nt.tolerance/((1<<Ve)*nt.extent),_t={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:et,y:at,z:Ve,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},st=0;st<Fe.length;st++){_t.numFeatures++,Er(_t,Fe[st],mt,nt);var vt=Fe[st].minX,lt=Fe[st].minY,Kt=Fe[st].maxX,Ti=Fe[st].maxY;vt<_t.minX&&(_t.minX=vt),lt<_t.minY&&(_t.minY=lt),Kt>_t.maxX&&(_t.maxX=Kt),Ti>_t.maxY&&(_t.maxY=Ti)}return _t}function Er(Fe,Ve,et,at){var nt=Ve.geometry,mt=Ve.type,_t=[];if(mt==="Point"||mt==="MultiPoint")for(var st=0;st<nt.length;st+=3)_t.push(nt[st]),_t.push(nt[st+1]),Fe.numPoints++,Fe.numSimplified++;else if(mt==="LineString")kr(_t,nt,Fe,et,!1,!1);else if(mt==="MultiLineString"||mt==="Polygon")for(st=0;st<nt.length;st++)kr(_t,nt[st],Fe,et,mt==="Polygon",st===0);else if(mt==="MultiPolygon")for(var vt=0;vt<nt.length;vt++){var lt=nt[vt];for(st=0;st<lt.length;st++)kr(_t,lt[st],Fe,et,!0,st===0)}if(_t.length){var Kt=Ve.tags||null;if(mt==="LineString"&&at.lineMetrics){for(var Ti in Kt={},Ve.tags)Kt[Ti]=Ve.tags[Ti];Kt.mapbox_clip_start=nt.start/nt.size,Kt.mapbox_clip_end=nt.end/nt.size}var Nt={geometry:_t,type:mt==="Polygon"||mt==="MultiPolygon"?3:mt==="LineString"||mt==="MultiLineString"?2:1,tags:Kt};Ve.id!==null&&(Nt.id=Ve.id),Fe.features.push(Nt)}}function kr(Fe,Ve,et,at,nt,mt){var _t=at*at;if(at>0&&Ve.size<(nt?_t:at))et.numPoints+=Ve.length/3;else{for(var st=[],vt=0;vt<Ve.length;vt+=3)(at===0||Ve[vt+2]>_t)&&(et.numSimplified++,st.push(Ve[vt]),st.push(Ve[vt+1])),et.numPoints++;nt&&function(lt,Kt){for(var Ti=0,Nt=0,en=lt.length,yn=en-2;Nt<en;yn=Nt,Nt+=2)Ti+=(lt[Nt]-lt[yn])*(lt[Nt+1]+lt[yn+1]);if(Ti>0===Kt)for(Nt=0,en=lt.length;Nt<en/2;Nt+=2){var on=lt[Nt],jn=lt[Nt+1];lt[Nt]=lt[en-2-Nt],lt[Nt+1]=lt[en-1-Nt],lt[en-2-Nt]=on,lt[en-1-Nt]=jn}}(st,mt),Fe.push(st)}}function Un(Fe,Ve){var et=(Ve=this.options=function(nt,mt){for(var _t in mt)nt[_t]=mt[_t];return nt}(Object.create(this.options),Ve)).debug;if(et&&console.time("preprocess data"),Ve.maxZoom<0||Ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ve.promoteId&&Ve.generateId)throw new Error("promoteId and generateId cannot be used together.");var at=function(nt,mt){var _t=[];if(nt.type==="FeatureCollection")for(var st=0;st<nt.features.length;st++)Pe(_t,nt.features[st],mt,st);else Pe(_t,nt.type==="Feature"?nt:{geometry:nt},mt);return _t}(Fe,Ve);this.tiles={},this.tileCoords=[],et&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ve.indexMaxZoom,Ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(at=function(nt,mt){var _t=mt.buffer/mt.extent,st=nt,vt=ht(nt,1,-1-_t,_t,0,-1,2,mt),lt=ht(nt,1,1-_t,2+_t,0,-1,2,mt);return(vt||lt)&&(st=ht(nt,1,-_t,1+_t,0,-1,2,mt)||[],vt&&(st=Zi(vt,1).concat(st)),lt&&(st=st.concat(Zi(lt,-1)))),st}(at,Ve)).length&&this.splitTile(at,0,0,0),et&&(at.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Bn(Fe,Ve,et){return 32*((1<<Fe)*et+Ve)+Fe}return Un.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Un.prototype.splitTile=function(Fe,Ve,et,at,nt,mt,_t){for(var st=[Fe,Ve,et,at],vt=this.options,lt=vt.debug;st.length;){at=st.pop(),et=st.pop(),Ve=st.pop(),Fe=st.pop();var Kt=1<<Ve,Ti=Bn(Ve,et,at),Nt=this.tiles[Ti];if(!Nt&&(lt>1&&console.time("creation"),Nt=this.tiles[Ti]=Dr(Fe,Ve,et,at,vt),this.tileCoords.push({z:Ve,x:et,y:at}),lt)){lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ve,et,at,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));var en="z"+Ve;this.stats[en]=(this.stats[en]||0)+1,this.total++}if(Nt.source=Fe,nt){if(Ve===vt.maxZoom||Ve===nt)continue;var yn=1<<nt-Ve;if(et!==Math.floor(mt/yn)||at!==Math.floor(_t/yn))continue}else if(Ve===vt.indexMaxZoom||Nt.numPoints<=vt.indexMaxPoints)continue;if(Nt.source=null,Fe.length!==0){lt>1&&console.time("clipping");var on,jn,dr,Ni,Wr,vs,fr=.5*vt.buffer/vt.extent,Ml=.5-fr,po=.5+fr,wa=1+fr;on=jn=dr=Ni=null,Wr=ht(Fe,Kt,et-fr,et+po,0,Nt.minX,Nt.maxX,vt),vs=ht(Fe,Kt,et+Ml,et+wa,0,Nt.minX,Nt.maxX,vt),Fe=null,Wr&&(on=ht(Wr,Kt,at-fr,at+po,1,Nt.minY,Nt.maxY,vt),jn=ht(Wr,Kt,at+Ml,at+wa,1,Nt.minY,Nt.maxY,vt),Wr=null),vs&&(dr=ht(vs,Kt,at-fr,at+po,1,Nt.minY,Nt.maxY,vt),Ni=ht(vs,Kt,at+Ml,at+wa,1,Nt.minY,Nt.maxY,vt),vs=null),lt>1&&console.timeEnd("clipping"),st.push(on||[],Ve+1,2*et,2*at),st.push(jn||[],Ve+1,2*et,2*at+1),st.push(dr||[],Ve+1,2*et+1,2*at),st.push(Ni||[],Ve+1,2*et+1,2*at+1)}}},Un.prototype.getTile=function(Fe,Ve,et){var at=this.options,nt=at.extent,mt=at.debug;if(Fe<0||Fe>24)return null;var _t=1<<Fe,st=Bn(Fe,Ve=(Ve%_t+_t)%_t,et);if(this.tiles[st])return Jn(this.tiles[st],nt);mt>1&&console.log("drilling down to z%d-%d-%d",Fe,Ve,et);for(var vt,lt=Fe,Kt=Ve,Ti=et;!vt&&lt>0;)lt--,Kt=Math.floor(Kt/2),Ti=Math.floor(Ti/2),vt=this.tiles[Bn(lt,Kt,Ti)];return vt&&vt.source?(mt>1&&console.log("found parent tile z%d-%d-%d",lt,Kt,Ti),mt>1&&console.time("drilling down"),this.splitTile(vt.source,lt,Kt,Ti,Fe,Ve,et),mt>1&&console.timeEnd("drilling down"),this.tiles[st]?Jn(this.tiles[st],nt):null):null},function(Fe,Ve){return new Un(Fe,Ve)}}();var pt=s.dK(Vt.exports);function Ot(Me,X){const re=Me.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const de=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!de)return X(null,null);const Pe=new $e(de.features);let Ne=On(Pe);Ne.byteOffset===0&&Ne.byteLength===Ne.buffer.byteLength||(Ne=new Uint8Array(Ne)),X(null,{vectorTile:Pe,rawData:Ne.buffer})}class xt extends We{constructor(X,re,de,Pe,Ne,Je){super(X,re,de,Pe,Ot,Je),Ne&&(this.loadGeoJSON=Ne)}loadData(X,re){const de=X&&X.request,Pe=de&&de.collectResourceTiming;this.loadGeoJSON(X,(Ne,Je)=>{if(Ne||!Je)return re(Ne);if(typeof Je!="object")return re(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{Wt(Je,!0);try{if(X.filter){const Be=s.r(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));Je={type:"FeatureCollection",features:Je.features.filter(ht=>Be.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=X.cluster?new ge(function({superclusterOptions:Be,clusterProperties:Ct}){if(!Ct||!Be)return Be;const ht={},Tt={},hi={accumulated:null,zoom:0},Yi={properties:null},mn=Object.keys(Ct);for(const Ki of mn){const[qi,Ui]=Ct[Ki],Zi=s.r(Ui),an=s.r(typeof qi=="string"?[qi,["accumulated"],["get",Ki]]:qi);ht[Ki]=Zi.value,Tt[Ki]=an.value}return Be.map=Ki=>{Yi.properties=Ki;const qi={};for(const Ui of mn)qi[Ui]=ht[Ui].evaluate(hi,Yi);return qi},Be.reduce=(Ki,qi)=>{Yi.properties=qi;for(const Ui of mn)hi.accumulated=Ki[Ui],Ki[Ui]=Tt[Ui].evaluate(hi,Yi)},Be}(X)).load(Je.features):pt(Je,X.geojsonVtOptions)}catch(Be){return re(Be)}this.loaded={};const Et={};if(Pe){const Be=B(de);Be&&(Et.resourceTiming={},Et.resourceTiming[X.source]=JSON.parse(JSON.stringify(Be)))}re(null,Et)}})}reloadTile(X,re){const de=this.loaded;return de&&de[X.uid]?super.reloadTile(X,re):this.loadTile(X,re)}loadGeoJSON(X,re){if(X.request)s.g(X.request,re);else{if(typeof X.data!="string")return re(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(X.data))}catch{return re(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(de){re(de)}}getClusterChildren(X,re){try{re(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(de){re(de)}}getClusterLeaves(X,re){try{re(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(de){re(de)}}}class jt{constructor(X,re){this.tileID=new s.am(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=X.projection,this.brightness=re}parse(X,re,de,Pe){this.status="parsing";const Ne=new s.am(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),Je={},Et=re.familiesBySource[de.source],Be=new s.dC(Ne,de.promoteId);return Be.bucketLayerIDs=[],Be.is3DTile=!0,s.dP(X).then(Ct=>{if(!Ct)return Pe(new Error("Could not parse tile"));const ht=s.dQ(Ct,1/s.bR(de.tileID.canonical)),Tt=Ct.json.extensionsUsed&&Ct.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ct.json.asset.extras&&Ct.json.asset.extras.MAPBOX_mesh_features,hi=Ct.json.extensionsUsed&&Ct.json.extensionsUsed.includes("EXT_meshopt_compression"),Yi=new s.K(this.zoom,{brightness:this.brightness});for(const mn in Et)for(const Ki of Et[mn]){const qi=Ki[0];Be.bucketLayerIDs.push(Ki.map(Zi=>Zi.id)),qi.recalculate(Yi,[]);const Ui=new s.dR(ht,Ne,Tt,hi,this.brightness,Be);Tt||(Ui.needsUpload=!0),Je[qi.fqid]=Ui,Ui.evaluate(qi)}this.status="done",Pe(null,{buckets:Je,featureIndex:Be})}).catch(Ct=>Pe(new Error(Ct.message)))}}class ii{constructor(X,re,de,Pe,Ne,Je){this.actor=X,this.layerIndex=re,this.brightness=Je,this.loading={},this.loaded={}}loadTile(X,re){const de=X.uid,Pe=this.loading[de]=new jt(X,this.brightness);s.a_(X.request,(Ne,Je)=>{const Et=!this.loading[de];return delete this.loading[de],Et||Ne?(Pe.status="done",Et||(this.loaded[de]=Pe),re(Ne)):Je&&Je.byteLength!==0?void Pe.parse(Je,this.layerIndex,X,(Be,Ct)=>{Pe.status="done",this.loaded=this.loaded||{},this.loaded[de]=Pe,Be||!Ct?re(Be):re(null,Ct)}):(Pe.status="done",this.loaded[de]=Pe,re())})}reloadTile(X,re){const de=this.loaded,Pe=X.uid;if(de&&de[Pe]){const Ne=de[Pe];Ne.projection=X.projection,Ne.brightness=X.brightness;const Je=(Et,Be)=>{Ne.reloadCallback&&(delete Ne.reloadCallback,this.loadTile(X,re)),re(Et,Be)};Ne.status==="parsing"?Ne.reloadCallback=Je:Ne.status==="done"&&this.loadTile(X,re)}}abortTile(X,re){const de=X.uid;this.loading[de]&&delete this.loading[de],re()}removeTile(X,re){const de=this.loaded,Pe=X.uid;de&&de[Pe]&&delete de[Pe],re()}}class Qt{constructor(X){this.self=X,this.actor=new s.dS(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.bo({name:"mercator"}),this.workerSourceTypes={vector:We,geojson:xt,"batched-model":ii},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,de)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=de},this.self.registerRTLTextPlugin=re=>{if(s.dT.isParsed())throw new Error("RTL text plugin already registered.");s.dT.applyArabicShaping=re.applyArabicShaping,s.dT.processBidirectionalText=re.processBidirectionalText,s.dT.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(X,re,de){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],delete this.rasterArrayWorkerSource,de()}checkIfReady(X,re,de){de()}setReferrer(X,re){this.referrer=re}spriteLoaded(X,{scope:re,isLoaded:de}){if(this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),this.isSpriteLoaded[X][re]=de,this.workerSources[X]&&this.workerSources[X][re])for(const Pe in this.workerSources[X][re]){const Ne=this.workerSources[X][re][Pe];for(const Je in Ne)Ne[Je]instanceof We&&(Ne[Je].isSpriteLoaded=de,Ne[Je].fire(new s.b("isSpriteLoaded")))}}setImages(X,{scope:re,images:de},Pe){if(this.availableImages[X]||(this.availableImages[X]={}),this.availableImages[X][re]=de,this.workerSources[X]&&this.workerSources[X][re]){for(const Ne in this.workerSources[X][re]){const Je=this.workerSources[X][re][Ne];for(const Et in Je)Je[Et].availableImages=de}Pe()}else Pe()}setProjection(X,re){this.projections[X]=s.bo(re)}setBrightness(X,re,de){this.brightness=re,de()}setLayers(X,re,de){this.getLayerIndex(X,re.scope).replace(re.layers,re.options),de()}updateLayers(X,re,de){this.getLayerIndex(X,re.scope).update(re.layers,re.removedIds,re.options),de()}loadTile(X,re,de){re.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,re.type,re.source,re.scope).loadTile(re,de)}loadDEMTile(X,re,de){this.getDEMWorkerSource(X,re.source,re.scope).loadTile(re,de)}decodeRasterArray(X,re,de){this.getRasterArrayWorkerSource().decodeRasterArray(re,de)}reloadTile(X,re,de){re.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,re.type,re.source,re.scope).reloadTile(re,de)}abortTile(X,re,de){this.getWorkerSource(X,re.type,re.source,re.scope).abortTile(re,de)}removeTile(X,re,de){this.getWorkerSource(X,re.type,re.source,re.scope).removeTile(re,de)}removeSource(X,re,de){if(!(this.workerSources[X]&&this.workerSources[X][re.scope]&&this.workerSources[X][re.scope][re.type]&&this.workerSources[X][re.scope][re.type][re.source]))return;const Pe=this.workerSources[X][re.scope][re.type][re.source];delete this.workerSources[X][re.scope][re.type][re.source],Pe.removeSource!==void 0?Pe.removeSource(re,de):de()}loadWorkerSource(X,re,de){try{this.self.importScripts(re.url),de()}catch(Pe){de(Pe.toString())}}syncRTLPluginState(X,re,de){try{s.dT.setState(re);const Pe=s.dT.getPluginURL();if(s.dT.isLoaded()&&!s.dT.isParsed()&&Pe!=null){this.self.importScripts(Pe);const Ne=s.dT.isParsed();de(Ne?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Pe}`),Ne)}}catch(Pe){de(Pe.toString())}}setDracoUrl(X,re){this.dracoUrl=re}getAvailableImages(X,re){this.availableImages[X]||(this.availableImages[X]={});let de=this.availableImages[X][re];return de||(de=[]),de}getLayerIndex(X,re){this.layerIndexes[X]||(this.layerIndexes[X]={});let de=this.layerIndexes[X][re];return de||(de=this.layerIndexes[X][re]=new ae,de.scope=re),de}getWorkerSource(X,re,de,Pe){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Pe]||(this.workerSources[X][Pe]={}),this.workerSources[X][Pe][re]||(this.workerSources[X][Pe][re]={}),this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),!this.workerSources[X][Pe][re][de]){const Ne={send:(Je,Et,Be,Ct,ht,Tt)=>{this.actor.send(Je,Et,Be,X,ht,Tt)},scheduler:this.actor.scheduler};this.workerSources[X][Pe][re][de]=new this.workerSourceTypes[re](Ne,this.getLayerIndex(X,Pe),this.getAvailableImages(X,Pe),this.isSpriteLoaded[X][Pe],void 0,this.brightness)}return this.workerSources[X][Pe][re][de]}getDEMWorkerSource(X,re,de){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][de]||(this.demWorkerSources[X][de]={}),this.demWorkerSources[X][de][re]||(this.demWorkerSources[X][de][re]=new ct),this.demWorkerSources[X][de][re]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new gt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(X,re){s.dU(re)}getWorkerPerformanceMetrics(X,re,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Qt(self)),Qt}),E(["./shared"],function(s){function B(h,n){if(Array.isArray(h)){if(!Array.isArray(n)||h.length!==n.length)return!1;for(let o=0;o<h.length;o++)if(!B(h[o],n[o]))return!1;return!0}if(typeof h=="object"&&h!==null&&n!==null){if(typeof n!="object"||Object.keys(h).length!==Object.keys(n).length)return!1;for(const o in h)if(!B(h[o],n[o]))return!1;return!0}return h===n}var q=Z;function Z(h){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,y=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(y);try{_=new Worker(w),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(w),f}()?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var y=_.getImageData(0,0,1,1);return y&&y.width===f.width}()?(ae[o=n&&n.failIfMajorPerformanceCaveat]===void 0&&(ae[o]=function(f){var _,y=function(w){var S=document.createElement("canvas"),I=Object.create(Z.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=w,S.getContext("webgl2",I)}(f);if(!y)return!1;try{_=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!_||y.isContextLost())&&(y.shaderSource(_,"void main() {}"),y.compileShader(_),y.getShaderParameter(_,y.COMPILE_STATUS)===!0)}(o)),ae[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var o}(h)}var ae={};function ue(h,n,o){const f=document.createElement(h);return n!=null&&(f.className=n),o&&o.appendChild(f),f}function Le(h,n,o){const f=document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(n))f.setAttributeNS(null,_,String(n[_]));return o&&o.appendChild(f),f}Z.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ae=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Oe=Ae&&Ae.userSelect!==void 0?"userSelect":"WebkitUserSelect";let We;function ct(){Ae&&Oe&&(We=Ae[Oe],Ae[Oe]="none")}function gt(){Ae&&Oe&&(Ae[Oe]=We)}function Lt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Lt,!0)}function Rt(){window.addEventListener("click",Lt,!0),window.setTimeout(()=>{window.removeEventListener("click",Lt,!0)},0)}function Wt(h,n){const o=h.getBoundingClientRect();return $e(h,o,n)}function ui(h,n){const o=h.getBoundingClientRect(),f=[];for(let _=0;_<n.length;_++)f.push($e(h,o,n[_]));return f}function bi(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function $e(h,n,o){const f=h.offsetWidth===n.width?1:h.offsetWidth/n.width;return new s.P((o.clientX-n.left)*f,(o.clientY-n.top)*f)}class Ji{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,o){this._updatedSourceCaches[n]=o,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const o=n.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(n.id),this.setDirty()}removeLayer(n){const o=n.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][n.id]=n,this._updatedLayers[o].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const o in this._updatedLayers)n[o]=n[o]||{},n[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)n[o]=n[o]||{},n[o].removedIds=Object.keys(this._removedLayers[o]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class un extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,o){return s.l(this.requestManager.transformRequest(o,s.R.Model).url).then(f=>{if(!f)return;const _=s.c(f),y=new s.M(n,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(f=>{this.fire(new s.a(new Error(`Could not load model ${n} from ${o}: ${f.message}`)))})}load(n,o){this.models[o]||(this.models[o]={});const f=Object.keys(n);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+f.length;const _=[];for(const y of f)_.push(this.loadModel(y,n[y]));Promise.allSettled(_).then(y=>{for(let w=0;w<y.length;w++){const{status:S,value:I}=y[w];S==="fulfilled"&&I&&(this.models[o][f[w]]=I)}this.numModelsLoading[o]-=f.length,this.fire(new s.b("data",{dataType:"style"}))}).catch(y=>{this.fire(new s.a(new Error(`Could not load models: ${y.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,o){return!!this.getModel(n,o)}getModel(n,o){return this.models[o]||(this.models[o]={}),this.models[o][n]}addModel(n,o,f){this.models[f]||(this.models[f]={}),this.hasModel(n,f)&&this.removeModel(n,f),this.load({[n]:this.requestManager.normalizeModelURL(o)},f)}addModels(n,o){const f={};for(const _ in n)f[_]=this.requestManager.normalizeModelURL(n[_]);this.load(f,o)}removeModel(n,o){this.models[o]||(this.models[o]={});const f=this.models[o][n];delete this.models[o][n],f.destroy()}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,o){this.models[o]||(this.models[o]={});for(const f in this.models[o])this.models[o][f].upload(n.context)}}class Zt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,f){const _=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][_]=this.stateChanges[n][_]||{},s.e(this.stateChanges[n][_],f),this.deletedStates[n]===null){this.deletedStates[n]={};for(const y in this.state[n])y!==_&&(this.deletedStates[n][y]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][_]===null){this.deletedStates[n][_]={};for(const y in this.state[n][_])f[y]||(this.deletedStates[n][_][y]=null)}else for(const y in f)this.deletedStates[n]&&this.deletedStates[n][_]&&this.deletedStates[n][_][y]===null&&delete this.deletedStates[n][_][y]}removeFeatureState(n,o,f){if(this.deletedStates[n]===null)return;const _=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},f&&o!==void 0)this.deletedStates[n][_]!==null&&(this.deletedStates[n][_]=this.deletedStates[n][_]||{},this.deletedStates[n][_][f]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][_])for(f in this.deletedStates[n][_]={},this.stateChanges[n][_])this.deletedStates[n][_][f]=null;else this.deletedStates[n][_]=null;else this.deletedStates[n]=null}getState(n,o){const f=String(o),_=s.e({},(this.state[n]||{})[f],(this.stateChanges[n]||{})[f]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const y=this.deletedStates[n][o];if(y===null)return{};for(const w in y)delete _[w]}return _}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const y={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),s.e(this.state[_][w],this.stateChanges[_][w]),y[w]=this.state[_][w];f[_]=y}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const y={};if(this.deletedStates[_]===null)for(const w in this.state[_])y[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else if(this.state[_][w])for(const S of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][S];y[w]=this.state[_][w]}f[_]=f[_]||{},s.e(f[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in n)n[_].setFeatureState(f,o)}}function sn(h){const{userImage:n}=h;return!!(n&&n.render&&n.render())&&(h.data.replace(new Uint8Array(n.data.buffer)),!0)}class xr extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new s.h({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,o){if(this.loaded[o]!==n&&(this.loaded[o]=n,n)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,o,_);this.requestors=[]}}hasImage(n,o){return!!this.getImage(n,o)}getImage(n,o){return this.images[o][n]}addImage(n,o,f){this._validate(n,f)&&(this.images[o][n]=f)}_validate(n,o){let f=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.a(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.a(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(o.content,o)||(this.fire(new s.a(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,o){if(!n)return!0;let f=0;for(const _ of n){if(_[0]<f||_[1]<_[0]||o<_[1])return!1;f=_[1]}return!0}_validateContent(n,o){return!(n&&(n.length!==4||n[0]<0||o.data.width<n[0]||n[1]<0||o.data.height<n[1]||n[2]<0||o.data.width<n[2]||n[3]<0||o.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,o,f){f.version=this.images[o][n].version+1,this.images[o][n]=f,this.updatedImages[o][n]=!0}removeImage(n,o){const f=this.images[o][n];delete this.images[o][n],delete this.patterns[o][n],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,o,f){let _=!0;const y=!!this.loaded[o];if(!y)for(const w of n)this.images[o][w]||(_=!1);y||_?this._notify(n,o,f):this.requestors.push({ids:n,scope:o,callback:f})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,o,f){const _={};for(const y of n){this.images[o][y]||this.fire(new s.b("styleimagemissing",{id:y}));const w=this.images[o][y];w?_[y]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:s.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,_)}getPixelSize(n){const{width:o,height:f}=this.atlasImage[n];return{width:o,height:f}}getPattern(n,o){const f=this.patterns[o][n],_=this.getImage(n,o);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new s.I(y,_);this.patterns[o][n]={bin:y,position:w}}return this._updatePatternAtlas(o),this.patterns[o][n].position}bind(n,o){const f=n.gl;let _=this.atlasTexture[o];_?this.dirty&&(_.update(this.atlasImage[o]),this.dirty=!1):(_=new s.T(n,this.atlasImage[o],f.RGBA),this.atlasTexture[o]=_),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(n){const o=[];for(const w in this.patterns[n])o.push(this.patterns[n][w].bin);const{w:f,h:_}=s.p(o),y=this.atlasImage[n];y.resize({width:f||1,height:_||1});for(const w in this.patterns[n]){const{bin:S}=this.patterns[n][w],I=S.x+1,D=S.y+1,L=this.images[n][w].data,z=L.width,F=L.height;s.h.copy(L,y,{x:0,y:0},{x:I,y:D},{width:z,height:F}),s.h.copy(L,y,{x:0,y:F-1},{x:I,y:D-1},{width:z,height:1}),s.h.copy(L,y,{x:0,y:0},{x:I,y:D+F},{width:z,height:1}),s.h.copy(L,y,{x:z-1,y:0},{x:I-1,y:D},{width:1,height:F}),s.h.copy(L,y,{x:0,y:0},{x:I+z,y:D},{width:1,height:F})}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,o){for(const f of n){if(this.callbackDispatchedThisFrame[o][f])continue;this.callbackDispatchedThisFrame[o][f]=!0;const _=this.images[o][f];sn(_)&&this.updateImage(f,o,_)}}}class Qe{constructor(n,o,f,_){this.message=(n?`${n}: `:"")+f,_&&(this.identifier=_),o!=null&&o.__line__&&(this.line=o.__line__)}}class Ri extends Qe{}function gi(h){const n=h.key,o=h.value,f=h.valueSpec||{},_=h.objectElementValidators||{},y=h.style,w=h.styleSpec;let S=[];const I=s.i(o);if(I!=="object")return[new Qe(n,o,`object expected, ${I} found`)];for(const D in o){const L=D.split(".")[0];let z;_[L]?z=_[L]:f[L]?z=pt:_["*"]?z=_["*"]:f["*"]&&(z=pt),z?S=S.concat(z({key:(n&&`${n}.`)+D,value:o[D],valueSpec:f[L]||f["*"],style:y,styleSpec:w,object:o,objectKey:D},o)):S.push(new Ri(n,o[D],`unknown property "${D}"`))}for(const D in f)_[D]||f[D].required&&f[D].default===void 0&&o[D]===void 0&&S.push(new Qe(n,o,`missing required property "${D}"`));return S}function kt(h){const n=h.value,o=h.valueSpec,f=h.style,_=h.styleSpec,y=h.key,w=h.arrayElementValidator||pt;if(s.i(n)!=="array")return[new Qe(y,n,`array expected, ${s.i(n)} found`)];if(o.length&&n.length!==o.length)return[new Qe(y,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new Qe(y,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let S={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};_.$version<7&&(S.function=o.function),s.i(o.value)==="object"&&(S=o.value);let I=[];for(let D=0;D<n.length;D++)I=I.concat(w({array:n,arrayIndex:D,value:n[D],valueSpec:S,style:f,styleSpec:_,key:`${y}[${D}]`},!0));return I}function rr(h){const n=h.key,o=h.value,f=h.valueSpec;let _=s.i(o);if(_==="number"&&o!=o&&(_="NaN"),_!=="number")return[new Qe(n,o,`number expected, ${_} found`)];if("minimum"in f){let y=f.minimum;if(s.i(f.minimum)==="array"&&(y=f.minimum[h.arrayIndex]),o<y)return[new Qe(n,o,`${o} is less than the minimum value ${y}`)]}if("maximum"in f){let y=f.maximum;if(s.i(f.maximum)==="array"&&(y=f.maximum[h.arrayIndex]),o>y)return[new Qe(n,o,`${o} is greater than the maximum value ${y}`)]}return[]}function Kn(h){const n=h.valueSpec,o=s.u(h.value.type);let f,_,y,w={};const S=o!=="categorical"&&h.value.property===void 0,I=!S,D=s.i(h.value.stops)==="array"&&s.i(h.value.stops[0])==="array"&&s.i(h.value.stops[0][0])==="object",L=gi({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(N){if(o==="identity")return[new Qe(N.key,N.value,'identity function may not have a "stops" property')];let $=[];const G=N.value;return $=$.concat(kt({key:N.key,value:G,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:z})),s.i(G)==="array"&&G.length===0&&$.push(new Qe(N.key,G,"array must have at least one stop")),$},default:function(N){return pt({key:N.key,value:N.value,valueSpec:n,style:N.style,styleSpec:N.styleSpec})}}});return o==="identity"&&S&&L.push(new Qe(h.key,h.value,'missing required property "property"')),o==="identity"||h.value.stops||L.push(new Qe(h.key,h.value,'missing required property "stops"')),o==="exponential"&&h.valueSpec.expression&&!s.s(h.valueSpec)&&L.push(new Qe(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(I&&!s.k(h.valueSpec)?L.push(new Qe(h.key,h.value,"property functions not supported")):S&&!s.m(h.valueSpec)&&L.push(new Qe(h.key,h.value,"zoom functions not supported"))),o!=="categorical"&&!D||h.value.property!==void 0||L.push(new Qe(h.key,h.value,'"property" property is required')),L;function z(N){let $=[];const G=N.value,H=N.key;if(s.i(G)!=="array")return[new Qe(H,G,`array expected, ${s.i(G)} found`)];if(G.length!==2)return[new Qe(H,G,`array length 2 expected, length ${G.length} found`)];if(D){if(s.i(G[0])!=="object")return[new Qe(H,G,`object expected, ${s.i(G[0])} found`)];if(G[0].zoom===void 0)return[new Qe(H,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new Qe(H,G,"object stop key must have value")];const U=s.u(G[0].zoom);if(typeof U!="number")return[new Qe(H,G[0].zoom,"stop zoom values must be numbers")];if(y&&y>U)return[new Qe(H,G[0].zoom,"stop zoom values must appear in ascending order")];U!==y&&(y=U,_=void 0,w={}),$=$.concat(gi({key:`${H}[0]`,value:G[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:rr,value:F}}))}else $=$.concat(F({key:`${H}[0]`,value:G[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},G));return s.n(s.o(G[1]))?$.concat([new Qe(`${H}[1]`,G[1],"expressions are not allowed in function stops.")]):$.concat(pt({key:`${H}[1]`,value:G[1],valueSpec:n,style:N.style,styleSpec:N.styleSpec}))}function F(N,$){const G=s.i(N.value),H=s.u(N.value),U=N.value!==null?N.value:$;if(f){if(G!==f)return[new Qe(N.key,U,`${G} stop domain type must match previous stop domain type ${f}`)]}else f=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new Qe(N.key,U,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&o!=="categorical"){let Y=`number expected, ${G} found`;return s.k(n)&&o===void 0&&(Y+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(N.key,U,Y)]}return o!=="categorical"||G!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?o!=="categorical"&&G==="number"&&typeof H=="number"&&typeof _=="number"&&_!==void 0&&H<_?[new Qe(N.key,U,"stop domain values must appear in ascending order")]:(_=H,o==="categorical"&&H in w?[new Qe(N.key,U,"stop domain values must be unique")]:(w[H]=!0,[])):[new Qe(N.key,U,`integer expected, found ${String(H)}`)]}}function Rn(h){const n=(h.expressionContext==="property"?s.q:s.r)(s.o(h.value),h.valueSpec);if(n.result==="error")return n.value.map(f=>new Qe(`${h.key}${f.key}`,h.value,f.message));const o=n.value.expression||n.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!o.outputDefined())return[new Qe(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!s.t(o))return[new Qe(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Qi(o,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!s.v(o,["zoom","feature-state"]))return[new Qe(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!s.x(o))return[new Qe(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qi(h,n){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const _ of n.valueSpec.expression.parameters)o.delete(_);if(o.size===0)return[];const f=[];return h instanceof s.C&&o.has(h.name)?[new Qe(n.key,n.value,`["${h.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(h.eachChild(_=>{f.push(...Qi(_,n))}),f)}function Tr(h){const n=h.key,o=h.value,f=h.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(s.u(o))===-1&&_.push(new Qe(n,o,`expected one of [${f.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(f.values).indexOf(s.u(o))===-1&&_.push(new Qe(n,o,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(o)} found`)),_}function Mr(h){return s.z(s.o(h.value))?Rn(s.j({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Hr(h)}function Hr(h){const n=h.value,o=h.key;if(s.i(n)!=="array")return[new Qe(o,n,`array expected, ${s.i(n)} found`)];const f=h.styleSpec;let _,y=[];if(n.length<1)return[new Qe(o,n,"filter array must have at least 1 element")];switch(y=y.concat(Tr({key:`${o}[0]`,value:n[0],valueSpec:f.filter_operator,style:h.style,styleSpec:h.styleSpec})),s.u(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.u(n[1])==="$type"&&y.push(new Qe(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new Qe(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=s.i(n[1]),_!=="string"&&y.push(new Qe(`${o}[1]`,n[1],`string expected, ${_} found`)));for(let w=2;w<n.length;w++)_=s.i(n[w]),s.u(n[1])==="$type"?y=y.concat(Tr({key:`${o}[${w}]`,value:n[w],valueSpec:f.geometry_type,style:h.style,styleSpec:h.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&y.push(new Qe(`${o}[${w}]`,n[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<n.length;w++)y=y.concat(Hr({key:`${o}[${w}]`,value:n[w],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":_=s.i(n[1]),n.length!==2?y.push(new Qe(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&y.push(new Qe(`${o}[1]`,n[1],`string expected, ${_} found`))}return y}function On(h,n){const o=h.key,f=h.style,_=h.layer,y=h.styleSpec,w=h.value,S=h.objectKey,I=y[`${n}_${h.layerType}`];if(!I)return[];const D=S.match(/^(.*)-transition$/);if(n==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return pt({key:o,value:w,valueSpec:y.transition,style:f,styleSpec:y});const L=h.valueSpec||I[S];if(!L)return[new Ri(o,w,`unknown property "${S}"`)];let z;if(s.i(w)==="string"&&s.k(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(w))){const N=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new Qe(o,w,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${N}.`)]}const F=[];if(h.layerType==="symbol")S!=="text-field"||!f||f.glyphs||f.imports||F.push(new Qe(o,w,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&s.A(s.o(w))&&s.u(w.type)==="identity"&&F.push(new Qe(o,w,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&n==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&s.k(L)&&(s.B(L)||s.m(L))){const N=s.q(s.o(w),L),$=N.value.expression||N.value._styleExpression.expression;$&&!s.v($,["measure-light"])&&(S==="model-emissive-strength"&&s.x($)&&s.t($)||F.push(new Qe(o,w,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(pt({key:h.key,value:w,valueSpec:L,style:f,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:S}))}function Os(h){return On(h,"paint")}function xs(h){return On(h,"layout")}function is(h){let n=[];const o=h.value,f=h.key,_=h.style,y=h.styleSpec;o.type||o.ref||n.push(new Qe(f,o,'either "type" or "ref" is required'));let w=s.u(o.type);const S=s.u(o.ref);if(o.id){const I=s.u(o.id);for(let D=0;D<h.arrayIndex;D++){const L=_.layers[D];s.u(L.id)===I&&n.push(new Qe(f,o.id,`duplicate layer id "${o.id}", previously used at line ${L.id.__line__}`))}}if("ref"in o){let I;["type","source","source-layer","filter","layout"].forEach(D=>{D in o&&n.push(new Qe(f,o[D],`"${D}" is prohibited for ref layers`))}),_.layers.forEach(D=>{s.u(D.id)===S&&(I=D)}),I?I.ref?n.push(new Qe(f,o.ref,"ref cannot reference another ref layer")):w=s.u(I.type):typeof S=="string"&&n.push(new Qe(f,o.ref,`ref layer "${S}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(o.source){const I=_.sources&&_.sources[o.source],D=I&&s.u(I.type);I?D==="vector"&&w==="raster"?n.push(new Qe(f,o.source,`layer "${o.id}" requires a raster source`)):D==="raster"&&w!=="raster"?n.push(new Qe(f,o.source,`layer "${o.id}" requires a vector source`)):D!=="vector"||o["source-layer"]?D==="raster-dem"&&w!=="hillshade"?n.push(new Qe(f,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||D==="geojson"&&I.lineMetrics?w==="raster-particle"&&D!=="raster-array"&&n.push(new Qe(f,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):n.push(new Qe(f,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Qe(f,o.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new Qe(f,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new Qe(f,o.source,`source "${o.source}" not found`))}else n.push(new Qe(f,o,'missing required property "source"'));return n=n.concat(gi({key:f,value:o,valueSpec:y.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pt({key:`${f}.type`,value:o.type,valueSpec:y.layer.type,style:h.style,styleSpec:h.styleSpec,object:o,objectKey:"type"}),filter:I=>Mr(s.j({layerType:w},I)),layout:I=>gi({layer:o,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":D=>xs(s.j({layerType:w},D))}}),paint:I=>gi({layer:o,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":D=>Os(s.j({layerType:w,layer:o},D))}})}})),n}function Fn(h){const n=h.value,o=h.key,f=s.i(n);return f!=="string"?[new Qe(o,n,`string expected, ${f} found`)]:[]}const Pr={promoteId:function({key:h,value:n}){if(s.i(n)==="string")return Fn({key:h,value:n});{const o=[];for(const f in n)o.push(...Fn({key:`${h}.${f}`,value:n[f]}));return o}}};function Sr(h){const n=h.value,o=h.key,f=h.styleSpec,_=h.style;if(!n.type)return[new Qe(o,n,'"type" is required')];const y=s.u(n.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(n.url||n.tiles||w.push(new Ri(o,n,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(gi({key:o,value:n,valueSpec:f[`source_${y.replace("-","_")}`],style:h.style,styleSpec:f,objectElementValidators:Pr})),w;case"geojson":if(w=gi({key:o,value:n,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:Pr}),n.cluster)for(const S in n.clusterProperties){const[I,D]=n.clusterProperties[S],L=typeof I=="string"?[I,["accumulated"],["get",S]]:I;w.push(...Rn({key:`${o}.${S}.map`,value:D,expressionContext:"cluster-map"})),w.push(...Rn({key:`${o}.${S}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return w;case"video":return gi({key:o,value:n,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return gi({key:o,value:n,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new Qe(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tr({key:`${o}.type`,value:n.type,valueSpec:{values:ge(f)},style:_,styleSpec:f})}}function ge(h){return h.source.reduce((n,o)=>{const f=h[o];return f.type.type==="enum"&&(n=n.concat(Object.keys(f.type.values))),n},[])}function be(h){const n=h.value;let o=[];if(!n)return o;const f=s.i(n);return f!=="string"?(o=o.concat([new Qe(h.key,n,`string expected, "${f}" found`)]),o):(function(_){const y=_.indexOf("://")===-1;try{return new URL(_,y?"http://example.com":void 0),!0}catch{return!1}}(n)||(o=o.concat([new Qe(h.key,n,`invalid url "${n}"`)])),o)}function Xe(h){const n=h.value,o=h.styleSpec,f=o.light,_=h.style;let y=[];const w=s.i(n);if(n===void 0)return y;if(w!=="object")return y=y.concat([new Qe("light",n,`object expected, ${w} found`)]),y;for(const S in n){const I=S.match(/^(.*)-transition$/);y=y.concat(I&&f[I[1]]&&f[I[1]].transition?pt({key:S,value:n[S],valueSpec:o.transition,style:_,styleSpec:o}):f[S]?pt({key:S,value:n[S],valueSpec:f[S],style:_,styleSpec:o}):[new Qe(S,n[S],`unknown property "${S}"`)])}return y}function ft(h){const n=h.value;let o=[];if(!n)return o;const f=s.i(n);if(f!=="object")return o=o.concat([new Qe("light-3d",n,`object expected, ${f} found`)]),o;const _=h.styleSpec,y=_["light-3d"],w=h.key,S=h.style,I=h.style.lights;for(const z of["type","id"])if(!(z in n))return o=o.concat([new Qe("light-3d",n,`missing property ${z} on light`)]),o;if(n.type&&I)for(let z=0;z<h.arrayIndex;z++){const F=s.u(n.type),N=I[z];s.u(N.type)===F&&o.push(new Qe(w,n.id,`duplicate light type "${n.type}", previously defined at line ${N.id.__line__}`))}const D=`properties_light_${n.type}`;if(!(D in _))return o=o.concat([new Qe("light-3d",n,`Invalid light type ${n.type}`)]),o;const L=_[D];for(const z in n)if(z==="properties"){const F=n[z],N=s.i(F);if(N!=="object")return o=o.concat([new Qe("properties",F,`object expected, ${N} found`)]),o;for(const $ in F)o=o.concat(L[$]?pt({key:$,value:F[$],valueSpec:L[$],style:S,styleSpec:_}):[new Ri(h.key,F[$],`unknown property "${$}"`)])}else{const F=z.match(/^(.*)-transition$/);o=o.concat(F&&y[F[1]]&&y[F[1]].transition?pt({key:z,value:n[z],valueSpec:_.transition,style:S,styleSpec:_}):y[z]?pt({key:z,value:n[z],valueSpec:y[z],style:S,styleSpec:_}):[new Ri(z,n[z],`unknown property "${z}"`)])}return o}function ut(h){const n=h.value,o=h.key,f=h.style,_=h.styleSpec,y=_.terrain;let w=[];const S=s.i(n);if(n===void 0||S==="null")return w;if(S!=="object")return w=w.concat([new Qe("terrain",n,`object expected, ${S} found`)]),w;for(const I in n){const D=I.match(/^(.*)-transition$/);w=w.concat(D&&y[D[1]]&&y[D[1]].transition?pt({key:I,value:n[I],valueSpec:_.transition,style:f,styleSpec:_}):y[I]?pt({key:I,value:n[I],valueSpec:y[I],style:f,styleSpec:_}):[new Ri(I,n[I],`unknown property "${I}"`)])}if(n.source){const I=f.sources&&f.sources[n.source],D=I&&s.u(I.type);I?D!=="raster-dem"&&w.push(new Qe(o,n.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):w.push(new Qe(o,n.source,`source "${n.source}" not found`))}else w.push(new Qe(o,n,'terrain is missing required property "source"'));return w}function St(h){const n=h.value,o=h.style,f=h.styleSpec,_=f.fog;let y=[];const w=s.i(n);if(n===void 0)return y;if(w!=="object")return y=y.concat([new Qe("fog",n,`object expected, ${w} found`)]),y;for(const S in n){const I=S.match(/^(.*)-transition$/);y=y.concat(I&&_[I[1]]&&_[I[1]].transition?pt({key:S,value:n[S],valueSpec:f.transition,style:o,styleSpec:f}):_[S]?pt({key:S,value:n[S],valueSpec:_[S],style:o,styleSpec:f}):[new Ri(S,n[S],`unknown property "${S}"`)])}return y}const Vt={"*":()=>[],array:kt,boolean:function(h){const n=h.value,o=h.key,f=s.i(n);return f!=="boolean"?[new Qe(o,n,`boolean expected, ${f} found`)]:[]},number:rr,color:function(h){const n=h.key,o=h.value,f=s.i(o);return f!=="string"?[new Qe(n,o,`color expected, ${f} found`)]:s.y(o)===null?[new Qe(n,o,`color expected, "${o}" found`)]:[]},enum:Tr,filter:Mr,function:Kn,layer:is,object:gi,source:Sr,model:be,light:Xe,"light-3d":ft,terrain:ut,fog:St,string:Fn,formatted:function(h){return Fn(h).length===0?[]:Rn(h)},resolvedImage:function(h){return Fn(h).length===0?[]:Rn(h)},projection:function(h){const n=h.value,o=h.styleSpec,f=o.projection,_=h.style;let y=[];const w=s.i(n);if(w==="object")for(const S in n)y=y.concat(pt({key:S,value:n[S],valueSpec:f[S],style:_,styleSpec:o}));else w!=="string"&&(y=y.concat([new Qe("projection",n,`object or string expected, ${w} found`)]));return y},import:function(h){const{value:n,styleSpec:o}=h,{data:f,..._}=n;Object.defineProperty(_,"__line__",{value:n.__line__,enumerable:!1});let y=gi(s.j({},h,{value:_,valueSpec:o.import}));return s.u(_.id)===""&&y.push(new Qe(`${h.key}.id`,_,"import id can't be an empty string")),f&&(y=y.concat(xt(f,o,{key:`${h.key}.data`}))),y}};function pt(h,n=!1){const o=h.value,f=h.valueSpec,_=h.styleSpec;if(f.expression&&s.A(s.u(o)))return Kn(h);if(f.expression&&s.n(s.o(o)))return Rn(h);if(f.type&&Vt[f.type]){const y=Vt[f.type](h);return n===!0&&y.length>0&&s.i(h.value)==="array"?Rn(h):y}return gi(s.j({},h,{valueSpec:f.type?_[f.type]:f}))}function Ot(h){const n=h.value,o=h.key,f=Fn(h);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new Qe(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new Qe(o,n,'"glyphs" url must include a "{range}" token'))),f}function xt(h,n=s.D,o={}){return pt({key:o.key||"",value:h,valueSpec:n.$root,styleSpec:n,style:h,objectElementValidators:{glyphs:Ot,"*":()=>[]}})}function jt(h,n=s.D){return Be(xt(h,n))}const ii=h=>Be(Sr(h)),Qt=h=>Be(Xe(h)),Me=h=>Be(ft(h)),X=h=>Be(ut(h)),re=h=>Be(St(h)),de=h=>Be(is(h)),Pe=h=>Be(Mr(h)),Ne=h=>Be(Os(h)),Je=h=>Be(xs(h)),Et=h=>Be(be(h));function Be(h){return h.slice().sort((n,o)=>n.line&&o.line?n.line-o.line:0)}function Ct(h,n){let o=!1;if(n&&n.length)for(const f of n)f instanceof Ri?s.w(f.message):(h.fire(new s.a(new Error(f.message))),o=!0);return o}const ht=new s.F({anchor:new s.G(s.D.light.anchor),position:new s.H(s.D.light.position),color:new s.G(s.D.light.color),intensity:new s.G(s.D.light.intensity)});class Tt extends s.E{constructor(n,o="flat"){super(),this._transitionable=new s.J(ht),this.setLight(n,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,o,f={}){this._validate(Qt,n,f)||(this._transitionable.setTransitionOrValue(n),this.id=o)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,f){return(!f||f.validate!==!1)&&Ct(this,n.call(jt,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.D})))}}const hi=new s.F({source:new s.G(s.D.terrain.source),exaggeration:new s.G(s.D.terrain.exaggeration)});let Yi=class extends s.E{constructor(h,n,o,f){super(),this.scope=o,this._transitionable=new s.J(hi,o,f),this._transitionable.setTransitionOrValue(h,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(h,n){this._transitionable.setTransitionOrValue(h,n)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new s.K(h)).get("exaggeration")}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof s.Z}};const mn=45,Ki=65,qi=.05;function Ui(h,n,o,f){const _=s.O(mn,Ki,o),[y,w]=Zi(h,f);let S=1-Math.min(1,Math.exp((n-y)/(w-y)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*_*h.alpha}function Zi(h,n){const o=.5/Math.tan(.5*n);return[h.range[0]+o,h.range[1]+o]}function an(h,n,o,f,_){const y=s.N.transformMat4([],[n,o,f],_.mercatorFogMatrix);return Ui(h,s.N.length(y),_.pitch,_._fov)}function Jn(h,n,o,f,_,y,w){const S=[[o,f,0],[_,f,0],[_,y,0],[o,y,0]];let I=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const L of S){const z=s.N.transformMat4([],L,n),F=s.N.length(z);I=Math.min(I,F),D=Math.max(D,F)}return[Ui(h,I,w.pitch,w._fov),Ui(h,D,w.pitch,w._fov)]}const hn=new s.F({range:new s.G(s.D.fog.range),color:new s.G(s.D.fog.color),"high-color":new s.G(s.D.fog["high-color"]),"space-color":new s.G(s.D.fog["space-color"]),"horizon-blend":new s.G(s.D.fog["horizon-blend"]),"star-intensity":new s.G(s.D.fog["star-intensity"]),"vertical-range":new s.G(s.D.fog["vertical-range"])});class Dr extends s.E{constructor(n,o,f,_){super(),this._transitionable=new s.J(hn,f,new Map(_)),this.set(n,_),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new s.Q(hn)}get state(){const n=this._transform,o=n.projection.name==="globe",f=s.S(n.zoom),_=this.properties.get("range"),y=[.5,3];return{range:o?[s.U(y[0],_[0],f),s.U(y[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,o,f={}){if(this._validate(re,n,f))return;const _=s.e({},n);for(const y of Object.keys(s.D.fog))_[y]===void 0&&(_[y]=s.D.fog[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.O(mn,Ki,n))*o.a}getOpacityAtLatLng(n,o){return this._transform.projection.supportsFog?function(f,_,y){const w=s.L.fromLngLat(_),S=y.elevation?y.elevation.getAtPointOrZero(w):0;return an(f,w.x,w.y,S,y)}(this.state,n,o):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Jn(this.state,o,0,0,s.V,s.V,this._transform)}getOpacityForBounds(n,o,f,_,y){return this._transform.projection.supportsFog?Jn(this.state,n,o,f,_,y,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Zi(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const f of o){const _=n.points[f];let y;if(_[2]>=0)y=_;else{const w=n.points[f-4];y=s.W(w,_,w[2]/(w[2]-_[2]))}if(an(this.state,y[0],y[1],0,this._transform)>=qi)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,f){return(!f||f.validate!==!1)&&Ct(this,n.call(jt,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.D})))}}class Er extends s.E{constructor(n,o,f,_){super(),this.scope=f,this._options=n,this.properties=new s.Q(o),this._transitionable=new s.J(o,f,new Map(_)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,o){this._options=n,this._transitionable.setTransitionOrValue(n.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const kr=new s.F({color:new s.G(s.D.properties_light_ambient.color),intensity:new s.G(s.D.properties_light_ambient.intensity)}),Un=new s.F({direction:new s.X(s.D.properties_light_directional.direction),color:new s.G(s.D.properties_light_directional.color),intensity:new s.G(s.D.properties_light_directional.intensity),"cast-shadows":new s.G(s.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.G(s.D.properties_light_directional["shadow-intensity"])});class Bn{constructor(n,o,f,_){this.screenBounds=n,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(n,o){let f,_;if(n instanceof s.P||typeof n[0]=="number"){const y=s.P.convert(n);f=[y],_=o.isPointAboveHorizon(y)}else{const y=s.P.convert(n[0]),w=s.P.convert(n[1]);f=[y,w],_=s.Y(y,w).every(S=>o.isPointAboveHorizon(S))}return new Bn(f,o.getCameraPoint(),_,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],_=s.Y(o,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(_[3]=this.cameraPoint)),s._(_,n)}bufferedCameraGeometryGlobe(n){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],_=s.Y(o,f,n),y=this.cameraPoint.clone();switch(3*((y.y>o.y)+(y.y>f.y))+((y.x>o.x)+(y.x>f.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(n,o,f,_=0){const y=n.queryPadding/o._pixelsPerMercatorPixel+1,w=f?this._bufferedCameraMercator(y,o):this._bufferedScreenMercator(y,o);let S=n.tileID.wrap+(w.unwrapped?_:0);const I=w.polygon.map(H=>s.$(n.tileTransform,H,S));if(!s.a0(I,0,0,s.V,s.V))return;S=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const D=this.screenGeometryMercator.polygon.map(H=>s.a1(n.tileTransform,H,S)),L=D.map(H=>new s.P(H[0],H[1])),z=o.getFreeCameraOptions().position||new s.L(0,0,0),F=s.a1(n.tileTransform,z,S),N=D.map(H=>{const U=s.N.sub(H,H,F);return s.N.normalize(U,U),new s.a2(F,U)}),$=s.a3(n,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:N,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(G=s.a4(I),G.min.x=s.aa(G.min.x,0,s.V),G.min.y=s.aa(G.min.y,0,s.V),G.max.x=s.aa(G.max.x,0,s.V),G.max.y=s.aa(G.max.y,0,s.V),G),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:$};var G}_bufferedScreenMercator(n,o){const f=et(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),o):{polygon:this.bufferedScreenGeometry(n).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(n,o){const f=et(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),o):{polygon:this.bufferedCameraGeometry(n).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(n,o){const f=function(y,w){const S=s.a6.multiply([],w.pixelMatrix,w.globeMatrix),I=[0,-s.ab,0,1],D=[0,s.ab,0,1],L=[0,0,0,1];s.a7.transformMat4(I,I,S),s.a7.transformMat4(D,D,S),s.a7.transformMat4(L,L,S);const z=new s.P(I[0]/I[3],I[1]/I[3]),F=new s.P(D[0]/D[3],D[1]/D[3]),N=s.a8(y,z)&&I[3]<L[3],$=s.a8(y,F)&&D[3]<L[3];if(!N&&!$)return null;const G=function(ne,le,ce){for(let pe=1;pe<ne.length;pe++){const Se=Ve(le.pointCoordinate3D(ne[pe-1]).x),_e=Ve(le.pointCoordinate3D(ne[pe]).x);if(ce<0){if(Se<_e)return{idx:pe,t:-Se/(_e-1-Se)}}else if(_e<Se)return{idx:pe,t:(1-Se)/(_e+1-Se)}}return null}(y,w,N?-1:1);if(!G)return null;const{idx:H,t:U}=G;let Y=H>1?Fe(y.slice(0,H),w):[],te=H<y.length?Fe(y.slice(H),w):[];Y=Y.map(ne=>new s.P(Ve(ne.x),ne.y)),te=te.map(ne=>new s.P(Ve(ne.x),ne.y));const J=[...Y];J.length===0&&J.push(te[te.length-1]);const ie=s.U(J[J.length-1].y,(te.length===0?Y[0]:te[0]).y,U);let W;return W=N?[new s.P(0,ie),new s.P(0,0),new s.P(1,0),new s.P(1,ie)]:[new s.P(1,ie),new s.P(1,1),new s.P(0,1),new s.P(0,ie)],J.push(...W),te.length===0?J.push(Y[0]):J.push(...te),{polygon:J.map(ne=>new s.L(ne.x,ne.y)),unwrapped:!1}}(n,o);if(f)return f;const _=function(y,w){let S=!1,I=-1/0,D=0;for(let z=0;z<y.length-1;z++)y[z].x>I&&(I=y[z].x,D=z);for(let z=0;z<y.length-1;z++){const F=(D+z)%(y.length-1),N=y[F],$=y[F+1];Math.abs(N.x-$.x)>.5&&(N.x<$.x?(N.x+=1,F===0&&(y[y.length-1].x+=1)):($.x+=1,F+1===y.length-1&&(y[0].x+=1)),S=!0)}const L=s.a5(w.center.lng);return S&&L<Math.abs(L-1)&&y.forEach(z=>{z.x-=1}),{polygon:y,unwrapped:S}}(Fe(n,o).map(y=>new s.P(Ve(y.x),y.y)),o);return{polygon:_.polygon.map(y=>new s.L(y.x,y.y)),unwrapped:_.unwrapped}}}function Fe(h,n){return s.a9(h,o=>{const f=n.pointCoordinate3D(o);o.x=f.x,o.y=f.y},1/256)}function Ve(h){return h<0?1+h%1:h%1}function et(h){return 100*h|0}function at(h,n,o,f,_){const y=function(w,S){if(w)return _(w);if(S){h.url&&S.tiles&&h.tiles&&delete h.tiles;const I=s.ac(s.e(S,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(I.vectorLayers=S.vector_layers,I.vectorLayerIds=I.vectorLayers.map(D=>D.id)),S.raster_layers&&(I.rasterLayers=S.raster_layers,I.rasterLayerIds=I.rasterLayers.map(D=>D.id)),I.tiles=n.canonicalizeTileset(I,h.url),_(null,I)}};return h.url?s.g(n.transformRequest(n.normalizeSourceURL(h.url,null,o,f),s.R.Source),y):s.f.frame(()=>y(null,h))}class nt{constructor(n,o,f){this.bounds=s.ad.convert(this.validateBounds(n)),this.minzoom=o||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const o=Math.pow(2,n.z),f=Math.floor(s.a5(this.bounds.getWest())*o),_=Math.floor(s.ae(this.bounds.getNorth())*o),y=Math.ceil(s.a5(this.bounds.getEast())*o),w=Math.ceil(s.ae(this.bounds.getSouth())*o);return n.x>=f&&n.x<y&&n.y>=_&&n.y<w}}class mt extends s.E{constructor(n,o,f,_){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.ac(o,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new s.af}load(n){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=at(this._options,this.map._requestManager,o,f,(_,y)=>{this._tileJSONRequest=null,this._loaded=!0,_?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.a(_))):y&&(s.e(this,y),y.bounds&&(this.tileBounds=new nt(y.bounds,this.minzoom,this.maxzoom)),s.aj(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(_)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.e({},this._options)}loadTile(n,o){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(f,s.R.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster};if(_.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=o:n.request=n.actor.send("reloadTile",_,y.bind(this));else if(n.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",_,y.bind(this),void 0,!0);else{const w=s.ah.call({deduped:this._deduped},_,(S,I)=>{S||!I?y.call(this,S):(_.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},n.actor&&n.actor.send("loadTile",_,y.bind(this),void 0,!0))},!0);n.request={cancel:w}}function y(w,S){return delete n.request,n.aborted?o(null):w&&w.status!==404?o(w):(S&&S.resourceTiming&&(n.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&n.setExpiryData(S),n.loadVectorData(S,this.map.painter),s.ai(this.dispatcher),o(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class _t extends s.E{constructor(n,o,f,_){super(),this.id=n,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},o),s.e(this,s.ac(o,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"})),this._tileJSONRequest=at(this._options,this.map._requestManager,null,null,(o,f)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new s.a(o)):f&&(s.e(this,f),f.bounds&&(this.tileBounds=new nt(f.bounds,this.minzoom,this.maxzoom)),s.aj(f.tiles),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(o)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,o){const f=s.f.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=s.d(this.map._requestManager.transformRequest(_,s.R.Tile),(y,w,S,I)=>(delete n.request,n.aborted?(n.state="unloaded",o(null)):y?(n.state="errored",o(y)):w?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:S,expires:I}),n.setTexture(w,this.map.painter),n.state="loaded",s.ai(this.dispatcher),void o(null)):o(null)))}abortTile(n,o){n.request&&(n.request.cancel(),delete n.request),o()}unloadTile(n,o){n.texture&&n.texture instanceof s.T?(n.destroy(!0),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class st extends _t{constructor(n,o,f,_){super(n,o,f,_),this.type="raster-array",this.maxzoom=22,this._options=s.e({type:"raster-array"},o)}triggerRepaint(n){const o=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);o&&o.enabled&&f&&o._clearRenderCacheForTile(f.id,n.tileID),this.map.triggerRepaint()}loadTile(n,o){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,s.R.Tile);n.requestParams=_,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(y,w,S,I)=>{if(delete n.request,n.aborted)return n.state="unloaded",o(null);if(y)return y.code===20?void 0:(n.state="errored",o(y));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:S,expires:I}),n.state="empty",o(null)})}unloadTile(n){const o=n.texture;o&&o instanceof s.T?(n.destroy(!0),this.map.painter.saveTileTexture(o)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,o,f){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(o,f,(_,y)=>{if(_)return n.state="errored",this.fire(new s.a(_)),void this.triggerRepaint(n);y&&(n.setTexture(y,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:y})=>y===n),f=o&&o.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(n,o,f){if(!n)return;const _=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;o instanceof s.an?y=o.paint.get("raster-array-band"):o instanceof s.ao&&(y=o.paint.get("raster-particle-array-band"));const w=y||this.getInitialBand(_);if(w!=null)if(n.textureDescriptor){if(!n.updateNeeded(_,w)||f)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,_,w)}}const vt=32,lt=33,Kt=new Uint16Array(8184);for(let h=0;h<2046;h++){let n=h+2,o=0,f=0,_=0,y=0,w=0,S=0;for(1&n?_=y=w=vt:o=f=S=vt;(n>>=1)>1;){const D=o+_>>1,L=f+y>>1;1&n?(_=o,y=f,o=w,f=S):(o=_,f=y,_=w,y=S),w=D,S=L}const I=4*h;Kt[I+0]=o,Kt[I+1]=f,Kt[I+2]=_,Kt[I+3]=y}const Ti=new Uint16Array(2178),Nt=new Uint8Array(1089),en=new Uint16Array(1089);function yn(h){return h===0?-.03125:h===32?.03125:0}class on{constructor(n,o,f,_){this.id=on.uniqueIdxCounter,on.uniqueIdxCounter++,this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||_||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=on.uniqueIdxCounter,on.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}on.uniqueIdxCounter=0;const jn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class dr{constructor(n,o,f,_,y,w){this.length=o.length,this.attributes=f,this.itemSize=o.bytesPerElement,this.dynamicDraw=_,this.instanceCount=w,this.context=n;const S=n.gl;this.buffer=S.createBuffer(),n.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,o){for(let f=0;f<this.attributes.length;f++){const _=o.attributes[this.attributes[f].name];_!==void 0&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,o,f){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],w=o.attributes[y.name];w!==void 0&&n.vertexAttribPointer(w,y.components,n[jn[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(n,o,f){for(let _=0;_<this.attributes.length;_++){const y=o.attributes[this.attributes[_].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(y,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ni{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wr extends Ni{getDefault(){return s.ax.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class vs extends Ni{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class fr extends Ni{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Ml extends Ni{getDefault(){return[!0,!0,!0,!0]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class po extends Ni{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class wa extends Ni{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class eh extends Ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const o=this.current;(n.func!==o.func||n.ref!==o.ref||n.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Ho extends Ni{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class th extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=n,this.dirty=!1}}class Ta extends Ni{getDefault(){return[0,1]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Gf extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=n,this.dirty=!1}}class Uc extends Ni{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class ih extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.BLEND):o.disable(o.BLEND),this.current=n,this.dirty=!1}}class jc extends Ni{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class nh extends Ni{getDefault(){return s.ax.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Or extends Ni{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Nn extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=n,this.dirty=!1}}class Mi extends Ni{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class $f extends Ni{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Gc=class extends Ni{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class rh extends Ni{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class q_ extends Ni{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Fs extends Ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class sh extends Ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class H_ extends Ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Ma extends Ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class wt extends Ni{getDefault(){return null}set(n){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ji extends Ni{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Gi extends Ni{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class ns extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Sa extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ci extends Ni{constructor(n,o){super(n),this.context=n,this.parent=o}getDefault(){return null}}class $c extends Ci{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Ea extends Ci{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Sl extends Ci{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Fr extends Ea{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class zn{constructor(n,o,f,_,y){this.context=n,this.width=o,this.height=f;const w=this.framebuffer=n.gl.createFramebuffer();_&&(this.colorAttachment=new $c(n,w)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Ea(n,w):new Sl(n,w))}destroy(){const n=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&n.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&n.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&n.deleteTexture(o)}n.deleteFramebuffer(this.framebuffer)}}class qt{constructor(n,o,f){this.func=n,this.mask=o,this.range=f}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const Wo=7680;class ei{constructor(n,o,f,_,y,w){this.test=n,this.ref=o,this.mask=f,this.fail=_,this.depthFail=y,this.pass=w}}ei.disabled=new ei({func:519,mask:0},0,0,Wo,Wo,Wo);const mo=771;class mi{constructor(n,o,f,_){this.blendFunction=n,this.blendColor=o,this.mask=f,this.blendEquation=_}}mi.Replace=[1,0,1,0],mi.disabled=new mi(mi.Replace,s.ax.transparent,[!1,!1,!1,!1]),mi.unblended=new mi(mi.Replace,s.ax.transparent,[!0,!0,!0,!0]),mi.alphaBlended=new mi([1,mo,1,mo],s.ax.transparent,[!0,!0,!0,!0]),mi.multiply=new mi([774,0,774,0],s.ax.transparent,[!0,!0,!0,!0]);const Aa=1029,pr=2305;class Ht{constructor(n,o,f){this.enable=n,this.mode=o,this.frontFace=f}}Ht.disabled=new Ht(!1,Aa,pr),Ht.backCCW=new Ht(!0,Aa,pr),Ht.backCW=new Ht(!0,Aa,2304),Ht.frontCW=new Ht(!0,1028,2304),Ht.frontCCW=new Ht(!0,1028,pr);class qf{constructor(n,o){this.gl=n,this.clearColor=new Wr(this),this.clearDepth=new vs(this),this.clearStencil=new fr(this),this.colorMask=new Ml(this),this.depthMask=new po(this),this.stencilMask=new wa(this),this.stencilFunc=new eh(this),this.stencilOp=new Ho(this),this.stencilTest=new th(this),this.depthRange=new Ta(this),this.depthTest=new Gf(this),this.depthFunc=new Uc(this),this.blend=new ih(this),this.blendFunc=new jc(this),this.blendColor=new nh(this),this.blendEquation=new Or(this),this.cullFace=new Nn(this),this.cullFaceSide=new Mi(this),this.frontFace=new $f(this),this.program=new Gc(this),this.activeTexture=new rh(this),this.viewport=new q_(this),this.bindFramebuffer=new Fs(this),this.bindRenderbuffer=new sh(this),this.bindTexture=new H_(this),this.bindVertexBuffer=new Ma(this),this.bindElementBuffer=new wt(this),this.bindVertexArrayOES=new ji(this),this.pixelStoreUnpack=new Gi(this),this.pixelStoreUnpackPremultiplyAlpha=new ns(this),this.pixelStoreUnpackFlipY=new Sa(this),this.options=o?{...o}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,o,f){return new on(this,n,o,f)}createVertexBuffer(n,o,f,_,y){return new dr(this,n,o,f,_,y)}createRenderbuffer(n,o,f){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,n,o,f),this.bindRenderbuffer.set(null),y}createFramebuffer(n,o,f,_){return new zn(this,n,o,f,_)}clear({color:n,depth:o,stencil:f,colorMask:_}){const y=this.gl;let w=0;n&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(_||[!0,!0,!0,!0])),o!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),f!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){B(n.blendFunction,mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Zo=s.ay([{name:"a_pos",type:"Float32",components:3}]);class Gn{constructor(n,o,f,_){const y={width:f[0],height:f[1],data:null},w=n.gl;this.targetColorTexture=new s.T(n,y,w.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,y,w.RGBA,{useMipmap:!1}),this.context=n,this.setNumParticles(o,_),this.lastInvalidatedAt=0}setNumParticles(n,o){if(this.numParticles===o)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const f=new s.az;f.reserve(Math.round(o));const _=s.aA(n.key);for(let y=0;y<o;y++)f.emplaceBack(_(),_(),_());this.particleVertices0=this.context.createVertexBuffer(f,Zo.members,!0),this.particleVertices1=this.context.createVertexBuffer(f,Zo.members,!0),this.particleSegment=s.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=o}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const rs={type:2,extent:s.V,loadGeometry:()=>[[new s.P(0,0),new s.P(s.V+1,0),new s.P(s.V+1,s.V+1),new s.P(0,s.V+1),new s.P(0,0)]]};class _o{constructor(n,o,f,_,y){this.tileID=n,this.uid=s.aC(),this.uses=0,this.tileSize=o,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<s.f.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,f){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(_,y){const w={};if(!y)return w;for(const S of _){const I=S.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(I.length!==0){S.layers=I,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(D=>I.filter(L=>L.id===D)[0]));for(const D of I)w[D.fqid]=S}}return w}(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof s.aE){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof s.aE&&y.hasRTLText){this.hasRTLText=!0,s.aF();break}}this.queryPadding=0;for(const _ in this.buckets){const y=this.buckets[_],w=o.style.getOwnLayer(_);if(!w)continue;const S=w.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,S)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.aD}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(n)}const o=n.gl,f=this.imageAtlas;if(f&&!f.uploaded){const _=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new s.T(n,f.image,o.RGBA,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(n,o,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,f),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=o.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this._lastUpdatedBrightness=_,this.updateBuckets(void 0,o)))}queryRenderedFeatures(n,o,f,_,y,w,S,I){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:S,transform:w,params:y,tileTransform:this.tileTransform},n,o,f):{}}querySourceFeatures(n,o){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),y=o?o.sourceLayer:"",w=_._geojsonTileLayer||_[y];if(!w)return;const S=s.aG(o&&o.filter),{z:I,x:D,y:L}=this.tileID.canonical,z={z:I,x:D,y:L};for(let F=0;F<w.length;F++){const N=w.feature(F);if(S.needGeometry){const H=s.aH(N,!0);if(!S.filter(new s.K(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!S.filter(new s.K(this.tileID.overscaledZ),N))continue;const $=f.getId(N,y),G=new s.aI(N,I,D,L,$);G.tile=z,n.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const n in this.buckets)if(this.buckets[n].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const f=s.aJ(n.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{const y=this.expirationTime-o;y?this.expirationTime=f+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&o&&this.updateBuckets(n,o)}updateBuckets(n,o){if(!this.latestFeatureIndex)return;const f=this.latestFeatureIndex.loadVTLayers(),_=o.style.listImages(),y=o.style.getBrightness();for(const w in this.buckets){if(!o.style.hasLayer(w))continue;const S=this.buckets[w],I=S.layers[0].sourceLayer||"_geojsonTileLayer",D=f[I];let L={};if(n&&(L=n[I],!D||!L||Object.keys(L).length===0))continue;if(S.update(L,D,_,this.imageAtlas&&this.imageAtlas.patternPositions||{},y),S instanceof s.aK||S instanceof s.aL){const F=o.style.getOwnSourceCache(S.layers[0].source);o._terrain&&o._terrain.enabled&&F&&S.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(F.id,this.tileID)}const z=o&&o.style&&o.style.getOwnLayer(w);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.f.now()+n}setTexture(n,o){const f=o.context,_=f.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n,{useMipmap:!0}):(this.texture=new s.T(f,n,_.RGBA,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(n,o){const f={};for(const _ of o)f[_]=!0;this.dependencies[n]=f}hasDependency(n,o){for(const f of n){const _=this.dependencies[f];if(_){for(const y of o)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const f=s.aM(rs,this.tileID.canonical,this.tileTransform)[0],_=new s.aN,y=new s.aO;for(let w=0;w<f.length;w++){const{x:S,y:I}=f[w];_.emplaceBack(S,I),y.emplaceBack(w)}y.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(y),this._tileDebugBuffer=n.createVertexBuffer(_,s.aP.members),this._tileDebugSegments=s.aB.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const f=s.aM(rs,this.tileID.canonical,this.tileTransform)[0];let _,y;if(this.isRaster){const w=function(S,I){const D=s.as(S,I),L=Math.pow(2,S.z);for(let H=0;H<lt;H++)for(let U=0;U<lt;U++){const Y=s.at((S.x+(U+yn(U))/vt)/L),te=s.au((S.y+(H+yn(H))/vt)/L),J=I.project(Y,te),ie=H*lt+U;Ti[2*ie+0]=Math.round((J.x*D.scale-D.x)*s.V),Ti[2*ie+1]=Math.round((J.y*D.scale-D.y)*s.V)}Nt.fill(0),en.fill(0);for(let H=2045;H>=0;H--){const U=4*H,Y=Kt[U+0],te=Kt[U+1],J=Kt[U+2],ie=Kt[U+3],W=Y+J>>1,ne=te+ie>>1,le=W+ne-te,ce=ne+Y-W,pe=te*lt+Y,Se=ie*lt+J,_e=ne*lt+W,ze=Math.hypot((Ti[2*pe+0]+Ti[2*Se+0])/2-Ti[2*_e+0],(Ti[2*pe+1]+Ti[2*Se+1])/2-Ti[2*_e+1])>=16;Nt[_e]=Nt[_e]||(ze?1:0),H<1022&&(Nt[_e]=Nt[_e]||Nt[(te+ce>>1)*lt+(Y+le>>1)]||Nt[(ie+ce>>1)*lt+(J+le>>1)])}const z=new s.av,F=new s.aw;let N=0;function $(H,U){const Y=U*lt+H;return en[Y]===0&&(z.emplaceBack(Ti[2*Y+0],Ti[2*Y+1],H*s.V/vt,U*s.V/vt),en[Y]=++N),en[Y]-1}function G(H,U,Y,te,J,ie){const W=H+Y>>1,ne=U+te>>1;if(Math.abs(H-J)+Math.abs(U-ie)>1&&Nt[ne*lt+W])G(J,ie,H,U,W,ne),G(Y,te,J,ie,W,ne);else{const le=$(H,U),ce=$(Y,te),pe=$(J,ie);F.emplaceBack(le,ce,pe)}}return G(0,0,vt,vt,vt,0),G(vt,vt,0,0,0,vt),{vertices:z,indices:F}}(this.tileID.canonical,o);_=w.vertices,y=w.indices}else{_=new s.av,y=new s.aw;for(const{x:S,y:I}of f)_.emplaceBack(S,I,0,0);const w=s.aQ(_.int16,void 0,4);for(let S=0;S<w.length;S+=3)y.emplaceBack(w[S],w[S+1],w[S+2])}this._tileBoundsBuffer=n.createVertexBuffer(_,s.aR.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(y),this._tileBoundsSegments=s.aB.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(n,o){const f=o.projection;if(!f||f.name!=="globe"||o.freezeTileCoverage)return;const _=this.tileID.canonical,y=s.aS(_,o),w=s.aT(y),S=s.S(o.zoom);let I;S>0&&(I=s.a6.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,_,o,w,I,S),this._makeGlobeTileDebugTextBuffer(n,_,o,w,I,S)}_globePoint(n,o,f,_,y,w,S){let I=s.aU(n,o,f);if(w){const D=1<<f.z,L=s.a5(_.center.lng),z=s.ae(_.center.lat),F=(f.x+.5)/D-L;let N=0;F>.5?N=-1:F<-.5&&(N=1);let $=(n/s.V+f.x)/D+N,G=(o/s.V+f.y)/D;$=($-L)*_._pixelsPerMercatorPixel+L,G=(G-z)*_._pixelsPerMercatorPixel+z;const H=[$*_.worldSize,G*_.worldSize,0];s.N.transformMat4(H,H,w),I=s.aV(I,H,S)}return s.N.transformMat4(I,I,y)}_makeGlobeTileDebugBorderBuffer(n,o,f,_,y,w){const S=new s.aN,I=new s.aO,D=new s.aW,L=(F,N,$,G,H)=>{const U=($-F)/(H-1),Y=(G-N)/(H-1),te=S.length;for(let J=0;J<H;J++){const ie=F+J*U,W=N+J*Y;S.emplaceBack(ie,W);const ne=this._globePoint(ie,W,o,f,_,y,w);D.emplaceBack(ne[0],ne[1],ne[2]),I.emplaceBack(te+J)}},z=s.V;L(0,0,z,0,16),L(z,0,z,z,16),L(z,z,0,z,16),L(0,z,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(I),this._tileDebugBuffer=n.createVertexBuffer(S,s.aP.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(D,s.aX.members),this._tileDebugSegments=s.aB.simpleSegment(0,0,S.length,I.length)}_makeGlobeTileDebugTextBuffer(n,o,f,_,y,w){const S=s.V/4,I=new s.aN,D=new s.aw,L=new s.aW,z=25;D.reserve(32),I.reserve(z),L.reserve(z);const F=(N,$)=>z*N+$;for(let N=0;N<z;N++){const $=N*S;for(let G=0;G<z;G++){const H=G*S;I.emplaceBack(H,$);const U=this._globePoint(H,$,o,f,_,y,w);L.emplaceBack(U[0],U[1],U[2])}}for(let N=0;N<4;N++)for(let $=0;$<4;$++){const G=F(N,$),H=F(N,$+1),U=F(N+1,$),Y=F(N+1,$+1);D.emplaceBack(G,H,U),D.emplaceBack(U,H,Y)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(D),this._tileDebugTextBuffer=n.createVertexBuffer(I,s.aP.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(L,s.aX.members),this._tileDebugTextSegments=s.aB.simpleSegment(0,0,z,32)}destroy(n=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const qs={vector:mt,raster:_t,"raster-dem":class extends _t{constructor(h,n,o,f){super(h,n,o,f),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(h,n){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,y){_&&(h.state="errored",n(_)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",n(null))}h.request=s.d(this.map._requestManager.transformRequest(o,s.R.Tile),(function(_,y,w,S){if(delete h.request,h.aborted)h.state="unloaded",n(null);else if(_)h.state="errored",n(_);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:w,expires:S});const I=ImageBitmap&&y instanceof ImageBitmap&&s.ak(),D=1-(y.width-s.al(y.width))/2;D<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const L=I?y:s.f.getImageData(y,D),z={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:D};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",z,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const n=h.canonical,o=Math.pow(2,n.z),f=(n.x-1+o)%o,_=n.x===0?h.wrap-1:h.wrap,y=(n.x+1+o)%o,w=n.x+1===o?h.wrap+1:h.wrap,S={};return S[new s.am(h.overscaledZ,_,n.z,f,n.y).key]={backfilled:!1},S[new s.am(h.overscaledZ,w,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(S[new s.am(h.overscaledZ,_,n.z,f,n.y-1).key]={backfilled:!1},S[new s.am(h.overscaledZ,h.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new s.am(h.overscaledZ,w,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<o&&(S[new s.am(h.overscaledZ,_,n.z,f,n.y+1).key]={backfilled:!1},S[new s.am(h.overscaledZ,h.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new s.am(h.overscaledZ,w,n.z,y,n.y+1).key]={backfilled:!1}),S}},"raster-array":st,geojson:class extends s.E{constructor(h,n,o,f){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(f),this._data=n.data,this._options=s.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=s.V/this.tileSize;this.workerOptions=s.e({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:s.V,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.V,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterChildren(h,n){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterLeaves(h,n,o,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:n,offset:o},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.b("dataloading",{dataType:"source"})),this._loaded=!1;const h=s.e({},this.workerOptions);h.scope=this.scope;const n=this._data;typeof n=="string"?(h.request=this.map._requestManager.transformRequest(s.f.resolveURL(n),s.R.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(o,f)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new s.a(o));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(_.resourceTiming=f.resourceTiming[this.id]),this.fire(new s.b("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,n){const o=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const f={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};h.request=this.actor.send(o,f,(_,y)=>(delete h.request,h.destroy(),h.aborted?n(null):_?n(_):(h.loadVectorData(y,this.map.painter,o==="reloadTile"),n(null))),void 0,o==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.ap{constructor(h,n,o,f){super(h,n,o,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const n of h.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aq(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new s.a(n)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const n=this.video.seekable;h<n.start(0)||h>n.end(0)?this.fire(new s.a(new Qe(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,n=h.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(h,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.ap,model:class extends s.E{constructor(h,n,o,f){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const h=[];for(const n in this._options.models){const o=this._options.models[n],f=s.l(this.map._requestManager.transformRequest(o.uri,s.R.Model).url).then(_=>{if(!_)return;const y=s.c(_),w=new s.M(n,o.position,o.orientation,y);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(_=>{this.fire(new s.a(new Error(`Could not load model ${n} from ${o.uri}: ${_.message}`)))});h.push(f)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new s.a(new Error(`Could not load models: ${n.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,n){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(h,n,o,f){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=at(this._options,this.map._requestManager,n,o,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new s.a(f))):_&&(s.e(this,_),_.bounds&&(this.tileBounds=new nt(_.bounds,this.minzoom,this.maxzoom)),s.aj(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),h&&h(f)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,n){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(o,s.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=n;else{if(h.buckets){const y=Object.values(h.buckets);for(const w of y)w.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",f,_.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(y,w){return h.aborted?n(null):y&&y.status!==404?n(y):(w&&(w.resourceTiming&&(h.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&h.setExpiryData(w),h.buckets={...h.buckets,...w.buckets},w.featureIndex&&(h.latestFeatureIndex=w.featureIndex)),h.state="loaded",void n(null))}}serialize(){return s.e({},this._options)}},canvas:class extends s.ap{constructor(h,n,o,f){super(h,n,o,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new s.a(new Qe(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a(new Qe(`sources.${h}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.a(new Qe(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.a(new Qe(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a(new Qe(`sources.${h}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof s.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends s.E{constructor(h,n,o,f){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new nt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.e(this,s.ac(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:n,y:o,z:f}=h.canonical;return this._implementation.hasTile({x:n,y:o,z:f})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,n){const{x:o,y:f,z:_}=h.tileID.canonical,y=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:o,y:f,z:_},{signal:y.signal})).then((function(w){return delete h.request,h.aborted?(h.state="unloaded",n(null)):w===void 0?(h.state="errored",n(null)):w===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",n(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(w)?(this.loadTileData(h,w),h.state="loaded",void n(null)):(h.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(h.state="errored",n(w))}),h.request.cancel=()=>y.abort()}loadTileData(h,n){h.setTexture(n,this._map.painter)}unloadTile(h,n){if(h.texture&&h.texture instanceof s.T?(h.destroy(!0),h.texture&&h.texture instanceof s.T&&this._map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:o,y:f,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:o,y:f,z:_})}n()}abortTile(h,n){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=s.ag(this.id,this.scope);this._map.style.clearSource(h)}_update(){this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))}}},$n=function(h,n,o,f){const _=new qs[n.type](h,n,o,f);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return s.aY(["load","abort","unload","serialize","prepare"],_),_};function oh(h,n){const o=s.a6.identity([]);return s.a6.scale(o,o,[.5*h.width,.5*-h.height,1]),s.a6.translate(o,o,[1,-1,0]),s.a6.multiply(o,o,h.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(o)}function ah(h,n,o,f,_,y,w,S=!1){const I=h.tilesIn(f,w,S);I.sort(Ia);const D=[];for(const z of I)D.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(n,o,h._state,z,_,y,oh(h.transform,z.tile.tileID),S)});const L=function(z){const F={},N={};for(const $ of z){const G=$.queryResults,H=$.wrappedTileID,U=N[H]=N[H]||{};for(const Y in G){const te=G[Y],J=U[Y]=U[Y]||{},ie=F[Y]=F[Y]||[];for(const W of te)J[W.featureIndex]||(J[W.featureIndex]=!0,ie.push(W))}}return F}(D);for(const z in L)L[z].forEach(F=>{const N=F.feature,$=N.layer;$&&$.type!=="background"&&$.type!=="sky"&&$.type!=="slot"&&(N.source=$.source,$["source-layer"]&&(N.sourceLayer=$["source-layer"]),N.state=N.id!==void 0?h.getFeatureState($["source-layer"],N.id):{})});return L}function Hs(h,n){const o=h.getRenderableIds().map(y=>h.getTileByID(y)),f=[],_={};for(let y=0;y<o.length;y++){const w=o[y],S=w.tileID.canonical.key;_[S]||(_[S]=!0,w.querySourceFeatures(f,n))}return f}function Ia(h,n){const o=h.tileID,f=n.tileID;return o.overscaledZ-f.overscaledZ||o.canonical.y-f.canonical.y||o.wrap-f.wrap||o.canonical.x-f.canonical.x}class Xo extends _o{constructor(n,o,f,_,y){super(n,o,f,_,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,o){const f=o.context,_=f.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new s.T(f,n,_.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,o){const f=this._mrt=new s.aZ(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.a_(_,(y,w,S,I)=>{if(y)o(y);else try{const D=f.getHeaderLength(w);if(D>n)return void(this.request=this.fetchHeader(D,o));f.parseHeader(w),this._isHeaderLoaded=!0;let L=0;for(const z of Object.values(f.layers))L=Math.max(L,z.dataIndex[z.dataIndex.length-1].last_byte);w.byteLength>=L&&(this.entireBuffer=w),o(null,this.entireBuffer||w,S,I)}catch(D){o(D)}}),this.request}fetchBand(n,o,f){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void f(new Error("Tile header is not ready"));const y=this.actor;if(!y)return void f(new Error("Can't fetch tile band without an actor"));let w;const S=(z,F)=>{w.complete(z,F),z?f(z):(this.updateTextureDescriptor(n,o),f(null,this.textureDescriptor&&this.textureDescriptor.img))},I=(z,F)=>{if(z)return f(z);const N=y.send("decodeRasterArray",{buffer:F,task:w},S,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),w.cancel()})},D=_.getLayer(n);if(!D)return void f(new Error(`Unknown sourceLayer "${n}"`));if(D.hasDataForBand(o))return this.updateTextureDescriptor(n,o),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=D.getDataRange([o]);if(w=_.createDecodingTask(L),!w||w.tasks.length)if(this.flushQueues(),this.entireBuffer)I(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),F=s.a_(z,I);this._fetchQueue.push(()=>{F.cancel(),w.cancel()})}else f(null)}updateNeeded(n,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,o){if(!this._mrt)return;const f=this._mrt.getLayer(n);if(!f||!f.hasBand(o)||!f.hasDataForBand(o))return;const{bytes:_,tileSize:y,buffer:w,offset:S,scale:I}=f.getBandView(o),D=y+2*w,L={data:_,width:D,height:D},z=this.texture;z&&z instanceof s.T&&z.update(L,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:o,img:L,buffer:w,offset:S,tileSize:y,format:f.pixelFormat,mix:[I,256*I,65536*I,16777216*I]}}}class Ca{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,f){const _=n.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const y={value:o,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(n,y)},f)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const f=n.wrapped().key,_=o===void 0?0:this.data[f].indexOf(o),y=this.data[f][_];return this.data[f].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const f in this.data)for(const _ of this.data[f])n(_.value)||o.push(_);for(const f of o)this.remove(f.value.tileID,f)}}class bs extends s.E{constructor(n,o,f){super(),this.id=n,this._onlySymbols=f,o.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new Ca(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Zt,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="errored"&&(o.state!=="loaded"||!o.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const f=this._tiles[o];f.upload(n),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.a$(this._tiles).map(n=>n.tileID).sort(qc).map(n=>n.key)}getRenderableIds(n,o){const f=[];for(const _ in this._tiles)this._isIdRenderable(+_,n,o)&&f.push(this._tiles[_]);return n?f.sort((_,y)=>{const w=_.tileID,S=y.tileID,I=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),D=new s.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-S.overscaledZ||D.y-I.y||D.x-I.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(qc).map(_=>_.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o,f){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())&&(f||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const f=this._tiles[n];f&&(f.state!=="loading"&&(f.state=o),this._loadTile(f,this._tileLoaded.bind(this,f,n,o)))}_tileLoaded(n,o,f,_){if(_)if(n.state="errored",_.status!==404)this._source.fire(new s.a(_,{tile:n}));else{if(!(n.tileID.key in this._loadedParentTiles))return void this._source.fire(new s.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=s.f.now(),f==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new s.b("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let _=0;_<o.length;_++){const y=o[_];if(n.neighboringTiles&&n.neighboringTiles[y]){const w=this.getTileByID(y);f(n,w),f(w,n)}}function f(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let w=y.tileID.canonical.x-_.tileID.canonical.x;const S=y.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),D=y.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,w,S),_.neighboringTiles&&_.neighboringTiles[D]&&(_.neighboringTiles[D].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,f,_){for(const y in this._tiles){let w=this._tiles[y];if(_[y]||!w.hasData()||w.tileID.overscaledZ<=o||w.tileID.overscaledZ>f)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>o+1;){const D=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[D.key],w&&w.hasData()&&(S=D)}let I=S;for(;I.overscaledZ>o;)if(I=I.scaledTo(I.overscaledZ-1),n[I.key]){_[S.key]=S;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const f=this._loadedParentTiles[n.key];return f&&f.tileID.overscaledZ>=o?f:null}for(let f=n.overscaledZ-1;f>=o;f--){const _=n.scaledTo(f),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const f=Math.ceil(n.width/o)+1,_=Math.ceil(n.height/o)+1,y=Math.floor(f*_*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(S)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const f={};for(const _ in this._tiles){const y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),f[y.tileID.key]=y}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(n,o,f,_){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let y;if(this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)y=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new s.am(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y));else if(this.tileCoverLift!==0){const I=n.clone();I.tileCoverLift=this.tileCoverLift,y=I.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&n.projection.name==="globe"&&(y.push(new s.am(1,0,1,0,0)),y.push(new s.am(1,0,1,1,0)),y.push(new s.am(1,0,1,0,1)),y.push(new s.am(1,0,1,1,1)))}else y=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(y=y.filter(I=>this._source.hasTile(I)));else y=[];if(y.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ws(this._source.type)){const I=n.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),D=Math.min(I,this._source.maxzoom),L=n.extendTileCoverForShadows(y,_,D);for(const z of L)this._shadowCasterTiles[z.key]=!0,y.push(z)}const w=this._updateRetainedTiles(y);if(Ws(this._source.type)&&y.length!==0){const I={},D={},L=Object.keys(w);for(const F of L){const N=w[F],$=this._tiles[F];if(!$||$.fadeEndTime&&$.fadeEndTime<=s.f.now())continue;const G=this.findLoadedParent(N,Math.max(N.overscaledZ-bs.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),I[G.tileID.key]=G.tileID),D[F]=N}const z=y[y.length-1].overscaledZ;for(const F in this._tiles){const N=this._tiles[F];if(w[F]||!N.hasData())continue;let $=N.tileID;for(;$.overscaledZ>z;){$=$.scaledTo($.overscaledZ-1);const G=this._tiles[$.key];if(G&&G.hasData()&&D[$.key]){w[F]=N.tileID;break}}}for(const F in I)w[F]||(this._coveredTiles[F]=!0,w[F]=I[F])}for(const I in w)this._tiles[I].clearFadeHold();const S=s.b0(this._tiles,w);for(const I of S){const D=this._tiles[I];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+I)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const f={},_=n.reduce((D,L)=>Math.min(D,L.overscaledZ),1/0),y=n[0].overscaledZ,w=Math.max(y-bs.maxOverzooming,this._source.minzoom),S=Math.max(y+bs.maxUnderzooming,this._source.minzoom),I={};for(const D of n){const L=this._addTile(D);o[D.key]=D,L.hasData()||_<this._source.maxzoom&&(I[D.key]=D)}this._retainLoadedChildren(I,_,S,o);for(const D of n){let L=this._tiles[D.key];if(L.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const F=D.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){o[F.key]=F;continue}}else{const F=D.children(this._source.maxzoom);if(o[F[0].key]&&o[F[1].key]&&o[F[2].key]&&o[F[3].key])continue}let z=L.wasRequested();for(let F=D.overscaledZ-1;F>=w;--F){const N=D.scaledTo(F);if(f[N.key]||(f[N.key]=!0,L=this.getTile(N),!L&&z&&(L=this._addTile(N)),L&&(o[N.key]=N,z=L.wasRequested(),L.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let f,_=this._tiles[n].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}o.push(_.key);const y=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;_=y}for(const y of o)this._loadedParentTiles[y]=f}}_addTile(n){let o=this._tiles[n.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const f=!!o;if(!f){const _=this.map?this.map.painter:null,y=this._source.tileSize*n.overscaleFactor();o=this._source.type==="raster-array"?new Xo(n,y,this.transform.tileZoom,_,this._isRaster):new _o(n,y,this.transform.tileZoom,_,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,f||this._source.fire(new s.b("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const f=o.getExpiryTimeout();f&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},f))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,f){const _=[],y=this.transform;if(!y)return _;const w=y.projection.name==="globe",S=s.a5(y.center.lng);for(const I in this._tiles){const D=this._tiles[I];if(f&&D.clearQueryDebugViz(),D.holdingForFade())continue;let L;if(w){const z=D.tileID.canonical;if(z.z===0){const F=[Math.abs(s.aa(S,...El(z,-1))-S),Math.abs(s.aa(S,...El(z,1))-S)];L=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(s.aa(S,...El(z,-1))-S),Math.abs(s.aa(S,...El(z,0))-S),Math.abs(s.aa(S,...El(z,1))-S)];L=[F.indexOf(Math.min(...F))-1]}}else L=[0];for(const z of L){const F=n.containsTile(D,y,o,z);F&&_.push(F)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,o){const f=this.getRenderableIds(n,o).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(const y of f)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return f}sortCoordinatesByDistance(n){const o=n.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(const w of o){const S=1/(1<<w.canonical.z);y[w.key]=((w.canonical.x+.5)*S+w.wrap-f[0])*_[0]+((w.canonical.y+.5)*S-f[1])*_[1]-f[2]*_[2]}return o.sort((w,S)=>y[w.key]-y[S.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Ws(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=s.f.now())return!0}return!1}setFeatureState(n,o,f){this._state.updateState(n=n||"_geojsonTileLayer",o,f)}removeFeatureState(n,o,f){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,f)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,f){const _=this._tiles[n];_&&_.setDependencies(o,f)}reloadTilesForDependencies(n,o){for(const f in this._tiles)this._tiles[f].hasDependency(n,o)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(n,o))}_preloadTiles(n,o){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(n,o))};return void this._source.on("data",I)}const f=new Map,_=Array.isArray(n)?n:[n],y=this.map.painter.terrain,w=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const I of _){const D=I.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of D)f.set(L.key,L);this.usedForTerrain&&I.updateElevation(!1)}const S=Array.from(f.values());s.b1(S,(I,D)=>{const L=new _o(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,z=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),D(z,L)})},o)}}function qc(h,n){const o=Math.abs(2*h.wrap)-+(h.wrap<0),f=Math.abs(2*n.wrap)-+(n.wrap<0);return h.overscaledZ-n.overscaledZ||f-o||n.canonical.y-h.canonical.y||n.canonical.x-h.canonical.x}function Ws(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function El(h,n){const o=1<<h.z;return[h.x/o+n,(h.x+1)/o+n]}bs.maxOverzooming=10,bs.maxUnderzooming=3;class Hf{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,o=!1;for(const f in this.style._mergedLayers){const _=this.style._mergedLayers[f];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:n,visibilityChanged:o});else if(_.type==="model"){const y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:n,visibilityChanged:o})}}}onNewFrame(n){this.layersGotHidden=!1;for(const o of this.layers){const f=o.layer;let _=!1;f.type==="fill-extrusion"?_=!f.isHidden(n)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(_=!f.isHidden(n)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&o.visible,o.visible=_}}updateZOffset(n,o){this.currentBuildingBuckets=[];for(const _ of this.layers){const y=_.layer,w=this.style.getLayerSourceCache(y);let S=1;y.type==="fill-extrusion"&&(S=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0);let I=w?w.getTile(o):null;if(!I&&w&&o.canonical.z>w.getSource().minzoom){let D=o.scaledTo(Math.min(w.getSource().maxzoom,o.overscaledZ-1));for(;D.overscaledZ>=w.getSource().minzoom&&(I=w.getTile(D),!I&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:I?I.getBucket(y):null,tileID:I?I.tileID:o,verticalScale:S})}n.hasAnyZOffset=!1;let f=!1;for(let _=0;_<n.symbolInstances.length;_++){const y=n.symbolInstances.get(_),w=y.zOffset,S=this._getHeightAtTileOffset(o,y.tileAnchorX,y.tileAnchorY);y.zOffset=S!==Number.NEGATIVE_INFINITY?S:w,f||w===y.zOffset||(f=!0),n.hasAnyZOffset||y.zOffset===0||(n.hasAnyZOffset=!0)}f&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,o,f,_){let y=o,w=f;if(n.canonical.z!==_.canonical.z){const S=_.canonical,I=1/(1<<n.canonical.z-S.z);y=(o+n.canonical.x*s.V)*I-S.x*s.V|0,w=(f+n.canonical.y*s.V)*I-S.y*s.V|0}return{tileX:y,tileY:w}}_getHeightAtTileOffset(n,o,f){let _,y;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;const{bucket:S,tileID:I,verticalScale:D}=this.currentBuildingBuckets[w];if(!S)continue;const{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(n,o,f,I),F=S.getHeightAtTileCoord(L,z);F&&F.height!==void 0&&(F.hidden?_=F.height:y=Math.max(F.height*D,y||0))}if(y!==void 0)return y;for(let w=0;w<this.layers.length;++w){const S=this.layers[w];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:I,tileID:D}=this.currentBuildingBuckets[w];if(!I)continue;const{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(n,o,f,D),F=I.getHeightAtTileCoord(L,z);if(F&&!F.hidden)return F.height===void 0&&_!==void 0?Math.min(F.maxHeight,_)*F.verticalScale:(F.height||0)*F.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Yo(h,n){const o={};for(const f in h)f!=="ref"&&(o[f]=h[f]);return s.b2.forEach(f=>{f in n&&(o[f]=n[f])}),o}function Wf(h){h=h.slice();const n=Object.create(null);for(let o=0;o<h.length;o++)n[h[o].id]=h[o];for(let o=0;o<h.length;o++)"ref"in h[o]&&(h[o]=Yo(h[o],n[h[o].ref]));return h}const Ei={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Al(h,n,o){o.push({command:Ei.addSource,args:[h,n[h]]})}function lh(h,n,o){n.push({command:Ei.removeSource,args:[h]}),o[h]=!0}function W_(h,n,o,f){lh(h,o,f),Al(h,n,o)}function Z_(h,n,o){let f;for(f in h[o])if(h[o].hasOwnProperty(f)&&f!=="data"&&!B(h[o][f],n[o][f]))return!1;for(f in n[o])if(n[o].hasOwnProperty(f)&&f!=="data"&&!B(h[o][f],n[o][f]))return!1;return!0}function go(h,n,o,f,_,y){let w;for(w in n=n||{},h=h||{})h.hasOwnProperty(w)&&(B(h[w],n[w])||o.push({command:y,args:[f,w,n[w],_]}));for(w in n)n.hasOwnProperty(w)&&!h.hasOwnProperty(w)&&(B(h[w],n[w])||o.push({command:y,args:[f,w,n[w],_]}))}function yo(h){return h.id}function Hc(h,n){return h[n.id]=n,h}class Pa{constructor(n,o){this.reset(n,o)}reset(n,o){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.aa(n,0,1);let o=1,f=this._distances[o];const _=n*this.paddedLength+this.padding;for(;f<_&&o<this._distances.length;)f=this._distances[++o];const y=o-1,w=this._distances[y],S=f-w,I=S>0?(_-w)/S:0;return this.points[y].mult(1-I).add(this.points[o].mult(I))}}class ch{constructor(n,o,f){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(o/f);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=o,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,o,f,_,y){this._forEachCell(o,f,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(n,o,f,_){this._forEachCell(o-_,f-_,o+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(o),this.circles.push(f),this.circles.push(_)}_insertBoxCell(n,o,f,_,y,w){this.boxCells[y].push(w)}_insertCircleCell(n,o,f,_,y,w){this.circleCells[y].push(w)}_query(n,o,f,_,y,w){if(f<0||n>this.width||_<0||o>this.height)return!y&&[];const S=[];if(n<=0&&o<=0&&this.width<=f&&this.height<=_){if(y)return!0;for(let I=0;I<this.boxKeys.length;I++)S.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const D=this.circles[3*I],L=this.circles[3*I+1],z=this.circles[3*I+2];S.push({key:this.circleKeys[I],x1:D-z,y1:L-z,x2:D+z,y2:L+z})}return w?S.filter(w):S}return this._forEachCell(n,o,f,_,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},w),y?S.length>0:S}_queryCircle(n,o,f,_,y){const w=n-f,S=n+f,I=o-f,D=o+f;if(S<0||w>this.width||D<0||I>this.height)return!_&&[];const L=[];return this._forEachCell(w,I,S,D,this._queryCellCircle,L,{hitTest:_,circle:{x:n,y:o,radius:f},seenUids:{box:{},circle:{}}},y),_?L.length>0:L}query(n,o,f,_,y){return this._query(n,o,f,_,!1,y)}hitTest(n,o,f,_,y){return this._query(n,o,f,_,!0,y)}hitTestCircle(n,o,f,_){return this._queryCircle(n,o,f,!0,_)}_queryCell(n,o,f,_,y,w,S,I){const D=S.seenUids,L=this.boxCells[y];if(L!==null){const F=this.bboxes;for(const N of L)if(!D.box[N]){D.box[N]=!0;const $=4*N;if(n<=F[$+2]&&o<=F[$+3]&&f>=F[$+0]&&_>=F[$+1]&&(!I||I(this.boxKeys[N]))){if(S.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[N],x1:F[$],y1:F[$+1],x2:F[$+2],y2:F[$+3]})}}}const z=this.circleCells[y];if(z!==null){const F=this.circles;for(const N of z)if(!D.circle[N]){D.circle[N]=!0;const $=3*N;if(this._circleAndRectCollide(F[$],F[$+1],F[$+2],n,o,f,_)&&(!I||I(this.circleKeys[N]))){if(S.hitTest)return w.push(!0),!0;{const G=F[$],H=F[$+1],U=F[$+2];w.push({key:this.circleKeys[N],x1:G-U,y1:H-U,x2:G+U,y2:H+U})}}}}}_queryCellCircle(n,o,f,_,y,w,S,I){const D=S.circle,L=S.seenUids,z=this.boxCells[y];if(z!==null){const N=this.bboxes;for(const $ of z)if(!L.box[$]){L.box[$]=!0;const G=4*$;if(this._circleAndRectCollide(D.x,D.y,D.radius,N[G+0],N[G+1],N[G+2],N[G+3])&&(!I||I(this.boxKeys[$])))return w.push(!0),!0}}const F=this.circleCells[y];if(F!==null){const N=this.circles;for(const $ of F)if(!L.circle[$]){L.circle[$]=!0;const G=3*$;if(this._circlesCollide(N[G],N[G+1],N[G+2],D.x,D.y,D.radius)&&(!I||I(this.circleKeys[$])))return w.push(!0),!0}}}_forEachCell(n,o,f,_,y,w,S,I){const D=this._convertToXCellCoord(n),L=this._convertToYCellCoord(o),z=this._convertToXCellCoord(f),F=this._convertToYCellCoord(_);for(let N=D;N<=z;N++)for(let $=L;$<=F;$++)if(y.call(this,n,o,f,_,this.xCellCount*$+N,w,S,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,o,f,_,y,w){const S=_-n,I=y-o,D=f+w;return D*D>S*S+I*I}_circleAndRectCollide(n,o,f,_,y,w,S){const I=(w-_)/2,D=Math.abs(n-(_+I));if(D>I+f)return!1;const L=(S-y)/2,z=Math.abs(o-(y+L));if(z>L+f)return!1;if(D<=I||z<=L)return!0;const F=D-I,N=z-L;return F*F+N*N<=f*f}}const Zs={unknown:0,flipRequired:1,flipNotRequired:2},xo=Math.tan(85*Math.PI/180);function Il(h,n,o,f,_,y,w){const S=s.a6.create();if(o)if(y.name==="globe"){const I=s.b3(_,n);s.a6.multiply(S,S,I)}else{const I=s.b4.invert([],w);S[0]=I[0],S[1]=I[1],S[4]=I[2],S[5]=I[3],f||s.a6.rotateZ(S,S,_.angle)}else s.a6.multiply(S,_.labelPlaneMatrix,h);return S}function uh(h,n,o,f,_,y,w){const S=Il(h,n,o,f,_,y,w);return y.name==="globe"&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function hh(h,n,o,f,_,y,w){if(o){if(y.name==="globe"){const S=Il(h,n,o,f,_,y,w);return s.a6.invert(S,S),s.a6.multiply(S,h,S),S}{const S=s.a6.clone(h),I=s.a6.identity([]);return I[0]=w[0],I[1]=w[1],I[4]=w[2],I[5]=w[3],s.a6.multiply(S,S,I),f||s.a6.rotateZ(S,S,-_.angle),S}}return _.glCoordMatrix}function ss(h,n,o,f){const _=[h,n,o,1];o?s.a7.transformMat4(_,_,f):gh(_,_,f);const y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function Zf(h,n){return Math.min(.5+h/n*.5,1.5)}function dh(h,n){const o=h[0]/h[3],f=h[1]/h[3];return o>=-n[0]&&o<=n[0]&&f>=-n[1]&&f<=n[1]}function fh(h,n,o,f,_,y,w,S,I,D){const L=o.transform,z=f?h.textSizeData:h.iconSizeData,F=s.b5(z,o.transform.zoom),N=L.projection.name==="globe",$=[256/o.width*2+1,256/o.height*2+1],G=f?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();let H=null;N&&(H=f?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const U=h.lineVertexArray,Y=f?h.text.placedSymbolArray:h.icon.placedSymbolArray,te=o.transform.width/o.transform.height;let J,ie=!1;for(let W=0;W<Y.length;W++){const ne=Y.get(W),{numGlyphs:le,writingMode:ce}=ne;if(ce!==s.b6.vertical||ie||J===s.b6.horizontal||(ie=!0),J=ce,(ne.hidden||ce===s.b6.vertical)&&!ie){vo(le,G);continue}ie=!1;const pe=new s.P(ne.tileAnchorX,ne.tileAnchorY);let{x:Se,y:_e,z:ze}=L.projection.projectTilePoint(pe.x,pe.y,D.canonical);if(I){const[dt,Pt,Ut]=I(pe);Se+=dt,_e+=Pt,ze+=Ut}const De=[Se,_e,ze,1];if(s.a7.transformMat4(De,De,n),!dh(De,$)){vo(le,G);continue}const He=De[3],ye=Zf(o.transform.getCameraToCenterDistance(L.projection),He),Ie=s.b7(z,F,ne),fe=w?Ie/ye:Ie*ye,we=ss(Se,_e,ze,_);if(we[3]<=0){vo(le,G);continue}let Ze={};const it=w?null:I,tt=_h(ne,fe,!1,S,n,_,y,h.glyphOffsetArray,U,G,H,we,pe,Ze,te,it,L.projection,D,w);ie=tt.useVertical,it&&tt.needsFlipping&&(Ze={}),(tt.notEnoughRoom||ie||tt.needsFlipping&&_h(ne,fe,!0,S,n,_,y,h.glyphOffsetArray,U,G,H,we,pe,Ze,te,it,L.projection,D,w).notEnoughRoom)&&vo(le,G)}f?(h.text.dynamicLayoutVertexBuffer.updateData(G),H&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(H)):(h.icon.dynamicLayoutVertexBuffer.updateData(G),H&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(H))}function ph(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G){const{lineStartIndex:H,glyphStartIndex:U,segment:Y}=S,te=U+S.numGlyphs,J=H+S.lineLength,ie=n.getoffsetX(U),W=n.getoffsetX(te-1),ne=Cl(h*ie,o,f,_,y,w,Y,H,J,I,D,L,z,F,!0,N,$,G);if(!ne)return null;const le=Cl(h*W,o,f,_,y,w,Y,H,J,I,D,L,z,F,!0,N,$,G);return le?{first:ne,last:le}:null}function mh(h,n,o,f){return h===s.b6.horizontal&&Math.abs(f)>Math.abs(o)?{useVertical:!0}:h===s.b6.vertical?f>0?{needsFlipping:!0}:null:n!==Zs.unknown&&function(_,y){return _===0||Math.abs(y/_)>xo}(o,f)?n===Zs.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function _h(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G,H,U,Y){const te=n/24,J=h.lineOffsetX*te,ie=h.lineOffsetY*te,{lineStartIndex:W,glyphStartIndex:ne,numGlyphs:le,segment:ce,writingMode:pe,flipState:Se}=h,_e=W+h.lineLength,ze=De=>{if(L){const[fe,we,Ze]=De.up,it=D.length;s.b8(L,it+0,fe,we,Ze),s.b8(L,it+1,fe,we,Ze),s.b8(L,it+2,fe,we,Ze),s.b8(L,it+3,fe,we,Ze)}const[He,ye,Ie]=De.point;s.b9(D,He,ye,Ie,De.angle)};if(le>1){const De=ph(te,S,J,ie,o,z,F,h,I,y,N,G,!1,H,U,Y);if(!De)return{notEnoughRoom:!0};if(f&&!o){let[He,ye,Ie]=De.first.point,[fe,we,Ze]=De.last.point;[He,ye]=ss(He,ye,Ie,w),[fe,we]=ss(fe,we,Ze,w);const it=mh(pe,Se,(fe-He)*$,we-ye);if(h.flipState=it&&it.needsFlipping?Zs.flipRequired:Zs.flipNotRequired,it)return it}ze(De.first);for(let He=ne+1;He<ne+le-1;He++){const ye=Cl(te*S.getoffsetX(He),J,ie,o,z,F,ce,W,_e,I,y,N,G,!1,!1,H,U,Y);if(!ye)return D.length-=4*(He-ne),{notEnoughRoom:!0};ze(ye)}ze(De.last)}else{if(f&&!o){const He=ss(F.x,F.y,0,_),ye=W+ce+1,Ie=new s.P(I.getx(ye),I.gety(ye)),fe=ss(Ie.x,Ie.y,0,_),we=fe[3]>0?fe:Wc(F,Ie,He,1,_,void 0,H,U.canonical),Ze=mh(pe,Se,(we[0]-He[0])*$,we[1]-He[1]);if(h.flipState=Ze&&Ze.needsFlipping?Zs.flipRequired:Zs.flipNotRequired,Ze)return Ze}const De=Cl(te*S.getoffsetX(ne),J,ie,o,z,F,ce,W,_e,I,y,N,G,!1,!1,H,U,Y);if(!De)return{notEnoughRoom:!0};ze(De)}return{}}function Da(h,n,o,f,_){const{x:y,y:w,z:S}=f.projectTilePoint(h.x,h.y,n);if(!_)return ss(y,w,S,o);const[I,D,L]=_(h);return ss(y+I,w+D,S+L,o)}function Wc(h,n,o,f,_,y,w,S){const I=Da(h.sub(n)._unit()._add(h),S,_,w,y);return s.N.sub(I,o,I),s.N.normalize(I,I),s.N.scaleAndAdd(I,o,I,f)}function Cl(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G,H,U){const Y=f?h-n:h+n;let te=Y>0?1:-1,J=0;f&&(te*=-1,J=Math.PI),te<0&&(J+=Math.PI);let ie=S+w+(te>0?0:1)|0,W=_,ne=_,le=0,ce=0;const pe=Math.abs(Y),Se=[],_e=[];let ze=y,De=ze;const He=()=>Wc(De,ze,ne,pe-le+1,L,F,G,H.canonical);for(;le+ce<=pe;){if(ie+=te,ie<S||ie>=I)return null;if(ne=W,De=ze,Se.push(ne),N&&_e.push(De),ze=new s.P(D.getx(ie),D.gety(ie)),W=z[ie],!W){const Pt=Da(ze,H.canonical,L,G,F);W=Pt[3]>0?z[ie]=Pt:He()}le+=ce,ce=s.N.distance(ne,W)}$&&F&&(z[ie]&&(W=He(),ce=s.N.distance(ne,W)),z[ie]=W);const ye=(pe-le)/ce,Ie=ze.sub(De)._mult(ye)._add(De),fe=s.N.sub([],W,ne),we=s.N.scaleAndAdd([],ne,fe,ye);let Ze=[0,0,1],it=fe[0],tt=fe[1];if(U&&(Ze=G.upVector(H.canonical,Ie.x,Ie.y),Ze[0]!==0||Ze[1]!==0||Ze[2]!==1)){const Pt=[Ze[2],0,-Ze[0]],Ut=s.N.cross([],Ze,Pt);s.N.normalize(Pt,Pt),s.N.normalize(Ut,Ut),it=s.N.dot(fe,Pt),tt=s.N.dot(fe,Ut)}if(o){const Pt=s.N.cross([],Ze,fe);s.N.normalize(Pt,Pt),s.N.scaleAndAdd(we,we,Pt,o*te)}const dt=J+Math.atan2(tt,it);return Se.push(we),N&&_e.push(Ie),{point:we,angle:dt,path:Se,tilePath:_e,up:Ze}}function vo(h,n){const o=n.length,f=o+4*h;n.resize(f),n.float32.fill(-1/0,4*o,4*f)}function gh(h,n,o){const f=n[0],_=n[1];return h[0]=o[0]*f+o[4]*_+o[12],h[1]=o[1]*f+o[5]*_+o[13],h[3]=o[3]*f+o[7]*_+o[15],h}const os=100;class yt{constructor(n,o,f=new ch(n.width+200,n.height+200,25),_=new ch(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+os,this.screenBottomBoundary=n.height+os,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=o}placeCollisionBox(n,o,f,_,y,w,S,I){let D=f.projectedAnchorX,L=f.projectedAnchorY,z=f.projectedAnchorZ;const F=f.elevation,N=f.tileID,$=n.getProjection();if(F&&N){const[W,ne,le]=$.upVector(N.canonical,f.tileAnchorX,f.tileAnchorY),ce=$.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=W*F*ce,L+=ne*F*ce,z+=le*F*ce}const G=this.projectAndGetPerspectiveRatio(S,D,L,z,f.tileID,$.name==="globe"||!!F||this.transform.pitch>0,$),H=w*G.perspectiveRatio,U=(f.x1*o+_.x-f.padding)*H+G.point.x,Y=(f.y1*o+_.y-f.padding)*H+G.point.y,te=(f.x2*o+_.x+f.padding)*H+G.point.x,J=(f.y2*o+_.y+f.padding)*H+G.point.y,ie=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(U,Y,te,J)||!y&&this.grid.hitTest(U,Y,te,J,I)||ie?{box:[],offscreen:!1,occluded:G.occluded}:{box:[U,Y,te,J],offscreen:this.isOffscreen(U,Y,te,J),occluded:!1}}placeCollisionCircles(n,o,f,_,y,w,S,I,D,L,z,F,N,$,G){const H=[],U=this.transform.elevation,Y=n.getProjection(),te=U?U.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,Y):null,J=new s.P(f.tileAnchorX,f.tileAnchorY);let{x:ie,y:W,z:ne}=Y.projectTilePoint(J.x,J.y,G.canonical);if(te){const[Ie,fe,we]=te(J);ie+=Ie,W+=fe,ne+=we}const le=Y.name==="globe",ce=this.projectAndGetPerspectiveRatio(S,ie,W,ne,G,le||!!U||this.transform.pitch>0,Y),{perspectiveRatio:pe}=ce,Se=(z?w/pe:w*pe)/s.bc,_e=ss(ie,W,ne,I),ze=ce.signedDistanceFromCamera>0?ph(Se,y,f.lineOffsetX*Se,f.lineOffsetY*Se,!1,_e,J,f,_,I,{},U&&!z?te:null,z&&!!U,Y,G,z):null;let De=!1,He=!1,ye=!0;if(ze&&!ce.occluded){const Ie=.5*N*pe+$,fe=new s.P(-100,-100),we=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Ze=new Pa,{first:it,last:tt}=ze,dt=it.path.length;let Pt=[];for(let Bt=dt-1;Bt>=1;Bt--)Pt.push(it.path[Bt]);for(let Bt=1;Bt<tt.path.length;Bt++)Pt.push(tt.path[Bt]);const Ut=2.5*Ie;D&&(Pt=Pt.map(([Bt,li,Jt],ri)=>(te&&!le&&(Jt=te(ri<dt-1?it.tilePath[dt-1-ri]:tt.tilePath[ri-dt+2])[2]),ss(Bt,li,Jt,D))),Pt.some(Bt=>Bt[3]<=0)&&(Pt=[]));let zt=[];if(Pt.length>0){let Bt=1/0,li=-1/0,Jt=1/0,ri=-1/0;for(const ni of Pt)Bt=Math.min(Bt,ni[0]),Jt=Math.min(Jt,ni[1]),li=Math.max(li,ni[0]),ri=Math.max(ri,ni[1]);li>=fe.x&&Bt<=we.x&&ri>=fe.y&&Jt<=we.y&&(zt=[Pt.map(ni=>new s.P(ni[0],ni[1]))],(Bt<fe.x||li>we.x||Jt<fe.y||ri>we.y)&&(zt=s.ba(zt,fe.x,fe.y,we.x,we.y)))}for(const Bt of zt){Ze.reset(Bt,.25*Ie);let li=0;li=Ze.length<=.5*Ie?1:Math.ceil(Ze.paddedLength/Ut)+1;for(let Jt=0;Jt<li;Jt++){const ri=Jt/Math.max(li-1,1),ni=Ze.lerp(ri),Ai=ni.x+os,rn=ni.y+os;H.push(Ai,rn,Ie,0);const yi=Ai-Ie,Tn=rn-Ie,xi=Ai+Ie,zi=rn+Ie;if(ye=ye&&this.isOffscreen(yi,Tn,xi,zi),He=He||this.isInsideGrid(yi,Tn,xi,zi),!o&&this.grid.hitTestCircle(Ai,rn,Ie,F)&&(De=!0,!L))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!L&&De||!He?[]:H,offscreen:ye,collisionDetected:De,occluded:ce.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let f=1/0,_=1/0,y=-1/0,w=-1/0;for(const L of n){const z=new s.P(L.x+os,L.y+os);f=Math.min(f,z.x),_=Math.min(_,z.y),y=Math.max(y,z.x),w=Math.max(w,z.y),o.push(z)}const S=this.grid.query(f,_,y,w).concat(this.ignoredGrid.query(f,_,y,w)),I={},D={};for(const L of S){const z=L.key;if(I[z.bucketInstanceId]===void 0&&(I[z.bucketInstanceId]={}),I[z.bucketInstanceId][z.featureIndex])continue;const F=[new s.P(L.x1,L.y1),new s.P(L.x2,L.y1),new s.P(L.x2,L.y2),new s.P(L.x1,L.y2)];s.bb(o,F)&&(I[z.bucketInstanceId][z.featureIndex]=!0,D[z.bucketInstanceId]===void 0&&(D[z.bucketInstanceId]=[]),D[z.bucketInstanceId].push(z.featureIndex))}return D}insertCollisionBox(n,o,f,_,y){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:y},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,o,f,_,y){const w=o?this.ignoredGrid:this.grid,S={bucketInstanceId:f,featureIndex:_,collisionGroupID:y};for(let I=0;I<n.length;I+=4)w.insertCircle(S,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,o,f,_,y,w,S){const I=[o,f,_,1];let D=!1;_||this.transform.pitch>0?(s.a7.transformMat4(I,I,n),this.fogState&&y&&S.name!=="globe"&&(D=function(F,N,$,G,H,U){const Y=U.calculateFogTileMatrix(H),te=[N,$,G];return s.N.transformMat4(te,te,Y),Ui(F,s.N.length(te),U.pitch,U._fov)}(this.fogState,o,f,_,y.toUnwrapped(),this.transform)>.9)):gh(I,I,n);const L=I[3];return{point:new s.P((I[0]/L+1)/2*this.transform.width+os,(-I[1]/L+1)/2*this.transform.height+os),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/L*.5,1.5),signedDistanceFromCamera:L,occluded:w&&I[2]>L||D}}isOffscreen(n,o,f,_){return f<os||n>=this.screenRightBoundary||_<os||o>this.screenBottomBoundary}isInsideGrid(n,o,f,_){return f>=0&&n<this.gridRightBoundary&&_>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const n=s.a6.identity([]);return s.a6.translate(n,n,[-100,-100,0]),n}}function Zc(h,n,o){const f=n.createTileMatrix(h,h.worldSize,o.toUnwrapped());return s.a6.multiply(new Float32Array(16),h.projMatrix,f)}function yh(h,n,o){if(n.projection.name===o.projection.name)return h.projMatrix;const f=o.clone();return f.setProjection(n.projection),Zc(f,n.getProjection(),h)}function Pl(h,n,o){return n.name===o.projection.name?h.projMatrix:Zc(o,n,h)}class xh{constructor(n,o,f,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?o:-o))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class bo{constructor(n,o,f,_,y,w=!1){this.text=new xh(n?n.text:null,o,f,y),this.icon=new xh(n?n.icon:null,o,_,y),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ws{constructor(n,o,f,_=!1){this.text=n,this.icon=o,this.skipFade=f,this.clipped=_}}class vh{constructor(){this.invProjMatrix=s.a6.create(),this.viewportMatrix=s.a6.create(),this.circles=[]}}class Ko{constructor(n,o,f,_,y){this.bucketInstanceId=n,this.featureIndex=o,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=y}}class Xc{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const o=++this.maxGroupID;this.collisionGroups[n]={ID:o,predicate:f=>f.collisionGroupID===o}}return this.collisionGroups[n]}}function Jo(h,n,o,f,_){const{horizontalAlign:y,verticalAlign:w}=s.bf(h),S=-(y-.5)*n,I=-(w-.5)*o,D=s.bd(h,f);return new s.P(S+D[0]*_,I+D[1]*_)}function bh(h,n,o,f,_){const y=new s.P(h,n);return o&&y._rotate(f?_:-_),y}class X_{constructor(n,o,f,_,y,w){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new yt(this.transform,y),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Xc(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,o,f,_){const y=f.getBucket(o),w=f.latestFeatureIndex;if(!y||!w||o.fqid!==y.layerIds[0])return;const S=y.layers[0].layout,I=f.collisionBoxArray,D=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),L=f.tileSize/s.V,z=f.tileID.toUnwrapped();this.transform.setProjection(y.projection);const F=(N=f.tileID,$=y.getProjection(),G=this.transform,$.name===this.projection?G.calculateProjMatrix(N.toUnwrapped()):Zc(G,$,N));var N,$,G;const H=S.get("text-pitch-alignment")==="map",U=S.get("text-rotation-alignment")==="map";o.compileFilter();const Y=o.dynamicFilter(),te=o.dynamicFilterNeedsFeature(),J=this.transform.calculatePixelsToTileUnitsMatrix(f),ie=uh(F,f.tileID.canonical,H,U,this.transform,y.getProjection(),J);let W=null;if(H){const ce=hh(F,f.tileID.canonical,H,U,this.transform,y.getProjection(),J);W=s.a6.multiply([],this.transform.labelPlaneMatrix,ce)}let ne=null;Y&&f.latestFeatureIndex&&(ne={unwrappedTileID:z,dynamicFilter:Y,dynamicFilterNeedsFeature:te,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Ko(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,f.tileID);const le={bucket:y,layout:S,posMatrix:F,textLabelPlaneMatrix:ie,labelToScreenMatrix:W,clippingData:ne,scale:D,textPixelRatio:L,holdingForFade:f.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:s.b5(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.b5(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(_)for(const ce of y.sortKeyRanges){const{sortKey:pe,symbolInstanceStart:Se,symbolInstanceEnd:_e}=ce;n.push({sortKey:pe,symbolInstanceStart:Se,symbolInstanceEnd:_e,parameters:le})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:le})}attemptAnchorPlacement(n,o,f,_,y,w,S,I,D,L,z,F,N,$,G,H,U,Y){const{textOffset0:te,textOffset1:J,crossTileID:ie}=F,W=[te,J],ne=Jo(n,f,_,W,y),le=this.collisionIndex.placeCollisionBox($,y,o,bh(ne.x,ne.y,w,S,this.transform.angle),z,I,D,L.predicate);if(H){const ce=$.getSymbolInstanceIconSize(Y,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($,ce,H,bh(ne.x,ne.y,w,S,this.transform.angle),z,I,D,L.predicate).box.length===0)return}if(le.box.length>0){let ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[ie]&&this.prevPlacement.placements[ie]&&this.prevPlacement.placements[ie].text&&(ce=this.prevPlacement.variableOffsets[ie].anchor),this.variableOffsets[ie]={textOffset:W,width:f,height:_,anchor:n,textScale:y,prevAnchor:ce},this.markUsedJustification($,n,F,G),$.allowVerticalPlacement&&(this.markUsedOrientation($,G,F),this.placedOrientations[ie]=G),{shift:ne,placedGlyphBoxes:le}}}placeLayerBucketPart(n,o,f,_){const{bucket:y,layout:w,posMatrix:S,textLabelPlaneMatrix:I,labelToScreenMatrix:D,clippingData:L,textPixelRatio:z,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:G,collisionGroup:H}=n.parameters,U=w.get("text-optional"),Y=w.get("icon-optional"),te=w.get("text-allow-overlap"),J=w.get("icon-allow-overlap"),ie=w.get("text-rotation-alignment")==="map",W=w.get("text-pitch-alignment")==="map",ne=w.get("symbol-z-order")==="viewport-y",le=w.get("symbol-z-elevate");this.transform.setProjection(y.projection);let ce=te&&(J||!y.hasIconData()||Y),pe=J&&(te||!y.hasTextData()||U);!y.collisionArrays&&N&&y.deserializeCollisionBoxes(N),f&&_&&y.updateCollisionDebugBuffers(this.transform.zoom,N);const Se=(_e,ze,De)=>{const{crossTileID:He,numVerticalGlyphVertices:ye}=_e;if(L){const xi={zoom:this.transform.zoom,pitch:this.transform.pitch};let zi=null;if(L.dynamicFilterNeedsFeature){const vi=this.retainedQueryData[y.bucketInstanceId];zi=L.featureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:vi.bucketIndex,sourceLayerIndex:vi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(xi,zi,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new s.P(_e.tileAnchorX,_e.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[He]=new ws(!1,!1,!1,!0),void o.add(He)}if(o.has(He))return;if(F)return void(this.placements[He]=new ws(!1,!1,!1));let Ie=!1,fe=!1,we=!0,Ze=!1,it=!1,tt=null,dt={box:null,offscreen:null,occluded:null},Pt={box:null,offscreen:null,occluded:null},Ut=null,zt=null,Bt=null,li=0,Jt=0,ri=0;De.textFeatureIndex?li=De.textFeatureIndex:_e.useRuntimeCollisionCircles&&(li=_e.featureIndex),De.verticalTextFeatureIndex&&(Jt=De.verticalTextFeatureIndex);const ni=xi=>{xi.tileID=this.retainedQueryData[y.bucketInstanceId].tileID;const zi=this.transform.elevation;xi.elevation=_e.zOffset+(zi?zi.getAtTileOffset(xi.tileID,xi.tileAnchorX,xi.tileAnchorY):0)},Ai=De.textBox;if(Ai){ni(Ai);const xi=vi=>{let Di=s.b6.horizontal;if(y.allowVerticalPlacement&&!vi&&this.prevPlacement){const ln=this.prevPlacement.placedOrientations[He];ln&&(this.placedOrientations[He]=ln,Di=ln,this.markUsedOrientation(y,Di,_e))}return Di},zi=(vi,Di)=>{if(y.allowVerticalPlacement&&ye>0&&De.verticalTextBox){for(const ln of y.writingModes)if(ln===s.b6.vertical?(dt=Di(),Pt=dt):dt=vi(),dt&&dt.box&&dt.box.length)break}else dt=vi()};if(w.get("text-variable-anchor")){let vi=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[He]){const Vi=this.prevPlacement.variableOffsets[He];vi.indexOf(Vi.anchor)>0&&(vi=vi.filter(er=>er!==Vi.anchor),vi.unshift(Vi.anchor))}const Di=(Vi,er,_r)=>{const Vr=y.getSymbolInstanceTextSize($,_e,this.transform.zoom,ze),Ns=(Vi.x2-Vi.x1)*Vr+2*Vi.padding,Ur=(Vi.y2-Vi.y1)*Vr+2*Vi.padding,tr=_e.hasIconTextFit&&!J?er:null;tr&&ni(tr);let qn={box:[],offscreen:!1,occluded:!1};const Ir=te?2*vi.length:vi.length;for(let zr=0;zr<Ir;++zr){const jr=this.attemptAnchorPlacement(vi[zr%vi.length],Vi,Ns,Ur,Vr,ie,W,z,S,H,zr>=vi.length,_e,ze,y,_r,tr,$,G);if(jr&&(qn=jr.placedGlyphBoxes,qn&&qn.box&&qn.box.length)){Ie=!0,tt=jr.shift;break}}return qn};zi(()=>Di(Ai,De.iconBox,s.b6.horizontal),()=>{const Vi=De.verticalTextBox;return Vi&&ni(Vi),y.allowVerticalPlacement&&!(dt&&dt.box&&dt.box.length)&&ye>0&&Vi?Di(Vi,De.verticalIconBox,s.b6.vertical):{box:null,offscreen:null,occluded:null}}),dt&&(Ie=dt.box,we=dt.offscreen,Ze=dt.occluded);const ln=xi(!(!dt||!dt.box));if(!Ie&&this.prevPlacement){const Vi=this.prevPlacement.variableOffsets[He];Vi&&(this.variableOffsets[He]=Vi,this.markUsedJustification(y,Vi.anchor,_e,ln))}}else{const vi=(Di,ln)=>{const Vi=y.getSymbolInstanceTextSize($,_e,this.transform.zoom,ze),er=this.collisionIndex.placeCollisionBox(y,Vi,Di,new s.P(0,0),te,z,S,H.predicate);return er&&er.box&&er.box.length&&(this.markUsedOrientation(y,ln,_e),this.placedOrientations[He]=ln),er};zi(()=>vi(Ai,s.b6.horizontal),()=>{const Di=De.verticalTextBox;return y.allowVerticalPlacement&&ye>0&&Di?(ni(Di),vi(Di,s.b6.vertical)):{box:null,offscreen:null,occluded:null}}),xi(!!(dt&&dt.box&&dt.box.length))}}if(Ut=dt,Ie=Ut&&Ut.box&&Ut.box.length>0,we=Ut&&Ut.offscreen,Ze=Ut&&Ut.occluded,_e.useRuntimeCollisionCircles){const xi=y.text.placedSymbolArray.get(_e.centerJustifiedTextSymbolIndex>=0?_e.centerJustifiedTextSymbolIndex:_e.verticalPlacedTextSymbolIndex),zi=s.b7(y.textSizeData,$,xi),vi=w.get("text-padding");zt=this.collisionIndex.placeCollisionCircles(y,te,xi,y.lineVertexArray,y.glyphOffsetArray,zi,S,I,D,f,W,H.predicate,_e.collisionCircleDiameter*zi/s.bc,vi,this.retainedQueryData[y.bucketInstanceId].tileID),Ie=te||zt.circles.length>0&&!zt.collisionDetected,we=we&&zt.offscreen,Ze=zt.occluded}if(De.iconFeatureIndex&&(ri=De.iconFeatureIndex),De.iconBox){const xi=zi=>{ni(zi);const vi=_e.hasIconTextFit&&tt?bh(tt.x,tt.y,ie,W,this.transform.angle):new s.P(0,0),Di=y.getSymbolInstanceIconSize(G,this.transform.zoom,_e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,Di,zi,vi,J,z,S,H.predicate)};Pt&&Pt.box&&Pt.box.length&&De.verticalIconBox?(Bt=xi(De.verticalIconBox),fe=Bt.box.length>0):(Bt=xi(De.iconBox),fe=Bt.box.length>0),we=we&&Bt.offscreen,it=Bt.occluded}const rn=U||_e.numHorizontalGlyphVertices===0&&ye===0,yi=Y||_e.numIconVertices===0;if(rn||yi?yi?rn||(fe=fe&&Ie):Ie=fe&&Ie:fe=Ie=fe&&Ie,Ie&&Ut&&Ut.box&&this.collisionIndex.insertCollisionBox(Ut.box,w.get("text-ignore-placement"),y.bucketInstanceId,Pt&&Pt.box&&Jt?Jt:li,H.ID),fe&&Bt&&this.collisionIndex.insertCollisionBox(Bt.box,w.get("icon-ignore-placement"),y.bucketInstanceId,ri,H.ID),zt&&(Ie&&this.collisionIndex.insertCollisionCircles(zt.circles,w.get("text-ignore-placement"),y.bucketInstanceId,li,H.ID),f)){const xi=y.bucketInstanceId;let zi=this.collisionCircleArrays[xi];zi===void 0&&(zi=this.collisionCircleArrays[xi]=new vh);for(let vi=0;vi<zt.circles.length;vi+=4)zi.circles.push(zt.circles[vi+0]),zi.circles.push(zt.circles[vi+1]),zi.circles.push(zt.circles[vi+2]),zi.circles.push(zt.collisionDetected?1:0)}const Tn=y.projection.name!=="globe";ce=ce&&(Tn||!Ze),pe=pe&&(Tn||!it),this.placements[He]=new ws(Ie||ce,fe||pe,we||y.justReloaded),o.add(He)};if(le&&this.buildingIndex&&(this.buildingIndex.updateZOffset(y,this.retainedQueryData[y.bucketInstanceId].tileID),y.updateZOffset()),ne){const _e=y.getSortedSymbolIndexes(this.transform.angle);for(let ze=_e.length-1;ze>=0;--ze){const De=_e[ze];Se(y.symbolInstances.get(De),De,y.collisionArrays[De])}y.hasAnyZOffset&&s.w(`${y.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(y.hasAnyZOffset){const _e=y.getSortedIndexesByZOffset();for(let ze=0;ze<_e.length;++ze){const De=_e[ze];Se(y.symbolInstances.get(De),De,y.collisionArrays[De])}}else for(let _e=n.symbolInstanceStart;_e<n.symbolInstanceEnd;_e++)Se(y.symbolInstances.get(_e),_e,y.collisionArrays[_e]);if(f&&y.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[y.bucketInstanceId];s.a6.invert(_e.invProjMatrix,S),_e.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(n,o,f,_){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:I,crossTileID:D}=f,L=s.be(o),z=_===s.b6.vertical?I:L==="left"?y:L==="center"?w:L==="right"?S:-1;y>=0&&(n.text.placedSymbolArray.get(y).crossTileID=z>=0&&y!==z?0:D),w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=z>=0&&w!==z?0:D),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=z>=0&&S!==z?0:D),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=z>=0&&I!==z?0:D)}markUsedOrientation(n,o,f){const _=o===s.b6.horizontal||o===s.b6.horizontalOnly?o:0,y=o===s.b6.vertical?o:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:D}=f,L=n.text.placedSymbolArray;w>=0&&(L.get(w).placedOrientation=_),S>=0&&(L.get(S).placedOrientation=_),I>=0&&(L.get(I).placedOrientation=_),D>=0&&(L.get(D).placedOrientation=y)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let f=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const _=o?o.symbolFadeChange(n):1,y=o?o.opacities:{},w=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const I in this.placements){const D=this.placements[I],L=y[I];L?(this.opacities[I]=new bo(L,_,D.text,D.icon,null,D.clipped),f=f||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[I]=new bo(null,_,D.text,D.icon,D.skipFade,D.clipped),f=f||D.text||D.icon)}for(const I in y){const D=y[I];if(!this.opacities[I]){const L=new bo(D,_,!1,!1);L.isHidden()||(this.opacities[I]=L,f=f||D.text.placed||D.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:n)}updateLayerOpacities(n,o){const f=new Set;for(const _ of o){const y=_.getBucket(n);y&&_.latestFeatureIndex&&n.fqid===y.layerIds[0]&&(this.updateBucketOpacities(y,f,_.collisionBoxArray),y.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(y,_.tileID),y.updateZOffset()))}}updateBucketOpacities(n,o,f){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const _=n.layers[0].layout,y=!!n.layers[0].dynamicFilter(),w=new bo(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),D=_.get("text-variable-anchor"),L=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",F=new bo(null,0,S&&(I||!n.hasIconData()||_.get("icon-optional")),I&&(S||!n.hasTextData()||_.get("text-optional")),!0);!n.collisionArrays&&f&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(f);const N=(G,H,U)=>{for(let Y=0;Y<H/4;Y++)G.opacityVertexArray.emplaceBack(U)};let $=0;for(let G=0;G<n.symbolInstances.length;G++){const H=n.symbolInstances.get(G),{numHorizontalGlyphVertices:U,numVerticalGlyphVertices:Y,crossTileID:te,numIconVertices:J}=H,ie=o.has(te);let W=this.opacities[te];ie?W=w:W||(W=F,this.opacities[te]=W),o.add(te);const ne=U>0||Y>0,le=J>0,ce=this.placedOrientations[te],pe=ce===s.b6.vertical,Se=ce===s.b6.horizontal||ce===s.b6.horizontalOnly;if(!ne&&!le||W.isHidden()||$++,ne){const _e=Kf(W.text);N(n.text,U,pe?Dl:_e),N(n.text,Y,Se?Dl:_e);const ze=W.text.isHidden(),{leftJustifiedTextSymbolIndex:De,centerJustifiedTextSymbolIndex:He,rightJustifiedTextSymbolIndex:ye,verticalPlacedTextSymbolIndex:Ie}=H,fe=n.text.placedSymbolArray,we=ze||pe?1:0;De>=0&&(fe.get(De).hidden=we),He>=0&&(fe.get(He).hidden=we),ye>=0&&(fe.get(ye).hidden=we),Ie>=0&&(fe.get(Ie).hidden=ze||Se?1:0);const Ze=this.variableOffsets[te];Ze&&this.markUsedJustification(n,Ze.anchor,H,ce);const it=this.placedOrientations[te];it&&(this.markUsedJustification(n,"left",H,it),this.markUsedOrientation(n,it,H))}if(le){const _e=Kf(W.icon),{placedIconSymbolIndex:ze,verticalPlacedIconSymbolIndex:De}=H,He=n.icon.placedSymbolArray,ye=W.icon.isHidden()?1:0;ze>=0&&(N(n.icon,J,pe?Dl:_e),He.get(ze).hidden=ye),De>=0&&(N(n.icon,H.numVerticalIconVertices,Se?Dl:_e),He.get(De).hidden=ye)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const _e=n.collisionArrays[G];if(_e){let ze=new s.P(0,0),De=!0;if(_e.textBox||_e.verticalTextBox){if(D){const ye=this.variableOffsets[te];ye?(ze=Jo(ye.anchor,ye.width,ye.height,ye.textOffset,ye.textScale),L&&ze._rotate(z?this.transform.angle:-this.transform.angle)):De=!1}y&&(De=!W.clipped),_e.textBox&&La(n.textCollisionBox.collisionVertexArray,W.text.placed,!De||pe,ze.x,ze.y),_e.verticalTextBox&&La(n.textCollisionBox.collisionVertexArray,W.text.placed,!De||Se,ze.x,ze.y)}const He=De&&!!(!Se&&_e.verticalIconBox);_e.iconBox&&La(n.iconCollisionBox.collisionVertexArray,W.icon.placed,He,H.hasIconTextFit?ze.x:0,H.hasIconTextFit?ze.y:0),_e.verticalIconBox&&La(n.iconCollisionBox.collisionVertexArray,W.icon.placed,!He,H.hasIconTextFit?ze.x:0,H.hasIconTextFit?ze.y:0)}}}if(n.fullyClipped=$===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const G=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=G.invProjMatrix,n.placementViewportMatrix=G.viewportMatrix,n.collisionCircleArray=G.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,o){const f=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function La(h,n,o,f,_){h.emplaceBack(n?1:0,o?1:0,f||0,_||0),h.emplaceBack(n?1:0,o?1:0,f||0,_||0),h.emplaceBack(n?1:0,o?1:0,f||0,_||0),h.emplaceBack(n?1:0,o?1:0,f||0,_||0)}const Y_=Math.pow(2,25),Xf=Math.pow(2,24),Yf=Math.pow(2,17),wh=Math.pow(2,16),K_=Math.pow(2,9),J_=Math.pow(2,8),Q_=Math.pow(2,1);function Kf(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const n=h.placed?1:0,o=Math.floor(127*h.opacity);return o*Y_+n*Xf+o*Yf+n*wh+o*K_+n*J_+o*Q_+n}const Dl=0;class eg{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,o,f,_,y){const w=this._bucketParts;for(;this._currentTileIndex<n.length;)if(o.getBucketParts(w,_,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<w.length;){const S=w[this._currentPartIndex];if(o.placeLayerBucketPart(S,this._seenCrossTileIDs,f,S.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class Yc{constructor(n,o,f,_,y,w,S,I,D){this.placement=new X_(n,y,w,S,I,D),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,o,f,_){const y=s.f.now(),w=()=>{const S=s.f.now()-y;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=o[n[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=I)&&(!S.maxzoom||S.maxzoom>I)){const D=S,L=D.layout.get("symbol-z-elevate"),z=this._inProgressLayer=this._inProgressLayer||new eg(D),F=s.ag(S.source,S.scope);if(z.continuePlacement(L?_[F]:f[F],this.placement,this._showCollisionBoxes,S,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Th=512/s.V/2;class Jf{constructor(n,o,f){this.tileID=n,this.bucketInstanceId=f,this.index=new s.bg(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=n.canonical.x*s.V,y=n.canonical.y*s.V;for(let w=0;w<o.length;w++){const{key:S,crossTileID:I,tileAnchorX:D,tileAnchorY:L}=o.get(w),z=Math.floor((_+D)*Th),F=Math.floor((y+L)*Th);this.index.add(z,F),this.keys.push(S),this.crossTileIDs.push(I)}this.index.finish()}findMatches(n,o,f){const _=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),y=Th/Math.pow(2,o.canonical.z-this.tileID.canonical.z),w=o.canonical.x*s.V,S=o.canonical.y*s.V;for(let I=0;I<n.length;I++){const D=n.get(I);if(D.crossTileID)continue;const{key:L,tileAnchorX:z,tileAnchorY:F}=D,N=Math.floor((w+z)*y),$=Math.floor((S+F)*y),G=this.index.range(N-_,$-_,N+_,$+_);for(const H of G){const U=this.crossTileIDs[H];if(this.keys[H]===L&&!f.has(U)){f.add(U),D.crossTileID=U;break}}}}}class Mh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const o=Math.round((n-this.lng)/360);if(o!==0)for(const f in this.indexes){const _=this.indexes[f],y={};for(const w in _){const S=_[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),y[S.tileID.key]=S}this.indexes[f]=y}this.lng=n}addBucket(n,o,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const _=this.usedCrossTileIDs[n.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>n.overscaledZ)for(const S in w){const I=w[S];I.tileID.isChildOf(n)&&I.findMatches(o.symbolInstances,n,_)}else{const S=w[n.scaledTo(Number(y)).key];S&&S.findMatches(o.symbolInstances,n,_)}}for(let y=0;y<o.symbolInstances.length;y++){const w=o.symbolInstances.get(y);w.crossTileID||(w.crossTileID=f.generate(),_.add(w.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Jf(n,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(n,o){for(const f of o.crossTileIDs)this.usedCrossTileIDs[n].delete(f)}removeStaleBuckets(n){let o=!1;for(const f in this.indexes){const _=this.indexes[f];for(const y in _)n[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[y]),delete _[y],o=!0)}return o}}class Sh{constructor(){this.layerIndexes={},this.crossTileIDs=new Mh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,o,f,_){let y=this.layerIndexes[n.fqid];y===void 0&&(y=this.layerIndexes[n.fqid]=new Kc);let w=!1;const S={};_.name!=="globe"&&y.handleWrapJump(f);for(const I of o){const D=I.getBucket(n);D&&n.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(I.tileID,D,this.crossTileIDs)&&(w=!0),S[D.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(w=!0),w}pruneUnusedLayers(n){const o={};n.forEach(f=>{o[f]=!0});for(const f in this.layerIndexes)o[f]||delete this.layerIndexes[f]}}class Qo{constructor(n=0,o=0,f=0,_=0){if(isNaN(n)||n<0||isNaN(o)||o<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=o,this.left=f,this.right=_}interpolate(n,o,f){return o.top!=null&&n.top!=null&&(this.top=s.U(n.top,o.top,f)),o.bottom!=null&&n.bottom!=null&&(this.bottom=s.U(n.bottom,o.bottom,f)),o.left!=null&&n.left!=null&&(this.left=s.U(n.left,o.left,f)),o.right!=null&&n.right!=null&&(this.right=s.U(n.right,o.right,f)),this}getCenter(n,o){const f=s.aa((this.left+n-this.right)/2,0,n),_=s.aa((this.top+o-this.bottom)/2,0,o);return new s.P(f,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Qo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Jc(h,n){const o=s.bk(h,3);s.a6.fromQuat(h,n),s.bm(h,3,o)}function Ll(h,n){const o=s.bi.identity([]);return s.bi.rotateZ(o,o,-n),s.bi.rotateX(o,o,-h),o}function Eh(h,n){const o=[h[0],h[1],0],f=[n[0],n[1],0];if(s.N.length(o)>=1e-15){const w=s.N.normalize([],o);s.N.scale(f,w,s.N.dot(f,w)),n[0]=f[0],n[1]=f[1]}const _=s.N.cross([],n,h);if(s.N.len(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return Ll(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}class Rl{constructor(n,o){this.position=n,this.orientation=o}get position(){return this._position}set position(n){if(n){const o=n instanceof s.L?n:new s.L(n[0],n[1],n[2]);this._renderWorldCopies&&(o.x=s.bh(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(n,o){if(this.orientation=null,!this.position)return;const f=this.position,_=this._elevation?this._elevation.getAtPointOrZero(s.L.fromLngLat(n)):0,y=s.L.fromLngLat(n,_),w=[y.x-f.x,y.y-f.y,y.z-f.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Eh(w,o)}setPitchBearing(n,o){this.orientation=Ll(s.bj(n),s.bj(-o))}}class Ra{constructor(n,o){this._transform=s.a6.identity([]),this.orientation=o,this.position=n}get mercatorPosition(){const n=this.position;return new s.L(n[0],n[1],n[2])}get position(){const n=s.bk(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var o;n&&s.bm(this._transform,3,[(o=n)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.bi.identity([]),n&&Jc(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,o){this._orientation=Ll(n,o),Jc(this._transform,this._orientation)}forward(){const n=s.bk(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.bk(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.bk(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,o){const f=new Float64Array(16);return s.a6.invert(f,this.getWorldToCamera(n,o)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,o,f){const _=this.position;s.N.scale(_,_,-n);const y=new Float64Array(16);return s.a6.fromScaling(y,[f,f,f]),s.a6.translate(y,y,_),y[10]*=o,y}getWorldToCamera(n,o){const f=new Float64Array(16),_=new Float64Array(4),y=this.position;return s.bi.conjugate(_,this._orientation),s.N.scale(y,y,-n),s.a6.fromQuat(f,_),s.a6.translate(f,f,y),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=o,f[9]*=o,f[10]*=o,f[11]*=o,f}getCameraToClipPerspective(n,o,f,_){const y=new Float64Array(16);return s.a6.perspective(y,n,o,f,_),y}getCameraToClipOrthographic(n,o,f,_,y,w){const S=new Float64Array(16);return s.a6.ortho(S,n,o,f,_,y,w),S}getDistanceToElevation(n,o=!1){const f=n===0?0:s.bl(n,o?s.au(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new Ra([...this.position],[...this.orientation])}}const za=(h,n,o)=>(1-o)*h+o*n,zl=h=>h*h*h*h*h;class kl{constructor(n,o,f,_,y,w,S){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=n||0,this._maxZoom=o||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(w),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ra,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new kl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,o=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return s.ac(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=s.bo(this.projectionOptions);const f=!B(o,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bo({name:"mercator"});const o=n!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bh(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const o=-n*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=s.b4.create(),s.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const o=s.aa(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.bj(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const o=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,y=0;for(let w=0;w<o.length;w++){const S=new s.P(o[w][0]*this.width,f+o[w][1]*(this.height-f)),I=n.pointCoordinate(S);if(!I)continue;const D=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);_+=I[3]*D,y+=D}return y===0?NaN:_/y}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*o,_=this._mercatorZfromZoom(n),y=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-f,y);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[o.x,o.y,o.z]:[n.x,n.y,n.z];const _=s.N.length(s.N.sub([],this._camera.position,f));return s.aa(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let o=!1;if(n.orientation&&!s.bi.exactEquals(n.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];s.N.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,o=new Rl;return o.position=new s.L(n[0],n[1],n[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(n){if(!s.bi.length(n))return!1;s.bi.normalize(n,n);const o=s.N.transformQuat([],[0,0,-1],n),f=s.N.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const _=Eh(o,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const o=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=s.aa(n[2],_/f,_/o),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,o,f){this._unmodified=!1,this._edgeInsets.interpolate(n,o,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const o=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(n){const o=[new s.bp(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new s.P(0,0)),_=this.pointCoordinate(new s.P(this.width,0)),y=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),S=Math.floor(Math.min(f.x,_.x,y.x,w.x)),I=Math.floor(Math.max(f.x,_.x,y.x,w.x)),D=1;for(let L=S-D;L<=I+D;L++)L!==0&&o.push(new s.bp(L,n))}return o}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(n,o,f){let _=[];if(o[0]===0&&o[1]===0)return _;for(const w of n){const S=w.canonical,I=w.overscaledZ,D=w.wrap,L=1<<S.z,z=S.x+1<L,F=S.x>0,N=S.y+1<L,$=S.y>0,G=w.wrap-(F?0:1),H=w.wrap+(z?0:1),U=F?S.x-1:L-1,Y=z?S.x+1:0;o[0]<0?(_.push(new s.am(I,H,S.z,Y,S.y)),o[1]<0&&N&&(_.push(new s.am(I,D,S.z,S.x,S.y+1)),_.push(new s.am(I,H,S.z,Y,S.y+1))),o[1]>0&&$&&(_.push(new s.am(I,D,S.z,S.x,S.y-1)),_.push(new s.am(I,H,S.z,Y,S.y-1)))):o[0]>0?(_.push(new s.am(I,G,S.z,U,S.y)),o[1]<0&&N&&(_.push(new s.am(I,D,S.z,S.x,S.y+1)),_.push(new s.am(I,G,S.z,U,S.y+1))),o[1]>0&&$&&(_.push(new s.am(I,D,S.z,S.x,S.y-1)),_.push(new s.am(I,G,S.z,U,S.y-1)))):o[1]<0&&N?_.push(new s.am(I,D,S.z,S.x,S.y+1)):$&&_.push(new s.am(I,D,S.z,S.x,S.y-1))}if(_.length>1){_.sort((I,D)=>I.overscaledZ-D.overscaledZ||I.wrap-D.wrap||I.canonical.z-D.canonical.z||I.canonical.x-D.canonical.x||I.canonical.y-D.canonical.y);let w=0,S=0;for(;S<_.length;)_[S].equals(_[w])?++S:_[++w]=_[S++];_.length=w+1}const y=[];for(const w of _)_.some(S=>w.isChildOf(S))||y.push(w);return _=y.filter(w=>!n.some(S=>!!(w.overscaledZ<f&&S.isChildOf(w))||w.equals(S)||w.isChildOf(S))),_}coveringTiles(n){let o=this.coveringZoomLevel(n);const f=o,_=this.elevation&&this.elevation.exaggeration(),y=_&&!n.isTerrainDEM,w=this.projection.name==="mercator";if(n.minzoom!==void 0&&o<n.minzoom)return[];n.maxzoom!==void 0&&o>n.maxzoom&&(o=n.maxzoom);const S=this.locationCoordinate(this.center),I=this.center.lat,D=1<<o,L=[D*S.x,D*S.y,0],z=this.projection.name==="globe",F=!z,N=s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,F),$=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=D*s.bl(1,this.center.lat),H=this._camera.position[2]/s.bl(1,this.center.lat),U=[D*$.x,D*$.y,H*(F?1:G)],Y=z||_,te=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),J=this.isLODDisabled(!0)?o:0;let ie;if(this._elevation&&n.isTerrainDEM)ie=1e4*this._elevation.exaggeration();else if(this._elevation){const fe=this._elevation.getMinMaxForVisibleTiles();ie=fe?fe.max:this._centerAltitude}else ie=this._centerAltitude;const W=n.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?s.br(this):1,le=fe=>{const Ze=new s.L(fe.x+25e-6,fe.y,fe.z),it=new s.L(fe.x,fe.y+25e-6,fe.z),tt=fe.toLngLat(),dt=Ze.toLngLat(),Pt=it.toLngLat(),Ut=this.locationCoordinate(tt),zt=this.locationCoordinate(dt),Bt=this.locationCoordinate(Pt),li=Math.hypot(zt.x-Ut.x,zt.y-Ut.y),Jt=Math.hypot(Bt.x-Ut.x,Bt.y-Ut.y);return Math.sqrt(li*Jt)*ne/25e-6},ce=fe=>{const we=ie,Ze=W;return{aabb:s.bu(this,D,0,0,0,fe,Ze,we,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:we,wrap:fe,fullyVisible:!1}},pe=[];let Se=[];const _e=o,ze=n.reparseOverscaled?f:o,De=fe=>fe*fe,He=De((H-this._centerAltitude)*G),ye=fe=>{if(!this._elevation||!fe.tileID||!w)return;const we=this._elevation.getMinMaxForTile(fe.tileID),Ze=fe.aabb;we?(Ze.min[2]=we.min,Ze.max[2]=we.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(fe.shouldSplit=Ie(fe),fe.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Ie=fe=>{if(fe.zoom<J)return!0;if(fe.zoom===_e)return!1;if(fe.shouldSplit!=null)return fe.shouldSplit;const we=fe.aabb.distanceX(U),Ze=fe.aabb.distanceY(U);let it=He,tt=1;if(z){it=De(fe.aabb.distanceZ(U));const Ut=Math.pow(2,fe.zoom),zt=s.au((fe.y+1)/Ut),Bt=s.au(fe.y/Ut),li=Math.min(Math.max(I,zt),Bt),Jt=s.bJ(li)/s.bJ(I);if(tt=li===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jt/this._mercatorScaleRatio),this.zoom<=s.bG&&fe.zoom===_e-1&&Jt>=.9)return!0}else if(y&&(it=De(fe.aabb.distanceZ(U)*G)),this.projection.isReprojectedInTileSpace&&f<=5){const Ut=Math.pow(2,fe.zoom),zt=le(new s.L((fe.x+.5)/Ut,(fe.y+.5)/Ut));tt=zt>.85?1:zt}const dt=we*we+Ze*Ze+it,Pt=De((1<<_e-fe.zoom)*te*tt*((Ut,zt)=>{if(zt*De(.707)<Ut)return 1;const Bt=Math.sqrt(zt/Ut);return Bt/(1.4144271570014144+(Math.pow(1.1,Bt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(it,He),dt));return dt<Pt};if(this.renderWorldCopies)for(let fe=1;fe<=3;fe++)pe.push(ce(-fe)),pe.push(ce(fe));for(pe.push(ce(0));pe.length>0;){const fe=pe.pop(),we=fe.x,Ze=fe.y;let it=fe.fullyVisible;const tt=()=>this.projection.name==="globe"&&(fe.y===0||fe.y===(1<<fe.zoom)-1);if(!it){let dt=Y?fe.aabb.intersects(N):fe.aabb.intersectsFlat(N);if(dt===0&&tt()){const Pt=new s.bs(fe.zoom,we,Ze);dt=s.bt(this,D,Pt,!0).intersects(N)}if(dt===0)continue;it=dt===2}if(fe.zoom!==_e&&Ie(fe))for(let dt=0;dt<4;dt++){const Pt=(we<<1)+dt%2,Ut=(Ze<<1)+(dt>>1),zt={aabb:w?fe.aabb.quadrant(dt):s.bu(this,D,fe.zoom+1,Pt,Ut,fe.wrap,fe.minZ,fe.maxZ,this.projection),zoom:fe.zoom+1,x:Pt,y:Ut,wrap:fe.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:fe.minZ,maxZ:fe.maxZ};y&&!z&&(zt.tileID=new s.am(fe.zoom+1===_e?ze:fe.zoom+1,fe.wrap,fe.zoom+1,Pt,Ut),ye(zt)),pe.push(zt)}else{const dt=fe.zoom===_e?ze:fe.zoom;if(n.minzoom&&n.minzoom>dt)continue;if(!it){let Bt=Y?fe.aabb.intersectsPrecise(N):fe.aabb.intersectsPreciseFlat(N);if(Bt===0&&tt()){const li=new s.bs(fe.zoom,we,Ze);Bt=s.bt(this,D,li,!0).intersectsPrecise(N)}if(Bt===0)continue}const Pt=L[0]-(.5+we+(fe.wrap<<fe.zoom))*(1<<o-fe.zoom),Ut=L[1]-.5-Ze,zt=fe.tileID?fe.tileID:new s.am(dt,fe.wrap,fe.zoom,we,Ze);Se.push({tileID:zt,distanceSq:Pt*Pt+Ut*Ut})}}if(this.fogCullDistSq){const fe=this.fogCullDistSq,we=this.horizonLineFromTop();Se=Se.filter(Ze=>{const it=[0,0,0,1],tt=[s.V,s.V,0,1],dt=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());s.a7.transformMat4(it,it,dt),s.a7.transformMat4(tt,tt,dt);const Pt=s.a7.min([],it,tt),Ut=s.a7.max([],it,tt),zt=s.bv(Pt,Ut);if(zt===0)return!0;let Bt=!1;const li=this._elevation;if(li&&zt>fe&&we!==0){const Jt=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let ri;n.isTerrainDEM||(ri=li.getMinMaxForTile(Ze.tileID)),ri||(ri={min:W,max:ie});const ni=s.bH(this.rotation),Ai=[ni[0]*s.V,ni[1]*s.V,ri.max];s.N.transformMat4(Ai,Ai,Jt),Bt=(1-Ai[1])*this.height*.5<we}return zt<fe||Bt})}return Se.sort((fe,we)=>fe.distanceSq-we.distanceSq).map(fe=>fe.tileID)}resize(n,o){this.width=n,this.height=o,this.pixelsToGLUnits=[2/n,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const o=s.aa(n.lat,-s.bw,s.bw),f=this.projection.project(n.lng,o);return new s.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,o){let f,_;const y=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;f=(o.x-y.x)/S,_=(o.y-y.y)/S}else{const S=this.pointCoordinate(o),I=this.pointCoordinate(y);f=S.x-I.x,_=S.y-I.y}const w=this.locationCoordinate(n);this.setLocation(new s.L(w.x-f,w.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,o){const f=o?s.bl(o,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new s.L(_.x,_.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,o){const f=o??this._centerAltitude,_=[n.x,n.y,0,1],y=[n.x,n.y,1,1];s.a7.transformMat4(_,_,this.pixelMatrixInverse),s.a7.transformMat4(y,y,this.pixelMatrixInverse);const w=y[3];s.a7.scale(_,_,1/_[3]),s.a7.scale(y,y,1/w);const S=_[2],I=y[2];return{p0:_,p1:y,t:S===I?0:(f-S)/(I-S)}}screenPointToMercatorRay(n){const o=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return s.a7.transformMat4(o,o,this.pixelMatrixInverse),s.a7.transformMat4(f,f,this.pixelMatrixInverse),s.a7.scale(o,o,1/o[3]),s.a7.scale(f,f,1/f[3]),o[2]=s.bl(o[2],this._center.lat)*this.worldSize,f[2]=s.bl(f[2],this._center.lat)*this.worldSize,s.a7.scale(o,o,1/this.worldSize),s.a7.scale(f,f,1/this.worldSize),new s.a2([o[0],o[1],o[2]],s.N.normalize([],s.N.sub([],f,o)))}rayIntersectionCoordinate(n){const{p0:o,p1:f,t:_}=n,y=s.bl(o[2],this._center.lat),w=s.bl(f[2],this._center.lat);return new s.L(s.U(o[0],f[0],_)/this.worldSize,s.U(o[1],f[1],_)/this.worldSize,s.U(y,w,_))}pointCoordinate(n,o=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,o)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let o=this.projection.pointCoordinate3D(this,n.x,n.y);if(o)return new s.L(o[0],o[1],o[2]);let f=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const y=.02*_,w=n.clone();for(let S=0;S<10&&_-f>y;S++){w.y=s.U(f,_,.66);const I=this.projection.pointCoordinate3D(this,w.x,w.y);I?(_=w.y,o=I):f=w.y}return o?new s.L(o[0],o[1],o[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.bx)return!this.isPointAboveHorizon(n);const o=this.pointCoordinate(n);return o.y>=0&&o.y<=1}_coordinatePoint(n,o){const f=o&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return s.a7.transformMat4(_,_,this.pixelMatrix),_[3]>0?new s.P(_[0]/_[3],_[1]/_[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:o}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new s.P(o,n)),w=this.pointLocation3D(new s.P(_,n)),S=this.pointLocation3D(new s.P(_,f)),I=this.pointLocation3D(new s.P(o,f));let D=Math.min(y.lng,w.lng,S.lng,I.lng),L=Math.max(y.lng,w.lng,S.lng,I.lng),z=Math.min(y.lat,w.lat,S.lat,I.lat),F=Math.max(y.lat,w.lat,S.lat,I.lat);const N=Math.pow(2,-this.zoom)/16*270,$=this.projection.name==="globe"?1:4,G=(H,U,Y,te,J)=>{const ie=(H+Y)/2,W=(U+te)/2,ne=new s.P(ie,W),{lng:le,lat:ce}=this.pointLocation3D(ne),pe=Math.max(0,D-le,z-ce,le-L,ce-F);D=Math.min(D,le),L=Math.max(L,le),z=Math.min(z,ce),F=Math.max(F,ce),(J<$||pe>N)&&(G(H,U,ie,W,J+1),G(ie,W,Y,te,J+1))};if(G(o,n,_,n,1),G(_,n,_,f,1),G(_,f,o,f,1),G(o,f,o,n,1),this.projection.name==="globe"){const[H,U]=s.by(this);H?(F=90,L=180,D=-180):U&&(z=-90,L=180,D=-180)}return new s.ad(new s.bn(D,z),new s.bn(L,F))}_getBoundsRectangular(n,o){const{top:f,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,S=new s.P(_,f),I=new s.P(w,f),D=new s.P(w,y),L=new s.P(_,y);let z=this.pointCoordinate(S,n),F=this.pointCoordinate(I,n);const N=this.pointCoordinate(D,o),$=this.pointCoordinate(L,o),G=(H,U)=>(U.y-H.y)/(U.x-H.x);return z.y>1&&F.y>=0?z=new s.L((1-$.y)/G($,z)+$.x,1):z.y<0&&F.y<=1&&(z=new s.L(-$.y/G($,z)+$.x,0)),F.y>1&&z.y>=0?F=new s.L((1-N.y)/G(N,F)+N.x,1):F.y<0&&z.y<=1&&(F=new s.L(-N.y/G(N,F)+N.x,0)),new s.ad().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=n.visibleDemTiles.reduce((f,_)=>{if(_.dem){const y=_.dem.tree;f.min=Math.min(f.min,y.minimums[0]),f.max=Math.max(f.max,y.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*n.exaggeration(),o.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-o*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.bw,this.maxLat=s.bw,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.a5(this.minLng)*this.tileSize,this.worldMaxX=s.a5(this.maxLng)*this.tileSize,this.worldMinY=s.ae(this.maxLat)*this.tileSize,this.worldMaxY=s.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,o){return this.projection.createTileMatrix(this,o,n)}calculateDistanceTileData(n){const o=n.key,f=this._distanceTileDataCache;if(f[o])return f[o];const _=n.canonical,y=1/this.height,w=this.cameraWorldSize,S=w/this.zoomScale(_.z),I=(_.x+Math.pow(2,_.z)*n.wrap)*S,D=_.y*S,L=this.point;L.x*=w/this.worldSize,L.y*=w/this.worldSize;const z=this.angle,F=Math.sin(-z),N=-Math.cos(-z);return f[o]={bearing:[F,N],center:[(L.x-I)*y,(L.y-D)*y],scale:S/s.V*y},f[o]}calculateFogTileMatrix(n){const o=n.key,f=this._fogTileMatrixCache;if(f[o])return f[o];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.a6.multiply(_,this.worldToFogMatrix,_),f[o]=new Float32Array(_),f[o]}calculateProjMatrix(n,o=!1,f=!1){const _=n.key;let y;if(y=f?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];const w=this.calculatePosMatrix(n,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,s.a6.multiply(w,S,w),y[_]=new Float32Array(w),y[_]}calculatePixelsToTileUnitsMatrix(n){const o=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[o])return f[o];const _=s.bz(n,this);return f[o]=_,f[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,o=s.a6.fromScaling([],[n,n,n]);return s.a6.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const o=s.bl(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(o),_=this._camera.forward(),y=s.bl(1,this._center.lat);f[2]/=y,_[2]/=y,s.N.normalize(_,_);const w=n.raycast(f,_,n.exaggeration());if(w){const S=s.N.scaleAndAdd([],f,_,w),I=new s.L(S[0],S[1],s.bl(S[2],s.au(S[1]))),D=(I.z+s.N.length([I.x-f[0],I.y-f[1],I.z-f[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const o=this._elevation,f=s.bl(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),y=o.getAtPointOrZero(new s.L(..._)),w=this.pixelsPerMeter/this.worldSize*y,S=this._minimumHeightOverTerrain(),I=_[2]-w;if(I<=S)if(I<0||n){const D=this.locationCoordinate(this._center,this._centerAltitude),L=[_[0],_[1],D.z-_[2]],z=s.N.length(L);L[2]-=(S-I)/this._pixelsPerMercatorPixel;const F=s.N.length(L);if(F===0)return;s.N.scale(L,L,z/F*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],D.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const F=this.center;return F.lat=s.aa(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(F.lng=s.aa(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const o=this._unmodified,{x:f,y:_}=this.point;let y=0,w=f,S=_;const I=this.width/2,D=this.height/2,L=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(_-D<L&&(S=L+D),_+D>z&&(S=z-D),z-L<this.height&&(y=Math.max(y,this.height/(z-L)),S=(z+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,$=this.worldSize/2-(F+N)/2;w=(f+$+this.worldSize)%this.worldSize-$,w-I<F&&(w=F+I),w+I>N&&(w=N-I),N-F<this.width&&(y=Math.max(y,this.width/(N-F)),w=(N+F)/2)}w===f&&S===_||(this.center=this.unproject(new s.P(w,S))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,o=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bl(1,this.center.lat)/s.bl(1,s.bI));const _=s.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?f:1,w=this._camera.getWorldToCamera(this.worldSize,y);let S;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-n.x/this.width,I[9]=2*n.y/this.height,this.isOrthographic){let ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),pe=ce*this.aspect,Se=-pe,_e=-ce;pe-=n.x,Se-=n.x,ce+=n.y,_e+=n.y,S=this._camera.getCameraToClipOrthographic(Se,pe,_e,ce,this._nearZ,this._farZ),((ze,De,He,ye)=>{for(let Ie=0;Ie<16;Ie++)ze[Ie]=za(De[Ie],He[Ie],ye)})(S,S,I,zl(this.pitch>=15?1:this.pitch/15))}else S=I;const D=s.a6.mul([],I,w);let L=s.a6.mul([],S,w);if(this.projection.isReprojectedInTileSpace){const ce=this.locationCoordinate(this.center),pe=s.a6.identity([]);s.a6.translate(pe,pe,[ce.x*this.worldSize,ce.y*this.worldSize,0]),s.a6.multiply(pe,pe,s.bB(this)),s.a6.translate(pe,pe,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),s.a6.multiply(L,L,pe),s.a6.multiply(D,D,pe),this.inverseAdjustmentMatrix=s.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.a6.scale([],L,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=L,this.invProjMatrix=s.a6.invert(new Float64Array(16),this.projMatrix),o){const ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ce[8]=2*-n.x/this.width,ce[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.a6.mul([],ce,w)}else this.expandedFarZProjMatrix=this.projMatrix;const z=s.a6.invert([],S);this.frustumCorners=s.bD.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const F=new Float32Array(16);s.a6.identity(F),s.a6.scale(F,F,[1,-1,1]),s.a6.rotateX(F,F,this._pitch),s.a6.rotateZ(F,F,this.angle);const N=s.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.a6.clone(N);const $=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-n.x/this.width,N[9]=2*(n.y+$)/this.height,this.skyboxMatrix=s.a6.multiply(F,N,F);const G=this.point,H=G.x,U=G.y,Y=this.width%2/2,te=this.height%2/2,J=Math.cos(this.angle),ie=Math.sin(this.angle),W=H-Math.round(H)+J*Y+ie*te,ne=U-Math.round(U)+J*te+ie*Y,le=new Float64Array(L);if(s.a6.translate(le,le,[W>.5?W-1:W,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=le,L=s.a6.create(),s.a6.scale(L,L,[this.width/2,-this.height/2,1]),s.a6.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=s.a6.create(),s.a6.scale(L,L,[1,-1,1]),s.a6.translate(L,L,[-1,-1,0]),s.a6.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=s.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},L=s.a6.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.bE(this);const ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.N.transformMat4(ce,ce,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[n,n,o];s.N.scale(y,y,_),s.N.scale(f,f,-1),s.N.multiply(f,f,y);const w=s.a6.create();s.a6.translate(w,w,f),s.a6.scale(w,w,y),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,o,_)}_computeCameraPosition(n){const o=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*y,_.y/this.worldSize-f[1]*y,n/this.worldSize*this._centerAltitude-f[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=n[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((o-f)/_,1)),this._camera.position=s.N.scaleAndAdd([],this._camera.position,n,y),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,o=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),y=s.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.bj(this._maxPitch)),S=Math.max((n[2]-y)/Math.cos(f),w),I=this._zoomFromMercatorZ(S);s.N.scaleAndAdd(n,n,o,S),this._pitch=s.aa(f,s.bj(this.minPitch),s.bj(this.maxPitch)),this.angle=s.bh(_,-Math.PI,Math.PI),this._setZoom(s.aa(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.L(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let o=0,f=s.bx,_=0,y=1/0;for(;f-o>1e-6&&f>o;){const w=o+.5*(f-o),S=this.tileSize*Math.pow(2,w),I=this.getCameraToCenterDistance(this.projection,w,S),D=this.scaleZoom(I/(n*this.tileSize)),L=Math.abs(w-D);L<y&&(y=L,_=w),w<D?o=w:f=w}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,o){const f=Math.min(n.x,o.x),_=Math.max(n.x,o.x),y=Math.min(n.y,o.y),w=Math.max(n.y,o.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new s.P(f,y),new s.P(_,w),new s.P(f,w),new s.P(_,y)],I=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const L of S){const z=this.pointRayIntersection(L);if(z.t<0)return!0;const F=this.rayIntersectionCoordinate(z);if(F.x<I||F.y<0||F.x>D||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,o){const f=s.N.length(s.N.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(f)+o;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([o,f,_],y){const w=[o,f,_,1];s.a7.transformMat4(w,w,y);const S=w[3]=Math.max(w[3],1e-6);return w[0]/=S,w[1]/=S,w[2]/=S,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,o=this.zoom,f=this.worldSize){const _=s.bA(n,o,this.width,this.height,1024),y=n.pixelSpaceConversion(this.center.lat,f,_);let w=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(w=za(1,w,zl(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.a6.multiply(n,n,this.globeMatrix),n}getFrustum(n){return s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const mr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},wo=(h,n)=>{if(n>0&&h.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=h.transform,f=Math.max(Math.abs(o._zoom-(h.minCutoffZoom-1)),1),_=o.isLODDisabled(!1)?s.O(60,45,o.pitch):s.O(30,15,o.pitch),y=o._farZ-o._nearZ,w=n*o.height,S=((1-(I=_))*o.cameraToCenterDistance+I*(o._farZ+w))*f;var I;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(S-o._nearZ)/y,(S-w-o._nearZ)/y]}}},Lr={cascadeCount:2,shadowMapResolution:2048};class Ah{constructor(n,o){this.aabb=n,this.lastCascade=o}}class Qf{add(n,o){const f=this.receivers[n.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],o.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],o.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],o.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],o.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],o.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],o.max[2])):this.receivers[n.key]=new Ah(o,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,o,f){const _=s.bS.fromPoints(n.points);let y=0;for(const w in this.receivers){const S=this.receivers[w];if(!S||!_.intersectsAabb(S.aabb))continue;S.aabb.min=_.closestPoint(S.aabb.min),S.aabb.max=_.closestPoint(S.aabb.max);const I=S.aabb.getCorners();for(let D=0;D<f.length;D++){let L=!0;for(const z of I){const F=[z[0]*o,z[1]*o,z[2]];if(s.N.transformMat4(F,F,f[D].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){L=!1;break}}if(S.lastCascade=D,y=Math.max(y,D),L)break}}return y+1}}class Ih{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Qf,this._depthMode=new qt(n.context.gl.LEQUAL,qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,n.tp.registerParameter(Lr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Lr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,o){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const _=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce(($,G)=>{const H=f.style._mergedLayers[G];return $+(H.hasShadowPass()&&!H.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const y=f.context,w=Lr.shadowMapResolution,S=Lr.shadowMapResolution;if(this._cascades.length===0||Lr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $=0;$<Lr.cascadeCount;++$){const G=f._shadowMapDebug,H=y.gl,U=y.createFramebuffer(w,S,G,"texture"),Y=new s.T(y,{width:w,height:S,data:null},H.DEPTH_COMPONENT);if(U.depthAttachment.set(Y.texture),G){const te=new s.T(y,{width:w,height:S,data:null},H.RGBA);U.colorAttachment.set(te.texture)}this._cascades.push({framebuffer:U,texture:Y,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bq,scale:0})}}this.shadowDirection=Qc(o);let I=0;if(n.elevation){const $=n.elevation,G=[1e4,-1e4];$.visibleDemTiles.filter(H=>H.dem).forEach(H=>{const U=H.dem.tree;G[0]=Math.min(G[0],U.minimums[0]),G[1]=Math.max(G[1],U.maximums[0])}),G[0]!==1e4&&(I=(G[1]-G[0])*$.exaggeration())}const D=1.5*n.cameraToCenterDistance,L=3*D,z=new Float64Array(16);for(let $=0;$<this._cascades.length;++$){const G=this._cascades[$];let H=n.height/50,U=1;Lr.cascadeCount===1?U=L:$===0?U=D:(H=D,U=L);const[Y,te]=ep(n,this.shadowDirection,H,U,Lr.shadowMapResolution,I);G.scale=n.scale,G.matrix=Y,G.boundingSphereRadius=te,s.a6.invert(z,G.matrix),G.frustum=s.bq.fromInvProjectionMatrix(z,1,0,!0),G.far=U}const F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Lr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Lr.shadowMapResolution,this._uniformValues.u_shadowmap_0=mr.ShadowMap0,this._uniformValues.u_shadowmap_1=mr.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const N=f.transform.elevation;for(const $ of this._groundShadowTiles){let G={min:0,max:0};if(N){const H=N.getMinMaxForTile($);H&&(G=H)}this.addShadowReceiver($.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled}set enabled(n){this._enabled=n}drawShadowPass(n,o){if(!this._enabled)return;const f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,Lr.shadowMapResolution,Lr.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){f.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:s.ax.white,depth:1});for(const w of n.order){const S=n._mergedLayers[w];if(!S.hasShadowPass()||S.isHidden(f.transform.zoom))continue;const I=n.getLayerSourceCache(S),D=I?o[I.id]:void 0;(S.type==="model"||D&&D.length)&&f.renderLayer(f,I,S,D)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const n=this.painter,o=n.style,f=n.context,_=o.directionalLight,y=o.ambientLight;if(!_||!y)return;const w=[],S=wo(n,n.longestCutoffRange);S.shouldRenderCutoff&&w.push("RENDER_CUTOFF");const I=Ol(_,y),D=new qt(f.gl.LEQUAL,qt.ReadOnly,n.depthRangeFor3D);for(const L of this._groundShadowTiles){const z=L.toUnwrapped(),F=n.isTileAffectedByFog(L),N=n.getOrCreateProgram("groundShadow",{defines:w,overrideFog:F});this.setupShadows(z,N),n.uploadCommonUniforms(f,N,z,null,S);const $={u_matrix:n.transform.calculateProjMatrix(z),u_ground_shadow_factor:I};N.draw(n,f.gl.TRIANGLES,D,ei.disabled,mi.multiply,Ht.disabled,$,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?mi.unblended:mi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const o=this.painter.transform,f=o.calculatePosMatrix(n,o.worldSize);return s.a6.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(n){return s.a6.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,o,f,_=0){if(!this._enabled)return;const y=this.painter.transform,w=this.painter.context,S=w.gl,I=this._uniformValues,D=new Float64Array(16),L=y.calculatePosMatrix(n,y.worldSize);for(let z=0;z<this._cascades.length;z++)s.a6.multiply(D,this._cascades[z].matrix,L),I[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),w.activeTexture.set(S.TEXTURE0+mr.ShadowMap0+z),this._cascades[z].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){const z=s.bR(n.canonical),F=2/y.tileSize*s.V/Lr.shadowMapResolution,N=F*this._cascades[0].boundingSphereRadius,$=F*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(f==="vector-tile"?1:3)/Math.pow(2,_-n.canonical.z-(1-y.zoom+Math.floor(y.zoom)));I.u_shadow_normal_offset=[z,N*G,$*G],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(w,I)}setupShadowsFromMatrix(n,o,f=!1){if(!this._enabled)return;const _=this.painter.context,y=_.gl,w=this._uniformValues,S=new Float64Array(16);for(let I=0;I<Lr.cascadeCount;I++)s.a6.multiply(S,this._cascades[I].matrix,n),w[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),_.activeTexture.set(y.TEXTURE0+mr.ShadowMap0+I),this._cascades[I].texture.bind(y.NEAREST,y.CLAMP_TO_EDGE);this.useNormalOffset=f,f?(w.u_shadow_normal_offset=[1,5,5],w.u_shadow_bias=[6e-5,.0012,.012]):w.u_shadow_bias=[36e-5,.0012,.012],o.setShadowUniformValues(_,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,o,f,_){if(_[2]>=0)return{};const y=function(I,D,L){const z=L/(1<<I.canonical.z);return new s.bS([I.canonical.x*z+I.wrap*L,I.canonical.y*z+I.wrap*L,0],[(I.canonical.x+1)*z+I.wrap*L,(I.canonical.y+1)*z+I.wrap*L,D])}(n,o,f).getCorners(),w=o/-_[2];_[0]<0?(s.N.add(y[0],y[0],[_[0]*w,0,0]),s.N.add(y[3],y[3],[_[0]*w,0,0])):_[0]>0&&(s.N.add(y[1],y[1],[_[0]*w,0,0]),s.N.add(y[2],y[2],[_[0]*w,0,0])),_[1]<0?(s.N.add(y[0],y[0],[0,_[1]*w,0]),s.N.add(y[1],y[1],[0,_[1]*w,0])):_[1]>0&&(s.N.add(y[2],y[2],[0,_[1]*w,0]),s.N.add(y[3],y[3],[0,_[1]*w,0]));const S={};return S.vertices=y,S.planes=[ea(y[1],y[0],y[4]),ea(y[2],y[1],y[5]),ea(y[3],y[2],y[6]),ea(y[0],y[3],y[7])],S}addShadowReceiver(n,o,f){this._receivers.add(n,s.bS.fromTileIdAndHeight(n,o,f))}getMaxCascadeForTile(n){const o=this._receivers.get(n);return o&&o.lastCascade?o.lastCascade:0}}function ea(h,n,o){const f=s.N.sub([],o,n),_=s.N.sub([],h,n),y=s.N.cross([],f,_),w=s.N.length(y);return w===0?[0,0,1,0]:(s.N.scale(y,y,1/w),[y[0],y[1],y[2],-s.N.dot(y,n)])}function Qc(h){const n=h.properties.get("direction"),o=s.bQ(n.x,n.y,n.z);o[2]=s.aa(o[2],0,75);const f=s.bT([o[0],o[1],o[2]]);return s.N.fromValues(f.x,f.y,f.z)}function Ol(h,n){const o=h.properties.get("color"),f=h.properties.get("intensity"),_=h.properties.get("direction"),y=[_.x,_.y,_.z],w=n.properties.get("color"),S=n.properties.get("intensity"),I=Math.max(s.N.dot([0,0,1],y),0),D=[0,0,0];s.N.scale(D,w.toArray01Linear().slice(0,3),S);const L=[0,0,0];return s.N.scale(L,o.toArray01Linear().slice(0,3),I*f),s.bU([D[0]>0?D[0]/(D[0]+L[0]):0,D[1]>0?D[1]/(D[1]+L[1]):0,D[2]>0?D[2]/(D[2]+L[2]):0])}function ep(h,n,o,f,_,y){const w=h.zoom,S=h.scale,I=h.worldSize,D=1/I,L=h.aspect,z=Math.sqrt(1+L*L)*Math.tan(.5*h.fovX),F=z*z,N=f-o,$=f+o;let G,H;F>N/$?(G=f,H=f*z):(G=.5*$*(1+F),H=.5*Math.sqrt(N*N+2*(f*f+o*o)*F+$*$*F*F));const U=h.projection.pixelsPerMeter(h.center.lat,I),Y=h._camera.getCameraToWorldMercator(),te=[0,0,-G*D];s.N.transformMat4(te,te,Y);let J=H*D;const ie=h._edgeInsets;if(!(ie.left===0&&ie.top===0&&ie.right===0&&ie.bottom===0||ie.left===ie.right&&ie.top===ie.bottom)){const it=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?U:1),tt=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,o,f);tt[8]=2*-h.centerOffset.x/h.width,tt[9]=2*h.centerOffset.y/h.height;const dt=new Float64Array(16);s.a6.mul(dt,tt,it);const Pt=new Float64Array(16);s.a6.invert(Pt,dt);const Ut=s.bq.fromInvProjectionMatrix(Pt,I,w,!0);for(const zt of Ut.points){const Bt=((W=zt)[0]/=S,W[1]/=S,W[2]=s.bl(W[2],h._center.lat),W);J=Math.max(J,s.N.len(s.N.subtract([],te,Bt)))}}var W;J*=_/(_-1);const ne=Math.acos(n[2]),le=Math.atan2(-n[0],-n[1]),ce=new Ra;ce.position=te,ce.setPitchBearing(ne,le);const pe=ce.getWorldToCamera(I,U),Se=J*I,_e=Math.min(h._mercatorZfromZoom(17)*I*-2,-2*Se),ze=ce.getCameraToClipOrthographic(-Se,Se,-Se,Se,_e,(Se+y*U)/n[2]),De=new Float64Array(16);s.a6.multiply(De,ze,pe);const He=s.N.fromValues(Math.floor(1e6*te[0])/1e6*I,Math.floor(1e6*te[1])/1e6*I,0),ye=.5*_,Ie=[0,0,0];s.N.transformMat4(Ie,He,De),s.N.scale(Ie,Ie,ye);const fe=[Math.floor(Ie[0]),Math.floor(Ie[1]),Math.floor(Ie[2])],we=[0,0,0];s.N.sub(we,Ie,fe),s.N.scale(we,we,-1/ye);const Ze=new Float64Array(16);return s.a6.identity(Ze),s.a6.translate(Ze,Ze,we),s.a6.multiply(De,Ze,De),[De,Se]}const To=(h,n)=>Ct(h,n&&n.filter(o=>o.identifier!=="source.canvas")),tp=s.ac(Ei,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),ka=s.ac(Ei,["setCenter","setZoom","setBearing","setPitch"]),Ch={version:8,layers:[],sources:{}},ip={duration:300,delay:0},tg=new Set(["fill","line","background","hillshade","raster"]);class Ts extends s.E{constructor(n,o={}){super(),this.map=n,this.scope=o.scope||"",this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=s.e({},ip),this._buildingIndex=new Hf(this),this.crossTileSymbolIndex=new Sh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Ji,this.dispatcher=o.dispatcher?o.dispatcher:new s.bW(s.bX(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new xr,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new s.bY(n._requestManager,o.localFontFamily?s.bZ.all:o.localIdeographFontFamily?s.bZ.ideographs:s.bZ.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new un(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this.dispatcher.broadcast("setReferrer",s.b_());const f=this;this._rtlTextPluginCallback=Ts.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,w)=>{if(s.b$(y),w&&w.every(S=>S))for(const S in f._sourceCaches){const I=f._sourceCaches[S],D=I.getSource().type;D!=="vector"&&D!=="geojson"||I.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===y.id&&this._validateLayer(S)}})}loadURL(n,o={}){this.fire(new s.b("dataloading",{dataType:"style"}));const f=typeof o.validate=="boolean"?o.validate:!s.c0(n);n=this.map._requestManager.normalizeStyleURL(n,o.accessToken),this.resolvedImports.add(n);const _=this.importsCache.get(n);if(_)return this._load(_,f);const y=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.g(y,(w,S)=>{if(this._request=null,w)this.fire(new s.a(w));else if(S)return this.importsCache.set(n,S),this._load(S,f)})}loadJSON(n,o={}){this.fire(new s.b("dataloading",{dataType:"style"})),this._request=s.f.frame(()=>{this._request=null,this._load(n,o.validate!==!1)})}loadEmpty(){this.fire(new s.b("dataloading",{dataType:"style"})),this._load(Ch,!1)}_loadImports(n,o,f){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const y of n){const w=this._createFragmentStyle(y),S=new Promise(L=>{w.once("style.import.load",L),w.once("error",L)}).then(()=>this.mergeAll());if(_.push(S),this.resolvedImports.has(y.url)){w.loadEmpty();continue}const I=y.data||this.importsCache.get(y.url);I?w.loadJSON(I,{validate:o}):y.url?w.loadURL(y.url,{validate:o}):w.loadEmpty();const D={style:w,id:y.id,config:y.config};if(f){const L=this.fragments.findIndex(({id:z})=>z===f);this.fragments=this.fragments.slice(0,L).concat(D).concat(this.fragments.slice(L))}else this.fragments.push(D)}return Promise.allSettled(_)}_createFragmentStyle(n){const o=this.scope?s.ag(n.id,this.scope):n.id,f=new Ts(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return f.setEventedParent(this.map,{style:f}),f}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const n=this.isRootStyle();this._shouldPrecompile=n,this.fire(new s.b(n?"style.load":"style.import.load"))}_load(n,o){const f=n.schema;if(this.isRootStyle()&&(n.fragment||f&&n.fragment!==!1)){const w=s.e({},Ch,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(w,o)}if(this.setConfig(this._config,f),o&&To(this,jt(n)))return;this._loaded=!0,this.stylesheet=s.c1(n);for(const w in n.sources)this.addSource(w,n.sources[w],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const _=Wf(this.stylesheet.layers);if(this._order=_.map(w=>w.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const w=this.stylesheet.lights[0];this.light=new Tt(w.properties,w.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Tt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const w of _){const S=s.c2(w,this.scope,this.options);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize();const I=this.getOwnLayerSourceCache(S),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&S.canCastShadows()&&D&&(I.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const y=this.stylesheet.terrain;y&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(y,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.b("data",{dataType:"style"})),n.imports?this._loadImports(n.imports,o).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,o,f,_,y,w,S,I;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(n=D.light),D.stylesheet.lights)for(const L of D.stylesheet.lights)L.type==="ambient"&&D.ambientLight!=null&&(o=D.ambientLight),L.type==="directional"&&D.directionalLight!=null&&(f=D.directionalLight);_=this._prioritizeTerrain(_,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(y=D.fog),D.stylesheet.camera!=null&&(I=D.stylesheet.camera),D.stylesheet.projection!=null&&(w=D.stylesheet.projection),D.stylesheet.transition!=null&&(S=D.stylesheet.transition)}}),this.light=n,this.ambientLight=o,this.directionalLight=f,this.fog=y,_===null?delete this.terrain:this.terrain=_,this.camera=I||{"camera-projection":"perspective"},this.projection=w||{name:"mercator"},this.transition=s.e({},ip,S),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const o=f=>{for(const _ of f.fragments)o(_.style);n(f)};o(this)}_prioritizeTerrain(n,o,f){const _=n&&n.drapeRenderMode===0;return f===null?o&&o.drapeRenderMode===0?o:_?n:null:o!=null&&(!n||_||o&&o.drapeRenderMode===1)?o:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{n=this._prioritizeTerrain(n,o.terrain,o.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(n=o.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},o={},f={};this.forEachFragmentStyle(_=>{for(const y in _._sourceCaches){const w=s.ag(y,_.scope);n[w]=_._sourceCaches[y]}for(const y in _._otherSourceCaches){const w=s.ag(y,_.scope);o[w]=_._otherSourceCaches[y]}for(const y in _._symbolSourceCaches){const w=s.ag(y,_.scope);f[w]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=f}mergeLayers(){const n={},o=[],f={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(y=>{for(const w of y._order){const S=y._layers[w];if(S.type==="slot"){const I=s.c3(w);if(n[I])continue;n[I]=[]}S.slot&&n[S.slot]?n[S.slot].push(S):o.push(S)}}),this._mergedOrder=[];const _=(y=[])=>{for(const w of y)if(w.type==="slot"){const S=s.c3(w.id);n[S]&&_(n[S])}else{const S=s.ag(w.id,w.scope);this._mergedOrder.push(S),f[S]=w,w.is3D()&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0)}};_(o),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=s.e({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(o,f,_){let y,w,S;const I=s.f.devicePixelRatio>1?"@2x":"";let D=s.g(f.transformRequest(f.normalizeSpriteURL(o,I,".json"),s.R.SpriteJSON),(F,N)=>{D=null,S||(S=F,y=N,z())}),L=s.d(f.transformRequest(f.normalizeSpriteURL(o,I,".png"),s.R.SpriteImage),(F,N)=>{L=null,S||(S=F,w=N,z())});function z(){if(S)_(S);else if(y&&w){const F=s.f.getImageData(w),N={};for(const $ in y){const{width:G,height:H,x:U,y:Y,sdf:te,pixelRatio:J,stretchX:ie,stretchY:W,content:ne}=y[$],le=new s.h({width:G,height:H});s.h.copy(F,le,{x:U,y:Y},{x:0,y:0},{width:G,height:H}),N[$]={data:le,pixelRatio:J,sdf:te,stretchX:ie,stretchY:W,content:ne}}_(null,N)}}return{cancel(){D&&(D.cancel(),D=null),L&&(L.cancel(),L=null)}}}(n,this.map._requestManager,(o,f)=>{if(this._spriteRequest=null,o)this.fire(new s.a(o));else if(f)for(const _ in f)this.imageManager.addImage(_,this.scope,f[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.b("data",{dataType:"style"}))})}_validateLayer(n){const o=this.getOwnSource(n.source);if(!o)return;const f=n.sourceLayer;f&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(f)===-1)&&this.fire(new s.a(new Error(`Source layer "${f}" does not exist on source "${o.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,o)=>{const f=this.fragments[o];return f&&f.style&&(n.data=f.style.serialize()),n})}_serializeSources(){const n={};for(const o in this._sourceCaches){const f=this._sourceCaches[o].getSource();n[f.id]||(n[f.id]=f.serialize())}return n}_serializeLayers(n){const o=[];for(const f of n){const _=this._layers[f];_&&_.type!=="custom"&&o.push(_.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped(this.getLayerSourceCache(n)):tg.has(n.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const o=this.getOwnLayer(n);if(o)return o;this.fire(new s.a(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const o=this.getOwnSource(n);if(o)return o;this.fire(new s.a(new Error(`The source '${n}' does not exist in the map's style.`)))}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const o=this.calculateLightsBrightness();n.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const f=this._changes.isDirty();if(this._changes.isDirty()){const y=this._changes.getLayerUpdatesByScope();for(const w in y){const{updatedIds:S,removedIds:I}=y[w];(S||I)&&this._updateWorkerLayers(w,S,I)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}const _={};for(const y in this._mergedSourceCaches){const w=this._mergedSourceCaches[y];_[y]=w.used,w.used=!1,w.tileCoverLift=0}for(const y of this._mergedOrder){const w=this._mergedLayers[y];if(w.recalculate(n,this._availableImages),!w.isHidden(n.zoom)){const S=this.getLayerSourceCache(w);S&&(S.used=!0,S.tileCoverLift=Math.max(S.tileCoverLift,w.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let S=w.minzoom||0;S<(w.maxzoom||25.5);S++){const I=this.map.painter;if(I){const D=w.getProgramIds();if(!D)continue;for(const L of D){const z=w.getDefaultProgramParams(L,n.zoom);z&&(I.style=this,this.fog&&(I._fogVisible=!0,z.overrideFog=!0,I.getOrCreateProgram(L,z)),I._fogVisible=!1,z.overrideFog=!1,I.getOrCreateProgram(L,z),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(z.overrideRtt=!0,I.getOrCreateProgram(L,z)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const y in _){const w=this._mergedSourceCaches[y];_[y]!==w.used&&w.getSource().fire(new s.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new s.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,o,f){const _=this.getFragmentStyle(n);_&&this.dispatcher.broadcast("updateLayers",{layers:o?_._serializeLayers(o):[],scope:n,removedIds:f||[],options:_.options})}setState(n){if(this._checkLoaded(),To(this,jt(n)))return!1;(n=s.c1(n)).layers=Wf(n.layers);const o=function(_,y){if(!_)return[{command:Ei.setStyle,args:[y]}];let w=[];try{if(!B(_.version,y.version))return[{command:Ei.setStyle,args:[y]}];B(_.center,y.center)||w.push({command:Ei.setCenter,args:[y.center]}),B(_.zoom,y.zoom)||w.push({command:Ei.setZoom,args:[y.zoom]}),B(_.bearing,y.bearing)||w.push({command:Ei.setBearing,args:[y.bearing]}),B(_.pitch,y.pitch)||w.push({command:Ei.setPitch,args:[y.pitch]}),B(_.sprite,y.sprite)||w.push({command:Ei.setSprite,args:[y.sprite]}),B(_.glyphs,y.glyphs)||w.push({command:Ei.setGlyphs,args:[y.glyphs]}),B(_.imports,y.imports)||function(z=[],F=[],N){F=F||[];const $=(z=z||[]).map(yo),G=F.map(yo),H=z.reduce(Hc,{}),U=F.reduce(Hc,{}),Y=$.slice();let te,J,ie,W;for(te=0,J=0;te<$.length;te++)ie=$[te],U.hasOwnProperty(ie)?J++:(N.push({command:Ei.removeImport,args:[ie]}),Y.splice(Y.indexOf(ie,J),1));for(te=0,J=0;te<G.length;te++)ie=G[G.length-1-te],Y[Y.length-1-te]!==ie&&(H.hasOwnProperty(ie)?(N.push({command:Ei.removeImport,args:[ie]}),Y.splice(Y.lastIndexOf(ie,Y.length-J),1)):J++,W=Y[Y.length-te],N.push({command:Ei.addImport,args:[U[ie],W]}),Y.splice(Y.length-te,0,ie));for(const ne of F){const le=H[ne.id];le&&!B(le,ne)&&N.push({command:Ei.updateImport,args:[ne.id,ne]})}}(_.imports,y.imports,w),B(_.transition,y.transition)||w.push({command:Ei.setTransition,args:[y.transition]}),B(_.light,y.light)||w.push({command:Ei.setLight,args:[y.light]}),B(_.fog,y.fog)||w.push({command:Ei.setFog,args:[y.fog]}),B(_.projection,y.projection)||w.push({command:Ei.setProjection,args:[y.projection]}),B(_.lights,y.lights)||w.push({command:Ei.setLights,args:[y.lights]}),B(_.camera,y.camera)||w.push({command:Ei.setCamera,args:[y.camera]});const S={},I=[];(function(z,F,N,$){let G;for(G in F=F||{},z=z||{})z.hasOwnProperty(G)&&(F.hasOwnProperty(G)||lh(G,N,$));for(G in F){if(!F.hasOwnProperty(G))continue;const H=F[G];z.hasOwnProperty(G)?B(z[G],H)||(z[G].type==="geojson"&&H.type==="geojson"&&Z_(z,F,G)?N.push({command:Ei.setGeoJSONSourceData,args:[G,H.data]}):W_(G,F,N,$)):Al(G,F,N)}})(_.sources,y.sources,I,S);const D=[];_.layers&&_.layers.forEach(z=>{z.source&&S[z.source]?w.push({command:Ei.removeLayer,args:[z.id]}):D.push(z)});let L=_.terrain;L&&S[L.source]&&(w.push({command:Ei.setTerrain,args:[void 0]}),L=void 0),w=w.concat(I),B(L,y.terrain)||w.push({command:Ei.setTerrain,args:[y.terrain]}),function(z,F,N){F=F||[];const $=(z=z||[]).map(yo),G=F.map(yo),H=z.reduce(Hc,{}),U=F.reduce(Hc,{}),Y=$.slice(),te=Object.create(null);let J,ie,W,ne,le,ce,pe;for(J=0,ie=0;J<$.length;J++)W=$[J],U.hasOwnProperty(W)?ie++:(N.push({command:Ei.removeLayer,args:[W]}),Y.splice(Y.indexOf(W,ie),1));for(J=0,ie=0;J<G.length;J++)W=G[G.length-1-J],Y[Y.length-1-J]!==W&&(H.hasOwnProperty(W)?(N.push({command:Ei.removeLayer,args:[W]}),Y.splice(Y.lastIndexOf(W,Y.length-ie),1)):ie++,ce=Y[Y.length-J],N.push({command:Ei.addLayer,args:[U[W],ce]}),Y.splice(Y.length-J,0,W),te[W]=!0);for(J=0;J<G.length;J++)if(W=G[J],ne=H[W],le=U[W],!te[W]&&!B(ne,le))if(B(ne.source,le.source)&&B(ne["source-layer"],le["source-layer"])&&B(ne.type,le.type)){for(pe in go(ne.layout,le.layout,N,W,null,Ei.setLayoutProperty),go(ne.paint,le.paint,N,W,null,Ei.setPaintProperty),B(ne.slot,le.slot)||N.push({command:Ei.setSlot,args:[W,le.slot]}),B(ne.filter,le.filter)||N.push({command:Ei.setFilter,args:[W,le.filter]}),B(ne.minzoom,le.minzoom)&&B(ne.maxzoom,le.maxzoom)||N.push({command:Ei.setLayerZoomRange,args:[W,le.minzoom,le.maxzoom]}),ne)ne.hasOwnProperty(pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&pe!=="slot"&&(pe.indexOf("paint.")===0?go(ne[pe],le[pe],N,W,pe.slice(6),Ei.setPaintProperty):B(ne[pe],le[pe])||N.push({command:Ei.setLayerProperty,args:[W,pe,le[pe]]}));for(pe in le)le.hasOwnProperty(pe)&&!ne.hasOwnProperty(pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&pe!=="slot"&&(pe.indexOf("paint.")===0?go(ne[pe],le[pe],N,W,pe.slice(6),Ei.setPaintProperty):B(ne[pe],le[pe])||N.push({command:Ei.setLayerProperty,args:[W,pe,le[pe]]}))}else N.push({command:Ei.removeLayer,args:[W]}),ce=Y[Y.lastIndexOf(W)+1],N.push({command:Ei.addLayer,args:[le,ce]})}(D,y.layers,w)}catch(S){console.warn("Unable to compute style diff:",S),w=[{command:Ei.setStyle,args:[y]}]}return w}(this.serialize(),n).filter(_=>!(_.command in ka));if(o.length===0)return!1;const f=o.filter(_=>!(_.command in tp));if(f.length>0)throw new Error(`Unimplemented: ${f.map(_=>_.command).join(", ")}.`);return o.forEach(_=>{this[_.command].apply(this,_.args)}),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,o){return this.getImage(n)?this.fire(new s.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,o),this._afterImageUpdated(n),this)}updateImage(n,o){this.imageManager.updateImage(n,this.scope,o)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new s.a(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,o,f={}){return this._checkLoaded(),this._validate(Et,`models.${n}`,o,null,f)||(this.modelManager.addModel(n,o,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new s.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,o,f={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(ii,`sources.${n}`,o,null,f))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const _=$n(n,o,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const y=w=>{const S=(w?"symbol:":"other:")+_.id,I=s.ag(S,this.scope),D=this._sourceCaches[S]=new bs(I,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=D,D.onAdd(this.map)};y(!1),o.type!=="vector"&&o.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const o=this.getOwnSource(n);if(!o)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new s.a(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.a(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this.getOwnSourceCaches(n);for(const _ of f){const y=s.c3(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new s.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,o){this._checkLoaded(),this.getOwnSource(n).setData(o),this._changes.setDirty()}getOwnSource(n){const o=this.getOwnSourceCache(n);return o&&o.getSource()}getOwnSources(){const n=[];for(const o in this._otherSourceCaches){const f=this.getOwnSourceCache(o);f&&n.push(f.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const o in n){const f=n[o]._tiles;for(const _ in f){const y=f[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const _ of n){if(this._validate(Me,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const y=this.ambientLight;y.set(_),y.updateTransitions(o)}else this.ambientLight=new Er(_,kr,this.scope,this.options);break;case"directional":if(this.directionalLight){const y=this.directionalLight;y.set(_),y.updateTransitions(o)}else this.directionalLight=new Er(_,Un,this.scope,this.options)}}const f=new s.K(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,o=this.ambientLight;if(!n||!o)return;const f=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),_=n.properties.get("color").toArray01(),y=n.properties.get("intensity"),w=n.properties.get("direction"),S=1-s.bQ(w.x,w.y,w.z)[2]/90,I=f(_)*y*S,D=o.properties.get("color").toArray01(),L=o.properties.get("intensity");return(I+f(D)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(s.c4(n)){const o=s.c5(n),f=this.fragments.find(({id:y})=>y===o);if(!f)throw new Error(`Style import not found: ${n}`);const _=s.c3(n);return f.style.getFragmentStyle(_)}{const o=this.fragments.find(({id:f})=>f===n);if(!o)throw new Error(`Style import not found: ${n}`);return o.style}}getConfigProperty(n,o){const f=this.getFragmentStyle(n);if(!f)return null;const _=s.ag(o,f.scope),y=f.options.get(_),w=y?y.value||y.default:null;return w?w.serialize():null}setConfigProperty(n,o,f){const _=s.r(f);if(_.result!=="success")return void To(this,_.value);const y=_.value.expression,w=this.getFragmentStyle(n);if(!w)return;const S=s.ag(o,w.scope),I=w.options.get(S);I&&(this.options.set(S,{...I,value:y}),this.updateConfigDependencies())}setConfig(n,o){if(this._config=n,n||o)if(o)for(const f in o){let _,y;const w=s.r(o[f].default);if(w.result==="success"&&(_=w.value.expression),n&&n[f]!==void 0){const F=s.r(n[f]);F.result==="success"&&(y=F.value.expression)}const{minValue:S,maxValue:I,stepValue:D,type:L,values:z}=o[f];if(_){const F=s.ag(f,this.scope);this.options.set(F,{default:_,value:y,minValue:S,maxValue:I,stepValue:D,type:L,values:z})}else this.fire(new s.a(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new s.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const n of this._configDependentLayers){const o=this.getLayer(n);o&&(o.possiblyEvaluateVisibility(),this._updateLayer(o))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(n,o,f={}){this._checkLoaded();const _=n.id;if(this._layers[_])return void this.fire(new s.a(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(n.type==="custom"){if(To(this,s.c6(n)))return;y=s.c2(n,this.scope,this.options)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=s.c1(n),n=s.e(n,{source:_})),this._validate(de,`layers.${_}`,n,{arrayIndex:-1},f))return;y=s.c2(n,this.scope,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[y.id]=y.serialize()}y.isConfigDependent&&this._configDependentLayers.add(y.fqid);let w=this._order.length;if(o){const L=this._order.indexOf(o);if(L===-1)return void this.fire(new s.a(new Error(`Layer with id "${o}" does not exist on this map.`)));y.slot===this._layers[o].slot?w=L:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const S=this.getOwnLayerSourceCache(y),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&y.canCastShadows()&&I&&(S.castsShadows=!0);const D=this._changes.getRemovedLayer(y);if(D&&y.source&&S&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const L=s.ag(y.source,y.scope);D.type!==y.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(n,o){this._checkLoaded();const f=this._checkLayer(n);if(!f||n===o)return;const _=this._order.indexOf(n);this._order.splice(_,1);let y=this._order.length;if(o){const w=this._order.indexOf(o);if(w===-1)return void this.fire(new s.a(new Error(`Layer with id "${o}" does not exist on this map.`)));f.slot===this._layers[o].slot?y=w:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const o=this._checkLayer(n);if(!o)return;o.setEventedParent(null);const f=this._order.indexOf(n);this._order.splice(f,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const _=this.getOwnLayerSourceCache(o);if(_&&_.castsShadows){let y=!1;for(const w in this._layers)if(this._layers[w].source===o.source&&this._layers[w].canCastShadows()){y=!0;break}_.castsShadows=y}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const o in this._layers)if(this._layers[o].type===n)return!0;return!1}setLayerZoomRange(n,o,f){this._checkLoaded();const _=this._checkLayer(n);_&&(_.minzoom===o&&_.maxzoom===f||(o!=null&&(_.minzoom=o),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}setSlot(n,o){this._checkLoaded();const f=this._checkLayer(n);f&&f.slot!==o&&(f.slot=o,this._updateLayer(f))}setFilter(n,o,f={}){this._checkLoaded();const _=this._checkLayer(n);if(_&&!B(_.filter,o))return o==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Pe,`layers.${_.id}.filter`,o,{layerType:_.type},f)||(_.filter=s.c1(o),this._updateLayer(_)))}getFilter(n){const o=this._checkLayer(n);if(o)return s.c1(o.filter)}setLayoutProperty(n,o,f,_={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!B(y.getLayoutProperty(o),f)){if(f!=null&&(!_||_.validate!==!1)&&To(y,Je.call(jt,{key:`layers.${n}.layout.${o}`,layerType:y.type,objectKey:o,value:f,styleSpec:s.D,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(o,f),y.isConfigDependent&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(n,o){const f=this._checkLayer(n);if(f)return f.getLayoutProperty(o)}setPaintProperty(n,o,f,_={}){this._checkLoaded();const y=this._checkLayer(n);if(!y||B(y.getPaintProperty(o),f)||f!=null&&(!_||_.validate!==!1)&&To(y,Ne.call(jt,{key:`layers.${n}.paint.${o}`,layerType:y.type,objectKey:o,value:f,styleSpec:s.D})))return;const w=y.setPaintProperty(o,f);y.isConfigDependent&&this._configDependentLayers.add(y.fqid),w&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(n,o){const f=this._checkLayer(n);if(f)return f.getPaintProperty(o)}setFeatureState(n,o){this._checkLoaded();const f=n.source,_=n.sourceLayer,y=this._checkSource(f);if(!y)return;const w=y.type;if(w==="geojson"&&_)return void this.fire(new s.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.a(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(f);for(const I of S)I.setFeatureState(_,n.id,o)}removeFeatureState(n,o){this._checkLoaded();const f=n.source,_=this._checkSource(f);if(!_)return;const y=_.type,w=y==="vector"?n.sourceLayer:void 0;if(y==="vector"&&!w)return void this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.a(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(f);for(const I of S)I.removeFeatureState(w,n.id,o)}getFeatureState(n){this._checkLoaded();const o=n.source,f=n.sourceLayer,_=this._checkSource(o);if(_){if(_.type!=="vector"||f)return n.id===void 0&&this.fire(new s.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(f,n.id);this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=s.e({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return s.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),o=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(n){this._changes.updateLayer(n);const o=this.getLayerSourceCache(n),f=s.ag(n.source,n.scope),_=this._changes.getUpdatedSourceCaches();n.source&&!_[f]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),o.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const o=S=>this._mergedLayers[S].type==="fill-extrusion"||this._mergedLayers[S].type==="model",f=this.order,_={},y=[];for(let S=f.length-1;S>=0;S--){const I=f[S];if(o(I)){_[I]=S;for(const D of n){const L=D[I];if(L)for(const z of L)y.push(z)}}}y.sort((S,I)=>I.intersectionZ-S.intersectionZ);const w=[];for(let S=f.length-1;S>=0;S--){const I=f[S];if(o(I))for(let D=y.length-1;D>=0;D--){const L=y[D].feature;if(_[L.layer.id]<S)break;w.push(L),y.pop()}else for(const D of n){const L=D[I];if(L)for(const z of L)w.push(z.feature)}}return w}queryRenderedFeatures(n,o,f){o&&o.filter&&this._validate(Pe,"queryRenderedFeatures.filter",o.filter,null,o),o.scope=this.scope,o.availableImages=this._availableImages,o.serializedLayers=this._serializedLayers;const _={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.a(new Error("parameters.layers must be an Array."))),[];for(const D of o.layers){const L=this._mergedLayers[D];if(!L)return this.fire(new s.a(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];_[L.source]=!0}}const y=[],w=o.serializedLayers||{},S=o&&o.layers?o.layers.some(D=>{const L=this.getLayer(D);return L&&L.is3D()}):this.has3DLayers(),I=Bn.createFromScreenPoints(n,f);for(const D in this._mergedSourceCaches){const L=this._mergedSourceCaches[D].getSource();if(!L||L.scope!==o.scope)continue;const z=this._mergedSourceCaches[D].getSource().id;o.layers&&!_[z]||y.push(ah(this._mergedSourceCaches[D],this._mergedLayers,w,I,o,f,S,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(D,L,z,F,N,$,G){const H={},U=$.queryRenderedSymbols(F),Y=[];for(const te of Object.keys(U).map(Number))Y.push(G[te]);Y.sort(Ia);for(const te of Y){const J=te.featureIndex.lookupSymbolFeatures(U[te.bucketInstanceId],L,te.bucketIndex,te.sourceLayerIndex,N.filter,N.layers,N.availableImages,D);for(const ie in J){const W=H[ie]=H[ie]||[],ne=J[ie];ne.sort((le,ce)=>{const pe=te.featureSortOrder;if(pe){const Se=pe.indexOf(le.featureIndex);return pe.indexOf(ce.featureIndex)-Se}return ce.featureIndex-le.featureIndex});for(const le of ne)W.push(le)}}for(const te in H)H[te].forEach(J=>{const ie=J.feature,W=z(D[te]);if(!W)return;const ne=W.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ne});return H}(this._mergedLayers,w,this.getLayerSourceCache.bind(this),I.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(n,o){o&&o.filter&&this._validate(Pe,"querySourceFeatures.filter",o.filter,null,o);const f=this.getOwnSourceCaches(n);let _=[];for(const y of f)_=_.concat(Hs(y,o));return _}addSourceType(n,o,f){return Ts.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(Ts.setSourceType(n,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:o.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,o,f={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const S in n)if(!B(n[S],_[S])){y=!0;break}if(!y)return;const w=this._getTransitionParameters();this.light.setLight(n,o,f),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,o=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()&&o!==0||delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let f=n;const _=n.source==null;if(o===1){if(typeof f.source=="object"){const S="terrain-dem-src";this.addSource(S,f.source),f=s.c1(f),f=s.e(f,{source:S})}const y=s.e({},f),w={};if(this.terrain&&_){y.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(w.style=S.serialize())}if(this._validate(X,"terrain",y,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&o!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,o),this.fire(new s.b("data",{dataType:"style"}))}else{const y=this.terrain,w=y.get();for(const S of Object.keys(s.D.terrain))!f.hasOwnProperty(S)&&s.D.terrain[S].default&&(f[S]=s.D.terrain[S].default);for(const S in n)if(!B(n[S],w[S])){y.set(n,this.options),this.stylesheet.terrain=n;const I=this._getTransitionParameters({duration:0});y.updateTransitions(I),this.fire(new s.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const o=this.fog=new Dr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!B(o.get(),n)){o.set(n,this.options),this.stylesheet.fog=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}}else this._createFog(n);this._markersNeedUpdate=!0}_getTransitionParameters(n){return{now:s.f.now(),transition:s.e(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],o=[];for(const f in this._mergedLayers)this.isLayerDraped(this._mergedLayers[f])?n.push(f):o.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...o)}_createTerrain(n,o){const f=this.terrain=new Yi(n,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const o=this._layers[n];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const o=this._layers[n];o.type==="symbol"&&this._updateLayer(o)}}_validate(n,o,f,_,y={}){if(y&&y.validate===!1)return!1;const w=s.e({},this.serialize());return To(this,n.call(jt,s.e({key:o,style:w,value:f,styleSpec:s.D},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const o=this.getSourceCaches(n);for(const f of o)f.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const o=this.getSourceCaches(n);for(const f of o)f.resume(),f.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let o;this.directionalLight&&(o=Qc(this.directionalLight));for(const f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(n,void 0,void 0,o)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const o=this._sourceCaches[n];o.resume(),o.reload()}}_updatePlacement(n,o,f,_,y=!1){let w=!1,S=!1;const I={},D={};for(const L of this._mergedOrder){const z=this._mergedLayers[L];if(z.type!=="symbol")continue;const F=s.ag(z.source,z.scope);let N=I[F];if(!N){const G=this.getLayerSourceCache(z);if(!G)continue;const H=G.getRenderableIds(!0).map(U=>G.getTileByID(U));D[F]=H.slice(),N=I[F]=H.sort((U,Y)=>Y.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(Y.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(z,N,n.center.lng,n.projection);w=w||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),y=y||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new s.b("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.f.now(),n.zoom))&&(this.pauseablePlacement=new Yc(n,this._mergedOrder,y,o,f,_,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.f.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w){this._buildingIndex.onNewFrame(n.zoom);for(const L of this._mergedOrder){const z=this._mergedLayers[L];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[s.ag(z.source,z.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.f.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,o){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:y})=>y===n.id)!==-1)return this.fire(new s.a(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!o)return f.push(n),this._loadImports([n],!0),this;const _=f.findIndex(({id:y})=>y===o);return _===-1?this.fire(new s.a(new Error(`Import with id "${o}" does not exist on this map.`))):(this.stylesheet.imports=f.slice(0,_).concat(n).concat(f.slice(_)),this._loadImports([n],!0,o),this)}updateImport(n,o){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(n);return _===-1?this:typeof o=="string"?(this.setImportUrl(n,o),this):(o.url&&o.url!==f[_].url&&this.setImportUrl(n,o.url),B(o.config,f[_].config)||this.setImportConfig(n,o.config),B(o.data,f[_].data)||this.setImportData(n,o.data),this)}moveImport(n,o){this._checkLoaded();let f=this.stylesheet.imports||[];const _=this.getImportIndex(n);if(_===-1)return this;const y=this.getImportIndex(o);if(y===-1)return this;const w=f[_],S=this.fragments[_];return f=f.filter(({id:I})=>I!==n),this.fragments=this.fragments.filter(({id:I})=>I!==n),this.stylesheet.imports=f.slice(0,y).concat(w).concat(f.slice(y)),this.fragments=this.fragments.slice(0,y).concat(S).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(n,o){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(n);if(_===-1)return this;f[_].url=o;const y=this.fragments[_];return y.style=this._createFragmentStyle(f[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(o),this}setImportData(n,o){this._checkLoaded();const f=this.getImportIndex(n),_=this.stylesheet.imports||[];return f===-1?this:o?(this.fragments[f].style.setState(o),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(n,_[f].url))}setImportConfig(n,o){this._checkLoaded();const f=this.getImportIndex(n),_=this.stylesheet.imports||[];if(f===-1)return this;o?_[f].config=o:delete _[f].config;const y=this.fragments[f],w=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=o,y.style.setConfig(o,w),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const o=this.stylesheet.imports||[],f=this.getImportIndex(n);return f===-1||(o.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports()),this}getImportIndex(n){const o=(this.stylesheet.imports||[]).findIndex(f=>f.id===n);return o===-1&&this.fire(new s.a(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),o}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const o in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[o];f&&n.push(f.getSource())}return n}getSource(n,o){const f=this.getSourceCache(n,o);return f&&f.getSource()}getLayerSource(n){const o=this.getLayerSourceCache(n);return o&&o.getSource()}getSourceCache(n,o){const f=s.ag(n,o);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(n){const o=s.ag(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(n){const o=[];return this._mergedOtherSourceCaches[n]&&o.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&o.push(this._mergedSymbolSourceCaches[n]),o}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const o in n){const f=n[o];f==="reload"?this.reloadSource(o):f==="clear"&&this.clearSource(o)}}updateLayers(n){const o=this._changes.getUpdatedPaintProperties();for(const f of o){const _=this.getLayer(f);_&&_.updateTransitions(n)}}getImages(n,o,f){this.imageManager.getImages(o.icons,o.scope,f),this._updateTilesForChangedImages();const _=y=>{y&&y.setDependencies(o.tileID.key,o.type,o.icons)};_(this._otherSourceCaches[o.source]),_(this._symbolSourceCaches[o.source])}getGlyphs(n,o,f){this.glyphManager.getGlyphs(o.stacks,o.scope,f)}getResource(n,o,f){return s.c9(o,f)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const o=[];return this._otherSourceCaches[n]&&o.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&o.push(this._symbolSourceCaches[n]),o}_isSourceCacheLoaded(n){const o=this.getOwnSourceCaches(n);return o.length===0?(this.fire(new s.a(new Error(`There is no source with ID '${n}'`))),!1):o.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ts.getSourceType=function(h){return qs[h]},Ts.setSourceType=function(h,n){qs[h]=n},Ts.registerForPluginStateChange=s.bV;var eu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,tu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,iu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,nu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ph=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Dh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,np=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Oa=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Fa=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,Lh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Fl=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ba=[];Mo(eu,Ba),Mo(iu,Ba),Mo(tu,Ba);const Zr={"_prelude_fog.vertex.glsl":Dh,"_prelude_terrain.vertex.glsl":Ph,"_prelude_shadow.vertex.glsl":Lh,"_prelude_fog.fragment.glsl":np,"_prelude_shadow.fragment.glsl":Fl,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Oa,"_prelude_raster_particle.glsl":Fa},Na={};Pi("",Ph),Pi(np,Dh),Pi(Fl,Lh),Pi(Oa,""),Pi(Fa,"");const Rh=Pi(tu,iu),ru=eu;var zh={background:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Pi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Pi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Pi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Pi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Pi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Pi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Pi("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:Pi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Pi("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:Pi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Pi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Pi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Pi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Pi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,nu),skyboxGradient:Pi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,nu),skyboxCapture:Pi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Pi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Pi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Pi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Mo(h,n){const o=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of o)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const y of _)n.includes(y)||n.push(y)}}function Pi(h,n){const o=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(D=>{const L=D.split(" ");return L[L.length-1]}),_=[...new Set(_)]);const y={},w=[],S=[];if(h=h.replace(o,(D,L)=>(S.push(L),"")),(n=n.replace(o,(D,L)=>(w.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Ba];Mo(h,I),Mo(n,I);for(const D of[...w,...S])Zr[D]||console.error(`Undefined include: ${D}`),Na[D]||(Na[D]=[],Mo(Zr[D],Na[D])),I=[...I,...Na[D]];return{fragmentSource:h=h.replace(f,(D,L,z,F,N)=>(y[N]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${z} ${F} ${N};
#else
uniform ${z} ${F} u_${N};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${z} ${F} ${N} = u_${N};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${z} ${F} ${N};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(f,(D,L,z,F,N)=>{const $=F==="float"?"vec2":F,G=N.match(/color/)?"color":$;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${z} ${F} a_${N};
#endif
`:y[N]?L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${z} ${$} a_${N};
out ${z} ${F} ${N};
#else
uniform ${z} ${F} u_${N};
#endif
`:L==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${z} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${G}(a_${N}, u_${N}_t);
#else
    ${z} ${F} ${N} = u_${N};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${z} ${F} a_${N};
    out ${z} ${F} ${N};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${z} ${$} a_${N};
#else
uniform ${z} ${F} u_${N};
#endif
`:L==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${z} ${F} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${$} a_${N};
#else
uniform ${z} ${F} u_${N};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${z} ${F} ${N} = a_${N};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${z} ${F} ${N} = a_${N};
#else
    ${z} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${z} ${F} ${N} = unpack_mix_${G}(a_${N}, u_${N}_t);
#else
    ${z} ${F} ${N} = u_${N};
#endif
`}),staticAttributes:_,usedDefines:I,vertexIncludes:w,fragmentIncludes:S}}class kh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,o,f,_,y,w,S,I){this.context=n;let D=this.boundPaintVertexBuffers.length!==_.length;for(let z=0;!D&&z<_.length;z++)this.boundPaintVertexBuffers[z]!==_[z]&&(D=!0);let L=this.boundDynamicVertexBuffers.length!==S.length;for(let z=0;!L&&z<S.length;z++)this.boundDynamicVertexBuffers[z]!==S[z]&&(L=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==f||D||L||this.boundIndexBuffer!==y||this.boundVertexOffset!==w)this.freshBind(o,f,_,y,w,S,I);else{n.bindVertexArrayOES.set(this.vao);for(const z of S)z&&(z.bind(),I&&z.instanceCount&&z.setVertexAttribDivisor(n.gl,o,I));y&&y.dynamicDraw&&y.bind()}}freshBind(n,o,f,_,y,w,S){const I=n.numAttributes,D=this.context,L=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=w,o.enableAttributes(L,n),o.bind(),o.setVertexAttribPointers(L,n,y);for(const z of f)z.enableAttributes(L,n),z.bind(),z.setVertexAttribPointers(L,n,y);for(const z of w)z&&(z.enableAttributes(L,n),z.bind(),z.setVertexAttribPointers(L,n,y),S&&z.instanceCount&&z.setVertexAttribDivisor(L,n,S));_&&_.bind(),D.currentNumAttributes=I}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ig(h,n){const o=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new s.L(0,f/o).toLngLat().lat,new s.L(0,(f+1)/o).toLngLat().lat]}function su(h,n,o,f,_,y,w){const S=h.context,I=S.gl,D=o.hillshadeFBO;if(!D)return;h.prepareDrawTile();const L=h.isTileAffectedByFog(n),z=h.getOrCreateProgram("hillshade",{overrideFog:L});S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,D.colorAttachment.get());const F=((H,U,Y,te)=>{const J=Y.paint.get("hillshade-shadow-color"),ie=Y.paint.get("hillshade-highlight-color"),W=Y.paint.get("hillshade-accent-color"),ne=Y.paint.get("hillshade-emissive-strength");let le=s.bj(Y.paint.get("hillshade-illumination-direction"));if(Y.paint.get("hillshade-illumination-anchor")==="viewport")le-=H.transform.angle;else if(H.style&&H.style.enable3dLights()&&H.style.directionalLight){const pe=H.style.directionalLight.properties.get("direction"),Se=s.bQ(pe.x,pe.y,pe.z);le=s.bj(Se[1])}const ce=!H.options.moving;return{u_matrix:te||H.transform.calculateProjMatrix(U.tileID.toUnwrapped(),ce),u_image:0,u_latrange:ig(0,U.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),le],u_shadow:J,u_highlight:ie,u_emissive_strength:ne,u_accent:W}})(h,o,f,h.terrain?n.projMatrix:null);h.uploadCommonUniforms(S,z,n.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:$,tileBoundsSegments:G}=h.getTileBoundsBuffers(o);z.draw(h,I.TRIANGLES,_,y,w,Ht.disabled,F,f.id,N,$,G)}function rp(h,n,o){if(!n.needsDEMTextureUpload)return;const f=h.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||h.getTileTexture(o.stride);const y=o.getPixels();n.demTexture?n.demTexture.update(y,{premultiply:!1}):n.demTexture=new s.T(f,y,_.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Oh(h,n,o){const f=h.context,_=f.gl;if(!n.dem)return;const y=n.dem;if(f.activeTexture.set(_.TEXTURE1),rp(h,n,y),!n.demTexture)return;n.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const w=y.dim;f.activeTexture.set(_.TEXTURE0);let S=n.hillshadeFBO;if(!S){const F=new s.T(f,{width:w,height:w,data:null},_.RGBA);F.bind(_.LINEAR,_.CLAMP_TO_EDGE),S=n.hillshadeFBO=f.createFramebuffer(w,w,!0,"renderbuffer"),S.colorAttachment.set(F.texture)}f.bindFramebuffer.set(S.framebuffer),f.viewport.set([0,0,w,w]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:D,tileBoundsSegments:L}=h.getMercatorTileBoundsBuffers(),z=[];h.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(h,_.TRIANGLES,qt.disabled,ei.disabled,mi.unblended,Ht.disabled,((F,N)=>{const $=N.stride,G=s.a6.create();return s.a6.ortho(G,0,s.V,-s.V,0,0,1),s.a6.translate(G,G,[0,-s.V,0]),{u_matrix:G,u_image:1,u_dimension:[$,$],u_zoom:F.overscaledZ}})(n.tileID,y),o.id,I,D,L),n.needsHillshadePrepare=!1}const sp=h=>({u_matrix:new s.bK(h),u_image0:new s.bO(h),u_skirt_height:new s.bN(h),u_ground_shadow_factor:new s.bM(h)}),ou=(h,n,o)=>({u_matrix:h,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:o}),op=(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:o,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:w,u_frustum_tr:S,u_frustum_br:I,u_frustum_bl:D,u_globe_pos:L,u_globe_radius:z,u_viewport:F,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:$});function Bl(h,n){return h!=null&&n!=null&&!(!h.hasData()||!n.hasData())&&h.demTexture!=null&&n.demTexture!=null&&h.tileID.key!==n.tileID.key}const Va=new class{constructor(){this.operations={}}newMorphing(h,n,o,f,_){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==o.tileID.key&&(y.queued=o)}else this.operations[h]={startTime:f,phase:0,duration:_,from:n,to:o,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const n=this.operations[h];return{from:n.from,to:n.to,phase:n.phase}}update(h){for(const n in this.operations){const o=this.operations[n];for(o.phase=(h-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,h)){delete this.operations[n];break}}}_nextOp(h,n){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=n,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Fh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Bh(h,n,o){if(n===0)return 0;const f=n<1&&o===514?.25/n:1;return 6*Math.pow(1.5,22-h)*Math.max(n,1)*f}function Ua(h,n){const o=1<<h.z;return!n&&(h.x===0||h.x===o-1)||h.y===0||h.y===o-1}const Nh=h=>({u_matrix:h});function Vh(h,n,o,f,_){if(_>0){const y=s.f.now(),w=(y-h.timeAdded)/_,S=n?(y-n.timeAdded)/_:-1,I=o.getSource(),D=f.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!n||Math.abs(n.tileID.overscaledZ-D)>Math.abs(h.tileID.overscaledZ-D),z=L&&h.refreshedUponExpiration?1:s.aa(L?w:1-S,0,1);return h.refreshedUponExpiration&&w>=1&&(h.refreshedUponExpiration=!1),n?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class ng extends bs{constructor(n){const o={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new s.bW(s.bX(),null),_=$n("mock-dem",o,f,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,o){n.state="loaded",o(null)}}class rg extends bs{constructor(n){const o=$n("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new s.bW(s.bX(),null),n.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,o,f){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,w)=>{if(y[w.key]="",!this._tiles[w.key]){const S=new _o(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom);S.state="loaded",this._tiles[w.key]=S}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(n){const o=this.proxyCachedFBO[n];if(o!==void 0){const f=Object.values(o);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ap extends s.am{constructor(n,o,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=o,this.projMatrix=f}}class sg extends s.ck{constructor(n,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,y]=function(I){const D=new s.aN,L=new s.aw,z=131;D.reserve(17161),L.reserve(33800);const F=s.V/128,N=s.V+F/2,$=N+F;for(let H=-F;H<$;H+=F)for(let U=-F;U<$;U+=F){const Y=U<0||U>N||H<0||H>N?24575:0,te=s.aa(Math.round(U),0,s.V),J=s.aa(Math.round(H),0,s.V);D.emplaceBack(te+Y,J)}const G=(H,U)=>{const Y=U*z+H;L.emplaceBack(Y+1,Y,Y+z),L.emplaceBack(Y+z,Y+z+1,Y+1)};for(let H=1;H<129;H++)for(let U=1;U<129;U++)G(U,H);return[0,129].forEach(H=>{for(let U=0;U<130;U++)G(U,H),G(H,U)}),[D,L,32768]}(),w=n.context;this.gridBuffer=w.createVertexBuffer(f,s.aP.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=s.aB.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=s.aB.simpleSegment(0,0,f.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new rg(o.map),this.orthoMatrix=s.a6.create(),s.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.V,0,s.V,0,1);const S=w.gl;this._overlapStencilMode=new ei({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ng(o.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,o,f){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const _=n.terrain.properties,y=n.terrain.drapeRenderMode===0,w=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.f.now();const S=n.terrain&&n.terrain.scope,I=_.get("source"),D=y?this._mockSourceCache:n.getSourceCache(I,S);if(!D)return void s.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=D,this._exaggeration=w?this.calculateExaggeration(o):_.get("exaggeration"),!o.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(o,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),o.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(n){const o=this._previousCameraAltitude,f=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=f;const _=o!=null?f-o:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const y=n.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(y);let S=y-this._previousZoom;const I=this._previousUpdateTimestamp;let D=y;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(y-D)>.5&&(S=.5*(y-D+S)),S*_<0&&(D+=S)),this._evaluationZoom=D;const L=w.getExaggeration(D),z=L===w.getExaggeration(Math.max(0,D-.1));if(z&&Math.abs(L-this._exaggeration)<.01)return L;let F=Math.min(.1,.00375*(this._updateTimestamp-I));return(z||L<.1||Math.abs(S)<1e-4)&&(F=Math.min(.2,4*F)),s.U(this._exaggeration,L,F)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(s.L.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=o.getIds().map(I=>{const D=o.getTileByID(I).tileID;return D.projMatrix=f.calculateProjMatrix(D.toUnwrapped()),D});(function(I,D){const L=D.transform.pointCoordinate(D.transform.getCameraPoint()),z=new s.P(L.x,L.y);I.sort((F,N)=>{if(N.overscaledZ-F.overscaledZ)return N.overscaledZ-F.overscaledZ;const $=new s.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),G=new s.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),H=z.mult(1<<F.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr($)-H.distSqr(G)})})(_,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const I in w){const D=w[I];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,n[I],y),D.usedForTerrain))continue;const L=n[I];D.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[o.id]=_.map(I=>new ap(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const D=this.terrainTileForTile[I.key];if(!D)continue;const L=D.tileID.key;L in S||(this._visibleDemTiles.push(D),S[L]=L)}}_assignTerrainTiles(n){this._initializing||n.forEach(o=>{if(this.terrainTileForTile[o.key])return;const f=this._findTileCoveringTileID(o,this.sourceCache);f&&(this.terrainTileForTile[o.key]=f)})}_prepareDEMTextures(){const n=this.painter.context,o=n.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(o.TEXTURE1),rp(this.painter,_,y))}}_prepareDemTileUniforms(n,o,f,_){if(!o||o.demTexture==null)return!1;const y=n.tileID.canonical,w=Math.pow(2,o.tileID.canonical.z-y.z),S=_||"";return f[`u_dem_tl${S}`]=[y.x*w%1,y.y*w%1],f[`u_dem_scale${S}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,o=n.gl;if(!this._emptyDepthBufferTexture){const f=new s.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.T(n,f,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const o=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const y=_.dem.tree.minimums[0];return y>0&&n++,f+y},0);return n?o/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,o=n.gl;n.activeTexture.set(o.TEXTURE2);const f=this._getLoadedAreaMinimum(),[_,y]=(()=>{const S=new s.cm({width:1,height:1},new Float32Array([f]));return[o.R32F,S]})();this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(y,{premultiply:!1}):w=this._emptyDEMTexture=new s.T(n,y,_,{premultiply:!1}),w}setupElevationDraw(n,o,f){const _=this.painter.context,y=_.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};w.u_exaggeration=this.exaggeration();let S=null,I=null,D=1;if(f&&f.morphing&&this._useVertexMorphing){const F=f.morphing.srcDemTile,N=f.morphing.dstDemTile;D=f.morphing.phase,F&&N&&(this._prepareDemTileUniforms(n,F,w,"_prev")&&(I=F),this._prepareDemTileUniforms(n,N,w)&&(S=N))}const L=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,z=F=>{w.u_dem_size=F.size[0]===1?1:F.size[0]-2};if(I&&S)_.activeTexture.set(y.TEXTURE2),S.demTexture.bind(L(S),y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE4),I.demTexture.bind(L(I),y.CLAMP_TO_EDGE),S.demTexture&&z(S.demTexture),w.u_dem_lerp=D;else{S=this.terrainTileForTile[n.tileID.key],_.activeTexture.set(y.TEXTURE2);const F=this._prepareDemTileUniforms(n,S,w)?S.demTexture:this.emptyDEMTexture;F.bind(L(S),y.CLAMP_TO_EDGE),z(F)}if(_.activeTexture.set(y.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&S){const F=(1<<S.tileID.canonical.z)*s.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=F}if(f&&f.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),o.setTerrainUniformValues(_,w),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);o.setGlobeUniformValues(_,F)}}globeUniformValues(n,o,f){const _=n.projection;return{u_tile_tl_up:_.upVector(o,0,0),u_tile_tr_up:_.upVector(o,s.V,0),u_tile_br_up:_.upVector(o,s.V,s.V),u_tile_bl_up:_.upVector(o,0,s.V),u_tile_up_scale:f?s.cl(1):_.upVectorScale(o,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const o=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,y,w,S,I){if(_.transform.projection.name==="globe")(function(D,L,z,F,N){const $=D.context,G=$.gl;let H,U;const Y=D.transform,te=s.cd(D,$,Y),J=(ze,De)=>{if(U===De)return;const He=[Fh[De],"PROJECTION_GLOBE_VIEW"];te&&He.push("CUSTOM_ANTIALIASING");const ye=D.isTileAffectedByFog(ze);H=D.getOrCreateProgram("globeRaster",{defines:He,overrideFog:ye}),U=De},ie=D.colorModeForRenderPass(),W=new qt(G.LEQUAL,qt.ReadWrite,D.depthRangeFor3D);Va.update(N);const ne=s.ce(Y),le=[s.a5(Y.center.lng),s.ae(Y.center.lat)],ce=D.globeSharedBuffers,pe=[Y.width*s.f.devicePixelRatio,Y.height*s.f.devicePixelRatio],Se=Float32Array.from(Y.globeMatrix),_e={useDenormalizedUpVectorScale:!0};{const ze=D.transform,De=Bh(ze.zoom,L.exaggeration(),L.sourceCache._source.tileSize);U=-1;const He=G.TRIANGLES;for(const ye of F){const Ie=z.getTile(ye),fe=ei.disabled,we=L.prevTerrainTileForTile[ye.key],Ze=L.terrainTileForTile[ye.key];Bl(we,Ze)&&Va.newMorphing(ye.key,we,Ze,N,250),$.activeTexture.set(G.TEXTURE0),Ie.texture&&Ie.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const it=Va.getMorphValuesForProxy(ye.key),tt=it?1:0;it&&s.j(_e,{morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:s.cc(it.phase)}});const dt=s.cf(ye.canonical),Pt=s.cg(dt.getCenter().lat),Ut=s.ch(ye.canonical,dt,Pt,ze.worldSize/ze._pixelsPerMercatorPixel),zt=s.aT(s.ci(ye.canonical)),Bt=op(ze.expandedFarZProjMatrix,Se,ne,zt,s.S(ze.zoom),le,ze.frustumCorners.TL,ze.frustumCorners.TR,ze.frustumCorners.BR,ze.frustumCorners.BL,ze.globeCenterInViewSpace,ze.globeRadius,pe,De,ze._farZ,Ut);if(J(ye,tt),H&&(L.setupElevationDraw(Ie,H,_e),D.uploadCommonUniforms($,H,ye.toUnwrapped()),ce)){const[li,Jt,ri]=ce.getGridBuffers(Pt,De!==0);H.draw(D,He,W,fe,ie,Ht.backCCW,Bt,"globe_raster",li,Jt,ri)}}}if(ce&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const ze=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&ze.push("CUSTOM_ANTIALIASING"),H=D.getOrCreateProgram("globeRaster",{defines:ze});for(const De of F){const{x:He,y:ye,z:Ie}=De.canonical,fe=ye===0,we=ye===(1<<Ie)-1,[Ze,it,tt,dt]=ce.getPoleBuffers(Ie,!1);if(dt&&(fe||we)){const Pt=z.getTile(De);$.activeTexture.set(G.TEXTURE0),Pt.texture&&Pt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let Ut=s.cj(Ie,He,Y);const zt=s.aT(s.ci(De.canonical)),Bt=(li,Jt)=>li.draw(D,G.TRIANGLES,W,ei.disabled,ie,Ht.disabled,op(Y.expandedFarZProjMatrix,Ut,Ut,zt,0,le,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,pe,0,Y._farZ),"globe_pole_raster",Jt,tt,dt);L.setupElevationDraw(Pt,H,_e),D.uploadCommonUniforms($,H,De.toUnwrapped()),fe&&D.renderDefaultNorthPole&&Bt(H,Ze),we&&D.renderDefaultSouthPole&&(Ut=s.a6.scale(s.a6.create(),Ut,[1,-1,1]),Bt(H,it))}}}})(_,y,w,S,I);else{const D=_.context,L=D.gl;let z,F;const N=_.shadowRenderer,$=wo(_,_.longestCutoffRange),G=ie=>{if(F===ie)return;const W=[];W.push(Fh[ie]),$.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),z=_.getOrCreateProgram("terrainRaster",{defines:W}),F=ie},H=_.colorModeForRenderPass(),U=new qt(L.LEQUAL,qt.ReadWrite,_.depthRangeFor3D);Va.update(I);const Y=_.transform,te=Bh(Y.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let J=[0,0,0];if(N){const ie=_.style.directionalLight,W=_.style.ambientLight;ie&&W&&(J=Ol(ie,W))}{F=-1;const ie=L.TRIANGLES,[W,ne]=[y.gridIndexBuffer,y.gridSegments];for(const le of S){const ce=w.getTile(le),pe=ei.disabled,Se=y.prevTerrainTileForTile[le.key],_e=y.terrainTileForTile[le.key];Bl(Se,_e)&&Va.newMorphing(le.key,Se,_e,I,250),D.activeTexture.set(L.TEXTURE0),ce.texture&&ce.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const ze=Va.getMorphValuesForProxy(le.key),De=ze?1:0;let He;ze&&(He={morphing:{srcDemTile:ze.from,dstDemTile:ze.to,phase:s.cc(ze.phase)}});const ye=ou(le.projMatrix,Ua(le.canonical,Y.renderWorldCopies)?te/10:te,J);if(G(De),!z)continue;y.setupElevationDraw(ce,z,He);const Ie=le.toUnwrapped();N&&N.setupShadows(Ie,z),_.uploadCommonUniforms(D,z,Ie,null,$),z.draw(_,ie,U,pe,H,Ht.backCCW,ye,"terrain_raster",y.gridBuffer,W,ne)}}}}(o,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const o=this.painter,f=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),S=o.style.order,I=[];let D=0;for(const L of y){const z=_.getTileByID(L.proxyTileKey),F=_.proxyCachedFBO[L.key]?_.proxyCachedFBO[L.key][n]:void 0,N=F!==void 0?_.renderCache[F]:this.pool[D++],$=F!==void 0;if(z.texture=N.tex,$&&!N.dirty){I.push(z.tileID);continue}let G;f.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(f.clear({color:s.ax.transparent,stencil:0}),N.dirty=!1);for(let H=w.start;H<=w.end;++H){const U=o.style._mergedLayers[S[H]];if(U.isHidden(o.transform.zoom))continue;const Y=o.style.getLayerSourceCache(U),te=Y?this.proxyToSource[L.key][Y.id]:[L];if(!te)continue;const J=te;f.viewport.set([0,0,N.fb.width,N.fb.height]),G!==(Y?Y.id:null)&&(this._setupStencil(N,te,U,Y),G=Y?Y.id:null),o.renderLayer(o,Y,U,J)}if(this._drapedRenderBatches.length===0)for(const H of this._pendingGroundEffectLayers){const U=o.style._mergedLayers[S[H]];if(U.isHidden(o.transform.zoom))continue;const Y=o.style.getLayerSourceCache(U),te=Y?this.proxyToSource[L.key][Y.id]:[L];if(!te)continue;const J=te;f.viewport.set([0,0,N.fb.width,N.fb.height]),G!==(Y?Y.id:null)&&(this._setupStencil(N,te,U,Y),G=Y?Y.id:null),o.renderLayer(o,Y,U,J)}this.renderedToTile?(N.dirty=!0,I.push(z.tileID)):$||--D,D===5&&(D=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),w.end+1}postRender(){}isLayerOrderingCorrect(n){const o=n.order.length;let f=-1,_=o;for(let y=0;y<o;++y)this._style.isLayerDraped(n._mergedLayers[n.order[y]])?f=Math.max(f,y):_=Math.min(_,y);return _>f}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{n=Math.min(n,o.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,o,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const w=y.tileID,S=1<<w.overscaledZ,{x:I,y:D}=w.canonical,L=I/S,z=(I+1)/S,F=D/S,N=(D+1)/S;return{minx:L,miny:F,maxx:z,maxy:N,t:y.dem.tree.raycastRoot(L,F,z,N,n,o,f),tile:y}});_.sort((y,w)=>(y.t!==null?y.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const w=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,n,o,f);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,o=n.gl,f=this.drapeBufferSize;n.activeTexture.set(o.TEXTURE0);const _=new s.T(n,{width:f[0],height:f[1],data:null},o.RGBA);_.bind(o.LINEAR,o.CLAMP_TO_EDGE);const y=n.createFramebuffer(f[0],f[1],!0,null);return y.colorAttachment.set(_.texture),y.depthAttachment=new Fr(n,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const o=this._style._mergedLayers[n],f=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!f&&o.shouldRedrape():!f&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style.getSources())if(f instanceof mt){n=!0;break}if(!n)return;const o={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(y&&!o[y.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof s.Z){o[y.id]=!0;for(const w of this.proxyCoords){const S=this.proxyToSource[w.key][y.id];if(S)for(const I of S)this._clearRenderCacheForTile(y.id,I)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof _t){n=!0;break}if(!n)return;const o={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(_);if(!y||o[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const w=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const I=this.proxyToSource[S.key][y.id];if(I)for(const D of I){const L=Vh(y.getTile(D),y.findLoadedParent(D,0),y,this.painter.transform,w);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(y.id,D)}}}}_setupDrapedRenderBatches(){const n=this._style.order,o=n.length;if(o===0)return;const f=[];this._pendingGroundEffectLayers=[];let _,y=0,w=this._style._mergedLayers[n[y]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++y<o;)w=this._style._mergedLayers[n[y]];for(;y<o;++y){const S=this._style._mergedLayers[n[y]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?_===void 0&&(_=y):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(f.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:y-1}),f.length!==0){const S=f[f.length-1];this._pendingGroundEffectLayers.every(I=>I>S.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(n){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const w=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<w.length;++S){const I=Object.values(w[S]);o.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let w=f.length-1;w>=0;w--){const S=f[w];if(o.getTileByID(S.key),o.proxyCachedFBO[S.key]!==void 0){const I=n[S.key],D=this.proxyToSource[S.key];let L=0;for(const z in D){const F=D[z],N=I[z];if(!N||N.length!==F.length||F.some(($,G)=>$!==N[G]||_[z]&&_[z].hasOwnProperty($.key))){L=-1;break}++L}for(const z in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][z]].dirty=L<0||L!==Object.values(I).length}}const y=[...this._drapedRenderBatches];y.sort((w,S)=>S.end-S.start-(w.end-w.start));for(const w of y)for(const S of f){if(o.proxyCachedFBO[S.key])continue;let I=o.renderCachePool.pop();I===void 0&&o.renderCache.length<50&&(I=o.renderCache.length,o.renderCache.push(this._createFBO())),I!==void 0&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][w.start]=I,o.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,o,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,w=y.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(f.isTileClipped())S=o.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):ei.disabled}_renderTileClippingMasks(n,o){const f=this.painter,_=this.painter.context,y=_.gl;f._tileClippingMaskIDs={},_.setColorMode(mi.disabled),_.setDepthMode(qt.disabled);const w=f.getOrCreateProgram("clippingMask");for(const S of n){const I=f._tileClippingMaskIDs[S.key]=--o;w.draw(f,y.TRIANGLES,qt.disabled,new ei({func:y.ALWAYS,mask:0},I,255,y.KEEP,y.KEEP,y.REPLACE),mi.disabled,Ht.disabled,Nh(S.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const o=this.painter.transform;if(n.x<0||n.x>o.width||n.y<0||n.y>o.height)return null;const f=[n.x,n.y,1,1];s.a7.transformMat4(f,f,o.pixelMatrixInverse),s.a7.scale(f,f,1/f[3]),f[0]/=o.worldSize,f[1]/=o.worldSize;const _=o._camera.position,y=s.bl(1,o.center.lat),w=[_[0],_[1],_[2]/y,0],S=s.N.subtract([],f.slice(0,3),w);s.N.normalize(S,S);const I=this.raycast(w,S,this._exaggeration);return I!==null&&I?(s.N.scaleAndAdd(w,w,S,I),w[3]=w[2],w[2]*=y,w):null}drawDepth(){const n=this.painter,o=n.context,f=this.proxySourceCache,_=Math.ceil(n.width),y=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const w=o.gl,S=o.createFramebuffer(_,y,!0,"renderbuffer");o.activeTexture.set(w.TEXTURE0);const I=new s.T(o,{width:_,height:y,data:null},w.RGBA);I.bind(w.NEAREST,w.CLAMP_TO_EDGE),S.colorAttachment.set(I.texture);const D=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,_,y);S.depthAttachment.set(D),this._depthFBO=S,this._depthTexture=I}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,_,y]),function(w,S,I,D){if(w.transform.projection.name==="globe")return;const L=w.context,z=L.gl;L.clear({depth:1});const F=w.getOrCreateProgram("terrainDepth"),N=new qt(z.LESS,qt.ReadWrite,w.depthRangeFor3D);for(const $ of D){const G=I.getTile($),H=ou($.projMatrix,0,[0,0,0]);S.setupElevationDraw(G,F),F.draw(w,z.TRIANGLES,N,ei.disabled,mi.unblended,Ht.backCCW,H,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(n,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,o,f){if(n.getSource()instanceof s.ap)return this._setupProxiedCoordsForImageSource(n,o,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],y=this.proxyCoords;for(let I=0;I<y.length;I++){const D=y[I],L=this._findTileCoveringTileID(D,n);if(L){const z=this._createProxiedId(D,L,f[D.key]&&f[D.key][n.id]);_.push(z),this.proxyToSource[D.key][n.id]=[z]}}let w=!1;const S=new Set;for(let I=0;I<o.length;I++){const D=n.getTile(o[I]);if(!D||!D.hasData())continue;const L=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==D.tileID.canonical.z){const z=this.proxyToSource[L.tileID.key][n.id],F=this._createProxiedId(L.tileID,D,f[L.tileID.key]&&f[L.tileID.key][n.id]);z?z.splice(z.length-1,0,F):this.proxyToSource[L.tileID.key][n.id]=[F];const N=this.proxyToSource[L.tileID.key][n.id];S.has(N)||S.add(N),_.push(F),w=!0}}if(this._sourceTilesOverlap[n.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const I of S)I.sort((D,L)=>L.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(n,o,f){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],y=this.proxyCoords,w=n.getSource(),S=w.tileID;if(!S)return;const I=new s.P(S.x,S.y)._div(1<<S.z),D=w.coordinates.map(s.L.fromLngLat).reduce((z,F)=>(z.min.x=Math.min(z.min.x,F.x-I.x),z.min.y=Math.min(z.min.y,F.y-I.y),z.max.x=Math.max(z.max.x,F.x-I.x),z.max.y=Math.max(z.max.y,F.y-I.y),z),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(z,F)=>{const N=z.wrap+z.canonical.x/(1<<z.canonical.z),$=z.canonical.y/(1<<z.canonical.z),G=s.V/(1<<z.canonical.z),H=F.wrap+F.canonical.x/(1<<F.canonical.z),U=F.canonical.y/(1<<F.canonical.z);return N+G<H+D.min.x||N>H+D.max.x||$+G<U+D.min.y||$>U+D.max.y};for(let z=0;z<y.length;z++){const F=y[z];for(let N=0;N<o.length;N++){const $=n.getTile(o[N]);if(!$||!$.hasData()||L(F,$.tileID))continue;const G=this._createProxiedId(F,$,f[F.key]&&f[F.key][n.id]),H=this.proxyToSource[F.key][n.id];H?H.push(G):this.proxyToSource[F.key][n.id]=[G],_.push(G)}}}_createProxiedId(n,o,f){let _=this.orthoMatrix;if(f){const y=f.find(w=>w.key===o.tileID.key);if(y)return y}if(o.tileID.key!==n.key){const y=n.canonical.z-o.tileID.canonical.z;let w,S,I;_=s.a6.create();const D=o.tileID.wrap-n.wrap<<n.overscaledZ;y>0?(w=s.V>>y,S=w*((o.tileID.canonical.x<<y)-n.canonical.x+D),I=w*((o.tileID.canonical.y<<y)-n.canonical.y)):(w=s.V<<-y,S=s.V*(o.tileID.canonical.x-(n.canonical.x+D<<-y)),I=s.V*(o.tileID.canonical.y-(n.canonical.y<<-y))),s.a6.ortho(_,0,w,0,w,0,1),s.a6.translate(_,_,[S,I,0])}return new ap(o.tileID,n.key,_)}_findTileCoveringTileID(n,o){let f=o.getTile(n);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[o.id],y=_[n.key];if(f=y?o.getTileByID(y):null,f&&f.hasData()||y===null)return f;let w=f?f.tileID:n,S=w.overscaledZ;const I=o.getSource().minzoom,D=[];if(!y){const z=o.getSource().maxzoom;if(n.canonical.z>=z){const F=n.canonical.z-z;o.getSource().reparseOverscaled?(S=Math.max(n.canonical.z+2,o.transform.tileZoom),w=new s.am(S,n.wrap,z,n.canonical.x>>F,n.canonical.y>>F)):F!==0&&(S=z,w=new s.am(S,n.wrap,z,n.canonical.x>>F,n.canonical.y>>F))}w.key!==n.key&&(D.push(w.key),f=o.getTile(w))}const L=z=>{D.forEach(F=>{_[F]=z}),D.length=0};for(S-=1;S>=I&&(!f||!f.hasData());S--){f&&L(f.tileID.key);const z=w.calculateScaledKey(S);if(f=o.getTileByID(z),f&&f.hasData())break;const F=_[z];if(F===null)break;F===void 0?D.push(z):f=o.getTileByID(F)}return L(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,o){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[o.key]=!0}}function Uh(h,n,o){const f=function(S,I,D){const L=s.N.dot(I,S),z=s.N.dot(D,[.2126,.7152,.0722]),F=($,G,H)=>(1-H)*$+H*G,N=F(1-.3*Math.min(z,1),1,Math.min(L+1,1));return F(.92,1,Math.asin(s.aa(I[2],-1,1))/Math.PI+.5)*N}(h,[0,0,1],n),_=[0,0,0];s.N.scale(_,o.slice(0,3),f);const y=[0,0,0];s.N.scale(y,n.slice(0,3),h[2]);const w=[0,0,0];return s.N.add(w,_,y),s.bU(w)}const jh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],lp=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Gh{static cacheKey(n,o,f,_){let y=`${o}${_?_.cacheKey:""}`;for(const w of f)n.usedDefines.includes(w)&&(y+=`/${w}`);return y}constructor(n,o,f,_,y,w,S){const I=n.gl;this.program=I.createProgram(),this.configuration=_,this.name=o,this.fixedDefines=[...w];const D=_?_.getBinderAttributes():[],L=(f.staticAttributes||[]).concat(D);let z=_?_.defines():[];z=z.concat(w.map(U=>`#define ${U}`));const F=`#version 300 es
`;let N=F+z.concat("precision mediump float;",ru,Rh.fragmentSource).join(`
`);for(const U of f.fragmentIncludes)N+=`
${Zr[U]}`;N+=`
${f.fragmentSource}`;let $=F+z.concat("precision highp float;",ru,Rh.vertexSource).join(`
`);for(const U of f.vertexIncludes)$+=`
${Zr[U]}`;$+=`
${f.vertexSource}`;const G=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(G,N),I.compileShader(G),I.attachShader(this.program,G);const H=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(H,$),I.compileShader(H),I.attachShader(this.program,H),this.attributes={},this.numAttributes=L.length;for(let U=0;U<this.numAttributes;U++)if(L[U]){const Y=L[U].startsWith("a_")?L[U]:`a_${L[U]}`;I.bindAttribLocation(this.program,U,Y),this.attributes[Y]=U}S&&S.shaderVaryings.length>0&&I.transformFeedbackVaryings(this.program,S.shaderVaryings,S.bufferMode),I.linkProgram(this.program),I.deleteShader(H),I.deleteShader(G),this.fixedUniforms=y(n),this.binderUniforms=_?_.getUniforms(n):[],w.includes("TERRAIN")&&(this.terrainUniforms=(U=>({u_dem:new s.bO(U),u_dem_prev:new s.bO(U),u_dem_tl:new s.bL(U),u_dem_scale:new s.bN(U),u_dem_tl_prev:new s.bL(U),u_dem_scale_prev:new s.bN(U),u_dem_size:new s.bN(U),u_dem_lerp:new s.bN(U),u_exaggeration:new s.bN(U),u_depth:new s.bO(U),u_depth_size_inv:new s.bL(U),u_meter_to_dem:new s.bN(U),u_label_plane_matrix_inv:new s.bK(U)}))(n)),w.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new s.bM(U),u_tile_tr_up:new s.bM(U),u_tile_br_up:new s.bM(U),u_tile_bl_up:new s.bM(U),u_tile_up_scale:new s.bN(U)}))(n)),w.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new s.bK(U),u_fog_range:new s.bL(U),u_fog_color:new s.bP(U),u_fog_horizon_blend:new s.bN(U),u_fog_vertical_limit:new s.bL(U),u_fog_temporal_offset:new s.bN(U),u_frustum_tl:new s.bM(U),u_frustum_tr:new s.bM(U),u_frustum_br:new s.bM(U),u_frustum_bl:new s.bM(U),u_globe_pos:new s.bM(U),u_globe_radius:new s.bN(U),u_globe_transition:new s.bN(U),u_is_globe:new s.bO(U),u_viewport:new s.bL(U)}))(n)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(U=>({u_cutoff_params:new s.bP(U)}))(n)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(U=>({u_lighting_ambient_color:new s.bM(U),u_lighting_directional_dir:new s.bM(U),u_lighting_directional_color:new s.bM(U),u_ground_radiance:new s.bM(U)}))(n)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(U=>({u_light_matrix_0:new s.bK(U),u_light_matrix_1:new s.bK(U),u_fade_range:new s.bL(U),u_shadow_normal_offset:new s.bM(U),u_shadow_intensity:new s.bN(U),u_shadow_texel_size:new s.bN(U),u_shadow_map_resolution:new s.bN(U),u_shadow_direction:new s.bM(U),u_shadow_bias:new s.bM(U),u_shadowmap_0:new s.bO(U),u_shadowmap_1:new s.bO(U)}))(n))}}setTerrainUniformValues(n,o){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_]&&f[_].set(this.program,_,o[_])}}setGlobeUniformValues(n,o){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_]&&f[_].set(this.program,_,o[_])}}setFogUniformValues(n,o){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setCutoffUniformValues(n,o){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setLightsUniformValues(n,o){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setShadowUniformValues(n,o){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}_drawDebugWireframe(n,o,f,_,y,w,S,I,D,L){const z=n.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;const F=n.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||n._terrain&&n._terrain.renderingToTexture||!jh.includes(this.name))||!(!z.layers3D||!lp.includes(this.name))))return;const N=F.gl,$=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,y,F);if(!$)return;const G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");const H=n.getOrCreateProgram(this.name,{config:this.configuration,defines:G});F.program.set(H.program);const U=(J,ie,W)=>{if(ie[J]&&W[J])for(const ne in ie[J])W[J][ne]&&W[J][ne].set(W.program,ne,ie[J][ne].current)};D&&D.setUniforms(H.program,F,H.binderUniforms,S,{zoom:I}),U("fixedUniforms",this,H),U("terrainUniforms",this,H),U("globeUniforms",this,H),U("fogUniforms",this,H),U("lightsUniforms",this,H),U("shadowUniforms",this,H),$.bind(),F.setColorMode(new mi([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],s.ax.transparent,[!0,!0,!0,!1])),F.setDepthMode(new qt(o.func===N.LESS?N.LEQUAL:o.func,qt.ReadOnly,o.range)),F.setStencilMode(ei.disabled);const Y=3*w.primitiveLength*2,te=3*w.primitiveOffset*2*2;L&&L>1?N.drawElementsInstanced(N.LINES,Y,N.UNSIGNED_SHORT,te,L):N.drawElements(N.LINES,Y,N.UNSIGNED_SHORT,te),y.bind(),F.program.set(this.program),F.setDepthMode(o),F.setStencilMode(f),F.setColorMode(_)}draw(n,o,f,_,y,w,S,I,D,L,z,F,N,$,G,H,U){const Y=n.context,te=Y.gl;if(this.failedToCreate)return;Y.program.set(this.program),Y.setDepthMode(f),Y.setStencilMode(_),Y.setColorMode(y),Y.setCullFace(w);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(this.program,ne,S[ne]);$&&$.setUniforms(this.program,Y,this.binderUniforms,F,{zoom:N});const J={[te.POINTS]:1,[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[o],ie=U&&U.length>0;if(ie){for(const ne of U)te.bindBufferBase(te.TRANSFORM_FEEDBACK_BUFFER,ne.targetIndex,ne.buffer.buffer);te.beginTransformFeedback(o)}const W=H&&H>0?1:void 0;for(const ne of z.get()){const le=ne.vaos||(ne.vaos={});(le[I]||(le[I]=new kh)).bind(Y,this,D,$?$.getPaintVertexBuffers():[],L,ne.vertexOffset,G||[],W),H&&H>1?te.drawElementsInstanced(o,ne.primitiveLength*J,te.UNSIGNED_SHORT,ne.primitiveOffset*J*2,H):L?te.drawElements(o,ne.primitiveLength*J,te.UNSIGNED_SHORT,ne.primitiveOffset*J*2):te.drawArrays(o,ne.vertexOffset,ne.vertexLength),o===te.TRIANGLES&&L&&this._drawDebugWireframe(n,f,_,y,L,ne,F,N,$,H)}ie&&te.endTransformFeedback()}}function $h(h,n){const o=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,h.transform.tileZoom)/o,_=f*(n.tileID.canonical.x+n.tileID.wrap*o),y=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.a3(n,1,h.transform.tileZoom),u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y]}}const cp=s.a6.create(),qh=(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G)=>{const H=n.style.light,U=H.properties.get("position"),Y=[U.x,U.y,U.z],te=s.co.create();H.properties.get("anchor")==="viewport"&&(s.co.fromRotation(te,-n.transform.angle),s.N.transformMat3(Y,Y,te));const J=H.properties.get("color"),ie=n.transform,W={u_matrix:h,u_lightpos:Y,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+o,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:cp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:y,u_flood_light_color:z,u_vertical_scale:F,u_flood_light_intensity:N,u_ground_shadow_factor:$,u_emissive_strength:G};return ie.projection.name==="globe"&&(W.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],W.u_zoom_transition=I,W.u_inv_rot_matrix=L,W.u_merc_center=D,W.u_up_dir=ie.projection.upVector(new s.bs(0,0,0),D[0]*s.V,D[1]*s.V),W.u_height_lift=S),W},Hh=(h,n,o)=>({u_matrix:h,u_edge_radius:n,u_vertical_scale:o}),ta=(h,n,o,f,_,y,w,S,I,D,L,z,F,N)=>{const $=qh(h,n,o,f,_,y,w,I,D,L,z,F,N,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,w.overscaledZ)/S.tileSize/8};return s.e($,$h(n,S),G)},ja=(h,n)=>({u_matrix:h,u_emissive_strength:n}),Wh=(h,n,o,f)=>s.e(ja(h,n),$h(o,f)),ia=(h,n,o)=>({u_matrix:h,u_world:o,u_emissive_strength:n}),up=(h,n,o,f,_)=>s.e(Wh(h,n,o,f),{u_world:_}),au=(h,n,o,f)=>{const _=s.V/o.tileSize;return{u_matrix:h,u_camera_to_center_distance:n.getCameraToCenterDistance(f),u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},Zh=(h,n,o=1)=>({u_matrix:h,u_color:n,u_overlay:0,u_overlay_scale:o}),hp=s.a6.create(),Xh=(h,n,o,f,_,y,w)=>{const S=h.transform,I=S.projection.name==="globe",D=I?s.cp(S.zoom,n.canonical)*S._pixelsPerMercatorPixel:s.a3(o,1,y),L={u_matrix:n.projMatrix,u_extrude_scale:D,u_intensity:w,u_inv_rot_matrix:hp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){L.u_inv_rot_matrix=f,L.u_merc_center=_,L.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],L.u_zoom_transition=s.S(S.zoom);const z=_[0]*s.V,F=_[1]*s.V;L.u_up_dir=S.projection.upVector(new s.bs(0,0,0),z,F)}return L};function lu(h,[n,o,f,_],[y,w]){if(y===w)return[0,0,0,0];const S=255*(h-1)/(h*(w-y));return[n*S,o*S,f*S,_*S]}function dp(h,n,[o,f]){return o===f?0:.5/h+(n-o)*(h-1)/(h*(f-o))}const Yh=(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G,H,U,Y,te,J)=>{return{u_matrix:h,u_normalize_matrix:n,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:(W=z.paint.get("raster-saturation"),W>0?1-1/(1.001-W):-W),u_contrast_factor:(ie=z.paint.get("raster-contrast"),ie>0?1/(1-ie):1+ie),u_spin_weights:Nl(z.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:N,u_zoom_transition:w,u_merc_center:S,u_cutoff_params:I,u_colorization_mix:lu(s.cq,G,U),u_colorization_offset:dp(s.cq,H,U),u_color_ramp:$,u_texture_offset:[te/(Y+2*te),Y/(Y+2*te)],u_texture_res:[Y+2*te,Y+2*te],u_emissive_strength:J};var ie,W};function Nl(h){h*=Math.PI/180;const n=Math.sin(h),o=Math.cos(h);return[(2*o+1)/3,(-Math.sqrt(3)*n-o+1)/3,(Math.sqrt(3)*n-o+1)/3]}const og=(h,n,o,f,_,y,w,S,I,D,L,z)=>({u_matrix:h,u_normalize_matrix:n,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:w,u_merc_center:S,u_cutoff_params:I}),ag=(h,n,o,f,_,y,w,S)=>({u_tile_offset:h,u_velocity:n,u_color_ramp:f,u_velocity_res:o,u_max_speed:_,u_texture_offset:y,u_data_scale:w,u_data_offset:S}),fp=(h,n,o,f,_,y,w,S)=>({u_velocity:h,u_velocity_res:n,u_max_speed:o,u_speed_factor:f,u_lifetime_delta:_,u_rand_seed:Math.random(),u_texture_offset:y,u_data_scale:w,u_data_offset:S}),pp=s.a6.create(),cu=(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G,H,U)=>{const Y=_.transform,te={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Y.getCameraToCenterDistance(G),u_rotate_symbol:+o,u_aspect_ratio:Y.width/Y.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+I,u_pitch_with_map:+f,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:pp,u_up_vector:[0,-1,0],u_icon_transition:U||0,u_icon_saturation:H};return G.name==="globe"&&(te.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],te.u_zoom_transition=z,te.u_inv_rot_matrix=N,te.u_merc_center=F,te.u_camera_forward=Y._camera.forward(),te.u_ecef_origin=s.cr(Y.globeMatrix,L.toUnwrapped()),te.u_tile_matrix=Float32Array.from(Y.globeMatrix),te.u_up_vector=$),te},Vl=(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G,H)=>s.e(cu(h,n,o,f,_,y,w,S,I,D,z,F,N,$,G,H,1),{u_gamma_scale:f?_.transform.getCameraToCenterDistance(H)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.f.devicePixelRatio,u_is_halo:+L,undefined:void 0}),uu=(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G)=>s.e(Vl(h,n,o,f,_,y,w,S,!0,I,!0,L,z,F,N,$,G),{u_texsize_icon:D,u_texture_icon:1}),Kh=(h,n,o,f)=>({u_matrix:h,u_emissive_strength:n,u_opacity:o,u_color:f}),Ul=(h,n,o,f,_,y,w)=>s.e(function(S,I,D,L){const z=D.imageManager.getPattern(S.toString(),I),{width:F,height:N}=D.imageManager.getPixelSize(I),$=Math.pow(2,L.tileID.overscaledZ),G=L.tileSize*Math.pow(2,D.transform.tileZoom)/$,H=G*(L.tileID.canonical.x+L.tileID.wrap*$),U=G*L.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[F,N],u_pattern_size:z.displaySize,u_tile_units_to_pixels:1/s.a3(L,1,D.transform.tileZoom),u_pixel_coord_upper:[H>>16,U>>16],u_pixel_coord_lower:[65535&H,65535&U]}}(_,y,f,w),{u_matrix:h,u_emissive_strength:n,u_opacity:o}),hu=(h,n,o,f,_,y,w,S,I,D,L,z,F=[0,0,0],N)=>{const $=f.style.light,G=$.properties.get("position"),H=[-G.x,-G.y,G.z],U=s.co.create();$.properties.get("anchor")==="viewport"&&(s.co.fromRotation(U,-f.transform.angle),s.N.transformMat3(H,H,U));const Y=D.alphaMode==="MASK",te=$.properties.get("color"),J=z.paint.get("model-ambient-occlusion-intensity"),ie=z.paint.get("model-color").constantOr(s.ax.white),W=z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:n,u_normal_matrix:o,u_lightpos:H,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_camera_pos:F,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+Y,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:[y.r,y.g,y.b,y.a],u_emissiveFactor:[w[0],w[1],w[2],1],u_metallicFactor:S,u_roughnessFactor:I,u_baseColorTexture:mr.BaseColor,u_metallicRoughnessTexture:mr.MetallicRoughness,u_normalTexture:mr.Normal,u_occlusionTexture:mr.Occlusion,u_emissionTexture:mr.Emission,u_color_mix:[ie.r,ie.g,ie.b,W],u_aoIntensity:J,u_emissive_strength:L,u_occlusionTextureTransform:N||[0,0,0,0]}},jl=new Float32Array(16),Gl=(h,n=jl,o=jl)=>({u_matrix:h,u_instance:n,u_node_matrix:o}),lg={fillExtrusion:h=>({u_matrix:new s.bK(h),u_lightpos:new s.bM(h),u_lightintensity:new s.bN(h),u_lightcolor:new s.bM(h),u_vertical_gradient:new s.bN(h),u_opacity:new s.bN(h),u_edge_radius:new s.bN(h),u_ao:new s.bL(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_up_dir:new s.bM(h),u_height_lift:new s.bN(h),u_flood_light_color:new s.bM(h),u_vertical_scale:new s.bN(h),u_flood_light_intensity:new s.bN(h),u_ground_shadow_factor:new s.bM(h),u_emissive_strength:new s.bN(h)}),fillExtrusionDepth:h=>({u_matrix:new s.bK(h),u_edge_radius:new s.bN(h),u_vertical_scale:new s.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new s.bK(h),u_lightpos:new s.bM(h),u_lightintensity:new s.bN(h),u_lightcolor:new s.bM(h),u_vertical_gradient:new s.bN(h),u_height_factor:new s.bN(h),u_edge_radius:new s.bN(h),u_ao:new s.bL(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_up_dir:new s.bM(h),u_height_lift:new s.bN(h),u_image:new s.bO(h),u_texsize:new s.bL(h),u_pixel_coord_upper:new s.bL(h),u_pixel_coord_lower:new s.bL(h),u_tile_units_to_pixels:new s.bN(h),u_opacity:new s.bN(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new s.bK(h),u_opacity:new s.bN(h),u_ao_pass:new s.bN(h),u_meter_to_tile:new s.bN(h),u_ao:new s.bL(h),u_flood_light_intensity:new s.bN(h),u_flood_light_color:new s.bM(h),u_attenuation:new s.bN(h),u_edge_radius:new s.bN(h),u_fb:new s.bO(h),u_fb_size:new s.bN(h)}),fill:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h)}),fillPattern:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_image:new s.bO(h),u_texsize:new s.bL(h),u_pixel_coord_upper:new s.bL(h),u_pixel_coord_lower:new s.bL(h),u_tile_units_to_pixels:new s.bN(h)}),fillOutline:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_world:new s.bL(h)}),fillOutlinePattern:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_world:new s.bL(h),u_image:new s.bO(h),u_texsize:new s.bL(h),u_pixel_coord_upper:new s.bL(h),u_pixel_coord_lower:new s.bL(h),u_tile_units_to_pixels:new s.bN(h)}),circle:s.cs,collisionBox:h=>({u_matrix:new s.bK(h),u_camera_to_center_distance:new s.bN(h),u_extrude_scale:new s.bL(h)}),collisionCircle:h=>({u_matrix:new s.bK(h),u_inv_matrix:new s.bK(h),u_camera_to_center_distance:new s.bN(h),u_viewport_size:new s.bL(h)}),debug:h=>({u_color:new s.ca(h),u_matrix:new s.bK(h),u_overlay:new s.bO(h),u_overlay_scale:new s.bN(h)}),clippingMask:h=>({u_matrix:new s.bK(h)}),heatmap:h=>({u_extrude_scale:new s.bN(h),u_intensity:new s.bN(h),u_matrix:new s.bK(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_up_dir:new s.bM(h)}),heatmapTexture:h=>({u_image:new s.bO(h),u_color_ramp:new s.bO(h),u_opacity:new s.bN(h)}),hillshade:h=>({u_matrix:new s.bK(h),u_image:new s.bO(h),u_latrange:new s.bL(h),u_light:new s.bL(h),u_shadow:new s.ca(h),u_highlight:new s.ca(h),u_emissive_strength:new s.bN(h),u_accent:new s.ca(h)}),hillshadePrepare:h=>({u_matrix:new s.bK(h),u_image:new s.bO(h),u_dimension:new s.bL(h),u_zoom:new s.bN(h)}),line:s.ct,linePattern:s.cu,raster:h=>({u_matrix:new s.bK(h),u_normalize_matrix:new s.bK(h),u_globe_matrix:new s.bK(h),u_merc_matrix:new s.bK(h),u_grid_matrix:new s.cb(h),u_tl_parent:new s.bL(h),u_scale_parent:new s.bN(h),u_fade_t:new s.bN(h),u_opacity:new s.bN(h),u_image0:new s.bO(h),u_image1:new s.bO(h),u_brightness_low:new s.bN(h),u_brightness_high:new s.bN(h),u_saturation_factor:new s.bN(h),u_contrast_factor:new s.bN(h),u_spin_weights:new s.bM(h),u_perspective_transform:new s.bL(h),u_raster_elevation:new s.bN(h),u_zoom_transition:new s.bN(h),u_merc_center:new s.bL(h),u_cutoff_params:new s.bP(h),u_colorization_mix:new s.bP(h),u_colorization_offset:new s.bN(h),u_color_ramp:new s.bO(h),u_texture_offset:new s.bL(h),u_texture_res:new s.bL(h),u_emissive_strength:new s.bN(h)}),rasterParticle:h=>({u_matrix:new s.bK(h),u_normalize_matrix:new s.bK(h),u_globe_matrix:new s.bK(h),u_merc_matrix:new s.bK(h),u_grid_matrix:new s.cb(h),u_tl_parent:new s.bL(h),u_scale_parent:new s.bN(h),u_fade_t:new s.bN(h),u_opacity:new s.bN(h),u_image0:new s.bO(h),u_image1:new s.bO(h),u_raster_elevation:new s.bN(h),u_zoom_transition:new s.bN(h),u_merc_center:new s.bL(h),u_cutoff_params:new s.bP(h)}),rasterParticleTexture:h=>({u_texture:new s.bO(h),u_opacity:new s.bN(h)}),rasterParticleDraw:h=>({u_tile_offset:new s.bL(h),u_velocity:new s.bO(h),u_color_ramp:new s.bO(h),u_velocity_res:new s.bL(h),u_max_speed:new s.bN(h),u_texture_offset:new s.bL(h),u_data_scale:new s.bP(h),u_data_offset:new s.bN(h)}),rasterParticleUpdate:h=>({u_velocity:new s.bO(h),u_velocity_res:new s.bL(h),u_max_speed:new s.bN(h),u_speed_factor:new s.bN(h),u_lifetime_delta:new s.bN(h),u_rand_seed:new s.bN(h),u_texture_offset:new s.bL(h),u_data_scale:new s.bP(h),u_data_offset:new s.bN(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new s.bO(h),u_is_size_feature_constant:new s.bO(h),u_size_t:new s.bN(h),u_size:new s.bN(h),u_camera_to_center_distance:new s.bN(h),u_rotate_symbol:new s.bO(h),u_aspect_ratio:new s.bN(h),u_fade_change:new s.bN(h),u_matrix:new s.bK(h),u_label_plane_matrix:new s.bK(h),u_coord_matrix:new s.bK(h),u_is_text:new s.bO(h),u_pitch_with_map:new s.bO(h),u_texsize:new s.bL(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_camera_forward:new s.bM(h),u_tile_matrix:new s.bK(h),u_up_vector:new s.bM(h),u_ecef_origin:new s.bM(h),u_texture:new s.bO(h),u_icon_transition:new s.bN(h),u_icon_saturation:new s.bN(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new s.bO(h),u_is_size_feature_constant:new s.bO(h),u_size_t:new s.bN(h),u_size:new s.bN(h),u_camera_to_center_distance:new s.bN(h),u_rotate_symbol:new s.bO(h),u_aspect_ratio:new s.bN(h),u_fade_change:new s.bN(h),u_matrix:new s.bK(h),u_label_plane_matrix:new s.bK(h),u_coord_matrix:new s.bK(h),u_is_text:new s.bO(h),u_pitch_with_map:new s.bO(h),u_texsize:new s.bL(h),u_texture:new s.bO(h),u_gamma_scale:new s.bN(h),u_device_pixel_ratio:new s.bN(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_camera_forward:new s.bM(h),u_tile_matrix:new s.bK(h),u_up_vector:new s.bM(h),u_ecef_origin:new s.bM(h),u_is_halo:new s.bO(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new s.bO(h),u_is_size_feature_constant:new s.bO(h),u_size_t:new s.bN(h),u_size:new s.bN(h),u_camera_to_center_distance:new s.bN(h),u_rotate_symbol:new s.bO(h),u_aspect_ratio:new s.bN(h),u_fade_change:new s.bN(h),u_matrix:new s.bK(h),u_label_plane_matrix:new s.bK(h),u_coord_matrix:new s.bK(h),u_is_text:new s.bO(h),u_pitch_with_map:new s.bO(h),u_texsize:new s.bL(h),u_texsize_icon:new s.bL(h),u_texture:new s.bO(h),u_texture_icon:new s.bO(h),u_gamma_scale:new s.bN(h),u_device_pixel_ratio:new s.bN(h),u_is_halo:new s.bO(h)}),background:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_opacity:new s.bN(h),u_color:new s.ca(h)}),backgroundPattern:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_opacity:new s.bN(h),u_image:new s.bO(h),u_pattern_tl:new s.bL(h),u_pattern_br:new s.bL(h),u_texsize:new s.bL(h),u_pattern_size:new s.bL(h),u_pixel_coord_upper:new s.bL(h),u_pixel_coord_lower:new s.bL(h),u_tile_units_to_pixels:new s.bN(h)}),terrainRaster:sp,terrainDepth:sp,skybox:h=>({u_matrix:new s.bK(h),u_sun_direction:new s.bM(h),u_cubemap:new s.bO(h),u_opacity:new s.bN(h),u_temporal_offset:new s.bN(h)}),skyboxGradient:h=>({u_matrix:new s.bK(h),u_color_ramp:new s.bO(h),u_center_direction:new s.bM(h),u_radius:new s.bN(h),u_opacity:new s.bN(h),u_temporal_offset:new s.bN(h)}),skyboxCapture:h=>({u_matrix_3f:new s.cb(h),u_sun_direction:new s.bM(h),u_sun_intensity:new s.bN(h),u_color_tint_r:new s.bP(h),u_color_tint_m:new s.bP(h),u_luminance:new s.bN(h)}),globeRaster:h=>({u_proj_matrix:new s.bK(h),u_globe_matrix:new s.bK(h),u_normalize_matrix:new s.bK(h),u_merc_matrix:new s.bK(h),u_zoom_transition:new s.bN(h),u_merc_center:new s.bL(h),u_image0:new s.bO(h),u_grid_matrix:new s.cb(h),u_skirt_height:new s.bN(h),u_far_z_cutoff:new s.bN(h),u_frustum_tl:new s.bM(h),u_frustum_tr:new s.bM(h),u_frustum_br:new s.bM(h),u_frustum_bl:new s.bM(h),u_globe_pos:new s.bM(h),u_globe_radius:new s.bN(h),u_viewport:new s.bL(h)}),globeAtmosphere:h=>({u_frustum_tl:new s.bM(h),u_frustum_tr:new s.bM(h),u_frustum_br:new s.bM(h),u_frustum_bl:new s.bM(h),u_horizon:new s.bN(h),u_transition:new s.bN(h),u_fadeout_range:new s.bN(h),u_color:new s.bP(h),u_high_color:new s.bP(h),u_space_color:new s.bP(h),u_temporal_offset:new s.bN(h),u_horizon_angle:new s.bN(h)}),model:h=>({u_matrix:new s.bK(h),u_lighting_matrix:new s.bK(h),u_normal_matrix:new s.bK(h),u_lightpos:new s.bM(h),u_lightintensity:new s.bN(h),u_lightcolor:new s.bM(h),u_camera_pos:new s.bM(h),u_opacity:new s.bN(h),u_baseColorFactor:new s.bP(h),u_emissiveFactor:new s.bP(h),u_metallicFactor:new s.bN(h),u_roughnessFactor:new s.bN(h),u_baseTextureIsAlpha:new s.bO(h),u_alphaMask:new s.bO(h),u_alphaCutoff:new s.bN(h),u_baseColorTexture:new s.bO(h),u_metallicRoughnessTexture:new s.bO(h),u_normalTexture:new s.bO(h),u_occlusionTexture:new s.bO(h),u_emissionTexture:new s.bO(h),u_color_mix:new s.bP(h),u_aoIntensity:new s.bN(h),u_emissive_strength:new s.bN(h),u_occlusionTextureTransform:new s.bP(h)}),modelDepth:h=>({u_matrix:new s.bK(h),u_instance:new s.bK(h),u_node_matrix:new s.bK(h)}),groundShadow:h=>({u_matrix:new s.bK(h),u_ground_shadow_factor:new s.bM(h)}),stars:h=>({u_matrix:new s.bK(h),u_up:new s.bM(h),u_right:new s.bM(h),u_intensity_multiplier:new s.bN(h)})};let Ms;function Ss(h,n,o,f,_,y,w){const S=h.context,I=S.gl,D=h.transform,L=h.getOrCreateProgram("collisionBox"),z=[];let F=0,N=0;for(let J=0;J<f.length;J++){const ie=f[J],W=n.getTile(ie),ne=W.getBucket(o);if(!ne)continue;const le=yh(ie,ne,D);let ce=le;_[0]===0&&_[1]===0||(ce=h.translatePosMatrix(le,W,_,y));const pe=w?ne.textCollisionBox:ne.iconCollisionBox,Se=ne.collisionCircleArray;if(Se.length>0){const _e=s.a6.create(),ze=ce;s.a6.mul(_e,ne.placementInvProjMatrix,D.glCoordMatrix),s.a6.mul(_e,_e,ne.placementViewportMatrix),z.push({circleArray:Se,circleOffset:N,transform:ze,invTransform:_e,projection:ne.getProjection()}),F+=Se.length/4,N=F}pe&&(h.terrain&&h.terrain.setupElevationDraw(W,L),L.draw(h,I.LINES,qt.disabled,ei.disabled,h.colorModeForRenderPass(),Ht.disabled,au(ce,D,W,ne.getProjection()),o.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,D.zoom,null,[pe.collisionVertexBuffer,pe.collisionVertexBufferExt]))}if(!w||!z.length)return;const $=h.getOrCreateProgram("collisionCircle"),G=new s.cv;G.resize(4*F),G._trim();let H=0;for(const J of z)for(let ie=0;ie<J.circleArray.length/4;ie++){const W=4*ie,ne=J.circleArray[W+0],le=J.circleArray[W+1],ce=J.circleArray[W+2],pe=J.circleArray[W+3];G.emplace(H++,ne,le,ce,pe,0),G.emplace(H++,ne,le,ce,pe,1),G.emplace(H++,ne,le,ce,pe,2),G.emplace(H++,ne,le,ce,pe,3)}(!Ms||Ms.length<2*F)&&(Ms=function(J){const ie=2*J,W=new s.aw;W.resize(ie),W._trim();for(let ne=0;ne<ie;ne++){const le=6*ne;W.uint16[le+0]=4*ne+0,W.uint16[le+1]=4*ne+1,W.uint16[le+2]=4*ne+2,W.uint16[le+3]=4*ne+2,W.uint16[le+4]=4*ne+3,W.uint16[le+5]=4*ne+0}return W}(F));const U=S.createIndexBuffer(Ms,!0),Y=S.createVertexBuffer(G,s.cw.members,!0);for(const J of z){const ie={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(te=D).getCameraToCenterDistance(J.projection),u_viewport_size:[te.width,te.height]};$.draw(h,I.TRIANGLES,qt.disabled,ei.disabled,h.colorModeForRenderPass(),Ht.disabled,ie,o.id,Y,U,s.aB.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,D.zoom)}var te;Y.destroy(),U.destroy()}const Xs=s.a6.create();function $l(h){const n=h._camera.getWorldToCamera(h.worldSize,1),o=s.a6.multiply([],n,h.globeMatrix);s.a6.invert(o,o);const f=[0,0,0],_=[0,1,0,0];return s.a7.transformMat4(_,_,o),f[0]=_[0],f[1]=_[1],f[2]=_[2],s.N.normalize(f,f),f}function Mt({width:h,height:n,anchor:o,textOffset:f,textScale:_},y){const{horizontalAlign:w,verticalAlign:S}=s.bf(o),I=-(w-.5)*h,D=-(S-.5)*n,L=s.bd(o,f);return new s.P((I/_+L[0])*y,(D/_+L[1])*y)}function mp(h,n,o,f,_,y,w,S,I,D,L){const z=h.text.placedSymbolArray,F=h.text.dynamicLayoutVertexArray,N=h.icon.dynamicLayoutVertexArray,$={},G=h.getProjection(),H=Pl(S,G,y),U=y.elevation,Y=G.upVectorScale(S.canonical,y.center.lat,y.worldSize).metersToTile;F.clear();for(let te=0;te<z.length;te++){const J=z.get(te),{tileAnchorX:ie,tileAnchorY:W,numGlyphs:ne}=J,le=J.hidden||!J.crossTileID||h.allowVerticalPlacement&&!J.placedOrientation?null:f[J.crossTileID];if(le){let ce=0,pe=0,Se=0;if(U){const Ze=U?U.getAtTileOffset(S,ie,W):0,[it,tt,dt]=G.upVector(S.canonical,ie,W);ce=Ze*it*Y,pe=Ze*tt*Y,Se=Ze*dt*Y}let[_e,ze,De,He]=ss(J.projectedAnchorX+ce,J.projectedAnchorY+pe,J.projectedAnchorZ+Se,o?H:w);const ye=Zf(y.getCameraToCenterDistance(G),He);let Ie=_.evaluateSizeForFeature(h.textSizeData,D,J)*ye/s.bc;o&&(Ie*=h.tilePixelRatio/I);const fe=Mt(le,Ie);o?({x:_e,y:ze,z:De}=G.projectTilePoint(ie+fe.x,W+fe.y,S.canonical),[_e,ze,De]=ss(_e+ce,ze+pe,De+Se,w)):(n&&fe._rotate(-y.angle),_e+=fe.x,ze+=fe.y,De=0);const we=h.allowVerticalPlacement&&J.placedOrientation===s.b6.vertical?Math.PI/2:0;for(let Ze=0;Ze<ne;Ze++)s.b9(F,_e,ze,De,we);L&&J.associatedIconIndex>=0&&($[J.associatedIconIndex]={x:_e,y:ze,z:De,angle:we})}else vo(ne,F)}if(L){N.clear();const te=h.icon.placedSymbolArray;for(let J=0;J<te.length;J++){const ie=te.get(J),{numGlyphs:W}=ie,ne=$[J];if(ie.hidden||!ne)vo(W,N);else{const{x:le,y:ce,z:pe,angle:Se}=ne;for(let _e=0;_e<W;_e++)s.b9(N,le,ce,pe,Se)}}h.icon.dynamicLayoutVertexBuffer.updateData(N)}h.text.dynamicLayoutVertexBuffer.updateData(F)}function du(h,n,o,f,_,y,w={}){const S=o.paint.get("icon-translate"),I=o.paint.get("text-translate"),D=o.paint.get("icon-translate-anchor"),L=o.paint.get("text-translate-anchor"),z=o.layout.get("icon-rotation-alignment"),F=o.layout.get("text-rotation-alignment"),N=o.layout.get("icon-pitch-alignment"),$=o.layout.get("text-pitch-alignment"),G=o.layout.get("icon-keep-upright"),H=o.layout.get("text-keep-upright"),U=o.paint.get("icon-color-saturation"),Y=h.context,te=Y.gl,J=h.transform,ie=z==="map",W=F==="map",ne=N==="map",le=$==="map",ce=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pe=!1;const Se=h.depthModeForSublayer(0,qt.ReadOnly),_e=[s.a5(J.center.lng),s.ae(J.center.lat)],ze=o.layout.get("text-variable-anchor"),De=J.projection.name==="globe",He=[],ye=[0,-1,0];for(const Ie of f){const fe=n.getTile(Ie),we=fe.getBucket(o);if(!we||we.projection.name==="mercator"&&De||we.fullyClipped)continue;const Ze=we.projection.name==="globe",it=Ze?s.S(J.zoom):0,tt=Pl(Ie,we.getProjection(),J),dt=J.calculatePixelsToTileUnitsMatrix(fe),Pt=ze&&we.hasTextData(),Ut=we.hasIconTextFit()&&Pt&&we.hasIconData(),zt=we.getProjection().createInversionMatrix(J,Ie.canonical),Bt=()=>{const Tn=ie&&o.layout.get("symbol-placement")!=="point",xi=[],zi=Tn||Ut,vi=o.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&ne&&xi.push("PITCH_WITH_MAP_TERRAIN"),Ze&&(xi.push("PROJECTION_GLOBE_VIEW"),zi&&xi.push("PROJECTED_POS_ON_VIEWPORT")),vi>0&&xi.push("ICON_TRANSITION"),we.icon.zOffsetVertexBuffer&&xi.push("Z_OFFSET"),U<1&&xi.push("SATURATION");const Di=we.icon.programConfigurations.get(o.id),ln=h.getOrCreateProgram(we.sdfIcons?"symbolSDF":"symbolIcon",{config:Di,defines:xi});let Vi;const er=fe.imageAtlasTexture?fe.imageAtlasTexture.size:[0,0],_r=we.iconSizeData,Vr=s.b5(_r,J.zoom),Ns=ne||J.pitch!==0,Ur=Il(tt,fe.tileID.canonical,ne,ie,J,we.getProjection(),dt),tr=hh(tt,fe.tileID.canonical,ne,ie,J,we.getProjection(),dt),qn=h.translatePosMatrix(tr,fe,S,D,!0),Ir=h.translatePosMatrix(tt,fe,S,D),zr=zi?Xs:Ur,jr=ie&&!ne&&!Tn;let Vs=ye;!De&&!J.mercatorFromTransition||ie||(Vs=$l(J));const Ro=Ze?Vs:ye;Vi=we.sdfIcons&&!we.iconsInText?Vl(_r.kind,Vr,jr,ne,h,Ir,zr,qn,!1,er,!0,Ie,it,_e,zt,Ro,we.getProjection()):cu(_r.kind,Vr,jr,ne,h,Ir,zr,qn,!1,er,Ie,it,_e,zt,Ro,we.getProjection(),U,vi);const aa=fe.imageAtlasTexture?fe.imageAtlasTexture:null,cc=o.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear,uc=we.sdfIcons||h.options.rotating||h.options.zooming||cc||Ns?te.LINEAR:te.NEAREST,Ad=we.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,hc=h.terrain&&ne&&Tn?s.a6.invert(s.a6.create(),Ur):Xs;if(Tn&&we.icon){const Wa=J.elevation,wu=Wa?Wa.getAtTileOffsetFunc(Ie,J.center.lat,J.worldSize,we.getProjection()):null,Qs=uh(tt,fe.tileID.canonical,ne,ie,J,we.getProjection(),dt);fh(we,tt,h,!1,Qs,tr,ne,G,wu,Ie)}return{program:ln,buffers:we.icon,uniformValues:Vi,atlasTexture:aa,atlasTextureIcon:null,atlasInterpolation:uc,atlasInterpolationIcon:null,isSDF:we.sdfIcons,hasHalo:Ad,tile:fe,labelPlaneMatrixInv:hc}},li=()=>{const Tn=W&&o.layout.get("symbol-placement")!=="point",xi=[],zi=Tn||ze||Ut;h.terrainRenderModeElevated()&&le&&xi.push("PITCH_WITH_MAP_TERRAIN"),Ze&&(xi.push("PROJECTION_GLOBE_VIEW"),zi&&xi.push("PROJECTED_POS_ON_VIEWPORT")),we.text.zOffsetVertexBuffer&&xi.push("Z_OFFSET");const vi=we.text.programConfigurations.get(o.id),Di=h.getOrCreateProgram(we.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:vi,defines:xi});let ln,Vi=[0,0],er=null;const _r=we.textSizeData;we.iconsInText&&(Vi=fe.imageAtlasTexture?fe.imageAtlasTexture.size:[0,0],er=fe.imageAtlasTexture?fe.imageAtlasTexture:null,ln=le||J.pitch!==0||h.options.rotating||h.options.zooming||_r.kind==="composite"||_r.kind==="camera"?te.LINEAR:te.NEAREST);const Vr=fe.glyphAtlasTexture?fe.glyphAtlasTexture.size:[0,0],Ns=s.b5(_r,J.zoom),Ur=Il(tt,fe.tileID.canonical,le,W,J,we.getProjection(),dt),tr=hh(tt,fe.tileID.canonical,le,W,J,we.getProjection(),dt),qn=h.translatePosMatrix(tr,fe,I,L,!0),Ir=h.translatePosMatrix(tt,fe,I,L),zr=zi?Xs:Ur,jr=W&&!le&&!Tn;let Vs=ye;!De&&!J.mercatorFromTransition||W||(Vs=$l(J));const Ro=Ze?Vs:ye;let aa;aa=we.iconsInText?uu(_r.kind,Ns,jr,le,h,Ir,zr,qn,Vr,Vi,Ie,it,_e,zt,Ro,we.getProjection()):Vl(_r.kind,Ns,jr,le,h,Ir,zr,qn,!0,Vr,!0,Ie,it,_e,zt,Ro,we.getProjection());const cc=fe.glyphAtlasTexture?fe.glyphAtlasTexture:null,uc=te.LINEAR,Ad=o.paint.get("text-halo-width").constantOr(1)!==0,hc=h.terrain&&le&&Tn?s.a6.invert(s.a6.create(),Ur):Xs;if(Tn&&we.text){const Wa=J.elevation,wu=Wa?Wa.getAtTileOffsetFunc(Ie,J.center.lat,J.worldSize,we.getProjection()):null,Qs=uh(tt,fe.tileID.canonical,le,W,J,we.getProjection(),dt);fh(we,tt,h,!0,Qs,tr,le,H,wu,Ie)}return{program:Di,buffers:we.text,uniformValues:aa,atlasTexture:cc,atlasTextureIcon:er,atlasInterpolation:uc,atlasInterpolationIcon:ln,isSDF:!0,hasHalo:Ad,tile:fe,labelPlaneMatrixInv:hc}},Jt=we.icon.segments.get().length,ri=we.text.segments.get().length,ni=Jt&&!w.onlyText?Bt():null,Ai=ri&&!w.onlyIcons?li():null,rn=o.paint.get("icon-opacity").constantOr(1),yi=o.paint.get("text-opacity").constantOr(1);if(ce&&we.canOverlap){pe=!0;const Tn=rn&&!w.onlyText?we.icon.segments.get():[],xi=yi&&!w.onlyIcons?we.text.segments.get():[];for(const zi of Tn)He.push({segments:new s.aB([zi]),sortKey:zi.sortKey,state:ni});for(const zi of xi)He.push({segments:new s.aB([zi]),sortKey:zi.sortKey,state:Ai})}else w.onlyText||He.push({segments:rn?we.icon.segments:new s.aB([]),sortKey:0,state:ni}),w.onlyIcons||He.push({segments:yi?we.text.segments:new s.aB([]),sortKey:0,state:Ai})}pe&&He.sort((Ie,fe)=>Ie.sortKey-fe.sortKey);for(const Ie of He){const fe=Ie.state;if(fe)if(h.terrain&&h.terrain.setupElevationDraw(fe.tile,fe.program,{useDepthForOcclusion:J.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:fe.labelPlaneMatrixInv}),Y.activeTexture.set(te.TEXTURE0),fe.atlasTexture&&fe.atlasTexture.bind(fe.atlasInterpolation,te.CLAMP_TO_EDGE,!0),fe.atlasTextureIcon&&(Y.activeTexture.set(te.TEXTURE1),fe.atlasTextureIcon&&fe.atlasTextureIcon.bind(fe.atlasInterpolationIcon,te.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,fe.program),fe.hasHalo){const we=fe.uniformValues;we.u_is_halo=1,So(fe.buffers,Ie.segments,o,h,fe.program,Se,_,y,we,2),we.u_is_halo=0}else{if(fe.isSDF){const we=fe.uniformValues;fe.hasHalo&&(we.u_is_halo=1,So(fe.buffers,Ie.segments,o,h,fe.program,Se,_,y,we,1)),we.u_is_halo=0}So(fe.buffers,Ie.segments,o,h,fe.program,Se,_,y,fe.uniformValues,1)}}}function So(h,n,o,f,_,y,w,S,I,D){const L=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,y,w,S,Ht.disabled,I,o.id,h.layoutVertexBuffer,h.indexBuffer,n,o.paint,f.transform.zoom,h.programConfigurations.get(o.id),L,D)}function na(h,n,o,f,_,y,w){const S=h.context.gl,I=o.paint.get("fill-pattern"),D=I&&I.constantOr(1);let L,z,F,N,$;w?(z=D&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=S.LINES):(z=D?"fillPattern":"fill",L=S.TRIANGLES);for(const G of f){const H=n.getTile(G);if(D&&!H.patternsLoaded())continue;const U=H.getBucket(o);if(!U)continue;h.prepareDrawTile();const Y=U.programConfigurations.get(o.id),te=h.isTileAffectedByFog(G),J=h.getOrCreateProgram(z,{config:Y,overrideFog:te});D&&(h.context.activeTexture.set(S.TEXTURE0),H.imageAtlasTexture&&H.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Y.updatePaintBuffers());const ie=I.constantOr(null);if(ie&&H.imageAtlas){const le=H.imageAtlas.patternPositions[ie.toString()];le&&Y.setConstantPatternPositions(le)}const W=h.translatePosMatrix(G.projMatrix,H,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),ne=o.paint.get("fill-emissive-strength");if(w){N=U.indexBuffer2,$=U.segments2;const le=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];F=z==="fillOutlinePattern"&&D?up(W,ne,h,H,le):ia(W,ne,le)}else N=U.indexBuffer,$=U.segments,F=D?Wh(W,ne,h,H):ja(W,ne);h.uploadCommonUniforms(h.context,J,G.toUnwrapped()),J.draw(h,L,_,h.stencilModeForClipping(G),y,Ht.disabled,F,o.id,U.layoutVertexBuffer,N,$,o.paint,h.transform.zoom,Y,void 0)}}function Dt(h,n,o,f,_,y,w,S){o.resetLayerRenderingStats(h);const I=h.context,D=I.gl,L=h.transform,z=o.paint.get("fill-extrusion-pattern"),F=z.constantOr(1),N=o.paint.get("fill-extrusion-opacity"),$=h.style.enable3dLights(),G=o.paint.get($&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),H=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],U=o.layout.get("fill-extrusion-edge-radius"),Y=U>0&&!o.paint.get("fill-extrusion-rounded-roof"),te=Y?0:U,J=L.projection.name==="globe"?s.cF():0,ie=L.projection.name==="globe",W=ie?s.S(L.zoom):0,ne=[s.a5(L.center.lng),s.ae(L.center.lat)],le=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ce=o.paint.get("fill-extrusion-flood-light-intensity"),pe=o.paint.get("fill-extrusion-vertical-scale"),Se=wo(h,o.paint.get("fill-extrusion-cutoff-fade-range")),_e=o.paint.get("fill-extrusion-emissive-strength"),ze=[];let De;ie&&ze.push("PROJECTION_GLOBE_VIEW"),H[0]>0&&ze.push("FAUX_AO"),Y&&ze.push("ZERO_ROOF_RADIUS"),S&&ze.push("HAS_CENTROID"),ce>0&&ze.push("FLOOD_LIGHT"),Se.shouldRenderCutoff&&ze.push("RENDER_CUTOFF");const He=h.renderPass==="shadow",ye=h.shadowRenderer,Ie=He&&!!ye;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let fe=[0,0,0];if(ye){const it=h.style.directionalLight,tt=h.style.ambientLight;it&&tt&&(fe=Ol(it,tt)),De=ze.concat(["SHADOWS_SINGLE_CASCADE"])}const we=Ie?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",Ze=o.getLayerRenderingStats();for(const it of f){const tt=n.getTile(it),dt=tt.getBucket(o);if(!dt||dt.projection.name!==L.projection.name)continue;let Pt=!1;ye&&(Pt=ye.getMaxCascadeForTile(it.toUnwrapped())===0);const Ut=h.isTileAffectedByFog(it),zt=dt.programConfigurations.get(o.id),Bt=h.getOrCreateProgram(we,{config:zt,defines:Pt?De:ze,overrideFog:Ut});if(h.terrain&&h.terrain.setupElevationDraw(tt,Bt,{useMeterToDem:!0}),!dt.centroidVertexBuffer){const rn=Bt.attributes.a_centroid_pos;rn!==void 0&&D.vertexAttrib2f(rn,0,0)}!He&&ye&&ye.setupShadows(tt.tileID.toUnwrapped(),Bt,"vector-tile",tt.tileID.overscaledZ),F&&(h.context.activeTexture.set(D.TEXTURE0),tt.imageAtlasTexture&&tt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),zt.updatePaintBuffers());const li=z.constantOr(null);if(li&&tt.imageAtlas){const rn=tt.imageAtlas.patternPositions[li.toString()];rn&&zt.setConstantPatternPositions(rn)}const Jt=o.paint.get("fill-extrusion-vertical-gradient");let ri;if(He&&ye){if(gp(tt.tileID,dt,h))continue;const rn=ye.calculateShadowPassMatrixFromTile(tt.tileID.toUnwrapped());ri=Hh(rn,te,pe)}else{const rn=h.translatePosMatrix(it.expandedProjMatrix,tt,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),yi=L.projection.createInversionMatrix(L,it.canonical);ri=F?ta(rn,h,Jt,N,H,te,it,tt,J,W,ne,yi,le,pe):qh(rn,h,Jt,N,H,te,it,J,W,ne,yi,le,pe,ce,fe,_e)}h.uploadCommonUniforms(I,Bt,it.toUnwrapped(),null,Se);let ni=dt.segments;if(L.projection.name==="mercator"&&!He&&(ni=dt.getVisibleSegments(tt.tileID,h.terrain,h.transform.getFrustum(0)),!ni.get().length))continue;if(Ze)if(He)for(const rn of ni.get())Ze.numRenderedVerticesInShadowPass+=rn.primitiveLength;else for(const rn of ni.get())Ze.numRenderedVerticesInTransparentPass+=rn.primitiveLength;const Ai=[];(h.terrain||S)&&Ai.push(dt.centroidVertexBuffer),ie&&Ai.push(dt.layoutVertexExtBuffer),Bt.draw(h,I.gl.TRIANGLES,_,y,w,Ht.backCCW,ri,o.id,dt.layoutVertexBuffer,dt.indexBuffer,ni,o.paint,h.transform.zoom,zt,Ai)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function Eo(h,n,o,f,_,y,w,S,I,D,L,z,F,N,$,G,H,U,Y){const te=h.context,J=te.gl,ie=h.transform,W=h.transform.zoom,ne=[],le=wo(h,o.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(ne.push("CLEAR_SUBPASS"),Y&&(ne.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(J.TEXTURE0),Y.bind(J.LINEAR,J.CLAMP_TO_EDGE))):D==="sdf"&&ne.push("SDF_SUBPASS"),H&&ne.push("HAS_CENTROID"),le.shouldRenderCutoff&&ne.push("RENDER_CUTOFF");const ce=o.layout.get("fill-extrusion-edge-radius"),pe=(Se,_e,ze,De,He)=>{const ye=_e.programConfigurations.get(o.id),Ie=h.isTileAffectedByFog(Se),fe=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:ye,defines:ne,overrideFog:Ie}),we=((it,tt,dt,Pt,Ut,zt,Bt,li,Jt,ri,ni)=>({u_matrix:tt,u_opacity:dt,u_ao_pass:Pt?1:0,u_meter_to_tile:Ut,u_ao:zt,u_flood_light_intensity:Bt,u_flood_light_color:li,u_attenuation:Jt,u_edge_radius:ri,u_fb:0,u_fb_size:ni}))(0,De,L,I,He,[z,F*He],N,$,G,W>=17?0:ce*He,Y?Y.size[0]:0),Ze=[];H&&Ze.push(_e.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(te,fe,Se.toUnwrapped(),null,le),fe.draw(h,te.gl.TRIANGLES,_,y,w,S,we,o.id,_e.vertexBuffer,_e.indexBuffer,ze,o.paint,W,ye,Ze)};for(const Se of f){const _e=n.getTile(Se),ze=_e.getBucket(o);if(!ze||ze.projection.name!==ie.projection.name||!ze.groundEffect||ze.groundEffect&&!ze.groundEffect.hasData())continue;const De=ze.groundEffect,He=1/ze.tileToMeter;{const ye=h.translatePosMatrix(Se.projMatrix,_e,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Ie=De.getDefaultSegment();pe(Se,De,Ie,ye,He)}if(U)for(let ye=0;ye<4;ye++){const Ie=s.cG[ye](Se),fe=n.getTile(Ie);if(!fe)continue;const we=fe.getBucket(o);if(!we||we.projection.name!==ie.projection.name||!we.groundEffect||we.groundEffect&&!we.groundEffect.hasData())continue;const Ze=we.groundEffect;let it,tt;ye===0?(it=[-s.V,0,0],tt=1):ye===1?(it=[s.V,0,0],tt=0):ye===2?(it=[0,-s.V,0],tt=3):(it=[0,s.V,0],tt=2);const dt=Ze.regionSegments[tt];if(!dt)continue;const Pt=new Float32Array(16);s.a6.translate(Pt,Se.projMatrix,it),pe(Se,Ze,dt,h.translatePosMatrix(Pt,_e,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),He)}}}function cg(h,n,o,f,_,y,w){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const S=y?y.findDEMTileFor(o):null;if(!(S&&S.dem||w))return;const I=U=>new s.P(Math.ceil((U+s.cJ)*s.cK),0),D=U=>{const Y=n.getSource().minzoom,te=ie=>{const W=n.getTileByID(ie);if(W&&W.hasData())return W.getBucket(_)},J=[0,-1,1];for(const ie of J){if(U.overscaledZ+ie<Y)continue;const W=te(U.calculateScaledKey(U.overscaledZ+ie));if(W)return W}},L=[0,0,0],z=(U,Y)=>(L[0]=Math.min(U.min.y,Y.min.y),L[1]=Math.max(U.max.y,Y.max.y),L[2]=s.V-Y.min.x>U.max.x?Y.min.x-s.V:U.max.x,L),F=(U,Y)=>(L[0]=Math.min(U.min.x,Y.min.x),L[1]=Math.max(U.max.x,Y.max.x),L[2]=s.V-Y.min.y>U.max.y?Y.min.y-s.V:U.max.y,L),N=[(U,Y)=>z(U,Y),(U,Y)=>z(Y,U),(U,Y)=>F(U,Y),(U,Y)=>F(Y,U)],$=(U,Y,te,J,ie,W,ne)=>{if(!y)return 0;const le=[[W?te:U,W?U:te,0],[W?te:Y,W?Y:te,0]],ce=ne<0?s.V+ne:ne,pe=[W?ce:(U+Y)/2,W?(U+Y)/2:ce,0];return te===0&&ne<0||te!==0&&ne>0?y.getForTilePoints(ie,[pe],!0,J):le.push(pe),y.getForTilePoints(o,le,!0,S),Math.max(le[0][2],le[1][2],pe[2])/y.exaggeration()};for(let U=0;U<4;U++){const Y=f.borderFeatureIndices[U];if(Y.length===0)continue;const te=s.cG[U](o),J=D(te);if(!(J&&J instanceof s.cH)||f.borderDoneWithNeighborZ[U]===J.canonical.z)continue;J.centroidVertexArray.length===0&&J.createCentroidsBuffer();const ie=y?y.findDEMTileFor(te):null;if(!(ie&&ie.dem||w))continue;const W=(U<2?1:5)-U,ne=J.borderDoneWithNeighborZ[W]!==f.canonical.z,le=J.borderFeatureIndices[W];let ce=0;if(f.canonical.z!==J.canonical.z){for(const pe of Y)f.showCentroid(f.featuresOnBorder[pe]);if(ne)for(const pe of le)J.showCentroid(J.featuresOnBorder[pe]);f.borderDoneWithNeighborZ[U]=J.canonical.z,J.borderDoneWithNeighborZ[W]=f.canonical.z}for(const pe of Y){const Se=f.featuresOnBorder[pe],_e=f.centroidData[Se.centroidDataIndex],ze=Se.borders[U];let De;for(;ce<le.length;){De=J.featuresOnBorder[le[ce]];const He=De.borders[W];if(He[1]>ze[0]+3||He[0]>ze[0]-3)break;J.showCentroid(De),ce++}if(De&&ce<le.length){const He=ce;let ye=0;for(;!(De.borders[W][0]>ze[1]-3)&&(ye++,++ce!==le.length);)De=J.featuresOnBorder[le[ce]];if(De=J.featuresOnBorder[le[He]],ye>1){const we=De.borders[W];Math.abs(ze[0]-we[0])<3&&Math.abs(ze[1]-we[1])<3&&(ye=1,ce=He+1)}else if(ye===0){f.showCentroid(Se);continue}const Ie=J.centroidData[De.centroidDataIndex];w&&ye===1&&(((G=_e).flags|(H=Ie).flags)&s.cI?(G.flags|=s.cI,H.flags|=s.cI):(G.flags&=~s.cI,H.flags&=~s.cI));const fe=Se.intersectsCount()>1||De.intersectsCount()>1;if(ye>1)ce=He,_e.centroidXY=Ie.centroidXY=new s.P(0,0);else if(ie&&ie.dem&&!fe){const we=N[U](_e,Ie),Ze=U%2?s.V-1:0,it=$(we[0],Math.min(s.V-1,we[1]),Ze,ie,te,U<2,we[2]);_e.centroidXY=Ie.centroidXY=I(it)}else fe?_e.centroidXY=Ie.centroidXY=new s.P(0,0):(_e.centroidXY=f.encodeBorderCentroid(Se),Ie.centroidXY=J.encodeBorderCentroid(De));f.writeCentroidToBuffer(_e),J.writeCentroidToBuffer(Ie)}else f.showCentroid(Se)}f.borderDoneWithNeighborZ[U]=J.canonical.z,J.borderDoneWithNeighborZ[W]=f.canonical.z}var G,H;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(h)}const ug=[1,0,0],Jh=[0,1,0],_p=[0,0,1];function gp(h,n,o){const f=o.transform,_=o.shadowRenderer;if(!_)return!0;const y=h.toUnwrapped(),w=f.tileSize*_._cascades[o.currentShadowCascade].scale;let S=n.maxHeight;if(f.elevation){const G=f.elevation.getMinMaxForTile(h);G&&(S+=G.max)}const I=[..._.shadowDirection];I[2]=-I[2];const D=_.computeSimplifiedTileShadowVolume(y,S,w,I);if(!D)return!1;const L=[ug,Jh,_p,I,[I[0],0,I[2]],[0,I[1],I[2]]],z=f.projection.name==="globe",F=f.scaleZoom(w),N=s.bq.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,F,!z),$=_.getCurrentCascadeFrustum();return N.intersectsPrecise(D.vertices,D.planes,L)===0||$.intersectsPrecise(D.vertices,D.planes,L)===0}function yp(h){return[h[0]*s.cL,h[1]*s.cL,h[2]*s.cL,0]}function Qh(h,n,o,f,_,y,w,S,I){const D=f.getSource(),L=o.globeSharedBuffers;if(!L)return;let z,F,N;if(n&&(z=f.getTile(n)),D instanceof s.ap?(F=D.texture,N=s.cj(0,0,o.transform)):z&&n&&(F=z.texture,N=s.cj(n.canonical.z,n.canonical.x,o.transform)),!F||!N)return;h||(N=s.a6.scale(s.a6.create(),N,[1,-1,1]));const $=o.context,G=$.gl,H=_.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,U=o.colorModeForDrapableLayerRenderPass(y),Y=w.defines;Y.push("GLOBE_POLES");const te=new qt(G.LEQUAL,qt.ReadWrite,o.depthRangeFor3D),J=Float32Array.from(o.transform.expandedFarZProjMatrix),ie=Float32Array.from(s.aT(s.ci(new s.bs(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),$.activeTexture.set(G.TEXTURE0),F.bind(H,G.CLAMP_TO_EDGE),$.activeTexture.set(G.TEXTURE1),F.bind(H,G.CLAMP_TO_EDGE),F.useMipmap&&$.extTextureFilterAnisotropic&&o.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const[W,ne,le,ce]=n?L.getPoleBuffers(n.canonical.z,!1):L.getPoleBuffers(0,!0),pe=_.paint.get("raster-elevation");let Se;h?(Se=W,o.renderDefaultNorthPole=pe!==0):(Se=ne,o.renderDefaultSouthPole=pe!==0);const _e=yp(w.mix),ze=((He,ye,Ie,fe,we,Ze,it,tt,dt,Pt,Ut,zt,Bt)=>Yh(He,ye,Ie,new Float32Array(16),new Float32Array(9),[0,0],fe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],tt,2,Pt,Ut,zt,1,0,Bt))(J,ie,N,s.S(o.transform.zoom),0,_,0,pe,0,_e,w.offset,w.range,y),De=o.getOrCreateProgram("raster",{defines:Y});o.uploadCommonUniforms($,De,null),De.draw(o,G.TRIANGLES,te,I,U,S,ze,_.id,Se,le,ce)}function ed(h){const n=h._nearZ,o=h.projection.farthestPixelDistance(h),f=o-n,_=.2*h.height,y=n+_;return[n,o,(y-_-n)/f,(y-n)/f]}function td(h,n,o,f){if(h)return n instanceof st&&h instanceof Xo?n.getTextureDescriptor(h,o,!0):{texture:h.texture,mix:yp(f.mix),offset:f.offset,buffer:0,tileSize:1}}function id(h,n,o){if(!h)return null;const f=n.getTextureDescriptor(h,o,!0);if(!f)return null;let{texture:_,mix:y,offset:w,tileSize:S,buffer:I,format:D}=f;if(!_||!D)return null;let L=!1;return D==="uint32"&&(L=!0,y[3]=0,y=lu(s.cM,y,[0,o.paint.get("raster-particle-max-speed")]),w=dp(s.cM,w,[0,o.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[I/(S+2*I),S/(S+2*I)],tileSize:S,scalarData:L,scale:y,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function nd(h){const n=h._nearZ,o=h.projection.farthestPixelDistance(h),f=o-n,_=.2*h.height,y=n+_;return[n,o,(y-_-n)/f,(y-n)/f]}const Br=new s.ax(1,0,0,1),Ao=new s.ax(0,1,0,1),xp=new s.ax(0,0,1,1),rd=new s.ax(1,0,1,1),sd=new s.ax(0,1,1,1);function Io(h,n,o,f,_,y,w){const S=h.context,I=h.transform,D=S.gl,L=I.projection.name==="globe",z=L?["PROJECTION_GLOBE_VIEW"]:[];let F=s.a6.clone(o.projMatrix);if(L&&s.S(I.zoom)>0){const _e=s.aS(o.canonical,I),ze=s.cN(_e);F=s.a6.multiply(new Float32Array(16),I.globeMatrix,ze),s.a6.multiply(F,I.projMatrix,F)}const N=s.a6.create();N[12]+=2*_/(s.f.devicePixelRatio*I.width),N[13]+=2*y/(s.f.devicePixelRatio*I.height),s.a6.multiply(F,N,F);const $=h.getOrCreateProgram("debug",{defines:z}),G=n.getTileByID(o.key);h.terrain&&h.terrain.setupElevationDraw(G,$);const H=qt.disabled,U=ei.disabled,Y=h.colorModeForRenderPass(),te="$debug";S.activeTexture.set(D.TEXTURE0),h.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),L?G._makeGlobeTileDebugBuffers(h.context,I):G._makeDebugTileBoundsBuffers(h.context,I.projection);const J=G._tileDebugBuffer||h.debugBuffer,ie=G._tileDebugIndexBuffer||h.debugIndexBuffer,W=G._tileDebugSegments||h.debugSegments;if($.draw(h,D.LINE_STRIP,H,U,Y,Ht.disabled,Zh(F,f),te,J,ie,W,null,null,null,[G._globeTileDebugBorderBuffer]),w){const _e=G.latestRawTileData,ze=Math.floor((_e&&_e.byteLength||0)/1024);let De=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(De+=` => ${o.overscaledZ}`),De+=` ${G.state}`,De+=` ${ze}kb`,function(He,ye){He.initDebugOverlayCanvas();const Ie=He.debugOverlayCanvas,fe=He.context.gl,we=He.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,Ie.width,Ie.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(ye,5,5),we.strokeText(ye,5,5),He.debugOverlayTexture.update(Ie),He.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}(h,De)}const ne=n.getTile(o).tileSize,le=512/Math.min(ne,512)*(o.overscaledZ/I.zoom)*.5,ce=G._tileDebugTextBuffer||h.debugBuffer,pe=G._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Se=G._tileDebugTextSegments||h.debugSegments;$.draw(h,D.TRIANGLES,H,U,mi.alphaBlended,Ht.disabled,Zh(F,s.ax.transparent,le),te,ce,pe,Se,null,null,null,[G._globeTileDebugTextBuffer])}function od(h,n,o,f){bn(h,0,n+o/2,h.transform.width,o,f)}function Xr(h,n,o,f){bn(h,n-o/2,0,o,h.transform.height,f)}function bn(h,n,o,f,_,y){const w=h.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(n*s.f.devicePixelRatio,o*s.f.devicePixelRatio,f*s.f.devicePixelRatio,_*s.f.devicePixelRatio),w.clear({color:y}),S.disable(S.SCISSOR_TEST)}const fu=s.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ad}=fu;function Ys(h,n,o,f){h.emplaceBack(n,o,f)}class ld{constructor(n){this.vertexArray=new s.az,this.indices=new s.aw,Ys(this.vertexArray,-1,-1,1),Ys(this.vertexArray,1,-1,1),Ys(this.vertexArray,-1,1,1),Ys(this.vertexArray,1,1,1),Ys(this.vertexArray,-1,-1,-1),Ys(this.vertexArray,1,-1,-1),Ys(this.vertexArray,-1,1,-1),Ys(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,ad),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.aB.simpleSegment(0,0,36,12)}}function ra(h,n,o,f,_,y){const w=h.context.gl,S=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),D=n.paint.get("sky-atmosphere-sun-intensity"),L=((z,F,N,$,G)=>({u_matrix_3f:z,u_sun_direction:F,u_sun_intensity:N,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(s.co.fromMat4(s.co.create(),f),_,D,S,I);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+y,n.skyboxTexture,0),o.draw(h,w.TRIANGLES,qt.disabled,ei.disabled,mi.unblended,Ht.frontCW,L,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const hg=s.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ga{constructor(n){const o=new s.cO;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const f=new s.aw;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(o,hg.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=s.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ql=s.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class rt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Gt{constructor(n){this.colorModeAlphaBlendedWriteRGB=new mi([1,mo,1,mo],s.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new mi([1,0,1,0],s.ax.transparent,[!1,!1,!1,!0]),this.params=new rt,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const o=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ga(o);const f=this.params.sizeRange,_=this.params.intensityRange,y=function(L){const z=s.aA(30),F=[];for(let N=0;N<L;++N){const $=2*Math.PI*z(),G=Math.acos(1-2*z())-.5*Math.PI;F.push(s.N.fromValues(Math.cos(G)*Math.cos($),Math.cos(G)*Math.sin($),Math.sin(G)))}return F}(this.params.starsCount),w=s.aA(300),S=new s.cP,I=new s.aw;let D=0;for(let L=0;L<y.length;++L){const z=s.N.scale([],y[L],200),F=Math.max(0,1+.01*f*(1*w()-.5)),N=Math.max(0,1+.01*_*(1*w()-.5));S.emplaceBack(z[0],z[1],z[2],-1,-1,F,N),S.emplaceBack(z[0],z[1],z[2],1,-1,F,N),S.emplaceBack(z[0],z[1],z[2],1,1,F,N),S.emplaceBack(z[0],z[1],z[2],-1,1,F,N),I.emplaceBack(D+0,D+1,D+2),I.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=o.createVertexBuffer(S,ql.members),this.starsIdx=o.createIndexBuffer(I),this.starsSegments=s.aB.simpleSegment(0,0,S.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,o){const f=n.context,_=f.gl,y=n.transform,w=new qt(_.LEQUAL,qt.ReadOnly,[0,1]),S=s.S(y.zoom),I=o.properties.get("color").toArray01(),D=o.properties.get("high-color").toArray01(),L=o.properties.get("space-color").toArray01PremultipliedAlpha(),z=5e-4,F=s.cQ(o.properties.get("horizon-blend"),0,1,z,.25),N=s.cd(n,f,y)&&F===z?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,$=n.frameCounter/1e3%1,G=s.N.length(y.globeCenterInViewSpace),H=Math.sqrt(Math.pow(G,2)-Math.pow(N,2)),U=Math.acos(H/G),Y=te=>{const J=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];te&&J.push("ALPHA_PASS");const ie=n.getOrCreateProgram("globeAtmosphere",{defines:J}),W=((le,ce,pe,Se,_e,ze,De,He,ye,Ie,fe,we)=>({u_frustum_tl:le,u_frustum_tr:ce,u_frustum_br:pe,u_frustum_bl:Se,u_horizon:_e,u_transition:ze,u_fadeout_range:De,u_color:He,u_high_color:ye,u_space_color:Ie,u_temporal_offset:fe,u_horizon_angle:we}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,S,F,I,D,L,$,U);n.uploadCommonUniforms(f,ie);const ne=this.atmosphereBuffer;ne&&ie.draw(n,_.TRIANGLES,w,ei.disabled,te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ht.backCW,W,te?"atmosphere_glow_alpha":"atmosphere_glow",ne.vertexBuffer,ne.indexBuffer,ne.segments)};Y(!1),Y(!0)}drawStars(n,o){const f=s.aa(o.properties.get("star-intensity"),0,1);if(f===0)return;const _=n.context,y=_.gl,w=n.transform,S=n.getOrCreateProgram("stars"),I=s.bi.identity([]);s.bi.rotateX(I,I,-w._pitch),s.bi.rotateZ(I,I,-w.angle),s.bi.rotateX(I,I,s.bj(w._center.lat)),s.bi.rotateY(I,I,-s.bj(w._center.lng));const D=s.a6.fromQuat(new Float32Array(16),I),L=s.a6.multiply([],w.starsProjMatrix,D),z=s.co.fromMat4([],D),F=s.co.invert([],z),N=[0,1,0];s.N.transformMat3(N,N,F),s.N.scale(N,N,this.params.sizeMultiplier);const $=[1,0,0];s.N.transformMat3($,$,F),s.N.scale($,$,this.params.sizeMultiplier);const G=(H=N,U=$,Y=f,{u_matrix:Float32Array.from(L),u_up:H,u_right:U,u_intensity_multiplier:Y});var H,U,Y;n.uploadCommonUniforms(_,S),this.starsVx&&this.starsIdx&&S.draw(n,y.TRIANGLES,qt.disabled,ei.disabled,this.colorModeAlphaBlendedWriteRGB,Ht.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function sa(h,n){const o=[...h],f=n.cameraWorldSizeForFog/n.worldSize,_=s.a6.identity([]);return s.a6.scale(_,_,[f,f,1]),s.a6.multiply(o,_,o),s.a6.multiply(o,n.worldToFogMatrix,o),o}function wn(h,n,o,f){const _=o.material,y=f.context,{baseColorTexture:w,metallicRoughnessTexture:S}=_.pbrMetallicRoughness,{normalTexture:I,occlusionTexture:D,emissionTexture:L}=_;function z(F,N,$){if(F&&(h.push(N),y.activeTexture.set(y.gl.TEXTURE0+$),F.gfxTexture)){const{minFilter:G,magFilter:H,wrapS:U,wrapT:Y}=F.sampler;F.gfxTexture.bindExtraParam(G,H,U,Y)}}z(w,"HAS_TEXTURE_u_baseColorTexture",mr.BaseColor),z(S,"HAS_TEXTURE_u_metallicRoughnessTexture",mr.MetallicRoughness),z(I,"HAS_TEXTURE_u_normalTexture",mr.Normal),z(D,"HAS_TEXTURE_u_occlusionTexture",mr.Occlusion),z(L,"HAS_TEXTURE_u_emissionTexture",mr.Emission),o.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(o.texcoordBuffer)),o.colorBuffer&&(h.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(o.colorBuffer)),o.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(o.normalBuffer)),o.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(o.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES")}function Hl(h,n,o,f,_,y){const w=o.paint.get("model-opacity"),S=n.context,I=new qt(n.context.gl.LEQUAL,qt.ReadWrite,n.depthRangeFor3D),D=n.transform,L=h.mesh,z=L.material,F=z.pbrMetallicRoughness,N=n.style.fog;let $;$=n.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:s.a6.multiply([],f.zScaleMatrix,h.nodeModelMatrix),s.a6.multiply($,f.negCameraPosMatrix,$);const G=s.a6.invert([],$);s.a6.transpose(G,G);const H=o.paint.get("model-emissive-strength").constantOr(0),U=hu(new Float32Array(h.worldViewProjection),new Float32Array($),new Float32Array(G),n,w,F.baseColorFactor,z.emissiveFactor,F.metallicFactor,F.roughnessFactor,z,H,o),Y={defines:[]},te=[];wn(Y.defines,te,L,n);const J=n.shadowRenderer;J&&(J.useNormalOffset=!1);let ie=null;if(N){const le=sa(h.nodeModelMatrix,n.transform);if(ie=new Float32Array(le),D.projection.name!=="globe"){const ce=L.aabb.min,pe=L.aabb.max,[Se,_e]=N.getOpacityForBounds(le,ce[0],ce[1],pe[0],pe[1]);Y.overrideFog=Se>=qi||_e>=qi}}const W=wo(n,o.paint.get("model-cutoff-fade-range"));W.shouldRenderCutoff&&Y.defines.push("RENDER_CUTOFF");const ne=n.getOrCreateProgram("model",Y);n.uploadCommonUniforms(S,ne,null,ie,W),n.renderPass!=="shadow"&&J&&J.setupShadowsFromMatrix(h.nodeModelMatrix,ne),ne.draw(n,S.gl.TRIANGLES,I,_,y,L.material.doubleSided?Ht.disabled:Ht.backCCW,U,o.id,L.vertexBuffer,L.indexBuffer,L.segments,o.paint,n.transform.zoom,void 0,te)}function Wl(h,n,o,f,_,y,w){let S;S=h.projection.name==="globe"?s.cS(o,h):[...o],s.a6.multiply(S,S,n.matrix);const I=s.a6.multiply([],f,S);if(n.meshes)for(const D of n.meshes){if(D.material.alphaMode!=="BLEND"){w.push({mesh:D,depth:0,modelIndex:_,worldViewProjection:I,nodeModelMatrix:S});continue}const L=s.N.transformMat4([],D.centroid,I);L[2]>0&&y.push({mesh:D,depth:L[2],modelIndex:_,worldViewProjection:I,nodeModelMatrix:S})}if(n.children)for(const D of n.children)Wl(h,D,o,f,_,y,w)}function Te(h,n,o,f){const _=o.shadowRenderer;if(!_)return;const y=_.getShadowPassDepthMode(),w=_.getShadowPassColorMode(),S=_.calculateShadowPassMatrixFromMatrix(n),I=Gl(S);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,y,ei.disabled,w,Ht.backCCW,I,f.id,h.vertexBuffer,h.indexBuffer,h.segments,f.paint,o.transform.zoom,void 0,void 0)}function cd(h,n,o){const f=n.updateZoomBasedPaintProperties(),_=function(y,w,S){let I,D,L,z=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&z>0){const F=y.terrain,N=F.findDEMTileFor(S);N&&N.dem?I=s.cU.create(F,S,N):z=0}if(z===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),z===w.validForExaggeration&&(z===0||I&&I._demTile&&I._demTile.tileID===w.validForDEMTile.id&&I._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const F in w.instancesPerModel){const N=w.instancesPerModel[F];for(let $=0;$<N.instancedDataArray.length;++$){const G=(I?z*I.getElevationAt(0|N.instancedDataArray.float32[16*$],0|N.instancedDataArray.float32[16*$+1],!0,!0):0)+N.instancesEvaluatedElevation[$];N.instancedDataArray.float32[16*$+6]=G,D=D?Math.min(w.terrainElevationMin,G):G,L=L?Math.max(w.terrainElevationMax,G):G}}return w.terrainElevationMin=D||0,w.terrainElevationMax=L||0,w.validForExaggeration=z,w.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,n,o);(f||_)&&(n.uploaded=!1,n.upload(h.context))}const Yr={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.bS([0,0,0],[s.V,s.V,0])};function vp(h,n){const o=1<<h.canonical.z,f=n.getFreeCameraOptions().position,_=n.elevation,y=h.canonical.x/o,w=(h.canonical.x+1)/o,S=h.canonical.y/o,I=(h.canonical.y+1)/o;let D=n._centerAltitude;if(_){const N=_.getMinMaxForTile(h);N&&N.max>D&&(D=N.max)}const L=s.aa(f.x,y,w)-f.x,z=s.aa(f.y,S,I)-f.y,F=s.bl(D,n.center.lat)-f.z;return n._zoomFromMercatorZ(Math.sqrt(L*L+z*z+F*F))}function ud(h,n,o,f,_,y,w){const S=h.context,I=h.renderPass==="shadow",D=h.shadowRenderer,L=I&&D?D.getShadowPassDepthMode():new qt(S.gl.LEQUAL,qt.ReadWrite,h.depthRangeFor3D),z=h.isTileAffectedByFog(y);if(o.meshes)for(const F of o.meshes){const N=["MODEL_POSITION_ON_GPU"],$=[];let G,H,U;f.instancedDataArray.length>20&&N.push("INSTANCED_ARRAYS");const Y=wo(h,n.paint.get("model-cutoff-fade-range"));if(Y.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),I&&D)G=h.getOrCreateProgram("modelDepth",{defines:N}),H=Gl(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(o.matrix)),U=D.getShadowPassColorMode();else{wn(N,$,F,h),G=h.getOrCreateProgram("model",{defines:N,overrideFog:z});const J=F.material,ie=J.pbrMetallicRoughness,W=n.paint.get("model-opacity"),ne=n.paint.get("model-emissive-strength").constantOr(0);H=hu(y.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),h,W,ie.baseColorFactor,J.emissiveFactor,ie.metallicFactor,ie.roughnessFactor,J,ne,n,_),D&&(w.shadowUniformsInitialized?G.setShadowUniformValues(S,D.getShadowUniformValues()):(D.setupShadows(y.toUnwrapped(),G,"model-tile",y.overscaledZ),w.shadowUniformsInitialized=!0)),U=Y.shouldRenderCutoff||W<1||J.alphaMode!=="OPAQUE"?mi.alphaBlended:mi.unblended}h.uploadCommonUniforms(S,G,y.toUnwrapped(),null,Y);const te=F.material.doubleSided?Ht.disabled:Ht.backCCW;if(f.instancedDataArray.length>20)$.push(f.instancedDataBuffer),G.draw(h,S.gl.TRIANGLES,L,ei.disabled,U,te,H,n.id,F.vertexBuffer,F.indexBuffer,F.segments,n.paint,h.transform.zoom,void 0,$,f.instancedDataArray.length);else{const J=I?"u_instance":"u_normal_matrix";for(let ie=0;ie<f.instancedDataArray.length;++ie)H[J]=new Float32Array(f.instancedDataArray.arrayBuffer,64*ie,16),G.draw(h,S.gl.TRIANGLES,L,ei.disabled,U,te,H,n.id,F.vertexBuffer,F.indexBuffer,F.segments,n.paint,h.transform.zoom,void 0,$)}}if(o.children)for(const F of o.children)ud(h,n,F,f,_,y,w)}const $a=[1,-1,1];function dg(h,n,o,f){if(!o.modelManager)return!0;const _=o.modelManager;if(!o.shadowRenderer)return!0;const y=o.shadowRenderer,w=n.aabb;let S=!0,I=h.maxHeight;if(I===0){let L=0;for(const z in h.instancesPerModel){const F=_.getModel(z,f);F?L=Math.max(L,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):S=!1}I=h.maxScale*L*1.41+h.maxVerticalOffset,S&&(h.maxHeight=I)}w.max[2]=I,w.min[2]+=h.terrainElevationMin,w.max[2]+=h.terrainElevationMax,s.N.transformMat4(w.min,w.min,n.tileMatrix),s.N.transformMat4(w.max,w.max,n.tileMatrix);const D=w.intersects(y.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=D===2),D===0}class fg{}class bp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,o,f){{const z=this._storage.get(o.id);if(z)return z.lastUsedFrameIdx=n,z.buf}const _=f.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),w=new ArrayBuffer(y),S=new Int16Array(w);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const I=new s.cW;for(let z=0;z<y/2;z+=3){const F=S[z],N=S[z+1],$=S[z+2];I.emplaceBack(F,N),I.emplaceBack(N,$),I.emplaceBack($,F)}const D=f.bindVertexArrayOES.current,L=new fg;return L.buf=new on(f,I),L.lastUsedFrameIdx=n,this._storage.set(o.id,L),f.bindVertexArrayOES.set(D),L.buf}update(n){for(const[o,f]of this._storage)n-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(o))}destroy(){for(const[n,o]of this._storage)o.buf.destroy(),this._storage.delete(n)}}class Zl{registerParameter(n,o,f,_,y){}registerButton(n,o,f){}}const Xl={symbol:function(h,n,o,f,_){if(h.renderPass!=="translucent")return;const y=ei.disabled,w=h.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(D,L,z,F,N,$,G){const H=L.transform,U=N==="map",Y=$==="map";for(const te of D){const J=F.getTile(te),ie=J.getBucket(z);if(!ie||!ie.text||!ie.text.segments.get().length)continue;const W=s.b5(ie.textSizeData,H.zoom),ne=Pl(te,ie.getProjection(),H),le=H.calculatePixelsToTileUnitsMatrix(J),ce=Il(ne,J.tileID.canonical,Y,U,H,ie.getProjection(),le),pe=ie.hasIconTextFit()&&ie.hasIconData();if(W){const Se=Math.pow(2,H.zoom-J.tileID.overscaledZ);mp(ie,U,Y,G,s.cx,H,ce,te,Se,W,pe)}}}(f,h,o,n,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),_);const S=o.paint.get("icon-opacity").constantOr(1)!==0,I=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(S||I)?du(h,n,o,f,y,w):(S&&du(h,n,o,f,y,w,{onlyIcons:!0}),I&&du(h,n,o,f,y,w,{onlyText:!0})),n.map.showCollisionBoxes&&(Ss(h,n,o,f,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Ss(h,n,o,f,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(h,n,o,f){if(h.renderPass!=="translucent")return;const _=o.paint.get("circle-opacity"),y=o.paint.get("circle-stroke-width"),w=o.paint.get("circle-stroke-opacity"),S=o.layout.get("circle-sort-key").constantOr(1)!==void 0,I=o.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const D=h.context,L=D.gl,z=h.transform,F=h.depthModeForSublayer(0,qt.ReadOnly),N=ei.disabled,$=h.colorModeForDrapableLayerRenderPass(I),G=z.projection.name==="globe",H=[s.a5(z.center.lng),s.ae(z.center.lat)],U=[];for(let te=0;te<f.length;te++){const J=f[te],ie=n.getTile(J),W=ie.getBucket(o);if(!W||W.projection.name!==z.projection.name)continue;const ne=W.programConfigurations.get(o.id),le=s.cy(o),ce=h.isTileAffectedByFog(J);G&&le.push("PROJECTION_GLOBE_VIEW");const pe=h.getOrCreateProgram("circle",{config:ne,defines:le,overrideFog:ce}),Se=W.layoutVertexBuffer,_e=W.globeExtVertexBuffer,ze=W.indexBuffer,De=z.projection.createInversionMatrix(z,J.canonical),He={programConfiguration:ne,program:pe,layoutVertexBuffer:Se,globeExtVertexBuffer:_e,indexBuffer:ze,uniformValues:s.cz(h,J,ie,De,H,o),tile:ie};if(S){const ye=W.segments.get();for(const Ie of ye)U.push({segments:new s.aB([Ie]),sortKey:Ie.sortKey,state:He})}else U.push({segments:W.segments,sortKey:0,state:He})}S&&U.sort((te,J)=>te.sortKey-J.sortKey);const Y={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(const te of U){const{programConfiguration:J,program:ie,layoutVertexBuffer:W,globeExtVertexBuffer:ne,indexBuffer:le,uniformValues:ce,tile:pe}=te.state,Se=te.segments;h.terrain&&h.terrain.setupElevationDraw(pe,ie,Y),h.uploadCommonUniforms(D,ie,pe.tileID.toUnwrapped()),ie.draw(h,L.TRIANGLES,F,N,$,Ht.disabled,ce,o.id,W,le,Se,o.paint,z.zoom,J,[ne])}},heatmap:function(h,n,o,f){if(o.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,y=_.gl,w=ei.disabled,S=new mi([y.ONE,y.ONE,y.ONE,y.ONE],s.ax.transparent,[!0,!0,!0,!0]);(function(N,$,G,H){const U=N.gl,Y=$.width*H,te=$.height*H;N.activeTexture.set(U.TEXTURE1),N.viewport.set([0,0,Y,te]);let J=G.heatmapFbo;if(!J||J&&(J.width!==Y||J.height!==te)){J&&J.destroy();const ie=U.createTexture();U.bindTexture(U.TEXTURE_2D,ie),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),J=G.heatmapFbo=N.createFramebuffer(Y,te,!0,null),function(W,ne,le,ce,pe,Se){const _e=W.gl;_e.texImage2D(_e.TEXTURE_2D,0,W.extRenderToTextureHalfFloat?_e.RGBA16F:_e.RGBA,pe,Se,0,_e.RGBA,W.extRenderToTextureHalfFloat?_e.HALF_FLOAT:_e.UNSIGNED_BYTE,null),ce.colorAttachment.set(le)}(N,0,ie,J,Y,te)}else U.bindTexture(U.TEXTURE_2D,J.colorAttachment.get()),N.bindFramebuffer.set(J.framebuffer)})(_,h,o,h.transform.projection.name==="globe"?.5:.25),_.clear({color:s.ax.transparent});const I=h.transform,D=I.projection.name==="globe",L=D?["PROJECTION_GLOBE_VIEW"]:[],z=D?Ht.frontCCW:Ht.disabled,F=[s.a5(I.center.lng),s.ae(I.center.lat)];for(let N=0;N<f.length;N++){const $=f[N];if(n.hasRenderableParent($))continue;const G=n.getTile($),H=G.getBucket(o);if(!H||H.projection.name!==I.projection.name)continue;const U=h.isTileAffectedByFog($),Y=H.programConfigurations.get(o.id),te=h.getOrCreateProgram("heatmap",{config:Y,defines:L,overrideFog:U}),{zoom:J}=h.transform;h.terrain&&h.terrain.setupElevationDraw(G,te),h.uploadCommonUniforms(_,te,$.toUnwrapped());const ie=I.projection.createInversionMatrix(I,$.canonical);te.draw(h,y.TRIANGLES,qt.disabled,w,S,z,Xh(h,$,G,ie,F,J,o.paint.get("heatmap-intensity")),o.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,o.paint,h.transform.zoom,Y,D?[H.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,y){const w=_.context,S=w.gl,I=y.heatmapFbo;if(!I)return;w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get()),w.activeTexture.set(S.TEXTURE1);let D=y.colorRampTexture;D||(D=y.colorRampTexture=new s.T(w,y.colorRamp,S.RGBA)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,S.TRIANGLES,qt.disabled,ei.disabled,_.colorModeForRenderPass(),Ht.disabled,((L,z,F,N)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(h,o))},line:function(h,n,o,f){if(h.renderPass!=="translucent")return;const _=o.paint.get("line-opacity"),y=o.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const w=o.paint.get("line-emissive-strength"),S=h.depthModeForSublayer(0,qt.ReadOnly),I=h.colorModeForDrapableLayerRenderPass(w),D=h.terrain&&h.terrain.renderingToTexture?1:s.f.devicePixelRatio,L=o.paint.get("line-dasharray"),z=L.constantOr(1),F=o.layout.get("line-cap"),N=o.paint.get("line-pattern"),$=N.constantOr(1),G=o.paint.get("line-pattern").constantOr(1),H=o.paint.get("line-opacity").constantOr(1)!==1;let U=!G&&H;const Y=o.paint.get("line-gradient"),te=$?"linePattern":"line",J=h.context,ie=J.gl,W=s.cA(o);h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(U=!1);for(const ne of f){const le=n.getTile(ne);if($&&!le.patternsLoaded())continue;const ce=le.getBucket(o);if(!ce)continue;h.prepareDrawTile();const pe=ce.programConfigurations.get(o.id),Se=h.isTileAffectedByFog(ne),_e=h.getOrCreateProgram(te,{config:pe,defines:W,overrideFog:Se}),ze=N.constantOr(null);if(ze&&le.imageAtlas){const it=le.imageAtlas.patternPositions[ze.toString()];it&&pe.setConstantPatternPositions(it)}const De=L.constantOr(null),He=F.constantOr(null);if(!$&&De&&He&&le.lineAtlas){const it=le.lineAtlas.getDash(De,He);it&&pe.setConstantPatternPositions(it)}let[ye,Ie]=o.paint.get("line-trim-offset");(He==="round"||He==="square")&&ye!==Ie&&(ye===0&&(ye-=1),Ie===1&&(Ie+=1));const fe=h.terrain?ne.projMatrix:null,we=$?s.cB(h,le,o,fe,D,[ye,Ie]):s.cC(h,le,o,fe,ce.lineClipsArray.length,D,[ye,Ie]);if(Y){const it=ce.gradients[o.id];let tt=it.texture;if(o.gradientVersion!==it.version){let dt=256;if(o.stepInterpolant){const Pt=n.getSource().maxzoom,Ut=ne.canonical.z===Pt?Math.ceil(1<<h.transform.maxZoom-ne.canonical.z):1;dt=s.aa(s.cD(ce.maxLineLength/s.V*1024*Ut),256,J.maxTextureSize)}it.gradient=s.cE({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:dt,image:it.gradient||void 0,clips:ce.lineClipsArray}),it.texture?it.texture.update(it.gradient):it.texture=new s.T(J,it.gradient,ie.RGBA),it.version=o.gradientVersion,tt=it.texture}J.activeTexture.set(ie.TEXTURE1),tt.bind(o.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}z&&(J.activeTexture.set(ie.TEXTURE0),le.lineAtlasTexture&&le.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),pe.updatePaintBuffers()),$&&(J.activeTexture.set(ie.TEXTURE0),le.imageAtlasTexture&&le.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),pe.updatePaintBuffers()),h.uploadCommonUniforms(J,_e,ne.toUnwrapped());const Ze=it=>{_e.draw(h,ie.TRIANGLES,S,it,I,Ht.disabled,we,o.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,o.paint,h.transform.zoom,pe,[ce.layoutVertexBuffer2])};if(U){const it=h.stencilModeForClipping(ne).ref;it===0&&h.terrain&&J.clear({stencil:0});const tt={func:ie.EQUAL,mask:255};we.u_alpha_discard_threshold=.8,Ze(new ei(tt,it,255,ie.KEEP,ie.KEEP,ie.INVERT)),we.u_alpha_discard_threshold=0,Ze(new ei(tt,it,255,ie.KEEP,ie.KEEP,ie.KEEP))}else Ze(h.stencilModeForClipping(ne))}U&&(h.resetStencilClippingMasks(),h.terrain&&J.clear({stencil:0}))},fill:function(h,n,o,f){const _=o.paint.get("fill-color"),y=o.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const w=o.paint.get("fill-emissive-strength"),S=h.colorModeForDrapableLayerRenderPass(w),I=o.paint.get("fill-pattern"),D=h.opaquePassEnabledForLayer()&&!I.constantOr(1)&&_.constantOr(s.ax.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===D){const L=h.depthModeForSublayer(1,h.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly);na(h,n,o,f,L,S,!1)}if(h.renderPass==="translucent"&&o.paint.get("fill-antialias")){const L=h.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly);na(h,n,o,f,L,S,!0)}},"fill-extrusion":function(h,n,o,f){const _=o.paint.get("fill-extrusion-opacity"),y=h.context,w=y.gl,S=h.terrain,I=S&&S.renderingToTexture;if(_===0)return;const D=h.conflationActive&&h.layerUsedInConflation(o,n.getSource());if(D&&function(L,z,F,N){for(const $ of N){const G=z.getTile($).getBucket(F);G&&(G.updateReplacement($,L.replacementSource),G.uploadCentroid(L.context))}}(h,n,o,f),S||D)for(const L of f){const z=n.getTile(L).getBucket(o);z&&cg(h.context,n,L,z,o,S,D)}if(h.renderPass==="shadow"&&h.shadowRenderer){const L=h.shadowRenderer;if(S&&_<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.Z)return;const z=L.getShadowPassDepthMode(),F=L.getShadowPassColorMode();Dt(h,n,o,f,z,ei.disabled,F,D)}else if(h.renderPass==="translucent"){const L=!o.paint.get("fill-extrusion-pattern").constantOr(1),z=o.paint.get("fill-extrusion-color").constantOr(s.ax.white);if(!I&&z.a!==0){const F=new qt(h.context.gl.LEQUAL,qt.ReadWrite,h.depthRangeFor3D);_===1&&L?Dt(h,n,o,f,F,ei.disabled,mi.unblended,D):(Dt(h,n,o,f,F,ei.disabled,mi.disabled,D),Dt(h,n,o,f,F,h.stencilModeFor3D(),h.colorModeForRenderPass(),D),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&L&&(!S&&h.transform.projection.name!=="globe"||I)){const F=o.paint.get("fill-extrusion-opacity"),N=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),$=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=o.paint.get("fill-extrusion-flood-light-intensity"),H=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),U=N>0&&$>0,Y=G>0,te=(ie,W,ne)=>(1-ne)*ie+ne*W,J=ie=>{const W=h.depthModeForSublayer(1,qt.ReadOnly,w.LEQUAL,!0),ne=o.paint.get(ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),le=te(.1,3,ne),ce=h._showOverdrawInspector;if(!ce){const pe=new ei({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Se=new mi([w.ONE,w.ONE,w.ONE,w.ONE],s.ax.transparent,[!1,!1,!1,!0],w.MIN);Eo(h,n,o,f,W,pe,Se,Ht.disabled,ie,"sdf",F,N,$,G,H,le,D,!1)}{const pe=ce?ei.disabled:new ei({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Se=ce?h.colorModeForRenderPass():new mi([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.ax.transparent,[!0,!0,!0,!0]);Eo(h,n,o,f,W,pe,Se,Ht.disabled,ie,"color",F,N,$,G,H,le,D,!1)}};if(I){const ie=(W,ne,le)=>{const ce=h.depthModeForSublayer(1,qt.ReadOnly,w.LEQUAL,!1),pe=o.paint.get(W?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Se=te(.1,3,pe);{const _e=new mi([w.ONE,w.ONE,w.ONE,w.ONE],s.ax.transparent,[!1,!1,!1,!0]);Eo(h,n,o,f,ce,ei.disabled,_e,Ht.disabled,W,"clear",F,N,$,G,H,Se,D,ne)}{const _e=new ei({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),ze=new mi([w.ONE,w.ONE,w.ONE,w.ONE],s.ax.transparent,[!1,!1,!1,!0],w.MIN);Eo(h,n,o,f,ce,_e,ze,Ht.disabled,W,"sdf",F,N,$,G,H,Se,D,ne)}{const _e=W?w.ZERO:w.ONE_MINUS_DST_ALPHA,ze=new ei({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),De=new mi([_e,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.ax.transparent,[!0,!0,!0,!0]);Eo(h,n,o,f,ce,ze,De,Ht.disabled,W,"color",F,N,$,G,H,Se,D,ne)}{const _e=new mi([w.ONE,w.ONE,w.ONE,W?w.ZERO:w.ONE],s.ax.transparent,[!1,!1,!1,!0],W?w.FUNC_ADD:w.MAX);Eo(h,n,o,f,ce,ei.disabled,_e,Ht.disabled,W,"clear",F,N,$,G,H,Se,D,ne,le)}};if(U||Y){let W;if(h.prepareDrawTile(),S){const ne=S.drapeBufferSize[0],le=S.drapeBufferSize[1];W=S.framebufferCopyTexture,W&&(!W||W.size[0]===ne&&W.size[1]===le)||(W&&W.destroy(),W=S.framebufferCopyTexture=new s.T(y,new s.h({width:ne,height:le}),w.RGBA)),W.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGBA,0,0,ne,le,0)}U&&ie(!0,!1,W),Y&&ie(!1,!0,W)}}else U&&J(!0),Y&&J(!1)}}},hillshade:function(h,n,o,f){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const _=h.context,y=h.terrain&&h.terrain.renderingToTexture,[w,S]=h.renderPass!=="translucent"||y?[{},f]:h.stencilConfigForOverlap(f);for(const I of S){const D=n.getTile(I);if(D.needsHillshadePrepare&&h.renderPass==="offscreen")Oh(h,D,o);else if(h.renderPass==="translucent"){const L=h.depthModeForSublayer(0,qt.ReadOnly),z=o.paint.get("hillshade-emissive-strength"),F=h.colorModeForDrapableLayerRenderPass(z),N=y&&h.terrain?h.terrain.stencilModeForRTTOverlap(I):w[I.overscaledZ];su(h,I,D,o,L,N,F)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,n,o,f,_,y){if(h.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const w=h.transform.projection.name==="globe",S=o.paint.get("raster-elevation")!==0,I=S&&w;if(h.renderElevatedRasterBackface&&!I)return;const D=h.context,L=D.gl,z=n.getSource(),F=function(W,ne,le,ce){const pe=ne.paint.get("raster-color"),Se=W.type==="raster-array",_e=[],ze=ne.paint.get("raster-resampling"),De=ne.paint.get("raster-color-mix");let He=ne.paint.get("raster-color-range");const ye=[De[0],De[1],De[2],0],Ie=De[3];let fe=ze==="nearest"?ce.NEAREST:ce.LINEAR;if(Se&&(_e.push("RASTER_ARRAY"),pe||_e.push("RASTER_COLOR"),ze==="linear"&&_e.push("RASTER_ARRAY_LINEAR"),fe=ce.NEAREST,!He&&W.rasterLayers)){const we=W.rasterLayers.find(({id:Ze})=>Ze===ne.sourceLayer);we&&we.fields&&we.fields.range&&(He=we.fields.range)}if(He=He||[0,1],pe){_e.push("RASTER_COLOR"),le.activeTexture.set(ce.TEXTURE2),ne.updateColorRamp(He);let we=ne.colorRampTexture;we||(we=ne.colorRampTexture=new s.T(le,ne.colorRamp,ce.RGBA)),we.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}return{mix:ye,range:He,offset:Ie,defines:_e,resampling:fe}}(z,o,D,L);if(z instanceof s.ap&&!f.length&&!w)return;const N=o.paint.get("raster-emissive-strength"),$=h.colorModeForDrapableLayerRenderPass(N),G=h.terrain&&h.terrain.renderingToTexture,H=!h.options.moving,U=o.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(z instanceof s.ap&&!f.length&&(z.onNorthPole||z.onSouthPole)){const W=S?h.stencilModeFor3D():ei.disabled;return void Qh(!!z.onNorthPole,null,h,n,o,N,F,Ht.disabled,W)}if(!f.length)return;const[Y,te]=z instanceof s.ap||G?[{},f]:h.stencilConfigForOverlap(f),J=te[te.length-1].overscaledZ;I&&F.defines.push("PROJECTION_GLOBE_VIEW"),S&&F.defines.push("RENDER_CUTOFF");const ie=(W,ne,le)=>{for(const ce of W){const pe=ce.toUnwrapped(),Se=n.getTile(ce);if(G&&(!Se||!Se.hasData()))continue;D.activeTexture.set(L.TEXTURE0);const _e=td(Se,z,o,F);if(!_e||!_e.texture)continue;const{texture:ze,mix:De,offset:He,tileSize:ye,buffer:Ie}=_e;let fe,we;G?(fe=qt.disabled,we=ce.projMatrix):S?(fe=new qt(L.LEQUAL,qt.ReadWrite,h.depthRangeFor3D),we=w?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(pe,H)):(fe=h.depthModeForSublayer(ce.overscaledZ-J,o.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,L.LESS),we=h.transform.calculateProjMatrix(pe,H));const Ze=h.terrain&&G?h.terrain.stencilModeForRTTOverlap(ce):Y[ce.overscaledZ],it=y?0:o.paint.get("raster-fade-duration");Se.registerFadeDuration(it);const tt=n.findLoadedParent(ce,0),dt=Vh(Se,tt,n,h.transform,it);let Pt,Ut;h.terrain&&h.terrain.prepareDrawTile(),D.activeTexture.set(L.TEXTURE0),ze.bind(U,L.CLAMP_TO_EDGE),D.activeTexture.set(L.TEXTURE1),tt?(tt.texture&&tt.texture.bind(U,L.CLAMP_TO_EDGE),Pt=Math.pow(2,tt.tileID.overscaledZ-Se.tileID.overscaledZ),Ut=[Se.tileID.canonical.x*Pt%1,Se.tileID.canonical.y*Pt%1]):ze.bind(U,L.CLAMP_TO_EDGE),ze.useMipmap&&D.extTextureFilterAnisotropic&&h.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const zt=h.transform;let Bt;const li=S?ed(zt):[0,0,0,0];let Jt,ri,ni,Ai,rn,yi=0;if(I&&z instanceof s.ap&&z.coordinates.length>3)Jt=Float32Array.from(s.aT(s.ci(new s.bs(0,0,0)))),ri=Float32Array.from(zt.globeMatrix),ni=Float32Array.from(s.ce(zt)),Ai=[s.a5(zt.center.lng),s.ae(zt.center.lat)],Bt=z.elevatedGlobePerspectiveTransform,rn=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const vi=s.cf(ce.canonical);yi=s.cg(vi.getCenter().lat),Jt=Float32Array.from(s.aT(s.ci(ce.canonical))),ri=Float32Array.from(zt.globeMatrix),ni=Float32Array.from(s.ce(zt)),Ai=[s.a5(zt.center.lng),s.ae(zt.center.lat)],Bt=[0,0],rn=Float32Array.from(s.ch(ce.canonical,vi,yi,zt.worldSize/zt._pixelsPerMercatorPixel))}else Bt=z instanceof s.ap?z.perspectiveTransform:[0,0],Jt=new Float32Array(16),ri=new Float32Array(9),ni=new Float32Array(16),Ai=[0,0],rn=new Float32Array(9);const Tn=Yh(we,Jt,ri,ni,rn,Ut||[0,0],s.S(h.transform.zoom),Ai,li,Pt||1,dt,o,Bt,S?o.paint.get("raster-elevation"):0,2,De,He,F.range,ye,Ie,N),xi=h.isTileAffectedByFog(ce),zi=h.getOrCreateProgram("raster",{defines:F.defines,overrideFog:xi});if(h.uploadCommonUniforms(D,zi,pe),z instanceof s.ap){const vi=z.elevatedGlobeVertexBuffer,Di=z.elevatedGlobeIndexBuffer;if(G||!w)z.boundsBuffer&&z.boundsSegments&&zi.draw(h,L.TRIANGLES,fe,ei.disabled,$,Ht.disabled,Tn,o.id,z.boundsBuffer,h.quadTriangleIndexBuffer,z.boundsSegments);else if(vi&&Di){const ln=zt.zoom<=s.bG?z.elevatedGlobeSegments:z.getSegmentsForLongitude(zt.center.lng);ln&&zi.draw(h,L.TRIANGLES,fe,ei.disabled,$,ne,Tn,o.id,vi,Di,ln)}}else if(I){fe=new qt(L.LEQUAL,qt.ReadOnly,h.depthRangeFor3D);const vi=h.globeSharedBuffers;if(vi){const[Di,ln,Vi]=vi.getGridBuffers(yi,!1);zi.draw(h,L.TRIANGLES,fe,le||Ze,h.colorModeForRenderPass(),ne,Tn,o.id,Di,ln,Vi)}}else{const{tileBoundsBuffer:vi,tileBoundsIndexBuffer:Di,tileBoundsSegments:ln}=h.getTileBoundsBuffers(Se);zi.draw(h,L.TRIANGLES,fe,Ze,$,Ht.disabled,Tn,o.id,vi,Di,ln)}}if(!(z instanceof s.ap)&&I)for(const ce of W){const pe=ce.canonical.y===(1<<ce.canonical.z)-1;ce.canonical.y===0&&Qh(!0,ce,h,n,o,N,F,ne,le||ei.disabled),pe&&Qh(!1,ce,h,n,o,N,F,ne===Ht.frontCW?Ht.backCW:Ht.frontCW,le||ei.disabled)}};I?ie(te,h.renderElevatedRasterBackface?Ht.backCW:Ht.frontCW,h.stencilModeFor3D()):ie(te,Ht.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,n,o,f,_,y){h.renderPass==="offscreen"&&function(w,S,I,D){if(!D.length)return;const L=w.context,z=L.gl,F=S.getSource();if(!(F instanceof st))return;const N=[];for(const H of D){const U=S.getTile(H);if(!(U instanceof Xo))continue;const Y=id(U,F,I);if(!Y)continue;const te=[Y.tileSize,Y.tileSize];let J=I.tileFramebuffer;J||(J=I.tileFramebuffer=L.createFramebuffer(te[0],te[1],!0,null));let ie=U.rasterParticleState;const W=I.paint.get("raster-particle-count");ie||(ie=U.rasterParticleState=new Gn(L,H,te,W));const ne=ie.update(I.lastInvalidatedAt);ie.numParticles!==W&&ie.setNumParticles(H,W);const le=ie.targetColorTexture;ie.targetColorTexture=ie.backgroundColorTexture,ie.backgroundColorTexture=le;const ce=ie.particleVertices0;ie.particleVertices0=ie.particleVertices1,ie.particleVertices1=ce,N.push([H,Y,ie,ne])}if(N.length===0)return;const $=s.f.now(),G=I.previousDrawTimestamp?.001*($-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=$,I.hasColorMap()){L.activeTexture.set(z.TEXTURE0+2);let H=I.colorRampTexture;H||(H=I.colorRampTexture=new s.T(L,I.colorRamp,z.RGBA)),H.bind(z.LINEAR,z.CLAMP_TO_EDGE)}L.bindFramebuffer.set(I.tileFramebuffer.framebuffer),L.activeTexture.set(z.TEXTURE0),function(H,U,Y){const te=H.context,J=te.gl,ie=U.tileFramebuffer;te.activeTexture.set(J.TEXTURE0);const W={u_texture:0,u_opacity:1.05*(le=U.paint.get("raster-particle-fade-opacity-factor"))/(le+.05)},ne=H.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var le;for(const ce of Y){const[,,pe,Se]=ce;ie.colorAttachment.set(pe.targetColorTexture.texture),te.viewport.set([0,0,ie.width,ie.height]),te.clear({color:s.ax.transparent}),Se&&(pe.backgroundColorTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE),ne.draw(H,J.TRIANGLES,qt.disabled,ei.disabled,mi.alphaBlended,Ht.disabled,W,U.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments))}}(w,I,N),function(H,U,Y,te){const J=H.context.gl,ie=Y.tileFramebuffer,W=H.transform.projection.name==="globe",ne=Y.paint.get("raster-particle-max-speed");for(const le of te){const[ce,pe,Se]=le;pe.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ie.colorAttachment.set(Se.targetColorTexture.texture);const _e=H.getOrCreateProgram("rasterParticleDraw",{defines:pe.defines,overrideFog:!1}),ze=pe.scalarData?[]:[0,1,2,3].map(ye=>s.cG[ye](ce));ze.push(ce);const De=ce.canonical.x,He=ce.canonical.y;for(const ye of ze){const Ie=U.getTile(W?ye.wrapped():ye);if(!Ie)continue;const fe=Ie.rasterParticleState;if(!fe)continue;const we=ag([ye.canonical.x+(1<<ye.canonical.z)*(ye.wrap-ce.wrap)-De,ye.canonical.y-He],0,pe.texture.size,2,ne,pe.textureOffset,pe.scale,pe.offset);_e.draw(H,J.POINTS,qt.disabled,ei.disabled,mi.alphaBlended,Ht.disabled,we,Y.id,fe.particleVertices0,void 0,fe.particleSegment)}}}(w,S,I,N),function(H,U,Y,te){const J=H.context.gl;let ie=U.transformFeedbackObject;ie||(ie=U.transformFeedbackObject=J.createTransformFeedback()),J.bindTransformFeedback(J.TRANSFORM_FEEDBACK,U.transformFeedbackObject);const W=U.paint.get("raster-particle-max-speed"),ne=te*U.paint.get("raster-particle-speed-factor")*.3,le=(ce=U.paint.get("raster-particle-reset-rate-factor"),Math.pow(ce,6));var ce;for(const pe of Y){const[,Se,_e]=pe;Se.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const ze=fp(0,Se.texture.size,W,ne,le,Se.textureOffset,Se.scale,Se.offset);H.getOrCreateProgram("rasterParticleUpdate",{defines:Se.defines,transformFeedback:{bufferMode:J.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(H,J.POINTS,qt.disabled,ei.disabled,mi.disabled,Ht.disabled,ze,U.id,_e.particleVertices0,void 0,_e.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:_e.particleVertices1,targetIndex:0}])}J.bindTransformFeedback(J.TRANSFORM_FEEDBACK,null)}(w,I,N,G)}(h,n,o,f),h.renderPass==="translucent"&&(function(w,S,I,D,L){const z=w.context,F=z.gl,N=!w.options.moving,$=w.transform.projection.name==="globe";if(!D.length)return;const[G,H]=w.stencilConfigForOverlap(D),U=[];$&&U.push("PROJECTION_GLOBE_VIEW");for(const Y of H){const te=Y.toUnwrapped(),J=S.getTile(Y);if(!J.rasterParticleState)continue;const ie=J.rasterParticleState,W=100;J.registerFadeDuration(W);const ne=S.findLoadedParent(Y,0),le=Vh(J,ne,S,w.transform,W);let ce,pe;w.terrain&&w.terrain.prepareDrawTile(),z.activeTexture.set(F.TEXTURE0),ie.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),z.activeTexture.set(F.TEXTURE1),ne&&ne.rasterParticleState?(ne.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),ce=Math.pow(2,ne.tileID.overscaledZ-J.tileID.overscaledZ),pe=[J.tileID.canonical.x*ce%1,J.tileID.canonical.y*ce%1]):ie.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Se=$?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(te,N),_e=w.transform,ze=nd(_e),De=s.cf(Y.canonical),He=s.cg(De.getCenter().lat);let ye,Ie,fe,we,Ze;$?(ye=Float32Array.from(s.aT(s.ci(Y.canonical))),Ie=Float32Array.from(_e.globeMatrix),fe=Float32Array.from(s.ce(_e)),we=[s.a5(_e.center.lng),s.ae(_e.center.lat)],Ze=Float32Array.from(s.ch(Y.canonical,De,He,_e.worldSize/_e._pixelsPerMercatorPixel))):(ye=new Float32Array(16),Ie=new Float32Array(9),fe=new Float32Array(16),we=[0,0],Ze=new Float32Array(9));const it=og(Se,ye,Ie,fe,Ze,pe||[0,0],s.S(w.transform.zoom),we,ze,ce||1,le,250),tt=w.isTileAffectedByFog(Y),dt=w.getOrCreateProgram("rasterParticle",{defines:U,overrideFog:tt});if(w.uploadCommonUniforms(z,dt,te),$){const Pt=new qt(F.LEQUAL,qt.ReadWrite,w.depthRangeFor3D),Ut=0,zt=w.globeSharedBuffers;if(zt){const[Bt,li,Jt]=zt.getGridBuffers(He,Ut!==0);dt.draw(w,F.TRIANGLES,Pt,ei.disabled,mi.alphaBlended,Ht.backCCW,it,I.id,Bt,li,Jt)}}else{const Pt=w.depthModeForSublayer(0,qt.ReadOnly),Ut=G[Y.overscaledZ],{tileBoundsBuffer:zt,tileBoundsIndexBuffer:Bt,tileBoundsSegments:li}=w.getTileBoundsBuffers(J);dt.draw(w,F.TRIANGLES,Pt,Ut,mi.alphaBlended,Ht.disabled,it,I.id,zt,Bt,li)}}w.resetStencilClippingMasks()}(h,n,o,f),h.style.map.triggerRepaint())},background:function(h,n,o,f){const _=o.paint.get("background-color"),y=o.paint.get("background-opacity"),w=o.paint.get("background-emissive-strength");if(y===0)return;const S=h.context,I=S.gl,D=h.transform,L=D.tileSize,z=o.paint.get("background-pattern");if(h.isPatternMissing(z,o.scope))return;const F=!z&&_.a===1&&y===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==F)return;const N=ei.disabled,$=h.depthModeForSublayer(0,F==="opaque"?qt.ReadWrite:qt.ReadOnly),G=h.colorModeForDrapableLayerRenderPass(w),H=z?"backgroundPattern":"background";let U,Y=f;Y||(U=h.getBackgroundTiles(),Y=Object.values(U).map(te=>te.tileID)),z&&(S.activeTexture.set(I.TEXTURE0),h.imageManager.bind(h.context,o.scope));for(const te of Y){const J=h.isTileAffectedByFog(te),ie=h.getOrCreateProgram(H,{overrideFog:J}),W=te.toUnwrapped(),ne=f?te.projMatrix:h.transform.calculateProjMatrix(W);h.prepareDrawTile();const le=n?n.getTile(te):U?U[te.key]:new _o(te,L,D.zoom,h),ce=z?Ul(ne,w,y,h,z,o.scope,{tileID:te,tileSize:L}):Kh(ne,w,y,_);h.uploadCommonUniforms(S,ie,W);const{tileBoundsBuffer:pe,tileBoundsIndexBuffer:Se,tileBoundsSegments:_e}=h.getTileBoundsBuffers(le);ie.draw(h,I.TRIANGLES,$,N,G,Ht.disabled,ce,o.id,pe,Se,_e)}},sky:function(h,n,o){const f=h._atmosphere?s.S(h.transform.zoom):1,_=o.paint.get("sky-opacity")*f;if(_===0)return;const y=h.context,w=o.paint.get("sky-type"),S=new qt(y.gl.LEQUAL,qt.ReadOnly,[0,1]),I=h.frameCounter/1e3%1;w==="atmosphere"?h.renderPass==="offscreen"?o.needsSkyboxCapture(h)&&(function(D,L,z,F){const N=D.context,$=N.gl;let G=L.skyboxFbo;if(!G){G=L.skyboxFbo=N.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new ld(N),L.skyboxTexture=N.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,L.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let te=0;te<6;++te)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(G.framebuffer),N.viewport.set([0,0,32,32]);const H=L.getCenter(D,!0),U=D.getOrCreateProgram("skyboxCapture"),Y=new Float64Array(16);s.a6.identity(Y),s.a6.rotateY(Y,Y,.5*-Math.PI),ra(D,L,U,Y,H,0),s.a6.identity(Y),s.a6.rotateY(Y,Y,.5*Math.PI),ra(D,L,U,Y,H,1),s.a6.identity(Y),s.a6.rotateX(Y,Y,.5*-Math.PI),ra(D,L,U,Y,H,2),s.a6.identity(Y),s.a6.rotateX(Y,Y,.5*Math.PI),ra(D,L,U,Y,H,3),s.a6.identity(Y),ra(D,L,U,Y,H,4),s.a6.identity(Y),s.a6.rotateY(Y,Y,Math.PI),ra(D,L,U,Y,H,5),N.viewport.set([0,0,D.width,D.height])}(h,o),o.markSkyboxValid(h)):h.renderPass==="sky"&&function(D,L,z,F,N){const $=D.context,G=$.gl,H=D.transform,U=D.getOrCreateProgram("skybox");$.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,L.skyboxTexture);const Y=((te,J,ie,W,ne)=>({u_matrix:te,u_sun_direction:J,u_cubemap:0,u_opacity:W,u_temporal_offset:ne}))(H.skyboxMatrix,L.getCenter(D,!1),0,F,N);D.uploadCommonUniforms($,U),U.draw(D,G.TRIANGLES,z,ei.disabled,D.colorModeForRenderPass(),Ht.backCW,Y,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(h,o,S,_,I):w==="gradient"&&h.renderPass==="sky"&&function(D,L,z,F,N){const $=D.context,G=$.gl,H=D.transform,U=D.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new ld($)),$.activeTexture.set(G.TEXTURE0);let Y=L.colorRampTexture;Y||(Y=L.colorRampTexture=new s.T($,L.colorRamp,G.RGBA)),Y.bind(G.LINEAR,G.CLAMP_TO_EDGE);const te=((J,ie,W,ne,le)=>({u_matrix:J,u_color_ramp:0,u_center_direction:ie,u_radius:s.bj(W),u_opacity:ne,u_temporal_offset:le}))(H.skyboxMatrix,L.getCenter(D,!1),L.paint.get("sky-gradient-radius"),F,N);D.uploadCommonUniforms($,U),U.draw(D,G.TRIANGLES,z,ei.disabled,D.colorModeForRenderPass(),Ht.backCW,te,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(h,o,S,_,I)},debug:function(h,n,o,f,_,y){for(let w=0;w<o.length;w++)if(_){const D=new s.ax(f.r*.8,f.g*.8,f.b*.8,1);Io(h,n,o[w],f,-1,-1,y),Io(h,n,o[w],f,-1,1,y),Io(h,n,o[w],f,1,1,y),Io(h,n,o[w],f,1,-1,y),Io(h,n,o[w],D,0,0,y)}else Io(h,n,o[w],f,0,0,y)},custom:function(h,n,o,f){const _=h.context,y=o.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&o.isLayerDraped(n)){if(h.renderPass==="offscreen"){const w=y.prerender;if(w){if(h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const S=h.transform.pointMerc;w.call(y,_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.S(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else w.call(y,_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const S=y.renderToTile;if(S){const I=f[0].canonical,D=new s.L(I.x+f[0].wrap*(1<<I.z),I.y,I.z);_.setDepthMode(qt.disabled),_.setStencilMode(ei.disabled),_.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),S.call(y,_.gl,D),_.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),_.setStencilMode(ei.disabled);const w=y.renderingMode==="3d"?new qt(h.context.gl.LEQUAL,qt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,qt.ReadOnly);if(_.setDepthMode(w),h.transform.projection.name==="globe"){const S=h.transform.pointMerc;y.render(_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.S(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else y.render(_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState(),_.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,n,o,f){if(h.renderPass==="opaque")return;const _=o.paint.get("model-opacity");if(_===0)return;const y=o.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!y||h.terrain&&_<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof s.Z))return;const w=h.shadowRenderer,S=o.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,S||(w.enabled=!1));const I=()=>{w&&(w.useNormalOffset=!0,S||(w.enabled=!0))},D=n.getSource();if(h.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(U,Y,te,J){const ie=U.transform;if(ie.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${ie.projection.name} projection is not yet implemented`);const W=ie.getFreeCameraOptions().position;if(!U.modelManager)return;const ne=U.modelManager;te.modelManager=ne;const le=U.shadowRenderer;if(!te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ce=te._unevaluatedLayout._values["model-id"],pe={...te.layout.get("model-id").parameters};for(const Se of J){const _e=Y.getTile(Se).getBucket(te);if(!_e||_e.projection.name!==ie.projection.name)continue;const ze=vp(Se,ie);pe.zoom=ze;const De=ce.possiblyEvaluate(pe);if(cd(U,_e,Se),Yr.shadowUniformsInitialized=!1,Yr.useSingleShadowCascade=!!le&&le.getMaxCascadeForTile(Se.toUnwrapped())===0,U.renderPass==="shadow"&&le){if(U.currentShadowCascade===1&&_e.isInsideFirstShadowMapFrustum)continue;const Ie=ie.calculatePosMatrix(Se.toUnwrapped(),ie.worldSize);if(Yr.tileMatrix.set(Ie),Yr.shadowTileMatrix=Float32Array.from(le.calculateShadowPassMatrixFromMatrix(Ie)),Yr.aabb.min.fill(0),Yr.aabb.max[0]=Yr.aabb.max[1]=s.V,Yr.aabb.max[2]=0,dg(_e,Yr,U,te.scope))continue}const He=1<<Se.canonical.z,ye=[((W.x-Se.wrap)*He-Se.canonical.x)*s.V,(W.y*He-Se.canonical.y)*s.V,W.z*He*s.V];for(let Ie in _e.instancesPerModel){const fe=_e.instancesPerModel[Ie];fe.features.length>0&&(Ie=De.evaluate(fe.features[0].feature,{}));const we=ne.getModel(Ie,te.scope);if(we&&we.uploaded)for(const Ze of we.nodes)ud(U,te,Ze,fe,ye,Se,Yr)}}}(h,n,o,f),void I();if(!D.loaded())return;if(D.type==="batched-model")return function(U,Y,te,J){te.resetLayerRenderingStats(U);const ie=U.context,W=U.transform,ne=U.style.fog,le=U.shadowRenderer;if(W.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${W.projection.name} projection is not yet implemented`);const ce=U.transform.getFreeCameraOptions().position,pe=s.N.scale([],[ce.x,ce.y,ce.z],U.transform.worldSize);s.N.negate(pe,pe);const Se=s.a6.identity([]),_e=s.cR(W.center.lat,W.zoom),ze=s.a6.fromScaling([],[1,1,1/_e]);s.a6.translate(Se,Se,pe);const De=te.paint.get("model-opacity"),He=new qt(ie.gl.LEQUAL,qt.ReadWrite,U.depthRangeFor3D),ye=new qt(ie.gl.LEQUAL,qt.ReadOnly,U.depthRangeFor3D),Ie=new s.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),fe=U.renderPass==="shadow",we=fe&&le?le.getCurrentCascadeFrustum():W.getFrustum(W.scaleZoom(W.worldSize)),Ze=te.getLayerRenderingStats(),it=function(tt,dt){for(const Pt of J){const Ut=Y.getTile(Pt).getBucket(te);if(!Ut||!Ut.uploaded)continue;let zt=!1;le&&(zt=le.getMaxCascadeForTile(Pt.toUnwrapped())===0);const Bt=W.calculatePosMatrix(Pt.toUnwrapped(),W.worldSize),li=Ut.modelTraits;for(const Jt of Ut.getNodesInfo()){if(Jt.hiddenByReplacement||!Jt.node.meshes)continue;const ri=Jt.evaluatedScale,ni=Jt.node;let Ai=0;if(U.terrain&&ni.elevation&&(Ai=ni.elevation*U.terrain.exaggeration()),ri[0]<=1&&ri[1]<=1&&ri[2]<=1&&(()=>{const ln=Jt.getLocalBounds();return Ie.min=[...ln.min],Ie.max=[...ln.max],Ie.min[2]+=Ai,Ie.max[2]+=Ai,s.N.transformMat4(Ie.min,Ie.min,Bt),s.N.transformMat4(Ie.max,Ie.max,Bt),Ie})().intersects(we)===0)continue;const rn=U.renderPass==="light-beam",yi=[...Bt];s.a6.translate(yi,yi,[(ni.anchor?ni.anchor[0]:0)*(ri[0]-1),(ni.anchor?ni.anchor[1]:0)*(ri[1]-1),Ai]),s.N.exactEquals(ri,s.cT)||s.a6.scale(yi,yi,ri),s.a6.multiply(yi,yi,ni.matrix);const Tn=s.a6.multiply([],ze,yi);s.a6.multiply(Tn,Se,Tn);const xi=s.a6.invert([],Tn);s.a6.transpose(xi,xi),s.a6.scale(xi,xi,$a);const zi=s.a6.multiply([],W.expandedFarZProjMatrix,yi),vi=li&s.cV.HasMapboxMeshFeatures,Di=vi?0:Jt.evaluatedRMEA[0][2];for(let ln=0;ln<ni.meshes.length;++ln){const Vi=ni.meshes[ln],er=ln===ni.lightMeshIndex;if(er){if(!rn&&!U.terrain&&U.shadowRenderer){U.currentLayer<U.firstLightBeamLayer&&(U.firstLightBeamLayer=U.currentLayer);continue}}else if(rn)continue;const _r={defines:[]},Vr=[];if(wn(_r.defines,Vr,Vi,U),vi||_r.defines.push("DIFFUSE_SHADED"),zt&&_r.defines.push("SHADOWS_SINGLE_CASCADE"),Ze&&(fe?Ze.numRenderedVerticesInShadowPass+=Vi.vertexArray.length:Ze.numRenderedVerticesInTransparentPass+=Vi.vertexArray.length),fe){Te(Vi,yi,U,te);continue}let Ns=null;if(ne){const jr=sa(yi,U.transform);if(Ns=new Float32Array(jr),W.projection.name!=="globe"){const Vs=Vi.aabb.min,Ro=Vi.aabb.max,[aa,cc]=ne.getOpacityForBounds(jr,Vs[0],Vs[1],Ro[0],Ro[1]);_r.overrideFog=aa>=qi||cc>=qi}}const Ur=Vi.material;let tr;Ur.occlusionTexture&&Ur.occlusionTexture.offsetScale&&(tr=Ur.occlusionTexture.offsetScale,_r.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!fe&&le&&(le.useNormalOffset=!!Vi.normalBuffer);const qn=U.getOrCreateProgram("model",_r);!fe&&le&&le.setupShadowsFromMatrix(yi,qn,le.useNormalOffset),U.uploadCommonUniforms(ie,qn,Pt.toUnwrapped(),Ns);const Ir=Ur.pbrMetallicRoughness;Ir.metallicFactor=.9,Ir.roughnessFactor=.5;const zr=hu(new Float32Array(zi),new Float32Array(Tn),new Float32Array(xi),U,De,Ir.baseColorFactor,Ur.emissiveFactor,Ir.metallicFactor,Ir.roughnessFactor,Ur,Di,te,[0,0,0],tr);qn.draw(U,ie.gl.TRIANGLES,dt&&!er?He:ye,ei.disabled,tt?er||De<1||Jt.hasTranslucentParts?mi.alphaBlended:mi.unblended:mi.disabled,Ht.backCCW,zr,te.id,Vi.vertexBuffer,Vi.indexBuffer,Vi.segments,te.paint,U.transform.zoom,void 0,Vr)}}}};(function(tt,dt,Pt,Ut){const zt=tt.terrain?tt.terrain.exaggeration():0,Bt=tt.transform.zoom;for(const li of Ut){const Jt=dt.getTile(li).getBucket(Pt);Jt&&(tt.conflationActive&&Jt.updateReplacement(li,tt.replacementSource),Jt.evaluateScale(tt,Pt),tt.terrain&&zt>0&&Jt.elevationUpdate(tt.terrain,zt,li,Pt.source),Jt.needsReEvaluation(tt,Bt,Pt)&&Jt.evaluate(Pt))}})(U,Y,te,J),De===1?it(!0,!0):(it(!1,!0),it(!0,!1))}(h,n,o,f),void I();const L=D.getModels(),z=[],F=h.transform.getFreeCameraOptions().position,N=s.N.scale([],[F.x,F.y,F.z],h.transform.worldSize);s.N.negate(N,N);const $=[],G=[];let H=0;for(const U of L){const Y=o.paint.get("model-rotation").constantOr(null),te=o.paint.get("model-scale").constantOr(null),J=o.paint.get("model-translation").constantOr(null);U.computeModelMatrix(h,Y,te,J,!0,!0,!1);const ie=s.a6.identity([]),W=s.cR(U.position.lat,h.transform.zoom),ne=s.a6.fromScaling([],[1,1,1/W]);s.a6.translate(ie,ie,N),z.push({zScaleMatrix:ne,negCameraPosMatrix:ie});for(const le of U.nodes)Wl(h.transform,le,U.matrix,h.transform.expandedFarZProjMatrix,H,$,G);H++}if($.sort((U,Y)=>Y.depth-U.depth),h.renderPass!=="shadow"){if(_===1)for(const U of G)Hl(U,h,o,z[U.modelIndex],ei.disabled,h.colorModeForRenderPass());else{for(const U of G)Hl(U,h,o,z[U.modelIndex],ei.disabled,mi.disabled);for(const U of G)Hl(U,h,o,z[U.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const U of $)Hl(U,h,o,z[U.modelIndex],ei.disabled,h.colorModeForRenderPass());I()}else{for(const U of G)Te(U.mesh,U.nodeModelMatrix,h,o);for(const U of $)Te(U.mesh,U.nodeModelMatrix,h,o);I()}}},hd={model:function(h,n,o){const f=h.scope,_=n.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,f));if(_.type==="batched-model")return;const y=_.getModels();for(const w of y)w.upload(o.context)},raster:function(h,n,o){const f=n.getSource();if(!(f instanceof st&&f.loaded()))return;const _=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const y=h.paint.get("raster-array-band")||f.getInitialBand(_);if(y==null)return;const w=n.getIds().map(S=>n.getTileByID(S));for(const S of w)S.updateNeeded(_,y)&&f.prepareTile(S,_,y)},"raster-particle":function(h,n,o){const f=n.getSource();if(!(f instanceof st&&f.loaded()))return;const _=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const y=h.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(y==null)return;const w=n.getIds().map(S=>n.getTileByID(S));for(const S of w)S.updateNeeded(_,y)&&f.prepareTile(S,_,y)}};class wp{constructor(n,o,f,_){this.context=new qf(n,o),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._debugParams={showTerrainProxyTiles:!1},_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=bs.maxUnderzooming+bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ih(this),this._wireframeDebugCache=new bp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(n,o){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new sg(this,n));const _=this._terrain;this.transform.elevation=f?_:null,_.update(n,this.transform,o),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(n){const o=n.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=o.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const y=f+.78*(_-f);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,o){if(this.width=n*s.f.devicePixelRatio,this.height=o*s.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const n=this.context,o=new s.aN;o.emplaceBack(0,0),o.emplaceBack(s.V,0),o.emplaceBack(0,s.V),o.emplaceBack(s.V,s.V),this.tileExtentBuffer=n.createVertexBuffer(o,s.aP.members),this.tileExtentSegments=s.aB.simpleSegment(0,0,4,2);const f=new s.aN;f.emplaceBack(0,0),f.emplaceBack(s.V,0),f.emplaceBack(0,s.V),f.emplaceBack(s.V,s.V),this.debugBuffer=n.createVertexBuffer(f,s.aP.members),this.debugSegments=s.aB.simpleSegment(0,0,4,5);const _=new s.aN;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,s.aP.members),this.viewportSegments=s.aB.simpleSegment(0,0,4,2);const y=new s.av;y.emplaceBack(0,0,0,0),y.emplaceBack(s.V,0,s.V,0),y.emplaceBack(0,s.V,0,s.V),y.emplaceBack(s.V,s.V,s.V,s.V),this.mercatorBoundsBuffer=n.createVertexBuffer(y,s.aR.members),this.mercatorBoundsSegments=s.aB.simpleSegment(0,0,4,2);const w=new s.aw;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const S=new s.aO;for(const D of[0,1,3,2,0])S.emplaceBack(D);this.debugIndexBuffer=n.createIndexBuffer(S),this.emptyTexture=new s.T(n,new s.h({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=s.a6.create();const I=this.context.gl;this.stencilClearMode=new ei({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,qt.disabled,this.stencilClearMode,mi.disabled,Ht.disabled,Nh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,o,f){if(!o||this.currentStencilSource===o.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const I of f)if(this._tileClippingMaskIDs[I.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=o.id;const _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(mi.disabled),_.setDepthMode(qt.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of f){const I=o.getTile(S),D=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:z,tileBoundsSegments:F}=this.getTileBoundsBuffers(I);w.draw(this,y.TRIANGLES,qt.disabled,new ei({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),mi.disabled,Ht.disabled,Nh(S.projMatrix),"$clipping",L,z,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,o=this.context.gl;return new ei({func:o.NOTEQUAL,mask:255},n,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const o=this.context.gl;return new ei({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(n){const o=this.context.gl,f=n.sort((w,S)=>S.overscaledZ-w.overscaledZ),_=f[f.length-1].overscaledZ,y=f[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let S=0;S<y;S++)w[S+_]=new ei({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[w,f]}return[{[_]:ei.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new mi([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mi.unblended:mi.alphaBlended}colorModeForDrapableLayerRenderPass(n){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new mi([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new s.ax(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,o,f,_=!1){if(!this.opaquePassEnabledForLayer()&&!_)return qt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new qt(f||this.context.gl.LEQUAL,o,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,o){this._wireframeDebugCache.update(this.frameCounter),this.style=n,this.options=o;const f=this.style._mergedLayers,_=this.style.order,y=_.map(W=>f[W]),w=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.f.now()),this.imageManager.beginFrame();let S=0,I=!1;for(const W in w){const ne=w[W];ne.used&&(ne.prepare(this.context),ne.getSource().usedInConflation&&++S)}for(const W of y)W.isHidden(this.transform.zoom)||this.prepareLayer(W);const D={},L={},z={},F={},N={};for(const W in w){const ne=w[W];D[W]=ne.getVisibleCoordinates(),L[W]=D[W].slice().reverse(),z[W]=ne.getVisibleCoordinates(!0).reverse(),F[W]=ne.getShadowCasterCoordinates(),N[W]=ne.sortCoordinatesByDistance(D[W])}const $=W=>{const ne=this.style.getLayerSourceCache(W);return ne&&ne.used?ne.getSource():null};if(S){const W=[];for(const ne of y)this.layerUsedInConflation(ne,$(ne))&&W.push(ne);if(W&&W.length>1){const ne=[];for(const le of W){const ce=this.style.getLayerSourceCache(le);ce&&ce.used&&ce.getSource().usedInConflation&&ne.push({layer:le.fqid,cache:ce})}this.replacementSource.setSources(ne),I=!0}}I||this.replacementSource.clear(),this.conflationActive=I,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const W of y){const ne=W.cutoffRange();if(this.longestCutoffRange=Math.max(ne,this.longestCutoffRange),ne>0){const le=$(W);le&&(this.minCutoffZoom=Math.max(le.minzoom,this.minCutoffZoom)),W.minzoom&&(this.minCutoffZoom=Math.max(W.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let W=0;W<y.length;W++)if(y[W].is3D()){this.opaquePassCutoff=W;break}const G=this.style&&this.style.fog;G?(this._fogVisible=G.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=G.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(z),this.opaquePassCutoff=0);const H=this._shadowRenderer;if(H){H.updateShadowParameters(this.transform,this.style.directionalLight);for(const W in w)for(const ne of D[W]){let le={min:0,max:0};this.terrain&&(le=this.terrain.getMinMaxForTile(ne)||le),H.addShadowReceiver(ne.toUnwrapped(),le.min,le.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Gt(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.cZ(this.context.gl))return;this.renderPass="offscreen";for(const W of y){const ne=n.getLayerSourceCache(W);if(!W.hasOffscreenPass()||W.isHidden(this.transform.zoom))continue;const le=ne?L[ne.id]:void 0;(W.type==="custom"||W.type==="raster"||W.type==="raster-particle"||W.isSky()||le&&le.length)&&this.renderLayer(this,ne,W,le)}this.depthRangeFor3D=[0,1-(y.length+2)*this.numSublayers*this.depthEpsilon];const U=this.terrain;U&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&U.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,F)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Y=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),te=(()=>{if(o.showOverdrawInspector)return s.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Y){const W=this.style.fog.properties.get("color").toArray01();return new s.ax(...W)}if(this.style.fog&&this.transform.projection.supportsFog&&Y){const W=this.style.fog.properties.get("space-color").toArray01();return new s.ax(...W)}return s.ax.transparent})();if(this.context.clear({color:te,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const W=y[this.currentLayer],ne=n.getLayerSourceCache(W);if(W.isSky())continue;const le=ne?(W.is3D()?N:L)[ne.id]:void 0;this._renderTileClippingMasks(W,ne,le),this.renderLayer(this,ne,W,le)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const W=y[this.currentLayer],ne=n.getLayerSourceCache(W);W.isSky()&&this.renderLayer(this,ne,W,ne?L[ne.id]:void 0)}function J(W,ne){let le;return ne&&(le=(W.type==="symbol"?z:W.is3D()?N:L)[ne.id]),le}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<_.length;){const W=y[this.currentLayer];if(W.type==="raster"){const ne=n.getLayerSourceCache(W);this.renderLayer(this,ne,W,J(W,ne))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ie=0;for(H&&(ie=H.getShadowCastingLayerCount());this.currentLayer<_.length;){const W=y[this.currentLayer],ne=n.getLayerSourceCache(W);if(W.isSky())++this.currentLayer;else if(U&&this.style.isLayerDraped(W)){if(W.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=U.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(W,ne,ne?D[ne.id]:void 0),this.renderLayer(this,ne,W,J(W,ne)),!U&&H&&ie>0&&W.hasShadowPass()&&--ie==0&&(H.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const le=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=le;this.currentLayer++){const ce=y[this.currentLayer];if(!ce.hasLightBeamPass())continue;const pe=n.getLayerSourceCache(ce);this.renderLayer(this,pe,ce,pe?L[pe.id]:void 0)}this.currentLayer=le,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let W=null;y.forEach(ne=>{const le=n.getLayerSourceCache(ne);le&&!ne.isHidden(this.transform.zoom)&&le.getVisibleCoordinates().length&&(!W||W.getSource().maxzoom<le.getSource().maxzoom)&&(W=le)}),W&&this.options.showTileBoundaries&&Xl.debug(this,W,W.getVisibleCoordinates(),s.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Xl.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(W){const ne=W.transform.padding;od(W,W.transform.height-(ne.top||0),3,Br),od(W,ne.bottom||0,3,Ao),Xr(W,ne.left||0,3,xp),Xr(W,W.transform.width-(ne.right||0),3,rd);const le=W.transform.centerPoint;(function(ce,pe,Se,_e){bn(ce,pe-1,Se-10,2,20,_e),bn(ce,pe-10,Se-1,20,2,_e)})(W,le.x,W.transform.height-le.y,sd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),I||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:o}=this.transform.projection,f=!o||!o.includes(n.type);if(hd[n.type]&&(f||this.terrain&&n.type==="custom")){const _=this.style.getLayerSourceCache(n);hd[n.type](n,_,this)}this.gpuTimingEnd()}renderLayer(n,o,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(f.type)||n.terrain&&f.type==="custom")&&Xl[f.type](n,o,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,f=this.context.gl;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(o.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,o=this.context.gl,f=o.createQuery();this.deferredRenderGpuTimeQueries.push(f),o.beginQuery(n.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const o={};for(const f in n){const _=n[f],y=this.context.extTimerQuery,w=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),o[f]=w}return o}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery,f=this.context.gl;let _=0;for(const y of n)_+=o.getQueryParameter(y,f.QUERY_RESULT)/1e6,o.deleteQueryEXT(y);return _}translatePosMatrix(n,o,f,_,y){if(!f[0]&&!f[1])return n;const w=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const D=Math.sin(w),L=Math.cos(w);f=[f[0]*L-f[1]*D,f[0]*D+f[1]*L]}const S=[y?f[0]:s.a3(o,f[0],this.transform.zoom),y?f[1]:s.a3(o,f[1],this.transform.zoom),0],I=new Float32Array(16);return s.a6.translate(I,n,S),I}saveTileTexture(n){const o=n.size[0],f=this._tileTextures[o];f?f.push(n):this._tileTextures[o]=[n]}getTileTexture(n){const o=this._tileTextures[n];return o&&o.length>0?o.pop():null}isPatternMissing(n,o){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString(),o)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,o,f){const _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,y=this.terrain&&this.terrain.exaggeration()===0,w=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT"),y&&w.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||_||o!==void 0&&!o||w.push("FOG","FOG_DITHERING"),_&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(n,o){this.cache=this.cache||{};const f=o&&o.defines||[],_=o&&o.config,y=o&&o.transformFeedback,w=this.currentGlobalDefines(n,o&&o.overrideFog,o&&o.overrideRtt).concat(f),S=Gh.cacheKey(zh[n],n,w,_);return this.cache[S]||(this.cache[S]=new Gh(this.context,n,zh[n],_,lg[n],w,y)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,o){if(this.style.enable3dLights()){const f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){const y=((w,S)=>{const I=w.properties.get("direction"),D=w.properties.get("color").toArray01(),L=w.properties.get("intensity"),z=S.properties.get("color").toArray01(),F=S.properties.get("intensity"),N=[I.x,I.y,I.z],$=s.cn(z,F),G=s.cn(D,L);return{u_lighting_ambient_color:$,u_lighting_directional_dir:N,u_lighting_directional_color:G,u_ground_radiance:Uh(N,G,$)}})(f,_);o.setLightsUniformValues(n,y)}}}uploadCommonUniforms(n,o,f,_,y){if(this.uploadCommonLightUniforms(n,o),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const S=w.getOpacity(this.transform.pitch),I=((D,L,z,F,N,$,G,H,U,Y,te,J)=>{const ie=D.transform,W=L.properties.get("color").toArray01();W[3]=F;const ne=D.frameCounter/1e3%1,[le,ce]=L.properties.get("vertical-range");return{u_fog_matrix:z?ie.calculateFogTileMatrix(z):J||D.identityMat,u_fog_range:L.getFovAdjustedRange(ie._fov),u_fog_color:W,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(le,ce),ce],u_fog_temporal_offset:ne,u_frustum_tl:N,u_frustum_tr:$,u_frustum_br:G,u_frustum_bl:H,u_globe_pos:U,u_globe_radius:Y,u_viewport:te,u_globe_transition:s.S(ie.zoom),u_is_globe:+(ie.projection.name==="globe")}})(this,w,f,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.f.devicePixelRatio,this.transform.height*s.f.devicePixelRatio],_);o.setFogUniformValues(n,I)}y&&o.setCutoffUniformValues(n,y.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,o=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)o[_.key]=n[_.key]||new _o(_,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(n,o){return!(!n.is3D()||n.minzoom&&n.minzoom>this.transform.zoom||n.sourceLayer!=="building"&&(!o||o.type!=="batched-model"))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[n.key];return o||(this._cachedTileFogOpacities[n.key]=o=this.style.fog.getOpacityForTile(n)),o[0]>=qi||o[1]>=qi}}function Yl(h,n){let o=!1,f=null;const _=()=>{f=null,o&&(h(),f=setTimeout(_,n),o=!1)};return()=>(o=!0,f||_(),f)}class pu{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yl(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const o=dd(n);if(this._hashName){const f=this._hashName;let _=!1;const y=location.hash.slice(1).split("&").map(w=>{const S=w.split("=")[0];return S===f?(_=!0,`${S}=${o}`):w}).filter(w=>w);return _||y.push(`${f}=${o}`),`#${y.join("&")}`}return`#${o}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(o=f)}),(o&&o[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(f=>isNaN(f))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(o[3]||0):n.getBearing();return n.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:f,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function dd(h,n){const o=h.getCenter(),f=Math.round(100*h.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),w=Math.round(o.lng*y)/y,S=Math.round(o.lat*y)/y,I=h.getBearing(),D=h.getPitch();let L=n?`/${w}/${S}/${f}`:`${f}/${S}/${w}`;return(I||D)&&(L+="/"+Math.round(10*I)/10),D&&(L+=`/${Math.round(D)}`),L}const Kl={linearity:.3,easing:s.c_(0,0,.3,1)},Nr=s.e({deceleration:2500,maxSpeed:1400},Kl),pg=s.e({deceleration:20,maxSpeed:1400},Kl),mu=s.e({deceleration:1e3,maxSpeed:360},Kl),_n=s.e({deceleration:1e3,maxSpeed:90},Kl);class Hi{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.f.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,o=s.f.now();for(;n.length>0&&o-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(o.pan.mag()){const y=Es(o.pan.mag(),f,s.e({},Nr,n||{}));_.offset=o.pan.mult(y.amount/o.pan.mag()),_.center=this._map.transform.center,Jl(_,y)}if(o.zoom){const y=Es(o.zoom,f,pg);_.zoom=this._map.transform.zoom+y.amount,Jl(_,y)}if(o.bearing){const y=Es(o.bearing,f,mu);_.bearing=this._map.transform.bearing+s.aa(y.amount,-179,179),Jl(_,y)}if(o.pitch){const y=Es(o.pitch,f,_n);_.pitch=this._map.transform.pitch+y.amount,Jl(_,y)}if(_.zoom||_.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Jl(h,n){(!h.duration||h.duration<n.duration)&&(h.duration=n.duration,h.easing=n.easing)}function Es(h,n,o){const{maxSpeed:f,linearity:_,deceleration:y}=o,w=s.aa(h*_/(n/1e3),-f,f),S=Math.abs(w)/(y*_);return{easing:o.easing,duration:1e3*S,amount:w*(S/2)}}class Rr extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f,_={}){const y=Wt(o.getCanvasContainer(),f),w=o.unproject(y);super(n,s.e({point:y,lngLat:w,originalEvent:f},_)),this._defaultPrevented=!1,this.target=o}}class Ks extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f){const _=n==="touchend"?f.changedTouches:f.touches,y=ui(o.getCanvasContainer(),_),w=y.map(I=>o.unproject(I)),S=y.reduce((I,D,L,z)=>I.add(D.div(z.length)),new s.P(0,0));super(n,{points:y,point:S,lngLats:w,lngLat:o.unproject(S),originalEvent:f}),this._defaultPrevented=!1}}class fd extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class pd{constructor(n,o){this._map=n,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new fd(n.type,this._map,n))}mousedown(n,o){return this._mousedownPos=o,this._firePreventable(new Rr(n.type,this._map,n))}mouseup(n){this._map.fire(new Rr(n.type,this._map,n))}preclick(n){const o=s.e({},n);o.type="preclick",this._map.fire(new Rr(o.type,this._map,o))}click(n,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Rr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Rr(n.type,this._map,n))}mouseover(n){this._map.fire(new Rr(n.type,this._map,n))}mouseout(n){this._map.fire(new Rr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ks(n.type,this._map,n))}touchmove(n){this._map.fire(new Ks(n.type,this._map,n))}touchend(n){this._map.fire(new Ks(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ks(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Co{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Rr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Rr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Po{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,o){this.isEnabled()&&n.shiftKey&&n.button===0&&(ct(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(n,o){if(!this._active)return;const f=o,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=ue("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const w=Math.min(_.x,f.x),S=Math.max(_.x,f.x),I=Math.min(_.y,f.y),D=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${I}px)`,this._box.style.width=S-w+"px",this._box.style.height=D-I+"px")})}mouseupWindow(n,o){if(!this._active)return;const f=this._startPos,_=o;if(f&&n.button===0){if(this.reset(),Rt(),f.x!==_.x||f.y!==_.y)return this._map.fire(new s.b("boxzoomend",{originalEvent:n})),{cameraAnimation:y=>y.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),gt(),delete this._startPos,delete this._lastPos}_fireEvent(n,o){return this._map.fire(new s.b(n,{originalEvent:o}))}}function qa(h,n){const o={};for(let f=0;f<h.length;f++)o[h[f].identifier]=n[f];return o}class _u{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,o,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const y=new s.P(0,0);for(const w of _)y._add(w);return y.div(_.length)}(o),this.touches=qa(f,o)))}touchmove(n,o,f){if(this.aborted||!this.centroid)return;const _=qa(f,o);for(const y in this.touches){const w=_[y];(!w||w.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(n,o,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Ql{constructor(n){this.singleTap=new _u(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,o,f){this.singleTap.touchstart(n,o,f)}touchmove(n,o,f){this.singleTap.touchmove(n,o,f)}touchend(n,o,f){const _=this.singleTap.touchend(n,o,f);if(_){const y=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(y&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class md{constructor(){this._zoomIn=new Ql({numTouches:1,numTaps:2}),this._zoomOut=new Ql({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,o,f){this._zoomIn.touchstart(n,o,f),this._zoomOut.touchstart(n,o,f)}touchmove(n,o,f){this._zoomIn.touchmove(n,o,f),this._zoomOut.touchmove(n,o,f)}touchend(n,o,f){const _=this._zoomIn.touchend(n,o,f),y=this._zoomOut.touchend(n,o,f);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:n})}):y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _d={0:1,2:2};class Bs{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,o){return!1}_move(n,o){return{}}mousedown(n,o){if(this._lastPoint)return;const f=bi(n);this._correctButton(n,f)&&(this._lastPoint=o,this._eventButton=f)}mousemoveWindow(n,o){const f=this._lastPoint;if(f){if(n.preventDefault(),this._eventButton!=null&&function(_,y){const w=_d[y];return _.buttons===void 0||(_.buttons&w)!==w}(n,this._eventButton))this.reset();else if(this._moved||!(o.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(f,o)}}mouseupWindow(n){this._lastPoint&&bi(n)===this._eventButton&&(this._moved&&Rt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gd extends Bs{mousedown(n,o){super.mousedown(n,o),this._lastPoint&&(this._active=!0)}_correctButton(n,o){return o===0&&!n.ctrlKey}_move(n,o){return{around:o,panDelta:o.sub(n)}}}class ec extends Bs{_correctButton(n,o){return o===0&&n.ctrlKey||o===2}_move(n,o){const f=.8*(o.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class gu extends Bs{_correctButton(n,o){return o===0&&n.ctrlKey||o===2}_move(n,o){const f=-.5*(o.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class yd{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,o,f){return this._calculateTransform(n,o,f)}touchmove(n,o,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!s.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,o,f)}}touchend(n,o,f){this._calculateTransform(n,o,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,o,f){f.length>0&&(this._active=!0);const _=qa(f,o),y=new s.P(0,0),w=new s.P(0,0);let S=0;for(const D in _){const L=_[D],z=this._touches[D];z&&(y._add(L),w._add(L.sub(z)),S++,_[D]=L)}if(this._touches=_,S<this._minTouches||!w.mag())return;const I=w.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ue("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Qn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,o,f){return{}}touchstart(n,o,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([o[0],o[1]]))}touchmove(n,o,f){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[y,w]=_,S=Ha(f,o,y),I=Ha(f,o,w);if(!S||!I)return;const D=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],D,n)}touchend(n,o,f){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,w=Ha(f,o,_),S=Ha(f,o,y);w&&S||(this._active&&Rt(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ha(h,n,o){for(let f=0;f<h.length;f++)if(h[f].identifier===o)return n[f]}function yu(h,n){return Math.log(h/n)/Math.LN2}class tc extends Qn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,o){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(yu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yu(this._distance,f),pinchAround:o}}}function Do(h,n){return 180*h.angleWith(n)/Math.PI}class xd extends Qn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,o){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Do(this._vector,f),pinchAround:o}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const o=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=Do(n,f);return Math.abs(_)<o}}function ic(h){return Math.abs(h.y)>Math.abs(h.x)}class vd extends Qn{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,ic(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,o,f){const _=this._lastPoints;if(!_)return;const y=n[0].sub(_[0]),w=n[1].sub(_[1]);return this._map._cooperativeGestures&&!s.c$()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(y,w,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5})}gestureBeginsVertically(n,o,f){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,y=o.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const w=n.y>0==o.y>0;return ic(n)&&ic(o)&&w}}const oa={panStep:100,bearingStep:15,pitchStep:10};class nc{constructor(){const n=oa;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let o=0,f=0,_=0,y=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),y=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),y=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:S=>{const I=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:bd,zoom:o?Math.round(I)+o*(n.shiftKey?2:1):I,bearing:S.getBearing()+f*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:S.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bd(h){return h*(2-h)}const rc=4.000244140625,wd=1/450;class Tp{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=wd,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=s.f.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,o!==0&&o%rc==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),n.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=n,this._delta-=o,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Wt(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>rc?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const z=o(),F=Math.pow(2,z),N=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(N*L))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:o(),_=this._startZoom,y=this._easing;let w,S=!1;if(this._type==="wheel"&&_&&y){const D=Math.min((s.f.now()-this._lastWheelEventTime)/200,1),L=y(D);w=s.U(_,f,L),D<1?this._frameId||(this._frameId=!0):S=!0}else w=f,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=w-o();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let o=s.d0;if(this._prevEase){const f=this._prevEase,_=(s.f.now()-f.start)/f.duration,y=f.easing(_+.01)-f.easing(_),w=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-w*w);o=s.c_(w,S,.25,1)}return this._prevEase={start:s.f.now(),duration:n,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ue("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Mp{constructor(n,o){this._clickZoom=n,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,o){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(o)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ep{constructor(){this._tap=new Ql({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,o,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=o[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,o,f))}touchmove(n,o,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=o[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(n,o,f)}touchend(n,o,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,o,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ap{constructor(n,o,f){this._el=n,this._mousePan=o,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ip{constructor(n,o,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=o,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cp{constructor(n,o,f,_){this._el=n,this._touchZoom=o,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sc=h=>h.zoom||h.drag||h.pitch||h.rotate;class Pp extends s.b{}class Dp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,o){const f=s.N.sub([],o,n);this.radius=s.N.length(f[2]<0?s.N.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){s.N.div(n,n,this.constants),s.N.normalize(n,n),s.N.mul(n,n,this.constants);const o=s.N.scale([],n,this.radius);if(o[2]>0){const f=s.N.scale([],[0,0,1],s.N.dot(o,[0,0,1])),_=s.N.scale([],s.N.normalize([],[o[0],o[1],0]),this.radius),y=s.N.add([],o,s.N.scale([],s.N.sub([],s.N.add([],_,f),o),2));o[0]=y[0],o[1]=y[1]}return o}}function oc(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class mg{constructor(n,o){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hi(n),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Dp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.aY(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,y,w]of this._listeners){const S=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,S,w)}}destroy(){for(const[n,o,f]of this._listeners){const _=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(o,_,f)}}_addDefaultHandlers(n){const o=this._map,f=o.getCanvasContainer();this._add("mapEvent",new pd(o,n));const _=o.boxZoom=new Po(o,n);this._add("boxZoom",_);const y=new md,w=new Sp;o.doubleClickZoom=new Mp(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const S=new Ep;this._add("tapDragZoom",S);const I=o.touchPitch=new vd(o);this._add("touchPitch",I);const D=new ec(n),L=new gu(n);o.dragRotate=new Ip(n,D,L),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const z=new gd(n),F=new yd(o,n);o.dragPan=new Ap(f,z,F),this._add("mousePan",z),this._add("touchPan",F,["touchZoom","touchRotate"]);const N=new xd,$=new tc;o.touchZoomRotate=new Cp(f,$,N,S),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Co(o));const G=o.scrollZoom=new Tp(o,this);this._add("scrollZoom",G,["mousePan"]);const H=o.keyboard=new nc;this._add("keyboard",H);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[U]&&o[U].enable(n[U])}_add(n,o,f){this._handlers.push({handlerName:n,handler:o,allowed:f}),this._handlersById[n]=o}stop(n){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,o,f){for(const _ in n)if(_!==f&&(!o||o.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const o=[];for(const f of n)this._el.contains(f.target)&&o.push(f);return o}handleEvent(n,o){this._updatingCamera=!0;const f=n.type==="renderFrame",_=f?void 0:n,y={needsRenderFrame:!1},w={},S={},I=n.touches?this._getMapTouches(n.touches):void 0,D=I?ui(this._el,I):f?void 0:Wt(this._el,n);for(const{handlerName:F,handler:N,allowed:$}of this._handlers){if(!N.isEnabled())continue;let G;this._blockedByActive(S,$,F)?N.reset():N[o||n.type]&&(G=N[o||n.type](n,D,I),this.mergeHandlerResult(y,w,G,F,_),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||N.isActive())&&(S[F]=N)}const L={};for(const F in this._previousActiveHandlers)S[F]||(L[F]=_);this._previousActiveHandlers=S,(Object.keys(L).length||oc(y))&&(this._changes.push([y,w,L]),this._triggerRenderFrame()),(Object.keys(S).length||oc(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=y;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(n,o,f,_,y){if(!f)return;s.e(n,f);const w={handlerName:_,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(o.zoom=w),f.panDelta!==void 0&&(o.drag=w),f.pitchDelta!==void 0&&(o.pitch=w),f.bearingDelta!==void 0&&(o.rotate=w)}_applyChanges(){const n={},o={},f={};for(const[_,y,w]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),s.e(o,y),s.e(f,w);this._updateMapTransform(n,o,f),this._changes=[]}_updateMapTransform(n,o,f){const _=this._map,y=_.transform,w=Y=>[Y.x,Y.y,Y.z];if((Y=>{const te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!oc(n)){const Y=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),Y!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!oc(n))return void this._fireEvents(o,f,!0);let{panDelta:S,zoomDelta:I,bearingDelta:D,pitchDelta:L,around:z,aroundCoord:F,pinchAround:N}=n;y._isCameraConstrained&&(I>0&&(I=0),y._isCameraConstrained=!1),N!==void 0&&(z=N),(I||(Y=>o[Y]&&!this._eventsInProgress[Y])("drag"))&&z&&(this._dragOrigin=w(y.pointCoordinate3D(z)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),z=z||_.transform.centerPoint,D&&(y.bearing+=D),L&&(y.pitch+=L),y._updateCameraState();const $=[0,0,0];if(S)if(y.projection.name==="mercator"){const Y=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(z).dir),te=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(z.sub(S)).dir);$[0]=te[0]-Y[0],$[1]=te[1]-Y[1]}else{const Y=y.pointCoordinate(z);if(y.projection.name==="globe"){S=S.rotate(-y.angle);const te=y._pixelsPerMercatorPixel/y.worldSize;$[0]=-S.x*s.d1(s.au(Y.y))*te,$[1]=-S.y*s.d1(y.center.lat)*te}else{const te=y.pointCoordinate(z.sub(S));Y&&te&&($[0]=te.x-Y.x,$[1]=te.y-Y.y)}}const G=y.zoom,H=[0,0,0];if(I){const Y=w(F||y.pointCoordinate3D(z)),te={dir:s.N.normalize([],s.N.sub([],Y,y._camera.position))};if(te.dir[2]<0){const J=y.zoomDeltaToMovement(Y,I);s.N.scale(H,te.dir,J)}}const U=s.N.add($,$,H);y._translateCameraConstrained(U),I&&Math.abs(y.zoom-G)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(o,f,!0)}_fireEvents(n,o,f){const _=sc(this._eventsInProgress),y=sc(n),w={};for(const L in n){const{originalEvent:z}=n[L];this._eventsInProgress[L]||(w[`${L}start`]=z),this._eventsInProgress[L]=n[L]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const L in w)this._fireEvent(L,w[L]);y&&this._fireEvent("move",y.originalEvent);for(const L in n){const{originalEvent:z}=n[L];this._fireEvent(L,z)}const S={};let I;for(const L in this._eventsInProgress){const{handlerName:z,originalEvent:F}=this._eventsInProgress[L];this._handlersById[z].isActive()||(delete this._eventsInProgress[L],I=o[z]||F,S[`${L}end`]=I)}for(const L in S)this._fireEvent(L,S[L]);const D=sc(this._eventsInProgress);if(f&&(_||y)&&!D){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;L?(z(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:I})):(this._map.fire(new s.b("moveend",{originalEvent:I})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,o){this._map.fire(new s.b(n,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Pp("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Lp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Cn extends s.E{constructor(n,o){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(n,o){return this.jumpTo({center:n},o)}panBy(n,o,f){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,s.e({offset:n},o),f)}panTo(n,o,f){return this.easeTo(s.e({center:n},o),f)}getZoom(){return this.transform.zoom}setZoom(n,o){return this.jumpTo({zoom:n},o),this}zoomTo(n,o,f){return this.easeTo(s.e({zoom:n},o),f)}zoomIn(n,o){return this.zoomTo(this.getZoom()+1,n,o),this}zoomOut(n,o){return this.zoomTo(this.getZoom()-1,n,o),this}getBearing(){return this.transform.bearing}setBearing(n,o){return this.jumpTo({bearing:n},o),this}getPadding(){return this.transform.padding}setPadding(n,o){return this.jumpTo({padding:n},o),this}rotateTo(n,o,f){return this.easeTo(s.e({bearing:n},o),f)}resetNorth(n,o){return this.rotateTo(0,s.e({duration:1e3},n),o),this}resetNorthPitch(n,o){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},n),o),this}snapToNorth(n,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,o):this}getPitch(){return this.transform.pitch}setPitch(n,o){return this.jumpTo({pitch:n},o),this}cameraForBounds(n,o){n=s.ad.convert(n);const f=o&&o.bearing||0,_=o&&o.pitch||0,y=n.getNorthWest(),w=n.getSouthEast();return this._cameraForBounds(this.transform,y,w,f,_,o)}_extendCameraOptions(n){const o={top:0,bottom:0,right:0,left:0};if(typeof(n=s.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const f=n.padding;n.padding={top:f,bottom:f,right:f,left:f}}return n.padding=s.e(o,n.padding),n}_minimumAABBFrustumDistance(n,o){const f=o.max[0]-o.min[0],_=o.max[1]-o.min[1];return f/_>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):_/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,o,f,_,y,w){const S=n.clone(),I=this._extendCameraOptions(w);S.bearing=_,S.pitch=y;const D=s.bn.convert(o),L=s.bn.convert(f),z=.5*(D.lat+L.lat),F=.5*(D.lng+L.lng),N=s.d2(z,F),$=s.N.normalize([],N),G=s.N.normalize([],s.N.cross([],$,[0,1,0])),H=s.N.cross([],G,$),U=[G[0],G[1],G[2],0,H[0],H[1],H[2],0,$[0],$[1],$[2],0,0,0,0,1],Y=[N,s.d2(D.lat,D.lng),s.d2(L.lat,D.lng),s.d2(L.lat,L.lng),s.d2(D.lat,L.lng),s.d2(z,D.lng),s.d2(z,L.lng),s.d2(D.lat,F),s.d2(L.lat,F)];let te=s.bS.fromPoints(Y.map(we=>[s.N.dot(G,we),s.N.dot(H,we),s.N.dot($,we)]));const J=s.N.transformMat4([],te.center,U);s.N.squaredLength(J)===0&&s.N.set(J,0,0,1),s.N.normalize(J,J),s.N.scale(J,J,s.ab),S.center=s.d3(J);const ie=S.getWorldToCameraMatrix(),W=s.a6.invert(new Float64Array(16),ie);te=s.bS.applyTransform(te,s.a6.multiply([],ie,U)),s.N.transformMat4(J,J,ie);const ne=.5*(te.max[2]-te.min[2]),le=this._minimumAABBFrustumDistance(S,te),ce=s.N.scale([],[0,0,1],ne),pe=s.N.add(ce,J,ce),Se=le+(S.pitch===0?0:s.N.distance(J,pe)),_e=S.globeCenterInViewSpace,ze=s.N.sub([],J,[_e[0],_e[1],_e[2]]);s.N.normalize(ze,ze),s.N.scale(ze,ze,Se);const De=s.N.add([],J,ze);s.N.transformMat4(De,De,W);const He=s.d4/s.ab,ye=s.N.length(De),Ie=s.bl(Math.max(ye*He-s.d4,Number.EPSILON),0),fe=Math.min(S.zoomFromMercatorZAdjusted(Ie),I.maxZoom);return fe>.5*(s.bG+s.bx)?(S.setProjection({name:"mercator"}),S.zoom=fe,this._cameraForBounds(S,o,f,_,y,w)):{center:S.center,zoom:fe,bearing:_,pitch:y}}queryTerrainElevation(n,o){const f=this.transform.elevation;return f?(o=s.e({},{exaggerated:!0},o),f.getAtPoint(s.L.fromLngLat(n),null,o.exaggerated)):null}_cameraForBounds(n,o,f,_,y,w){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,o,f,_,y,w);const S=n.clone(),I=this._extendCameraOptions(w),D=S.padding;S.bearing=_,S.pitch=y;const L=s.bn.convert(o),z=s.bn.convert(f),F=new s.bn(L.lng,z.lat),N=new s.bn(z.lng,L.lat),$=S.project(L),G=S.project(z),H=this.queryTerrainElevation(L),U=this.queryTerrainElevation(z),Y=this.queryTerrainElevation(F),te=this.queryTerrainElevation(N),J=[[$.x,$.y,Math.min(H||0,U||0,Y||0,te||0)],[G.x,G.y,Math.max(H||0,U||0,Y||0,te||0)]];let ie=s.bS.fromPoints(J);const W=S.getWorldToCameraMatrix(),ne=s.a6.invert(new Float64Array(16),W);ie=s.bS.applyTransform(ie,W);const le=s.N.sub([],ie.max,ie.min),ce=D.left||0,pe=D.right||0,Se=D.bottom||0,_e=D.top||0,{left:ze,right:De,top:He,bottom:ye}=I.padding,Ie=.5*(ce+pe),fe=.5*(_e+Se),we=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(ce+pe+ze+De))/le[0],(S.height-(Se+_e+ye+He))/le[1])),I.maxZoom),Ze=S.scale/S.zoomScale(we);ie=new s.bS([ie.min[0]-(ze+Ie)*Ze,ie.min[1]-(ye+fe)*Ze,ie.min[2]],[ie.max[0]+(De+Ie)*Ze,ie.max[1]+(He+fe)*Ze,ie.max[2]]);const it=.5*le[2],tt=this._minimumAABBFrustumDistance(S,ie),dt=[0,0,1,0];s.a7.transformMat4(dt,dt,W),s.a7.normalize(dt,dt);const Pt=s.N.scale([],dt,tt+it),Ut=s.N.add([],ie.center,Pt),zt=(typeof I.offset.x=="number"&&typeof I.offset.y=="number"?new s.P(I.offset.x,I.offset.y):s.P.convert(I.offset)).rotate(-s.bj(_));ie.center[0]-=zt.x*Ze,ie.center[1]+=zt.y*Ze,s.N.transformMat4(ie.center,ie.center,ne),s.N.transformMat4(Ut,Ut,ne);const Bt=[ie.center[0],ie.center[1],Ut[2]*S.pixelsPerMeter];s.N.scale(Bt,Bt,1/S.worldSize);const li=s.at(Bt[0]),Jt=s.au(Bt[1]),ri=Math.min(S._zoomFromMercatorZ(Bt[2]),I.maxZoom),ni=new s.bn(li,Jt);return S.mercatorFromTransition&&ri<.5*(s.bG+s.bx)?(S.setProjection({name:"globe"}),S.zoom=ri,this._cameraForBounds(S,o,f,_,y,w)):{center:ni,zoom:ri,bearing:_,pitch:y}}fitBounds(n,o,f){const _=this.cameraForBounds(n,o);return this._fitInternal(_,o,f)}fitScreenCoordinates(n,o,f,_,y){const w=s.P.convert(n),S=s.P.convert(o),I=new s.P(Math.min(w.x,S.x),Math.min(w.y,S.y)),D=new s.P(Math.max(w.x,S.x),Math.max(w.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,S))return this;const L=this.transform.pointLocation3D(I),z=this.transform.pointLocation3D(D),F=this.transform.pointLocation3D(new s.P(I.x,D.y)),N=this.transform.pointLocation3D(new s.P(D.x,I.y)),$=[Math.min(L.lng,z.lng,F.lng,N.lng),Math.min(L.lat,z.lat,F.lat,N.lat)],G=[Math.max(L.lng,z.lng,F.lng,N.lng),Math.max(L.lat,z.lat,F.lat,N.lat)],H=_&&_.pitch?_.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,$,G,f,H,_);return this._fitInternal(U,_,y)}_fitInternal(n,o,f){return n?(delete(o=s.e(n,o)).padding,o.linear?this.easeTo(o,f):this.flyTo(o,f)):this}jumpTo(n,o){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,w=!1;return"zoom"in n&&f.zoom!==+n.zoom&&(_=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=s.bn.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(y=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(w=!0,f.pitch=+n.pitch),n.padding==null||f.isPaddingEqual(n.padding)||(f.padding=n.padding),n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new s.b("movestart",o)).fire(new s.b("move",o)),_&&this.fire(new s.b("zoomstart",o)).fire(new s.b("zoom",o)).fire(new s.b("zoomend",o)),y&&this.fire(new s.b("rotatestart",o)).fire(new s.b("rotate",o)).fire(new s.b("rotateend",o)),w&&this.fire(new s.b("pitchstart",o)).fire(new s.b("pitch",o)).fire(new s.b("pitchend",o)),this.fire(new s.b("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Lp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,o){const f=this.transform;if(!f.projection.supportsFreeCamera)return s.w(Lp),this;this.stop();const _=f.zoom,y=f.pitch,w=f.bearing;f.setFreeCameraOptions(n);const S=_!==f.zoom,I=y!==f.pitch,D=w!==f.bearing;return this.fire(new s.b("movestart",o)).fire(new s.b("move",o)),S&&this.fire(new s.b("zoomstart",o)).fire(new s.b("zoom",o)).fire(new s.b("zoomend",o)),D&&this.fire(new s.b("rotatestart",o)).fire(new s.b("rotate",o)).fire(new s.b("rotateend",o)),I&&this.fire(new s.b("pitchstart",o)).fire(new s.b("pitch",o)).fire(new s.b("pitchend",o)),this.fire(new s.b("moveend",o)),this}easeTo(n,o){this._stop(!1,n.easeId),((n=s.e({offset:[0,0],duration:500,easing:s.d0},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const f=this.transform,_=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),I="zoom"in n?+n.zoom:_,D="bearing"in n?this._normalizeBearing(n.bearing,y):y,L="pitch"in n?+n.pitch:w,z="padding"in n?n.padding:f.padding,F=s.P.convert(n.offset);let N,$,G;if(f.projection.name==="globe"){const ce=s.L.fromLngLat(f.center),pe=F.rotate(-f.angle);ce.x+=pe.x/f.worldSize,ce.y+=pe.y/f.worldSize;const Se=ce.toLngLat(),_e=s.bn.convert(n.center||Se);this._normalizeCenter(_e),N=f.centerPoint.add(pe),$=new s.P(ce.x,ce.y).mult(f.worldSize),G=new s.P(s.a5(_e.lng),s.ae(_e.lat)).mult(f.worldSize).sub($)}else{N=f.centerPoint.add(F);const ce=f.pointLocation(N),pe=s.bn.convert(n.center||ce);this._normalizeCenter(pe),$=f.project(ce),G=f.project(pe).sub($)}const H=f.zoomScale(I-_);let U,Y;n.around&&(U=s.bn.convert(n.around),Y=f.locationPoint(U));const te=this._zooming||I!==_,J=this._rotating||y!==D,ie=this._pitching||L!==w,W=!f.isPaddingEqual(z),ne=ce=>pe=>{if(te&&(ce.zoom=s.U(_,I,pe)),J&&(ce.bearing=s.U(y,D,pe)),ie&&(ce.pitch=s.U(w,L,pe)),W&&(ce.interpolatePadding(S,z,pe),N=ce.centerPoint.add(F)),U)ce.setLocationAtPoint(U,Y);else{const Se=ce.zoomScale(ce.zoom-_),_e=I>_?Math.min(2,H):Math.max(.5,H),ze=Math.pow(_e,1-pe),De=ce.unproject($.add(G.mult(pe*ze)).mult(Se));ce.setLocationAtPoint(ce.renderWorldCopies?De.wrap():De,N)}return n.preloadOnly||this._fireMoveEvents(o),ce};if(n.preloadOnly){const ce=this._emulate(ne,n.duration,f);return this._preloadTiles(ce),this}const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=J,this._pitching=ie,this._easeId=n.easeId,this._prepareEase(o,n.noMoveStart,le),this._ease(ne(f),ce=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(o,ce)},n),this}_prepareEase(n,o,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||f.moving||this.fire(new s.b("movestart",n)),this._zooming&&!f.zooming&&this.fire(new s.b("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new s.b("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new s.b("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.b("move",n)),this._zooming&&this.fire(new s.b("zoom",n)),this._rotating&&this.fire(new s.b("rotate",n)),this._pitching&&this.fire(new s.b("pitch",n))}_afterEase(n,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,f&&this.fire(new s.b("zoomend",n)),_&&this.fire(new s.b("rotateend",n)),y&&this.fire(new s.b("pitchend",n)),this.fire(new s.b("moveend",n))}flyTo(n,o){if(this._prefersReducedMotion(n)){const ye=s.ac(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ye,o)}this.stop(),n=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.d0},n);const f=this.transform,_=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S="zoom"in n?s.aa(+n.zoom,f.minZoom,f.maxZoom):_,I="bearing"in n?this._normalizeBearing(n.bearing,y):y,D="pitch"in n?+n.pitch:w,L=f.zoomScale(S-_),z=s.P.convert(n.offset),F=f.centerPoint.add(z),N=f.pointLocation(F);let $=n.center;if($&&n.padding){const ye=this._cameraForBounds(this.transform,$,$,I,D,n);ye&&($=ye.center)}$=s.bn.convert($||N),this._normalizeCenter($);const G=f.project(N),H=f.project($).sub(G);let U=n.curve;const Y=Math.max(f.width,f.height),te=Y/L,J=H.mag();if("minZoom"in n){const ye=s.aa(Math.min(n.minZoom,_,S),f.minZoom,f.maxZoom),Ie=Y/f.zoomScale(ye-_);U=Math.sqrt(Ie/J*2)}const ie=U*U;function W(ye){const Ie=(te*te-Y*Y+(ye?-1:1)*ie*ie*J*J)/(2*(ye?te:Y)*ie*J);return Math.log(Math.sqrt(Ie*Ie+1)-Ie)}function ne(ye){return(Math.exp(ye)-Math.exp(-ye))/2}function le(ye){return(Math.exp(ye)+Math.exp(-ye))/2}const ce=W(0);let pe=function(ye){return le(ce)/le(ce+U*ye)},Se=function(ye){return Y*((le(ce)*(ne(Ie=ce+U*ye)/le(Ie))-ne(ce))/ie)/J;var Ie},_e=(W(1)-ce)/U;if(Math.abs(J)<1e-6||!isFinite(_e)){if(Math.abs(Y-te)<1e-6)return this.easeTo(n,o);const ye=te<Y?-1:1;_e=Math.abs(Math.log(te/Y))/U,Se=function(){return 0},pe=function(Ie){return Math.exp(ye*U*Ie)}}n.duration="duration"in n?+n.duration:1e3*_e/("screenSpeed"in n?+n.screenSpeed/U:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const ze=y!==I,De=D!==w,He=ye=>Ie=>{const fe=Ie*_e,we=1/pe(fe);ye.zoom=Ie===1?S:_+ye.scaleZoom(we),ze&&(ye.bearing=s.U(y,I,Ie)),De&&(ye.pitch=s.U(w,D,Ie));const Ze=Ie===1?$:ye.unproject(G.add(H.mult(Se(fe))).mult(we));return ye.setLocationAtPoint(ye.renderWorldCopies?Ze.wrap():Ze,F),ye._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(o),ye};if(n.preloadOnly){const ye=this._emulate(He,n.duration,f);return this._preloadTiles(ye),this}return this._zooming=!0,this._rotating=ze,this._pitching=De,this._prepareEase(o,!1),this._ease(He(f),()=>this._afterEase(o),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,o)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,o,f){f.animate===!1||f.duration===0?(n(1),o()):(this._easeStart=s.f.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.f.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,o){n=s.bh(n,-180,180);const f=Math.abs(n-o);return Math.abs(n-360-o)<f&&(n-=360),Math.abs(n+360-o)<f&&(n+=360),n}_normalizeCenter(n){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const f=n.lng-o.center.lng;n.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.f.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,o,f){const _=Math.ceil(15*o/1e3),y=[],w=n(f.clone());for(let S=0;S<=_;S++){const I=w(S/_);y.push(I.clone())}return y}}class Td{constructor(n={}){this.options=n,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const o=this.options&&this.options.compact;return this._map=n,this._container=ue("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ue("button","mapboxgl-ctrl-attrib-button",this._container),ue("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ue("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,o){const f=this._map._getUIString(`AttributionControl.${o}`);n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.d5.ACCESS_TOKEN}];if(n){const f=o.reduce((_,y,w)=>(y.value&&(_+=`${y.key}=${y.value}${w<o.length-1?"&":""}`),_),"?");n.href=`${s.d5.FEEDBACK_URL}/${f}#${dd(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const o=this._map.style._mergedSourceCaches;for(const _ in o){const y=o[_];if(y.used){const w=y.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((_,y)=>_.length-y.length),n=n.filter((_,y)=>{for(let w=y+1;w<n.length;w++)if(n[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Rp{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ue("div","mapboxgl-ctrl");const o=ue("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const o in n){const f=n[o].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class zp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const o=++this._id;return this._queue.push({callback:n,id:o,cancelled:!1}),o}remove(n){const o=this._currentlyRunning,f=o?this._queue.concat(o):this._queue;for(const _ of f)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const f of o)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ac(h,n,o){if(h=new s.bn(h.lng,h.lat),n){const f=new s.bn(h.lng-360,h.lat),_=new s.bn(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-o.center.lng)/360),w=o.locationPoint(h).distSqr(n),S=n.x<0||n.y<0||n.x>o.width||n.y>o.height;o.locationPoint(f).distSqr(n)<w&&(S||Math.abs(f.lng-o.center.lng)<y)?h=f:o.locationPoint(_).distSqr(n)<w&&(S||Math.abs(_.lng-o.center.lng)<y)&&(h=_)}for(;Math.abs(h.lng-o.center.lng)>180;){const f=o.locationPoint(h);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;h.lng>o.center.lng?h.lng-=360:h.lng+=360}return h}const xu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Md extends s.E{constructor(n,o){if(super(),(n instanceof HTMLElement||o)&&(n=s.e({element:n},o)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=ue("div");const y=41,w=27,S=Le("svg",{display:"block",height:y*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${y}`},this._element),I=Le("radialGradient",{id:"shadowGradient"},Le("defs",{},S));Le("stop",{offset:"10%","stop-opacity":.4},I),Le("stop",{offset:"100%","stop-opacity":.05},I),Le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),Le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),Le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),Le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=s.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const f=this._element.classList;for(const y in xu)f.remove(`mapboxgl-marker-anchor-${y}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=n&&n.className?n.className.trim().split(/\s+/):[];f.add(..._),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.bn.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const o=n.code,f=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const o=n.originalEvent.target,f=this._element;this._popup&&(o===f||f.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,o=this._pos;if(!n||!o)return!1;const f=n.unproject(o),_=n.getFreeCameraOptions();if(!_.position)return!1;const y=_.position.toLngLat();return y.distanceTo(f)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const o=this._pos;if(!o||o.x<0||o.x>n.transform.width||o.y<0||o.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(o);let _;n._showingGlobe()&&s.d6(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${xu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const n=this._pos,o=this._map,f=this.getPitchAlignment();if(!o||!n||f!=="map")return"";if(!o._showingGlobe()){const I=o.getPitch();return I?`rotateX(${I}deg)`:""}const _=s.bF(s.d7(o.transform,this._lngLat)),y=n.sub(s.d8(o.transform)),w=Math.abs(y.x)+Math.abs(y.y);if(w===0)return"";const S=_/w;return`rotateX(${-y.y*S}deg) rotateY(${y.x*S}deg)`}_calculateZTransform(){const n=this._pos,o=this._map;if(!o||!n)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(o._showingGlobe()){const y=o.project(new s.bn(this._lngLat.lng,this._lngLat.lat+.001)),w=o.project(new s.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);f=s.bF(Math.atan2(w.y,w.x))-90}else f=-o.getBearing();else if(_==="horizon"){const y=s.O(4,6,o.getZoom()),w=s.d8(o.transform);w.y+=y*o.transform.height;const S=n.sub(w),I=s.bF(Math.atan2(S.y,S.x));f=(I>90?I-270:I+90)*(1-y)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=ac(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const o=this._map;if(!o)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const y=this._clickTolerance||o._clickTolerance;if(n.point.dist(f)<y)return;this._isDragging=!0}this._pos=n.point.sub(_),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.b("dragstart"))),this.fire(new s.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.b("dragend")),this._state="inactive"}_addDragHandler(n){const o=this._map,f=this._pos;o&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const o=this._map;return o&&(n?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const kp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Op=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fp(h=new s.P(0,0),n="bottom"){if(typeof h=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(n){case"top":return new s.P(0,h);case"top-left":return new s.P(o,o);case"top-right":return new s.P(-o,o);case"bottom":return new s.P(0,-h);case"bottom-left":return new s.P(o,-o);case"bottom-right":return new s.P(-o,-o);case"left":return new s.P(h,0);case"right":return new s.P(-h,0)}return new s.P(0,0)}return h instanceof s.P||Array.isArray(h)?s.P.convert(h):s.P.convert(h[n]||[0,0])}class Sd{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const o=s.cc((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,o,f){this._start=this.getValue(o),this._end=n,this._startTime=o,this._endTime=o+f}}const lc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Bp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Ed{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const vu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Js{constructor(n,o,f=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new ec({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new gu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(n,o){this.mouseRotate.mousedown(n,o),this.mousePitch&&this.mousePitch.mousedown(n,o),ct()}move(n,o){const f=this.map,_=this.mouseRotate.mousemoveWindow(n,o),y=_&&_.bearingDelta;if(y&&f.setBearing(f.getBearing()+y),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,o),S=w&&w.pitchDelta;S&&f.setPitch(f.getPitch()+S)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){gt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.e({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Wt(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Wt(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ui(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=ui(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const bu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ar={maxWidth:100,unit:"metric"},Lo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.dk,supported:q,setRTLTextPlugin:s.dm,getRTLTextPluginStatus:s.dn,Map:class extends Cn{constructor(h){const n=h;if((h=s.e({},Bp,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&s.d9(window)&&(h.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new kl(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!1,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new zp,this._domRenderTaskQueue=new zp,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aC(),this._locale=s.e({},lc,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Sd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.da(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?{...h.contextCreateOptions}:{},typeof h.container=="string"){const o=document.getElementById(h.container);if(!o)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=o}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Ed,this._tp=h.devtools?new Zl(this):new Zl,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,o=>{this.repaint=o}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,o=>{this.showTileAABBs=o}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,o=>{this.showPadding=o}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new mg(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||s.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new pu(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const o=h.bounds;o&&(this.resize(),this.fitBounds(o,s.e({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Td({customAttribution:h.customAttribution})),this._logoControl=new Rp,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new s.b(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.b(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(h,n){if(n===void 0&&(n=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=h.onAdd(this);this._controls.push(h);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(o,f.firstChild):f.appendChild(o),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(h);return n>-1&&this._controls.splice(n,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.b("movestart",h)).fire(new s.b("move",h)),this.fire(new s.b("resize",h)),n&&this.fire(new s.b("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(s.ad.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new s.b("zoomstart")).fire(new s.b("zoom")).fire(new s.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new s.b("zoomstart")).fire(new s.b("zoom")).fire(new s.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new s.b("pitchstart")).fire(new s.b("pitch")).fire(new s.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new s.b("pitchstart")).fire(new s.b("pitch")).fire(new s.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(n=>n==="auto"?navigator.language:n):h}setLanguage(h){const n=this._parseLanguage(h);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,n=h.projection.name;let o;n==="globe"&&h.zoom>=s.bx?(h.setMercatorFromTransition(),o=!0):n==="mercator"&&h.zoom<s.bx&&(h.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,n){return this._updateProjection(h||n||{name:"mercator"})}_updateProjection(h){let n;return n=h.name==="globe"&&this.transform.zoom>=s.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(s.bn.convert(h))}unproject(h){return this.transform.pointLocation3D(s.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,n,o){if(h==="mouseenter"||h==="mouseover"){let f=!1;const _=w=>{const S=n.filter(D=>this.getLayer(D)),I=S.length?this.queryRenderedFeatures(w.point,{layers:S}):[];I.length?f||(f=!0,o.call(this,new Rr(h,this,w.originalEvent,{features:I}))):f=!1},y=()=>{f=!1};return{layers:new Set(n),listener:o,delegates:{mousemove:_,mouseout:y}}}if(h==="mouseleave"||h==="mouseout"){let f=!1;const _=w=>{const S=n.filter(I=>this.getLayer(I));(S.length?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?f=!0:f&&(f=!1,o.call(this,new Rr(h,this,w.originalEvent)))},y=w=>{f&&(f=!1,o.call(this,new Rr(h,this,w.originalEvent)))};return{layers:new Set(n),listener:o,delegates:{mousemove:_,mouseout:y}}}{const f=_=>{const y=n.filter(S=>this.getLayer(S)),w=y.length?this.queryRenderedFeatures(_.point,{layers:y}):[];w.length&&(_.features=w,o.call(this,_),delete _.features)};return{layers:new Set(n),listener:o,delegates:{[h]:f}}}}on(h,n,o){if(o===void 0)return super.on(h,n);if(Array.isArray(n)||(n=[n]),n){for(const _ of n)if(!this._isValidId(_))return this}const f=this._createDelegatedListener(h,n,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(h,n,o){if(o===void 0)return super.once(h,n);if(Array.isArray(n)||(n=[n]),n){for(const _ of n)if(!this._isValidId(_))return this}const f=this._createDelegatedListener(h,n,o);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(h,n,o){if(o===void 0)return super.off(h,n);n=new Set(Array.isArray(n)?n:[n]);for(const y of n)if(!this._isValidId(y))return this;const f=(y,w)=>{if(y.size!==w.size)return!1;for(const S of y)if(!w.has(S))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(y=>{for(let w=0;w<y.length;w++){const S=y[w];if(S.listener===o&&f(S.layers,n)){for(const I in S.delegates)this.off(I,S.delegates[I]);return y.splice(w,1),this}}})(_),this}queryRenderedFeatures(h,n){if(!this.style)return[];if(n!==void 0||h===void 0||h instanceof s.P||Array.isArray(h)||(n=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(const o of n.layers)if(!this._isValidId(o))return[]}return this.style.queryRenderedFeatures(h,n,this.transform)}querySourceFeatures(h,n){return this._isValidId(h)?this.style.querySourceFeatures(h,n):[]}isPointOnSurface(h){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(h))}setStyle(h,n){return(n=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(h,n))}_getUIString(h){const n=this._locale[h];if(n==null)throw new Error(`Missing UI string '${h}'`);return n}_updateStyle(h,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new Ts(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,n){if(typeof h=="string"){const o=this._requestManager.normalizeStyleURL(h),f=this._requestManager.transformRequest(o,s.R.Style);s.g(f,(_,y)=>{_?this.fire(new s.a(_)):y&&this._updateDiff(y,n)})}else typeof h=="object"&&this._updateDiff(h,n)}_updateDiff(h,n){try{this.style.setState(h)&&this._update(!0)}catch(o){s.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(h,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new s.a(new Error("IDs can't be empty."))),!1):!s.c4(h)||(this.fire(new s.a(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}addSource(h,n){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,n),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,n,o){this._lazyInitEmptyStyle(),this.style.addSourceType(h,n,o)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,n,{pixelRatio:o=1,sdf:f=!1,stretchX:_,stretchY:y,content:w}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:S,height:I,data:D}=s.f.getImageData(n);this.style.addImage(h,{data:new s.h({width:S,height:I},D),pixelRatio:o,stretchX:_,stretchY:y,content:w,sdf:f,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new s.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:I}=n,D=n;this.style.addImage(h,{data:new s.h({width:S,height:I},new Uint8Array(D.data)),pixelRatio:o,stretchX:_,stretchY:y,content:w,sdf:f,version:0,userImage:D}),D.onAdd&&D.onAdd(this,h)}}updateImage(h,n){this._lazyInitEmptyStyle();const o=this.style.getImage(h);if(!o)return void this.fire(new s.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.f.getImageData(n):n,{width:_,height:y}=f,w=f.data;if(_===void 0||y===void 0)return void this.fire(new s.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==o.data.width||y!==o.data.height)return void this.fire(new s.a(new Error(`The width and height of the updated image (${_}, ${y})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));const S=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);o.data.replace(w,S),this.style.updateImage(h,o)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new s.a(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,n){s.d(this._requestManager.transformRequest(h,s.R.Image),(o,f)=>{n(o,f instanceof HTMLImageElement?s.f.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(h,n){this._lazyInitEmptyStyle(),this.style.addModel(h,n)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new s.a(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,n){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,n),this._update(!0)):this}getSlot(h){const n=this.getLayer(h);return n&&n.slot||null}setSlot(h,n){return this.style.setSlot(h,n),this.style.mergeLayers(),this._update(!0)}addImport(h,n){return this.style.addImport(h,n),this}updateImport(h,n){return typeof n!="string"&&n.id!==h?(this.removeImport(h),this.addImport(n)):(this.style.updateImport(h,n),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,n){return this.style.moveImport(h,n),this._update(!0)}moveLayer(h,n){return this._isValidId(h)?(this.style.moveLayer(h,n),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){return this._isValidId(h)?this.style.getOwnLayer(h):null}setLayerZoomRange(h,n,o){return this._isValidId(h)?(this.style.setLayerZoomRange(h,n,o),this._update(!0)):this}setFilter(h,n,o={}){return this._isValidId(h)?(this.style.setFilter(h,n,o),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,n,o,f={}){return this._isValidId(h)?(this.style.setPaintProperty(h,n,o,f),this._update(!0)):this}getPaintProperty(h,n){return this._isValidId(h)?this.style.getPaintProperty(h,n):null}setLayoutProperty(h,n,o,f={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,n,o,f),this._update(!0)):this}getLayoutProperty(h,n){return this._isValidId(h)?this.style.getLayoutProperty(h,n):null}getConfigProperty(h,n){return this.style.getConfigProperty(h,n)}setConfigProperty(h,n,o){return this.style.setConfigProperty(h,n,o),this._update(!0)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const n=h[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bn.convert(h),this.transform):0}setFeatureState(h,n){return this._isValidId(h.source)?(this.style.setFeatureState(h,n),this._update()):this}removeFeatureState(h,n){return this._isValidId(h.source)?(this.style.removeFeatureState(h,n),this._update()):this}getFeatureState(h){return this._isValidId(h.source)?this.style.getFeatureState(h):null}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let o,f,_,y=this._container;for(;y&&(!f||!_);){const w=window.getComputedStyle(y).transform;w&&w!=="none"&&(o=w.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(f=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(_=o[3])),y=y.parentElement}this._containerWidth=f?Math.abs(h/f):h,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=ue("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ue("div","mapboxgl-canvas-container",h);this._canvas=ue("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=ue("div","mapboxgl-control-container",h),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{f[_]=ue("div",`mapboxgl-ctrl-${_}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,n){const o=s.f.devicePixelRatio||1;this._canvas.width=o*Math.ceil(h),this._canvas.height=o*Math.ceil(n),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${n}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const n=this._markers.indexOf(h);n!==-1&&this._markers.splice(n,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const n=this._popups.indexOf(h);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const h=s.e({},q.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",h);n?(s.db(n,!0),this.painter=new wp(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.dc.testSupport(n)):this.fire(new s.a(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.b("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new s.b("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let n;this.fire(new s.b("renderstart"));const o=this.painter.context.extTimerQuery,f=s.f.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=_.createQuery(),_.beginQuery(o.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,D=this.transform.pitch,L=s.f.now(),z=new s.K(I,{now:L,fadeDuration:y,pitch:D,transition:this.style.transition});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const I=s.f.now()-f;_.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const D=_.getQueryParameter(n,_.QUERY_RESULT)/1e6;_.deleteQuery(n),this.fire(new s.b("gpu-timing-frame",{cpuTime:I,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(I);this.fire(new s.b("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(I);this.fire(new s.b("gpu-timing-deferred-render",{gpuTime:D}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(S||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(w=this._updateAverageElevation(f,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new s.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new s.b("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const n of this._markers)h&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!h||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(h,n=!1){const o=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(n||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=h;const w=Math.abs(_-y);if(w>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(y),o(y);this._averageElevation.easeTo(y,h,300)}else if(w>1e-4)return this._averageElevation.jumpTo(y),o(y)}return!!this._averageElevation.isEasing(h)&&o(this._averageElevation.getValue(h))}_authenticate(){s.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===s.df||h.status===401)){const n=this.painter.context.gl;s.db(n,!1),this._logoControl instanceof Rp&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const o=this.painter.context.gl,f=o.createFramebuffer();function _(y){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,y,0);const w=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,w),w}return o.bindFramebuffer(o.FRAMEBUFFER,f),this._canvasPixelComparison(_(h),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(h,n,o){let f=o[1]-o[0];const _=h.length/4;for(let y=0;y<n.length;y++){const w=n[y];let S=0;for(let I=0;I<w.length;I+=4)w[I]===h[I]&&w[I+1]===h[I+1]&&w[I+2]===h[I+2]&&w[I+3]===h[I+3]&&(S+=1);f+=(o[y+2]-o[y+1])*(1-S/_)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.dh(this.painter.context.gl),s.di.remove(),s.dj.remove(),this._removed=!0,this.fire(new s.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=s.f.frame(n=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(n)}))}_preloadTiles(h){const n=this.style?Object.values(this.style._sourceCaches):[];return s.b1(n,(o,f)=>o._preloadTiles(h,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,n){s.dl(h,n)}get version(){return s.dk}},NavigationControl:class{constructor(h){this.options=s.e({},vu,h),this._container=ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),ue("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),ue("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:n}):o.resetNorth({},{originalEvent:n}))}),this._compassIcon=ue("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const n=h.getZoom(),o=n===h.getMaxZoom(),f=n===h.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Js(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,n){const o=ue("button",h,this._container);return o.type="button",o.addEventListener("click",n),o}_setButtonTitle(h,n){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${n}`);h.setAttribute("aria-label",o),h.firstElementChild&&h.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends s.E{constructor(h){super();const n=navigator.geolocation;this.options=s.e({geolocation:n},bu,h),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const n=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,h(o)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>n(o.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(h){const n=this._map.getMaxBounds(),o=h.coords;return!!n&&(o.longitude<n.getWest()||o.longitude>n.getEast()||o.latitude<n.getSouth()||o.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.b("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.b("geolocate",h)),this._finish()}}_updateCamera(h){const n=new s.bn(h.coords.longitude,h.coords.latitude),o=h.coords.accuracy,f=this._map.getBearing(),_=s.e({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(o),_,{geolocateSource:!0})}_updateMarker(h){if(h){const n=new s.bn(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,n=s.bl(1,h._center.lat)*h.worldSize,o=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.b("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ue("button","mapboxgl-ctrl-geolocate",this._container),ue("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ue("div","mapboxgl-user-location"),this._dotElement.appendChild(ue("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ue("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Md({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ue("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Md({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.b("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Td,ScaleControl:class{constructor(h){this.options=s.e({},Ar,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,n=this._map,o=n._containerHeight/2,f=n._containerWidth/2-h/2,_=n.unproject([f,o]),y=n.unproject([f+h,o]),w=_.distanceTo(y);if(this.options.unit==="imperial"){const S=3.2808*w;S>5280?this._setScale(h,S/5280,"mile"):this._setScale(h,S,"foot")}else this.options.unit==="nautical"?this._setScale(h,w/1852,"nautical-mile"):w>=1e3?this._setScale(h,w/1e3,"kilometer"):this._setScale(h,w,"meter")}_setScale(h,n,o){this._map._requestDomTask(()=>{const f=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(I){const D=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*D)/D}(S),w*S}(n),_=f/n;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(f):`${f}&nbsp;${Lo[o]}`,this._container.style.width=h*_+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=ue("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=ue("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ue("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(h){super(),this.options=s.e(Object.create(kp),h),s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new s.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new s.b("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=s.bn.convert(h),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const n=document.createDocumentFragment(),o=document.createElement("body");let f;for(o.innerHTML=h;f=o.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ue("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(h),this.options.closeButton){const o=this._closeButton=ue("button","mapboxgl-popup-close-button",n);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let n;return this._classList.delete(h)?n=!1:(this._classList.add(h),n=!0),this._updateClassList(),n}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const n=this._map,o=this._container,f=this._pos;if(!n||!o||!f)return"bottom";const _=o.offsetWidth,y=o.offsetHeight,w=f.x<_/2,S=f.x>n.transform.width-_/2;if(f.y+h<y)return w?"top-left":S?"top-right":"top";if(f.y>n.transform.height-y){if(w)return"bottom-left";if(S)return"bottom-right"}return w?"left":S?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),h.className=n.join(" ")}_update(h){const n=this._map,o=this._content;if(!n||!this._lngLat&&!this._trackPointer||!o)return;let f=this._container;if(f||(f=this._container=ue("div","mapboxgl-popup",n.getContainer()),this._tip=ue("div","mapboxgl-popup-tip",f),f.appendChild(o)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ac(this._lngLat,this._pos,n.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:n.project(this._lngLat),y=Fp(this.options.offset),w=this._anchor=this._getAnchor(y.y),S=Fp(this.options.offset,w),I=_.add(S).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${xu[w]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&n._showingGlobe()){const _=s.d6(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Op);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Md,Style:Ts,LngLat:s.bn,LngLatBounds:s.ad,Point:s.P,MercatorCoordinate:s.L,FreeCameraOptions:Rl,Evented:s.E,config:s.d5,prewarm:s.dp,clearPrewarmedResources:s.dq,get accessToken(){return s.d5.ACCESS_TOKEN},set accessToken(h){s.d5.ACCESS_TOKEN=h},get baseApiUrl(){return s.d5.API_URL},set baseApiUrl(h){s.d5.API_URL=h},get workerCount(){return s.dr.workerCount},set workerCount(h){s.dr.workerCount=h},get maxParallelImageRequests(){return s.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){s.d5.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){s.ds(h)},get workerUrl(){return s.dt.workerUrl},set workerUrl(h){s.dt.workerUrl=h},get workerClass(){return s.dt.workerClass},set workerClass(h){s.dt.workerClass=h},get workerParams(){return s.dt.workerParams},set workerParams(h){s.dt.workerParams=h},get dracoUrl(){return s.du()},set dracoUrl(h){s.dv(h)},get meshoptUrl(){return s.dw()},set meshoptUrl(h){s.dx(h)},setNow:s.f.setNow,restoreNow:s.f.restoreNow}});var P=T;return P})})(cS);var hS=cS.exports;const dS=aL(hS),yr=R_({selectedFeature:{},formData:{},map:{}});function lL(c){for(var a={},d,m,x,T=0;T<c.geometry.coordinates.length;T++){c.geometry.coordinates.length===1?d=c.geometry.coordinates[0]:d=c.geometry.coordinates[T][0];for(var E=0;E<d.length;E++)x=d[E][0],m=d[E][1],a.xMin=a.xMin<x?a.xMin:x,a.xMax=a.xMax>x?a.xMax:x,a.yMin=a.yMin<m?a.yMin:m,a.yMax=a.yMax>m?a.yMax:m}return a}const fS=(c,a)=>{const d=c.__vccOpts||c;for(const[m,x]of a)d[m]=x;return d};dS.accessToken="pk.eyJ1IjoibW1vbHRhIiwiYSI6ImNqZDBkMDZhYjJ6YzczNHJ4cno5eTcydnMifQ.RJNJ7s7hBfrJITOBZBdcOA";const cL={props:["modelValue"],data:()=>({map:null}),mounted(){const{lng:c,lat:a,zoom:d,bearing:m,pitch:x}=this.modelValue;new hS.LngLatBounds([[-76.09405517578125,39.49211914385648],[-74.32525634765625,40.614734298694216]]);const T=new dS.Map({container:this.$refs.mapContainer,style:"mapbox://styles/mapbox/light-v11",center:[-75.2273,40.071],bearing:m,pitch:x,zoom:d});yr.map=T,T.on("load",()=>{T.addSource("parcels",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),T.addLayer({id:"parcels-fill",type:"fill",source:"parcels",layout:{},paint:{"fill-color":"#1868d1","fill-opacity":["case",["boolean",["feature-state","click"],!1],.8,.2]}})}),T.on("click","parcels-fill",E=>{yr.selectedFeature=E.features[0],T.removeFeatureState({source:"parcels"}),T.setFeatureState({source:"parcels",id:yr.selectedFeature.id},{click:!0}),yr.formData={}}),this.map=T,Dc(()=>yr.selectedFeature,E=>{if(Object.keys(E).length){T.getSource("parcels").setData(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=${encodeURI(JSON.stringify({rings:[...E.geometry.coordinates],spatialReference:{wkid:4326}}))}&geometryType=esriGeometryPolygon&inSR=&spatialRel=esriSpatialRelEnvelopeIntersects&resultType=none&distance=&units=esriSRUnit_Meter&relationParam=&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&returnEnvelope=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&defaultSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token=`);const P=lL(E),{xMin:s,xMax:B,yMin:q,yMax:Z}=P;s&&T.fitBounds([[s,q],[B,Z]],{maxZoom:17})}})},unmounted(){this.map.remove(),this.map=null}},uL={ref:"mapContainer",class:"map-container"};function hL(c,a,d,m,x,T){return Gs(),$o("div",uL,null,512)}const dL=fS(cL,[["render",hL]]),fL=["name","placeholder"],Um={__name:"TextField",props:JP({placeholder:String,name:String,required:Boolean},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const a=DD(c,"modelValue");return(d,m)=>BP((Gs(),$o("input",{class:"pvm-search-control-input",type:"text","onUpdate:modelValue":m[0]||(m[0]=x=>a.value=x),name:c.name,placeholder:c.placeholder,required:""},null,8,fL)),[[eL,a.value]])}},pL={props:{text:String}},mL={class:"btn"};function _L(c,a,d,m,x,T){return Gs(),$o("button",mL,Xu(d.text),1)}const gL=fS(pL,[["render",_L]]);function yL(c,a){let d;return function(...m){d&&clearTimeout(d);const x=this;d=setTimeout(()=>{c.apply(x,m)},a)}}/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function Nf(c){return c+.5|0}const dl=(c,a,d)=>Math.max(Math.min(c,d),a);function ff(c){return dl(Nf(c*2.55),0,255)}function yl(c){return dl(Nf(c*255),0,255)}function ya(c){return dl(Nf(c/2.55)/100,0,1)}function Hw(c){return dl(Nf(c*100),0,100)}const js={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},g0=[..."0123456789ABCDEF"],xL=c=>g0[c&15],vL=c=>g0[(c&240)>>4]+g0[c&15],jm=c=>(c&240)>>4===(c&15),bL=c=>jm(c.r)&&jm(c.g)&&jm(c.b)&&jm(c.a);function wL(c){var a=c.length,d;return c[0]==="#"&&(a===4||a===5?d={r:255&js[c[1]]*17,g:255&js[c[2]]*17,b:255&js[c[3]]*17,a:a===5?js[c[4]]*17:255}:(a===7||a===9)&&(d={r:js[c[1]]<<4|js[c[2]],g:js[c[3]]<<4|js[c[4]],b:js[c[5]]<<4|js[c[6]],a:a===9?js[c[7]]<<4|js[c[8]]:255})),d}const TL=(c,a)=>c<255?a(c):"";function ML(c){var a=bL(c)?xL:vL;return c?"#"+a(c.r)+a(c.g)+a(c.b)+TL(c.a,a):void 0}const SL=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function pS(c,a,d){const m=a*Math.min(d,1-d),x=(T,E=(T+c/30)%12)=>d-m*Math.max(Math.min(E-3,9-E,1),-1);return[x(0),x(8),x(4)]}function EL(c,a,d){const m=(x,T=(x+c/60)%6)=>d-d*a*Math.max(Math.min(T,4-T,1),0);return[m(5),m(3),m(1)]}function AL(c,a,d){const m=pS(c,1,.5);let x;for(a+d>1&&(x=1/(a+d),a*=x,d*=x),x=0;x<3;x++)m[x]*=1-a-d,m[x]+=a;return m}function IL(c,a,d,m,x){return c===x?(a-d)/m+(a<d?6:0):a===x?(d-c)/m+2:(c-a)/m+4}function X0(c){const d=c.r/255,m=c.g/255,x=c.b/255,T=Math.max(d,m,x),E=Math.min(d,m,x),P=(T+E)/2;let s,B,q;return T!==E&&(q=T-E,B=P>.5?q/(2-T-E):q/(T+E),s=IL(d,m,x,q,T),s=s*60+.5),[s|0,B||0,P]}function Y0(c,a,d,m){return(Array.isArray(a)?c(a[0],a[1],a[2]):c(a,d,m)).map(yl)}function K0(c,a,d){return Y0(pS,c,a,d)}function CL(c,a,d){return Y0(AL,c,a,d)}function PL(c,a,d){return Y0(EL,c,a,d)}function mS(c){return(c%360+360)%360}function DL(c){const a=SL.exec(c);let d=255,m;if(!a)return;a[5]!==m&&(d=a[6]?ff(+a[5]):yl(+a[5]));const x=mS(+a[2]),T=+a[3]/100,E=+a[4]/100;return a[1]==="hwb"?m=CL(x,T,E):a[1]==="hsv"?m=PL(x,T,E):m=K0(x,T,E),{r:m[0],g:m[1],b:m[2],a:d}}function LL(c,a){var d=X0(c);d[0]=mS(d[0]+a),d=K0(d),c.r=d[0],c.g=d[1],c.b=d[2]}function RL(c){if(!c)return;const a=X0(c),d=a[0],m=Hw(a[1]),x=Hw(a[2]);return c.a<255?`hsla(${d}, ${m}%, ${x}%, ${ya(c.a)})`:`hsl(${d}, ${m}%, ${x}%)`}const Ww={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Zw={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function zL(){const c={},a=Object.keys(Zw),d=Object.keys(Ww);let m,x,T,E,P;for(m=0;m<a.length;m++){for(E=P=a[m],x=0;x<d.length;x++)T=d[x],P=P.replace(T,Ww[T]);T=parseInt(Zw[E],16),c[P]=[T>>16&255,T>>8&255,T&255]}return c}let Gm;function kL(c){Gm||(Gm=zL(),Gm.transparent=[0,0,0,0]);const a=Gm[c.toLowerCase()];return a&&{r:a[0],g:a[1],b:a[2],a:a.length===4?a[3]:255}}const OL=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function FL(c){const a=OL.exec(c);let d=255,m,x,T;if(a){if(a[7]!==m){const E=+a[7];d=a[8]?ff(E):dl(E*255,0,255)}return m=+a[1],x=+a[3],T=+a[5],m=255&(a[2]?ff(m):dl(m,0,255)),x=255&(a[4]?ff(x):dl(x,0,255)),T=255&(a[6]?ff(T):dl(T,0,255)),{r:m,g:x,b:T,a:d}}}function BL(c){return c&&(c.a<255?`rgba(${c.r}, ${c.g}, ${c.b}, ${ya(c.a)})`:`rgb(${c.r}, ${c.g}, ${c.b})`)}const qy=c=>c<=.0031308?c*12.92:Math.pow(c,1/2.4)*1.055-.055,Gu=c=>c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4);function NL(c,a,d){const m=Gu(ya(c.r)),x=Gu(ya(c.g)),T=Gu(ya(c.b));return{r:yl(qy(m+d*(Gu(ya(a.r))-m))),g:yl(qy(x+d*(Gu(ya(a.g))-x))),b:yl(qy(T+d*(Gu(ya(a.b))-T))),a:c.a+d*(a.a-c.a)}}function $m(c,a,d){if(c){let m=X0(c);m[a]=Math.max(0,Math.min(m[a]+m[a]*d,a===0?360:1)),m=K0(m),c.r=m[0],c.g=m[1],c.b=m[2]}}function _S(c,a){return c&&Object.assign(a||{},c)}function Xw(c){var a={r:0,g:0,b:0,a:255};return Array.isArray(c)?c.length>=3&&(a={r:c[0],g:c[1],b:c[2],a:255},c.length>3&&(a.a=yl(c[3]))):(a=_S(c,{r:0,g:0,b:0,a:1}),a.a=yl(a.a)),a}function VL(c){return c.charAt(0)==="r"?FL(c):DL(c)}class Lf{constructor(a){if(a instanceof Lf)return a;const d=typeof a;let m;d==="object"?m=Xw(a):d==="string"&&(m=wL(a)||kL(a)||VL(a)),this._rgb=m,this._valid=!!m}get valid(){return this._valid}get rgb(){var a=_S(this._rgb);return a&&(a.a=ya(a.a)),a}set rgb(a){this._rgb=Xw(a)}rgbString(){return this._valid?BL(this._rgb):void 0}hexString(){return this._valid?ML(this._rgb):void 0}hslString(){return this._valid?RL(this._rgb):void 0}mix(a,d){if(a){const m=this.rgb,x=a.rgb;let T;const E=d===T?.5:d,P=2*E-1,s=m.a-x.a,B=((P*s===-1?P:(P+s)/(1+P*s))+1)/2;T=1-B,m.r=255&B*m.r+T*x.r+.5,m.g=255&B*m.g+T*x.g+.5,m.b=255&B*m.b+T*x.b+.5,m.a=E*m.a+(1-E)*x.a,this.rgb=m}return this}interpolate(a,d){return a&&(this._rgb=NL(this._rgb,a._rgb,d)),this}clone(){return new Lf(this.rgb)}alpha(a){return this._rgb.a=yl(a),this}clearer(a){const d=this._rgb;return d.a*=1-a,this}greyscale(){const a=this._rgb,d=Nf(a.r*.3+a.g*.59+a.b*.11);return a.r=a.g=a.b=d,this}opaquer(a){const d=this._rgb;return d.a*=1+a,this}negate(){const a=this._rgb;return a.r=255-a.r,a.g=255-a.g,a.b=255-a.b,this}lighten(a){return $m(this._rgb,2,a),this}darken(a){return $m(this._rgb,2,-a),this}saturate(a){return $m(this._rgb,1,a),this}desaturate(a){return $m(this._rgb,1,-a),this}rotate(a){return LL(this._rgb,a),this}}/*!
 * Chart.js v4.4.2
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function ma(){}const UL=(()=>{let c=0;return()=>c++})();function Dn(c){return c===null||typeof c>"u"}function Yn(c){if(Array.isArray&&Array.isArray(c))return!0;const a=Object.prototype.toString.call(c);return a.slice(0,7)==="[object"&&a.slice(-6)==="Array]"}function fn(c){return c!==null&&Object.prototype.toString.call(c)==="[object Object]"}function Cr(c){return(typeof c=="number"||c instanceof Number)&&isFinite(+c)}function Rs(c,a){return Cr(c)?c:a}function Hn(c,a){return typeof c>"u"?a:c}const jL=(c,a)=>typeof c=="string"&&c.endsWith("%")?parseFloat(c)/100:+c/a,gS=(c,a)=>typeof c=="string"&&c.endsWith("%")?parseFloat(c)/100*a:+c;function ir(c,a,d){if(c&&typeof c.call=="function")return c.apply(d,a)}function In(c,a,d,m){let x,T,E;if(Yn(c))for(T=c.length,x=0;x<T;x++)a.call(d,c[x],x);else if(fn(c))for(E=Object.keys(c),T=E.length,x=0;x<T;x++)a.call(d,c[E[x]],E[x])}function x_(c,a){let d,m,x,T;if(!c||!a||c.length!==a.length)return!1;for(d=0,m=c.length;d<m;++d)if(x=c[d],T=a[d],x.datasetIndex!==T.datasetIndex||x.index!==T.index)return!1;return!0}function v_(c){if(Yn(c))return c.map(v_);if(fn(c)){const a=Object.create(null),d=Object.keys(c),m=d.length;let x=0;for(;x<m;++x)a[d[x]]=v_(c[d[x]]);return a}return c}function yS(c){return["__proto__","prototype","constructor"].indexOf(c)===-1}function GL(c,a,d,m){if(!yS(c))return;const x=a[c],T=d[c];fn(x)&&fn(T)?Rf(x,T,m):a[c]=v_(T)}function Rf(c,a,d){const m=Yn(a)?a:[a],x=m.length;if(!fn(c))return c;d=d||{};const T=d.merger||GL;let E;for(let P=0;P<x;++P){if(E=m[P],!fn(E))continue;const s=Object.keys(E);for(let B=0,q=s.length;B<q;++B)T(s[B],c,E,d)}return c}function Tf(c,a){return Rf(c,a,{merger:$L})}function $L(c,a,d){if(!yS(c))return;const m=a[c],x=d[c];fn(m)&&fn(x)?Tf(m,x):Object.prototype.hasOwnProperty.call(a,c)||(a[c]=v_(x))}const Yw={"":c=>c,x:c=>c.x,y:c=>c.y};function qL(c){const a=c.split("."),d=[];let m="";for(const x of a)m+=x,m.endsWith("\\")?m=m.slice(0,-1)+".":(d.push(m),m="");return d}function HL(c){const a=qL(c);return d=>{for(const m of a){if(m==="")break;d=d&&d[m]}return d}}function vl(c,a){return(Yw[a]||(Yw[a]=HL(a)))(c)}function J0(c){return c.charAt(0).toUpperCase()+c.slice(1)}const zf=c=>typeof c<"u",bl=c=>typeof c=="function",Kw=(c,a)=>{if(c.size!==a.size)return!1;for(const d of c)if(!a.has(d))return!1;return!0};function WL(c){return c.type==="mouseup"||c.type==="click"||c.type==="contextmenu"}const hr=Math.PI,_s=2*hr,b_=Number.POSITIVE_INFINITY,ZL=hr/180,es=hr/2,wc=hr/4,Jw=hr*2/3,fl=Math.log10,xl=Math.sign;function l_(c,a,d){return Math.abs(c-a)<d}function Qw(c){const a=Math.round(c);c=l_(c,a,c/1e3)?a:c;const d=Math.pow(10,Math.floor(fl(c))),m=c/d;return(m<=1?1:m<=2?2:m<=5?5:10)*d}function XL(c){const a=[],d=Math.sqrt(c);let m;for(m=1;m<d;m++)c%m===0&&(a.push(m),a.push(c/m));return d===(d|0)&&a.push(d),a.sort((x,T)=>x-T).pop(),a}function w_(c){return!isNaN(parseFloat(c))&&isFinite(c)}function YL(c,a){const d=Math.round(c);return d-a<=c&&d+a>=c}function xS(c,a,d){let m,x,T;for(m=0,x=c.length;m<x;m++)T=c[m][d],isNaN(T)||(a.min=Math.min(a.min,T),a.max=Math.max(a.max,T))}function uo(c){return c*(hr/180)}function Q0(c){return c*(180/hr)}function eT(c){if(!Cr(c))return;let a=1,d=0;for(;Math.round(c*a)/a!==c;)a*=10,d++;return d}function KL(c,a){const d=a.x-c.x,m=a.y-c.y,x=Math.sqrt(d*d+m*m);let T=Math.atan2(m,d);return T<-.5*hr&&(T+=_s),{angle:T,distance:x}}function JL(c,a){return Math.sqrt(Math.pow(a.x-c.x,2)+Math.pow(a.y-c.y,2))}function Uo(c){return(c%_s+_s)%_s}function y0(c,a,d,m){const x=Uo(c),T=Uo(a),E=Uo(d),P=Uo(T-x),s=Uo(E-x),B=Uo(x-T),q=Uo(x-E);return x===T||x===E||m&&T===E||P>s&&B<q}function ho(c,a,d){return Math.max(a,Math.min(d,c))}function QL(c){return ho(c,-32768,32767)}function tT(c,a,d,m=1e-6){return c>=Math.min(a,d)-m&&c<=Math.max(a,d)+m}function ex(c,a,d){d=d||(E=>c[E]<a);let m=c.length-1,x=0,T;for(;m-x>1;)T=x+m>>1,d(T)?x=T:m=T;return{lo:x,hi:m}}const x0=(c,a,d,m)=>ex(c,d,m?x=>{const T=c[x][a];return T<d||T===d&&c[x+1][a]===d}:x=>c[x][a]<d),eR=(c,a,d)=>ex(c,d,m=>c[m][a]>=d);function tR(c,a,d){let m=0,x=c.length;for(;m<x&&c[m]<a;)m++;for(;x>m&&c[x-1]>d;)x--;return m>0||x<c.length?c.slice(m,x):c}const vS=["push","pop","shift","splice","unshift"];function iR(c,a){if(c._chartjs){c._chartjs.listeners.push(a);return}Object.defineProperty(c,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[a]}}),vS.forEach(d=>{const m="_onData"+J0(d),x=c[d];Object.defineProperty(c,d,{configurable:!0,enumerable:!1,value(...T){const E=x.apply(this,T);return c._chartjs.listeners.forEach(P=>{typeof P[m]=="function"&&P[m](...T)}),E}})})}function iT(c,a){const d=c._chartjs;if(!d)return;const m=d.listeners,x=m.indexOf(a);x!==-1&&m.splice(x,1),!(m.length>0)&&(vS.forEach(T=>{delete c[T]}),delete c._chartjs)}function bS(c){const a=new Set(c);return a.size===c.length?c:Array.from(a)}const wS=function(){return typeof window>"u"?function(c){return c()}:window.requestAnimationFrame}();function TS(c,a){let d=[],m=!1;return function(...x){d=x,m||(m=!0,wS.call(window,()=>{m=!1,c.apply(a,d)}))}}function nR(c,a){let d;return function(...m){return a?(clearTimeout(d),d=setTimeout(c,a,m)):c.apply(this,m),a}}const MS=c=>c==="start"?"left":c==="end"?"right":"center",Mf=(c,a,d)=>c==="start"?a:c==="end"?d:(a+d)/2,qm=c=>c===0||c===1,nT=(c,a,d)=>-(Math.pow(2,10*(c-=1))*Math.sin((c-a)*_s/d)),rT=(c,a,d)=>Math.pow(2,-10*c)*Math.sin((c-a)*_s/d)+1,Sf={linear:c=>c,easeInQuad:c=>c*c,easeOutQuad:c=>-c*(c-2),easeInOutQuad:c=>(c/=.5)<1?.5*c*c:-.5*(--c*(c-2)-1),easeInCubic:c=>c*c*c,easeOutCubic:c=>(c-=1)*c*c+1,easeInOutCubic:c=>(c/=.5)<1?.5*c*c*c:.5*((c-=2)*c*c+2),easeInQuart:c=>c*c*c*c,easeOutQuart:c=>-((c-=1)*c*c*c-1),easeInOutQuart:c=>(c/=.5)<1?.5*c*c*c*c:-.5*((c-=2)*c*c*c-2),easeInQuint:c=>c*c*c*c*c,easeOutQuint:c=>(c-=1)*c*c*c*c+1,easeInOutQuint:c=>(c/=.5)<1?.5*c*c*c*c*c:.5*((c-=2)*c*c*c*c+2),easeInSine:c=>-Math.cos(c*es)+1,easeOutSine:c=>Math.sin(c*es),easeInOutSine:c=>-.5*(Math.cos(hr*c)-1),easeInExpo:c=>c===0?0:Math.pow(2,10*(c-1)),easeOutExpo:c=>c===1?1:-Math.pow(2,-10*c)+1,easeInOutExpo:c=>qm(c)?c:c<.5?.5*Math.pow(2,10*(c*2-1)):.5*(-Math.pow(2,-10*(c*2-1))+2),easeInCirc:c=>c>=1?c:-(Math.sqrt(1-c*c)-1),easeOutCirc:c=>Math.sqrt(1-(c-=1)*c),easeInOutCirc:c=>(c/=.5)<1?-.5*(Math.sqrt(1-c*c)-1):.5*(Math.sqrt(1-(c-=2)*c)+1),easeInElastic:c=>qm(c)?c:nT(c,.075,.3),easeOutElastic:c=>qm(c)?c:rT(c,.075,.3),easeInOutElastic(c){return qm(c)?c:c<.5?.5*nT(c*2,.1125,.45):.5+.5*rT(c*2-1,.1125,.45)},easeInBack(c){return c*c*((1.70158+1)*c-1.70158)},easeOutBack(c){return(c-=1)*c*((1.70158+1)*c+1.70158)+1},easeInOutBack(c){let a=1.70158;return(c/=.5)<1?.5*(c*c*(((a*=1.525)+1)*c-a)):.5*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)},easeInBounce:c=>1-Sf.easeOutBounce(1-c),easeOutBounce(c){return c<1/2.75?7.5625*c*c:c<2/2.75?7.5625*(c-=1.5/2.75)*c+.75:c<2.5/2.75?7.5625*(c-=2.25/2.75)*c+.9375:7.5625*(c-=2.625/2.75)*c+.984375},easeInOutBounce:c=>c<.5?Sf.easeInBounce(c*2)*.5:Sf.easeOutBounce(c*2-1)*.5+.5};function SS(c){if(c&&typeof c=="object"){const a=c.toString();return a==="[object CanvasPattern]"||a==="[object CanvasGradient]"}return!1}function sT(c){return SS(c)?c:new Lf(c)}function Hy(c){return SS(c)?c:new Lf(c).saturate(.5).darken(.1).hexString()}const rR=["x","y","borderWidth","radius","tension"],sR=["color","borderColor","backgroundColor"];function oR(c){c.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),c.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:a=>a!=="onProgress"&&a!=="onComplete"&&a!=="fn"}),c.set("animations",{colors:{type:"color",properties:sR},numbers:{type:"number",properties:rR}}),c.describe("animations",{_fallback:"animation"}),c.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:a=>a|0}}}})}function aR(c){c.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const oT=new Map;function lR(c,a){a=a||{};const d=c+JSON.stringify(a);let m=oT.get(d);return m||(m=new Intl.NumberFormat(c,a),oT.set(d,m)),m}function Vf(c,a,d){return lR(a,d).format(c)}const ES={values(c){return Yn(c)?c:""+c},numeric(c,a,d){if(c===0)return"0";const m=this.chart.options.locale;let x,T=c;if(d.length>1){const B=Math.max(Math.abs(d[0].value),Math.abs(d[d.length-1].value));(B<1e-4||B>1e15)&&(x="scientific"),T=cR(c,d)}const E=fl(Math.abs(T)),P=isNaN(E)?1:Math.max(Math.min(-1*Math.floor(E),20),0),s={notation:x,minimumFractionDigits:P,maximumFractionDigits:P};return Object.assign(s,this.options.ticks.format),Vf(c,m,s)},logarithmic(c,a,d){if(c===0)return"0";const m=d[a].significand||c/Math.pow(10,Math.floor(fl(c)));return[1,2,3,5,10,15].includes(m)||a>.8*d.length?ES.numeric.call(this,c,a,d):""}};function cR(c,a){let d=a.length>3?a[2].value-a[1].value:a[1].value-a[0].value;return Math.abs(d)>=1&&c!==Math.floor(c)&&(d=c-Math.floor(c)),d}var U_={formatters:ES};function uR(c){c.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(a,d)=>d.lineWidth,tickColor:(a,d)=>d.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:U_.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),c.route("scale.ticks","color","","color"),c.route("scale.grid","color","","borderColor"),c.route("scale.border","color","","borderColor"),c.route("scale.title","color","","color"),c.describe("scale",{_fallback:!1,_scriptable:a=>!a.startsWith("before")&&!a.startsWith("after")&&a!=="callback"&&a!=="parser",_indexable:a=>a!=="borderDash"&&a!=="tickBorderDash"&&a!=="dash"}),c.describe("scales",{_fallback:"scale"}),c.describe("scale.ticks",{_scriptable:a=>a!=="backdropPadding"&&a!=="callback",_indexable:a=>a!=="backdropPadding"})}const Oc=Object.create(null),v0=Object.create(null);function Ef(c,a){if(!a)return c;const d=a.split(".");for(let m=0,x=d.length;m<x;++m){const T=d[m];c=c[T]||(c[T]=Object.create(null))}return c}function Wy(c,a,d){return typeof a=="string"?Rf(Ef(c,a),d):Rf(Ef(c,""),a)}class hR{constructor(a,d){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=m=>m.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(m,x)=>Hy(x.backgroundColor),this.hoverBorderColor=(m,x)=>Hy(x.borderColor),this.hoverColor=(m,x)=>Hy(x.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(a),this.apply(d)}set(a,d){return Wy(this,a,d)}get(a){return Ef(this,a)}describe(a,d){return Wy(v0,a,d)}override(a,d){return Wy(Oc,a,d)}route(a,d,m,x){const T=Ef(this,a),E=Ef(this,m),P="_"+d;Object.defineProperties(T,{[P]:{value:T[d],writable:!0},[d]:{enumerable:!0,get(){const s=this[P],B=E[x];return fn(s)?Object.assign({},B,s):Hn(s,B)},set(s){this[P]=s}}})}apply(a){a.forEach(d=>d(this))}}var ur=new hR({_scriptable:c=>!c.startsWith("on"),_indexable:c=>c!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[oR,aR,uR]);function dR(c){return!c||Dn(c.size)||Dn(c.family)?null:(c.style?c.style+" ":"")+(c.weight?c.weight+" ":"")+c.size+"px "+c.family}function T_(c,a,d,m,x){let T=a[x];return T||(T=a[x]=c.measureText(x).width,d.push(x)),T>m&&(m=T),m}function fR(c,a,d,m){m=m||{};let x=m.data=m.data||{},T=m.garbageCollect=m.garbageCollect||[];m.font!==a&&(x=m.data={},T=m.garbageCollect=[],m.font=a),c.save(),c.font=a;let E=0;const P=d.length;let s,B,q,Z,ae;for(s=0;s<P;s++)if(Z=d[s],Z!=null&&!Yn(Z))E=T_(c,x,T,E,Z);else if(Yn(Z))for(B=0,q=Z.length;B<q;B++)ae=Z[B],ae!=null&&!Yn(ae)&&(E=T_(c,x,T,E,ae));c.restore();const ue=T.length/2;if(ue>d.length){for(s=0;s<ue;s++)delete x[T[s]];T.splice(0,ue)}return E}function Tc(c,a,d){const m=c.currentDevicePixelRatio,x=d!==0?Math.max(d/2,.5):0;return Math.round((a-x)*m)/m+x}function aT(c,a){a=a||c.getContext("2d"),a.save(),a.resetTransform(),a.clearRect(0,0,c.width,c.height),a.restore()}function lT(c,a,d,m){pR(c,a,d,m)}function pR(c,a,d,m,x){let T,E,P,s,B,q,Z,ae;const ue=a.pointStyle,Le=a.rotation,Ae=a.radius;let Oe=(Le||0)*ZL;if(ue&&typeof ue=="object"&&(T=ue.toString(),T==="[object HTMLImageElement]"||T==="[object HTMLCanvasElement]")){c.save(),c.translate(d,m),c.rotate(Oe),c.drawImage(ue,-ue.width/2,-ue.height/2,ue.width,ue.height),c.restore();return}if(!(isNaN(Ae)||Ae<=0)){switch(c.beginPath(),ue){default:c.arc(d,m,Ae,0,_s),c.closePath();break;case"triangle":q=Ae,c.moveTo(d+Math.sin(Oe)*q,m-Math.cos(Oe)*Ae),Oe+=Jw,c.lineTo(d+Math.sin(Oe)*q,m-Math.cos(Oe)*Ae),Oe+=Jw,c.lineTo(d+Math.sin(Oe)*q,m-Math.cos(Oe)*Ae),c.closePath();break;case"rectRounded":B=Ae*.516,s=Ae-B,E=Math.cos(Oe+wc)*s,Z=Math.cos(Oe+wc)*s,P=Math.sin(Oe+wc)*s,ae=Math.sin(Oe+wc)*s,c.arc(d-Z,m-P,B,Oe-hr,Oe-es),c.arc(d+ae,m-E,B,Oe-es,Oe),c.arc(d+Z,m+P,B,Oe,Oe+es),c.arc(d-ae,m+E,B,Oe+es,Oe+hr),c.closePath();break;case"rect":if(!Le){s=Math.SQRT1_2*Ae,q=s,c.rect(d-q,m-s,2*q,2*s);break}Oe+=wc;case"rectRot":Z=Math.cos(Oe)*Ae,E=Math.cos(Oe)*Ae,P=Math.sin(Oe)*Ae,ae=Math.sin(Oe)*Ae,c.moveTo(d-Z,m-P),c.lineTo(d+ae,m-E),c.lineTo(d+Z,m+P),c.lineTo(d-ae,m+E),c.closePath();break;case"crossRot":Oe+=wc;case"cross":Z=Math.cos(Oe)*Ae,E=Math.cos(Oe)*Ae,P=Math.sin(Oe)*Ae,ae=Math.sin(Oe)*Ae,c.moveTo(d-Z,m-P),c.lineTo(d+Z,m+P),c.moveTo(d+ae,m-E),c.lineTo(d-ae,m+E);break;case"star":Z=Math.cos(Oe)*Ae,E=Math.cos(Oe)*Ae,P=Math.sin(Oe)*Ae,ae=Math.sin(Oe)*Ae,c.moveTo(d-Z,m-P),c.lineTo(d+Z,m+P),c.moveTo(d+ae,m-E),c.lineTo(d-ae,m+E),Oe+=wc,Z=Math.cos(Oe)*Ae,E=Math.cos(Oe)*Ae,P=Math.sin(Oe)*Ae,ae=Math.sin(Oe)*Ae,c.moveTo(d-Z,m-P),c.lineTo(d+Z,m+P),c.moveTo(d+ae,m-E),c.lineTo(d-ae,m+E);break;case"line":E=Math.cos(Oe)*Ae,P=Math.sin(Oe)*Ae,c.moveTo(d-E,m-P),c.lineTo(d+E,m+P);break;case"dash":c.moveTo(d,m),c.lineTo(d+Math.cos(Oe)*Ae,m+Math.sin(Oe)*Ae);break;case!1:c.closePath();break}c.fill(),a.borderWidth>0&&c.stroke()}}function Hu(c,a,d){return d=d||.5,!a||c&&c.x>a.left-d&&c.x<a.right+d&&c.y>a.top-d&&c.y<a.bottom+d}function AS(c,a){c.save(),c.beginPath(),c.rect(a.left,a.top,a.right-a.left,a.bottom-a.top),c.clip()}function IS(c){c.restore()}function mR(c,a){a.translation&&c.translate(a.translation[0],a.translation[1]),Dn(a.rotation)||c.rotate(a.rotation),a.color&&(c.fillStyle=a.color),a.textAlign&&(c.textAlign=a.textAlign),a.textBaseline&&(c.textBaseline=a.textBaseline)}function _R(c,a,d,m,x){if(x.strikethrough||x.underline){const T=c.measureText(m),E=a-T.actualBoundingBoxLeft,P=a+T.actualBoundingBoxRight,s=d-T.actualBoundingBoxAscent,B=d+T.actualBoundingBoxDescent,q=x.strikethrough?(s+B)/2:B;c.strokeStyle=c.fillStyle,c.beginPath(),c.lineWidth=x.decorationWidth||2,c.moveTo(E,q),c.lineTo(P,q),c.stroke()}}function gR(c,a){const d=c.fillStyle;c.fillStyle=a.color,c.fillRect(a.left,a.top,a.width,a.height),c.fillStyle=d}function kf(c,a,d,m,x,T={}){const E=Yn(a)?a:[a],P=T.strokeWidth>0&&T.strokeColor!=="";let s,B;for(c.save(),c.font=x.string,mR(c,T),s=0;s<E.length;++s)B=E[s],T.backdrop&&gR(c,T.backdrop),P&&(T.strokeColor&&(c.strokeStyle=T.strokeColor),Dn(T.strokeWidth)||(c.lineWidth=T.strokeWidth),c.strokeText(B,d,m,T.maxWidth)),c.fillText(B,d,m,T.maxWidth),_R(c,d,m,B,T),m+=Number(x.lineHeight);c.restore()}function M_(c,a){const{x:d,y:m,w:x,h:T,radius:E}=a;c.arc(d+E.topLeft,m+E.topLeft,E.topLeft,1.5*hr,hr,!0),c.lineTo(d,m+T-E.bottomLeft),c.arc(d+E.bottomLeft,m+T-E.bottomLeft,E.bottomLeft,hr,es,!0),c.lineTo(d+x-E.bottomRight,m+T),c.arc(d+x-E.bottomRight,m+T-E.bottomRight,E.bottomRight,es,0,!0),c.lineTo(d+x,m+E.topRight),c.arc(d+x-E.topRight,m+E.topRight,E.topRight,0,-es,!0),c.lineTo(d+E.topLeft,m)}const yR=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,xR=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function vR(c,a){const d=(""+c).match(yR);if(!d||d[1]==="normal")return a*1.2;switch(c=+d[2],d[3]){case"px":return c;case"%":c/=100;break}return a*c}const bR=c=>+c||0;function CS(c,a){const d={},m=fn(a),x=m?Object.keys(a):a,T=fn(c)?m?E=>Hn(c[E],c[a[E]]):E=>c[E]:()=>c;for(const E of x)d[E]=bR(T(E));return d}function PS(c){return CS(c,{top:"y",right:"x",bottom:"y",left:"x"})}function Ku(c){return CS(c,["topLeft","topRight","bottomLeft","bottomRight"])}function ks(c){const a=PS(c);return a.width=a.left+a.right,a.height=a.top+a.bottom,a}function ts(c,a){c=c||{},a=a||ur.font;let d=Hn(c.size,a.size);typeof d=="string"&&(d=parseInt(d,10));let m=Hn(c.style,a.style);m&&!(""+m).match(xR)&&(console.warn('Invalid font style specified: "'+m+'"'),m=void 0);const x={family:Hn(c.family,a.family),lineHeight:vR(Hn(c.lineHeight,a.lineHeight),d),size:d,style:m,weight:Hn(c.weight,a.weight),string:""};return x.string=dR(x),x}function Hm(c,a,d,m){let x,T,E;for(x=0,T=c.length;x<T;++x)if(E=c[x],E!==void 0&&E!==void 0)return E}function wR(c,a,d){const{min:m,max:x}=c,T=gS(a,(x-m)/2),E=(P,s)=>d&&P===0?0:P+s;return{min:E(m,-Math.abs(T)),max:E(x,T)}}function Nc(c,a){return Object.assign(Object.create(c),a)}function tx(c,a=[""],d,m,x=()=>c[0]){const T=d||c;typeof m>"u"&&(m=zS("_fallback",c));const E={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:c,_rootScopes:T,_fallback:m,_getTarget:x,override:P=>tx([P,...c],a,T,m)};return new Proxy(E,{deleteProperty(P,s){return delete P[s],delete P._keys,delete c[0][s],!0},get(P,s){return LS(P,s,()=>PR(s,a,c,P))},getOwnPropertyDescriptor(P,s){return Reflect.getOwnPropertyDescriptor(P._scopes[0],s)},getPrototypeOf(){return Reflect.getPrototypeOf(c[0])},has(P,s){return uT(P).includes(s)},ownKeys(P){return uT(P)},set(P,s,B){const q=P._storage||(P._storage=x());return P[s]=q[s]=B,delete P._keys,!0}})}function Qu(c,a,d,m){const x={_cacheable:!1,_proxy:c,_context:a,_subProxy:d,_stack:new Set,_descriptors:DS(c,m),setContext:T=>Qu(c,T,d,m),override:T=>Qu(c.override(T),a,d,m)};return new Proxy(x,{deleteProperty(T,E){return delete T[E],delete c[E],!0},get(T,E,P){return LS(T,E,()=>MR(T,E,P))},getOwnPropertyDescriptor(T,E){return T._descriptors.allKeys?Reflect.has(c,E)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(c,E)},getPrototypeOf(){return Reflect.getPrototypeOf(c)},has(T,E){return Reflect.has(c,E)},ownKeys(){return Reflect.ownKeys(c)},set(T,E,P){return c[E]=P,delete T[E],!0}})}function DS(c,a={scriptable:!0,indexable:!0}){const{_scriptable:d=a.scriptable,_indexable:m=a.indexable,_allKeys:x=a.allKeys}=c;return{allKeys:x,scriptable:d,indexable:m,isScriptable:bl(d)?d:()=>d,isIndexable:bl(m)?m:()=>m}}const TR=(c,a)=>c?c+J0(a):a,ix=(c,a)=>fn(a)&&c!=="adapters"&&(Object.getPrototypeOf(a)===null||a.constructor===Object);function LS(c,a,d){if(Object.prototype.hasOwnProperty.call(c,a))return c[a];const m=d();return c[a]=m,m}function MR(c,a,d){const{_proxy:m,_context:x,_subProxy:T,_descriptors:E}=c;let P=m[a];return bl(P)&&E.isScriptable(a)&&(P=SR(a,P,c,d)),Yn(P)&&P.length&&(P=ER(a,P,c,E.isIndexable)),ix(a,P)&&(P=Qu(P,x,T&&T[a],E)),P}function SR(c,a,d,m){const{_proxy:x,_context:T,_subProxy:E,_stack:P}=d;if(P.has(c))throw new Error("Recursion detected: "+Array.from(P).join("->")+"->"+c);P.add(c);let s=a(T,E||m);return P.delete(c),ix(c,s)&&(s=nx(x._scopes,x,c,s)),s}function ER(c,a,d,m){const{_proxy:x,_context:T,_subProxy:E,_descriptors:P}=d;if(typeof T.index<"u"&&m(c))return a[T.index%a.length];if(fn(a[0])){const s=a,B=x._scopes.filter(q=>q!==s);a=[];for(const q of s){const Z=nx(B,x,c,q);a.push(Qu(Z,T,E&&E[c],P))}}return a}function RS(c,a,d){return bl(c)?c(a,d):c}const AR=(c,a)=>c===!0?a:typeof c=="string"?vl(a,c):void 0;function IR(c,a,d,m,x){for(const T of a){const E=AR(d,T);if(E){c.add(E);const P=RS(E._fallback,d,x);if(typeof P<"u"&&P!==d&&P!==m)return P}else if(E===!1&&typeof m<"u"&&d!==m)return null}return!1}function nx(c,a,d,m){const x=a._rootScopes,T=RS(a._fallback,d,m),E=[...c,...x],P=new Set;P.add(m);let s=cT(P,E,d,T||d,m);return s===null||typeof T<"u"&&T!==d&&(s=cT(P,E,T,s,m),s===null)?!1:tx(Array.from(P),[""],x,T,()=>CR(a,d,m))}function cT(c,a,d,m,x){for(;d;)d=IR(c,a,d,m,x);return d}function CR(c,a,d){const m=c._getTarget();a in m||(m[a]={});const x=m[a];return Yn(x)&&fn(d)?d:x||{}}function PR(c,a,d,m){let x;for(const T of a)if(x=zS(TR(T,c),d),typeof x<"u")return ix(c,x)?nx(d,m,c,x):x}function zS(c,a){for(const d of a){if(!d)continue;const m=d[c];if(typeof m<"u")return m}}function uT(c){let a=c._keys;return a||(a=c._keys=DR(c._scopes)),a}function DR(c){const a=new Set;for(const d of c)for(const m of Object.keys(d).filter(x=>!x.startsWith("_")))a.add(m);return Array.from(a)}function LR(c,a,d,m){const{iScale:x}=c,{key:T="r"}=this._parsing,E=new Array(m);let P,s,B,q;for(P=0,s=m;P<s;++P)B=P+d,q=a[B],E[P]={r:x.parse(vl(q,T),B)};return E}function rx(){return typeof window<"u"&&typeof document<"u"}function sx(c){let a=c.parentNode;return a&&a.toString()==="[object ShadowRoot]"&&(a=a.host),a}function S_(c,a,d){let m;return typeof c=="string"?(m=parseInt(c,10),c.indexOf("%")!==-1&&(m=m/100*a.parentNode[d])):m=c,m}const j_=c=>c.ownerDocument.defaultView.getComputedStyle(c,null);function RR(c,a){return j_(c).getPropertyValue(a)}const zR=["top","right","bottom","left"];function Lc(c,a,d){const m={};d=d?"-"+d:"";for(let x=0;x<4;x++){const T=zR[x];m[T]=parseFloat(c[a+"-"+T+d])||0}return m.width=m.left+m.right,m.height=m.top+m.bottom,m}const kR=(c,a,d)=>(c>0||a>0)&&(!d||!d.shadowRoot);function OR(c,a){const d=c.touches,m=d&&d.length?d[0]:c,{offsetX:x,offsetY:T}=m;let E=!1,P,s;if(kR(x,T,c.target))P=x,s=T;else{const B=a.getBoundingClientRect();P=m.clientX-B.left,s=m.clientY-B.top,E=!0}return{x:P,y:s,box:E}}function Ec(c,a){if("native"in c)return c;const{canvas:d,currentDevicePixelRatio:m}=a,x=j_(d),T=x.boxSizing==="border-box",E=Lc(x,"padding"),P=Lc(x,"border","width"),{x:s,y:B,box:q}=OR(c,d),Z=E.left+(q&&P.left),ae=E.top+(q&&P.top);let{width:ue,height:Le}=a;return T&&(ue-=E.width+P.width,Le-=E.height+P.height),{x:Math.round((s-Z)/ue*d.width/m),y:Math.round((B-ae)/Le*d.height/m)}}function FR(c,a,d){let m,x;if(a===void 0||d===void 0){const T=sx(c);if(!T)a=c.clientWidth,d=c.clientHeight;else{const E=T.getBoundingClientRect(),P=j_(T),s=Lc(P,"border","width"),B=Lc(P,"padding");a=E.width-B.width-s.width,d=E.height-B.height-s.height,m=S_(P.maxWidth,T,"clientWidth"),x=S_(P.maxHeight,T,"clientHeight")}}return{width:a,height:d,maxWidth:m||b_,maxHeight:x||b_}}const Wm=c=>Math.round(c*10)/10;function BR(c,a,d,m){const x=j_(c),T=Lc(x,"margin"),E=S_(x.maxWidth,c,"clientWidth")||b_,P=S_(x.maxHeight,c,"clientHeight")||b_,s=FR(c,a,d);let{width:B,height:q}=s;if(x.boxSizing==="content-box"){const ae=Lc(x,"border","width"),ue=Lc(x,"padding");B-=ue.width+ae.width,q-=ue.height+ae.height}return B=Math.max(0,B-T.width),q=Math.max(0,m?B/m:q-T.height),B=Wm(Math.min(B,E,s.maxWidth)),q=Wm(Math.min(q,P,s.maxHeight)),B&&!q&&(q=Wm(B/2)),(a!==void 0||d!==void 0)&&m&&s.height&&q>s.height&&(q=s.height,B=Wm(Math.floor(q*m))),{width:B,height:q}}function hT(c,a,d){const m=a||1,x=Math.floor(c.height*m),T=Math.floor(c.width*m);c.height=Math.floor(c.height),c.width=Math.floor(c.width);const E=c.canvas;return E.style&&(d||!E.style.height&&!E.style.width)&&(E.style.height=`${c.height}px`,E.style.width=`${c.width}px`),c.currentDevicePixelRatio!==m||E.height!==x||E.width!==T?(c.currentDevicePixelRatio=m,E.height=x,E.width=T,c.ctx.setTransform(m,0,0,m,0,0),!0):!1}const NR=function(){let c=!1;try{const a={get passive(){return c=!0,!1}};rx()&&(window.addEventListener("test",null,a),window.removeEventListener("test",null,a))}catch{}return c}();function dT(c,a){const d=RR(c,a),m=d&&d.match(/^(\d+)(\.\d+)?px$/);return m?+m[1]:void 0}const VR=function(c,a){return{x(d){return c+c+a-d},setWidth(d){a=d},textAlign(d){return d==="center"?d:d==="right"?"left":"right"},xPlus(d,m){return d-m},leftForLtr(d,m){return d-m}}},UR=function(){return{x(c){return c},setWidth(c){},textAlign(c){return c},xPlus(c,a){return c+a},leftForLtr(c,a){return c}}};function Zy(c,a,d){return c?VR(a,d):UR()}function jR(c,a){let d,m;(a==="ltr"||a==="rtl")&&(d=c.canvas.style,m=[d.getPropertyValue("direction"),d.getPropertyPriority("direction")],d.setProperty("direction",a,"important"),c.prevTextDirection=m)}function GR(c,a){a!==void 0&&(delete c.prevTextDirection,c.canvas.style.setProperty("direction",a[0],a[1]))}/*!
 * Chart.js v4.4.2
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class $R{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(a,d,m,x){const T=d.listeners[x],E=d.duration;T.forEach(P=>P({chart:a,initial:d.initial,numSteps:E,currentStep:Math.min(m-d.start,E)}))}_refresh(){this._request||(this._running=!0,this._request=wS.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(a=Date.now()){let d=0;this._charts.forEach((m,x)=>{if(!m.running||!m.items.length)return;const T=m.items;let E=T.length-1,P=!1,s;for(;E>=0;--E)s=T[E],s._active?(s._total>m.duration&&(m.duration=s._total),s.tick(a),P=!0):(T[E]=T[T.length-1],T.pop());P&&(x.draw(),this._notify(x,m,a,"progress")),T.length||(m.running=!1,this._notify(x,m,a,"complete"),m.initial=!1),d+=T.length}),this._lastDate=a,d===0&&(this._running=!1)}_getAnims(a){const d=this._charts;let m=d.get(a);return m||(m={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},d.set(a,m)),m}listen(a,d,m){this._getAnims(a).listeners[d].push(m)}add(a,d){!d||!d.length||this._getAnims(a).items.push(...d)}has(a){return this._getAnims(a).items.length>0}start(a){const d=this._charts.get(a);d&&(d.running=!0,d.start=Date.now(),d.duration=d.items.reduce((m,x)=>Math.max(m,x._duration),0),this._refresh())}running(a){if(!this._running)return!1;const d=this._charts.get(a);return!(!d||!d.running||!d.items.length)}stop(a){const d=this._charts.get(a);if(!d||!d.items.length)return;const m=d.items;let x=m.length-1;for(;x>=0;--x)m[x].cancel();d.items=[],this._notify(a,d,Date.now(),"complete")}remove(a){return this._charts.delete(a)}}var _a=new $R;const fT="transparent",qR={boolean(c,a,d){return d>.5?a:c},color(c,a,d){const m=sT(c||fT),x=m.valid&&sT(a||fT);return x&&x.valid?x.mix(m,d).hexString():a},number(c,a,d){return c+(a-c)*d}};class HR{constructor(a,d,m,x){const T=d[m];x=Hm([a.to,x,T,a.from]);const E=Hm([a.from,T,x]);this._active=!0,this._fn=a.fn||qR[a.type||typeof E],this._easing=Sf[a.easing]||Sf.linear,this._start=Math.floor(Date.now()+(a.delay||0)),this._duration=this._total=Math.floor(a.duration),this._loop=!!a.loop,this._target=d,this._prop=m,this._from=E,this._to=x,this._promises=void 0}active(){return this._active}update(a,d,m){if(this._active){this._notify(!1);const x=this._target[this._prop],T=m-this._start,E=this._duration-T;this._start=m,this._duration=Math.floor(Math.max(E,a.duration)),this._total+=T,this._loop=!!a.loop,this._to=Hm([a.to,d,x,a.from]),this._from=Hm([a.from,x,d])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(a){const d=a-this._start,m=this._duration,x=this._prop,T=this._from,E=this._loop,P=this._to;let s;if(this._active=T!==P&&(E||d<m),!this._active){this._target[x]=P,this._notify(!0);return}if(d<0){this._target[x]=T;return}s=d/m%2,s=E&&s>1?2-s:s,s=this._easing(Math.min(1,Math.max(0,s))),this._target[x]=this._fn(T,P,s)}wait(){const a=this._promises||(this._promises=[]);return new Promise((d,m)=>{a.push({res:d,rej:m})})}_notify(a){const d=a?"res":"rej",m=this._promises||[];for(let x=0;x<m.length;x++)m[x][d]()}}class kS{constructor(a,d){this._chart=a,this._properties=new Map,this.configure(d)}configure(a){if(!fn(a))return;const d=Object.keys(ur.animation),m=this._properties;Object.getOwnPropertyNames(a).forEach(x=>{const T=a[x];if(!fn(T))return;const E={};for(const P of d)E[P]=T[P];(Yn(T.properties)&&T.properties||[x]).forEach(P=>{(P===x||!m.has(P))&&m.set(P,E)})})}_animateOptions(a,d){const m=d.options,x=ZR(a,m);if(!x)return[];const T=this._createAnimations(x,m);return m.$shared&&WR(a.options.$animations,m).then(()=>{a.options=m},()=>{}),T}_createAnimations(a,d){const m=this._properties,x=[],T=a.$animations||(a.$animations={}),E=Object.keys(d),P=Date.now();let s;for(s=E.length-1;s>=0;--s){const B=E[s];if(B.charAt(0)==="$")continue;if(B==="options"){x.push(...this._animateOptions(a,d));continue}const q=d[B];let Z=T[B];const ae=m.get(B);if(Z)if(ae&&Z.active()){Z.update(ae,q,P);continue}else Z.cancel();if(!ae||!ae.duration){a[B]=q;continue}T[B]=Z=new HR(ae,a,B,q),x.push(Z)}return x}update(a,d){if(this._properties.size===0){Object.assign(a,d);return}const m=this._createAnimations(a,d);if(m.length)return _a.add(this._chart,m),!0}}function WR(c,a){const d=[],m=Object.keys(a);for(let x=0;x<m.length;x++){const T=c[m[x]];T&&T.active()&&d.push(T.wait())}return Promise.all(d)}function ZR(c,a){if(!a)return;let d=c.options;if(!d){c.options=a;return}return d.$shared&&(c.options=d=Object.assign({},d,{$shared:!1,$animations:{}})),d}function pT(c,a){const d=c&&c.options||{},m=d.reverse,x=d.min===void 0?a:0,T=d.max===void 0?a:0;return{start:m?T:x,end:m?x:T}}function XR(c,a,d){if(d===!1)return!1;const m=pT(c,d),x=pT(a,d);return{top:x.end,right:m.end,bottom:x.start,left:m.start}}function YR(c){let a,d,m,x;return fn(c)?(a=c.top,d=c.right,m=c.bottom,x=c.left):a=d=m=x=c,{top:a,right:d,bottom:m,left:x,disabled:c===!1}}function OS(c,a){const d=[],m=c._getSortedDatasetMetas(a);let x,T;for(x=0,T=m.length;x<T;++x)d.push(m[x].index);return d}function mT(c,a,d,m={}){const x=c.keys,T=m.mode==="single";let E,P,s,B;if(a!==null){for(E=0,P=x.length;E<P;++E){if(s=+x[E],s===d){if(m.all)continue;break}B=c.values[s],Cr(B)&&(T||a===0||xl(a)===xl(B))&&(a+=B)}return a}}function KR(c){const a=Object.keys(c),d=new Array(a.length);let m,x,T;for(m=0,x=a.length;m<x;++m)T=a[m],d[m]={x:T,y:c[T]};return d}function _T(c,a){const d=c&&c.options.stacked;return d||d===void 0&&a.stack!==void 0}function JR(c,a,d){return`${c.id}.${a.id}.${d.stack||d.type}`}function QR(c){const{min:a,max:d,minDefined:m,maxDefined:x}=c.getUserBounds();return{min:m?a:Number.NEGATIVE_INFINITY,max:x?d:Number.POSITIVE_INFINITY}}function ez(c,a,d){const m=c[a]||(c[a]={});return m[d]||(m[d]={})}function gT(c,a,d,m){for(const x of a.getMatchingVisibleMetas(m).reverse()){const T=c[x.index];if(d&&T>0||!d&&T<0)return x.index}return null}function yT(c,a){const{chart:d,_cachedMeta:m}=c,x=d._stacks||(d._stacks={}),{iScale:T,vScale:E,index:P}=m,s=T.axis,B=E.axis,q=JR(T,E,m),Z=a.length;let ae;for(let ue=0;ue<Z;++ue){const Le=a[ue],{[s]:Ae,[B]:Oe}=Le,We=Le._stacks||(Le._stacks={});ae=We[B]=ez(x,q,Ae),ae[P]=Oe,ae._top=gT(ae,E,!0,m.type),ae._bottom=gT(ae,E,!1,m.type);const ct=ae._visualValues||(ae._visualValues={});ct[P]=Oe}}function Xy(c,a){const d=c.scales;return Object.keys(d).filter(m=>d[m].axis===a).shift()}function tz(c,a){return Nc(c,{active:!1,dataset:void 0,datasetIndex:a,index:a,mode:"default",type:"dataset"})}function iz(c,a,d){return Nc(c,{active:!1,dataIndex:a,parsed:void 0,raw:void 0,element:d,index:a,mode:"default",type:"data"})}function sf(c,a){const d=c.controller.index,m=c.vScale&&c.vScale.axis;if(m){a=a||c._parsed;for(const x of a){const T=x._stacks;if(!T||T[m]===void 0||T[m][d]===void 0)return;delete T[m][d],T[m]._visualValues!==void 0&&T[m]._visualValues[d]!==void 0&&delete T[m]._visualValues[d]}}}const Yy=c=>c==="reset"||c==="none",xT=(c,a)=>a?c:Object.assign({},c),nz=(c,a,d)=>c&&!a.hidden&&a._stacked&&{keys:OS(d,!0),values:null};class Rc{constructor(a,d){this.chart=a,this._ctx=a.ctx,this.index=d,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const a=this._cachedMeta;this.configure(),this.linkScales(),a._stacked=_T(a.vScale,a),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(a){this.index!==a&&sf(this._cachedMeta),this.index=a}linkScales(){const a=this.chart,d=this._cachedMeta,m=this.getDataset(),x=(Z,ae,ue,Le)=>Z==="x"?ae:Z==="r"?Le:ue,T=d.xAxisID=Hn(m.xAxisID,Xy(a,"x")),E=d.yAxisID=Hn(m.yAxisID,Xy(a,"y")),P=d.rAxisID=Hn(m.rAxisID,Xy(a,"r")),s=d.indexAxis,B=d.iAxisID=x(s,T,E,P),q=d.vAxisID=x(s,E,T,P);d.xScale=this.getScaleForId(T),d.yScale=this.getScaleForId(E),d.rScale=this.getScaleForId(P),d.iScale=this.getScaleForId(B),d.vScale=this.getScaleForId(q)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(a){return this.chart.scales[a]}_getOtherScale(a){const d=this._cachedMeta;return a===d.iScale?d.vScale:d.iScale}reset(){this._update("reset")}_destroy(){const a=this._cachedMeta;this._data&&iT(this._data,this),a._stacked&&sf(a)}_dataCheck(){const a=this.getDataset(),d=a.data||(a.data=[]),m=this._data;if(fn(d))this._data=KR(d);else if(m!==d){if(m){iT(m,this);const x=this._cachedMeta;sf(x),x._parsed=[]}d&&Object.isExtensible(d)&&iR(d,this),this._syncList=[],this._data=d}}addElements(){const a=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(a.dataset=new this.datasetElementType)}buildOrUpdateElements(a){const d=this._cachedMeta,m=this.getDataset();let x=!1;this._dataCheck();const T=d._stacked;d._stacked=_T(d.vScale,d),d.stack!==m.stack&&(x=!0,sf(d),d.stack=m.stack),this._resyncElements(a),(x||T!==d._stacked)&&yT(this,d._parsed)}configure(){const a=this.chart.config,d=a.datasetScopeKeys(this._type),m=a.getOptionScopes(this.getDataset(),d,!0);this.options=a.createResolver(m,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(a,d){const{_cachedMeta:m,_data:x}=this,{iScale:T,_stacked:E}=m,P=T.axis;let s=a===0&&d===x.length?!0:m._sorted,B=a>0&&m._parsed[a-1],q,Z,ae;if(this._parsing===!1)m._parsed=x,m._sorted=!0,ae=x;else{Yn(x[a])?ae=this.parseArrayData(m,x,a,d):fn(x[a])?ae=this.parseObjectData(m,x,a,d):ae=this.parsePrimitiveData(m,x,a,d);const ue=()=>Z[P]===null||B&&Z[P]<B[P];for(q=0;q<d;++q)m._parsed[q+a]=Z=ae[q],s&&(ue()&&(s=!1),B=Z);m._sorted=s}E&&yT(this,ae)}parsePrimitiveData(a,d,m,x){const{iScale:T,vScale:E}=a,P=T.axis,s=E.axis,B=T.getLabels(),q=T===E,Z=new Array(x);let ae,ue,Le;for(ae=0,ue=x;ae<ue;++ae)Le=ae+m,Z[ae]={[P]:q||T.parse(B[Le],Le),[s]:E.parse(d[Le],Le)};return Z}parseArrayData(a,d,m,x){const{xScale:T,yScale:E}=a,P=new Array(x);let s,B,q,Z;for(s=0,B=x;s<B;++s)q=s+m,Z=d[q],P[s]={x:T.parse(Z[0],q),y:E.parse(Z[1],q)};return P}parseObjectData(a,d,m,x){const{xScale:T,yScale:E}=a,{xAxisKey:P="x",yAxisKey:s="y"}=this._parsing,B=new Array(x);let q,Z,ae,ue;for(q=0,Z=x;q<Z;++q)ae=q+m,ue=d[ae],B[q]={x:T.parse(vl(ue,P),ae),y:E.parse(vl(ue,s),ae)};return B}getParsed(a){return this._cachedMeta._parsed[a]}getDataElement(a){return this._cachedMeta.data[a]}applyStack(a,d,m){const x=this.chart,T=this._cachedMeta,E=d[a.axis],P={keys:OS(x,!0),values:d._stacks[a.axis]._visualValues};return mT(P,E,T.index,{mode:m})}updateRangeFromParsed(a,d,m,x){const T=m[d.axis];let E=T===null?NaN:T;const P=x&&m._stacks[d.axis];x&&P&&(x.values=P,E=mT(x,T,this._cachedMeta.index)),a.min=Math.min(a.min,E),a.max=Math.max(a.max,E)}getMinMax(a,d){const m=this._cachedMeta,x=m._parsed,T=m._sorted&&a===m.iScale,E=x.length,P=this._getOtherScale(a),s=nz(d,m,this.chart),B={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:q,max:Z}=QR(P);let ae,ue;function Le(){ue=x[ae];const Ae=ue[P.axis];return!Cr(ue[a.axis])||q>Ae||Z<Ae}for(ae=0;ae<E&&!(!Le()&&(this.updateRangeFromParsed(B,a,ue,s),T));++ae);if(T){for(ae=E-1;ae>=0;--ae)if(!Le()){this.updateRangeFromParsed(B,a,ue,s);break}}return B}getAllParsedValues(a){const d=this._cachedMeta._parsed,m=[];let x,T,E;for(x=0,T=d.length;x<T;++x)E=d[x][a.axis],Cr(E)&&m.push(E);return m}getMaxOverflow(){return!1}getLabelAndValue(a){const d=this._cachedMeta,m=d.iScale,x=d.vScale,T=this.getParsed(a);return{label:m?""+m.getLabelForValue(T[m.axis]):"",value:x?""+x.getLabelForValue(T[x.axis]):""}}_update(a){const d=this._cachedMeta;this.update(a||"default"),d._clip=YR(Hn(this.options.clip,XR(d.xScale,d.yScale,this.getMaxOverflow())))}update(a){}draw(){const a=this._ctx,d=this.chart,m=this._cachedMeta,x=m.data||[],T=d.chartArea,E=[],P=this._drawStart||0,s=this._drawCount||x.length-P,B=this.options.drawActiveElementsOnTop;let q;for(m.dataset&&m.dataset.draw(a,T,P,s),q=P;q<P+s;++q){const Z=x[q];Z.hidden||(Z.active&&B?E.push(Z):Z.draw(a,T))}for(q=0;q<E.length;++q)E[q].draw(a,T)}getStyle(a,d){const m=d?"active":"default";return a===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(m):this.resolveDataElementOptions(a||0,m)}getContext(a,d,m){const x=this.getDataset();let T;if(a>=0&&a<this._cachedMeta.data.length){const E=this._cachedMeta.data[a];T=E.$context||(E.$context=iz(this.getContext(),a,E)),T.parsed=this.getParsed(a),T.raw=x.data[a],T.index=T.dataIndex=a}else T=this.$context||(this.$context=tz(this.chart.getContext(),this.index)),T.dataset=x,T.index=T.datasetIndex=this.index;return T.active=!!d,T.mode=m,T}resolveDatasetElementOptions(a){return this._resolveElementOptions(this.datasetElementType.id,a)}resolveDataElementOptions(a,d){return this._resolveElementOptions(this.dataElementType.id,d,a)}_resolveElementOptions(a,d="default",m){const x=d==="active",T=this._cachedDataOpts,E=a+"-"+d,P=T[E],s=this.enableOptionSharing&&zf(m);if(P)return xT(P,s);const B=this.chart.config,q=B.datasetElementScopeKeys(this._type,a),Z=x?[`${a}Hover`,"hover",a,""]:[a,""],ae=B.getOptionScopes(this.getDataset(),q),ue=Object.keys(ur.elements[a]),Le=()=>this.getContext(m,x,d),Ae=B.resolveNamedOptions(ae,ue,Le,Z);return Ae.$shared&&(Ae.$shared=s,T[E]=Object.freeze(xT(Ae,s))),Ae}_resolveAnimations(a,d,m){const x=this.chart,T=this._cachedDataOpts,E=`animation-${d}`,P=T[E];if(P)return P;let s;if(x.options.animation!==!1){const q=this.chart.config,Z=q.datasetAnimationScopeKeys(this._type,d),ae=q.getOptionScopes(this.getDataset(),Z);s=q.createResolver(ae,this.getContext(a,m,d))}const B=new kS(x,s&&s.animations);return s&&s._cacheable&&(T[E]=Object.freeze(B)),B}getSharedOptions(a){if(a.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},a))}includeOptions(a,d){return!d||Yy(a)||this.chart._animationsDisabled}_getSharedOptions(a,d){const m=this.resolveDataElementOptions(a,d),x=this._sharedOptions,T=this.getSharedOptions(m),E=this.includeOptions(d,T)||T!==x;return this.updateSharedOptions(T,d,m),{sharedOptions:T,includeOptions:E}}updateElement(a,d,m,x){Yy(x)?Object.assign(a,m):this._resolveAnimations(d,x).update(a,m)}updateSharedOptions(a,d,m){a&&!Yy(d)&&this._resolveAnimations(void 0,d).update(a,m)}_setStyle(a,d,m,x){a.active=x;const T=this.getStyle(d,x);this._resolveAnimations(d,m,x).update(a,{options:!x&&this.getSharedOptions(T)||T})}removeHoverStyle(a,d,m){this._setStyle(a,m,"active",!1)}setHoverStyle(a,d,m){this._setStyle(a,m,"active",!0)}_removeDatasetHoverStyle(){const a=this._cachedMeta.dataset;a&&this._setStyle(a,void 0,"active",!1)}_setDatasetHoverStyle(){const a=this._cachedMeta.dataset;a&&this._setStyle(a,void 0,"active",!0)}_resyncElements(a){const d=this._data,m=this._cachedMeta.data;for(const[P,s,B]of this._syncList)this[P](s,B);this._syncList=[];const x=m.length,T=d.length,E=Math.min(T,x);E&&this.parse(0,E),T>x?this._insertElements(x,T-x,a):T<x&&this._removeElements(T,x-T)}_insertElements(a,d,m=!0){const x=this._cachedMeta,T=x.data,E=a+d;let P;const s=B=>{for(B.length+=d,P=B.length-1;P>=E;P--)B[P]=B[P-d]};for(s(T),P=a;P<E;++P)T[P]=new this.dataElementType;this._parsing&&s(x._parsed),this.parse(a,d),m&&this.updateElements(T,a,d,"reset")}updateElements(a,d,m,x){}_removeElements(a,d){const m=this._cachedMeta;if(this._parsing){const x=m._parsed.splice(a,d);m._stacked&&sf(m,x)}m.data.splice(a,d)}_sync(a){if(this._parsing)this._syncList.push(a);else{const[d,m,x]=a;this[d](m,x)}this.chart._dataChanges.push([this.index,...a])}_onDataPush(){const a=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-a,a])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(a,d){d&&this._sync(["_removeElements",a,d]);const m=arguments.length-2;m&&this._sync(["_insertElements",a,m])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Bi(Rc,"defaults",{}),Bi(Rc,"datasetElementType",null),Bi(Rc,"dataElementType",null);function rz(c,a){if(!c._cache.$bar){const d=c.getMatchingVisibleMetas(a);let m=[];for(let x=0,T=d.length;x<T;x++)m=m.concat(d[x].controller.getAllParsedValues(c));c._cache.$bar=bS(m.sort((x,T)=>x-T))}return c._cache.$bar}function sz(c){const a=c.iScale,d=rz(a,c.type);let m=a._length,x,T,E,P;const s=()=>{E===32767||E===-32768||(zf(P)&&(m=Math.min(m,Math.abs(E-P)||m)),P=E)};for(x=0,T=d.length;x<T;++x)E=a.getPixelForValue(d[x]),s();for(P=void 0,x=0,T=a.ticks.length;x<T;++x)E=a.getPixelForTick(x),s();return m}function oz(c,a,d,m){const x=d.barThickness;let T,E;return Dn(x)?(T=a.min*d.categoryPercentage,E=d.barPercentage):(T=x*m,E=1),{chunk:T/m,ratio:E,start:a.pixels[c]-T/2}}function az(c,a,d,m){const x=a.pixels,T=x[c];let E=c>0?x[c-1]:null,P=c<x.length-1?x[c+1]:null;const s=d.categoryPercentage;E===null&&(E=T-(P===null?a.end-a.start:P-T)),P===null&&(P=T+T-E);const B=T-(T-Math.min(E,P))/2*s;return{chunk:Math.abs(P-E)/2*s/m,ratio:d.barPercentage,start:B}}function lz(c,a,d,m){const x=d.parse(c[0],m),T=d.parse(c[1],m),E=Math.min(x,T),P=Math.max(x,T);let s=E,B=P;Math.abs(E)>Math.abs(P)&&(s=P,B=E),a[d.axis]=B,a._custom={barStart:s,barEnd:B,start:x,end:T,min:E,max:P}}function FS(c,a,d,m){return Yn(c)?lz(c,a,d,m):a[d.axis]=d.parse(c,m),a}function vT(c,a,d,m){const x=c.iScale,T=c.vScale,E=x.getLabels(),P=x===T,s=[];let B,q,Z,ae;for(B=d,q=d+m;B<q;++B)ae=a[B],Z={},Z[x.axis]=P||x.parse(E[B],B),s.push(FS(ae,Z,T,B));return s}function Ky(c){return c&&c.barStart!==void 0&&c.barEnd!==void 0}function cz(c,a,d){return c!==0?xl(c):(a.isHorizontal()?1:-1)*(a.min>=d?1:-1)}function uz(c){let a,d,m,x,T;return c.horizontal?(a=c.base>c.x,d="left",m="right"):(a=c.base<c.y,d="bottom",m="top"),a?(x="end",T="start"):(x="start",T="end"),{start:d,end:m,reverse:a,top:x,bottom:T}}function hz(c,a,d,m){let x=a.borderSkipped;const T={};if(!x){c.borderSkipped=T;return}if(x===!0){c.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:E,end:P,reverse:s,top:B,bottom:q}=uz(c);x==="middle"&&d&&(c.enableBorderRadius=!0,(d._top||0)===m?x=B:(d._bottom||0)===m?x=q:(T[bT(q,E,P,s)]=!0,x=B)),T[bT(x,E,P,s)]=!0,c.borderSkipped=T}function bT(c,a,d,m){return m?(c=dz(c,a,d),c=wT(c,d,a)):c=wT(c,a,d),c}function dz(c,a,d){return c===a?d:c===d?a:c}function wT(c,a,d){return c==="start"?a:c==="end"?d:c}function fz(c,{inflateAmount:a},d){c.inflateAmount=a==="auto"?d===1?.33:0:a}class c_ extends Rc{parsePrimitiveData(a,d,m,x){return vT(a,d,m,x)}parseArrayData(a,d,m,x){return vT(a,d,m,x)}parseObjectData(a,d,m,x){const{iScale:T,vScale:E}=a,{xAxisKey:P="x",yAxisKey:s="y"}=this._parsing,B=T.axis==="x"?P:s,q=E.axis==="x"?P:s,Z=[];let ae,ue,Le,Ae;for(ae=m,ue=m+x;ae<ue;++ae)Ae=d[ae],Le={},Le[T.axis]=T.parse(vl(Ae,B),ae),Z.push(FS(vl(Ae,q),Le,E,ae));return Z}updateRangeFromParsed(a,d,m,x){super.updateRangeFromParsed(a,d,m,x);const T=m._custom;T&&d===this._cachedMeta.vScale&&(a.min=Math.min(a.min,T.min),a.max=Math.max(a.max,T.max))}getMaxOverflow(){return 0}getLabelAndValue(a){const d=this._cachedMeta,{iScale:m,vScale:x}=d,T=this.getParsed(a),E=T._custom,P=Ky(E)?"["+E.start+", "+E.end+"]":""+x.getLabelForValue(T[x.axis]);return{label:""+m.getLabelForValue(T[m.axis]),value:P}}initialize(){this.enableOptionSharing=!0,super.initialize();const a=this._cachedMeta;a.stack=this.getDataset().stack}update(a){const d=this._cachedMeta;this.updateElements(d.data,0,d.data.length,a)}updateElements(a,d,m,x){const T=x==="reset",{index:E,_cachedMeta:{vScale:P}}=this,s=P.getBasePixel(),B=P.isHorizontal(),q=this._getRuler(),{sharedOptions:Z,includeOptions:ae}=this._getSharedOptions(d,x);for(let ue=d;ue<d+m;ue++){const Le=this.getParsed(ue),Ae=T||Dn(Le[P.axis])?{base:s,head:s}:this._calculateBarValuePixels(ue),Oe=this._calculateBarIndexPixels(ue,q),We=(Le._stacks||{})[P.axis],ct={horizontal:B,base:Ae.base,enableBorderRadius:!We||Ky(Le._custom)||E===We._top||E===We._bottom,x:B?Ae.head:Oe.center,y:B?Oe.center:Ae.head,height:B?Oe.size:Math.abs(Ae.size),width:B?Math.abs(Ae.size):Oe.size};ae&&(ct.options=Z||this.resolveDataElementOptions(ue,a[ue].active?"active":x));const gt=ct.options||a[ue].options;hz(ct,gt,We,E),fz(ct,gt,q.ratio),this.updateElement(a[ue],ue,ct,x)}}_getStacks(a,d){const{iScale:m}=this._cachedMeta,x=m.getMatchingVisibleMetas(this._type).filter(s=>s.controller.options.grouped),T=m.options.stacked,E=[],P=s=>{const B=s.controller.getParsed(d),q=B&&B[s.vScale.axis];if(Dn(q)||isNaN(q))return!0};for(const s of x)if(!(d!==void 0&&P(s))&&((T===!1||E.indexOf(s.stack)===-1||T===void 0&&s.stack===void 0)&&E.push(s.stack),s.index===a))break;return E.length||E.push(void 0),E}_getStackCount(a){return this._getStacks(void 0,a).length}_getStackIndex(a,d,m){const x=this._getStacks(a,m),T=d!==void 0?x.indexOf(d):-1;return T===-1?x.length-1:T}_getRuler(){const a=this.options,d=this._cachedMeta,m=d.iScale,x=[];let T,E;for(T=0,E=d.data.length;T<E;++T)x.push(m.getPixelForValue(this.getParsed(T)[m.axis],T));const P=a.barThickness;return{min:P||sz(d),pixels:x,start:m._startPixel,end:m._endPixel,stackCount:this._getStackCount(),scale:m,grouped:a.grouped,ratio:P?1:a.categoryPercentage*a.barPercentage}}_calculateBarValuePixels(a){const{_cachedMeta:{vScale:d,_stacked:m,index:x},options:{base:T,minBarLength:E}}=this,P=T||0,s=this.getParsed(a),B=s._custom,q=Ky(B);let Z=s[d.axis],ae=0,ue=m?this.applyStack(d,s,m):Z,Le,Ae;ue!==Z&&(ae=ue-Z,ue=Z),q&&(Z=B.barStart,ue=B.barEnd-B.barStart,Z!==0&&xl(Z)!==xl(B.barEnd)&&(ae=0),ae+=Z);const Oe=!Dn(T)&&!q?T:ae;let We=d.getPixelForValue(Oe);if(this.chart.getDataVisibility(a)?Le=d.getPixelForValue(ae+ue):Le=We,Ae=Le-We,Math.abs(Ae)<E){Ae=cz(Ae,d,P)*E,Z===P&&(We-=Ae/2);const ct=d.getPixelForDecimal(0),gt=d.getPixelForDecimal(1),Lt=Math.min(ct,gt),Rt=Math.max(ct,gt);We=Math.max(Math.min(We,Rt),Lt),Le=We+Ae,m&&!q&&(s._stacks[d.axis]._visualValues[x]=d.getValueForPixel(Le)-d.getValueForPixel(We))}if(We===d.getPixelForValue(P)){const ct=xl(Ae)*d.getLineWidthForValue(P)/2;We+=ct,Ae-=ct}return{size:Ae,base:We,head:Le,center:Le+Ae/2}}_calculateBarIndexPixels(a,d){const m=d.scale,x=this.options,T=x.skipNull,E=Hn(x.maxBarThickness,1/0);let P,s;if(d.grouped){const B=T?this._getStackCount(a):d.stackCount,q=x.barThickness==="flex"?az(a,d,x,B):oz(a,d,x,B),Z=this._getStackIndex(this.index,this._cachedMeta.stack,T?a:void 0);P=q.start+q.chunk*Z+q.chunk/2,s=Math.min(E,q.chunk*q.ratio)}else P=m.getPixelForValue(this.getParsed(a)[m.axis],a),s=Math.min(E,d.min*d.ratio);return{base:P-s/2,head:P+s/2,center:P,size:s}}draw(){const a=this._cachedMeta,d=a.vScale,m=a.data,x=m.length;let T=0;for(;T<x;++T)this.getParsed(T)[d.axis]!==null&&m[T].draw(this._ctx)}}Bi(c_,"id","bar"),Bi(c_,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Bi(c_,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});function pz(c,a,d){let m=1,x=1,T=0,E=0;if(a<_s){const P=c,s=P+a,B=Math.cos(P),q=Math.sin(P),Z=Math.cos(s),ae=Math.sin(s),ue=(gt,Lt,Rt)=>y0(gt,P,s,!0)?1:Math.max(Lt,Lt*d,Rt,Rt*d),Le=(gt,Lt,Rt)=>y0(gt,P,s,!0)?-1:Math.min(Lt,Lt*d,Rt,Rt*d),Ae=ue(0,B,Z),Oe=ue(es,q,ae),We=Le(hr,B,Z),ct=Le(hr+es,q,ae);m=(Ae-We)/2,x=(Oe-ct)/2,T=-(Ae+We)/2,E=-(Oe+ct)/2}return{ratioX:m,ratioY:x,offsetX:T,offsetY:E}}class pf extends Rc{constructor(a,d){super(a,d),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(a,d){const m=this.getDataset().data,x=this._cachedMeta;if(this._parsing===!1)x._parsed=m;else{let T=s=>+m[s];if(fn(m[a])){const{key:s="value"}=this._parsing;T=B=>+vl(m[B],s)}let E,P;for(E=a,P=a+d;E<P;++E)x._parsed[E]=T(E)}}_getRotation(){return uo(this.options.rotation-90)}_getCircumference(){return uo(this.options.circumference)}_getRotationExtents(){let a=_s,d=-_s;for(let m=0;m<this.chart.data.datasets.length;++m)if(this.chart.isDatasetVisible(m)&&this.chart.getDatasetMeta(m).type===this._type){const x=this.chart.getDatasetMeta(m).controller,T=x._getRotation(),E=x._getCircumference();a=Math.min(a,T),d=Math.max(d,T+E)}return{rotation:a,circumference:d-a}}update(a){const d=this.chart,{chartArea:m}=d,x=this._cachedMeta,T=x.data,E=this.getMaxBorderWidth()+this.getMaxOffset(T)+this.options.spacing,P=Math.max((Math.min(m.width,m.height)-E)/2,0),s=Math.min(jL(this.options.cutout,P),1),B=this._getRingWeight(this.index),{circumference:q,rotation:Z}=this._getRotationExtents(),{ratioX:ae,ratioY:ue,offsetX:Le,offsetY:Ae}=pz(Z,q,s),Oe=(m.width-E)/ae,We=(m.height-E)/ue,ct=Math.max(Math.min(Oe,We)/2,0),gt=gS(this.options.radius,ct),Lt=Math.max(gt*s,0),Rt=(gt-Lt)/this._getVisibleDatasetWeightTotal();this.offsetX=Le*gt,this.offsetY=Ae*gt,x.total=this.calculateTotal(),this.outerRadius=gt-Rt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Rt*B,0),this.updateElements(T,0,T.length,a)}_circumference(a,d){const m=this.options,x=this._cachedMeta,T=this._getCircumference();return d&&m.animation.animateRotate||!this.chart.getDataVisibility(a)||x._parsed[a]===null||x.data[a].hidden?0:this.calculateCircumference(x._parsed[a]*T/_s)}updateElements(a,d,m,x){const T=x==="reset",E=this.chart,P=E.chartArea,B=E.options.animation,q=(P.left+P.right)/2,Z=(P.top+P.bottom)/2,ae=T&&B.animateScale,ue=ae?0:this.innerRadius,Le=ae?0:this.outerRadius,{sharedOptions:Ae,includeOptions:Oe}=this._getSharedOptions(d,x);let We=this._getRotation(),ct;for(ct=0;ct<d;++ct)We+=this._circumference(ct,T);for(ct=d;ct<d+m;++ct){const gt=this._circumference(ct,T),Lt=a[ct],Rt={x:q+this.offsetX,y:Z+this.offsetY,startAngle:We,endAngle:We+gt,circumference:gt,outerRadius:Le,innerRadius:ue};Oe&&(Rt.options=Ae||this.resolveDataElementOptions(ct,Lt.active?"active":x)),We+=gt,this.updateElement(Lt,ct,Rt,x)}}calculateTotal(){const a=this._cachedMeta,d=a.data;let m=0,x;for(x=0;x<d.length;x++){const T=a._parsed[x];T!==null&&!isNaN(T)&&this.chart.getDataVisibility(x)&&!d[x].hidden&&(m+=Math.abs(T))}return m}calculateCircumference(a){const d=this._cachedMeta.total;return d>0&&!isNaN(a)?_s*(Math.abs(a)/d):0}getLabelAndValue(a){const d=this._cachedMeta,m=this.chart,x=m.data.labels||[],T=Vf(d._parsed[a],m.options.locale);return{label:x[a]||"",value:T}}getMaxBorderWidth(a){let d=0;const m=this.chart;let x,T,E,P,s;if(!a){for(x=0,T=m.data.datasets.length;x<T;++x)if(m.isDatasetVisible(x)){E=m.getDatasetMeta(x),a=E.data,P=E.controller;break}}if(!a)return 0;for(x=0,T=a.length;x<T;++x)s=P.resolveDataElementOptions(x),s.borderAlign!=="inner"&&(d=Math.max(d,s.borderWidth||0,s.hoverBorderWidth||0));return d}getMaxOffset(a){let d=0;for(let m=0,x=a.length;m<x;++m){const T=this.resolveDataElementOptions(m);d=Math.max(d,T.offset||0,T.hoverOffset||0)}return d}_getRingWeightOffset(a){let d=0;for(let m=0;m<a;++m)this.chart.isDatasetVisible(m)&&(d+=this._getRingWeight(m));return d}_getRingWeight(a){return Math.max(Hn(this.chart.data.datasets[a].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Bi(pf,"id","doughnut"),Bi(pf,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Bi(pf,"descriptors",{_scriptable:a=>a!=="spacing",_indexable:a=>a!=="spacing"&&!a.startsWith("borderDash")&&!a.startsWith("hoverBorderDash")}),Bi(pf,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(a){const d=a.data;if(d.labels.length&&d.datasets.length){const{labels:{pointStyle:m,color:x}}=a.legend.options;return d.labels.map((T,E)=>{const s=a.getDatasetMeta(0).controller.getStyle(E);return{text:T,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:x,lineWidth:s.borderWidth,pointStyle:m,hidden:!a.getDataVisibility(E),index:E}})}return[]}},onClick(a,d,m){m.chart.toggleDataVisibility(d.index),m.chart.update()}}}});class u_ extends Rc{constructor(a,d){super(a,d),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(a){const d=this._cachedMeta,m=this.chart,x=m.data.labels||[],T=Vf(d._parsed[a].r,m.options.locale);return{label:x[a]||"",value:T}}parseObjectData(a,d,m,x){return LR.bind(this)(a,d,m,x)}update(a){const d=this._cachedMeta.data;this._updateRadius(),this.updateElements(d,0,d.length,a)}getMinMax(){const a=this._cachedMeta,d={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return a.data.forEach((m,x)=>{const T=this.getParsed(x).r;!isNaN(T)&&this.chart.getDataVisibility(x)&&(T<d.min&&(d.min=T),T>d.max&&(d.max=T))}),d}_updateRadius(){const a=this.chart,d=a.chartArea,m=a.options,x=Math.min(d.right-d.left,d.bottom-d.top),T=Math.max(x/2,0),E=Math.max(m.cutoutPercentage?T/100*m.cutoutPercentage:1,0),P=(T-E)/a.getVisibleDatasetCount();this.outerRadius=T-P*this.index,this.innerRadius=this.outerRadius-P}updateElements(a,d,m,x){const T=x==="reset",E=this.chart,s=E.options.animation,B=this._cachedMeta.rScale,q=B.xCenter,Z=B.yCenter,ae=B.getIndexAngle(0)-.5*hr;let ue=ae,Le;const Ae=360/this.countVisibleElements();for(Le=0;Le<d;++Le)ue+=this._computeAngle(Le,x,Ae);for(Le=d;Le<d+m;Le++){const Oe=a[Le];let We=ue,ct=ue+this._computeAngle(Le,x,Ae),gt=E.getDataVisibility(Le)?B.getDistanceFromCenterForValue(this.getParsed(Le).r):0;ue=ct,T&&(s.animateScale&&(gt=0),s.animateRotate&&(We=ct=ae));const Lt={x:q,y:Z,innerRadius:0,outerRadius:gt,startAngle:We,endAngle:ct,options:this.resolveDataElementOptions(Le,Oe.active?"active":x)};this.updateElement(Oe,Le,Lt,x)}}countVisibleElements(){const a=this._cachedMeta;let d=0;return a.data.forEach((m,x)=>{!isNaN(this.getParsed(x).r)&&this.chart.getDataVisibility(x)&&d++}),d}_computeAngle(a,d,m){return this.chart.getDataVisibility(a)?uo(this.resolveDataElementOptions(a,d).angle||m):0}}Bi(u_,"id","polarArea"),Bi(u_,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),Bi(u_,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(a){const d=a.data;if(d.labels.length&&d.datasets.length){const{labels:{pointStyle:m,color:x}}=a.legend.options;return d.labels.map((T,E)=>{const s=a.getDatasetMeta(0).controller.getStyle(E);return{text:T,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:x,lineWidth:s.borderWidth,pointStyle:m,hidden:!a.getDataVisibility(E),index:E}})}return[]}},onClick(a,d,m){m.chart.toggleDataVisibility(d.index),m.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});function Mc(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class ox{constructor(a){Bi(this,"options");this.options=a||{}}static override(a){Object.assign(ox.prototype,a)}init(){}formats(){return Mc()}parse(){return Mc()}format(){return Mc()}add(){return Mc()}diff(){return Mc()}startOf(){return Mc()}endOf(){return Mc()}}var mz={_date:ox};function _z(c,a,d,m){const{controller:x,data:T,_sorted:E}=c,P=x._cachedMeta.iScale;if(P&&a===P.axis&&a!=="r"&&E&&T.length){const s=P._reversePixels?eR:x0;if(m){if(x._sharedOptions){const B=T[0],q=typeof B.getRange=="function"&&B.getRange(a);if(q){const Z=s(T,a,d-q),ae=s(T,a,d+q);return{lo:Z.lo,hi:ae.hi}}}}else return s(T,a,d)}return{lo:0,hi:T.length-1}}function Uf(c,a,d,m,x){const T=c.getSortedVisibleDatasetMetas(),E=d[a];for(let P=0,s=T.length;P<s;++P){const{index:B,data:q}=T[P],{lo:Z,hi:ae}=_z(T[P],a,E,x);for(let ue=Z;ue<=ae;++ue){const Le=q[ue];Le.skip||m(Le,B,ue)}}}function gz(c){const a=c.indexOf("x")!==-1,d=c.indexOf("y")!==-1;return function(m,x){const T=a?Math.abs(m.x-x.x):0,E=d?Math.abs(m.y-x.y):0;return Math.sqrt(Math.pow(T,2)+Math.pow(E,2))}}function Jy(c,a,d,m,x){const T=[];return!x&&!c.isPointInArea(a)||Uf(c,d,a,function(P,s,B){!x&&!Hu(P,c.chartArea,0)||P.inRange(a.x,a.y,m)&&T.push({element:P,datasetIndex:s,index:B})},!0),T}function yz(c,a,d,m){let x=[];function T(E,P,s){const{startAngle:B,endAngle:q}=E.getProps(["startAngle","endAngle"],m),{angle:Z}=KL(E,{x:a.x,y:a.y});y0(Z,B,q)&&x.push({element:E,datasetIndex:P,index:s})}return Uf(c,d,a,T),x}function xz(c,a,d,m,x,T){let E=[];const P=gz(d);let s=Number.POSITIVE_INFINITY;function B(q,Z,ae){const ue=q.inRange(a.x,a.y,x);if(m&&!ue)return;const Le=q.getCenterPoint(x);if(!(!!T||c.isPointInArea(Le))&&!ue)return;const Oe=P(a,Le);Oe<s?(E=[{element:q,datasetIndex:Z,index:ae}],s=Oe):Oe===s&&E.push({element:q,datasetIndex:Z,index:ae})}return Uf(c,d,a,B),E}function Qy(c,a,d,m,x,T){return!T&&!c.isPointInArea(a)?[]:d==="r"&&!m?yz(c,a,d,x):xz(c,a,d,m,x,T)}function TT(c,a,d,m,x){const T=[],E=d==="x"?"inXRange":"inYRange";let P=!1;return Uf(c,d,a,(s,B,q)=>{s[E](a[d],x)&&(T.push({element:s,datasetIndex:B,index:q}),P=P||s.inRange(a.x,a.y,x))}),m&&!P?[]:T}var vz={evaluateInteractionItems:Uf,modes:{index(c,a,d,m){const x=Ec(a,c),T=d.axis||"x",E=d.includeInvisible||!1,P=d.intersect?Jy(c,x,T,m,E):Qy(c,x,T,!1,m,E),s=[];return P.length?(c.getSortedVisibleDatasetMetas().forEach(B=>{const q=P[0].index,Z=B.data[q];Z&&!Z.skip&&s.push({element:Z,datasetIndex:B.index,index:q})}),s):[]},dataset(c,a,d,m){const x=Ec(a,c),T=d.axis||"xy",E=d.includeInvisible||!1;let P=d.intersect?Jy(c,x,T,m,E):Qy(c,x,T,!1,m,E);if(P.length>0){const s=P[0].datasetIndex,B=c.getDatasetMeta(s).data;P=[];for(let q=0;q<B.length;++q)P.push({element:B[q],datasetIndex:s,index:q})}return P},point(c,a,d,m){const x=Ec(a,c),T=d.axis||"xy",E=d.includeInvisible||!1;return Jy(c,x,T,m,E)},nearest(c,a,d,m){const x=Ec(a,c),T=d.axis||"xy",E=d.includeInvisible||!1;return Qy(c,x,T,d.intersect,m,E)},x(c,a,d,m){const x=Ec(a,c);return TT(c,x,"x",d.intersect,m)},y(c,a,d,m){const x=Ec(a,c);return TT(c,x,"y",d.intersect,m)}}};const BS=["left","top","right","bottom"];function of(c,a){return c.filter(d=>d.pos===a)}function MT(c,a){return c.filter(d=>BS.indexOf(d.pos)===-1&&d.box.axis===a)}function af(c,a){return c.sort((d,m)=>{const x=a?m:d,T=a?d:m;return x.weight===T.weight?x.index-T.index:x.weight-T.weight})}function bz(c){const a=[];let d,m,x,T,E,P;for(d=0,m=(c||[]).length;d<m;++d)x=c[d],{position:T,options:{stack:E,stackWeight:P=1}}=x,a.push({index:d,box:x,pos:T,horizontal:x.isHorizontal(),weight:x.weight,stack:E&&T+E,stackWeight:P});return a}function wz(c){const a={};for(const d of c){const{stack:m,pos:x,stackWeight:T}=d;if(!m||!BS.includes(x))continue;const E=a[m]||(a[m]={count:0,placed:0,weight:0,size:0});E.count++,E.weight+=T}return a}function Tz(c,a){const d=wz(c),{vBoxMaxWidth:m,hBoxMaxHeight:x}=a;let T,E,P;for(T=0,E=c.length;T<E;++T){P=c[T];const{fullSize:s}=P.box,B=d[P.stack],q=B&&P.stackWeight/B.weight;P.horizontal?(P.width=q?q*m:s&&a.availableWidth,P.height=x):(P.width=m,P.height=q?q*x:s&&a.availableHeight)}return d}function Mz(c){const a=bz(c),d=af(a.filter(B=>B.box.fullSize),!0),m=af(of(a,"left"),!0),x=af(of(a,"right")),T=af(of(a,"top"),!0),E=af(of(a,"bottom")),P=MT(a,"x"),s=MT(a,"y");return{fullSize:d,leftAndTop:m.concat(T),rightAndBottom:x.concat(s).concat(E).concat(P),chartArea:of(a,"chartArea"),vertical:m.concat(x).concat(s),horizontal:T.concat(E).concat(P)}}function ST(c,a,d,m){return Math.max(c[d],a[d])+Math.max(c[m],a[m])}function NS(c,a){c.top=Math.max(c.top,a.top),c.left=Math.max(c.left,a.left),c.bottom=Math.max(c.bottom,a.bottom),c.right=Math.max(c.right,a.right)}function Sz(c,a,d,m){const{pos:x,box:T}=d,E=c.maxPadding;if(!fn(x)){d.size&&(c[x]-=d.size);const Z=m[d.stack]||{size:0,count:1};Z.size=Math.max(Z.size,d.horizontal?T.height:T.width),d.size=Z.size/Z.count,c[x]+=d.size}T.getPadding&&NS(E,T.getPadding());const P=Math.max(0,a.outerWidth-ST(E,c,"left","right")),s=Math.max(0,a.outerHeight-ST(E,c,"top","bottom")),B=P!==c.w,q=s!==c.h;return c.w=P,c.h=s,d.horizontal?{same:B,other:q}:{same:q,other:B}}function Ez(c){const a=c.maxPadding;function d(m){const x=Math.max(a[m]-c[m],0);return c[m]+=x,x}c.y+=d("top"),c.x+=d("left"),d("right"),d("bottom")}function Az(c,a){const d=a.maxPadding;function m(x){const T={left:0,top:0,right:0,bottom:0};return x.forEach(E=>{T[E]=Math.max(a[E],d[E])}),T}return m(c?["left","right"]:["top","bottom"])}function mf(c,a,d,m){const x=[];let T,E,P,s,B,q;for(T=0,E=c.length,B=0;T<E;++T){P=c[T],s=P.box,s.update(P.width||a.w,P.height||a.h,Az(P.horizontal,a));const{same:Z,other:ae}=Sz(a,d,P,m);B|=Z&&x.length,q=q||ae,s.fullSize||x.push(P)}return B&&mf(x,a,d,m)||q}function Zm(c,a,d,m,x){c.top=d,c.left=a,c.right=a+m,c.bottom=d+x,c.width=m,c.height=x}function ET(c,a,d,m){const x=d.padding;let{x:T,y:E}=a;for(const P of c){const s=P.box,B=m[P.stack]||{count:1,placed:0,weight:1},q=P.stackWeight/B.weight||1;if(P.horizontal){const Z=a.w*q,ae=B.size||s.height;zf(B.start)&&(E=B.start),s.fullSize?Zm(s,x.left,E,d.outerWidth-x.right-x.left,ae):Zm(s,a.left+B.placed,E,Z,ae),B.start=E,B.placed+=Z,E=s.bottom}else{const Z=a.h*q,ae=B.size||s.width;zf(B.start)&&(T=B.start),s.fullSize?Zm(s,T,x.top,ae,d.outerHeight-x.bottom-x.top):Zm(s,T,a.top+B.placed,ae,Z),B.start=T,B.placed+=Z,T=s.right}}a.x=T,a.y=E}var pl={addBox(c,a){c.boxes||(c.boxes=[]),a.fullSize=a.fullSize||!1,a.position=a.position||"top",a.weight=a.weight||0,a._layers=a._layers||function(){return[{z:0,draw(d){a.draw(d)}}]},c.boxes.push(a)},removeBox(c,a){const d=c.boxes?c.boxes.indexOf(a):-1;d!==-1&&c.boxes.splice(d,1)},configure(c,a,d){a.fullSize=d.fullSize,a.position=d.position,a.weight=d.weight},update(c,a,d,m){if(!c)return;const x=ks(c.options.layout.padding),T=Math.max(a-x.width,0),E=Math.max(d-x.height,0),P=Mz(c.boxes),s=P.vertical,B=P.horizontal;In(c.boxes,Ae=>{typeof Ae.beforeLayout=="function"&&Ae.beforeLayout()});const q=s.reduce((Ae,Oe)=>Oe.box.options&&Oe.box.options.display===!1?Ae:Ae+1,0)||1,Z=Object.freeze({outerWidth:a,outerHeight:d,padding:x,availableWidth:T,availableHeight:E,vBoxMaxWidth:T/2/q,hBoxMaxHeight:E/2}),ae=Object.assign({},x);NS(ae,ks(m));const ue=Object.assign({maxPadding:ae,w:T,h:E,x:x.left,y:x.top},x),Le=Tz(s.concat(B),Z);mf(P.fullSize,ue,Z,Le),mf(s,ue,Z,Le),mf(B,ue,Z,Le)&&mf(s,ue,Z,Le),Ez(ue),ET(P.leftAndTop,ue,Z,Le),ue.x+=ue.w,ue.y+=ue.h,ET(P.rightAndBottom,ue,Z,Le),c.chartArea={left:ue.left,top:ue.top,right:ue.left+ue.w,bottom:ue.top+ue.h,height:ue.h,width:ue.w},In(P.chartArea,Ae=>{const Oe=Ae.box;Object.assign(Oe,c.chartArea),Oe.update(ue.w,ue.h,{left:0,top:0,right:0,bottom:0})})}};class VS{acquireContext(a,d){}releaseContext(a){return!1}addEventListener(a,d,m){}removeEventListener(a,d,m){}getDevicePixelRatio(){return 1}getMaximumSize(a,d,m,x){return d=Math.max(0,d||a.width),m=m||a.height,{width:d,height:Math.max(0,x?Math.floor(d/x):m)}}isAttached(a){return!0}updateConfig(a){}}class Iz extends VS{acquireContext(a){return a&&a.getContext&&a.getContext("2d")||null}updateConfig(a){a.options.animation=!1}}const h_="$chartjs",Cz={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},AT=c=>c===null||c==="";function Pz(c,a){const d=c.style,m=c.getAttribute("height"),x=c.getAttribute("width");if(c[h_]={initial:{height:m,width:x,style:{display:d.display,height:d.height,width:d.width}}},d.display=d.display||"block",d.boxSizing=d.boxSizing||"border-box",AT(x)){const T=dT(c,"width");T!==void 0&&(c.width=T)}if(AT(m))if(c.style.height==="")c.height=c.width/(a||2);else{const T=dT(c,"height");T!==void 0&&(c.height=T)}return c}const US=NR?{passive:!0}:!1;function Dz(c,a,d){c&&c.addEventListener(a,d,US)}function Lz(c,a,d){c&&c.canvas&&c.canvas.removeEventListener(a,d,US)}function Rz(c,a){const d=Cz[c.type]||c.type,{x:m,y:x}=Ec(c,a);return{type:d,chart:a,native:c,x:m!==void 0?m:null,y:x!==void 0?x:null}}function E_(c,a){for(const d of c)if(d===a||d.contains(a))return!0}function zz(c,a,d){const m=c.canvas,x=new MutationObserver(T=>{let E=!1;for(const P of T)E=E||E_(P.addedNodes,m),E=E&&!E_(P.removedNodes,m);E&&d()});return x.observe(document,{childList:!0,subtree:!0}),x}function kz(c,a,d){const m=c.canvas,x=new MutationObserver(T=>{let E=!1;for(const P of T)E=E||E_(P.removedNodes,m),E=E&&!E_(P.addedNodes,m);E&&d()});return x.observe(document,{childList:!0,subtree:!0}),x}const Of=new Map;let IT=0;function jS(){const c=window.devicePixelRatio;c!==IT&&(IT=c,Of.forEach((a,d)=>{d.currentDevicePixelRatio!==c&&a()}))}function Oz(c,a){Of.size||window.addEventListener("resize",jS),Of.set(c,a)}function Fz(c){Of.delete(c),Of.size||window.removeEventListener("resize",jS)}function Bz(c,a,d){const m=c.canvas,x=m&&sx(m);if(!x)return;const T=TS((P,s)=>{const B=x.clientWidth;d(P,s),B<x.clientWidth&&d()},window),E=new ResizeObserver(P=>{const s=P[0],B=s.contentRect.width,q=s.contentRect.height;B===0&&q===0||T(B,q)});return E.observe(x),Oz(c,T),E}function e0(c,a,d){d&&d.disconnect(),a==="resize"&&Fz(c)}function Nz(c,a,d){const m=c.canvas,x=TS(T=>{c.ctx!==null&&d(Rz(T,c))},c);return Dz(m,a,x),x}class Vz extends VS{acquireContext(a,d){const m=a&&a.getContext&&a.getContext("2d");return m&&m.canvas===a?(Pz(a,d),m):null}releaseContext(a){const d=a.canvas;if(!d[h_])return!1;const m=d[h_].initial;["height","width"].forEach(T=>{const E=m[T];Dn(E)?d.removeAttribute(T):d.setAttribute(T,E)});const x=m.style||{};return Object.keys(x).forEach(T=>{d.style[T]=x[T]}),d.width=d.width,delete d[h_],!0}addEventListener(a,d,m){this.removeEventListener(a,d);const x=a.$proxies||(a.$proxies={}),E={attach:zz,detach:kz,resize:Bz}[d]||Nz;x[d]=E(a,d,m)}removeEventListener(a,d){const m=a.$proxies||(a.$proxies={}),x=m[d];if(!x)return;({attach:e0,detach:e0,resize:e0}[d]||Lz)(a,d,x),m[d]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(a,d,m,x){return BR(a,d,m,x)}isAttached(a){const d=sx(a);return!!(d&&d.isConnected)}}function Uz(c){return!rx()||typeof OffscreenCanvas<"u"&&c instanceof OffscreenCanvas?Iz:Vz}var i_;let jf=(i_=class{constructor(){Bi(this,"x");Bi(this,"y");Bi(this,"active",!1);Bi(this,"options");Bi(this,"$animations")}tooltipPosition(a){const{x:d,y:m}=this.getProps(["x","y"],a);return{x:d,y:m}}hasValue(){return w_(this.x)&&w_(this.y)}getProps(a,d){const m=this.$animations;if(!d||!m)return this;const x={};return a.forEach(T=>{x[T]=m[T]&&m[T].active()?m[T]._to:this[T]}),x}},Bi(i_,"defaults",{}),Bi(i_,"defaultRoutes"),i_);function jz(c,a){const d=c.options.ticks,m=Gz(c),x=Math.min(d.maxTicksLimit||m,m),T=d.major.enabled?qz(a):[],E=T.length,P=T[0],s=T[E-1],B=[];if(E>x)return Hz(a,B,T,E/x),B;const q=$z(T,a,x);if(E>0){let Z,ae;const ue=E>1?Math.round((s-P)/(E-1)):null;for(Xm(a,B,q,Dn(ue)?0:P-ue,P),Z=0,ae=E-1;Z<ae;Z++)Xm(a,B,q,T[Z],T[Z+1]);return Xm(a,B,q,s,Dn(ue)?a.length:s+ue),B}return Xm(a,B,q),B}function Gz(c){const a=c.options.offset,d=c._tickSize(),m=c._length/d+(a?0:1),x=c._maxLength/d;return Math.floor(Math.min(m,x))}function $z(c,a,d){const m=Wz(c),x=a.length/d;if(!m)return Math.max(x,1);const T=XL(m);for(let E=0,P=T.length-1;E<P;E++){const s=T[E];if(s>x)return s}return Math.max(x,1)}function qz(c){const a=[];let d,m;for(d=0,m=c.length;d<m;d++)c[d].major&&a.push(d);return a}function Hz(c,a,d,m){let x=0,T=d[0],E;for(m=Math.ceil(m),E=0;E<c.length;E++)E===T&&(a.push(c[E]),x++,T=d[x*m])}function Xm(c,a,d,m,x){const T=Hn(m,0),E=Math.min(Hn(x,c.length),c.length);let P=0,s,B,q;for(d=Math.ceil(d),x&&(s=x-m,d=s/Math.floor(s/d)),q=T;q<0;)P++,q=Math.round(T+P*d);for(B=Math.max(T,0);B<E;B++)B===q&&(a.push(c[B]),P++,q=Math.round(T+P*d))}function Wz(c){const a=c.length;let d,m;if(a<2)return!1;for(m=c[0],d=1;d<a;++d)if(c[d]-c[d-1]!==m)return!1;return m}const Zz=c=>c==="left"?"right":c==="right"?"left":c,CT=(c,a,d)=>a==="top"||a==="left"?c[a]+d:c[a]-d,PT=(c,a)=>Math.min(a||c,c);function DT(c,a){const d=[],m=c.length/a,x=c.length;let T=0;for(;T<x;T+=m)d.push(c[Math.floor(T)]);return d}function Xz(c,a,d){const m=c.ticks.length,x=Math.min(a,m-1),T=c._startPixel,E=c._endPixel,P=1e-6;let s=c.getPixelForTick(x),B;if(!(d&&(m===1?B=Math.max(s-T,E-s):a===0?B=(c.getPixelForTick(1)-s)/2:B=(s-c.getPixelForTick(x-1))/2,s+=x<a?B:-B,s<T-P||s>E+P)))return s}function Yz(c,a){In(c,d=>{const m=d.gc,x=m.length/2;let T;if(x>a){for(T=0;T<x;++T)delete d.data[m[T]];m.splice(0,x)}})}function lf(c){return c.drawTicks?c.tickLength:0}function LT(c,a){if(!c.display)return 0;const d=ts(c.font,a),m=ks(c.padding);return(Yn(c.text)?c.text.length:1)*d.lineHeight+m.height}function Kz(c,a){return Nc(c,{scale:a,type:"scale"})}function Jz(c,a,d){return Nc(c,{tick:d,index:a,type:"tick"})}function Qz(c,a,d){let m=MS(c);return(d&&a!=="right"||!d&&a==="right")&&(m=Zz(m)),m}function ek(c,a,d,m){const{top:x,left:T,bottom:E,right:P,chart:s}=c,{chartArea:B,scales:q}=s;let Z=0,ae,ue,Le;const Ae=E-x,Oe=P-T;if(c.isHorizontal()){if(ue=Mf(m,T,P),fn(d)){const We=Object.keys(d)[0],ct=d[We];Le=q[We].getPixelForValue(ct)+Ae-a}else d==="center"?Le=(B.bottom+B.top)/2+Ae-a:Le=CT(c,d,a);ae=P-T}else{if(fn(d)){const We=Object.keys(d)[0],ct=d[We];ue=q[We].getPixelForValue(ct)-Oe+a}else d==="center"?ue=(B.left+B.right)/2-Oe+a:ue=CT(c,d,a);Le=Mf(m,E,x),Z=d==="left"?-es:es}return{titleX:ue,titleY:Le,maxWidth:ae,rotation:Z}}class Vc extends jf{constructor(a){super(),this.id=a.id,this.type=a.type,this.options=void 0,this.ctx=a.ctx,this.chart=a.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(a){this.options=a.setContext(this.getContext()),this.axis=a.axis,this._userMin=this.parse(a.min),this._userMax=this.parse(a.max),this._suggestedMin=this.parse(a.suggestedMin),this._suggestedMax=this.parse(a.suggestedMax)}parse(a,d){return a}getUserBounds(){let{_userMin:a,_userMax:d,_suggestedMin:m,_suggestedMax:x}=this;return a=Rs(a,Number.POSITIVE_INFINITY),d=Rs(d,Number.NEGATIVE_INFINITY),m=Rs(m,Number.POSITIVE_INFINITY),x=Rs(x,Number.NEGATIVE_INFINITY),{min:Rs(a,m),max:Rs(d,x),minDefined:Cr(a),maxDefined:Cr(d)}}getMinMax(a){let{min:d,max:m,minDefined:x,maxDefined:T}=this.getUserBounds(),E;if(x&&T)return{min:d,max:m};const P=this.getMatchingVisibleMetas();for(let s=0,B=P.length;s<B;++s)E=P[s].controller.getMinMax(this,a),x||(d=Math.min(d,E.min)),T||(m=Math.max(m,E.max));return d=T&&d>m?m:d,m=x&&d>m?d:m,{min:Rs(d,Rs(m,d)),max:Rs(m,Rs(d,m))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const a=this.chart.data;return this.options.labels||(this.isHorizontal()?a.xLabels:a.yLabels)||a.labels||[]}getLabelItems(a=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(a))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ir(this.options.beforeUpdate,[this])}update(a,d,m){const{beginAtZero:x,grace:T,ticks:E}=this.options,P=E.sampleSize;this.beforeUpdate(),this.maxWidth=a,this.maxHeight=d,this._margins=m=Object.assign({left:0,right:0,top:0,bottom:0},m),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+m.left+m.right:this.height+m.top+m.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=wR(this,T,x),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const s=P<this.ticks.length;this._convertTicksToLabels(s?DT(this.ticks,P):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),E.display&&(E.autoSkip||E.source==="auto")&&(this.ticks=jz(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),s&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let a=this.options.reverse,d,m;this.isHorizontal()?(d=this.left,m=this.right):(d=this.top,m=this.bottom,a=!a),this._startPixel=d,this._endPixel=m,this._reversePixels=a,this._length=m-d,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ir(this.options.afterUpdate,[this])}beforeSetDimensions(){ir(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ir(this.options.afterSetDimensions,[this])}_callHooks(a){this.chart.notifyPlugins(a,this.getContext()),ir(this.options[a],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ir(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(a){const d=this.options.ticks;let m,x,T;for(m=0,x=a.length;m<x;m++)T=a[m],T.label=ir(d.callback,[T.value,m,a],this)}afterTickToLabelConversion(){ir(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ir(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const a=this.options,d=a.ticks,m=PT(this.ticks.length,a.ticks.maxTicksLimit),x=d.minRotation||0,T=d.maxRotation;let E=x,P,s,B;if(!this._isVisible()||!d.display||x>=T||m<=1||!this.isHorizontal()){this.labelRotation=x;return}const q=this._getLabelSizes(),Z=q.widest.width,ae=q.highest.height,ue=ho(this.chart.width-Z,0,this.maxWidth);P=a.offset?this.maxWidth/m:ue/(m-1),Z+6>P&&(P=ue/(m-(a.offset?.5:1)),s=this.maxHeight-lf(a.grid)-d.padding-LT(a.title,this.chart.options.font),B=Math.sqrt(Z*Z+ae*ae),E=Q0(Math.min(Math.asin(ho((q.highest.height+6)/P,-1,1)),Math.asin(ho(s/B,-1,1))-Math.asin(ho(ae/B,-1,1)))),E=Math.max(x,Math.min(T,E))),this.labelRotation=E}afterCalculateLabelRotation(){ir(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ir(this.options.beforeFit,[this])}fit(){const a={width:0,height:0},{chart:d,options:{ticks:m,title:x,grid:T}}=this,E=this._isVisible(),P=this.isHorizontal();if(E){const s=LT(x,d.options.font);if(P?(a.width=this.maxWidth,a.height=lf(T)+s):(a.height=this.maxHeight,a.width=lf(T)+s),m.display&&this.ticks.length){const{first:B,last:q,widest:Z,highest:ae}=this._getLabelSizes(),ue=m.padding*2,Le=uo(this.labelRotation),Ae=Math.cos(Le),Oe=Math.sin(Le);if(P){const We=m.mirror?0:Oe*Z.width+Ae*ae.height;a.height=Math.min(this.maxHeight,a.height+We+ue)}else{const We=m.mirror?0:Ae*Z.width+Oe*ae.height;a.width=Math.min(this.maxWidth,a.width+We+ue)}this._calculatePadding(B,q,Oe,Ae)}}this._handleMargins(),P?(this.width=this._length=d.width-this._margins.left-this._margins.right,this.height=a.height):(this.width=a.width,this.height=this._length=d.height-this._margins.top-this._margins.bottom)}_calculatePadding(a,d,m,x){const{ticks:{align:T,padding:E},position:P}=this.options,s=this.labelRotation!==0,B=P!=="top"&&this.axis==="x";if(this.isHorizontal()){const q=this.getPixelForTick(0)-this.left,Z=this.right-this.getPixelForTick(this.ticks.length-1);let ae=0,ue=0;s?B?(ae=x*a.width,ue=m*d.height):(ae=m*a.height,ue=x*d.width):T==="start"?ue=d.width:T==="end"?ae=a.width:T!=="inner"&&(ae=a.width/2,ue=d.width/2),this.paddingLeft=Math.max((ae-q+E)*this.width/(this.width-q),0),this.paddingRight=Math.max((ue-Z+E)*this.width/(this.width-Z),0)}else{let q=d.height/2,Z=a.height/2;T==="start"?(q=0,Z=a.height):T==="end"&&(q=d.height,Z=0),this.paddingTop=q+E,this.paddingBottom=Z+E}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ir(this.options.afterFit,[this])}isHorizontal(){const{axis:a,position:d}=this.options;return d==="top"||d==="bottom"||a==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(a){this.beforeTickToLabelConversion(),this.generateTickLabels(a);let d,m;for(d=0,m=a.length;d<m;d++)Dn(a[d].label)&&(a.splice(d,1),m--,d--);this.afterTickToLabelConversion()}_getLabelSizes(){let a=this._labelSizes;if(!a){const d=this.options.ticks.sampleSize;let m=this.ticks;d<m.length&&(m=DT(m,d)),this._labelSizes=a=this._computeLabelSizes(m,m.length,this.options.ticks.maxTicksLimit)}return a}_computeLabelSizes(a,d,m){const{ctx:x,_longestTextCache:T}=this,E=[],P=[],s=Math.floor(d/PT(d,m));let B=0,q=0,Z,ae,ue,Le,Ae,Oe,We,ct,gt,Lt,Rt;for(Z=0;Z<d;Z+=s){if(Le=a[Z].label,Ae=this._resolveTickFontOptions(Z),x.font=Oe=Ae.string,We=T[Oe]=T[Oe]||{data:{},gc:[]},ct=Ae.lineHeight,gt=Lt=0,!Dn(Le)&&!Yn(Le))gt=T_(x,We.data,We.gc,gt,Le),Lt=ct;else if(Yn(Le))for(ae=0,ue=Le.length;ae<ue;++ae)Rt=Le[ae],!Dn(Rt)&&!Yn(Rt)&&(gt=T_(x,We.data,We.gc,gt,Rt),Lt+=ct);E.push(gt),P.push(Lt),B=Math.max(gt,B),q=Math.max(Lt,q)}Yz(T,d);const Wt=E.indexOf(B),ui=P.indexOf(q),bi=$e=>({width:E[$e]||0,height:P[$e]||0});return{first:bi(0),last:bi(d-1),widest:bi(Wt),highest:bi(ui),widths:E,heights:P}}getLabelForValue(a){return a}getPixelForValue(a,d){return NaN}getValueForPixel(a){}getPixelForTick(a){const d=this.ticks;return a<0||a>d.length-1?null:this.getPixelForValue(d[a].value)}getPixelForDecimal(a){this._reversePixels&&(a=1-a);const d=this._startPixel+a*this._length;return QL(this._alignToPixels?Tc(this.chart,d,0):d)}getDecimalForPixel(a){const d=(a-this._startPixel)/this._length;return this._reversePixels?1-d:d}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:a,max:d}=this;return a<0&&d<0?d:a>0&&d>0?a:0}getContext(a){const d=this.ticks||[];if(a>=0&&a<d.length){const m=d[a];return m.$context||(m.$context=Jz(this.getContext(),a,m))}return this.$context||(this.$context=Kz(this.chart.getContext(),this))}_tickSize(){const a=this.options.ticks,d=uo(this.labelRotation),m=Math.abs(Math.cos(d)),x=Math.abs(Math.sin(d)),T=this._getLabelSizes(),E=a.autoSkipPadding||0,P=T?T.widest.width+E:0,s=T?T.highest.height+E:0;return this.isHorizontal()?s*m>P*x?P/m:s/x:s*x<P*m?s/m:P/x}_isVisible(){const a=this.options.display;return a!=="auto"?!!a:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(a){const d=this.axis,m=this.chart,x=this.options,{grid:T,position:E,border:P}=x,s=T.offset,B=this.isHorizontal(),Z=this.ticks.length+(s?1:0),ae=lf(T),ue=[],Le=P.setContext(this.getContext()),Ae=Le.display?Le.width:0,Oe=Ae/2,We=function(Ri){return Tc(m,Ri,Ae)};let ct,gt,Lt,Rt,Wt,ui,bi,$e,Ji,un,Zt,sn;if(E==="top")ct=We(this.bottom),ui=this.bottom-ae,$e=ct-Oe,un=We(a.top)+Oe,sn=a.bottom;else if(E==="bottom")ct=We(this.top),un=a.top,sn=We(a.bottom)-Oe,ui=ct+Oe,$e=this.top+ae;else if(E==="left")ct=We(this.right),Wt=this.right-ae,bi=ct-Oe,Ji=We(a.left)+Oe,Zt=a.right;else if(E==="right")ct=We(this.left),Ji=a.left,Zt=We(a.right)-Oe,Wt=ct+Oe,bi=this.left+ae;else if(d==="x"){if(E==="center")ct=We((a.top+a.bottom)/2+.5);else if(fn(E)){const Ri=Object.keys(E)[0],gi=E[Ri];ct=We(this.chart.scales[Ri].getPixelForValue(gi))}un=a.top,sn=a.bottom,ui=ct+Oe,$e=ui+ae}else if(d==="y"){if(E==="center")ct=We((a.left+a.right)/2);else if(fn(E)){const Ri=Object.keys(E)[0],gi=E[Ri];ct=We(this.chart.scales[Ri].getPixelForValue(gi))}Wt=ct-Oe,bi=Wt-ae,Ji=a.left,Zt=a.right}const xr=Hn(x.ticks.maxTicksLimit,Z),Qe=Math.max(1,Math.ceil(Z/xr));for(gt=0;gt<Z;gt+=Qe){const Ri=this.getContext(gt),gi=T.setContext(Ri),kt=P.setContext(Ri),rr=gi.lineWidth,Kn=gi.color,Rn=kt.dash||[],Qi=kt.dashOffset,Tr=gi.tickWidth,Mr=gi.tickColor,Hr=gi.tickBorderDash||[],On=gi.tickBorderDashOffset;Lt=Xz(this,gt,s),Lt!==void 0&&(Rt=Tc(m,Lt,rr),B?Wt=bi=Ji=Zt=Rt:ui=$e=un=sn=Rt,ue.push({tx1:Wt,ty1:ui,tx2:bi,ty2:$e,x1:Ji,y1:un,x2:Zt,y2:sn,width:rr,color:Kn,borderDash:Rn,borderDashOffset:Qi,tickWidth:Tr,tickColor:Mr,tickBorderDash:Hr,tickBorderDashOffset:On}))}return this._ticksLength=Z,this._borderValue=ct,ue}_computeLabelItems(a){const d=this.axis,m=this.options,{position:x,ticks:T}=m,E=this.isHorizontal(),P=this.ticks,{align:s,crossAlign:B,padding:q,mirror:Z}=T,ae=lf(m.grid),ue=ae+q,Le=Z?-q:ue,Ae=-uo(this.labelRotation),Oe=[];let We,ct,gt,Lt,Rt,Wt,ui,bi,$e,Ji,un,Zt,sn="middle";if(x==="top")Wt=this.bottom-Le,ui=this._getXAxisLabelAlignment();else if(x==="bottom")Wt=this.top+Le,ui=this._getXAxisLabelAlignment();else if(x==="left"){const Qe=this._getYAxisLabelAlignment(ae);ui=Qe.textAlign,Rt=Qe.x}else if(x==="right"){const Qe=this._getYAxisLabelAlignment(ae);ui=Qe.textAlign,Rt=Qe.x}else if(d==="x"){if(x==="center")Wt=(a.top+a.bottom)/2+ue;else if(fn(x)){const Qe=Object.keys(x)[0],Ri=x[Qe];Wt=this.chart.scales[Qe].getPixelForValue(Ri)+ue}ui=this._getXAxisLabelAlignment()}else if(d==="y"){if(x==="center")Rt=(a.left+a.right)/2-ue;else if(fn(x)){const Qe=Object.keys(x)[0],Ri=x[Qe];Rt=this.chart.scales[Qe].getPixelForValue(Ri)}ui=this._getYAxisLabelAlignment(ae).textAlign}d==="y"&&(s==="start"?sn="top":s==="end"&&(sn="bottom"));const xr=this._getLabelSizes();for(We=0,ct=P.length;We<ct;++We){gt=P[We],Lt=gt.label;const Qe=T.setContext(this.getContext(We));bi=this.getPixelForTick(We)+T.labelOffset,$e=this._resolveTickFontOptions(We),Ji=$e.lineHeight,un=Yn(Lt)?Lt.length:1;const Ri=un/2,gi=Qe.color,kt=Qe.textStrokeColor,rr=Qe.textStrokeWidth;let Kn=ui;E?(Rt=bi,ui==="inner"&&(We===ct-1?Kn=this.options.reverse?"left":"right":We===0?Kn=this.options.reverse?"right":"left":Kn="center"),x==="top"?B==="near"||Ae!==0?Zt=-un*Ji+Ji/2:B==="center"?Zt=-xr.highest.height/2-Ri*Ji+Ji:Zt=-xr.highest.height+Ji/2:B==="near"||Ae!==0?Zt=Ji/2:B==="center"?Zt=xr.highest.height/2-Ri*Ji:Zt=xr.highest.height-un*Ji,Z&&(Zt*=-1),Ae!==0&&!Qe.showLabelBackdrop&&(Rt+=Ji/2*Math.sin(Ae))):(Wt=bi,Zt=(1-un)*Ji/2);let Rn;if(Qe.showLabelBackdrop){const Qi=ks(Qe.backdropPadding),Tr=xr.heights[We],Mr=xr.widths[We];let Hr=Zt-Qi.top,On=0-Qi.left;switch(sn){case"middle":Hr-=Tr/2;break;case"bottom":Hr-=Tr;break}switch(ui){case"center":On-=Mr/2;break;case"right":On-=Mr;break;case"inner":We===ct-1?On-=Mr:We>0&&(On-=Mr/2);break}Rn={left:On,top:Hr,width:Mr+Qi.width,height:Tr+Qi.height,color:Qe.backdropColor}}Oe.push({label:Lt,font:$e,textOffset:Zt,options:{rotation:Ae,color:gi,strokeColor:kt,strokeWidth:rr,textAlign:Kn,textBaseline:sn,translation:[Rt,Wt],backdrop:Rn}})}return Oe}_getXAxisLabelAlignment(){const{position:a,ticks:d}=this.options;if(-uo(this.labelRotation))return a==="top"?"left":"right";let x="center";return d.align==="start"?x="left":d.align==="end"?x="right":d.align==="inner"&&(x="inner"),x}_getYAxisLabelAlignment(a){const{position:d,ticks:{crossAlign:m,mirror:x,padding:T}}=this.options,E=this._getLabelSizes(),P=a+T,s=E.widest.width;let B,q;return d==="left"?x?(q=this.right+T,m==="near"?B="left":m==="center"?(B="center",q+=s/2):(B="right",q+=s)):(q=this.right-P,m==="near"?B="right":m==="center"?(B="center",q-=s/2):(B="left",q=this.left)):d==="right"?x?(q=this.left+T,m==="near"?B="right":m==="center"?(B="center",q-=s/2):(B="left",q-=s)):(q=this.left+P,m==="near"?B="left":m==="center"?(B="center",q+=s/2):(B="right",q=this.right)):B="right",{textAlign:B,x:q}}_computeLabelArea(){if(this.options.ticks.mirror)return;const a=this.chart,d=this.options.position;if(d==="left"||d==="right")return{top:0,left:this.left,bottom:a.height,right:this.right};if(d==="top"||d==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:a.width}}drawBackground(){const{ctx:a,options:{backgroundColor:d},left:m,top:x,width:T,height:E}=this;d&&(a.save(),a.fillStyle=d,a.fillRect(m,x,T,E),a.restore())}getLineWidthForValue(a){const d=this.options.grid;if(!this._isVisible()||!d.display)return 0;const x=this.ticks.findIndex(T=>T.value===a);return x>=0?d.setContext(this.getContext(x)).lineWidth:0}drawGrid(a){const d=this.options.grid,m=this.ctx,x=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(a));let T,E;const P=(s,B,q)=>{!q.width||!q.color||(m.save(),m.lineWidth=q.width,m.strokeStyle=q.color,m.setLineDash(q.borderDash||[]),m.lineDashOffset=q.borderDashOffset,m.beginPath(),m.moveTo(s.x,s.y),m.lineTo(B.x,B.y),m.stroke(),m.restore())};if(d.display)for(T=0,E=x.length;T<E;++T){const s=x[T];d.drawOnChartArea&&P({x:s.x1,y:s.y1},{x:s.x2,y:s.y2},s),d.drawTicks&&P({x:s.tx1,y:s.ty1},{x:s.tx2,y:s.ty2},{color:s.tickColor,width:s.tickWidth,borderDash:s.tickBorderDash,borderDashOffset:s.tickBorderDashOffset})}}drawBorder(){const{chart:a,ctx:d,options:{border:m,grid:x}}=this,T=m.setContext(this.getContext()),E=m.display?T.width:0;if(!E)return;const P=x.setContext(this.getContext(0)).lineWidth,s=this._borderValue;let B,q,Z,ae;this.isHorizontal()?(B=Tc(a,this.left,E)-E/2,q=Tc(a,this.right,P)+P/2,Z=ae=s):(Z=Tc(a,this.top,E)-E/2,ae=Tc(a,this.bottom,P)+P/2,B=q=s),d.save(),d.lineWidth=T.width,d.strokeStyle=T.color,d.beginPath(),d.moveTo(B,Z),d.lineTo(q,ae),d.stroke(),d.restore()}drawLabels(a){if(!this.options.ticks.display)return;const m=this.ctx,x=this._computeLabelArea();x&&AS(m,x);const T=this.getLabelItems(a);for(const E of T){const P=E.options,s=E.font,B=E.label,q=E.textOffset;kf(m,B,0,q,s,P)}x&&IS(m)}drawTitle(){const{ctx:a,options:{position:d,title:m,reverse:x}}=this;if(!m.display)return;const T=ts(m.font),E=ks(m.padding),P=m.align;let s=T.lineHeight/2;d==="bottom"||d==="center"||fn(d)?(s+=E.bottom,Yn(m.text)&&(s+=T.lineHeight*(m.text.length-1))):s+=E.top;const{titleX:B,titleY:q,maxWidth:Z,rotation:ae}=ek(this,s,d,P);kf(a,m.text,0,0,T,{color:m.color,maxWidth:Z,rotation:ae,textAlign:Qz(P,d,x),textBaseline:"middle",translation:[B,q]})}draw(a){this._isVisible()&&(this.drawBackground(),this.drawGrid(a),this.drawBorder(),this.drawTitle(),this.drawLabels(a))}_layers(){const a=this.options,d=a.ticks&&a.ticks.z||0,m=Hn(a.grid&&a.grid.z,-1),x=Hn(a.border&&a.border.z,0);return!this._isVisible()||this.draw!==Vc.prototype.draw?[{z:d,draw:T=>{this.draw(T)}}]:[{z:m,draw:T=>{this.drawBackground(),this.drawGrid(T),this.drawTitle()}},{z:x,draw:()=>{this.drawBorder()}},{z:d,draw:T=>{this.drawLabels(T)}}]}getMatchingVisibleMetas(a){const d=this.chart.getSortedVisibleDatasetMetas(),m=this.axis+"AxisID",x=[];let T,E;for(T=0,E=d.length;T<E;++T){const P=d[T];P[m]===this.id&&(!a||P.type===a)&&x.push(P)}return x}_resolveTickFontOptions(a){const d=this.options.ticks.setContext(this.getContext(a));return ts(d.font)}_maxDigits(){const a=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/a}}class Ym{constructor(a,d,m){this.type=a,this.scope=d,this.override=m,this.items=Object.create(null)}isForType(a){return Object.prototype.isPrototypeOf.call(this.type.prototype,a.prototype)}register(a){const d=Object.getPrototypeOf(a);let m;nk(d)&&(m=this.register(d));const x=this.items,T=a.id,E=this.scope+"."+T;if(!T)throw new Error("class does not have id: "+a);return T in x||(x[T]=a,tk(a,E,m),this.override&&ur.override(a.id,a.overrides)),E}get(a){return this.items[a]}unregister(a){const d=this.items,m=a.id,x=this.scope;m in d&&delete d[m],x&&m in ur[x]&&(delete ur[x][m],this.override&&delete Oc[m])}}function tk(c,a,d){const m=Rf(Object.create(null),[d?ur.get(d):{},ur.get(a),c.defaults]);ur.set(a,m),c.defaultRoutes&&ik(a,c.defaultRoutes),c.descriptors&&ur.describe(a,c.descriptors)}function ik(c,a){Object.keys(a).forEach(d=>{const m=d.split("."),x=m.pop(),T=[c].concat(m).join("."),E=a[d].split("."),P=E.pop(),s=E.join(".");ur.route(T,x,s,P)})}function nk(c){return"id"in c&&"defaults"in c}class rk{constructor(){this.controllers=new Ym(Rc,"datasets",!0),this.elements=new Ym(jf,"elements"),this.plugins=new Ym(Object,"plugins"),this.scales=new Ym(Vc,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...a){this._each("register",a)}remove(...a){this._each("unregister",a)}addControllers(...a){this._each("register",a,this.controllers)}addElements(...a){this._each("register",a,this.elements)}addPlugins(...a){this._each("register",a,this.plugins)}addScales(...a){this._each("register",a,this.scales)}getController(a){return this._get(a,this.controllers,"controller")}getElement(a){return this._get(a,this.elements,"element")}getPlugin(a){return this._get(a,this.plugins,"plugin")}getScale(a){return this._get(a,this.scales,"scale")}removeControllers(...a){this._each("unregister",a,this.controllers)}removeElements(...a){this._each("unregister",a,this.elements)}removePlugins(...a){this._each("unregister",a,this.plugins)}removeScales(...a){this._each("unregister",a,this.scales)}_each(a,d,m){[...d].forEach(x=>{const T=m||this._getRegistryForType(x);m||T.isForType(x)||T===this.plugins&&x.id?this._exec(a,T,x):In(x,E=>{const P=m||this._getRegistryForType(E);this._exec(a,P,E)})})}_exec(a,d,m){const x=J0(a);ir(m["before"+x],[],m),d[a](m),ir(m["after"+x],[],m)}_getRegistryForType(a){for(let d=0;d<this._typedRegistries.length;d++){const m=this._typedRegistries[d];if(m.isForType(a))return m}return this.plugins}_get(a,d,m){const x=d.get(a);if(x===void 0)throw new Error('"'+a+'" is not a registered '+m+".");return x}}var Vo=new rk;class sk{constructor(){this._init=[]}notify(a,d,m,x){d==="beforeInit"&&(this._init=this._createDescriptors(a,!0),this._notify(this._init,a,"install"));const T=x?this._descriptors(a).filter(x):this._descriptors(a),E=this._notify(T,a,d,m);return d==="afterDestroy"&&(this._notify(T,a,"stop"),this._notify(this._init,a,"uninstall")),E}_notify(a,d,m,x){x=x||{};for(const T of a){const E=T.plugin,P=E[m],s=[d,x,T.options];if(ir(P,s,E)===!1&&x.cancelable)return!1}return!0}invalidate(){Dn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(a){if(this._cache)return this._cache;const d=this._cache=this._createDescriptors(a);return this._notifyStateChanges(a),d}_createDescriptors(a,d){const m=a&&a.config,x=Hn(m.options&&m.options.plugins,{}),T=ok(m);return x===!1&&!d?[]:lk(a,T,x,d)}_notifyStateChanges(a){const d=this._oldCache||[],m=this._cache,x=(T,E)=>T.filter(P=>!E.some(s=>P.plugin.id===s.plugin.id));this._notify(x(d,m),a,"stop"),this._notify(x(m,d),a,"start")}}function ok(c){const a={},d=[],m=Object.keys(Vo.plugins.items);for(let T=0;T<m.length;T++)d.push(Vo.getPlugin(m[T]));const x=c.plugins||[];for(let T=0;T<x.length;T++){const E=x[T];d.indexOf(E)===-1&&(d.push(E),a[E.id]=!0)}return{plugins:d,localIds:a}}function ak(c,a){return!a&&c===!1?null:c===!0?{}:c}function lk(c,{plugins:a,localIds:d},m,x){const T=[],E=c.getContext();for(const P of a){const s=P.id,B=ak(m[s],x);B!==null&&T.push({plugin:P,options:ck(c.config,{plugin:P,local:d[s]},B,E)})}return T}function ck(c,{plugin:a,local:d},m,x){const T=c.pluginScopeKeys(a),E=c.getOptionScopes(m,T);return d&&a.defaults&&E.push(a.defaults),c.createResolver(E,x,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function b0(c,a){const d=ur.datasets[c]||{};return((a.datasets||{})[c]||{}).indexAxis||a.indexAxis||d.indexAxis||"x"}function uk(c,a){let d=c;return c==="_index_"?d=a:c==="_value_"&&(d=a==="x"?"y":"x"),d}function hk(c,a){return c===a?"_index_":"_value_"}function RT(c){if(c==="x"||c==="y"||c==="r")return c}function dk(c){if(c==="top"||c==="bottom")return"x";if(c==="left"||c==="right")return"y"}function w0(c,...a){if(RT(c))return c;for(const d of a){const m=d.axis||dk(d.position)||c.length>1&&RT(c[0].toLowerCase());if(m)return m}throw new Error(`Cannot determine type of '${c}' axis. Please provide 'axis' or 'position' option.`)}function zT(c,a,d){if(d[a+"AxisID"]===c)return{axis:a}}function fk(c,a){if(a.data&&a.data.datasets){const d=a.data.datasets.filter(m=>m.xAxisID===c||m.yAxisID===c);if(d.length)return zT(c,"x",d[0])||zT(c,"y",d[0])}return{}}function pk(c,a){const d=Oc[c.type]||{scales:{}},m=a.scales||{},x=b0(c.type,a),T=Object.create(null);return Object.keys(m).forEach(E=>{const P=m[E];if(!fn(P))return console.error(`Invalid scale configuration for scale: ${E}`);if(P._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${E}`);const s=w0(E,P,fk(E,c),ur.scales[P.type]),B=hk(s,x),q=d.scales||{};T[E]=Tf(Object.create(null),[{axis:s},P,q[s],q[B]])}),c.data.datasets.forEach(E=>{const P=E.type||c.type,s=E.indexAxis||b0(P,a),q=(Oc[P]||{}).scales||{};Object.keys(q).forEach(Z=>{const ae=uk(Z,s),ue=E[ae+"AxisID"]||ae;T[ue]=T[ue]||Object.create(null),Tf(T[ue],[{axis:ae},m[ue],q[Z]])})}),Object.keys(T).forEach(E=>{const P=T[E];Tf(P,[ur.scales[P.type],ur.scale])}),T}function GS(c){const a=c.options||(c.options={});a.plugins=Hn(a.plugins,{}),a.scales=pk(c,a)}function $S(c){return c=c||{},c.datasets=c.datasets||[],c.labels=c.labels||[],c}function mk(c){return c=c||{},c.data=$S(c.data),GS(c),c}const kT=new Map,qS=new Set;function Km(c,a){let d=kT.get(c);return d||(d=a(),kT.set(c,d),qS.add(d)),d}const cf=(c,a,d)=>{const m=vl(a,d);m!==void 0&&c.add(m)};class _k{constructor(a){this._config=mk(a),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(a){this._config.type=a}get data(){return this._config.data}set data(a){this._config.data=$S(a)}get options(){return this._config.options}set options(a){this._config.options=a}get plugins(){return this._config.plugins}update(){const a=this._config;this.clearCache(),GS(a)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(a){return Km(a,()=>[[`datasets.${a}`,""]])}datasetAnimationScopeKeys(a,d){return Km(`${a}.transition.${d}`,()=>[[`datasets.${a}.transitions.${d}`,`transitions.${d}`],[`datasets.${a}`,""]])}datasetElementScopeKeys(a,d){return Km(`${a}-${d}`,()=>[[`datasets.${a}.elements.${d}`,`datasets.${a}`,`elements.${d}`,""]])}pluginScopeKeys(a){const d=a.id,m=this.type;return Km(`${m}-plugin-${d}`,()=>[[`plugins.${d}`,...a.additionalOptionScopes||[]]])}_cachedScopes(a,d){const m=this._scopeCache;let x=m.get(a);return(!x||d)&&(x=new Map,m.set(a,x)),x}getOptionScopes(a,d,m){const{options:x,type:T}=this,E=this._cachedScopes(a,m),P=E.get(d);if(P)return P;const s=new Set;d.forEach(q=>{a&&(s.add(a),q.forEach(Z=>cf(s,a,Z))),q.forEach(Z=>cf(s,x,Z)),q.forEach(Z=>cf(s,Oc[T]||{},Z)),q.forEach(Z=>cf(s,ur,Z)),q.forEach(Z=>cf(s,v0,Z))});const B=Array.from(s);return B.length===0&&B.push(Object.create(null)),qS.has(d)&&E.set(d,B),B}chartOptionScopes(){const{options:a,type:d}=this;return[a,Oc[d]||{},ur.datasets[d]||{},{type:d},ur,v0]}resolveNamedOptions(a,d,m,x=[""]){const T={$shared:!0},{resolver:E,subPrefixes:P}=OT(this._resolverCache,a,x);let s=E;if(yk(E,d)){T.$shared=!1,m=bl(m)?m():m;const B=this.createResolver(a,m,P);s=Qu(E,m,B)}for(const B of d)T[B]=s[B];return T}createResolver(a,d,m=[""],x){const{resolver:T}=OT(this._resolverCache,a,m);return fn(d)?Qu(T,d,void 0,x):T}}function OT(c,a,d){let m=c.get(a);m||(m=new Map,c.set(a,m));const x=d.join();let T=m.get(x);return T||(T={resolver:tx(a,d),subPrefixes:d.filter(P=>!P.toLowerCase().includes("hover"))},m.set(x,T)),T}const gk=c=>fn(c)&&Object.getOwnPropertyNames(c).some(a=>bl(c[a]));function yk(c,a){const{isScriptable:d,isIndexable:m}=DS(c);for(const x of a){const T=d(x),E=m(x),P=(E||T)&&c[x];if(T&&(bl(P)||gk(P))||E&&Yn(P))return!0}return!1}var xk="4.4.2";const vk=["top","bottom","left","right","chartArea"];function FT(c,a){return c==="top"||c==="bottom"||vk.indexOf(c)===-1&&a==="x"}function BT(c,a){return function(d,m){return d[c]===m[c]?d[a]-m[a]:d[c]-m[c]}}function NT(c){const a=c.chart,d=a.options.animation;a.notifyPlugins("afterRender"),ir(d&&d.onComplete,[c],a)}function bk(c){const a=c.chart,d=a.options.animation;ir(d&&d.onProgress,[c],a)}function HS(c){return rx()&&typeof c=="string"?c=document.getElementById(c):c&&c.length&&(c=c[0]),c&&c.canvas&&(c=c.canvas),c}const d_={},VT=c=>{const a=HS(c);return Object.values(d_).filter(d=>d.canvas===a).pop()};function wk(c,a,d){const m=Object.keys(c);for(const x of m){const T=+x;if(T>=a){const E=c[x];delete c[x],(d>0||T>a)&&(c[T+d]=E)}}}function Tk(c,a,d,m){return!d||c.type==="mouseout"?null:m?a:c}function Jm(c,a,d){return c.options.clip?c[d]:a[d]}function Mk(c,a){const{xScale:d,yScale:m}=c;return d&&m?{left:Jm(d,a,"left"),right:Jm(d,a,"right"),top:Jm(m,a,"top"),bottom:Jm(m,a,"bottom")}:a}var ll;let G_=(ll=class{static register(...a){Vo.add(...a),UT()}static unregister(...a){Vo.remove(...a),UT()}constructor(a,d){const m=this.config=new _k(d),x=HS(a),T=VT(x);if(T)throw new Error("Canvas is already in use. Chart with ID '"+T.id+"' must be destroyed before the canvas with ID '"+T.canvas.id+"' can be reused.");const E=m.createResolver(m.chartOptionScopes(),this.getContext());this.platform=new(m.platform||Uz(x)),this.platform.updateConfig(m);const P=this.platform.acquireContext(x,E.aspectRatio),s=P&&P.canvas,B=s&&s.height,q=s&&s.width;if(this.id=UL(),this.ctx=P,this.canvas=s,this.width=q,this.height=B,this._options=E,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new sk,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=nR(Z=>this.update(Z),E.resizeDelay||0),this._dataChanges=[],d_[this.id]=this,!P||!s){console.error("Failed to create chart: can't acquire context from the given item");return}_a.listen(this,"complete",NT),_a.listen(this,"progress",bk),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:a,maintainAspectRatio:d},width:m,height:x,_aspectRatio:T}=this;return Dn(a)?d&&T?T:x?m/x:null:a}get data(){return this.config.data}set data(a){this.config.data=a}get options(){return this._options}set options(a){this.config.options=a}get registry(){return Vo}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():hT(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return aT(this.canvas,this.ctx),this}stop(){return _a.stop(this),this}resize(a,d){_a.running(this)?this._resizeBeforeDraw={width:a,height:d}:this._resize(a,d)}_resize(a,d){const m=this.options,x=this.canvas,T=m.maintainAspectRatio&&this.aspectRatio,E=this.platform.getMaximumSize(x,a,d,T),P=m.devicePixelRatio||this.platform.getDevicePixelRatio(),s=this.width?"resize":"attach";this.width=E.width,this.height=E.height,this._aspectRatio=this.aspectRatio,hT(this,P,!0)&&(this.notifyPlugins("resize",{size:E}),ir(m.onResize,[this,E],this),this.attached&&this._doResize(s)&&this.render())}ensureScalesHaveIDs(){const d=this.options.scales||{};In(d,(m,x)=>{m.id=x})}buildOrUpdateScales(){const a=this.options,d=a.scales,m=this.scales,x=Object.keys(m).reduce((E,P)=>(E[P]=!1,E),{});let T=[];d&&(T=T.concat(Object.keys(d).map(E=>{const P=d[E],s=w0(E,P),B=s==="r",q=s==="x";return{options:P,dposition:B?"chartArea":q?"bottom":"left",dtype:B?"radialLinear":q?"category":"linear"}}))),In(T,E=>{const P=E.options,s=P.id,B=w0(s,P),q=Hn(P.type,E.dtype);(P.position===void 0||FT(P.position,B)!==FT(E.dposition))&&(P.position=E.dposition),x[s]=!0;let Z=null;if(s in m&&m[s].type===q)Z=m[s];else{const ae=Vo.getScale(q);Z=new ae({id:s,type:q,ctx:this.ctx,chart:this}),m[Z.id]=Z}Z.init(P,a)}),In(x,(E,P)=>{E||delete m[P]}),In(m,E=>{pl.configure(this,E,E.options),pl.addBox(this,E)})}_updateMetasets(){const a=this._metasets,d=this.data.datasets.length,m=a.length;if(a.sort((x,T)=>x.index-T.index),m>d){for(let x=d;x<m;++x)this._destroyDatasetMeta(x);a.splice(d,m-d)}this._sortedMetasets=a.slice(0).sort(BT("order","index"))}_removeUnreferencedMetasets(){const{_metasets:a,data:{datasets:d}}=this;a.length>d.length&&delete this._stacks,a.forEach((m,x)=>{d.filter(T=>T===m._dataset).length===0&&this._destroyDatasetMeta(x)})}buildOrUpdateControllers(){const a=[],d=this.data.datasets;let m,x;for(this._removeUnreferencedMetasets(),m=0,x=d.length;m<x;m++){const T=d[m];let E=this.getDatasetMeta(m);const P=T.type||this.config.type;if(E.type&&E.type!==P&&(this._destroyDatasetMeta(m),E=this.getDatasetMeta(m)),E.type=P,E.indexAxis=T.indexAxis||b0(P,this.options),E.order=T.order||0,E.index=m,E.label=""+T.label,E.visible=this.isDatasetVisible(m),E.controller)E.controller.updateIndex(m),E.controller.linkScales();else{const s=Vo.getController(P),{datasetElementType:B,dataElementType:q}=ur.datasets[P];Object.assign(s,{dataElementType:Vo.getElement(q),datasetElementType:B&&Vo.getElement(B)}),E.controller=new s(this,m),a.push(E.controller)}}return this._updateMetasets(),a}_resetElements(){In(this.data.datasets,(a,d)=>{this.getDatasetMeta(d).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(a){const d=this.config;d.update();const m=this._options=d.createResolver(d.chartOptionScopes(),this.getContext()),x=this._animationsDisabled=!m.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:a,cancelable:!0})===!1)return;const T=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let E=0;for(let B=0,q=this.data.datasets.length;B<q;B++){const{controller:Z}=this.getDatasetMeta(B),ae=!x&&T.indexOf(Z)===-1;Z.buildOrUpdateElements(ae),E=Math.max(+Z.getMaxOverflow(),E)}E=this._minPadding=m.layout.autoPadding?E:0,this._updateLayout(E),x||In(T,B=>{B.reset()}),this._updateDatasets(a),this.notifyPlugins("afterUpdate",{mode:a}),this._layers.sort(BT("z","_idx"));const{_active:P,_lastEvent:s}=this;s?this._eventHandler(s,!0):P.length&&this._updateHoverStyles(P,P,!0),this.render()}_updateScales(){In(this.scales,a=>{pl.removeBox(this,a)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const a=this.options,d=new Set(Object.keys(this._listeners)),m=new Set(a.events);(!Kw(d,m)||!!this._responsiveListeners!==a.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:a}=this,d=this._getUniformDataChanges()||[];for(const{method:m,start:x,count:T}of d){const E=m==="_removeElements"?-T:T;wk(a,x,E)}}_getUniformDataChanges(){const a=this._dataChanges;if(!a||!a.length)return;this._dataChanges=[];const d=this.data.datasets.length,m=T=>new Set(a.filter(E=>E[0]===T).map((E,P)=>P+","+E.splice(1).join(","))),x=m(0);for(let T=1;T<d;T++)if(!Kw(x,m(T)))return;return Array.from(x).map(T=>T.split(",")).map(T=>({method:T[1],start:+T[2],count:+T[3]}))}_updateLayout(a){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;pl.update(this,this.width,this.height,a);const d=this.chartArea,m=d.width<=0||d.height<=0;this._layers=[],In(this.boxes,x=>{m&&x.position==="chartArea"||(x.configure&&x.configure(),this._layers.push(...x._layers()))},this),this._layers.forEach((x,T)=>{x._idx=T}),this.notifyPlugins("afterLayout")}_updateDatasets(a){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:a,cancelable:!0})!==!1){for(let d=0,m=this.data.datasets.length;d<m;++d)this.getDatasetMeta(d).controller.configure();for(let d=0,m=this.data.datasets.length;d<m;++d)this._updateDataset(d,bl(a)?a({datasetIndex:d}):a);this.notifyPlugins("afterDatasetsUpdate",{mode:a})}}_updateDataset(a,d){const m=this.getDatasetMeta(a),x={meta:m,index:a,mode:d,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",x)!==!1&&(m.controller._update(d),x.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",x))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(_a.has(this)?this.attached&&!_a.running(this)&&_a.start(this):(this.draw(),NT({chart:this})))}draw(){let a;if(this._resizeBeforeDraw){const{width:m,height:x}=this._resizeBeforeDraw;this._resize(m,x),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const d=this._layers;for(a=0;a<d.length&&d[a].z<=0;++a)d[a].draw(this.chartArea);for(this._drawDatasets();a<d.length;++a)d[a].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(a){const d=this._sortedMetasets,m=[];let x,T;for(x=0,T=d.length;x<T;++x){const E=d[x];(!a||E.visible)&&m.push(E)}return m}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const a=this.getSortedVisibleDatasetMetas();for(let d=a.length-1;d>=0;--d)this._drawDataset(a[d]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(a){const d=this.ctx,m=a._clip,x=!m.disabled,T=Mk(a,this.chartArea),E={meta:a,index:a.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",E)!==!1&&(x&&AS(d,{left:m.left===!1?0:T.left-m.left,right:m.right===!1?this.width:T.right+m.right,top:m.top===!1?0:T.top-m.top,bottom:m.bottom===!1?this.height:T.bottom+m.bottom}),a.controller.draw(),x&&IS(d),E.cancelable=!1,this.notifyPlugins("afterDatasetDraw",E))}isPointInArea(a){return Hu(a,this.chartArea,this._minPadding)}getElementsAtEventForMode(a,d,m,x){const T=vz.modes[d];return typeof T=="function"?T(this,a,m,x):[]}getDatasetMeta(a){const d=this.data.datasets[a],m=this._metasets;let x=m.filter(T=>T&&T._dataset===d).pop();return x||(x={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:d&&d.order||0,index:a,_dataset:d,_parsed:[],_sorted:!1},m.push(x)),x}getContext(){return this.$context||(this.$context=Nc(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(a){const d=this.data.datasets[a];if(!d)return!1;const m=this.getDatasetMeta(a);return typeof m.hidden=="boolean"?!m.hidden:!d.hidden}setDatasetVisibility(a,d){const m=this.getDatasetMeta(a);m.hidden=!d}toggleDataVisibility(a){this._hiddenIndices[a]=!this._hiddenIndices[a]}getDataVisibility(a){return!this._hiddenIndices[a]}_updateVisibility(a,d,m){const x=m?"show":"hide",T=this.getDatasetMeta(a),E=T.controller._resolveAnimations(void 0,x);zf(d)?(T.data[d].hidden=!m,this.update()):(this.setDatasetVisibility(a,m),E.update(T,{visible:m}),this.update(P=>P.datasetIndex===a?x:void 0))}hide(a,d){this._updateVisibility(a,d,!1)}show(a,d){this._updateVisibility(a,d,!0)}_destroyDatasetMeta(a){const d=this._metasets[a];d&&d.controller&&d.controller._destroy(),delete this._metasets[a]}_stop(){let a,d;for(this.stop(),_a.remove(this),a=0,d=this.data.datasets.length;a<d;++a)this._destroyDatasetMeta(a)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:a,ctx:d}=this;this._stop(),this.config.clearCache(),a&&(this.unbindEvents(),aT(a,d),this.platform.releaseContext(d),this.canvas=null,this.ctx=null),delete d_[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...a){return this.canvas.toDataURL(...a)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const a=this._listeners,d=this.platform,m=(T,E)=>{d.addEventListener(this,T,E),a[T]=E},x=(T,E,P)=>{T.offsetX=E,T.offsetY=P,this._eventHandler(T)};In(this.options.events,T=>m(T,x))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const a=this._responsiveListeners,d=this.platform,m=(s,B)=>{d.addEventListener(this,s,B),a[s]=B},x=(s,B)=>{a[s]&&(d.removeEventListener(this,s,B),delete a[s])},T=(s,B)=>{this.canvas&&this.resize(s,B)};let E;const P=()=>{x("attach",P),this.attached=!0,this.resize(),m("resize",T),m("detach",E)};E=()=>{this.attached=!1,x("resize",T),this._stop(),this._resize(0,0),m("attach",P)},d.isAttached(this.canvas)?P():E()}unbindEvents(){In(this._listeners,(a,d)=>{this.platform.removeEventListener(this,d,a)}),this._listeners={},In(this._responsiveListeners,(a,d)=>{this.platform.removeEventListener(this,d,a)}),this._responsiveListeners=void 0}updateHoverStyle(a,d,m){const x=m?"set":"remove";let T,E,P,s;for(d==="dataset"&&(T=this.getDatasetMeta(a[0].datasetIndex),T.controller["_"+x+"DatasetHoverStyle"]()),P=0,s=a.length;P<s;++P){E=a[P];const B=E&&this.getDatasetMeta(E.datasetIndex).controller;B&&B[x+"HoverStyle"](E.element,E.datasetIndex,E.index)}}getActiveElements(){return this._active||[]}setActiveElements(a){const d=this._active||[],m=a.map(({datasetIndex:T,index:E})=>{const P=this.getDatasetMeta(T);if(!P)throw new Error("No dataset found at index "+T);return{datasetIndex:T,element:P.data[E],index:E}});!x_(m,d)&&(this._active=m,this._lastEvent=null,this._updateHoverStyles(m,d))}notifyPlugins(a,d,m){return this._plugins.notify(this,a,d,m)}isPluginEnabled(a){return this._plugins._cache.filter(d=>d.plugin.id===a).length===1}_updateHoverStyles(a,d,m){const x=this.options.hover,T=(s,B)=>s.filter(q=>!B.some(Z=>q.datasetIndex===Z.datasetIndex&&q.index===Z.index)),E=T(d,a),P=m?a:T(a,d);E.length&&this.updateHoverStyle(E,x.mode,!1),P.length&&x.mode&&this.updateHoverStyle(P,x.mode,!0)}_eventHandler(a,d){const m={event:a,replay:d,cancelable:!0,inChartArea:this.isPointInArea(a)},x=E=>(E.options.events||this.options.events).includes(a.native.type);if(this.notifyPlugins("beforeEvent",m,x)===!1)return;const T=this._handleEvent(a,d,m.inChartArea);return m.cancelable=!1,this.notifyPlugins("afterEvent",m,x),(T||m.changed)&&this.render(),this}_handleEvent(a,d,m){const{_active:x=[],options:T}=this,E=d,P=this._getActiveElements(a,x,m,E),s=WL(a),B=Tk(a,this._lastEvent,m,s);m&&(this._lastEvent=null,ir(T.onHover,[a,P,this],this),s&&ir(T.onClick,[a,P,this],this));const q=!x_(P,x);return(q||d)&&(this._active=P,this._updateHoverStyles(P,x,d)),this._lastEvent=B,q}_getActiveElements(a,d,m,x){if(a.type==="mouseout")return[];if(!m)return d;const T=this.options.hover;return this.getElementsAtEventForMode(a,T.mode,T,x)}},Bi(ll,"defaults",ur),Bi(ll,"instances",d_),Bi(ll,"overrides",Oc),Bi(ll,"registry",Vo),Bi(ll,"version",xk),Bi(ll,"getChart",VT),ll);function UT(){return In(G_.instances,c=>c._plugins.invalidate())}function WS(c,a){const{x:d,y:m,base:x,width:T,height:E}=c.getProps(["x","y","base","width","height"],a);let P,s,B,q,Z;return c.horizontal?(Z=E/2,P=Math.min(d,x),s=Math.max(d,x),B=m-Z,q=m+Z):(Z=T/2,P=d-Z,s=d+Z,B=Math.min(m,x),q=Math.max(m,x)),{left:P,top:B,right:s,bottom:q}}function ml(c,a,d,m){return c?0:ho(a,d,m)}function Sk(c,a,d){const m=c.options.borderWidth,x=c.borderSkipped,T=PS(m);return{t:ml(x.top,T.top,0,d),r:ml(x.right,T.right,0,a),b:ml(x.bottom,T.bottom,0,d),l:ml(x.left,T.left,0,a)}}function Ek(c,a,d){const{enableBorderRadius:m}=c.getProps(["enableBorderRadius"]),x=c.options.borderRadius,T=Ku(x),E=Math.min(a,d),P=c.borderSkipped,s=m||fn(x);return{topLeft:ml(!s||P.top||P.left,T.topLeft,0,E),topRight:ml(!s||P.top||P.right,T.topRight,0,E),bottomLeft:ml(!s||P.bottom||P.left,T.bottomLeft,0,E),bottomRight:ml(!s||P.bottom||P.right,T.bottomRight,0,E)}}function Ak(c){const a=WS(c),d=a.right-a.left,m=a.bottom-a.top,x=Sk(c,d/2,m/2),T=Ek(c,d/2,m/2);return{outer:{x:a.left,y:a.top,w:d,h:m,radius:T},inner:{x:a.left+x.l,y:a.top+x.t,w:d-x.l-x.r,h:m-x.t-x.b,radius:{topLeft:Math.max(0,T.topLeft-Math.max(x.t,x.l)),topRight:Math.max(0,T.topRight-Math.max(x.t,x.r)),bottomLeft:Math.max(0,T.bottomLeft-Math.max(x.b,x.l)),bottomRight:Math.max(0,T.bottomRight-Math.max(x.b,x.r))}}}}function t0(c,a,d,m){const x=a===null,T=d===null,P=c&&!(x&&T)&&WS(c,m);return P&&(x||tT(a,P.left,P.right))&&(T||tT(d,P.top,P.bottom))}function Ik(c){return c.topLeft||c.topRight||c.bottomLeft||c.bottomRight}function Ck(c,a){c.rect(a.x,a.y,a.w,a.h)}function i0(c,a,d={}){const m=c.x!==d.x?-a:0,x=c.y!==d.y?-a:0,T=(c.x+c.w!==d.x+d.w?a:0)-m,E=(c.y+c.h!==d.y+d.h?a:0)-x;return{x:c.x+m,y:c.y+x,w:c.w+T,h:c.h+E,radius:c.radius}}class f_ extends jf{constructor(a){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,a&&Object.assign(this,a)}draw(a){const{inflateAmount:d,options:{borderColor:m,backgroundColor:x}}=this,{inner:T,outer:E}=Ak(this),P=Ik(E.radius)?M_:Ck;a.save(),(E.w!==T.w||E.h!==T.h)&&(a.beginPath(),P(a,i0(E,d,T)),a.clip(),P(a,i0(T,-d,E)),a.fillStyle=m,a.fill("evenodd")),a.beginPath(),P(a,i0(T,d)),a.fillStyle=x,a.fill(),a.restore()}inRange(a,d,m){return t0(this,a,d,m)}inXRange(a,d){return t0(this,a,null,d)}inYRange(a,d){return t0(this,null,a,d)}getCenterPoint(a){const{x:d,y:m,base:x,horizontal:T}=this.getProps(["x","y","base","horizontal"],a);return{x:T?(d+x)/2:d,y:T?m:(m+x)/2}}getRange(a){return a==="x"?this.width/2:this.height/2}}Bi(f_,"id","bar"),Bi(f_,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Bi(f_,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const T0=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],jT=T0.map(c=>c.replace("rgb(","rgba(").replace(")",", 0.5)"));function ZS(c){return T0[c%T0.length]}function XS(c){return jT[c%jT.length]}function Pk(c,a){return c.borderColor=ZS(a),c.backgroundColor=XS(a),++a}function Dk(c,a){return c.backgroundColor=c.data.map(()=>ZS(a++)),a}function Lk(c,a){return c.backgroundColor=c.data.map(()=>XS(a++)),a}function Rk(c){let a=0;return(d,m)=>{const x=c.getDatasetMeta(m).controller;x instanceof pf?a=Dk(d,a):x instanceof u_?a=Lk(d,a):x&&(a=Pk(d,a))}}function GT(c){let a;for(a in c)if(c[a].borderColor||c[a].backgroundColor)return!0;return!1}function zk(c){return c&&(c.borderColor||c.backgroundColor)}var kk={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(c,a,d){if(!d.enabled)return;const{data:{datasets:m},options:x}=c.config,{elements:T}=x;if(!d.forceOverride&&(GT(m)||zk(x)||T&&GT(T)))return;const E=Rk(c);m.forEach(E)}};class YS extends jf{constructor(a){super(),this.chart=a.chart,this.options=a.options,this.ctx=a.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(a,d){const m=this.options;if(this.left=0,this.top=0,!m.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=a,this.height=this.bottom=d;const x=Yn(m.text)?m.text.length:1;this._padding=ks(m.padding);const T=x*ts(m.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=T:this.width=T}isHorizontal(){const a=this.options.position;return a==="top"||a==="bottom"}_drawArgs(a){const{top:d,left:m,bottom:x,right:T,options:E}=this,P=E.align;let s=0,B,q,Z;return this.isHorizontal()?(q=Mf(P,m,T),Z=d+a,B=T-m):(E.position==="left"?(q=m+a,Z=Mf(P,x,d),s=hr*-.5):(q=T-a,Z=Mf(P,d,x),s=hr*.5),B=x-d),{titleX:q,titleY:Z,maxWidth:B,rotation:s}}draw(){const a=this.ctx,d=this.options;if(!d.display)return;const m=ts(d.font),T=m.lineHeight/2+this._padding.top,{titleX:E,titleY:P,maxWidth:s,rotation:B}=this._drawArgs(T);kf(a,d.text,0,0,m,{color:d.color,maxWidth:s,rotation:B,textAlign:MS(d.align),textBaseline:"middle",translation:[E,P]})}}function Ok(c,a){const d=new YS({ctx:c.ctx,options:a,chart:c});pl.configure(c,d,a),pl.addBox(c,d),c.titleBlock=d}var Fk={id:"title",_element:YS,start(c,a,d){Ok(c,d)},stop(c){const a=c.titleBlock;pl.removeBox(c,a),delete c.titleBlock},beforeUpdate(c,a,d){const m=c.titleBlock;pl.configure(c,m,d),m.options=d},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const _f={average(c){if(!c.length)return!1;let a,d,m=new Set,x=0,T=0;for(a=0,d=c.length;a<d;++a){const P=c[a].element;if(P&&P.hasValue()){const s=P.tooltipPosition();m.add(s.x),x+=s.y,++T}}return{x:[...m].reduce((P,s)=>P+s)/m.size,y:x/T}},nearest(c,a){if(!c.length)return!1;let d=a.x,m=a.y,x=Number.POSITIVE_INFINITY,T,E,P;for(T=0,E=c.length;T<E;++T){const s=c[T].element;if(s&&s.hasValue()){const B=s.getCenterPoint(),q=JL(a,B);q<x&&(x=q,P=s)}}if(P){const s=P.tooltipPosition();d=s.x,m=s.y}return{x:d,y:m}}};function No(c,a){return a&&(Yn(a)?Array.prototype.push.apply(c,a):c.push(a)),c}function ga(c){return(typeof c=="string"||c instanceof String)&&c.indexOf(`
`)>-1?c.split(`
`):c}function Bk(c,a){const{element:d,datasetIndex:m,index:x}=a,T=c.getDatasetMeta(m).controller,{label:E,value:P}=T.getLabelAndValue(x);return{chart:c,label:E,parsed:T.getParsed(x),raw:c.data.datasets[m].data[x],formattedValue:P,dataset:T.getDataset(),dataIndex:x,datasetIndex:m,element:d}}function $T(c,a){const d=c.chart.ctx,{body:m,footer:x,title:T}=c,{boxWidth:E,boxHeight:P}=a,s=ts(a.bodyFont),B=ts(a.titleFont),q=ts(a.footerFont),Z=T.length,ae=x.length,ue=m.length,Le=ks(a.padding);let Ae=Le.height,Oe=0,We=m.reduce((Lt,Rt)=>Lt+Rt.before.length+Rt.lines.length+Rt.after.length,0);if(We+=c.beforeBody.length+c.afterBody.length,Z&&(Ae+=Z*B.lineHeight+(Z-1)*a.titleSpacing+a.titleMarginBottom),We){const Lt=a.displayColors?Math.max(P,s.lineHeight):s.lineHeight;Ae+=ue*Lt+(We-ue)*s.lineHeight+(We-1)*a.bodySpacing}ae&&(Ae+=a.footerMarginTop+ae*q.lineHeight+(ae-1)*a.footerSpacing);let ct=0;const gt=function(Lt){Oe=Math.max(Oe,d.measureText(Lt).width+ct)};return d.save(),d.font=B.string,In(c.title,gt),d.font=s.string,In(c.beforeBody.concat(c.afterBody),gt),ct=a.displayColors?E+2+a.boxPadding:0,In(m,Lt=>{In(Lt.before,gt),In(Lt.lines,gt),In(Lt.after,gt)}),ct=0,d.font=q.string,In(c.footer,gt),d.restore(),Oe+=Le.width,{width:Oe,height:Ae}}function Nk(c,a){const{y:d,height:m}=a;return d<m/2?"top":d>c.height-m/2?"bottom":"center"}function Vk(c,a,d,m){const{x,width:T}=m,E=d.caretSize+d.caretPadding;if(c==="left"&&x+T+E>a.width||c==="right"&&x-T-E<0)return!0}function Uk(c,a,d,m){const{x,width:T}=d,{width:E,chartArea:{left:P,right:s}}=c;let B="center";return m==="center"?B=x<=(P+s)/2?"left":"right":x<=T/2?B="left":x>=E-T/2&&(B="right"),Vk(B,c,a,d)&&(B="center"),B}function qT(c,a,d){const m=d.yAlign||a.yAlign||Nk(c,d);return{xAlign:d.xAlign||a.xAlign||Uk(c,a,d,m),yAlign:m}}function jk(c,a){let{x:d,width:m}=c;return a==="right"?d-=m:a==="center"&&(d-=m/2),d}function Gk(c,a,d){let{y:m,height:x}=c;return a==="top"?m+=d:a==="bottom"?m-=x+d:m-=x/2,m}function HT(c,a,d,m){const{caretSize:x,caretPadding:T,cornerRadius:E}=c,{xAlign:P,yAlign:s}=d,B=x+T,{topLeft:q,topRight:Z,bottomLeft:ae,bottomRight:ue}=Ku(E);let Le=jk(a,P);const Ae=Gk(a,s,B);return s==="center"?P==="left"?Le+=B:P==="right"&&(Le-=B):P==="left"?Le-=Math.max(q,ae)+x:P==="right"&&(Le+=Math.max(Z,ue)+x),{x:ho(Le,0,m.width-a.width),y:ho(Ae,0,m.height-a.height)}}function Qm(c,a,d){const m=ks(d.padding);return a==="center"?c.x+c.width/2:a==="right"?c.x+c.width-m.right:c.x+m.left}function WT(c){return No([],ga(c))}function $k(c,a,d){return Nc(c,{tooltip:a,tooltipItems:d,type:"tooltip"})}function ZT(c,a){const d=a&&a.dataset&&a.dataset.tooltip&&a.dataset.tooltip.callbacks;return d?c.override(d):c}const KS={beforeTitle:ma,title(c){if(c.length>0){const a=c[0],d=a.chart.data.labels,m=d?d.length:0;if(this&&this.options&&this.options.mode==="dataset")return a.dataset.label||"";if(a.label)return a.label;if(m>0&&a.dataIndex<m)return d[a.dataIndex]}return""},afterTitle:ma,beforeBody:ma,beforeLabel:ma,label(c){if(this&&this.options&&this.options.mode==="dataset")return c.label+": "+c.formattedValue||c.formattedValue;let a=c.dataset.label||"";a&&(a+=": ");const d=c.formattedValue;return Dn(d)||(a+=d),a},labelColor(c){const d=c.chart.getDatasetMeta(c.datasetIndex).controller.getStyle(c.dataIndex);return{borderColor:d.borderColor,backgroundColor:d.backgroundColor,borderWidth:d.borderWidth,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(c){const d=c.chart.getDatasetMeta(c.datasetIndex).controller.getStyle(c.dataIndex);return{pointStyle:d.pointStyle,rotation:d.rotation}},afterLabel:ma,afterBody:ma,beforeFooter:ma,footer:ma,afterFooter:ma};function ds(c,a,d,m){const x=c[a].call(d,m);return typeof x>"u"?KS[a].call(d,m):x}class M0 extends jf{constructor(a){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=a.chart,this.options=a.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(a){this.options=a,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const a=this._cachedAnimations;if(a)return a;const d=this.chart,m=this.options.setContext(this.getContext()),x=m.enabled&&d.options.animation&&m.animations,T=new kS(this.chart,x);return x._cacheable&&(this._cachedAnimations=Object.freeze(T)),T}getContext(){return this.$context||(this.$context=$k(this.chart.getContext(),this,this._tooltipItems))}getTitle(a,d){const{callbacks:m}=d,x=ds(m,"beforeTitle",this,a),T=ds(m,"title",this,a),E=ds(m,"afterTitle",this,a);let P=[];return P=No(P,ga(x)),P=No(P,ga(T)),P=No(P,ga(E)),P}getBeforeBody(a,d){return WT(ds(d.callbacks,"beforeBody",this,a))}getBody(a,d){const{callbacks:m}=d,x=[];return In(a,T=>{const E={before:[],lines:[],after:[]},P=ZT(m,T);No(E.before,ga(ds(P,"beforeLabel",this,T))),No(E.lines,ds(P,"label",this,T)),No(E.after,ga(ds(P,"afterLabel",this,T))),x.push(E)}),x}getAfterBody(a,d){return WT(ds(d.callbacks,"afterBody",this,a))}getFooter(a,d){const{callbacks:m}=d,x=ds(m,"beforeFooter",this,a),T=ds(m,"footer",this,a),E=ds(m,"afterFooter",this,a);let P=[];return P=No(P,ga(x)),P=No(P,ga(T)),P=No(P,ga(E)),P}_createItems(a){const d=this._active,m=this.chart.data,x=[],T=[],E=[];let P=[],s,B;for(s=0,B=d.length;s<B;++s)P.push(Bk(this.chart,d[s]));return a.filter&&(P=P.filter((q,Z,ae)=>a.filter(q,Z,ae,m))),a.itemSort&&(P=P.sort((q,Z)=>a.itemSort(q,Z,m))),In(P,q=>{const Z=ZT(a.callbacks,q);x.push(ds(Z,"labelColor",this,q)),T.push(ds(Z,"labelPointStyle",this,q)),E.push(ds(Z,"labelTextColor",this,q))}),this.labelColors=x,this.labelPointStyles=T,this.labelTextColors=E,this.dataPoints=P,P}update(a,d){const m=this.options.setContext(this.getContext()),x=this._active;let T,E=[];if(!x.length)this.opacity!==0&&(T={opacity:0});else{const P=_f[m.position].call(this,x,this._eventPosition);E=this._createItems(m),this.title=this.getTitle(E,m),this.beforeBody=this.getBeforeBody(E,m),this.body=this.getBody(E,m),this.afterBody=this.getAfterBody(E,m),this.footer=this.getFooter(E,m);const s=this._size=$T(this,m),B=Object.assign({},P,s),q=qT(this.chart,m,B),Z=HT(m,B,q,this.chart);this.xAlign=q.xAlign,this.yAlign=q.yAlign,T={opacity:1,x:Z.x,y:Z.y,width:s.width,height:s.height,caretX:P.x,caretY:P.y}}this._tooltipItems=E,this.$context=void 0,T&&this._resolveAnimations().update(this,T),a&&m.external&&m.external.call(this,{chart:this.chart,tooltip:this,replay:d})}drawCaret(a,d,m,x){const T=this.getCaretPosition(a,m,x);d.lineTo(T.x1,T.y1),d.lineTo(T.x2,T.y2),d.lineTo(T.x3,T.y3)}getCaretPosition(a,d,m){const{xAlign:x,yAlign:T}=this,{caretSize:E,cornerRadius:P}=m,{topLeft:s,topRight:B,bottomLeft:q,bottomRight:Z}=Ku(P),{x:ae,y:ue}=a,{width:Le,height:Ae}=d;let Oe,We,ct,gt,Lt,Rt;return T==="center"?(Lt=ue+Ae/2,x==="left"?(Oe=ae,We=Oe-E,gt=Lt+E,Rt=Lt-E):(Oe=ae+Le,We=Oe+E,gt=Lt-E,Rt=Lt+E),ct=Oe):(x==="left"?We=ae+Math.max(s,q)+E:x==="right"?We=ae+Le-Math.max(B,Z)-E:We=this.caretX,T==="top"?(gt=ue,Lt=gt-E,Oe=We-E,ct=We+E):(gt=ue+Ae,Lt=gt+E,Oe=We+E,ct=We-E),Rt=gt),{x1:Oe,x2:We,x3:ct,y1:gt,y2:Lt,y3:Rt}}drawTitle(a,d,m){const x=this.title,T=x.length;let E,P,s;if(T){const B=Zy(m.rtl,this.x,this.width);for(a.x=Qm(this,m.titleAlign,m),d.textAlign=B.textAlign(m.titleAlign),d.textBaseline="middle",E=ts(m.titleFont),P=m.titleSpacing,d.fillStyle=m.titleColor,d.font=E.string,s=0;s<T;++s)d.fillText(x[s],B.x(a.x),a.y+E.lineHeight/2),a.y+=E.lineHeight+P,s+1===T&&(a.y+=m.titleMarginBottom-P)}}_drawColorBox(a,d,m,x,T){const E=this.labelColors[m],P=this.labelPointStyles[m],{boxHeight:s,boxWidth:B}=T,q=ts(T.bodyFont),Z=Qm(this,"left",T),ae=x.x(Z),ue=s<q.lineHeight?(q.lineHeight-s)/2:0,Le=d.y+ue;if(T.usePointStyle){const Ae={radius:Math.min(B,s)/2,pointStyle:P.pointStyle,rotation:P.rotation,borderWidth:1},Oe=x.leftForLtr(ae,B)+B/2,We=Le+s/2;a.strokeStyle=T.multiKeyBackground,a.fillStyle=T.multiKeyBackground,lT(a,Ae,Oe,We),a.strokeStyle=E.borderColor,a.fillStyle=E.backgroundColor,lT(a,Ae,Oe,We)}else{a.lineWidth=fn(E.borderWidth)?Math.max(...Object.values(E.borderWidth)):E.borderWidth||1,a.strokeStyle=E.borderColor,a.setLineDash(E.borderDash||[]),a.lineDashOffset=E.borderDashOffset||0;const Ae=x.leftForLtr(ae,B),Oe=x.leftForLtr(x.xPlus(ae,1),B-2),We=Ku(E.borderRadius);Object.values(We).some(ct=>ct!==0)?(a.beginPath(),a.fillStyle=T.multiKeyBackground,M_(a,{x:Ae,y:Le,w:B,h:s,radius:We}),a.fill(),a.stroke(),a.fillStyle=E.backgroundColor,a.beginPath(),M_(a,{x:Oe,y:Le+1,w:B-2,h:s-2,radius:We}),a.fill()):(a.fillStyle=T.multiKeyBackground,a.fillRect(Ae,Le,B,s),a.strokeRect(Ae,Le,B,s),a.fillStyle=E.backgroundColor,a.fillRect(Oe,Le+1,B-2,s-2))}a.fillStyle=this.labelTextColors[m]}drawBody(a,d,m){const{body:x}=this,{bodySpacing:T,bodyAlign:E,displayColors:P,boxHeight:s,boxWidth:B,boxPadding:q}=m,Z=ts(m.bodyFont);let ae=Z.lineHeight,ue=0;const Le=Zy(m.rtl,this.x,this.width),Ae=function(bi){d.fillText(bi,Le.x(a.x+ue),a.y+ae/2),a.y+=ae+T},Oe=Le.textAlign(E);let We,ct,gt,Lt,Rt,Wt,ui;for(d.textAlign=E,d.textBaseline="middle",d.font=Z.string,a.x=Qm(this,Oe,m),d.fillStyle=m.bodyColor,In(this.beforeBody,Ae),ue=P&&Oe!=="right"?E==="center"?B/2+q:B+2+q:0,Lt=0,Wt=x.length;Lt<Wt;++Lt){for(We=x[Lt],ct=this.labelTextColors[Lt],d.fillStyle=ct,In(We.before,Ae),gt=We.lines,P&&gt.length&&(this._drawColorBox(d,a,Lt,Le,m),ae=Math.max(Z.lineHeight,s)),Rt=0,ui=gt.length;Rt<ui;++Rt)Ae(gt[Rt]),ae=Z.lineHeight;In(We.after,Ae)}ue=0,ae=Z.lineHeight,In(this.afterBody,Ae),a.y-=T}drawFooter(a,d,m){const x=this.footer,T=x.length;let E,P;if(T){const s=Zy(m.rtl,this.x,this.width);for(a.x=Qm(this,m.footerAlign,m),a.y+=m.footerMarginTop,d.textAlign=s.textAlign(m.footerAlign),d.textBaseline="middle",E=ts(m.footerFont),d.fillStyle=m.footerColor,d.font=E.string,P=0;P<T;++P)d.fillText(x[P],s.x(a.x),a.y+E.lineHeight/2),a.y+=E.lineHeight+m.footerSpacing}}drawBackground(a,d,m,x){const{xAlign:T,yAlign:E}=this,{x:P,y:s}=a,{width:B,height:q}=m,{topLeft:Z,topRight:ae,bottomLeft:ue,bottomRight:Le}=Ku(x.cornerRadius);d.fillStyle=x.backgroundColor,d.strokeStyle=x.borderColor,d.lineWidth=x.borderWidth,d.beginPath(),d.moveTo(P+Z,s),E==="top"&&this.drawCaret(a,d,m,x),d.lineTo(P+B-ae,s),d.quadraticCurveTo(P+B,s,P+B,s+ae),E==="center"&&T==="right"&&this.drawCaret(a,d,m,x),d.lineTo(P+B,s+q-Le),d.quadraticCurveTo(P+B,s+q,P+B-Le,s+q),E==="bottom"&&this.drawCaret(a,d,m,x),d.lineTo(P+ue,s+q),d.quadraticCurveTo(P,s+q,P,s+q-ue),E==="center"&&T==="left"&&this.drawCaret(a,d,m,x),d.lineTo(P,s+Z),d.quadraticCurveTo(P,s,P+Z,s),d.closePath(),d.fill(),x.borderWidth>0&&d.stroke()}_updateAnimationTarget(a){const d=this.chart,m=this.$animations,x=m&&m.x,T=m&&m.y;if(x||T){const E=_f[a.position].call(this,this._active,this._eventPosition);if(!E)return;const P=this._size=$T(this,a),s=Object.assign({},E,this._size),B=qT(d,a,s),q=HT(a,s,B,d);(x._to!==q.x||T._to!==q.y)&&(this.xAlign=B.xAlign,this.yAlign=B.yAlign,this.width=P.width,this.height=P.height,this.caretX=E.x,this.caretY=E.y,this._resolveAnimations().update(this,q))}}_willRender(){return!!this.opacity}draw(a){const d=this.options.setContext(this.getContext());let m=this.opacity;if(!m)return;this._updateAnimationTarget(d);const x={width:this.width,height:this.height},T={x:this.x,y:this.y};m=Math.abs(m)<.001?0:m;const E=ks(d.padding),P=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;d.enabled&&P&&(a.save(),a.globalAlpha=m,this.drawBackground(T,a,x,d),jR(a,d.textDirection),T.y+=E.top,this.drawTitle(T,a,d),this.drawBody(T,a,d),this.drawFooter(T,a,d),GR(a,d.textDirection),a.restore())}getActiveElements(){return this._active||[]}setActiveElements(a,d){const m=this._active,x=a.map(({datasetIndex:P,index:s})=>{const B=this.chart.getDatasetMeta(P);if(!B)throw new Error("Cannot find a dataset at index "+P);return{datasetIndex:P,element:B.data[s],index:s}}),T=!x_(m,x),E=this._positionChanged(x,d);(T||E)&&(this._active=x,this._eventPosition=d,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(a,d,m=!0){if(d&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const x=this.options,T=this._active||[],E=this._getActiveElements(a,T,d,m),P=this._positionChanged(E,a),s=d||!x_(E,T)||P;return s&&(this._active=E,(x.enabled||x.external)&&(this._eventPosition={x:a.x,y:a.y},this.update(!0,d))),s}_getActiveElements(a,d,m,x){const T=this.options;if(a.type==="mouseout")return[];if(!x)return d.filter(P=>this.chart.data.datasets[P.datasetIndex]&&this.chart.getDatasetMeta(P.datasetIndex).controller.getParsed(P.index)!==void 0);const E=this.chart.getElementsAtEventForMode(a,T.mode,T,m);return T.reverse&&E.reverse(),E}_positionChanged(a,d){const{caretX:m,caretY:x,options:T}=this,E=_f[T.position].call(this,a,d);return E!==!1&&(m!==E.x||x!==E.y)}}Bi(M0,"positioners",_f);var qk={id:"tooltip",_element:M0,positioners:_f,afterInit(c,a,d){d&&(c.tooltip=new M0({chart:c,options:d}))},beforeUpdate(c,a,d){c.tooltip&&c.tooltip.initialize(d)},reset(c,a,d){c.tooltip&&c.tooltip.initialize(d)},afterDraw(c){const a=c.tooltip;if(a&&a._willRender()){const d={tooltip:a};if(c.notifyPlugins("beforeTooltipDraw",{...d,cancelable:!0})===!1)return;a.draw(c.ctx),c.notifyPlugins("afterTooltipDraw",d)}},afterEvent(c,a){if(c.tooltip){const d=a.replay;c.tooltip.handleEvent(a.event,d,a.inChartArea)&&(a.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(c,a)=>a.bodyFont.size,boxWidth:(c,a)=>a.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:KS},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:c=>c!=="filter"&&c!=="itemSort"&&c!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Hk=(c,a,d,m)=>(typeof a=="string"?(d=c.push(a)-1,m.unshift({index:d,label:a})):isNaN(a)&&(d=null),d);function Wk(c,a,d,m){const x=c.indexOf(a);if(x===-1)return Hk(c,a,d,m);const T=c.lastIndexOf(a);return x!==T?d:x}const Zk=(c,a)=>c===null?null:ho(Math.round(c),0,a);function XT(c){const a=this.getLabels();return c>=0&&c<a.length?a[c]:c}class S0 extends Vc{constructor(a){super(a),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(a){const d=this._addedLabels;if(d.length){const m=this.getLabels();for(const{index:x,label:T}of d)m[x]===T&&m.splice(x,1);this._addedLabels=[]}super.init(a)}parse(a,d){if(Dn(a))return null;const m=this.getLabels();return d=isFinite(d)&&m[d]===a?d:Wk(m,a,Hn(d,a),this._addedLabels),Zk(d,m.length-1)}determineDataLimits(){const{minDefined:a,maxDefined:d}=this.getUserBounds();let{min:m,max:x}=this.getMinMax(!0);this.options.bounds==="ticks"&&(a||(m=0),d||(x=this.getLabels().length-1)),this.min=m,this.max=x}buildTicks(){const a=this.min,d=this.max,m=this.options.offset,x=[];let T=this.getLabels();T=a===0&&d===T.length-1?T:T.slice(a,d+1),this._valueRange=Math.max(T.length-(m?0:1),1),this._startValue=this.min-(m?.5:0);for(let E=a;E<=d;E++)x.push({value:E});return x}getLabelForValue(a){return XT.call(this,a)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(a){return typeof a!="number"&&(a=this.parse(a)),a===null?NaN:this.getPixelForDecimal((a-this._startValue)/this._valueRange)}getPixelForTick(a){const d=this.ticks;return a<0||a>d.length-1?null:this.getPixelForValue(d[a].value)}getValueForPixel(a){return Math.round(this._startValue+this.getDecimalForPixel(a)*this._valueRange)}getBasePixel(){return this.bottom}}Bi(S0,"id","category"),Bi(S0,"defaults",{ticks:{callback:XT}});function Xk(c,a){const d=[],{bounds:x,step:T,min:E,max:P,precision:s,count:B,maxTicks:q,maxDigits:Z,includeBounds:ae}=c,ue=T||1,Le=q-1,{min:Ae,max:Oe}=a,We=!Dn(E),ct=!Dn(P),gt=!Dn(B),Lt=(Oe-Ae)/(Z+1);let Rt=Qw((Oe-Ae)/Le/ue)*ue,Wt,ui,bi,$e;if(Rt<1e-14&&!We&&!ct)return[{value:Ae},{value:Oe}];$e=Math.ceil(Oe/Rt)-Math.floor(Ae/Rt),$e>Le&&(Rt=Qw($e*Rt/Le/ue)*ue),Dn(s)||(Wt=Math.pow(10,s),Rt=Math.ceil(Rt*Wt)/Wt),x==="ticks"?(ui=Math.floor(Ae/Rt)*Rt,bi=Math.ceil(Oe/Rt)*Rt):(ui=Ae,bi=Oe),We&&ct&&T&&YL((P-E)/T,Rt/1e3)?($e=Math.round(Math.min((P-E)/Rt,q)),Rt=(P-E)/$e,ui=E,bi=P):gt?(ui=We?E:ui,bi=ct?P:bi,$e=B-1,Rt=(bi-ui)/$e):($e=(bi-ui)/Rt,l_($e,Math.round($e),Rt/1e3)?$e=Math.round($e):$e=Math.ceil($e));const Ji=Math.max(eT(Rt),eT(ui));Wt=Math.pow(10,Dn(s)?Ji:s),ui=Math.round(ui*Wt)/Wt,bi=Math.round(bi*Wt)/Wt;let un=0;for(We&&(ae&&ui!==E?(d.push({value:E}),ui<E&&un++,l_(Math.round((ui+un*Rt)*Wt)/Wt,E,YT(E,Lt,c))&&un++):ui<E&&un++);un<$e;++un){const Zt=Math.round((ui+un*Rt)*Wt)/Wt;if(ct&&Zt>P)break;d.push({value:Zt})}return ct&&ae&&bi!==P?d.length&&l_(d[d.length-1].value,P,YT(P,Lt,c))?d[d.length-1].value=P:d.push({value:P}):(!ct||bi===P)&&d.push({value:bi}),d}function YT(c,a,{horizontal:d,minRotation:m}){const x=uo(m),T=(d?Math.sin(x):Math.cos(x))||.001,E=.75*a*(""+c).length;return Math.min(a/T,E)}class A_ extends Vc{constructor(a){super(a),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(a,d){return Dn(a)||(typeof a=="number"||a instanceof Number)&&!isFinite(+a)?null:+a}handleTickRangeOptions(){const{beginAtZero:a}=this.options,{minDefined:d,maxDefined:m}=this.getUserBounds();let{min:x,max:T}=this;const E=s=>x=d?x:s,P=s=>T=m?T:s;if(a){const s=xl(x),B=xl(T);s<0&&B<0?P(0):s>0&&B>0&&E(0)}if(x===T){let s=T===0?1:Math.abs(T*.05);P(T+s),a||E(x-s)}this.min=x,this.max=T}getTickLimit(){const a=this.options.ticks;let{maxTicksLimit:d,stepSize:m}=a,x;return m?(x=Math.ceil(this.max/m)-Math.floor(this.min/m)+1,x>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${m} would result generating up to ${x} ticks. Limiting to 1000.`),x=1e3)):(x=this.computeTickLimit(),d=d||11),d&&(x=Math.min(d,x)),x}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const a=this.options,d=a.ticks;let m=this.getTickLimit();m=Math.max(2,m);const x={maxTicks:m,bounds:a.bounds,min:a.min,max:a.max,precision:d.precision,step:d.stepSize,count:d.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:d.minRotation||0,includeBounds:d.includeBounds!==!1},T=this._range||this,E=Xk(x,T);return a.bounds==="ticks"&&xS(E,this,"value"),a.reverse?(E.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),E}configure(){const a=this.ticks;let d=this.min,m=this.max;if(super.configure(),this.options.offset&&a.length){const x=(m-d)/Math.max(a.length-1,1)/2;d-=x,m+=x}this._startValue=d,this._endValue=m,this._valueRange=m-d}getLabelForValue(a){return Vf(a,this.chart.options.locale,this.options.ticks.format)}}class E0 extends A_{determineDataLimits(){const{min:a,max:d}=this.getMinMax(!0);this.min=Cr(a)?a:0,this.max=Cr(d)?d:1,this.handleTickRangeOptions()}computeTickLimit(){const a=this.isHorizontal(),d=a?this.width:this.height,m=uo(this.options.ticks.minRotation),x=(a?Math.sin(m):Math.cos(m))||.001,T=this._resolveTickFontOptions(0);return Math.ceil(d/Math.min(40,T.lineHeight/x))}getPixelForValue(a){return a===null?NaN:this.getPixelForDecimal((a-this._startValue)/this._valueRange)}getValueForPixel(a){return this._startValue+this.getDecimalForPixel(a)*this._valueRange}}Bi(E0,"id","linear"),Bi(E0,"defaults",{ticks:{callback:U_.formatters.numeric}});const Ff=c=>Math.floor(fl(c)),Sc=(c,a)=>Math.pow(10,Ff(c)+a);function KT(c){return c/Math.pow(10,Ff(c))===1}function JT(c,a,d){const m=Math.pow(10,d),x=Math.floor(c/m);return Math.ceil(a/m)-x}function Yk(c,a){const d=a-c;let m=Ff(d);for(;JT(c,a,m)>10;)m++;for(;JT(c,a,m)<10;)m--;return Math.min(m,Ff(c))}function Kk(c,{min:a,max:d}){a=Rs(c.min,a);const m=[],x=Ff(a);let T=Yk(a,d),E=T<0?Math.pow(10,Math.abs(T)):1;const P=Math.pow(10,T),s=x>T?Math.pow(10,x):0,B=Math.round((a-s)*E)/E,q=Math.floor((a-s)/P/10)*P*10;let Z=Math.floor((B-q)/Math.pow(10,T)),ae=Rs(c.min,Math.round((s+q+Z*Math.pow(10,T))*E)/E);for(;ae<d;)m.push({value:ae,major:KT(ae),significand:Z}),Z>=10?Z=Z<15?15:20:Z++,Z>=20&&(T++,Z=2,E=T>=0?1:E),ae=Math.round((s+q+Z*Math.pow(10,T))*E)/E;const ue=Rs(c.max,ae);return m.push({value:ue,major:KT(ue),significand:Z}),m}class QT extends Vc{constructor(a){super(a),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(a,d){const m=A_.prototype.parse.apply(this,[a,d]);if(m===0){this._zero=!0;return}return Cr(m)&&m>0?m:null}determineDataLimits(){const{min:a,max:d}=this.getMinMax(!0);this.min=Cr(a)?Math.max(0,a):null,this.max=Cr(d)?Math.max(0,d):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Cr(this._userMin)&&(this.min=a===Sc(this.min,0)?Sc(this.min,-1):Sc(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:a,maxDefined:d}=this.getUserBounds();let m=this.min,x=this.max;const T=P=>m=a?m:P,E=P=>x=d?x:P;m===x&&(m<=0?(T(1),E(10)):(T(Sc(m,-1)),E(Sc(x,1)))),m<=0&&T(Sc(x,-1)),x<=0&&E(Sc(m,1)),this.min=m,this.max=x}buildTicks(){const a=this.options,d={min:this._userMin,max:this._userMax},m=Kk(d,this);return a.bounds==="ticks"&&xS(m,this,"value"),a.reverse?(m.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),m}getLabelForValue(a){return a===void 0?"0":Vf(a,this.chart.options.locale,this.options.ticks.format)}configure(){const a=this.min;super.configure(),this._startValue=fl(a),this._valueRange=fl(this.max)-fl(a)}getPixelForValue(a){return(a===void 0||a===0)&&(a=this.min),a===null||isNaN(a)?NaN:this.getPixelForDecimal(a===this.min?0:(fl(a)-this._startValue)/this._valueRange)}getValueForPixel(a){const d=this.getDecimalForPixel(a);return Math.pow(10,this._startValue+d*this._valueRange)}}Bi(QT,"id","logarithmic"),Bi(QT,"defaults",{ticks:{callback:U_.formatters.logarithmic,major:{enabled:!0}}});function A0(c){const a=c.ticks;if(a.display&&c.display){const d=ks(a.backdropPadding);return Hn(a.font&&a.font.size,ur.font.size)+d.height}return 0}function Jk(c,a,d){return d=Yn(d)?d:[d],{w:fR(c,a.string,d),h:d.length*a.lineHeight}}function eM(c,a,d,m,x){return c===m||c===x?{start:a-d/2,end:a+d/2}:c<m||c>x?{start:a-d,end:a}:{start:a,end:a+d}}function Qk(c){const a={l:c.left+c._padding.left,r:c.right-c._padding.right,t:c.top+c._padding.top,b:c.bottom-c._padding.bottom},d=Object.assign({},a),m=[],x=[],T=c._pointLabels.length,E=c.options.pointLabels,P=E.centerPointLabels?hr/T:0;for(let s=0;s<T;s++){const B=E.setContext(c.getPointLabelContext(s));x[s]=B.padding;const q=c.getPointPosition(s,c.drawingArea+x[s],P),Z=ts(B.font),ae=Jk(c.ctx,Z,c._pointLabels[s]);m[s]=ae;const ue=Uo(c.getIndexAngle(s)+P),Le=Math.round(Q0(ue)),Ae=eM(Le,q.x,ae.w,0,180),Oe=eM(Le,q.y,ae.h,90,270);eO(d,a,ue,Ae,Oe)}c.setCenterPoint(a.l-d.l,d.r-a.r,a.t-d.t,d.b-a.b),c._pointLabelItems=nO(c,m,x)}function eO(c,a,d,m,x){const T=Math.abs(Math.sin(d)),E=Math.abs(Math.cos(d));let P=0,s=0;m.start<a.l?(P=(a.l-m.start)/T,c.l=Math.min(c.l,a.l-P)):m.end>a.r&&(P=(m.end-a.r)/T,c.r=Math.max(c.r,a.r+P)),x.start<a.t?(s=(a.t-x.start)/E,c.t=Math.min(c.t,a.t-s)):x.end>a.b&&(s=(x.end-a.b)/E,c.b=Math.max(c.b,a.b+s))}function tO(c,a,d){const m=c.drawingArea,{extra:x,additionalAngle:T,padding:E,size:P}=d,s=c.getPointPosition(a,m+x+E,T),B=Math.round(Q0(Uo(s.angle+es))),q=oO(s.y,P.h,B),Z=rO(B),ae=sO(s.x,P.w,Z);return{visible:!0,x:s.x,y:q,textAlign:Z,left:ae,top:q,right:ae+P.w,bottom:q+P.h}}function iO(c,a){if(!a)return!0;const{left:d,top:m,right:x,bottom:T}=c;return!(Hu({x:d,y:m},a)||Hu({x:d,y:T},a)||Hu({x,y:m},a)||Hu({x,y:T},a))}function nO(c,a,d){const m=[],x=c._pointLabels.length,T=c.options,{centerPointLabels:E,display:P}=T.pointLabels,s={extra:A0(T)/2,additionalAngle:E?hr/x:0};let B;for(let q=0;q<x;q++){s.padding=d[q],s.size=a[q];const Z=tO(c,q,s);m.push(Z),P==="auto"&&(Z.visible=iO(Z,B),Z.visible&&(B=Z))}return m}function rO(c){return c===0||c===180?"center":c<180?"left":"right"}function sO(c,a,d){return d==="right"?c-=a:d==="center"&&(c-=a/2),c}function oO(c,a,d){return d===90||d===270?c-=a/2:(d>270||d<90)&&(c-=a),c}function aO(c,a,d){const{left:m,top:x,right:T,bottom:E}=d,{backdropColor:P}=a;if(!Dn(P)){const s=Ku(a.borderRadius),B=ks(a.backdropPadding);c.fillStyle=P;const q=m-B.left,Z=x-B.top,ae=T-m+B.width,ue=E-x+B.height;Object.values(s).some(Le=>Le!==0)?(c.beginPath(),M_(c,{x:q,y:Z,w:ae,h:ue,radius:s}),c.fill()):c.fillRect(q,Z,ae,ue)}}function lO(c,a){const{ctx:d,options:{pointLabels:m}}=c;for(let x=a-1;x>=0;x--){const T=c._pointLabelItems[x];if(!T.visible)continue;const E=m.setContext(c.getPointLabelContext(x));aO(d,E,T);const P=ts(E.font),{x:s,y:B,textAlign:q}=T;kf(d,c._pointLabels[x],s,B+P.lineHeight/2,P,{color:E.color,textAlign:q,textBaseline:"middle"})}}function JS(c,a,d,m){const{ctx:x}=c;if(d)x.arc(c.xCenter,c.yCenter,a,0,_s);else{let T=c.getPointPosition(0,a);x.moveTo(T.x,T.y);for(let E=1;E<m;E++)T=c.getPointPosition(E,a),x.lineTo(T.x,T.y)}}function cO(c,a,d,m,x){const T=c.ctx,E=a.circular,{color:P,lineWidth:s}=a;!E&&!m||!P||!s||d<0||(T.save(),T.strokeStyle=P,T.lineWidth=s,T.setLineDash(x.dash),T.lineDashOffset=x.dashOffset,T.beginPath(),JS(c,d,E,m),T.closePath(),T.stroke(),T.restore())}function uO(c,a,d){return Nc(c,{label:d,index:a,type:"pointLabel"})}class e_ extends A_{constructor(a){super(a),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const a=this._padding=ks(A0(this.options)/2),d=this.width=this.maxWidth-a.width,m=this.height=this.maxHeight-a.height;this.xCenter=Math.floor(this.left+d/2+a.left),this.yCenter=Math.floor(this.top+m/2+a.top),this.drawingArea=Math.floor(Math.min(d,m)/2)}determineDataLimits(){const{min:a,max:d}=this.getMinMax(!1);this.min=Cr(a)&&!isNaN(a)?a:0,this.max=Cr(d)&&!isNaN(d)?d:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/A0(this.options))}generateTickLabels(a){A_.prototype.generateTickLabels.call(this,a),this._pointLabels=this.getLabels().map((d,m)=>{const x=ir(this.options.pointLabels.callback,[d,m],this);return x||x===0?x:""}).filter((d,m)=>this.chart.getDataVisibility(m))}fit(){const a=this.options;a.display&&a.pointLabels.display?Qk(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(a,d,m,x){this.xCenter+=Math.floor((a-d)/2),this.yCenter+=Math.floor((m-x)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(a,d,m,x))}getIndexAngle(a){const d=_s/(this._pointLabels.length||1),m=this.options.startAngle||0;return Uo(a*d+uo(m))}getDistanceFromCenterForValue(a){if(Dn(a))return NaN;const d=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-a)*d:(a-this.min)*d}getValueForDistanceFromCenter(a){if(Dn(a))return NaN;const d=a/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-d:this.min+d}getPointLabelContext(a){const d=this._pointLabels||[];if(a>=0&&a<d.length){const m=d[a];return uO(this.getContext(),a,m)}}getPointPosition(a,d,m=0){const x=this.getIndexAngle(a)-es+m;return{x:Math.cos(x)*d+this.xCenter,y:Math.sin(x)*d+this.yCenter,angle:x}}getPointPositionForValue(a,d){return this.getPointPosition(a,this.getDistanceFromCenterForValue(d))}getBasePosition(a){return this.getPointPositionForValue(a||0,this.getBaseValue())}getPointLabelPosition(a){const{left:d,top:m,right:x,bottom:T}=this._pointLabelItems[a];return{left:d,top:m,right:x,bottom:T}}drawBackground(){const{backgroundColor:a,grid:{circular:d}}=this.options;if(a){const m=this.ctx;m.save(),m.beginPath(),JS(this,this.getDistanceFromCenterForValue(this._endValue),d,this._pointLabels.length),m.closePath(),m.fillStyle=a,m.fill(),m.restore()}}drawGrid(){const a=this.ctx,d=this.options,{angleLines:m,grid:x,border:T}=d,E=this._pointLabels.length;let P,s,B;if(d.pointLabels.display&&lO(this,E),x.display&&this.ticks.forEach((q,Z)=>{if(Z!==0||Z===0&&this.min<0){s=this.getDistanceFromCenterForValue(q.value);const ae=this.getContext(Z),ue=x.setContext(ae),Le=T.setContext(ae);cO(this,ue,s,E,Le)}}),m.display){for(a.save(),P=E-1;P>=0;P--){const q=m.setContext(this.getPointLabelContext(P)),{color:Z,lineWidth:ae}=q;!ae||!Z||(a.lineWidth=ae,a.strokeStyle=Z,a.setLineDash(q.borderDash),a.lineDashOffset=q.borderDashOffset,s=this.getDistanceFromCenterForValue(d.ticks.reverse?this.min:this.max),B=this.getPointPosition(P,s),a.beginPath(),a.moveTo(this.xCenter,this.yCenter),a.lineTo(B.x,B.y),a.stroke())}a.restore()}}drawBorder(){}drawLabels(){const a=this.ctx,d=this.options,m=d.ticks;if(!m.display)return;const x=this.getIndexAngle(0);let T,E;a.save(),a.translate(this.xCenter,this.yCenter),a.rotate(x),a.textAlign="center",a.textBaseline="middle",this.ticks.forEach((P,s)=>{if(s===0&&this.min>=0&&!d.reverse)return;const B=m.setContext(this.getContext(s)),q=ts(B.font);if(T=this.getDistanceFromCenterForValue(this.ticks[s].value),B.showLabelBackdrop){a.font=q.string,E=a.measureText(P.label).width,a.fillStyle=B.backdropColor;const Z=ks(B.backdropPadding);a.fillRect(-E/2-Z.left,-T-q.size/2-Z.top,E+Z.width,q.size+Z.height)}kf(a,P.label,0,-T,q,{color:B.color,strokeColor:B.textStrokeColor,strokeWidth:B.textStrokeWidth})}),a.restore()}drawTitle(){}}Bi(e_,"id","radialLinear"),Bi(e_,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:U_.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(a){return a},padding:5,centerPointLabels:!1}}),Bi(e_,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Bi(e_,"descriptors",{angleLines:{_fallback:"grid"}});const $_={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ps=Object.keys($_);function tM(c,a){return c-a}function iM(c,a){if(Dn(a))return null;const d=c._adapter,{parser:m,round:x,isoWeekday:T}=c._parseOpts;let E=a;return typeof m=="function"&&(E=m(E)),Cr(E)||(E=typeof m=="string"?d.parse(E,m):d.parse(E)),E===null?null:(x&&(E=x==="week"&&(w_(T)||T===!0)?d.startOf(E,"isoWeek",T):d.startOf(E,x)),+E)}function nM(c,a,d,m){const x=ps.length;for(let T=ps.indexOf(c);T<x-1;++T){const E=$_[ps[T]],P=E.steps?E.steps:Number.MAX_SAFE_INTEGER;if(E.common&&Math.ceil((d-a)/(P*E.size))<=m)return ps[T]}return ps[x-1]}function hO(c,a,d,m,x){for(let T=ps.length-1;T>=ps.indexOf(d);T--){const E=ps[T];if($_[E].common&&c._adapter.diff(x,m,E)>=a-1)return E}return ps[d?ps.indexOf(d):0]}function dO(c){for(let a=ps.indexOf(c)+1,d=ps.length;a<d;++a)if($_[ps[a]].common)return ps[a]}function rM(c,a,d){if(!d)c[a]=!0;else if(d.length){const{lo:m,hi:x}=ex(d,a),T=d[m]>=a?d[m]:d[x];c[T]=!0}}function fO(c,a,d,m){const x=c._adapter,T=+x.startOf(a[0].value,m),E=a[a.length-1].value;let P,s;for(P=T;P<=E;P=+x.add(P,1,m))s=d[P],s>=0&&(a[s].major=!0);return a}function sM(c,a,d){const m=[],x={},T=a.length;let E,P;for(E=0;E<T;++E)P=a[E],x[P]=E,m.push({value:P,major:!1});return T===0||!d?m:fO(c,m,x,d)}class I_ extends Vc{constructor(a){super(a),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(a,d={}){const m=a.time||(a.time={}),x=this._adapter=new mz._date(a.adapters.date);x.init(d),Tf(m.displayFormats,x.formats()),this._parseOpts={parser:m.parser,round:m.round,isoWeekday:m.isoWeekday},super.init(a),this._normalized=d.normalized}parse(a,d){return a===void 0?null:iM(this,a)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const a=this.options,d=this._adapter,m=a.time.unit||"day";let{min:x,max:T,minDefined:E,maxDefined:P}=this.getUserBounds();function s(B){!E&&!isNaN(B.min)&&(x=Math.min(x,B.min)),!P&&!isNaN(B.max)&&(T=Math.max(T,B.max))}(!E||!P)&&(s(this._getLabelBounds()),(a.bounds!=="ticks"||a.ticks.source!=="labels")&&s(this.getMinMax(!1))),x=Cr(x)&&!isNaN(x)?x:+d.startOf(Date.now(),m),T=Cr(T)&&!isNaN(T)?T:+d.endOf(Date.now(),m)+1,this.min=Math.min(x,T-1),this.max=Math.max(x+1,T)}_getLabelBounds(){const a=this.getLabelTimestamps();let d=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY;return a.length&&(d=a[0],m=a[a.length-1]),{min:d,max:m}}buildTicks(){const a=this.options,d=a.time,m=a.ticks,x=m.source==="labels"?this.getLabelTimestamps():this._generate();a.bounds==="ticks"&&x.length&&(this.min=this._userMin||x[0],this.max=this._userMax||x[x.length-1]);const T=this.min,E=this.max,P=tR(x,T,E);return this._unit=d.unit||(m.autoSkip?nM(d.minUnit,this.min,this.max,this._getLabelCapacity(T)):hO(this,P.length,d.minUnit,this.min,this.max)),this._majorUnit=!m.major.enabled||this._unit==="year"?void 0:dO(this._unit),this.initOffsets(x),a.reverse&&P.reverse(),sM(this,P,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(a=>+a.value))}initOffsets(a=[]){let d=0,m=0,x,T;this.options.offset&&a.length&&(x=this.getDecimalForValue(a[0]),a.length===1?d=1-x:d=(this.getDecimalForValue(a[1])-x)/2,T=this.getDecimalForValue(a[a.length-1]),a.length===1?m=T:m=(T-this.getDecimalForValue(a[a.length-2]))/2);const E=a.length<3?.5:.25;d=ho(d,0,E),m=ho(m,0,E),this._offsets={start:d,end:m,factor:1/(d+1+m)}}_generate(){const a=this._adapter,d=this.min,m=this.max,x=this.options,T=x.time,E=T.unit||nM(T.minUnit,d,m,this._getLabelCapacity(d)),P=Hn(x.ticks.stepSize,1),s=E==="week"?T.isoWeekday:!1,B=w_(s)||s===!0,q={};let Z=d,ae,ue;if(B&&(Z=+a.startOf(Z,"isoWeek",s)),Z=+a.startOf(Z,B?"day":E),a.diff(m,d,E)>1e5*P)throw new Error(d+" and "+m+" are too far apart with stepSize of "+P+" "+E);const Le=x.ticks.source==="data"&&this.getDataTimestamps();for(ae=Z,ue=0;ae<m;ae=+a.add(ae,P,E),ue++)rM(q,ae,Le);return(ae===m||x.bounds==="ticks"||ue===1)&&rM(q,ae,Le),Object.keys(q).sort(tM).map(Ae=>+Ae)}getLabelForValue(a){const d=this._adapter,m=this.options.time;return m.tooltipFormat?d.format(a,m.tooltipFormat):d.format(a,m.displayFormats.datetime)}format(a,d){const x=this.options.time.displayFormats,T=this._unit,E=d||x[T];return this._adapter.format(a,E)}_tickFormatFunction(a,d,m,x){const T=this.options,E=T.ticks.callback;if(E)return ir(E,[a,d,m],this);const P=T.time.displayFormats,s=this._unit,B=this._majorUnit,q=s&&P[s],Z=B&&P[B],ae=m[d],ue=B&&Z&&ae&&ae.major;return this._adapter.format(a,x||(ue?Z:q))}generateTickLabels(a){let d,m,x;for(d=0,m=a.length;d<m;++d)x=a[d],x.label=this._tickFormatFunction(x.value,d,a)}getDecimalForValue(a){return a===null?NaN:(a-this.min)/(this.max-this.min)}getPixelForValue(a){const d=this._offsets,m=this.getDecimalForValue(a);return this.getPixelForDecimal((d.start+m)*d.factor)}getValueForPixel(a){const d=this._offsets,m=this.getDecimalForPixel(a)/d.factor-d.end;return this.min+m*(this.max-this.min)}_getLabelSize(a){const d=this.options.ticks,m=this.ctx.measureText(a).width,x=uo(this.isHorizontal()?d.maxRotation:d.minRotation),T=Math.cos(x),E=Math.sin(x),P=this._resolveTickFontOptions(0).size;return{w:m*T+P*E,h:m*E+P*T}}_getLabelCapacity(a){const d=this.options.time,m=d.displayFormats,x=m[d.unit]||m.millisecond,T=this._tickFormatFunction(a,0,sM(this,[a],this._majorUnit),x),E=this._getLabelSize(T),P=Math.floor(this.isHorizontal()?this.width/E.w:this.height/E.h)-1;return P>0?P:1}getDataTimestamps(){let a=this._cache.data||[],d,m;if(a.length)return a;const x=this.getMatchingVisibleMetas();if(this._normalized&&x.length)return this._cache.data=x[0].controller.getAllParsedValues(this);for(d=0,m=x.length;d<m;++d)a=a.concat(x[d].controller.getAllParsedValues(this));return this._cache.data=this.normalize(a)}getLabelTimestamps(){const a=this._cache.labels||[];let d,m;if(a.length)return a;const x=this.getLabels();for(d=0,m=x.length;d<m;++d)a.push(iM(this,x[d]));return this._cache.labels=this._normalized?a:this.normalize(a)}normalize(a){return bS(a.sort(tM))}}Bi(I_,"id","time"),Bi(I_,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function t_(c,a,d){let m=0,x=c.length-1,T,E,P,s;d?(a>=c[m].pos&&a<=c[x].pos&&({lo:m,hi:x}=x0(c,"pos",a)),{pos:T,time:P}=c[m],{pos:E,time:s}=c[x]):(a>=c[m].time&&a<=c[x].time&&({lo:m,hi:x}=x0(c,"time",a)),{time:T,pos:P}=c[m],{time:E,pos:s}=c[x]);const B=E-T;return B?P+(s-P)*(a-T)/B:P}class oM extends I_{constructor(a){super(a),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const a=this._getTimestampsForTable(),d=this._table=this.buildLookupTable(a);this._minPos=t_(d,this.min),this._tableRange=t_(d,this.max)-this._minPos,super.initOffsets(a)}buildLookupTable(a){const{min:d,max:m}=this,x=[],T=[];let E,P,s,B,q;for(E=0,P=a.length;E<P;++E)B=a[E],B>=d&&B<=m&&x.push(B);if(x.length<2)return[{time:d,pos:0},{time:m,pos:1}];for(E=0,P=x.length;E<P;++E)q=x[E+1],s=x[E-1],B=x[E],Math.round((q+s)/2)!==B&&T.push({time:B,pos:E/(P-1)});return T}_generate(){const a=this.min,d=this.max;let m=super.getDataTimestamps();return(!m.includes(a)||!m.length)&&m.splice(0,0,a),(!m.includes(d)||m.length===1)&&m.push(d),m.sort((x,T)=>x-T)}_getTimestampsForTable(){let a=this._cache.all||[];if(a.length)return a;const d=this.getDataTimestamps(),m=this.getLabelTimestamps();return d.length&&m.length?a=this.normalize(d.concat(m)):a=d.length?d:m,a=this._cache.all=a,a}getDecimalForValue(a){return(t_(this._table,a)-this._minPos)/this._tableRange}getValueForPixel(a){const d=this._offsets,m=this.getDecimalForPixel(a)/d.factor-d.end;return t_(this._table,m*this._tableRange+this._minPos,!0)}}Bi(oM,"id","timeseries"),Bi(oM,"defaults",I_.defaults);const QS={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},pO={ariaLabel:{type:String},ariaDescribedby:{type:String}},mO={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...QS,...pO},_O=lS[0]==="2"?(c,a)=>Object.assign(c,{attrs:a}):(c,a)=>Object.assign(c,a);function $u(c){return z_(c)?pn(c):c}function gO(c){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c;return z_(a)?new Proxy(c,{}):c}function yO(c,a){const d=c.options;d&&a&&Object.assign(d,a)}function eE(c,a){c.labels=a}function tE(c,a,d){const m=[];c.datasets=a.map(x=>{const T=c.datasets.find(E=>E[d]===x[d]);return!T||!x.data||m.includes(T)?{...x}:(m.push(T),Object.assign(T,x),T)})}function xO(c,a){const d={labels:[],datasets:[]};return eE(d,c.labels),tE(d,c.datasets,a),d}const vO=UM({props:mO,setup(c,a){let{expose:d,slots:m}=a;const x=uf(null),T=PM(null);d({chart:T});const E=()=>{if(!x.value)return;const{type:B,data:q,options:Z,plugins:ae,datasetIdKey:ue}=c,Le=xO(q,ue),Ae=gO(Le,q);T.value=new G_(x.value,{type:B,data:Ae,options:{...Z},plugins:ae})},P=()=>{const B=pn(T.value);B&&(c.destroyDelay>0?setTimeout(()=>{B.destroy(),T.value=null},c.destroyDelay):(B.destroy(),T.value=null))},s=B=>{B.update(c.updateMode)};return $M(E),q0(P),Dc([()=>c.options,()=>c.data],(B,q)=>{let[Z,ae]=B,[ue,Le]=q;const Ae=pn(T.value);if(!Ae)return;let Oe=!1;if(Z){const We=$u(Z),ct=$u(ue);We&&We!==ct&&(yO(Ae,We),Oe=!0)}if(ae){const We=$u(ae.labels),ct=$u(Le.labels),gt=$u(ae.datasets),Lt=$u(Le.datasets);We!==ct&&(eE(Ae.config.data,We),Oe=!0),gt&&gt!==Lt&&(tE(Ae.config.data,gt,c.datasetIdKey),Oe=!0)}Oe&&zM(()=>{s(Ae)})},{deep:!0}),()=>_0("canvas",{role:"img",ariaLabel:c.ariaLabel,ariaDescribedby:c.ariaDescribedby,ref:x},[_0("p",{},[m.default?m.default():""])])}});function bO(c,a){return G_.register(a),UM({props:QS,setup(d,m){let{expose:x}=m;const T=PM(null),E=P=>{T.value=P==null?void 0:P.chart};return x({chart:T}),()=>_0(vO,_O({ref:E},{type:c,...d}))}})}const aM=bO("bar",c_),wO=Qr("hr",{style:{"margin-top":"1rem","margin-bottom":"1rem"}},null,-1),TO={style:{"text-transform":"uppercase"}},MO={style:{"margin-right":"0.75rem"}},SO={__name:"DataViz",setup(c){G_.register(Fk,qk,f_,S0,E0,kk);const{employees:a,residents:d}=yr.formData,m=4.229+2.072*a+.139*d,x=-2.242+3.817*a+.181*d,T={labels:["Person Trips","Residents","Employees"],datasets:[{data:[m,d,a]}]},E={responsive:!0,indexAxis:"y",plugins:{title:{display:!0,text:"Person Trips AM"}}},P={labels:["Person Trips","Residents","Employees"],datasets:[{data:[x,d,a]}]},s={responsive:!0,indexAxis:"y",plugins:{title:{display:!0,text:"Person Trips PM"}}};return(B,q)=>(Gs(),$o(zs,null,[wO,Qr("p",TO,Xu(xa(yr).formData.address),1),Qr("p",null,[Qr("span",MO,"Employees: "+Xu(xa(yr).formData.employees),1),Qr("span",null,"Residents: "+Xu(xa(yr).formData.residents),1)]),nr(xa(aM),{id:"chartAM",options:E,data:T}),nr(xa(aM),{id:"chartPM",options:s,data:P})],64))}},EO={key:0,id:"suggestions"},AO=["onClick"],IO={__name:"SideBar",setup(c){const a=uf(""),d=uf(""),m=uf([]),x=uf(0),T=async P=>{P.preventDefault();var s=new FormData(P.target);yr.formData=Object.fromEntries(s),x.value+=1};Dc(d,yL(async P=>{if(P){const B=await(await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/DOR_Parcel/FeatureServer/0/query?where=ADDR_SOURCE+LIKE+%27%25${encodeURI(P)}%25%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelEnvelopeIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&relationParam=&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&returnEnvelope=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&defaultSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token=`)).json();m.value=B.features}else yr.selectedFeature={},m.value=[]},1e3)),Dc(()=>yr.selectedFeature,P=>{d.value=P.properties.ADDR_STD});const E=P=>{yr.selectedFeature=P,yr.map&&(yr.map.removeFeatureState({source:"parcels"}),yr.map.setFeatureState({source:"parcels",id:yr.selectedFeature.id},{click:!0}))};return(P,s)=>(Gs(),$o(zs,null,[Qr("h2",null,Xu(a.value?a.value:"Create Scenario"),1),Qr("form",{onSubmit:T},[Qr("label",null,[df("Project Title "),nr(Um,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=B=>a.value=B),placeholder:"Title",name:"title",required:""},null,8,["modelValue"])]),Qr("label",null,[df("Project Address "),nr(Um,{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=B=>d.value=B),placeholder:"Address",name:"address",required:""},null,8,["modelValue"])]),Object.keys(xa(yr).selectedFeature).length?Uy("",!0):(Gs(),$o("div",EO,[(Gs(!0),$o(zs,null,YP(m.value,B=>(Gs(),$o("div",{key:B.id,style:{padding:"0"}},[Qr("button",{class:"autocomp",type:"button",onClick:q=>E(B)},Xu(B.properties.ADDR_STD),9,AO)]))),128))])),Object.keys(xa(yr).selectedFeature).length?(Gs(),$o(zs,{key:1},[Qr("label",null,[df("Number of Residents "),nr(Um,{placeholder:"Residents",name:"residents",required:""})]),Qr("label",null,[df("Number of Employees "),nr(Um,{placeholder:"Employees",name:"employees",required:""})]),nr(gL,{text:"Generate Report"})],64)):Uy("",!0)],32),Object.keys(xa(yr).formData).length?(Gs(),rS(SO,{key:x.value})):Uy("",!0)],64))}},CO={id:"layout"},PO={id:"sidebar"},DO={__name:"App",setup(c){const a={lng:-71.224518,lat:42.213995,bearing:0,pitch:0,zoom:9};return(d,m)=>(Gs(),$o("div",CO,[Qr("div",PO,[nr(IO)]),nr(dL,{modelValue:a,"onUpdate:modelValue":m[0]||(m[0]=x=>a=x)})]))}},LO=nL(DO);LO.mount("#app");
